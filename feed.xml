<?xml version="1.0" encoding="utf-8"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"
    xmlns:dc="http://purl.org/dc/elements/1.1/">
    <channel>
        <title>Saturn Elephant</title>
        <link>https://laustep.github.io/stlahblog</link>
        <description><![CDATA[A blog about R and more.]]></description>
        <atom:link href="https://laustep.github.io/stlahblog/feed.xml" rel="self"
                   type="application/rss+xml" />
        <lastBuildDate>Thu, 08 Oct 2020 00:00:00 UT</lastBuildDate>
        <item>
    <title>My RGL artworks</title>
    <link>https://laustep.github.io/stlahblog/posts/MyRGLartworks.html</link>
    <description><![CDATA[<!DOCTYPE HTML>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Saturn Elephant - My RGL artworks</title>
  <link href="/libraries/bootstrap/bootstrap-grid.min.css" rel="stylesheet">
  <link rel="stylesheet" href="/css/post.css" />
  <link rel="stylesheet" href="/css/misc.css" /> 
  
    <link rel="stylesheet" href="/css/pandoc-solarized.css" /> 
   
  
  <link href="https://fonts.googleapis.com/css?family=Raleway:400,600,200,800" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/css?family=Droid+Sans" rel="stylesheet" type="text/css">
  <script src="/libraries/jquery.min.js"></script>
  <script type="text/javascript" async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML"></script>
</head>

<body>
  <div class="container-fluid">
    <div class="row">
      <!-- Sidebar. -->
      <div class="sidebar col-sm-3">
        <div style="float:right;clear:both;margin-right:50px;margin-top:150px;">
          <a href="https://www.r-bloggers.com/">
            <img src="https://www.r-bloggers.com/wp-content/uploads/2016/04/R_02_2016-05-01.png" alt="stla" width="100%" />
          </a>
          <br/>
          <a href="http://t-redactyl.io/">
            <span style="color:black;font-weight:bold;font-family:sans-serif;font-size:29px;">Standard error</span>
          </a>
          <a href="http://timelyportfolio.blogspot.be/">
            <span style="color:grey;font-weight:bold;font-family:sans-serif;font-size:27px;">Timely portfolio</span>
          </a>
          <br/>
          <a href="https://antoineguillot.wordpress.com/blog/">
            <span style="color:white;background-color:darkblue;font-weight:bold;font-family:sans-serif;font-size:25px;border:5px solid;border-color:darkblue">ENHANCE DATA</span>
          </a>
          <br/>
          <a href="https://fronkonstin.com/">
            <span style="color:black;background-color:gold;font-weight:bold;font-size:32px;border:3px solid;border-color:gold;">Fronkonstin</span>
          </a>
        </div>
      </div>

      <div class="main col-sm-9">
        <div id="header">
          <div id="logo" style="position:absolute;">
            <a href="/">
              <img src="../images/stla.jpg" alt="stla" width="100px" />
            </a>
          </div>
          <div id="navigation" style="margin-top:50px;">
            <a href="/">Home</a>
            <a href="/about.html">About</a>
            <a href="/contact.html">Contact</a>
            <a href="/archive.html">Archive</a>
          </div>
        </div>

        <div class="content">
          <h1>My RGL artworks</h1> 
          <div class="info">
    Posted on October  8, 2020
    
        by Stéphane Laurent
    
</div>
<div class="info">
    
    Tags: <a href="/tags/geometry.html">geometry</a>, <a href="/tags/graphics.html">graphics</a>, <a href="/tags/R.html">R</a>, <a href="/tags/rgl.html">rgl</a>
    
</div>

<p>These are some of my artworks realized with the R package <code>rgl</code>. Source code is available in <a href="https://gist.github.com/stla">my gists</a>.</p>
<p><img src="https://camo.githubusercontent.com/3a27a77e8d60a10ea347017bb4f78a85f28dce7f/68747470733a2f2f7468756d62732e6766796361742e636f6d2f45737465656d656453686f7779446f6c7068696e2d73697a655f726573747269637465642e676966" /></p>
<p><img src="https://camo.githubusercontent.com/62bb1cef024c3353381dbadfdb75d8839d5ed1e3/68747470733a2f2f7468756d62732e6766796361742e636f6d2f48656c7066756c506c6173746963416e74626561722d73697a655f726573747269637465642e676966" /></p>
<p><img src="https://camo.githubusercontent.com/5ea6d902f0f85b3fff29e87251e6977e28ba0c3c/68747470733a2f2f7468756d62732e6766796361742e636f6d2f506c756d70496d70617373696f6e65644265617665722d73697a655f726573747269637465642e676966" /></p>
<p><img src="https://camo.githubusercontent.com/978e0f0f42673e22685f350e3c6dd6b1c8fe6dff/68747470733a2f2f7468756d62732e6766796361742e636f6d2f4269746573697a6564457175616c476175722d73697a655f726573747269637465642e676966" /></p>
<p><img src="https://camo.githubusercontent.com/93c6b1b2f80818492f9714858d7fc0ffe66f3266/68747470733a2f2f7468756d62732e6766796361742e636f6d2f416d626974696f757354616d6541646461782d73697a655f726573747269637465642e676966" /></p>
<p><img src="https://camo.githubusercontent.com/d1e218228c4efdf6085e5ae80f5cc9feeea1e04d/68747470733a2f2f7468756d62732e6766796361742e636f6d2f4b696e64686561727465644f726e6572794865646765686f672d73697a655f726573747269637465642e676966" /></p>
<p><img src="https://camo.githubusercontent.com/dcd38ed43716c092ae0723d1075b32e082a6cd5b/68747470733a2f2f7468756d62732e6766796361742e636f6d2f466c6177656453656c6672656c69616e7443697272697065642d73697a655f726573747269637465642e676966" /></p>
<p><img src="https://camo.githubusercontent.com/5ed40dd4b6e85f75621a47d3dc4230e1ad46dc75/68747470733a2f2f7468756d62732e6766796361742e636f6d2f556e73746561647957656570794672696c6c6e65636b65646c697a6172642d73697a655f726573747269637465642e676966" /></p>
<p><img src="https://camo.githubusercontent.com/14d6b4ef37daab1a761c14cc4e237510958615ae/68747470733a2f2f7468756d62732e6766796361742e636f6d2f59656c6c6f77496465616c496e6368776f726d2d73697a655f726573747269637465642e676966" /></p>
<p><img src="https://camo.githubusercontent.com/9b47e1d657392cd29e9d684864b0d531d701cf18/68747470733a2f2f7468756d62732e6766796361742e636f6d2f426f6e794964656e746963616c426f696c77656576696c2d73697a655f726573747269637465642e676966" /></p>
<p><img src="https://camo.githubusercontent.com/59629ef36e30e73ebf584a45435a5e9fcd8ab1ae/68747470733a2f2f7468756d62732e6766796361742e636f6d2f4c696b656c794561726c7942656e67616c74696765722d73697a655f726573747269637465642e676966" /></p>
<p><img src="https://camo.githubusercontent.com/94af9461f70bf88fed1ce3eaa9fbf0374b5d0883/68747470733a2f2f7468756d62732e6766796361742e636f6d2f5765656b6c79517561727465726c794963746572696e65776172626c65722d73697a655f726573747269637465642e676966" /></p>
<p><img src="https://camo.githubusercontent.com/460582ebfe5d8ef2724fb11970e634385a3ecc4d/68747470733a2f2f7468756d62732e6766796361742e636f6d2f546f726e536e65616b794b6f616c61626561722d73697a655f726573747269637465642e676966" /></p>
<p><img src="https://camo.githubusercontent.com/9cb20d35d9ad95e96c76946e65c3165d91726006/68747470733a2f2f7468756d62732e6766796361742e636f6d2f556e666f7274756e617465436172656672656547726f756e64626565746c652d73697a655f726573747269637465642e676966" /></p>
<p><img src="https://camo.githubusercontent.com/ff1d85320bd032c9082b008b6dec2df37ea073b8/68747470733a2f2f7468756d62732e6766796361742e636f6d2f46616d6f75734c6176697368416e7469706f646573677265656e706172616b6565742d73697a655f726573747269637465642e676966" /></p>
<p><img src="https://camo.githubusercontent.com/6a397f4022cb0794053f7e3f980dbf50e119c10c/68747470733a2f2f7468756d62732e6766796361742e636f6d2f537069666679536d616c6c42757a7a6172642d73697a655f726573747269637465642e676966" /></p>
<p><img src="https://camo.githubusercontent.com/184b3b5000b26e83ea3fe399352105d07df746d5/68747470733a2f2f7468756d62732e6766796361742e636f6d2f43697263756c6172536d6172744861636b65652d73697a655f726573747269637465642e676966" /></p>
<p><img src="https://camo.githubusercontent.com/abacd39b34b5b57c6c9db5d9c11c1b07c59de371/68747470733a2f2f7468756d62732e6766796361742e636f6d2f536572696f7573446972656374426f6e6f626f2d73697a655f726573747269637465642e676966" /></p>

        </div>


        <div id="footer">
          Site proudly generated by
          <a href="http://jaspervdj.be/hakyll">Hakyll</a>
        </div>

      </div>

    </div>

    <div class="row">
      <div class="col-sm-12">
        <div id="disqus_thread"></div>
        <div class="pagination">
          <ul>
            <li>
              <a href="http://laustep.github.io/stlahblog/">&#171; Back Home</a>
            </li>
          </ul>
        </div>
      </div>
    </div>
    
  </div>

</body>

<script src="/libraries/bootstrap/bootstrap.min.js"></script>
<script>
  var disqus_developer = 1;
  var disqus_shortname = 'stlapblog';
  // required: replace example with your forum shortname
  /* * * DON'T EDIT BELOW THIS LINE * * */
  (function () {
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = 'https://' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] ||
      document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>
<noscript>Please enable JavaScript to view the
  <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a>
</noscript>
<!-- MathJax: Fall back to local if CDN offline but local image fonts are not supported (saves >100MB) -->
<script type="text/x-mathjax-config" src="../libraries/mathjax/config/TeX-MML-AM_CHTML.js"></script>
<!-- <script>
  window.MathJax || document.write('<script type="text/x-mathjax-config">MathJax.Hub.Config({"HTML-CSS":{imageFont:null}});<\/script><script src="../libraries/mathjax/MathJax.js"><\/script>');
</script> -->


</html>]]></description>
    <pubDate>Thu, 08 Oct 2020 00:00:00 UT</pubDate>
    <guid>https://laustep.github.io/stlahblog/posts/MyRGLartworks.html</guid>
    <dc:creator>Stéphane Laurent</dc:creator>
    
        <category>R</category>
    
</item><item>
    <title>My POV-Ray artworks</title>
    <link>https://laustep.github.io/stlahblog/posts/MyPovRAYartworks.html</link>
    <description><![CDATA[<!DOCTYPE HTML>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Saturn Elephant - My POV-Ray artworks</title>
  <link href="/libraries/bootstrap/bootstrap-grid.min.css" rel="stylesheet">
  <link rel="stylesheet" href="/css/post.css" />
  <link rel="stylesheet" href="/css/misc.css" /> 
  
    <link rel="stylesheet" href="/css/pandoc-solarized.css" /> 
   
  
  <link href="https://fonts.googleapis.com/css?family=Raleway:400,600,200,800" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/css?family=Droid+Sans" rel="stylesheet" type="text/css">
  <script src="/libraries/jquery.min.js"></script>
  <script type="text/javascript" async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML"></script>
</head>

<body>
  <div class="container-fluid">
    <div class="row">
      <!-- Sidebar. -->
      <div class="sidebar col-sm-3">
        <div style="float:right;clear:both;margin-right:50px;margin-top:150px;">
          <a href="https://www.r-bloggers.com/">
            <img src="https://www.r-bloggers.com/wp-content/uploads/2016/04/R_02_2016-05-01.png" alt="stla" width="100%" />
          </a>
          <br/>
          <a href="http://t-redactyl.io/">
            <span style="color:black;font-weight:bold;font-family:sans-serif;font-size:29px;">Standard error</span>
          </a>
          <a href="http://timelyportfolio.blogspot.be/">
            <span style="color:grey;font-weight:bold;font-family:sans-serif;font-size:27px;">Timely portfolio</span>
          </a>
          <br/>
          <a href="https://antoineguillot.wordpress.com/blog/">
            <span style="color:white;background-color:darkblue;font-weight:bold;font-family:sans-serif;font-size:25px;border:5px solid;border-color:darkblue">ENHANCE DATA</span>
          </a>
          <br/>
          <a href="https://fronkonstin.com/">
            <span style="color:black;background-color:gold;font-weight:bold;font-size:32px;border:3px solid;border-color:gold;">Fronkonstin</span>
          </a>
        </div>
      </div>

      <div class="main col-sm-9">
        <div id="header">
          <div id="logo" style="position:absolute;">
            <a href="/">
              <img src="../images/stla.jpg" alt="stla" width="100px" />
            </a>
          </div>
          <div id="navigation" style="margin-top:50px;">
            <a href="/">Home</a>
            <a href="/about.html">About</a>
            <a href="/contact.html">Contact</a>
            <a href="/archive.html">Archive</a>
          </div>
        </div>

        <div class="content">
          <h1>My POV-Ray artworks</h1> 
          <div class="info">
    Posted on October  8, 2020
    
        by Stéphane Laurent
    
</div>
<div class="info">
    
    Tags: <a href="/tags/geometry.html">geometry</a>, <a href="/tags/graphics.html">graphics</a>, <a href="/tags/povray.html">povray</a>
    
</div>

<p>These are some of my artworks realized with POV-Ray.</p>
<p><img src="https://camo.githubusercontent.com/aa14a5a0e940d5e00ed4df07a1fc7a2e1a18a75c/68747470733a2f2f7468756d62732e6766796361742e636f6d2f4162736f6c757465536861647941726d6564637261622d73697a655f726573747269637465642e676966" /></p>
<p><img src="https://camo.githubusercontent.com/89e7653c1b3439a869e92a867b7834530f8512bb/68747470733a2f2f7468756d62732e6766796361742e636f6d2f486566747944617a7a6c696e6742756c6c66726f672d73697a655f726573747269637465642e676966" /></p>
<p><img src="https://camo.githubusercontent.com/bad8ce98c4a9cc894d299d793a60757ae944b9f9/68747470733a2f2f7468756d62732e6766796361742e636f6d2f4964656e746963616c496e646f6c656e744861636b65652d73697a655f726573747269637465642e676966" /></p>
<p><img src="https://camo.githubusercontent.com/0dc9c8c44e4c65e1c4c504a77f4b2aa4369015be/68747470733a2f2f7468756d62732e6766796361742e636f6d2f43697263756c61725061727469616c426972642d73697a655f726573747269637465642e676966" /></p>
<p><img src="https://camo.githubusercontent.com/df8b1725965d727095fb243c22872091cb05edf5/68747470733a2f2f7468756d62732e6766796361742e636f6d2f5265737065637466756c45647563617465644963656c616e6467756c6c2d73697a655f726573747269637465642e676966" /></p>
<p><img src="https://camo.githubusercontent.com/1d06a9fc74dbd9f9fbbe3189c928a9607c69f6e8/68747470733a2f2f7468756d62732e6766796361742e636f6d2f52656c6965766564536f6d62657245696465722d73697a655f726573747269637465642e676966" /></p>
<p><img src="https://camo.githubusercontent.com/48bdb776b9f8434f27e759596cdfe51adb34359a/68747470733a2f2f7468756d62732e6766796361742e636f6d2f426c61636b616e64776869746557656c6c746f646f4972697368726564616e6477686974657365747465722d73697a655f726573747269637465642e676966" /></p>
<p><img src="https://camo.githubusercontent.com/ade2a4bb93867acfacc9e47d5a29a1f29fe039a0/68747470733a2f2f7468756d62732e6766796361742e636f6d2f53686f636b696e674665617266756c496c6c61646f707369732d73697a655f726573747269637465642e676966" /></p>
<p><img src="https://camo.githubusercontent.com/b390be1d372bb097289b29e26a0ed76d576aed02/68747470733a2f2f7468756d62732e6766796361742e636f6d2f5365706172617465436c65766572436865657461682d73697a655f726573747269637465642e676966" /></p>
<p><img src="https://camo.githubusercontent.com/101bd3e2ade90de2fe6b4103df7fdfba1442b123/68747470733a2f2f7468756d62732e6766796361742e636f6d2f556e73696768746c794c6f6e674369636164612d73697a655f726573747269637465642e676966" /></p>
<p><img src="https://camo.githubusercontent.com/a3c9f45e44bdbf8959f771a9ec98d58715855d46/68747470733a2f2f7468756d62732e6766796361742e636f6d2f466c69636b6572696e67446566696369656e7446697368696e676361742d73697a655f726573747269637465642e676966" /></p>
<p><img src="https://camo.githubusercontent.com/eb96f3391139dab2b0dc6db678254c786e686119/68747470733a2f2f7468756d62732e6766796361742e636f6d2f5761726d496e6e6f63656e74496365666973682d73697a655f726573747269637465642e676966" /></p>
<p><img src="https://camo.githubusercontent.com/9e9f3a8253d2324b60810ec9fcb553b8b424eb1e/68747470733a2f2f7468756d62732e6766796361742e636f6d2f4576696c4672656e6368486170756b752d73697a655f726573747269637465642e676966" /></p>
<p><img src="https://camo.githubusercontent.com/c75f828152c37e39d1893ec97fe1dff32548ff83/68747470733a2f2f7468756d62732e6766796361742e636f6d2f496e73697374656e74556e69746564446f6265726d616e70696e73636865722d736d616c6c2e676966" /></p>
<p><img src="https://camo.githubusercontent.com/7621ae070d0ef8621c86aa6fc40a07999f52b471/68747470733a2f2f7468756d62732e6766796361742e636f6d2f496d6d6163756c617465546f74616c4962697362696c6c2e77656270" /></p>
<p><img src="https://camo.githubusercontent.com/bb1a367834072c7cfd00e85c33c98afab432481e/68747470733a2f2f7468756d62732e6766796361742e636f6d2f5465737479457665727948797261782e77656270" /></p>
<p><img src="https://camo.githubusercontent.com/bc70874f9f45bc78cb5b30441ee367a7271c94de/68747470733a2f2f7468756d62732e6766796361742e636f6d2f526567756c61724c617374696e67446f726d6f7573652d73697a655f726573747269637465642e676966" /></p>
<p><img src="https://camo.githubusercontent.com/f0c6055a8c5be17d2bfb571cfa71463a77cc6389/68747470733a2f2f7468756d62732e6766796361742e636f6d2f486f6e657374466c69636b6572696e6743617264696e616c2d73697a655f726573747269637465642e676966" /></p>
<p><img src="https://camo.githubusercontent.com/ae994edc48077797e06b3c51a8c3ab0ba9534d3a/68747470733a2f2f7468756d62732e6766796361742e636f6d2f5368616d6566756c536f7265457175696e652d73697a655f726573747269637465642e676966" /></p>
<p><img src="https://camo.githubusercontent.com/12ebdb3c36d49715a3700a0017d8dd5cd9130761/68747470733a2f2f7468756d62732e6766796361742e636f6d2f476c616d6f726f7573536166654962657269616e6d696477696665746f61642d73697a655f726573747269637465642e676966" /></p>
<p><img src="https://camo.githubusercontent.com/3162e00a146770b6ef5691c6e7d01b3f36a48874/68747470733a2f2f7468756d62732e6766796361742e636f6d2f466169746866756c45737465656d6564426f612d73697a655f726573747269637465642e676966" /></p>

        </div>


        <div id="footer">
          Site proudly generated by
          <a href="http://jaspervdj.be/hakyll">Hakyll</a>
        </div>

      </div>

    </div>

    <div class="row">
      <div class="col-sm-12">
        <div id="disqus_thread"></div>
        <div class="pagination">
          <ul>
            <li>
              <a href="http://laustep.github.io/stlahblog/">&#171; Back Home</a>
            </li>
          </ul>
        </div>
      </div>
    </div>
    
  </div>

</body>

<script src="/libraries/bootstrap/bootstrap.min.js"></script>
<script>
  var disqus_developer = 1;
  var disqus_shortname = 'stlapblog';
  // required: replace example with your forum shortname
  /* * * DON'T EDIT BELOW THIS LINE * * */
  (function () {
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = 'https://' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] ||
      document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>
<noscript>Please enable JavaScript to view the
  <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a>
</noscript>
<!-- MathJax: Fall back to local if CDN offline but local image fonts are not supported (saves >100MB) -->
<script type="text/x-mathjax-config" src="../libraries/mathjax/config/TeX-MML-AM_CHTML.js"></script>
<!-- <script>
  window.MathJax || document.write('<script type="text/x-mathjax-config">MathJax.Hub.Config({"HTML-CSS":{imageFont:null}});<\/script><script src="../libraries/mathjax/MathJax.js"><\/script>');
</script> -->


</html>]]></description>
    <pubDate>Thu, 08 Oct 2020 00:00:00 UT</pubDate>
    <guid>https://laustep.github.io/stlahblog/posts/MyPovRAYartworks.html</guid>
    <dc:creator>Stéphane Laurent</dc:creator>
    
</item><item>
    <title>My Asymptote artworks</title>
    <link>https://laustep.github.io/stlahblog/posts/MyAsymptoteArtWorks.html</link>
    <description><![CDATA[<!DOCTYPE HTML>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Saturn Elephant - My Asymptote artworks</title>
  <link href="/libraries/bootstrap/bootstrap-grid.min.css" rel="stylesheet">
  <link rel="stylesheet" href="/css/post.css" />
  <link rel="stylesheet" href="/css/misc.css" /> 
  
    <link rel="stylesheet" href="/css/pandoc-solarized.css" /> 
   
  
  <link href="https://fonts.googleapis.com/css?family=Raleway:400,600,200,800" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/css?family=Droid+Sans" rel="stylesheet" type="text/css">
  <script src="/libraries/jquery.min.js"></script>
  <script type="text/javascript" async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML"></script>
</head>

<body>
  <div class="container-fluid">
    <div class="row">
      <!-- Sidebar. -->
      <div class="sidebar col-sm-3">
        <div style="float:right;clear:both;margin-right:50px;margin-top:150px;">
          <a href="https://www.r-bloggers.com/">
            <img src="https://www.r-bloggers.com/wp-content/uploads/2016/04/R_02_2016-05-01.png" alt="stla" width="100%" />
          </a>
          <br/>
          <a href="http://t-redactyl.io/">
            <span style="color:black;font-weight:bold;font-family:sans-serif;font-size:29px;">Standard error</span>
          </a>
          <a href="http://timelyportfolio.blogspot.be/">
            <span style="color:grey;font-weight:bold;font-family:sans-serif;font-size:27px;">Timely portfolio</span>
          </a>
          <br/>
          <a href="https://antoineguillot.wordpress.com/blog/">
            <span style="color:white;background-color:darkblue;font-weight:bold;font-family:sans-serif;font-size:25px;border:5px solid;border-color:darkblue">ENHANCE DATA</span>
          </a>
          <br/>
          <a href="https://fronkonstin.com/">
            <span style="color:black;background-color:gold;font-weight:bold;font-size:32px;border:3px solid;border-color:gold;">Fronkonstin</span>
          </a>
        </div>
      </div>

      <div class="main col-sm-9">
        <div id="header">
          <div id="logo" style="position:absolute;">
            <a href="/">
              <img src="../images/stla.jpg" alt="stla" width="100px" />
            </a>
          </div>
          <div id="navigation" style="margin-top:50px;">
            <a href="/">Home</a>
            <a href="/about.html">About</a>
            <a href="/contact.html">Contact</a>
            <a href="/archive.html">Archive</a>
          </div>
        </div>

        <div class="content">
          <h1>My Asymptote artworks</h1> 
          <div class="info">
    Posted on October  8, 2020
    
        by Stéphane Laurent
    
</div>
<div class="info">
    
    Tags: <a href="/tags/geometry.html">geometry</a>, <a href="/tags/graphics.html">graphics</a>, <a href="/tags/asymptote.html">asymptote</a>
    
</div>

<p>These are some of my artworks realized with Asymptote. Source code is available in <a href="https://gist.github.com/stla">my gists</a>.</p>
<p><img src="https://camo.githubusercontent.com/9ed893af8b74fda67babdf85cc0fcd7d0f85c8de/68747470733a2f2f7468756d62732e6766796361742e636f6d2f496d706f6c6974655175617272656c736f6d6549736c616e6477686973746c65722d73697a655f726573747269637465642e676966" /></p>
<p><img src="https://camo.githubusercontent.com/e756e4a56d1bf9fef9732c63a68495d07e675612/68747470733a2f2f692e696d6775722e636f6d2f4f556c714b53672e706e67" /></p>
<p><img src="https://camo.githubusercontent.com/8686088b51cb2651e763fb45e4adb8770ee81164/68747470733a2f2f692e696d6775722e636f6d2f365a586d6859682e706e67" /></p>
<p><img src="https://camo.githubusercontent.com/5b6d1d957e8363aacf50871751c74234ff7f40bc/68747470733a2f2f7468756d62732e6766796361742e636f6d2f536c6f7753697a7a6c696e67447261676f6e2d73697a655f726573747269637465642e676966" /></p>
<p><img src="https://camo.githubusercontent.com/ff0e5924d4c230baac3ea44bb9319f8a628b034d/68747470733a2f2f7468756d62732e6766796361742e636f6d2f46616972546869636b4b6f622d73697a655f726573747269637465642e676966" /></p>
<p><img src="https://camo.githubusercontent.com/a43e303772d68eeade2a80e6faca828481ed5266/68747470733a2f2f7468756d62732e6766796361742e636f6d2f496c6c6661746564467269676874656e6564456d752d73697a655f726573747269637465642e676966" /></p>
<p><img src="https://camo.githubusercontent.com/6424d65ab234fb8b57e2c59b6dc95b572ff8f18b/68747470733a2f2f7468756d62732e6766796361742e636f6d2f57696c746564486f6c6c6f774775696e6561666f776c2d73697a655f726573747269637465642e676966" /></p>
<p><img src="https://camo.githubusercontent.com/ff5ea29b2c52adc749822d898377432478b2a034/68747470733a2f2f692e696d6775722e636f6d2f6c356c4f36374e2e706e67" /></p>
<p><img src="https://camo.githubusercontent.com/c0a64f640227c6f0523e0ee3f20f93c614f5ef68/68747470733a2f2f7468756d62732e6766796361742e636f6d2f43656c656272617465644964656e746963616c4b726f6e6f7361757275732d73697a655f726573747269637465642e676966" /></p>
<p><img src="https://camo.githubusercontent.com/d4b5981382cf60eda356045201033e53614ae091/68747470733a2f2f692e696d6775722e636f6d2f436264556c32722e706e67" /></p>
<p><img src="https://camo.githubusercontent.com/9e9c77871ce70c7e8eae313435c321e5acfeba9c/68747470733a2f2f7468756d62732e6766796361742e636f6d2f416476616e63656444697a7a79416e746172637469636675727365616c2d73697a655f726573747269637465642e676966" /></p>
<p><img src="https://camo.githubusercontent.com/540a40bcca0ff65bf7b90dd53397d4cbb362ac42/68747470733a2f2f7468756d62732e6766796361742e636f6d2f4772616e64696f73654561726e657374426c7565626f74746c652d73697a655f726573747269637465642e676966" /></p>
<p><img src="https://camo.githubusercontent.com/223873691a64e9edc5c6dce2e65eed0ebe875b74/68747470733a2f2f7468756d62732e6766796361742e636f6d2f477265656e536e6976656c696e6741726b7368656c6c2d73697a655f726573747269637465642e676966" /></p>
<p><img src="https://camo.githubusercontent.com/ab2aea6ce0ac5324d51f673f1a81b2547c574bb1/68747470733a2f2f7468756d62732e6766796361742e636f6d2f4d696e646c6573735361666547616c617061676f7370656e6775696e2d73697a655f726573747269637465642e676966" /></p>
<p><img src="https://camo.githubusercontent.com/733c035b8626b07c8b12db171ffbc4364752084a/68747470733a2f2f7468756d62732e6766796361742e636f6d2f446170706572466f72636566756c436f6e646f722d73697a655f726573747269637465642e676966" /></p>

        </div>


        <div id="footer">
          Site proudly generated by
          <a href="http://jaspervdj.be/hakyll">Hakyll</a>
        </div>

      </div>

    </div>

    <div class="row">
      <div class="col-sm-12">
        <div id="disqus_thread"></div>
        <div class="pagination">
          <ul>
            <li>
              <a href="http://laustep.github.io/stlahblog/">&#171; Back Home</a>
            </li>
          </ul>
        </div>
      </div>
    </div>
    
  </div>

</body>

<script src="/libraries/bootstrap/bootstrap.min.js"></script>
<script>
  var disqus_developer = 1;
  var disqus_shortname = 'stlapblog';
  // required: replace example with your forum shortname
  /* * * DON'T EDIT BELOW THIS LINE * * */
  (function () {
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = 'https://' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] ||
      document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>
<noscript>Please enable JavaScript to view the
  <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a>
</noscript>
<!-- MathJax: Fall back to local if CDN offline but local image fonts are not supported (saves >100MB) -->
<script type="text/x-mathjax-config" src="../libraries/mathjax/config/TeX-MML-AM_CHTML.js"></script>
<!-- <script>
  window.MathJax || document.write('<script type="text/x-mathjax-config">MathJax.Hub.Config({"HTML-CSS":{imageFont:null}});<\/script><script src="../libraries/mathjax/MathJax.js"><\/script>');
</script> -->


</html>]]></description>
    <pubDate>Thu, 08 Oct 2020 00:00:00 UT</pubDate>
    <guid>https://laustep.github.io/stlahblog/posts/MyAsymptoteArtWorks.html</guid>
    <dc:creator>Stéphane Laurent</dc:creator>
    
</item><item>
    <title>Child tables with DT, editing, exporting</title>
    <link>https://laustep.github.io/stlahblog/posts/DT_childTables.html</link>
    <description><![CDATA[<!DOCTYPE HTML>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Saturn Elephant - Child tables with DT, editing, exporting</title>
  <link href="/libraries/bootstrap/bootstrap-grid.min.css" rel="stylesheet">
  <link rel="stylesheet" href="/css/post.css" />
  <link rel="stylesheet" href="/css/misc.css" /> 
  
    <link rel="stylesheet" href="/css/pandoc-solarized.css" /> 
   
  
    <link href="/libraries/highlighters/prettify/css/minimal.css" rel="stylesheet"> 
  
  <link href="https://fonts.googleapis.com/css?family=Raleway:400,600,200,800" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/css?family=Droid+Sans" rel="stylesheet" type="text/css">
  <script src="/libraries/jquery.min.js"></script>
  <script type="text/javascript" async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML"></script>
</head>

<body>
  <div class="container-fluid">
    <div class="row">
      <!-- Sidebar. -->
      <div class="sidebar col-sm-3">
        <div style="float:right;clear:both;margin-right:50px;margin-top:150px;">
          <a href="https://www.r-bloggers.com/">
            <img src="https://www.r-bloggers.com/wp-content/uploads/2016/04/R_02_2016-05-01.png" alt="stla" width="100%" />
          </a>
          <br/>
          <a href="http://t-redactyl.io/">
            <span style="color:black;font-weight:bold;font-family:sans-serif;font-size:29px;">Standard error</span>
          </a>
          <a href="http://timelyportfolio.blogspot.be/">
            <span style="color:grey;font-weight:bold;font-family:sans-serif;font-size:27px;">Timely portfolio</span>
          </a>
          <br/>
          <a href="https://antoineguillot.wordpress.com/blog/">
            <span style="color:white;background-color:darkblue;font-weight:bold;font-family:sans-serif;font-size:25px;border:5px solid;border-color:darkblue">ENHANCE DATA</span>
          </a>
          <br/>
          <a href="https://fronkonstin.com/">
            <span style="color:black;background-color:gold;font-weight:bold;font-size:32px;border:3px solid;border-color:gold;">Fronkonstin</span>
          </a>
        </div>
      </div>

      <div class="main col-sm-9">
        <div id="header">
          <div id="logo" style="position:absolute;">
            <a href="/">
              <img src="../images/stla.jpg" alt="stla" width="100px" />
            </a>
          </div>
          <div id="navigation" style="margin-top:50px;">
            <a href="/">Home</a>
            <a href="/about.html">About</a>
            <a href="/contact.html">Contact</a>
            <a href="/archive.html">Archive</a>
          </div>
        </div>

        <div class="content">
          <h1>Child tables with DT, editing, exporting</h1> 
          <div class="info">
    Posted on May  8, 2020
    
        by Stéphane Laurent
    
</div>
<div class="info">
    
    Tags: <a href="/tags/R.html">R</a>, <a href="/tags/datatables.html">datatables</a>, <a href="/tags/shiny.html">shiny</a>, <a href="/tags/javascript.html">javascript</a>
    
</div>

<p>I’m going to show how to use the <code>DT</code> package to do a table with child tables, and how to edit and export such a table.</p>
<p>In order to do a table with child tables, one adds a list column to the dataframe of the main table; each cell of this column contains the child table of the corresponding row, given as a list. This is done by the <code>NestedData</code> function below.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" title="1">NestedData &lt;-<span class="st"> </span><span class="cf">function</span>(dat, children){</a>
<a class="sourceLine" id="cb1-2" title="2">  <span class="kw">stopifnot</span>(<span class="kw">length</span>(children) <span class="op">==</span><span class="st"> </span><span class="kw">nrow</span>(dat))</a>
<a class="sourceLine" id="cb1-3" title="3">  g &lt;-<span class="st"> </span><span class="cf">function</span>(d){</a>
<a class="sourceLine" id="cb1-4" title="4">    <span class="cf">if</span>(<span class="kw">is.data.frame</span>(d)){</a>
<a class="sourceLine" id="cb1-5" title="5">      purrr<span class="op">::</span><span class="kw">transpose</span>(d)</a>
<a class="sourceLine" id="cb1-6" title="6">    }<span class="cf">else</span>{</a>
<a class="sourceLine" id="cb1-7" title="7">      purrr<span class="op">::</span><span class="kw">transpose</span>(<span class="kw">NestedData</span>(d[[<span class="dv">1</span>]], <span class="dt">children =</span> d<span class="op">$</span>children))</a>
<a class="sourceLine" id="cb1-8" title="8">    }</a>
<a class="sourceLine" id="cb1-9" title="9">  }</a>
<a class="sourceLine" id="cb1-10" title="10">  subdats &lt;-<span class="st"> </span><span class="kw">lapply</span>(children, g)</a>
<a class="sourceLine" id="cb1-11" title="11">  oplus &lt;-<span class="st"> </span><span class="kw">ifelse</span>(<span class="kw">lengths</span>(subdats), <span class="st">&quot;&amp;oplus;&quot;</span>, <span class="st">&quot;&quot;</span>) </a>
<a class="sourceLine" id="cb1-12" title="12">  <span class="kw">cbind</span>(<span class="st">&quot; &quot;</span> =<span class="st"> </span>oplus, dat, <span class="st">&quot;_details&quot;</span> =<span class="st"> </span><span class="kw">I</span>(subdats), </a>
<a class="sourceLine" id="cb1-13" title="13">        <span class="dt">stringsAsFactors =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb1-14" title="14">}</a></code></pre></div>
<p>The usage of <code>NestedData</code> is easy to understand with an example:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" title="1">dat0   =<span class="st"> </span>iris[<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>,]        <span class="co"># main table, with three rows</span></a>
<a class="sourceLine" id="cb2-2" title="2">dat01  =<span class="st"> </span>airquality[<span class="dv">1</span><span class="op">:</span><span class="dv">4</span>,]  <span class="co"># |- child of first row</span></a>
<a class="sourceLine" id="cb2-3" title="3">dat02  =<span class="st"> </span>cars[<span class="dv">1</span><span class="op">:</span><span class="dv">2</span>,]        <span class="co"># |- child of second row, with two rows</span></a>
<a class="sourceLine" id="cb2-4" title="4">dat021 =<span class="st"> </span>mtcars[<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>,]      <span class="co"># |  |- child of first row of dat02</span></a>
<a class="sourceLine" id="cb2-5" title="5">dat022 =<span class="st"> </span>PlantGrowth[<span class="dv">1</span><span class="op">:</span><span class="dv">4</span>,] <span class="co"># |  |- child of second row of dat02</span></a>
<a class="sourceLine" id="cb2-6" title="6">dat03  =<span class="st"> </span><span class="kw">data.frame</span>(<span class="ot">NULL</span>)  <span class="co"># |- third row has no child</span></a>
<a class="sourceLine" id="cb2-7" title="7"></a>
<a class="sourceLine" id="cb2-8" title="8">Dat &lt;-<span class="st"> </span><span class="kw">NestedData</span>(</a>
<a class="sourceLine" id="cb2-9" title="9">  <span class="dt">dat =</span> dat0, </a>
<a class="sourceLine" id="cb2-10" title="10">  <span class="dt">children =</span> <span class="kw">list</span>(</a>
<a class="sourceLine" id="cb2-11" title="11">    dat01, </a>
<a class="sourceLine" id="cb2-12" title="12">    <span class="kw">list</span>(  </a>
<a class="sourceLine" id="cb2-13" title="13">      dat02, </a>
<a class="sourceLine" id="cb2-14" title="14">      <span class="dt">children =</span> <span class="kw">list</span>(</a>
<a class="sourceLine" id="cb2-15" title="15">        dat021, </a>
<a class="sourceLine" id="cb2-16" title="16">        dat022</a>
<a class="sourceLine" id="cb2-17" title="17">      )</a>
<a class="sourceLine" id="cb2-18" title="18">    ), </a>
<a class="sourceLine" id="cb2-19" title="19">    dat03 </a>
<a class="sourceLine" id="cb2-20" title="20">  )</a>
<a class="sourceLine" id="cb2-21" title="21">)</a></code></pre></div>
<p>Now we define the JavaScript callback which will be used. The code depends on whether one wants to display the row names of the main table, so the user has to enter this information before.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" title="1"><span class="kw">library</span>(DT)</a>
<a class="sourceLine" id="cb3-2" title="2"></a>
<a class="sourceLine" id="cb3-3" title="3"><span class="co">## whether to show row names</span></a>
<a class="sourceLine" id="cb3-4" title="4">rowNames =<span class="st"> </span><span class="ot">FALSE</span></a>
<a class="sourceLine" id="cb3-5" title="5">colIdx &lt;-<span class="st"> </span><span class="kw">as.integer</span>(rowNames)</a>
<a class="sourceLine" id="cb3-6" title="6"></a>
<a class="sourceLine" id="cb3-7" title="7"><span class="co">## the callback</span></a>
<a class="sourceLine" id="cb3-8" title="8">parentRows &lt;-<span class="st"> </span><span class="kw">which</span>(Dat[,<span class="dv">1</span>] <span class="op">!=</span><span class="st"> &quot;&quot;</span>)</a>
<a class="sourceLine" id="cb3-9" title="9">callback &lt;-<span class="st"> </span><span class="kw">JS</span>(</a>
<a class="sourceLine" id="cb3-10" title="10">  <span class="kw">sprintf</span>(<span class="st">&quot;var parentRows = [%s];&quot;</span>, <span class="kw">toString</span>(parentRows<span class="dv">-1</span>)),</a>
<a class="sourceLine" id="cb3-11" title="11">  <span class="kw">sprintf</span>(<span class="st">&quot;var j0 = %d;&quot;</span>, colIdx),</a>
<a class="sourceLine" id="cb3-12" title="12">  <span class="st">&quot;var nrows = table.rows().count();&quot;</span>,</a>
<a class="sourceLine" id="cb3-13" title="13">  <span class="st">&quot;for(let i = 0; i &lt; nrows; ++i){&quot;</span>,</a>
<a class="sourceLine" id="cb3-14" title="14">  <span class="st">&quot;  var $cell = table.cell(i,j0).nodes().to$();&quot;</span>,</a>
<a class="sourceLine" id="cb3-15" title="15">  <span class="st">&quot;  if(parentRows.indexOf(i) &gt; -1){&quot;</span>,</a>
<a class="sourceLine" id="cb3-16" title="16">  <span class="st">&quot;    $cell.css({cursor: &#39;pointer&#39;});&quot;</span>,</a>
<a class="sourceLine" id="cb3-17" title="17">  <span class="st">&quot;  }else{&quot;</span>,</a>
<a class="sourceLine" id="cb3-18" title="18">  <span class="st">&quot;    $cell.removeClass(&#39;details-control&#39;);&quot;</span>,</a>
<a class="sourceLine" id="cb3-19" title="19">  <span class="st">&quot;  }&quot;</span>,</a>
<a class="sourceLine" id="cb3-20" title="20">  <span class="st">&quot;}&quot;</span>,</a>
<a class="sourceLine" id="cb3-21" title="21">  <span class="st">&quot;&quot;</span>,</a>
<a class="sourceLine" id="cb3-22" title="22">  <span class="st">&quot;// --- make the table header of the nested table --- //&quot;</span>,</a>
<a class="sourceLine" id="cb3-23" title="23">  <span class="st">&quot;var formatHeader = function(d, childId){&quot;</span>,</a>
<a class="sourceLine" id="cb3-24" title="24">  <span class="st">&quot;  if(d !== null){&quot;</span>,</a>
<a class="sourceLine" id="cb3-25" title="25">  <span class="st">&quot;    var html = &quot;</span>, </a>
<a class="sourceLine" id="cb3-26" title="26">  <span class="st">&quot;      &#39;&lt;table class=</span><span class="ch">\&quot;</span><span class="st">display compact hover</span><span class="ch">\&quot;</span><span class="st"> &#39; + &quot;</span>,</a>
<a class="sourceLine" id="cb3-27" title="27">  <span class="st">&quot;      &#39;style=</span><span class="ch">\&quot;</span><span class="st">padding-left: 30px;</span><span class="ch">\&quot;</span><span class="st"> id=</span><span class="ch">\&quot;</span><span class="st">&#39; + childId + &quot;</span>, </a>
<a class="sourceLine" id="cb3-28" title="28">  <span class="st">&quot;      &#39;</span><span class="ch">\&quot;</span><span class="st">&gt;&lt;thead&gt;&lt;tr&gt;&#39;;&quot;</span>,</a>
<a class="sourceLine" id="cb3-29" title="29">  <span class="st">&quot;    var data = d[d.length-1] || d._details;&quot;</span>,</a>
<a class="sourceLine" id="cb3-30" title="30">  <span class="st">&quot;    for(let key in data[0]){&quot;</span>,</a>
<a class="sourceLine" id="cb3-31" title="31">  <span class="st">&quot;      html += &#39;&lt;th&gt;&#39; + key + &#39;&lt;/th&gt;&#39;;&quot;</span>,</a>
<a class="sourceLine" id="cb3-32" title="32">  <span class="st">&quot;    }&quot;</span>,</a>
<a class="sourceLine" id="cb3-33" title="33">  <span class="st">&quot;    html += &#39;&lt;/tr&gt;&lt;/thead&gt;&lt;/table&gt;&#39;&quot;</span>,</a>
<a class="sourceLine" id="cb3-34" title="34">  <span class="st">&quot;    return html;&quot;</span>,</a>
<a class="sourceLine" id="cb3-35" title="35">  <span class="st">&quot;  } else {&quot;</span>,</a>
<a class="sourceLine" id="cb3-36" title="36">  <span class="st">&quot;    return &#39;&#39;;&quot;</span>,</a>
<a class="sourceLine" id="cb3-37" title="37">  <span class="st">&quot;  }&quot;</span>,</a>
<a class="sourceLine" id="cb3-38" title="38">  <span class="st">&quot;};&quot;</span>,</a>
<a class="sourceLine" id="cb3-39" title="39">  <span class="st">&quot;&quot;</span>,</a>
<a class="sourceLine" id="cb3-40" title="40">  <span class="st">&quot;// --- row callback to style rows of child tables --- //&quot;</span>,</a>
<a class="sourceLine" id="cb3-41" title="41">  <span class="st">&quot;var rowCallback = function(row, dat, displayNum, index){&quot;</span>,</a>
<a class="sourceLine" id="cb3-42" title="42">  <span class="st">&quot;  if($(row).hasClass(&#39;odd&#39;)){&quot;</span>,</a>
<a class="sourceLine" id="cb3-43" title="43">  <span class="st">&quot;    $(row).css(&#39;background-color&#39;, &#39;papayawhip&#39;);&quot;</span>,</a>
<a class="sourceLine" id="cb3-44" title="44">  <span class="st">&quot;    $(row).hover(function(){&quot;</span>,</a>
<a class="sourceLine" id="cb3-45" title="45">  <span class="st">&quot;      $(this).css(&#39;background-color&#39;, &#39;#E6FF99&#39;);&quot;</span>,</a>
<a class="sourceLine" id="cb3-46" title="46">  <span class="st">&quot;    }, function(){&quot;</span>,</a>
<a class="sourceLine" id="cb3-47" title="47">  <span class="st">&quot;      $(this).css(&#39;background-color&#39;, &#39;papayawhip&#39;);&quot;</span>,</a>
<a class="sourceLine" id="cb3-48" title="48">  <span class="st">&quot;    });&quot;</span>,</a>
<a class="sourceLine" id="cb3-49" title="49">  <span class="st">&quot;  } else {&quot;</span>,</a>
<a class="sourceLine" id="cb3-50" title="50">  <span class="st">&quot;    $(row).css(&#39;background-color&#39;, &#39;lemonchiffon&#39;);&quot;</span>,</a>
<a class="sourceLine" id="cb3-51" title="51">  <span class="st">&quot;    $(row).hover(function(){&quot;</span>,</a>
<a class="sourceLine" id="cb3-52" title="52">  <span class="st">&quot;      $(this).css(&#39;background-color&#39;, &#39;#DDFF75&#39;);&quot;</span>,</a>
<a class="sourceLine" id="cb3-53" title="53">  <span class="st">&quot;    }, function(){&quot;</span>,</a>
<a class="sourceLine" id="cb3-54" title="54">  <span class="st">&quot;      $(this).css(&#39;background-color&#39;, &#39;lemonchiffon&#39;);&quot;</span>,</a>
<a class="sourceLine" id="cb3-55" title="55">  <span class="st">&quot;    });&quot;</span>,</a>
<a class="sourceLine" id="cb3-56" title="56">  <span class="st">&quot;  }&quot;</span>,</a>
<a class="sourceLine" id="cb3-57" title="57">  <span class="st">&quot;};&quot;</span>,</a>
<a class="sourceLine" id="cb3-58" title="58">  <span class="st">&quot;&quot;</span>,</a>
<a class="sourceLine" id="cb3-59" title="59">  <span class="st">&quot;// --- header callback to style header of child tables --- //&quot;</span>,</a>
<a class="sourceLine" id="cb3-60" title="60">  <span class="st">&quot;var headerCallback = function(thead, data, start, end, display){&quot;</span>,</a>
<a class="sourceLine" id="cb3-61" title="61">  <span class="st">&quot;  $(&#39;th&#39;, thead).css({&quot;</span>,</a>
<a class="sourceLine" id="cb3-62" title="62">  <span class="st">&quot;    &#39;border-top&#39;: &#39;3px solid indigo&#39;,&quot;</span>, </a>
<a class="sourceLine" id="cb3-63" title="63">  <span class="st">&quot;    &#39;color&#39;: &#39;indigo&#39;,&quot;</span>,</a>
<a class="sourceLine" id="cb3-64" title="64">  <span class="st">&quot;    &#39;background-color&#39;: &#39;#fadadd&#39;&quot;</span>,</a>
<a class="sourceLine" id="cb3-65" title="65">  <span class="st">&quot;  });&quot;</span>,</a>
<a class="sourceLine" id="cb3-66" title="66">  <span class="st">&quot;};&quot;</span>,</a>
<a class="sourceLine" id="cb3-67" title="67">  <span class="st">&quot;&quot;</span>,</a>
<a class="sourceLine" id="cb3-68" title="68">  <span class="st">&quot;// --- make the datatable --- //&quot;</span>,</a>
<a class="sourceLine" id="cb3-69" title="69">  <span class="st">&quot;var formatDatatable = function(d, childId){&quot;</span>,</a>
<a class="sourceLine" id="cb3-70" title="70">  <span class="st">&quot;  var data = d[d.length-1] || d._details;&quot;</span>,</a>
<a class="sourceLine" id="cb3-71" title="71">  <span class="st">&quot;  var colNames = Object.keys(data[0]);&quot;</span>,</a>
<a class="sourceLine" id="cb3-72" title="72">  <span class="st">&quot;  var columns = colNames.map(function(x){&quot;</span>,</a>
<a class="sourceLine" id="cb3-73" title="73">  <span class="st">&quot;    return {data: x.replace(/</span><span class="ch">\\</span><span class="st">./g, &#39;</span><span class="ch">\\\\\\</span><span class="st">.&#39;), title: x};&quot;</span>,</a>
<a class="sourceLine" id="cb3-74" title="74">  <span class="st">&quot;  });&quot;</span>,</a>
<a class="sourceLine" id="cb3-75" title="75">  <span class="st">&quot;  var id = &#39;table#&#39; + childId;&quot;</span>,</a>
<a class="sourceLine" id="cb3-76" title="76">  <span class="st">&quot;  if(colNames.indexOf(&#39;_details&#39;) === -1){&quot;</span>,</a>
<a class="sourceLine" id="cb3-77" title="77">  <span class="st">&quot;    var subtable = $(id).DataTable({&quot;</span>,</a>
<a class="sourceLine" id="cb3-78" title="78">  <span class="st">&quot;      &#39;data&#39;: data,&quot;</span>,</a>
<a class="sourceLine" id="cb3-79" title="79">  <span class="st">&quot;      &#39;columns&#39;: columns,&quot;</span>,</a>
<a class="sourceLine" id="cb3-80" title="80">  <span class="st">&quot;      &#39;autoWidth&#39;: true,&quot;</span>,</a>
<a class="sourceLine" id="cb3-81" title="81">  <span class="st">&quot;      &#39;deferRender&#39;: true,&quot;</span>,</a>
<a class="sourceLine" id="cb3-82" title="82">  <span class="st">&quot;      &#39;info&#39;: false,&quot;</span>,</a>
<a class="sourceLine" id="cb3-83" title="83">  <span class="st">&quot;      &#39;lengthChange&#39;: false,&quot;</span>,</a>
<a class="sourceLine" id="cb3-84" title="84">  <span class="st">&quot;      &#39;ordering&#39;: data.length &gt; 1,&quot;</span>,</a>
<a class="sourceLine" id="cb3-85" title="85">  <span class="st">&quot;      &#39;order&#39;: [],&quot;</span>,</a>
<a class="sourceLine" id="cb3-86" title="86">  <span class="st">&quot;      &#39;paging&#39;: false,&quot;</span>,</a>
<a class="sourceLine" id="cb3-87" title="87">  <span class="st">&quot;      &#39;scrollX&#39;: false,&quot;</span>,</a>
<a class="sourceLine" id="cb3-88" title="88">  <span class="st">&quot;      &#39;scrollY&#39;: false,&quot;</span>,</a>
<a class="sourceLine" id="cb3-89" title="89">  <span class="st">&quot;      &#39;searching&#39;: false,&quot;</span>,</a>
<a class="sourceLine" id="cb3-90" title="90">  <span class="st">&quot;      &#39;sortClasses&#39;: false,&quot;</span>,</a>
<a class="sourceLine" id="cb3-91" title="91">  <span class="st">&quot;      &#39;rowCallback&#39;: rowCallback,&quot;</span>,</a>
<a class="sourceLine" id="cb3-92" title="92">  <span class="st">&quot;      &#39;headerCallback&#39;: headerCallback,&quot;</span>,</a>
<a class="sourceLine" id="cb3-93" title="93">  <span class="st">&quot;      &#39;columnDefs&#39;: [{targets: &#39;_all&#39;, className: &#39;dt-center&#39;}]&quot;</span>,</a>
<a class="sourceLine" id="cb3-94" title="94">  <span class="st">&quot;    });&quot;</span>,</a>
<a class="sourceLine" id="cb3-95" title="95">  <span class="st">&quot;  } else {&quot;</span>,</a>
<a class="sourceLine" id="cb3-96" title="96">  <span class="st">&quot;    var subtable = $(id).DataTable({&quot;</span>,</a>
<a class="sourceLine" id="cb3-97" title="97">  <span class="st">&quot;      &#39;data&#39;: data,&quot;</span>,</a>
<a class="sourceLine" id="cb3-98" title="98">  <span class="st">&quot;      &#39;columns&#39;: columns,&quot;</span>,</a>
<a class="sourceLine" id="cb3-99" title="99">  <span class="st">&quot;      &#39;autoWidth&#39;: true,&quot;</span>,</a>
<a class="sourceLine" id="cb3-100" title="100">  <span class="st">&quot;      &#39;deferRender&#39;: true,&quot;</span>,</a>
<a class="sourceLine" id="cb3-101" title="101">  <span class="st">&quot;      &#39;info&#39;: false,&quot;</span>,</a>
<a class="sourceLine" id="cb3-102" title="102">  <span class="st">&quot;      &#39;lengthChange&#39;: false,&quot;</span>,</a>
<a class="sourceLine" id="cb3-103" title="103">  <span class="st">&quot;      &#39;ordering&#39;: data.length &gt; 1,&quot;</span>,</a>
<a class="sourceLine" id="cb3-104" title="104">  <span class="st">&quot;      &#39;order&#39;: [],&quot;</span>,</a>
<a class="sourceLine" id="cb3-105" title="105">  <span class="st">&quot;      &#39;paging&#39;: false,&quot;</span>,</a>
<a class="sourceLine" id="cb3-106" title="106">  <span class="st">&quot;      &#39;scrollX&#39;: false,&quot;</span>,</a>
<a class="sourceLine" id="cb3-107" title="107">  <span class="st">&quot;      &#39;scrollY&#39;: false,&quot;</span>,</a>
<a class="sourceLine" id="cb3-108" title="108">  <span class="st">&quot;      &#39;searching&#39;: false,&quot;</span>,</a>
<a class="sourceLine" id="cb3-109" title="109">  <span class="st">&quot;      &#39;sortClasses&#39;: false,&quot;</span>,</a>
<a class="sourceLine" id="cb3-110" title="110">  <span class="st">&quot;      &#39;rowCallback&#39;: rowCallback,&quot;</span>,</a>
<a class="sourceLine" id="cb3-111" title="111">  <span class="st">&quot;      &#39;headerCallback&#39;: headerCallback,&quot;</span>,</a>
<a class="sourceLine" id="cb3-112" title="112">  <span class="st">&quot;      &#39;columnDefs&#39;: [&quot;</span>, </a>
<a class="sourceLine" id="cb3-113" title="113">  <span class="st">&quot;        {targets: -1, visible: false},&quot;</span>, </a>
<a class="sourceLine" id="cb3-114" title="114">  <span class="st">&quot;        {targets: 0, orderable: false, className: &#39;details-control&#39;},&quot;</span>, </a>
<a class="sourceLine" id="cb3-115" title="115">  <span class="st">&quot;        {targets: &#39;_all&#39;, className: &#39;dt-center&#39;}&quot;</span>,</a>
<a class="sourceLine" id="cb3-116" title="116">  <span class="st">&quot;      ]&quot;</span>,</a>
<a class="sourceLine" id="cb3-117" title="117">  <span class="st">&quot;    }).column(0).nodes().to$().css({cursor: &#39;pointer&#39;});&quot;</span>,</a>
<a class="sourceLine" id="cb3-118" title="118">  <span class="st">&quot;  }&quot;</span>,</a>
<a class="sourceLine" id="cb3-119" title="119">  <span class="st">&quot;};&quot;</span>,</a>
<a class="sourceLine" id="cb3-120" title="120">  <span class="st">&quot;&quot;</span>,</a>
<a class="sourceLine" id="cb3-121" title="121">  <span class="st">&quot;// --- display the child table on click --- //&quot;</span>,</a>
<a class="sourceLine" id="cb3-122" title="122">  <span class="st">&quot;// array to store id&#39;s of already created child tables&quot;</span>,</a>
<a class="sourceLine" id="cb3-123" title="123">  <span class="st">&quot;var children = [];&quot;</span>, </a>
<a class="sourceLine" id="cb3-124" title="124">  <span class="st">&quot;table.on(&#39;click&#39;, &#39;td.details-control&#39;, function(){&quot;</span>,</a>
<a class="sourceLine" id="cb3-125" title="125">  <span class="st">&quot;  var tbl = $(this).closest(&#39;table&#39;),&quot;</span>,</a>
<a class="sourceLine" id="cb3-126" title="126">  <span class="st">&quot;      tblId = tbl.attr(&#39;id&#39;),&quot;</span>,</a>
<a class="sourceLine" id="cb3-127" title="127">  <span class="st">&quot;      td = $(this),&quot;</span>,</a>
<a class="sourceLine" id="cb3-128" title="128">  <span class="st">&quot;      row = $(tbl).DataTable().row(td.closest(&#39;tr&#39;)),&quot;</span>,</a>
<a class="sourceLine" id="cb3-129" title="129">  <span class="st">&quot;      rowIdx = row.index();&quot;</span>,</a>
<a class="sourceLine" id="cb3-130" title="130">  <span class="st">&quot;  if(row.child.isShown()){&quot;</span>,</a>
<a class="sourceLine" id="cb3-131" title="131">  <span class="st">&quot;    row.child.hide();&quot;</span>,</a>
<a class="sourceLine" id="cb3-132" title="132">  <span class="st">&quot;    td.html(&#39;&amp;oplus;&#39;);&quot;</span>,</a>
<a class="sourceLine" id="cb3-133" title="133">  <span class="st">&quot;  } else {&quot;</span>,</a>
<a class="sourceLine" id="cb3-134" title="134">  <span class="st">&quot;    var childId = tblId + &#39;-child-&#39; + rowIdx;&quot;</span>,</a>
<a class="sourceLine" id="cb3-135" title="135">  <span class="st">&quot;    if(children.indexOf(childId) === -1){&quot;</span>, </a>
<a class="sourceLine" id="cb3-136" title="136">  <span class="st">&quot;      // this child has not been created yet&quot;</span>,</a>
<a class="sourceLine" id="cb3-137" title="137">  <span class="st">&quot;      children.push(childId);&quot;</span>,</a>
<a class="sourceLine" id="cb3-138" title="138">  <span class="st">&quot;      row.child(formatHeader(row.data(), childId)).show();&quot;</span>,</a>
<a class="sourceLine" id="cb3-139" title="139">  <span class="st">&quot;      td.html(&#39;&amp;CircleMinus;&#39;);&quot;</span>,</a>
<a class="sourceLine" id="cb3-140" title="140">  <span class="st">&quot;      formatDatatable(row.data(), childId, rowIdx);&quot;</span>,</a>
<a class="sourceLine" id="cb3-141" title="141">  <span class="st">&quot;    }else{&quot;</span>,</a>
<a class="sourceLine" id="cb3-142" title="142">  <span class="st">&quot;      // this child has already been created&quot;</span>,</a>
<a class="sourceLine" id="cb3-143" title="143">  <span class="st">&quot;      row.child(true);&quot;</span>,</a>
<a class="sourceLine" id="cb3-144" title="144">  <span class="st">&quot;      td.html(&#39;&amp;CircleMinus;&#39;);&quot;</span>,</a>
<a class="sourceLine" id="cb3-145" title="145">  <span class="st">&quot;    }&quot;</span>,</a>
<a class="sourceLine" id="cb3-146" title="146">  <span class="st">&quot;  }&quot;</span>,</a>
<a class="sourceLine" id="cb3-147" title="147">  <span class="st">&quot;});&quot;</span>)</a></code></pre></div>
<p>Now, here is the code which generates the table. The first column contains some HTML (⊕) so we have to not escape it. The last column contains the child data, it has to be hidden. Finally we assign the class <code>details-control</code> to the first column, this is used by the callback.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" title="1"><span class="kw">datatable</span>(</a>
<a class="sourceLine" id="cb4-2" title="2">  Dat, </a>
<a class="sourceLine" id="cb4-3" title="3">  <span class="dt">callback =</span> callback, <span class="dt">rownames =</span> rowNames, <span class="dt">escape =</span> <span class="op">-</span>colIdx<span class="dv">-1</span>,</a>
<a class="sourceLine" id="cb4-4" title="4">  <span class="dt">options =</span> <span class="kw">list</span>(</a>
<a class="sourceLine" id="cb4-5" title="5">    <span class="dt">paging =</span> <span class="ot">FALSE</span>,</a>
<a class="sourceLine" id="cb4-6" title="6">    <span class="dt">searching =</span> <span class="ot">FALSE</span>,</a>
<a class="sourceLine" id="cb4-7" title="7">    <span class="dt">columnDefs =</span> <span class="kw">list</span>(</a>
<a class="sourceLine" id="cb4-8" title="8">      <span class="kw">list</span>(</a>
<a class="sourceLine" id="cb4-9" title="9">        <span class="dt">visible =</span> <span class="ot">FALSE</span>, </a>
<a class="sourceLine" id="cb4-10" title="10">        <span class="dt">targets =</span> <span class="kw">ncol</span>(Dat)<span class="op">-</span><span class="dv">1</span><span class="op">+</span>colIdx</a>
<a class="sourceLine" id="cb4-11" title="11">      ),</a>
<a class="sourceLine" id="cb4-12" title="12">      <span class="kw">list</span>(</a>
<a class="sourceLine" id="cb4-13" title="13">        <span class="dt">orderable =</span> <span class="ot">FALSE</span>, </a>
<a class="sourceLine" id="cb4-14" title="14">        <span class="dt">className =</span> <span class="st">&quot;details-control&quot;</span>, </a>
<a class="sourceLine" id="cb4-15" title="15">        <span class="dt">targets =</span> colIdx</a>
<a class="sourceLine" id="cb4-16" title="16">      ),</a>
<a class="sourceLine" id="cb4-17" title="17">      <span class="kw">list</span>(</a>
<a class="sourceLine" id="cb4-18" title="18">        <span class="dt">className =</span> <span class="st">&quot;dt-center&quot;</span>, </a>
<a class="sourceLine" id="cb4-19" title="19">        <span class="dt">targets =</span> <span class="st">&quot;_all&quot;</span></a>
<a class="sourceLine" id="cb4-20" title="20">      )</a>
<a class="sourceLine" id="cb4-21" title="21">    )</a>
<a class="sourceLine" id="cb4-22" title="22">  )</a>
<a class="sourceLine" id="cb4-23" title="23">)</a></code></pre></div>
<p><img src="figures/DTchildRows1.gif" /></p>
<h1 id="editing">Editing</h1>
<p>We use the JavaScript library <a href="https://github.com/ejbeaty/CellEdit">CellEdit</a> to allow cells, including the cells of the child tables, to be editable. Download the file <strong>dataTables.cellEdit.js</strong>.</p>
<p>Some CSS is required in order to make things pretty. Save the following CSS code in a file <strong>dataTables.cellEdit.css</strong>.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode css"><code class="sourceCode css"><a class="sourceLine" id="cb5-1" title="1"><span class="fu">.my-input-class</span> {</a>
<a class="sourceLine" id="cb5-2" title="2">  <span class="kw">padding</span>: <span class="dv">3</span><span class="dt">px</span> <span class="dv">6</span><span class="dt">px</span><span class="op">;</span></a>
<a class="sourceLine" id="cb5-3" title="3">  <span class="kw">border</span>: <span class="dv">1</span><span class="dt">px</span> <span class="dv">solid</span> <span class="cn">#ccc</span><span class="op">;</span></a>
<a class="sourceLine" id="cb5-4" title="4">  <span class="kw">border-radius</span>: <span class="dv">4</span><span class="dt">px</span><span class="op">;</span></a>
<a class="sourceLine" id="cb5-5" title="5">  <span class="kw">width</span>: <span class="dv">60</span><span class="dt">px</span><span class="op">;</span></a>
<a class="sourceLine" id="cb5-6" title="6">}</a>
<a class="sourceLine" id="cb5-7" title="7"></a>
<a class="sourceLine" id="cb5-8" title="8"><span class="fu">.my-confirm-class</span> {</a>
<a class="sourceLine" id="cb5-9" title="9">  <span class="kw">padding</span>: <span class="dv">3</span><span class="dt">px</span> <span class="dv">6</span><span class="dt">px</span><span class="op">;</span></a>
<a class="sourceLine" id="cb5-10" title="10">  <span class="kw">font-size</span>: <span class="dv">12</span><span class="dt">px</span><span class="op">;</span></a>
<a class="sourceLine" id="cb5-11" title="11">  <span class="kw">color</span>: <span class="cn">white</span><span class="op">;</span></a>
<a class="sourceLine" id="cb5-12" title="12">  <span class="kw">text-align</span>: <span class="dv">center</span><span class="op">;</span></a>
<a class="sourceLine" id="cb5-13" title="13">  <span class="kw">vertical-align</span>: <span class="dv">middle</span><span class="op">;</span></a>
<a class="sourceLine" id="cb5-14" title="14">  <span class="kw">border-radius</span>: <span class="dv">4</span><span class="dt">px</span><span class="op">;</span></a>
<a class="sourceLine" id="cb5-15" title="15">  <span class="kw">background-color</span>: <span class="cn">#337ab7</span><span class="op">;</span></a>
<a class="sourceLine" id="cb5-16" title="16">  <span class="kw">text-decoration</span>: <span class="dv">none</span><span class="op">;</span></a>
<a class="sourceLine" id="cb5-17" title="17">}</a>
<a class="sourceLine" id="cb5-18" title="18"></a>
<a class="sourceLine" id="cb5-19" title="19"><span class="fu">.my-cancel-class</span> {</a>
<a class="sourceLine" id="cb5-20" title="20">  <span class="kw">padding</span>: <span class="dv">3</span><span class="dt">px</span> <span class="dv">6</span><span class="dt">px</span><span class="op">;</span></a>
<a class="sourceLine" id="cb5-21" title="21">  <span class="kw">font-size</span>: <span class="dv">12</span><span class="dt">px</span><span class="op">;</span></a>
<a class="sourceLine" id="cb5-22" title="22">  <span class="kw">color</span>: <span class="cn">white</span><span class="op">;</span></a>
<a class="sourceLine" id="cb5-23" title="23">  <span class="kw">text-align</span>: <span class="dv">center</span><span class="op">;</span></a>
<a class="sourceLine" id="cb5-24" title="24">  <span class="kw">vertical-align</span>: <span class="dv">middle</span><span class="op">;</span></a>
<a class="sourceLine" id="cb5-25" title="25">  <span class="kw">border-radius</span>: <span class="dv">4</span><span class="dt">px</span><span class="op">;</span></a>
<a class="sourceLine" id="cb5-26" title="26">  <span class="kw">background-color</span>: <span class="cn">#a94442</span><span class="op">;</span></a>
<a class="sourceLine" id="cb5-27" title="27">  <span class="kw">text-decoration</span>: <span class="dv">none</span><span class="op">;</span></a>
<a class="sourceLine" id="cb5-28" title="28">}</a></code></pre></div>
<p>Now modify the callback as follows:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" title="1">callback &lt;-<span class="st"> </span><span class="kw">JS</span>(</a>
<a class="sourceLine" id="cb6-2" title="2">  <span class="st">&quot;function onUpdate(updatedCell, updatedRow, oldValue) {};&quot;</span>,</a>
<a class="sourceLine" id="cb6-3" title="3">  <span class="st">&quot;table.MakeCellsEditable({&quot;</span>,</a>
<a class="sourceLine" id="cb6-4" title="4">  <span class="st">&quot;  onUpdate: onUpdate,&quot;</span>,</a>
<a class="sourceLine" id="cb6-5" title="5">  <span class="st">&quot;  inputCss: &#39;my-input-class&#39;,&quot;</span>,</a>
<a class="sourceLine" id="cb6-6" title="6">  <span class="st">&quot;  confirmationButton: {&quot;</span>,</a>
<a class="sourceLine" id="cb6-7" title="7">  <span class="st">&quot;    confirmCss: &#39;my-confirm-class&#39;,&quot;</span>,</a>
<a class="sourceLine" id="cb6-8" title="8">  <span class="st">&quot;    cancelCss: &#39;my-cancel-class&#39;&quot;</span>,</a>
<a class="sourceLine" id="cb6-9" title="9">  <span class="st">&quot;  }&quot;</span>,</a>
<a class="sourceLine" id="cb6-10" title="10">  <span class="st">&quot;});&quot;</span>,</a>
<a class="sourceLine" id="cb6-11" title="11">  <span class="kw">sprintf</span>(<span class="st">&quot;var parentRows = [%s];&quot;</span>, <span class="kw">toString</span>(parentRows<span class="dv">-1</span>)),</a>
<a class="sourceLine" id="cb6-12" title="12">  </a>
<a class="sourceLine" id="cb6-13" title="13">  ......</a>
<a class="sourceLine" id="cb6-14" title="14">  </a>
<a class="sourceLine" id="cb6-15" title="15">  <span class="st">&quot;// --- make the datatable --- //&quot;</span>,</a>
<a class="sourceLine" id="cb6-16" title="16">  <span class="st">&quot;var formatDatatable = function(d, childId){&quot;</span>,</a>
<a class="sourceLine" id="cb6-17" title="17">  </a>
<a class="sourceLine" id="cb6-18" title="18">  ......</a>
<a class="sourceLine" id="cb6-19" title="19"></a>
<a class="sourceLine" id="cb6-20" title="20">  <span class="st">&quot;    }).column(0).nodes().to$().css({cursor: &#39;pointer&#39;});&quot;</span>,</a>
<a class="sourceLine" id="cb6-21" title="21">  <span class="st">&quot;  }&quot;</span>,</a>
<a class="sourceLine" id="cb6-22" title="22">  <span class="st">&quot;  subtable.MakeCellsEditable({&quot;</span>,</a>
<a class="sourceLine" id="cb6-23" title="23">  <span class="st">&quot;    onUpdate: onUpdate,&quot;</span>,</a>
<a class="sourceLine" id="cb6-24" title="24">  <span class="st">&quot;    inputCss: &#39;my-input-class&#39;,&quot;</span>,</a>
<a class="sourceLine" id="cb6-25" title="25">  <span class="st">&quot;    confirmationButton: {&quot;</span>,</a>
<a class="sourceLine" id="cb6-26" title="26">  <span class="st">&quot;      confirmCss: &#39;my-confirm-class&#39;,&quot;</span>,</a>
<a class="sourceLine" id="cb6-27" title="27">  <span class="st">&quot;      cancelCss: &#39;my-cancel-class&#39;&quot;</span>,</a>
<a class="sourceLine" id="cb6-28" title="28">  <span class="st">&quot;    }&quot;</span>,</a>
<a class="sourceLine" id="cb6-29" title="29">  <span class="st">&quot;  });&quot;</span>,</a>
<a class="sourceLine" id="cb6-30" title="30">  <span class="st">&quot;};&quot;</span>,</a>
<a class="sourceLine" id="cb6-31" title="31">  <span class="st">&quot;&quot;</span>,</a>
<a class="sourceLine" id="cb6-32" title="32">  <span class="st">&quot;// --- display the child table on click --- //&quot;</span>,</a>
<a class="sourceLine" id="cb6-33" title="33"></a>
<a class="sourceLine" id="cb6-34" title="34">  ......</a>
<a class="sourceLine" id="cb6-35" title="35">  </a>
<a class="sourceLine" id="cb6-36" title="36">  <span class="st">&quot;});&quot;</span>)</a></code></pre></div>
<p>Use the same code as before to generate the table but store the output:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" title="1">dtable &lt;-<span class="st"> </span><span class="kw">datatable</span>(</a>
<a class="sourceLine" id="cb7-2" title="2">  Dat, </a>
<a class="sourceLine" id="cb7-3" title="3">  <span class="dt">callback =</span> callback, <span class="dt">rownames =</span> rowNames, <span class="dt">escape =</span> <span class="op">-</span>colIdx<span class="dv">-1</span>,</a>
<a class="sourceLine" id="cb7-4" title="4">  <span class="dt">options =</span> <span class="kw">list</span>(</a>
<a class="sourceLine" id="cb7-5" title="5">    <span class="dt">paging =</span> <span class="ot">FALSE</span>,</a>
<a class="sourceLine" id="cb7-6" title="6">    <span class="dt">searching =</span> <span class="ot">FALSE</span>,</a>
<a class="sourceLine" id="cb7-7" title="7">    <span class="dt">columnDefs =</span> <span class="kw">list</span>(</a>
<a class="sourceLine" id="cb7-8" title="8">      <span class="kw">list</span>(</a>
<a class="sourceLine" id="cb7-9" title="9">        <span class="dt">visible =</span> <span class="ot">FALSE</span>, </a>
<a class="sourceLine" id="cb7-10" title="10">        <span class="dt">targets =</span> <span class="kw">ncol</span>(Dat)<span class="op">-</span><span class="dv">1</span><span class="op">+</span>colIdx</a>
<a class="sourceLine" id="cb7-11" title="11">      ),</a>
<a class="sourceLine" id="cb7-12" title="12">      <span class="kw">list</span>(</a>
<a class="sourceLine" id="cb7-13" title="13">        <span class="dt">orderable =</span> <span class="ot">FALSE</span>, </a>
<a class="sourceLine" id="cb7-14" title="14">        <span class="dt">className =</span> <span class="st">&quot;details-control&quot;</span>, </a>
<a class="sourceLine" id="cb7-15" title="15">        <span class="dt">targets =</span> colIdx</a>
<a class="sourceLine" id="cb7-16" title="16">      ),</a>
<a class="sourceLine" id="cb7-17" title="17">      <span class="kw">list</span>(</a>
<a class="sourceLine" id="cb7-18" title="18">        <span class="dt">className =</span> <span class="st">&quot;dt-center&quot;</span>, </a>
<a class="sourceLine" id="cb7-19" title="19">        <span class="dt">targets =</span> <span class="st">&quot;_all&quot;</span></a>
<a class="sourceLine" id="cb7-20" title="20">      )</a>
<a class="sourceLine" id="cb7-21" title="21">    )</a>
<a class="sourceLine" id="cb7-22" title="22">  )</a>
<a class="sourceLine" id="cb7-23" title="23">)</a></code></pre></div>
<p>Now we add the dependencies to the <code>datatable</code>:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" title="1">path &lt;-<span class="st"> &quot;path/to/cellEdit&quot;</span> <span class="co"># folder containing the files </span></a>
<a class="sourceLine" id="cb8-2" title="2">                           <span class="co"># dataTables.cellEdit.js and </span></a>
<a class="sourceLine" id="cb8-3" title="3">                           <span class="co"># dataTables.cellEdit.css</span></a>
<a class="sourceLine" id="cb8-4" title="4">dep &lt;-<span class="st"> </span>htmltools<span class="op">::</span><span class="kw">htmlDependency</span>(</a>
<a class="sourceLine" id="cb8-5" title="5">  <span class="st">&quot;CellEdit&quot;</span>, <span class="st">&quot;1.0.19&quot;</span>, path, </a>
<a class="sourceLine" id="cb8-6" title="6">  <span class="dt">script =</span> <span class="st">&quot;dataTables.cellEdit.js&quot;</span>, </a>
<a class="sourceLine" id="cb8-7" title="7">  <span class="dt">stylesheet =</span> <span class="st">&quot;dataTables.cellEdit.css&quot;</span>)</a>
<a class="sourceLine" id="cb8-8" title="8">dtable<span class="op">$</span>dependencies &lt;-<span class="st"> </span><span class="kw">c</span>(dtable<span class="op">$</span>dependencies, <span class="kw">list</span>(dep))</a>
<a class="sourceLine" id="cb8-9" title="9"></a>
<a class="sourceLine" id="cb8-10" title="10">dtable</a></code></pre></div>
<p><img src="figures/DTchildRows2.gif" /></p>
<h1 id="exporting">Exporting</h1>
<p>Now we show how to export a table with its child tables to an Excel file, when there is only one level of child tables (<em>i.e.</em> when the child tables of the main table do not have child tables themselves). To do so, we use the <code>customize</code> callback of the Excel button provided by the <code>Buttons</code> extension. I found this code on the DataTables forum. In the first row of the callback, <code>mytable</code> is the id of the datatable:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb9-1" title="1"><span class="kw">var</span> table <span class="op">=</span> <span class="at">$</span>(<span class="st">&#39;#mytable&#39;</span>).<span class="at">find</span>(<span class="st">&#39;table&#39;</span>).<span class="at">DataTable</span>()<span class="op">;</span></a></code></pre></div>
<p>If you don’t use Shiny, you have to set this id in the <code>elementId</code> argument of the <code>datatable</code> function. If you use Shiny, this id is the key of the element of the <code>output</code> object in which you assign a <code>renderDT</code>:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" title="1">output[[<span class="st">&quot;mytable&quot;</span>]] &lt;-<span class="st"> </span><span class="kw">renderDT</span>({</a>
<a class="sourceLine" id="cb10-2" title="2">  ......</a>
<a class="sourceLine" id="cb10-3" title="3">})</a></code></pre></div>
<p>The JavaScript code depends on whether the user desires a title in the Excel file, so this information has to be provided first.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" title="1">excelTitle =<span class="st"> </span><span class="ot">NULL</span> <span class="co"># enter title or set to NULL if you don&#39;t want a title</span></a>
<a class="sourceLine" id="cb11-2" title="2">js_customXLSX &lt;-<span class="st"> </span><span class="kw">JS</span>(</a>
<a class="sourceLine" id="cb11-3" title="3">  <span class="st">&quot;function(xlsx){&quot;</span>,</a>
<a class="sourceLine" id="cb11-4" title="4">  <span class="st">&quot;  var table = $(&#39;#mytable&#39;).find(&#39;table&#39;).DataTable();&quot;</span>,</a>
<a class="sourceLine" id="cb11-5" title="5">  <span class="st">&quot;  // Number of columns.&quot;</span>,</a>
<a class="sourceLine" id="cb11-6" title="6">  <span class="kw">sprintf</span>(<span class="st">&quot;  var ncols = %d;&quot;</span>, <span class="kw">ncol</span>(Dat)),</a>
<a class="sourceLine" id="cb11-7" title="7">  <span class="st">&quot;  // Is there a title?&quot;</span>,</a>
<a class="sourceLine" id="cb11-8" title="8">  <span class="kw">sprintf</span>(<span class="st">&quot;  var title = %s;&quot;</span>, </a>
<a class="sourceLine" id="cb11-9" title="9">          <span class="kw">ifelse</span>(<span class="kw">is.null</span>(excelTitle), <span class="st">&quot;false&quot;</span>, <span class="st">&quot;true&quot;</span>)),</a>
<a class="sourceLine" id="cb11-10" title="10">  <span class="st">&quot;  // Integer to Excel column: 0 -&gt; A, 1 -&gt; B, ..., 25 -&gt; Z, 26 -&gt; AA, ...&quot;</span>,</a>
<a class="sourceLine" id="cb11-11" title="11">  <span class="st">&quot;  var XLcolumn = function(j){&quot;</span>, </a>
<a class="sourceLine" id="cb11-12" title="12">  <span class="st">&quot;    return j &lt; 0 ? &quot;</span>,</a>
<a class="sourceLine" id="cb11-13" title="13">  <span class="st">&quot;      &#39;&#39; : XLcolumn(j/26-1) + String.fromCharCode(j % 26 + 65);&quot;</span>,</a>
<a class="sourceLine" id="cb11-14" title="14">  <span class="st">&quot;  };&quot;</span>,</a>
<a class="sourceLine" id="cb11-15" title="15">  <span class="st">&quot;  // Get sheet.&quot;</span>,</a>
<a class="sourceLine" id="cb11-16" title="16">  <span class="st">&quot;  var sheet = xlsx.xl.worksheets[&#39;sheet1.xml&#39;];&quot;</span>,</a>
<a class="sourceLine" id="cb11-17" title="17">  <span class="st">&quot;  // Get a clone of the sheet data.        &quot;</span>,</a>
<a class="sourceLine" id="cb11-18" title="18">  <span class="st">&quot;  var sheetData = $(&#39;sheetData&#39;, sheet).clone();&quot;</span>,</a>
<a class="sourceLine" id="cb11-19" title="19">  <span class="st">&quot;  // Clear the current sheet data for appending rows.&quot;</span>,</a>
<a class="sourceLine" id="cb11-20" title="20">  <span class="st">&quot;  $(&#39;sheetData&#39;, sheet).empty();&quot;</span>,</a>
<a class="sourceLine" id="cb11-21" title="21">  <span class="st">&quot;  // Row count in Excel sheet.&quot;</span>,</a>
<a class="sourceLine" id="cb11-22" title="22">  <span class="st">&quot;  var rowCount = 1;&quot;</span>,</a>
<a class="sourceLine" id="cb11-23" title="23">  <span class="st">&quot;  // Iterate each row in the sheet data.&quot;</span>,</a>
<a class="sourceLine" id="cb11-24" title="24">  <span class="st">&quot;  $(sheetData).children().each(function (index) {&quot;</span>,</a>
<a class="sourceLine" id="cb11-25" title="25">  <span class="st">&quot;    // Used for DT row() API to get child data.&quot;</span>,</a>
<a class="sourceLine" id="cb11-26" title="26">  <span class="st">&quot;    var rowIndex = title ? index - 2 : index - 1;&quot;</span>, </a>
<a class="sourceLine" id="cb11-27" title="27">  <span class="st">&quot;    // Don&#39;t process row if it&#39;s the title row or the header row.&quot;</span>,</a>
<a class="sourceLine" id="cb11-28" title="28">  <span class="st">&quot;    var i0 = title ? 1 : 0;&quot;</span>,</a>
<a class="sourceLine" id="cb11-29" title="29">  <span class="st">&quot;    if (index &gt; i0) {&quot;</span>, </a>
<a class="sourceLine" id="cb11-30" title="30">  <span class="st">&quot;      // Get row&quot;</span>,</a>
<a class="sourceLine" id="cb11-31" title="31">  <span class="st">&quot;      var row = $(this.outerHTML);&quot;</span>,</a>
<a class="sourceLine" id="cb11-32" title="32">  <span class="st">&quot;      // Set the Excel row attr to the current Excel row count.&quot;</span>,</a>
<a class="sourceLine" id="cb11-33" title="33">  <span class="st">&quot;      row.attr(&#39;r&#39;, rowCount);&quot;</span>,</a>
<a class="sourceLine" id="cb11-34" title="34">  <span class="st">&quot;      // Iterate each cell in the row to change the row number.&quot;</span>,</a>
<a class="sourceLine" id="cb11-35" title="35">  <span class="st">&quot;      row.children().each(function (index) {&quot;</span>,</a>
<a class="sourceLine" id="cb11-36" title="36">  <span class="st">&quot;        var cell = $(this);&quot;</span>,</a>
<a class="sourceLine" id="cb11-37" title="37">  <span class="st">&quot;        // Set each cell&#39;s row value.&quot;</span>,</a>
<a class="sourceLine" id="cb11-38" title="38">  <span class="st">&quot;        var rc = cell.attr(&#39;r&#39;);&quot;</span>,</a>
<a class="sourceLine" id="cb11-39" title="39">  <span class="st">&quot;        rc = rc.replace(/</span><span class="ch">\\</span><span class="st">d+$/, </span><span class="ch">\&quot;\&quot;</span><span class="st">) + rowCount;&quot;</span>,</a>
<a class="sourceLine" id="cb11-40" title="40">  <span class="st">&quot;        cell.attr(&#39;r&#39;, rc);&quot;</span>,</a>
<a class="sourceLine" id="cb11-41" title="41">  <span class="st">&quot;      });&quot;</span>,</a>
<a class="sourceLine" id="cb11-42" title="42">  <span class="st">&quot;      // Get the row HTML and append to sheetData.&quot;</span>,</a>
<a class="sourceLine" id="cb11-43" title="43">  <span class="st">&quot;      row = row[0].outerHTML;&quot;</span>,</a>
<a class="sourceLine" id="cb11-44" title="44">  <span class="st">&quot;      $(&#39;sheetData&#39;, sheet).append(row);&quot;</span>,</a>
<a class="sourceLine" id="cb11-45" title="45">  <span class="st">&quot;      rowCount++;&quot;</span>,</a>
<a class="sourceLine" id="cb11-46" title="46">  <span class="st">&quot;      // Get the child data - could be any data attached to the row.&quot;</span>,</a>
<a class="sourceLine" id="cb11-47" title="47">  <span class="st">&quot;      var data = table.row(&#39;:eq(&#39; + rowIndex + &#39;)&#39;).data();&quot;</span>,</a>
<a class="sourceLine" id="cb11-48" title="48">  <span class="st">&quot;      var childData = data[ncols-1];&quot;</span>, </a>
<a class="sourceLine" id="cb11-49" title="49">  <span class="st">&quot;      if(childData.length &gt; 0){&quot;</span>,</a>
<a class="sourceLine" id="cb11-50" title="50">  <span class="st">&quot;        var colNames = Object.keys(childData[0]);&quot;</span>,</a>
<a class="sourceLine" id="cb11-51" title="51">  <span class="st">&quot;        // Prepare Excel formatted row&quot;</span>,</a>
<a class="sourceLine" id="cb11-52" title="52">  <span class="st">&quot;        var headerRow = &#39;&lt;row r=</span><span class="ch">\&quot;</span><span class="st">&#39; + rowCount +&quot;</span>,</a>
<a class="sourceLine" id="cb11-53" title="53">  <span class="st">&quot;          &#39;</span><span class="ch">\&quot;</span><span class="st">&gt;&lt;c t=</span><span class="ch">\&quot;</span><span class="st">inlineStr</span><span class="ch">\&quot;</span><span class="st"> r=</span><span class="ch">\&quot;</span><span class="st">A&#39; + rowCount +&quot;</span>,</a>
<a class="sourceLine" id="cb11-54" title="54">  <span class="st">&quot;          &#39;</span><span class="ch">\&quot;</span><span class="st">&gt;&lt;is&gt;&lt;t&gt;&lt;/t&gt;&lt;/is&gt;&lt;/c&gt;&#39;;&quot;</span>,</a>
<a class="sourceLine" id="cb11-55" title="55">  <span class="st">&quot;        for(let i = 0; i &lt; colNames.length; i++){&quot;</span>,</a>
<a class="sourceLine" id="cb11-56" title="56">  <span class="st">&quot;          headerRow = headerRow +&quot;</span>,</a>
<a class="sourceLine" id="cb11-57" title="57">  <span class="st">&quot;            &#39;&lt;c t=</span><span class="ch">\&quot;</span><span class="st">inlineStr</span><span class="ch">\&quot;</span><span class="st"> r=</span><span class="ch">\&quot;</span><span class="st">&#39; + XLcolumn(i+1) + rowCount +&quot;</span>,</a>
<a class="sourceLine" id="cb11-58" title="58">  <span class="st">&quot;            &#39;</span><span class="ch">\&quot;</span><span class="st"> s=</span><span class="ch">\&quot;</span><span class="st">7</span><span class="ch">\&quot;</span><span class="st">&gt;&lt;is&gt;&lt;t&gt;&#39; + colNames[i] +&quot;</span>, </a>
<a class="sourceLine" id="cb11-59" title="59">  <span class="st">&quot;            &#39;&lt;/t&gt;&lt;/is&gt;&lt;/c&gt;&#39;;&quot;</span>,</a>
<a class="sourceLine" id="cb11-60" title="60">  <span class="st">&quot;        }&quot;</span>,</a>
<a class="sourceLine" id="cb11-61" title="61">  <span class="st">&quot;        headerRow = headerRow + &#39;&lt;/row&gt;&#39;;&quot;</span>,</a>
<a class="sourceLine" id="cb11-62" title="62">  <span class="st">&quot;        // Append header row to sheetData.&quot;</span>,</a>
<a class="sourceLine" id="cb11-63" title="63">  <span class="st">&quot;        $(&#39;sheetData&#39;, sheet).append(headerRow);&quot;</span>,</a>
<a class="sourceLine" id="cb11-64" title="64">  <span class="st">&quot;        rowCount++; // Increment excel row counter.&quot;</span>,</a>
<a class="sourceLine" id="cb11-65" title="65">  <span class="st">&quot;      }&quot;</span>,</a>
<a class="sourceLine" id="cb11-66" title="66">  <span class="st">&quot;      // The child data is an array of rows&quot;</span>,</a>
<a class="sourceLine" id="cb11-67" title="67">  <span class="st">&quot;      for(let c = 0; c &lt; childData.length; c++){&quot;</span>,</a>
<a class="sourceLine" id="cb11-68" title="68">  <span class="st">&quot;        // Get row data.&quot;</span>,</a>
<a class="sourceLine" id="cb11-69" title="69">  <span class="st">&quot;        var child = childData[c];&quot;</span>,</a>
<a class="sourceLine" id="cb11-70" title="70">  <span class="st">&quot;        // Prepare Excel formatted row&quot;</span>,</a>
<a class="sourceLine" id="cb11-71" title="71">  <span class="st">&quot;        var childRow = &#39;&lt;row r=</span><span class="ch">\&quot;</span><span class="st">&#39; + rowCount +&quot;</span>,</a>
<a class="sourceLine" id="cb11-72" title="72">  <span class="st">&quot;          &#39;</span><span class="ch">\&quot;</span><span class="st">&gt;&lt;c t=</span><span class="ch">\&quot;</span><span class="st">inlineStr</span><span class="ch">\&quot;</span><span class="st"> r=</span><span class="ch">\&quot;</span><span class="st">A&#39; + rowCount +&quot;</span>,</a>
<a class="sourceLine" id="cb11-73" title="73">  <span class="st">&quot;          &#39;</span><span class="ch">\&quot;</span><span class="st">&gt;&lt;is&gt;&lt;t&gt;&lt;/t&gt;&lt;/is&gt;&lt;/c&gt;&#39;;&quot;</span>,</a>
<a class="sourceLine" id="cb11-74" title="74">  <span class="st">&quot;        for(let i = 0; i &lt; colNames.length; i++){&quot;</span>,</a>
<a class="sourceLine" id="cb11-75" title="75">  <span class="st">&quot;          childRow = childRow +&quot;</span>,</a>
<a class="sourceLine" id="cb11-76" title="76">  <span class="st">&quot;            &#39;&lt;c t=</span><span class="ch">\&quot;</span><span class="st">inlineStr</span><span class="ch">\&quot;</span><span class="st"> r=</span><span class="ch">\&quot;</span><span class="st">&#39; + XLcolumn(i+1) + rowCount +&quot;</span>,</a>
<a class="sourceLine" id="cb11-77" title="77">  <span class="st">&quot;            &#39;</span><span class="ch">\&quot;</span><span class="st"> s=</span><span class="ch">\&quot;</span><span class="st">5</span><span class="ch">\&quot;</span><span class="st">&gt;&lt;is&gt;&lt;t&gt;&#39; + child[colNames[i]] +&quot;</span>, </a>
<a class="sourceLine" id="cb11-78" title="78">  <span class="st">&quot;            &#39;&lt;/t&gt;&lt;/is&gt;&lt;/c&gt;&#39;;&quot;</span>,</a>
<a class="sourceLine" id="cb11-79" title="79">  <span class="st">&quot;        }&quot;</span>,</a>
<a class="sourceLine" id="cb11-80" title="80">  <span class="st">&quot;        childRow = childRow + &#39;&lt;/row&gt;&#39;;&quot;</span>,</a>
<a class="sourceLine" id="cb11-81" title="81">  <span class="st">&quot;        // Append row to sheetData.&quot;</span>,</a>
<a class="sourceLine" id="cb11-82" title="82">  <span class="st">&quot;        $(&#39;sheetData&#39;, sheet).append(childRow);&quot;</span>,</a>
<a class="sourceLine" id="cb11-83" title="83">  <span class="st">&quot;        rowCount++; // Increment excel row counter.&quot;</span>,</a>
<a class="sourceLine" id="cb11-84" title="84">  <span class="st">&quot;      }&quot;</span>,</a>
<a class="sourceLine" id="cb11-85" title="85">  <span class="st">&quot;      // Just append the header row and increment excel row counter.&quot;</span>,</a>
<a class="sourceLine" id="cb11-86" title="86">  <span class="st">&quot;    } else {&quot;</span>,</a>
<a class="sourceLine" id="cb11-87" title="87">  <span class="st">&quot;      $(&#39;sheetData&#39;, sheet).append(this.outerHTML);&quot;</span>,</a>
<a class="sourceLine" id="cb11-88" title="88">  <span class="st">&quot;      rowCount++;&quot;</span>,</a>
<a class="sourceLine" id="cb11-89" title="89">  <span class="st">&quot;    }&quot;</span>,</a>
<a class="sourceLine" id="cb11-90" title="90">  <span class="st">&quot;  });&quot;</span>,</a>
<a class="sourceLine" id="cb11-91" title="91">  <span class="st">&quot;}&quot;</span></a>
<a class="sourceLine" id="cb11-92" title="92">)</a></code></pre></div>
<p>Let’s see an example.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" title="1">dat0  =<span class="st"> </span>iris[<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>,]         <span class="co"># main table, with three rows</span></a>
<a class="sourceLine" id="cb12-2" title="2">dat01 =<span class="st"> </span>airquality[<span class="dv">1</span><span class="op">:</span><span class="dv">4</span>,]   <span class="co"># |- child of first row</span></a>
<a class="sourceLine" id="cb12-3" title="3">dat02 =<span class="st"> </span>cars[<span class="dv">1</span><span class="op">:</span><span class="dv">2</span>,]         <span class="co"># |- child of second row</span></a>
<a class="sourceLine" id="cb12-4" title="4">dat03 =<span class="st"> </span>PlantGrowth[<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>,]  <span class="co"># |- child of third row</span></a>
<a class="sourceLine" id="cb12-5" title="5">Dat &lt;-<span class="st"> </span><span class="kw">NestedData</span>(</a>
<a class="sourceLine" id="cb12-6" title="6">  <span class="dt">dat =</span> dat0, </a>
<a class="sourceLine" id="cb12-7" title="7">  <span class="dt">children =</span> <span class="kw">list</span>(dat01, dat02, dat03)</a>
<a class="sourceLine" id="cb12-8" title="8">)</a></code></pre></div>
<p>Below is the code generating the table with a button for the exporting. Remember, if you use Shiny, do not set <code>elementId</code>.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb13-1" title="1">dtable &lt;-<span class="st"> </span><span class="kw">datatable</span>(</a>
<a class="sourceLine" id="cb13-2" title="2">  Dat, </a>
<a class="sourceLine" id="cb13-3" title="3">  <span class="dt">callback =</span> callback, <span class="dt">rownames =</span> rowNames, <span class="dt">escape =</span> <span class="op">-</span>colIdx<span class="dv">-1</span>,</a>
<a class="sourceLine" id="cb13-4" title="4">  <span class="dt">extensions =</span> <span class="st">&quot;Buttons&quot;</span>, <span class="dt">elementId =</span> <span class="st">&quot;mytable&quot;</span>,</a>
<a class="sourceLine" id="cb13-5" title="5">  <span class="dt">options =</span> <span class="kw">list</span>(</a>
<a class="sourceLine" id="cb13-6" title="6">    <span class="dt">paging =</span> <span class="ot">FALSE</span>,</a>
<a class="sourceLine" id="cb13-7" title="7">    <span class="dt">searching =</span> <span class="ot">FALSE</span>,</a>
<a class="sourceLine" id="cb13-8" title="8">    <span class="dt">dom =</span> <span class="st">&quot;Bfrtip&quot;</span>,</a>
<a class="sourceLine" id="cb13-9" title="9">    <span class="dt">columnDefs =</span> <span class="kw">list</span>(</a>
<a class="sourceLine" id="cb13-10" title="10">      <span class="kw">list</span>(</a>
<a class="sourceLine" id="cb13-11" title="11">        <span class="dt">visible =</span> <span class="ot">FALSE</span>, </a>
<a class="sourceLine" id="cb13-12" title="12">        <span class="dt">targets =</span> <span class="kw">ncol</span>(Dat)<span class="op">-</span><span class="dv">1</span><span class="op">+</span>colIdx</a>
<a class="sourceLine" id="cb13-13" title="13">      ),</a>
<a class="sourceLine" id="cb13-14" title="14">      <span class="kw">list</span>(</a>
<a class="sourceLine" id="cb13-15" title="15">        <span class="dt">orderable =</span> <span class="ot">FALSE</span>, </a>
<a class="sourceLine" id="cb13-16" title="16">        <span class="dt">className =</span> <span class="st">&quot;details-control&quot;</span>, </a>
<a class="sourceLine" id="cb13-17" title="17">        <span class="dt">targets =</span> colIdx</a>
<a class="sourceLine" id="cb13-18" title="18">      ),</a>
<a class="sourceLine" id="cb13-19" title="19">      <span class="kw">list</span>(</a>
<a class="sourceLine" id="cb13-20" title="20">        <span class="dt">className =</span> <span class="st">&quot;dt-center&quot;</span>, </a>
<a class="sourceLine" id="cb13-21" title="21">        <span class="dt">targets =</span> <span class="st">&quot;_all&quot;</span></a>
<a class="sourceLine" id="cb13-22" title="22">      )</a>
<a class="sourceLine" id="cb13-23" title="23">    ),</a>
<a class="sourceLine" id="cb13-24" title="24">    <span class="dt">buttons =</span> <span class="kw">list</span>(</a>
<a class="sourceLine" id="cb13-25" title="25">      <span class="kw">list</span>(</a>
<a class="sourceLine" id="cb13-26" title="26">        <span class="dt">extend =</span> <span class="st">&quot;excel&quot;</span>,</a>
<a class="sourceLine" id="cb13-27" title="27">        <span class="dt">exportOptions =</span> <span class="kw">list</span>(</a>
<a class="sourceLine" id="cb13-28" title="28">          <span class="dt">orthogonal =</span> <span class="st">&quot;export&quot;</span>, </a>
<a class="sourceLine" id="cb13-29" title="29">          <span class="dt">columns =</span> <span class="dv">0</span><span class="op">:</span>(<span class="kw">ncol</span>(Dat)<span class="op">-</span><span class="dv">2</span>)</a>
<a class="sourceLine" id="cb13-30" title="30">        ),</a>
<a class="sourceLine" id="cb13-31" title="31">        <span class="dt">title =</span> excelTitle,</a>
<a class="sourceLine" id="cb13-32" title="32">        <span class="dt">orientation =</span> <span class="st">&quot;landscape&quot;</span>,</a>
<a class="sourceLine" id="cb13-33" title="33">        <span class="dt">customize =</span> js_customXLSX</a>
<a class="sourceLine" id="cb13-34" title="34">      )</a>
<a class="sourceLine" id="cb13-35" title="35">    )</a>
<a class="sourceLine" id="cb13-36" title="36">  )</a>
<a class="sourceLine" id="cb13-37" title="37">)</a></code></pre></div>
<p>Here is the Excel file one gets:</p>
<p><img src="figures/DTchildRows3.png" /></p>

        </div>


        <div id="footer">
          Site proudly generated by
          <a href="http://jaspervdj.be/hakyll">Hakyll</a>
        </div>

      </div>

    </div>

    <div class="row">
      <div class="col-sm-12">
        <div id="disqus_thread"></div>
        <div class="pagination">
          <ul>
            <li>
              <a href="http://laustep.github.io/stlahblog/">&#171; Back Home</a>
            </li>
          </ul>
        </div>
      </div>
    </div>
    
  </div>

</body>

<script src="/libraries/bootstrap/bootstrap.min.js"></script>
<script>
  var disqus_developer = 1;
  var disqus_shortname = 'stlapblog';
  // required: replace example with your forum shortname
  /* * * DON'T EDIT BELOW THIS LINE * * */
  (function () {
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = 'https://' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] ||
      document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>
<noscript>Please enable JavaScript to view the
  <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a>
</noscript>
<!-- MathJax: Fall back to local if CDN offline but local image fonts are not supported (saves >100MB) -->
<script type="text/x-mathjax-config" src="../libraries/mathjax/config/TeX-MML-AM_CHTML.js"></script>
<!-- <script>
  window.MathJax || document.write('<script type="text/x-mathjax-config">MathJax.Hub.Config({"HTML-CSS":{imageFont:null}});<\/script><script src="../libraries/mathjax/MathJax.js"><\/script>');
</script> -->

  <!-- Google Prettify -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prettify/188.0.0/prettify.js"></script>
  <!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/prettify/r298/prettify.js"></script> -->
  <script src="/libraries/highlighters/prettify/js/lang-r.js"></script>
  <script>
    var pres = document.getElementsByTagName("pre");
    for (var i = 0; i < pres.length; ++i) {
      
        pres[i].className = pres[i].className + " prettyprint linenums";
      
    }
    prettyPrint();
  </script> 


</html>]]></description>
    <pubDate>Fri, 08 May 2020 00:00:00 UT</pubDate>
    <guid>https://laustep.github.io/stlahblog/posts/DT_childTables.html</guid>
    <dc:creator>Stéphane Laurent</dc:creator>
    
        <category>R</category>
    
</item><item>
    <title>Focal quadrics and their lines of curvature</title>
    <link>https://laustep.github.io/stlahblog/posts/focalQuadrics.html</link>
    <description><![CDATA[<!DOCTYPE HTML>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Saturn Elephant - Focal quadrics and their lines of curvature</title>
  <link href="/libraries/bootstrap/bootstrap-grid.min.css" rel="stylesheet">
  <link rel="stylesheet" href="/css/post.css" />
  <link rel="stylesheet" href="/css/misc.css" /> 
  
    <link rel="stylesheet" href="/css/pandoc-solarized.css" /> 
   
  
    <link href="/libraries/highlighters/prettify/css/minimal.css" rel="stylesheet"> 
  
  <link href="https://fonts.googleapis.com/css?family=Raleway:400,600,200,800" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/css?family=Droid+Sans" rel="stylesheet" type="text/css">
  <script src="/libraries/jquery.min.js"></script>
  <script type="text/javascript" async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML"></script>
</head>

<body>
  <div class="container-fluid">
    <div class="row">
      <!-- Sidebar. -->
      <div class="sidebar col-sm-3">
        <div style="float:right;clear:both;margin-right:50px;margin-top:150px;">
          <a href="https://www.r-bloggers.com/">
            <img src="https://www.r-bloggers.com/wp-content/uploads/2016/04/R_02_2016-05-01.png" alt="stla" width="100%" />
          </a>
          <br/>
          <a href="http://t-redactyl.io/">
            <span style="color:black;font-weight:bold;font-family:sans-serif;font-size:29px;">Standard error</span>
          </a>
          <a href="http://timelyportfolio.blogspot.be/">
            <span style="color:grey;font-weight:bold;font-family:sans-serif;font-size:27px;">Timely portfolio</span>
          </a>
          <br/>
          <a href="https://antoineguillot.wordpress.com/blog/">
            <span style="color:white;background-color:darkblue;font-weight:bold;font-family:sans-serif;font-size:25px;border:5px solid;border-color:darkblue">ENHANCE DATA</span>
          </a>
          <br/>
          <a href="https://fronkonstin.com/">
            <span style="color:black;background-color:gold;font-weight:bold;font-size:32px;border:3px solid;border-color:gold;">Fronkonstin</span>
          </a>
        </div>
      </div>

      <div class="main col-sm-9">
        <div id="header">
          <div id="logo" style="position:absolute;">
            <a href="/">
              <img src="../images/stla.jpg" alt="stla" width="100px" />
            </a>
          </div>
          <div id="navigation" style="margin-top:50px;">
            <a href="/">Home</a>
            <a href="/about.html">About</a>
            <a href="/contact.html">Contact</a>
            <a href="/archive.html">Archive</a>
          </div>
        </div>

        <div class="content">
          <h1>Focal quadrics and their lines of curvature</h1> 
          <div class="info">
    Posted on May  3, 2020
    
        by Stéphane Laurent
    
</div>
<div class="info">
    
    Tags: <a href="/tags/R.html">R</a>, <a href="/tags/graphics.html">graphics</a>, <a href="/tags/rgl.html">rgl</a>, <a href="/tags/geometry.html">geometry</a>, <a href="/tags/maths.html">maths</a>
    
</div>

<p>This blog post provides some R code for drawing focal quadrics and their curvatures lines with the <code>rgl</code> package.</p>
<h1 id="ellipsoid">Ellipsoid</h1>
<p>The <code>ellipsoidMesh</code> function below generates a mesh of the ellipsoid of equation <span class="math display">\[
\frac{x^2}{a^2} + \frac{y^2}{b^2} + \frac{z^2}{c^2} = 1.
\]</span></p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" title="1"><span class="kw">library</span>(rgl)</a>
<a class="sourceLine" id="cb1-2" title="2">ellipsoidMesh &lt;-<span class="st"> </span><span class="cf">function</span>(a, b, c, <span class="dt">smoothness =</span> <span class="dv">5</span>){</a>
<a class="sourceLine" id="cb1-3" title="3">  <span class="kw">stopifnot</span>(a <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>, b <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>, c <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>)</a>
<a class="sourceLine" id="cb1-4" title="4">  sphere &lt;-<span class="st"> </span><span class="kw">subdivision3d</span>(<span class="kw">icosahedron3d</span>(), <span class="dt">depth =</span> smoothness)</a>
<a class="sourceLine" id="cb1-5" title="5">  sphere<span class="op">$</span>vb[4L,] &lt;-<span class="st"> </span></a>
<a class="sourceLine" id="cb1-6" title="6"><span class="st">    </span><span class="kw">apply</span>(sphere<span class="op">$</span>vb[1L<span class="op">:</span>3L,], 2L, <span class="cf">function</span>(x) <span class="kw">sqrt</span>(<span class="kw">sum</span>(x<span class="op">*</span>x)))</a>
<a class="sourceLine" id="cb1-7" title="7">  sphere<span class="op">$</span>normals &lt;-<span class="st"> </span>sphere<span class="op">$</span>vb</a>
<a class="sourceLine" id="cb1-8" title="8">  <span class="kw">scale3d</span>(sphere, a, b, c)</a>
<a class="sourceLine" id="cb1-9" title="9">}</a></code></pre></div>
<p>The curvature lines of this ellipsoid are generated by the function <code>curvatureLinesE</code> given below. There are two families of curvature lines. The arguments <code>nu</code> and <code>nv</code> control the numbers of curvature lines in these two families. When the ellipsoid is tri-axial, <em>i.e.</em> when <span class="math inline">\(a\)</span>, <span class="math inline">\(b\)</span>, <span class="math inline">\(c\)</span> are distinct, the arguments <code>du</code> and <code>dv</code> must be positive and they control the size of the smallest curvature lines (if they were <span class="math inline">\(0\)</span>, the smallest curvature lines would degenerate to segments). When the ellipsoid is an ellipsoid of revolution, <em>i.e.</em> when two values of <span class="math inline">\(a\)</span>, <span class="math inline">\(b\)</span>, <span class="math inline">\(c\)</span> are equal, the curvature lines are the meridians and the parallels; in this case, <code>du</code> is ignored, and <code>dv</code>, which must be positive and strictly smaller than <span class="math inline">\(\frac{\pi}{2}\)</span>, control the size of the smallest parallel.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" title="1">curvatureLinesE &lt;-<span class="st"> </span><span class="cf">function</span>(a, b, c, nu, nv, du, dv, <span class="dt">npoints =</span> <span class="dv">100</span>){</a>
<a class="sourceLine" id="cb2-2" title="2">  <span class="kw">stopifnot</span>(a <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>, b <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>, c <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>)</a>
<a class="sourceLine" id="cb2-3" title="3">  <span class="cf">if</span>((a <span class="op">!=</span><span class="st"> </span>b <span class="op">&amp;&amp;</span><span class="st"> </span>b <span class="op">!=</span><span class="st"> </span>c) <span class="op">&amp;&amp;</span><span class="st"> </span>(a <span class="op">&lt;</span><span class="st"> </span>b <span class="op">||</span><span class="st"> </span>b <span class="op">&lt;</span><span class="st"> </span>c)){</a>
<a class="sourceLine" id="cb2-4" title="4">    perm &lt;-<span class="st"> </span><span class="kw">order</span>(<span class="kw">c</span>(a,b,c), <span class="dt">decreasing =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb2-5" title="5">    abc &lt;-<span class="st"> </span><span class="kw">c</span>(a,b,c)[perm]</a>
<a class="sourceLine" id="cb2-6" title="6">    clines &lt;-<span class="st"> </span></a>
<a class="sourceLine" id="cb2-7" title="7"><span class="st">      </span><span class="kw">curvatureLinesE</span>(abc[1L], abc[2L], abc[3L], nu, nv, du, dv, npoints)</a>
<a class="sourceLine" id="cb2-8" title="8">    <span class="kw">return</span>(<span class="kw">lapply</span>(clines, <span class="cf">function</span>(l) l[, perm]))</a>
<a class="sourceLine" id="cb2-9" title="9">  }</a>
<a class="sourceLine" id="cb2-10" title="10">  <span class="cf">if</span>(a <span class="op">!=</span><span class="st"> </span>b <span class="op">&amp;&amp;</span><span class="st"> </span>b <span class="op">!=</span><span class="st"> </span>c){</a>
<a class="sourceLine" id="cb2-11" title="11">    <span class="kw">stopifnot</span>(du <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>, dv <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>)</a>
<a class="sourceLine" id="cb2-12" title="12">    a2 &lt;-<span class="st"> </span>a<span class="op">^</span><span class="dv">2</span>; b2 &lt;-<span class="st"> </span>b<span class="op">^</span><span class="dv">2</span>; c2 &lt;-<span class="st"> </span>c<span class="op">^</span><span class="dv">2</span></a>
<a class="sourceLine" id="cb2-13" title="13">    h2ab &lt;-<span class="st"> </span>a2 <span class="op">-</span><span class="st"> </span>b2; h2ac &lt;-<span class="st"> </span>a2 <span class="op">-</span><span class="st"> </span>c2; h2bc &lt;-<span class="st"> </span>b2 <span class="op">-</span><span class="st"> </span>c2</a>
<a class="sourceLine" id="cb2-14" title="14">    <span class="cf">if</span>(du <span class="op">&gt;=</span><span class="st"> </span>h2ab) <span class="kw">stop</span>(<span class="st">&quot;`du` is too large.&quot;</span>)</a>
<a class="sourceLine" id="cb2-15" title="15">    <span class="cf">if</span>(dv <span class="op">&gt;=</span><span class="st"> </span>h2bc) <span class="kw">stop</span>(<span class="st">&quot;`dv` is too large.&quot;</span>)</a>
<a class="sourceLine" id="cb2-16" title="16">    out &lt;-<span class="st"> </span><span class="kw">vector</span>(<span class="st">&quot;list&quot;</span>, <span class="dv">2</span><span class="op">*</span>nv<span class="dv">-1</span> <span class="op">+</span><span class="st"> </span><span class="dv">2</span><span class="op">*</span>nu<span class="dv">-1</span>)</a>
<a class="sourceLine" id="cb2-17" title="17">    u_ &lt;-<span class="st"> </span><span class="kw">seq</span>(b2<span class="op">+</span>du, a2, <span class="dt">length.out =</span> nu)</a>
<a class="sourceLine" id="cb2-18" title="18">    s_ &lt;-<span class="st"> </span><span class="kw">seq</span>(b2, a2, <span class="dt">length.out =</span> npoints)</a>
<a class="sourceLine" id="cb2-19" title="19">    v_ &lt;-<span class="st"> </span><span class="kw">seq</span>(c2, b2<span class="op">-</span>dv, <span class="dt">length.out =</span> nv) </a>
<a class="sourceLine" id="cb2-20" title="20">    t_ &lt;-<span class="st"> </span><span class="kw">seq</span>(c2, b2, <span class="dt">length.out =</span> npoints)</a>
<a class="sourceLine" id="cb2-21" title="21">    mx &lt;-<span class="st"> </span>a <span class="op">/</span><span class="st"> </span><span class="kw">sqrt</span>(h2ac<span class="op">*</span>h2ab)</a>
<a class="sourceLine" id="cb2-22" title="22">    my &lt;-<span class="st"> </span>b <span class="op">/</span><span class="st"> </span><span class="kw">sqrt</span>(h2bc<span class="op">*</span>h2ab)</a>
<a class="sourceLine" id="cb2-23" title="23">    mz &lt;-<span class="st"> </span>c <span class="op">/</span><span class="st"> </span><span class="kw">sqrt</span>(h2bc<span class="op">*</span>h2ac)</a>
<a class="sourceLine" id="cb2-24" title="24">    <span class="cf">for</span>(j <span class="cf">in</span> 1L<span class="op">:</span>nv){</a>
<a class="sourceLine" id="cb2-25" title="25">      x &lt;-<span class="st"> </span>mx <span class="op">*</span><span class="st"> </span><span class="kw">sqrt</span>((a2<span class="op">-</span>s_)<span class="op">*</span>(a2<span class="op">-</span>v_[j]))</a>
<a class="sourceLine" id="cb2-26" title="26">      y &lt;-<span class="st"> </span>my <span class="op">*</span><span class="st"> </span><span class="kw">sqrt</span>((s_<span class="op">-</span>b2)<span class="op">*</span>(b2<span class="op">-</span>v_[j]))</a>
<a class="sourceLine" id="cb2-27" title="27">      z &lt;-<span class="st"> </span>mz <span class="op">*</span><span class="st"> </span><span class="kw">sqrt</span>((s_<span class="op">-</span>c2)<span class="op">*</span>(v_[j]<span class="op">-</span>c2))</a>
<a class="sourceLine" id="cb2-28" title="28">      M &lt;-<span class="st"> </span><span class="kw">rbind</span>(<span class="kw">cbind</span>(x, y, z), <span class="kw">cbind</span>(<span class="op">-</span>x, y, z)[(npoints<span class="dv">-1</span>)<span class="op">:</span>1L,])</a>
<a class="sourceLine" id="cb2-29" title="29">      M &lt;-<span class="st"> </span><span class="kw">rbind</span>(M, <span class="kw">cbind</span>(M[,1L], <span class="op">-</span>M[,2L], M[,3L])[(<span class="dv">2</span><span class="op">*</span>npoints<span class="dv">-2</span>)<span class="op">:</span>1L,])</a>
<a class="sourceLine" id="cb2-30" title="30">      out[[j]] &lt;-<span class="st"> </span>M</a>
<a class="sourceLine" id="cb2-31" title="31">      <span class="cf">if</span>(j <span class="op">&gt;</span><span class="st"> </span>1L){</a>
<a class="sourceLine" id="cb2-32" title="32">        out[[nv<span class="op">+</span>j<span class="dv">-1</span>]] &lt;-<span class="st"> </span><span class="kw">cbind</span>(M[,<span class="kw">c</span>(1L,2L)], <span class="op">-</span>M[,3L])</a>
<a class="sourceLine" id="cb2-33" title="33">      }</a>
<a class="sourceLine" id="cb2-34" title="34">    }</a>
<a class="sourceLine" id="cb2-35" title="35">    <span class="cf">for</span>(i <span class="cf">in</span> 1L<span class="op">:</span>nu){</a>
<a class="sourceLine" id="cb2-36" title="36">      x &lt;-<span class="st"> </span>mx <span class="op">*</span><span class="st"> </span><span class="kw">sqrt</span>((a2<span class="op">-</span>u_[i])<span class="op">*</span>(a2<span class="op">-</span>t_))</a>
<a class="sourceLine" id="cb2-37" title="37">      y &lt;-<span class="st"> </span>my <span class="op">*</span><span class="st"> </span><span class="kw">sqrt</span>((u_[i]<span class="op">-</span>b2)<span class="op">*</span>(b2<span class="op">-</span>t_))</a>
<a class="sourceLine" id="cb2-38" title="38">      z &lt;-<span class="st"> </span>mz <span class="op">*</span><span class="st"> </span><span class="kw">sqrt</span>((u_[i]<span class="op">-</span>c2)<span class="op">*</span>(t_<span class="op">-</span>c2))</a>
<a class="sourceLine" id="cb2-39" title="39">      M &lt;-<span class="st"> </span><span class="kw">rbind</span>(<span class="kw">cbind</span>(x, y, z), <span class="kw">cbind</span>(x, <span class="op">-</span>y, z)[(npoints<span class="dv">-1</span>)<span class="op">:</span>1L,])</a>
<a class="sourceLine" id="cb2-40" title="40">      M &lt;-<span class="st"> </span><span class="kw">rbind</span>(M, <span class="kw">cbind</span>(M[,<span class="kw">c</span>(1L,2L)], <span class="op">-</span>M[,3L])[(<span class="dv">2</span><span class="op">*</span>npoints<span class="dv">-2</span>)<span class="op">:</span>1L,])</a>
<a class="sourceLine" id="cb2-41" title="41">      out[[<span class="dv">2</span><span class="op">*</span>nv<span class="dv">-1</span><span class="op">+</span>i]] &lt;-<span class="st"> </span>M</a>
<a class="sourceLine" id="cb2-42" title="42">      <span class="cf">if</span>(i <span class="op">&lt;</span><span class="st"> </span>nu){</a>
<a class="sourceLine" id="cb2-43" title="43">        out[[<span class="dv">2</span><span class="op">*</span>nv<span class="dv">-1</span><span class="op">+</span>nu<span class="op">+</span>i]] &lt;-<span class="st"> </span><span class="kw">cbind</span>(<span class="op">-</span>M[,1L], M[,<span class="kw">c</span>(2L,3L)])</a>
<a class="sourceLine" id="cb2-44" title="44">      }</a>
<a class="sourceLine" id="cb2-45" title="45">    }</a>
<a class="sourceLine" id="cb2-46" title="46">  }<span class="cf">else</span>{ <span class="co"># a == b || b == c </span></a>
<a class="sourceLine" id="cb2-47" title="47">    <span class="co"># surface of revolution =&gt; curvature lines are meridians and parallels</span></a>
<a class="sourceLine" id="cb2-48" title="48">    <span class="kw">stopifnot</span>(dv <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>, dv <span class="op">&lt;</span><span class="st"> </span>pi<span class="op">/</span><span class="dv">2</span>)</a>
<a class="sourceLine" id="cb2-49" title="49">    out &lt;-<span class="st"> </span><span class="kw">vector</span>(<span class="st">&quot;list&quot;</span>, nu <span class="op">+</span><span class="st"> </span>nv)</a>
<a class="sourceLine" id="cb2-50" title="50">    u_ &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="dv">0</span>, <span class="dv">2</span><span class="op">*</span>pi, <span class="dt">length.out =</span> nu<span class="op">+</span><span class="dv">1</span>)[<span class="op">-</span>1L]</a>
<a class="sourceLine" id="cb2-51" title="51">    s_ &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="dv">0</span>, <span class="dv">2</span><span class="op">*</span>pi, <span class="dt">length.out =</span> npoints)</a>
<a class="sourceLine" id="cb2-52" title="52">    v_ &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="op">-</span>pi<span class="op">/</span><span class="dv">2</span><span class="op">+</span>dv, pi<span class="op">/</span><span class="dv">2</span><span class="op">-</span>dv, <span class="dt">length.out =</span> nv) </a>
<a class="sourceLine" id="cb2-53" title="53">    t_ &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="op">-</span>pi, pi, <span class="dt">length.out =</span> npoints)</a>
<a class="sourceLine" id="cb2-54" title="54">    coss_ &lt;-<span class="st"> </span><span class="kw">cos</span>(s_); sins_ &lt;-<span class="st"> </span><span class="kw">sin</span>(s_)</a>
<a class="sourceLine" id="cb2-55" title="55">    cost_ &lt;-<span class="st"> </span><span class="kw">cos</span>(t_); sint_ &lt;-<span class="st"> </span><span class="kw">sin</span>(t_)</a>
<a class="sourceLine" id="cb2-56" title="56">    <span class="cf">for</span>(j <span class="cf">in</span> 1L<span class="op">:</span>nv){</a>
<a class="sourceLine" id="cb2-57" title="57">      x &lt;-<span class="st"> </span>a <span class="op">*</span><span class="st"> </span>coss_ <span class="op">*</span><span class="st"> </span><span class="kw">cos</span>(v_[j])</a>
<a class="sourceLine" id="cb2-58" title="58">      y &lt;-<span class="st"> </span>b <span class="op">*</span><span class="st"> </span>sins_ <span class="op">*</span><span class="st"> </span><span class="kw">cos</span>(v_[j])</a>
<a class="sourceLine" id="cb2-59" title="59">      z &lt;-<span class="st"> </span>c <span class="op">*</span><span class="st"> </span><span class="kw">sin</span>(v_[j])</a>
<a class="sourceLine" id="cb2-60" title="60">      out[[j]] &lt;-<span class="st"> </span><span class="kw">cbind</span>(x, y, z)</a>
<a class="sourceLine" id="cb2-61" title="61">    }</a>
<a class="sourceLine" id="cb2-62" title="62">    <span class="cf">for</span>(i <span class="cf">in</span> 1L<span class="op">:</span>nu){</a>
<a class="sourceLine" id="cb2-63" title="63">      x &lt;-<span class="st"> </span>a <span class="op">*</span><span class="st"> </span><span class="kw">cos</span>(u_[i]) <span class="op">*</span><span class="st"> </span>cost_</a>
<a class="sourceLine" id="cb2-64" title="64">      y &lt;-<span class="st"> </span>b <span class="op">*</span><span class="st"> </span><span class="kw">sin</span>(u_[i]) <span class="op">*</span><span class="st"> </span>cost_</a>
<a class="sourceLine" id="cb2-65" title="65">      z &lt;-<span class="st"> </span>c <span class="op">*</span><span class="st"> </span>sint_</a>
<a class="sourceLine" id="cb2-66" title="66">      out[[nv<span class="op">+</span>i]] &lt;-<span class="st"> </span><span class="kw">cbind</span>(x, y, z)</a>
<a class="sourceLine" id="cb2-67" title="67">    }</a>
<a class="sourceLine" id="cb2-68" title="68">  }</a>
<a class="sourceLine" id="cb2-69" title="69">  out</a>
<a class="sourceLine" id="cb2-70" title="70">}</a></code></pre></div>
<p>Here is an example:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" title="1">a =<span class="st"> </span><span class="dv">7</span>; b =<span class="st"> </span><span class="dv">5</span>; c =<span class="st"> </span><span class="dv">3</span></a>
<a class="sourceLine" id="cb3-2" title="2">mesh &lt;-<span class="st"> </span><span class="kw">ellipsoidMesh</span>(a, b, c)</a>
<a class="sourceLine" id="cb3-3" title="3">clines &lt;-<span class="st"> </span><span class="kw">curvatureLinesE</span>(a, b, c, <span class="dt">nu =</span> <span class="dv">5</span>, <span class="dt">nv =</span> <span class="dv">5</span>, <span class="dt">du =</span> <span class="fl">0.4</span>, <span class="dt">dv =</span> <span class="dv">1</span>, </a>
<a class="sourceLine" id="cb3-4" title="4">                          <span class="dt">npoints =</span> <span class="dv">300</span>)</a>
<a class="sourceLine" id="cb3-5" title="5"><span class="kw">shade3d</span>(mesh, <span class="dt">col =</span> <span class="st">&quot;springgreen&quot;</span>)</a>
<a class="sourceLine" id="cb3-6" title="6"><span class="kw">invisible</span>(<span class="kw">lapply</span>(clines, <span class="cf">function</span>(l){</a>
<a class="sourceLine" id="cb3-7" title="7">  <span class="kw">shade3d</span>(<span class="kw">cylinder3d</span>(l, <span class="dt">radius =</span> <span class="fl">0.08</span>, <span class="dt">sides =</span> <span class="dv">30</span>))</a>
<a class="sourceLine" id="cb3-8" title="8">}))</a></code></pre></div>
<p><img src="figures/quadrics_E.png" /></p>
<h1 id="one-sheeted-hyperboloid">One-sheeted hyperboloid</h1>
<p>There are three types of one-sheeted hyperboloids, corresponding to these equations: <span class="math display">\[
\frac{x^2}{a^2} + \frac{y^2}{b^2} - \frac{z^2}{c^2} = 1 \\
\frac{x^2}{a^2} - \frac{y^2}{b^2} + \frac{z^2}{c^2} = 1 \\
-\frac{x^2}{a^2} + \frac{y^2}{b^2} + \frac{z^2}{c^2} = 1.
\]</span> The <code>hyperboloidMesh</code> function below generates a mesh of the one-sheeted hyperboloid; the <code>signature</code> argument corresponds to one of the above equations, it must be <code>"++-"</code>, <code>"+-+"</code> or <code>"-++"</code>. The mesh is made of quadrilaterals and their number is controlled by the arguments <code>nu</code> and <code>nv</code>. The hyperboloid is infinite along the direction corresponding to the minus sign, and the argument <code>vmin</code> controls the truncation of the hyperboloid in this direction.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" title="1">hyperboloidMesh &lt;-<span class="st"> </span><span class="cf">function</span>(a, b, c, signature, nu, nv, vmin){</a>
<a class="sourceLine" id="cb4-2" title="2">  <span class="kw">stopifnot</span>(signature <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;++-&quot;</span>, <span class="st">&quot;+-+&quot;</span>, <span class="st">&quot;-++&quot;</span>))</a>
<a class="sourceLine" id="cb4-3" title="3">  <span class="kw">stopifnot</span>(vmin <span class="op">&lt;</span><span class="st"> </span><span class="dv">1</span>, a <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>, b <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>, c <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>)</a>
<a class="sourceLine" id="cb4-4" title="4">  <span class="cf">if</span>(signature <span class="op">==</span><span class="st"> &quot;+-+&quot;</span>){</a>
<a class="sourceLine" id="cb4-5" title="5">    mesh &lt;-<span class="st"> </span><span class="kw">hyperboloidMesh</span>(a, c, b, <span class="st">&quot;++-&quot;</span>, nu, nv, vmin)</a>
<a class="sourceLine" id="cb4-6" title="6">    mesh<span class="op">$</span>vb &lt;-<span class="st"> </span>mesh<span class="op">$</span>vb[<span class="kw">c</span>(1L,3L,2L,4L),]</a>
<a class="sourceLine" id="cb4-7" title="7">    mesh<span class="op">$</span>normals &lt;-<span class="st"> </span>mesh<span class="op">$</span>normals[<span class="kw">c</span>(1L,3L,2L),]</a>
<a class="sourceLine" id="cb4-8" title="8">    mesh<span class="op">$</span>ib &lt;-<span class="st"> </span>mesh<span class="op">$</span>ib[4L<span class="op">:</span>1L,]</a>
<a class="sourceLine" id="cb4-9" title="9">    <span class="kw">return</span>(mesh)</a>
<a class="sourceLine" id="cb4-10" title="10">  }<span class="cf">else</span> <span class="cf">if</span>(signature <span class="op">==</span><span class="st"> &quot;-++&quot;</span>){</a>
<a class="sourceLine" id="cb4-11" title="11">    mesh &lt;-<span class="st"> </span><span class="kw">hyperboloidMesh</span>(c, b, a, <span class="st">&quot;++-&quot;</span>, nu, nv, vmin)</a>
<a class="sourceLine" id="cb4-12" title="12">    mesh<span class="op">$</span>vb &lt;-<span class="st"> </span>mesh<span class="op">$</span>vb[<span class="kw">c</span>(3L,2L,1L,4L),]</a>
<a class="sourceLine" id="cb4-13" title="13">    mesh<span class="op">$</span>normals &lt;-<span class="st"> </span>mesh<span class="op">$</span>normals[<span class="kw">c</span>(3L,2L,1L),]</a>
<a class="sourceLine" id="cb4-14" title="14">    mesh<span class="op">$</span>ib &lt;-<span class="st"> </span>mesh<span class="op">$</span>ib[4L<span class="op">:</span>1L,]</a>
<a class="sourceLine" id="cb4-15" title="15">    <span class="kw">return</span>(mesh)</a>
<a class="sourceLine" id="cb4-16" title="16">  }</a>
<a class="sourceLine" id="cb4-17" title="17">  c0 &lt;-<span class="st"> </span>c</a>
<a class="sourceLine" id="cb4-18" title="18">  <span class="cf">if</span>(b <span class="op">&gt;</span><span class="st"> </span>a){</a>
<a class="sourceLine" id="cb4-19" title="19">    exchange &lt;-<span class="st"> </span><span class="ot">TRUE</span></a>
<a class="sourceLine" id="cb4-20" title="20">    a0 &lt;-<span class="st"> </span>b; b0 &lt;-<span class="st"> </span>a</a>
<a class="sourceLine" id="cb4-21" title="21">  }<span class="cf">else</span>{</a>
<a class="sourceLine" id="cb4-22" title="22">    exchange &lt;-<span class="st"> </span><span class="ot">FALSE</span></a>
<a class="sourceLine" id="cb4-23" title="23">    a0 &lt;-<span class="st"> </span>a; b0 &lt;-<span class="st"> </span>b</a>
<a class="sourceLine" id="cb4-24" title="24">  }</a>
<a class="sourceLine" id="cb4-25" title="25">  Mu2 &lt;-<span class="st"> </span>a0<span class="op">^</span><span class="dv">2</span></a>
<a class="sourceLine" id="cb4-26" title="26">  h2ab &lt;-<span class="st"> </span>Mu2 <span class="op">-</span><span class="st"> </span>b0<span class="op">^</span><span class="dv">2</span>; h2ac &lt;-<span class="st"> </span>c0<span class="op">^</span><span class="dv">2</span> <span class="op">+</span><span class="st"> </span>Mu2</a>
<a class="sourceLine" id="cb4-27" title="27">  c2 &lt;-<span class="st"> </span><span class="dv">1</span>; a2 &lt;-<span class="st"> </span>c2 <span class="op">+</span><span class="st"> </span>h2ac; b2 &lt;-<span class="st"> </span>a2 <span class="op">-</span><span class="st"> </span>h2ab</a>
<a class="sourceLine" id="cb4-28" title="28">  h2bc &lt;-<span class="st"> </span>b2 <span class="op">-</span><span class="st"> </span>c2</a>
<a class="sourceLine" id="cb4-29" title="29">  <span class="co">#</span></a>
<a class="sourceLine" id="cb4-30" title="30">  vertices &lt;-<span class="st"> </span>Normals &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="ot">NA_real_</span>, <span class="dt">nrow =</span> 3L, <span class="dt">ncol =</span> nu<span class="op">*</span>nv)</a>
<a class="sourceLine" id="cb4-31" title="31">  indices &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="ot">NA_integer_</span>, <span class="dt">nrow =</span> 4L, <span class="dt">ncol =</span> (nu<span class="dv">-1</span>)<span class="op">*</span>(nv<span class="dv">-1</span>))</a>
<a class="sourceLine" id="cb4-32" title="32">  v_ &lt;-<span class="st"> </span><span class="kw">seq</span>(vmin, c2, <span class="dt">length.out =</span> nv)</a>
<a class="sourceLine" id="cb4-33" title="33">  <span class="co">#</span></a>
<a class="sourceLine" id="cb4-34" title="34">  <span class="cf">if</span>(a0 <span class="op">!=</span><span class="st"> </span>b0){</a>
<a class="sourceLine" id="cb4-35" title="35">    u_ &lt;-<span class="st"> </span><span class="kw">seq</span>(b2, a2, <span class="dt">length.out =</span> nu)</a>
<a class="sourceLine" id="cb4-36" title="36">    x &lt;-<span class="st"> </span>a0 <span class="op">/</span><span class="st"> </span><span class="kw">sqrt</span>(h2ac<span class="op">*</span>h2ab) <span class="op">*</span><span class="st"> </span><span class="kw">sqrt</span>(a2<span class="op">-</span>u_)</a>
<a class="sourceLine" id="cb4-37" title="37">    y &lt;-<span class="st"> </span>b0 <span class="op">/</span><span class="st"> </span><span class="kw">sqrt</span>(h2bc<span class="op">*</span>h2ab) <span class="op">*</span><span class="st"> </span><span class="kw">sqrt</span>(u_<span class="op">-</span>b2)</a>
<a class="sourceLine" id="cb4-38" title="38">    z &lt;-<span class="st"> </span>c0 <span class="op">/</span><span class="st"> </span><span class="kw">sqrt</span>(h2bc<span class="op">*</span>h2ac) <span class="op">*</span><span class="st"> </span><span class="kw">sqrt</span>(u_<span class="op">-</span>c2)</a>
<a class="sourceLine" id="cb4-39" title="39">  }<span class="cf">else</span>{</a>
<a class="sourceLine" id="cb4-40" title="40">    u_ &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="dv">0</span>, <span class="dv">2</span><span class="op">*</span>pi, <span class="dt">length.out =</span> nu<span class="op">+</span><span class="dv">1</span>)[<span class="op">-</span>1L]</a>
<a class="sourceLine" id="cb4-41" title="41">    z &lt;-<span class="st"> </span><span class="kw">rep</span>(c0<span class="op">/</span><span class="kw">sqrt</span>(h2ac), nu)</a>
<a class="sourceLine" id="cb4-42" title="42">    mxy &lt;-<span class="st"> </span>a0 <span class="op">/</span><span class="st"> </span><span class="kw">sqrt</span>(h2ac)</a>
<a class="sourceLine" id="cb4-43" title="43">    x &lt;-<span class="st"> </span>mxy <span class="op">*</span><span class="st"> </span><span class="kw">cos</span>(u_)</a>
<a class="sourceLine" id="cb4-44" title="44">    y &lt;-<span class="st"> </span>mxy <span class="op">*</span><span class="st"> </span><span class="kw">sin</span>(u_)</a>
<a class="sourceLine" id="cb4-45" title="45">  }</a>
<a class="sourceLine" id="cb4-46" title="46">  <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>nu){</a>
<a class="sourceLine" id="cb4-47" title="47">    <span class="cf">for</span>(j <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>nv){</a>
<a class="sourceLine" id="cb4-48" title="48">      P &lt;-<span class="st"> </span>vertices[, (i<span class="dv">-1</span>)<span class="op">*</span>nv<span class="op">+</span>j] &lt;-<span class="st"> </span><span class="kw">c</span>(</a>
<a class="sourceLine" id="cb4-49" title="49">        x[i] <span class="op">*</span><span class="st"> </span><span class="kw">sqrt</span>(a2<span class="op">-</span>v_[j]),</a>
<a class="sourceLine" id="cb4-50" title="50">        y[i] <span class="op">*</span><span class="st"> </span><span class="kw">sqrt</span>(b2<span class="op">-</span>v_[j]),</a>
<a class="sourceLine" id="cb4-51" title="51">        z[i] <span class="op">*</span><span class="st"> </span><span class="kw">sqrt</span>(c2<span class="op">-</span>v_[j])</a>
<a class="sourceLine" id="cb4-52" title="52">      )</a>
<a class="sourceLine" id="cb4-53" title="53">      Normals[, (i<span class="dv">-1</span>)<span class="op">*</span>nv<span class="op">+</span>j] &lt;-<span class="st"> </span><span class="kw">c</span>(P[1L]<span class="op">/</span>a0<span class="op">^</span><span class="dv">2</span>, P[2L]<span class="op">/</span>b0<span class="op">^</span><span class="dv">2</span>, <span class="op">-</span>P[3L]<span class="op">/</span>c0<span class="op">^</span><span class="dv">2</span>)</a>
<a class="sourceLine" id="cb4-54" title="54">    }</a>
<a class="sourceLine" id="cb4-55" title="55">  }</a>
<a class="sourceLine" id="cb4-56" title="56">  <span class="co"># quads</span></a>
<a class="sourceLine" id="cb4-57" title="57">  <span class="cf">for</span>(i <span class="cf">in</span> 1L<span class="op">:</span>(nu<span class="dv">-1</span>)){</a>
<a class="sourceLine" id="cb4-58" title="58">    im1 &lt;-<span class="st"> </span>i<span class="op">-</span>1L</a>
<a class="sourceLine" id="cb4-59" title="59">    <span class="cf">for</span>(j <span class="cf">in</span> 1L<span class="op">:</span>(nv<span class="dv">-1</span>)){</a>
<a class="sourceLine" id="cb4-60" title="60">      jp1 &lt;-<span class="st"> </span>j<span class="op">+</span>1L</a>
<a class="sourceLine" id="cb4-61" title="61">      quad &lt;-<span class="st"> </span><span class="kw">c</span>(im1<span class="op">*</span>nv<span class="op">+</span>j, im1<span class="op">*</span>nv<span class="op">+</span>jp1, i<span class="op">*</span>nv<span class="op">+</span>jp1, i<span class="op">*</span>nv<span class="op">+</span>j)</a>
<a class="sourceLine" id="cb4-62" title="62">      indices[, im1<span class="op">*</span>(nv<span class="dv">-1</span>)<span class="op">+</span>j] &lt;-<span class="st"> </span><span class="cf">if</span>(exchange) <span class="kw">rev</span>(quad) <span class="cf">else</span> quad</a>
<a class="sourceLine" id="cb4-63" title="63">    }</a>
<a class="sourceLine" id="cb4-64" title="64">  }</a>
<a class="sourceLine" id="cb4-65" title="65">  vertices &lt;-<span class="st"> </span><span class="kw">cbind</span>(vertices, <span class="kw">c</span>(<span class="op">-</span><span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>) <span class="op">*</span><span class="st"> </span>vertices)</a>
<a class="sourceLine" id="cb4-66" title="66">  indices &lt;-<span class="st"> </span><span class="kw">cbind</span>(indices, indices[4L<span class="op">:</span>1L,] <span class="op">+</span><span class="st"> </span>nu<span class="op">*</span>nv)</a>
<a class="sourceLine" id="cb4-67" title="67">  Normals &lt;-<span class="st"> </span><span class="kw">cbind</span>(Normals, <span class="kw">c</span>(<span class="op">-</span><span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>) <span class="op">*</span><span class="st"> </span>Normals)</a>
<a class="sourceLine" id="cb4-68" title="68">  vertices &lt;-<span class="st"> </span><span class="kw">cbind</span>(vertices, <span class="kw">c</span>(<span class="dv">1</span>,<span class="op">-</span><span class="dv">1</span>,<span class="dv">1</span>) <span class="op">*</span><span class="st"> </span>vertices)</a>
<a class="sourceLine" id="cb4-69" title="69">  indices &lt;-<span class="st"> </span><span class="kw">cbind</span>(indices, indices[4L<span class="op">:</span>1L,] <span class="op">+</span><span class="st"> </span><span class="dv">2</span><span class="op">*</span>nu<span class="op">*</span>nv)</a>
<a class="sourceLine" id="cb4-70" title="70">  Normals &lt;-<span class="st"> </span><span class="kw">cbind</span>(Normals, <span class="kw">c</span>(<span class="dv">1</span>,<span class="op">-</span><span class="dv">1</span>,<span class="dv">1</span>) <span class="op">*</span><span class="st"> </span>Normals)</a>
<a class="sourceLine" id="cb4-71" title="71">  vertices &lt;-<span class="st"> </span><span class="kw">cbind</span>(vertices, <span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">1</span>,<span class="op">-</span><span class="dv">1</span>) <span class="op">*</span><span class="st"> </span>vertices)</a>
<a class="sourceLine" id="cb4-72" title="72">  indices &lt;-<span class="st"> </span><span class="kw">cbind</span>(indices, indices[4L<span class="op">:</span>1L,] <span class="op">+</span><span class="st"> </span><span class="dv">4</span><span class="op">*</span>nu<span class="op">*</span>nv)</a>
<a class="sourceLine" id="cb4-73" title="73">  Normals &lt;-<span class="st"> </span><span class="kw">cbind</span>(Normals, <span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">1</span>,<span class="op">-</span><span class="dv">1</span>) <span class="op">*</span><span class="st"> </span>Normals)</a>
<a class="sourceLine" id="cb4-74" title="74">  mesh &lt;-<span class="st"> </span><span class="kw">qmesh3d</span>(</a>
<a class="sourceLine" id="cb4-75" title="75">    <span class="dt">vertices =</span> <span class="cf">if</span>(exchange) vertices[<span class="kw">c</span>(2L,1L,3L),] <span class="cf">else</span> vertices,</a>
<a class="sourceLine" id="cb4-76" title="76">    <span class="dt">indices =</span> indices,</a>
<a class="sourceLine" id="cb4-77" title="77">    <span class="dt">homogeneous =</span> <span class="ot">FALSE</span>,</a>
<a class="sourceLine" id="cb4-78" title="78">    <span class="dt">normals =</span> <span class="kw">t</span>(<span class="cf">if</span>(exchange) Normals[<span class="kw">c</span>(2L,1L,3L),] <span class="cf">else</span> Normals)</a>
<a class="sourceLine" id="cb4-79" title="79">  )</a>
<a class="sourceLine" id="cb4-80" title="80">  mesh</a>
<a class="sourceLine" id="cb4-81" title="81">}</a></code></pre></div>
<p>The <code>curvatureLinesH1</code> function below generates some curvature lines of the one-sheeted hyperboloid. There are two families of curvature lines and the desired numbers of lines in them are controlled by the arguments <code>nu</code> and <code>nv</code>.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" title="1">curvatureLinesH1 &lt;-<span class="st"> </span><span class="cf">function</span>(a, b, c, <span class="dt">signature =</span> <span class="st">&quot;++-&quot;</span>, nu, nv, vmin,  </a>
<a class="sourceLine" id="cb5-2" title="2">                             <span class="dt">npoints =</span> <span class="dv">100</span>){</a>
<a class="sourceLine" id="cb5-3" title="3">  <span class="kw">stopifnot</span>(signature <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;++-&quot;</span>, <span class="st">&quot;+-+&quot;</span>, <span class="st">&quot;-++&quot;</span>))</a>
<a class="sourceLine" id="cb5-4" title="4">  <span class="kw">stopifnot</span>(vmin <span class="op">&lt;</span><span class="st"> </span><span class="dv">1</span>, a <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>, b <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>, c <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>)</a>
<a class="sourceLine" id="cb5-5" title="5">  <span class="cf">if</span>(signature <span class="op">==</span><span class="st"> &quot;+-+&quot;</span>){</a>
<a class="sourceLine" id="cb5-6" title="6">    clines &lt;-<span class="st"> </span><span class="kw">curvatureLinesH1</span>(a, c, b, <span class="st">&quot;++-&quot;</span>, nu, nv, vmin, npoints)</a>
<a class="sourceLine" id="cb5-7" title="7">    <span class="kw">return</span>(<span class="kw">lapply</span>(clines, <span class="cf">function</span>(l) l[,<span class="kw">c</span>(1L,3L,2L)]))</a>
<a class="sourceLine" id="cb5-8" title="8">  }<span class="cf">else</span> <span class="cf">if</span>(signature <span class="op">==</span><span class="st"> &quot;-++&quot;</span>){</a>
<a class="sourceLine" id="cb5-9" title="9">    clines &lt;-<span class="st"> </span><span class="kw">curvatureLinesH1</span>(c, b, a, <span class="st">&quot;++-&quot;</span>, nu, nv, vmin, npoints)</a>
<a class="sourceLine" id="cb5-10" title="10">    <span class="kw">return</span>(<span class="kw">lapply</span>(clines, <span class="cf">function</span>(l) l[,<span class="kw">c</span>(3L,2L,1L)]))</a>
<a class="sourceLine" id="cb5-11" title="11">  }</a>
<a class="sourceLine" id="cb5-12" title="12">  c0 &lt;-<span class="st"> </span>c</a>
<a class="sourceLine" id="cb5-13" title="13">  <span class="cf">if</span>(b <span class="op">&gt;</span><span class="st"> </span>a){</a>
<a class="sourceLine" id="cb5-14" title="14">    exchange &lt;-<span class="st"> </span><span class="ot">TRUE</span></a>
<a class="sourceLine" id="cb5-15" title="15">    a0 &lt;-<span class="st"> </span>b; b0 &lt;-<span class="st"> </span>a</a>
<a class="sourceLine" id="cb5-16" title="16">  }<span class="cf">else</span>{</a>
<a class="sourceLine" id="cb5-17" title="17">    exchange &lt;-<span class="st"> </span><span class="ot">FALSE</span></a>
<a class="sourceLine" id="cb5-18" title="18">    a0 &lt;-<span class="st"> </span>a; b0 &lt;-<span class="st"> </span>b</a>
<a class="sourceLine" id="cb5-19" title="19">  }</a>
<a class="sourceLine" id="cb5-20" title="20">  Mu2 &lt;-<span class="st"> </span>a0<span class="op">^</span><span class="dv">2</span></a>
<a class="sourceLine" id="cb5-21" title="21">  h2ab &lt;-<span class="st"> </span>Mu2 <span class="op">-</span><span class="st"> </span>b0<span class="op">^</span><span class="dv">2</span>; h2ac &lt;-<span class="st"> </span>c0<span class="op">^</span><span class="dv">2</span> <span class="op">+</span><span class="st"> </span>Mu2</a>
<a class="sourceLine" id="cb5-22" title="22">  c2 &lt;-<span class="st"> </span><span class="dv">1</span>; a2 &lt;-<span class="st"> </span>c2 <span class="op">+</span><span class="st"> </span>h2ac; b2 &lt;-<span class="st"> </span>a2 <span class="op">-</span><span class="st"> </span>h2ab</a>
<a class="sourceLine" id="cb5-23" title="23">  h2bc &lt;-<span class="st"> </span>b2 <span class="op">-</span><span class="st"> </span>c2</a>
<a class="sourceLine" id="cb5-24" title="24">  <span class="co">#  </span></a>
<a class="sourceLine" id="cb5-25" title="25">  v_ &lt;-<span class="st"> </span><span class="kw">seq</span>(vmin, c2, <span class="dt">length.out =</span> nv)</a>
<a class="sourceLine" id="cb5-26" title="26">  t_ &lt;-<span class="st"> </span><span class="kw">seq</span>(vmin, c2, <span class="dt">length.out =</span> npoints)</a>
<a class="sourceLine" id="cb5-27" title="27">  <span class="co">#</span></a>
<a class="sourceLine" id="cb5-28" title="28">  <span class="cf">if</span>(a0 <span class="op">!=</span><span class="st"> </span>b0){</a>
<a class="sourceLine" id="cb5-29" title="29">    u_ &lt;-<span class="st"> </span><span class="kw">seq</span>(b2, a2, <span class="dt">length.out =</span> nu)</a>
<a class="sourceLine" id="cb5-30" title="30">    s_ &lt;-<span class="st"> </span><span class="kw">seq</span>(b2, a2, <span class="dt">length.out =</span> npoints)</a>
<a class="sourceLine" id="cb5-31" title="31">    mx &lt;-<span class="st"> </span>a0 <span class="op">/</span><span class="st"> </span><span class="kw">sqrt</span>(h2ac<span class="op">*</span>h2ab)</a>
<a class="sourceLine" id="cb5-32" title="32">    my &lt;-<span class="st"> </span>b0 <span class="op">/</span><span class="st"> </span><span class="kw">sqrt</span>(h2bc<span class="op">*</span>h2ab)</a>
<a class="sourceLine" id="cb5-33" title="33">    mz &lt;-<span class="st"> </span>c0 <span class="op">/</span><span class="st"> </span><span class="kw">sqrt</span>(h2bc<span class="op">*</span>h2ac)</a>
<a class="sourceLine" id="cb5-34" title="34">    out &lt;-<span class="st"> </span><span class="kw">vector</span>(<span class="st">&quot;list&quot;</span>, <span class="dv">2</span><span class="op">*</span>nv <span class="op">+</span><span class="st"> </span><span class="dv">4</span><span class="op">*</span>nu <span class="op">-</span><span class="st"> </span><span class="dv">5</span>)</a>
<a class="sourceLine" id="cb5-35" title="35">    <span class="cf">for</span>(j <span class="cf">in</span> 1L<span class="op">:</span>nv){</a>
<a class="sourceLine" id="cb5-36" title="36">      x &lt;-<span class="st"> </span>mx <span class="op">*</span><span class="st"> </span><span class="kw">sqrt</span>((a2<span class="op">-</span>s_)<span class="op">*</span>(a2<span class="op">-</span>v_[j]))</a>
<a class="sourceLine" id="cb5-37" title="37">      y &lt;-<span class="st"> </span>my <span class="op">*</span><span class="st"> </span><span class="kw">sqrt</span>((s_<span class="op">-</span>b2)<span class="op">*</span>(b2<span class="op">-</span>v_[j]))</a>
<a class="sourceLine" id="cb5-38" title="38">      z &lt;-<span class="st"> </span>mz <span class="op">*</span><span class="st"> </span><span class="kw">sqrt</span>((s_<span class="op">-</span>c2)<span class="op">*</span>(c2<span class="op">-</span>v_[j]))</a>
<a class="sourceLine" id="cb5-39" title="39">      M &lt;-<span class="st"> </span><span class="kw">rbind</span>(<span class="kw">cbind</span>(x, y, z), <span class="kw">cbind</span>(<span class="op">-</span>x, y, z)[(npoints<span class="dv">-1</span>)<span class="op">:</span>1L,])</a>
<a class="sourceLine" id="cb5-40" title="40">      M &lt;-<span class="st"> </span><span class="kw">rbind</span>(M, <span class="kw">cbind</span>(M[,1L], <span class="op">-</span>M[,2L], M[,3L])[(<span class="dv">2</span><span class="op">*</span>npoints<span class="dv">-2</span>)<span class="op">:</span>1L,])</a>
<a class="sourceLine" id="cb5-41" title="41">      out[[j]] &lt;-<span class="st"> </span>M</a>
<a class="sourceLine" id="cb5-42" title="42">      <span class="cf">if</span>(j <span class="op">&lt;</span><span class="st"> </span>nv){</a>
<a class="sourceLine" id="cb5-43" title="43">        out[[nv<span class="op">+</span>j]] &lt;-<span class="st"> </span><span class="kw">cbind</span>(M[,<span class="kw">c</span>(1L,2L)], <span class="op">-</span>M[,3L])</a>
<a class="sourceLine" id="cb5-44" title="44">      }</a>
<a class="sourceLine" id="cb5-45" title="45">    }</a>
<a class="sourceLine" id="cb5-46" title="46">    <span class="cf">for</span>(i <span class="cf">in</span> 1L<span class="op">:</span>nu){</a>
<a class="sourceLine" id="cb5-47" title="47">      x &lt;-<span class="st"> </span>mx <span class="op">*</span><span class="st"> </span><span class="kw">sqrt</span>((a2<span class="op">-</span>u_[i])<span class="op">*</span>(a2<span class="op">-</span>t_))</a>
<a class="sourceLine" id="cb5-48" title="48">      y &lt;-<span class="st"> </span>my <span class="op">*</span><span class="st"> </span><span class="kw">sqrt</span>((u_[i]<span class="op">-</span>b2)<span class="op">*</span>(b2<span class="op">-</span>t_))</a>
<a class="sourceLine" id="cb5-49" title="49">      z &lt;-<span class="st"> </span>mz <span class="op">*</span><span class="st"> </span><span class="kw">sqrt</span>((u_[i]<span class="op">-</span>c2)<span class="op">*</span>(c2<span class="op">-</span>t_))</a>
<a class="sourceLine" id="cb5-50" title="50">      M &lt;-<span class="st"> </span><span class="kw">rbind</span>(<span class="kw">cbind</span>(x, y, z), <span class="kw">cbind</span>(x, y, <span class="op">-</span>z)[(npoints<span class="dv">-1</span>)<span class="op">:</span>1L,])</a>
<a class="sourceLine" id="cb5-51" title="51">      out[[<span class="dv">2</span><span class="op">*</span>nv<span class="dv">-1</span><span class="op">+</span>i]] &lt;-<span class="st"> </span>M</a>
<a class="sourceLine" id="cb5-52" title="52">      <span class="cf">if</span>(i <span class="op">&lt;</span><span class="st"> </span>nu){</a>
<a class="sourceLine" id="cb5-53" title="53">        out[[<span class="dv">2</span><span class="op">*</span>nv<span class="dv">-1</span><span class="op">+</span>nu<span class="op">+</span>i]] &lt;-<span class="st"> </span><span class="kw">cbind</span>(<span class="op">-</span>M[,1L], M[,<span class="kw">c</span>(2L,3L)])</a>
<a class="sourceLine" id="cb5-54" title="54">        <span class="cf">if</span>(i<span class="op">&gt;</span>1L) out[[<span class="dv">2</span><span class="op">*</span>nv<span class="op">+</span><span class="dv">3</span><span class="op">*</span>nu<span class="op">+</span>i<span class="dv">-4</span>]] &lt;-<span class="st"> </span><span class="kw">cbind</span>(<span class="op">-</span>M[,<span class="kw">c</span>(1L,2L)], M[,3L])</a>
<a class="sourceLine" id="cb5-55" title="55">      }</a>
<a class="sourceLine" id="cb5-56" title="56">      <span class="cf">if</span>(i <span class="op">&gt;</span><span class="st"> </span>1L){</a>
<a class="sourceLine" id="cb5-57" title="57">        out[[<span class="dv">2</span><span class="op">*</span>nv<span class="op">+</span><span class="dv">2</span><span class="op">*</span>nu<span class="op">+</span>i<span class="dv">-3</span>]] &lt;-<span class="st"> </span><span class="kw">cbind</span>(M[,1L], <span class="op">-</span>M[,2L], M[,3L])</a>
<a class="sourceLine" id="cb5-58" title="58">      }</a>
<a class="sourceLine" id="cb5-59" title="59">    }</a>
<a class="sourceLine" id="cb5-60" title="60">  }<span class="cf">else</span>{ <span class="co"># a0 = b0</span></a>
<a class="sourceLine" id="cb5-61" title="61">    u_ &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="dv">0</span>, <span class="dv">2</span><span class="op">*</span>pi, <span class="dt">length.out =</span> nu<span class="op">+</span><span class="dv">1</span>)[<span class="op">-</span>1L]</a>
<a class="sourceLine" id="cb5-62" title="62">    s_ &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="dv">0</span>, <span class="dv">2</span><span class="op">*</span>pi, <span class="dt">length.out =</span> npoints)</a>
<a class="sourceLine" id="cb5-63" title="63">    coss_ &lt;-<span class="st"> </span><span class="kw">cos</span>(s_); sins_ &lt;-<span class="st"> </span><span class="kw">sin</span>(s_)</a>
<a class="sourceLine" id="cb5-64" title="64">    mxy &lt;-<span class="st"> </span>a0 <span class="op">/</span><span class="st"> </span><span class="kw">sqrt</span>(h2ac)</a>
<a class="sourceLine" id="cb5-65" title="65">    mz &lt;-<span class="st"> </span>c0 <span class="op">/</span><span class="st"> </span><span class="kw">sqrt</span>(h2bc)</a>
<a class="sourceLine" id="cb5-66" title="66">    out &lt;-<span class="st"> </span><span class="kw">vector</span>(<span class="st">&quot;list&quot;</span>, <span class="dv">2</span><span class="op">*</span>nv <span class="op">+</span><span class="st"> </span><span class="dv">4</span><span class="op">*</span>nu <span class="op">-</span><span class="st"> </span><span class="dv">5</span>)</a>
<a class="sourceLine" id="cb5-67" title="67">    <span class="cf">for</span>(j <span class="cf">in</span> 1L<span class="op">:</span>nv){</a>
<a class="sourceLine" id="cb5-68" title="68">      x &lt;-<span class="st"> </span>mxy <span class="op">*</span><span class="st"> </span><span class="kw">sqrt</span>(a2<span class="op">-</span>v_[j]) <span class="op">*</span><span class="st"> </span>coss_</a>
<a class="sourceLine" id="cb5-69" title="69">      y &lt;-<span class="st"> </span>mxy <span class="op">*</span><span class="st"> </span><span class="kw">sqrt</span>(b2<span class="op">-</span>v_[j]) <span class="op">*</span><span class="st"> </span>sins_</a>
<a class="sourceLine" id="cb5-70" title="70">      z &lt;-<span class="st"> </span>mz <span class="op">*</span><span class="st"> </span><span class="kw">sqrt</span>(c2<span class="op">-</span>v_[j]) </a>
<a class="sourceLine" id="cb5-71" title="71">      M &lt;-<span class="st"> </span><span class="kw">cbind</span>(x, y, z)</a>
<a class="sourceLine" id="cb5-72" title="72">      out[[j]] &lt;-<span class="st"> </span>M</a>
<a class="sourceLine" id="cb5-73" title="73">      <span class="cf">if</span>(j <span class="op">&lt;</span><span class="st"> </span>nv){</a>
<a class="sourceLine" id="cb5-74" title="74">        out[[nv<span class="op">+</span>j]] &lt;-<span class="st"> </span><span class="kw">cbind</span>(M[,<span class="kw">c</span>(1L,2L)], <span class="op">-</span>M[,3L])</a>
<a class="sourceLine" id="cb5-75" title="75">      }</a>
<a class="sourceLine" id="cb5-76" title="76">    }</a>
<a class="sourceLine" id="cb5-77" title="77">    r &lt;-<span class="st"> </span>mxy <span class="op">*</span><span class="st"> </span><span class="kw">sqrt</span>(a2<span class="op">-</span>t_)</a>
<a class="sourceLine" id="cb5-78" title="78">    z &lt;-<span class="st"> </span>mz <span class="op">*</span><span class="st"> </span><span class="kw">sqrt</span>(c2<span class="op">-</span>t_)</a>
<a class="sourceLine" id="cb5-79" title="79">    <span class="cf">for</span>(i <span class="cf">in</span> 1L<span class="op">:</span>nu){</a>
<a class="sourceLine" id="cb5-80" title="80">      x &lt;-<span class="st"> </span>r <span class="op">*</span><span class="st"> </span><span class="kw">cos</span>(u_[i])</a>
<a class="sourceLine" id="cb5-81" title="81">      y &lt;-<span class="st"> </span>r <span class="op">*</span><span class="st"> </span><span class="kw">sin</span>(u_[i])</a>
<a class="sourceLine" id="cb5-82" title="82">      M &lt;-<span class="st"> </span><span class="kw">rbind</span>(<span class="kw">cbind</span>(x, y, z), <span class="kw">cbind</span>(x, y, <span class="op">-</span>z)[(npoints<span class="dv">-1</span>)<span class="op">:</span>1L,])</a>
<a class="sourceLine" id="cb5-83" title="83">      out[[<span class="dv">2</span><span class="op">*</span>nv<span class="dv">-1</span><span class="op">+</span>i]] &lt;-<span class="st"> </span>M</a>
<a class="sourceLine" id="cb5-84" title="84">      <span class="cf">if</span>(i <span class="op">&lt;</span><span class="st"> </span>nu){</a>
<a class="sourceLine" id="cb5-85" title="85">        out[[<span class="dv">2</span><span class="op">*</span>nv<span class="dv">-1</span><span class="op">+</span>nu<span class="op">+</span>i]] &lt;-<span class="st"> </span><span class="kw">cbind</span>(<span class="op">-</span>M[,1L], M[,<span class="kw">c</span>(2L,3L)])</a>
<a class="sourceLine" id="cb5-86" title="86">        <span class="cf">if</span>(i<span class="op">&gt;</span>1L) out[[<span class="dv">2</span><span class="op">*</span>nv<span class="op">+</span><span class="dv">3</span><span class="op">*</span>nu<span class="op">+</span>i<span class="dv">-4</span>]] &lt;-<span class="st"> </span><span class="kw">cbind</span>(<span class="op">-</span>M[,<span class="kw">c</span>(1L,2L)], M[,3L])</a>
<a class="sourceLine" id="cb5-87" title="87">      }</a>
<a class="sourceLine" id="cb5-88" title="88">      <span class="cf">if</span>(i <span class="op">&gt;</span><span class="st"> </span>1L){</a>
<a class="sourceLine" id="cb5-89" title="89">        out[[<span class="dv">2</span><span class="op">*</span>nv<span class="op">+</span><span class="dv">2</span><span class="op">*</span>nu<span class="op">+</span>i<span class="dv">-3</span>]] &lt;-<span class="st"> </span><span class="kw">cbind</span>(M[,1L], <span class="op">-</span>M[,2L], M[,3L])</a>
<a class="sourceLine" id="cb5-90" title="90">      }</a>
<a class="sourceLine" id="cb5-91" title="91">    }</a>
<a class="sourceLine" id="cb5-92" title="92">  }</a>
<a class="sourceLine" id="cb5-93" title="93">  <span class="cf">if</span>(exchange){</a>
<a class="sourceLine" id="cb5-94" title="94">    out &lt;-<span class="st"> </span><span class="kw">lapply</span>(out, <span class="cf">function</span>(M){</a>
<a class="sourceLine" id="cb5-95" title="95">      M[, <span class="kw">c</span>(2L,1L,3L)]</a>
<a class="sourceLine" id="cb5-96" title="96">    })</a>
<a class="sourceLine" id="cb5-97" title="97">  }</a>
<a class="sourceLine" id="cb5-98" title="98">  out</a>
<a class="sourceLine" id="cb5-99" title="99">}</a></code></pre></div>
<p>Here is an example:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" title="1">sgntr =<span class="st"> &quot;++-&quot;</span></a>
<a class="sourceLine" id="cb6-2" title="2">a =<span class="st"> </span><span class="dv">4</span>; b =<span class="st"> </span><span class="dv">6</span>; c =<span class="st"> </span><span class="dv">5</span></a>
<a class="sourceLine" id="cb6-3" title="3">mesh &lt;-<span class="st"> </span><span class="kw">hyperboloidMesh</span>(a, b, c, sgntr, <span class="dt">nu =</span> <span class="dv">100</span>, <span class="dt">nv =</span> <span class="dv">100</span>, <span class="dt">vmin =</span> <span class="dv">-150</span>)</a>
<a class="sourceLine" id="cb6-4" title="4">clines &lt;-<span class="st"> </span><span class="kw">curvatureLinesH1</span>(a, b, c, sgntr, <span class="dt">nu =</span> <span class="dv">5</span>, <span class="dt">nv =</span> <span class="dv">5</span>, <span class="dt">vmin =</span> <span class="dv">-150</span>)</a>
<a class="sourceLine" id="cb6-5" title="5"><span class="kw">shade3d</span>(mesh, <span class="dt">color =</span> <span class="st">&quot;chartreuse4&quot;</span>, <span class="dt">back =</span> <span class="st">&quot;culled&quot;</span>) </a>
<a class="sourceLine" id="cb6-6" title="6"><span class="kw">shade3d</span>(mesh, <span class="dt">color =</span> <span class="st">&quot;yellow&quot;</span>, <span class="dt">front =</span> <span class="st">&quot;culled&quot;</span>) </a>
<a class="sourceLine" id="cb6-7" title="7"><span class="kw">invisible</span>(<span class="kw">lapply</span>(clines, <span class="cf">function</span>(l){</a>
<a class="sourceLine" id="cb6-8" title="8">  <span class="kw">shade3d</span>(<span class="kw">cylinder3d</span>(l, <span class="dt">radius =</span> <span class="fl">0.1</span>, <span class="dt">sides =</span> <span class="dv">30</span>))</a>
<a class="sourceLine" id="cb6-9" title="9">}))</a></code></pre></div>
<p><img src="figures/quadrics_H1.png" /></p>
<h1 id="two-sheeted-hyperboloid">Two-sheeted hyperboloid</h1>
<p>There are three types of two-sheeted hyperboloids, corresponding to these equations: <span class="math display">\[
\frac{x^2}{a^2} - \frac{y^2}{b^2} - \frac{z^2}{c^2} = 1 \\
-\frac{x^2}{a^2} - \frac{y^2}{b^2} + \frac{z^2}{c^2} = 1 \\
-\frac{x^2}{a^2} + \frac{y^2}{b^2} - \frac{z^2}{c^2} = 1.
\]</span> The <code>twoSheetsHyperboloidMesh</code> function below generates a mesh of the two-sheeted hyperboloid; the <code>signature</code> argument corresponds to one of the above equations, it must be <code>"+--"</code>, <code>"--+"</code> or <code>"-+-"</code>. The mesh is made of quadrilaterals and their number is controlled by the arguments <code>nu</code> and <code>nv</code>. The two-sheeted hyperboloid is infinite and the argument <code>vmin</code> is here to control its truncation.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" title="1">twoSheetsHyperboloidMesh &lt;-<span class="st"> </span><span class="cf">function</span>(a, b, c, signature, nu, nv, vmin){</a>
<a class="sourceLine" id="cb7-2" title="2">  <span class="kw">stopifnot</span>(signature <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;+--&quot;</span>, <span class="st">&quot;--+&quot;</span>, <span class="st">&quot;-+-&quot;</span>))</a>
<a class="sourceLine" id="cb7-3" title="3">  <span class="kw">stopifnot</span>(vmin <span class="op">&lt;</span><span class="st"> </span><span class="dv">1</span>)</a>
<a class="sourceLine" id="cb7-4" title="4">  <span class="cf">if</span>(signature <span class="op">==</span><span class="st"> &quot;--+&quot;</span>){</a>
<a class="sourceLine" id="cb7-5" title="5">    mesh &lt;-<span class="st"> </span><span class="kw">twoSheetsHyperboloidMesh</span>(c, b, a, <span class="st">&quot;+--&quot;</span>, nu, nv, vmin)</a>
<a class="sourceLine" id="cb7-6" title="6">    mesh<span class="op">$</span>vb &lt;-<span class="st"> </span>mesh<span class="op">$</span>vb[<span class="kw">c</span>(3L,2L,1L,4L),]</a>
<a class="sourceLine" id="cb7-7" title="7">    mesh<span class="op">$</span>normals &lt;-<span class="st"> </span>mesh<span class="op">$</span>normals[<span class="kw">c</span>(3L,2L,1L),]</a>
<a class="sourceLine" id="cb7-8" title="8">    mesh<span class="op">$</span>ib &lt;-<span class="st"> </span>mesh<span class="op">$</span>ib[4L<span class="op">:</span>1L,]</a>
<a class="sourceLine" id="cb7-9" title="9">    <span class="kw">return</span>(mesh)</a>
<a class="sourceLine" id="cb7-10" title="10">  }<span class="cf">else</span> <span class="cf">if</span>(signature <span class="op">==</span><span class="st"> &quot;-+-&quot;</span>){</a>
<a class="sourceLine" id="cb7-11" title="11">    mesh &lt;-<span class="st"> </span><span class="kw">twoSheetsHyperboloidMesh</span>(b, a, c, <span class="st">&quot;+--&quot;</span>, nu, nv, vmin)</a>
<a class="sourceLine" id="cb7-12" title="12">    mesh<span class="op">$</span>vb &lt;-<span class="st"> </span>mesh<span class="op">$</span>vb[<span class="kw">c</span>(2L,1L,3L,4L),]</a>
<a class="sourceLine" id="cb7-13" title="13">    mesh<span class="op">$</span>normals &lt;-<span class="st"> </span>mesh<span class="op">$</span>normals[<span class="kw">c</span>(2L,1L,3L),]</a>
<a class="sourceLine" id="cb7-14" title="14">    mesh<span class="op">$</span>ib &lt;-<span class="st"> </span>mesh<span class="op">$</span>ib[4L<span class="op">:</span>1L,]</a>
<a class="sourceLine" id="cb7-15" title="15">    <span class="kw">return</span>(mesh)</a>
<a class="sourceLine" id="cb7-16" title="16">  }</a>
<a class="sourceLine" id="cb7-17" title="17">  a0 &lt;-<span class="st"> </span>a</a>
<a class="sourceLine" id="cb7-18" title="18">  <span class="cf">if</span>(b <span class="op">&gt;</span><span class="st"> </span>c){</a>
<a class="sourceLine" id="cb7-19" title="19">    exchange &lt;-<span class="st"> </span><span class="ot">TRUE</span></a>
<a class="sourceLine" id="cb7-20" title="20">    b0 &lt;-<span class="st"> </span>c; c0 &lt;-<span class="st"> </span>b</a>
<a class="sourceLine" id="cb7-21" title="21">  }<span class="cf">else</span>{</a>
<a class="sourceLine" id="cb7-22" title="22">    exchange &lt;-<span class="st"> </span><span class="ot">FALSE</span></a>
<a class="sourceLine" id="cb7-23" title="23">    b0 &lt;-<span class="st"> </span>b; c0 &lt;-<span class="st"> </span>c</a>
<a class="sourceLine" id="cb7-24" title="24">  }</a>
<a class="sourceLine" id="cb7-25" title="25">  Nu2 &lt;-<span class="st"> </span>a0<span class="op">^</span><span class="dv">2</span></a>
<a class="sourceLine" id="cb7-26" title="26">  h2ab &lt;-<span class="st"> </span>b0<span class="op">^</span><span class="dv">2</span> <span class="op">+</span><span class="st"> </span>Nu2; h2ac &lt;-<span class="st"> </span>c0<span class="op">^</span><span class="dv">2</span> <span class="op">+</span><span class="st"> </span>Nu2</a>
<a class="sourceLine" id="cb7-27" title="27">  c2 &lt;-<span class="st"> </span><span class="dv">1</span>; a2 &lt;-<span class="st"> </span>c2 <span class="op">+</span><span class="st"> </span>h2ac; b2 &lt;-<span class="st"> </span>a2 <span class="op">-</span><span class="st"> </span>h2ab</a>
<a class="sourceLine" id="cb7-28" title="28">  h2bc &lt;-<span class="st"> </span>b2 <span class="op">-</span><span class="st"> </span>c2</a>
<a class="sourceLine" id="cb7-29" title="29">  <span class="co">#</span></a>
<a class="sourceLine" id="cb7-30" title="30">  vertices &lt;-<span class="st"> </span>Normals &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="ot">NA_real_</span>, <span class="dt">nrow =</span> 3L, <span class="dt">ncol =</span> nu<span class="op">*</span>nv)</a>
<a class="sourceLine" id="cb7-31" title="31">  indices &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="ot">NA_integer_</span>, <span class="dt">nrow =</span> 4L, <span class="dt">ncol =</span> (nu<span class="dv">-1</span>)<span class="op">*</span>(nv<span class="dv">-1</span>))</a>
<a class="sourceLine" id="cb7-32" title="32">  v_ &lt;-<span class="st"> </span><span class="kw">seq</span>(vmin, c2, <span class="dt">length.out =</span> nv)</a>
<a class="sourceLine" id="cb7-33" title="33">  <span class="co">#</span></a>
<a class="sourceLine" id="cb7-34" title="34">  <span class="cf">if</span>(b0 <span class="op">!=</span><span class="st"> </span>c0){</a>
<a class="sourceLine" id="cb7-35" title="35">    u_ &lt;-<span class="st"> </span><span class="kw">seq</span>(c2, b2, <span class="dt">length.out =</span> nu)</a>
<a class="sourceLine" id="cb7-36" title="36">    x &lt;-<span class="st"> </span>a0 <span class="op">/</span><span class="st"> </span><span class="kw">sqrt</span>(h2ac<span class="op">*</span>h2ab) <span class="op">*</span><span class="st"> </span><span class="kw">sqrt</span>(a2<span class="op">-</span>u_)</a>
<a class="sourceLine" id="cb7-37" title="37">    y &lt;-<span class="st"> </span>b0 <span class="op">/</span><span class="st"> </span><span class="kw">sqrt</span>(h2bc<span class="op">*</span>h2ab) <span class="op">*</span><span class="st"> </span><span class="kw">sqrt</span>(b2<span class="op">-</span>u_)</a>
<a class="sourceLine" id="cb7-38" title="38">    z &lt;-<span class="st"> </span>c0 <span class="op">/</span><span class="st"> </span><span class="kw">sqrt</span>(h2bc<span class="op">*</span>h2ac) <span class="op">*</span><span class="st"> </span><span class="kw">sqrt</span>(u_<span class="op">-</span>c2)</a>
<a class="sourceLine" id="cb7-39" title="39">  }<span class="cf">else</span>{</a>
<a class="sourceLine" id="cb7-40" title="40">    u_ &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="dv">0</span>, <span class="dv">2</span><span class="op">*</span>pi, <span class="dt">length.out =</span> nu<span class="op">+</span><span class="dv">1</span>)[<span class="op">-</span>1L]</a>
<a class="sourceLine" id="cb7-41" title="41">    x &lt;-<span class="st"> </span><span class="kw">rep</span>(a0<span class="op">/</span><span class="kw">sqrt</span>(h2ac), nu)</a>
<a class="sourceLine" id="cb7-42" title="42">    myz &lt;-<span class="st"> </span>b0 <span class="op">/</span><span class="st"> </span><span class="kw">sqrt</span>(h2ab)</a>
<a class="sourceLine" id="cb7-43" title="43">    y &lt;-<span class="st"> </span>myz <span class="op">*</span><span class="st"> </span><span class="kw">cos</span>(u_)</a>
<a class="sourceLine" id="cb7-44" title="44">    z &lt;-<span class="st"> </span>myz <span class="op">*</span><span class="st"> </span><span class="kw">sin</span>(u_)</a>
<a class="sourceLine" id="cb7-45" title="45">  }</a>
<a class="sourceLine" id="cb7-46" title="46">  <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>nu){</a>
<a class="sourceLine" id="cb7-47" title="47">    <span class="cf">for</span>(j <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>nv){</a>
<a class="sourceLine" id="cb7-48" title="48">      P &lt;-<span class="st"> </span>vertices[, (i<span class="dv">-1</span>)<span class="op">*</span>nv<span class="op">+</span>j] &lt;-<span class="st"> </span><span class="kw">c</span>(</a>
<a class="sourceLine" id="cb7-49" title="49">        x[i] <span class="op">*</span><span class="st"> </span><span class="kw">sqrt</span>(a2<span class="op">-</span>v_[j]),</a>
<a class="sourceLine" id="cb7-50" title="50">        y[i] <span class="op">*</span><span class="st"> </span><span class="kw">sqrt</span>(b2<span class="op">-</span>v_[j]),</a>
<a class="sourceLine" id="cb7-51" title="51">        z[i] <span class="op">*</span><span class="st"> </span><span class="kw">sqrt</span>(c2<span class="op">-</span>v_[j])</a>
<a class="sourceLine" id="cb7-52" title="52">      )</a>
<a class="sourceLine" id="cb7-53" title="53">      Normals[, (i<span class="dv">-1</span>)<span class="op">*</span>nv<span class="op">+</span>j] &lt;-<span class="st"> </span><span class="kw">c</span>(P[1L]<span class="op">/</span>a0<span class="op">^</span><span class="dv">2</span>, <span class="op">-</span>P[2L]<span class="op">/</span>b0<span class="op">^</span><span class="dv">2</span>, <span class="op">-</span>P[3L]<span class="op">/</span>c0<span class="op">^</span><span class="dv">2</span>)</a>
<a class="sourceLine" id="cb7-54" title="54">    }</a>
<a class="sourceLine" id="cb7-55" title="55">  }</a>
<a class="sourceLine" id="cb7-56" title="56">  <span class="co"># quads</span></a>
<a class="sourceLine" id="cb7-57" title="57">  <span class="cf">for</span>(i <span class="cf">in</span> 1L<span class="op">:</span>(nu<span class="dv">-1</span>)){</a>
<a class="sourceLine" id="cb7-58" title="58">    im1 &lt;-<span class="st"> </span>i<span class="op">-</span>1L</a>
<a class="sourceLine" id="cb7-59" title="59">    <span class="cf">for</span>(j <span class="cf">in</span> 1L<span class="op">:</span>(nv<span class="dv">-1</span>)){</a>
<a class="sourceLine" id="cb7-60" title="60">      jp1 &lt;-<span class="st"> </span>j<span class="op">+</span>1L</a>
<a class="sourceLine" id="cb7-61" title="61">      quad &lt;-<span class="st"> </span><span class="kw">c</span>(im1<span class="op">*</span>nv<span class="op">+</span>j, im1<span class="op">*</span>nv<span class="op">+</span>jp1, i<span class="op">*</span>nv<span class="op">+</span>jp1, i<span class="op">*</span>nv<span class="op">+</span>j)</a>
<a class="sourceLine" id="cb7-62" title="62">      indices[, im1<span class="op">*</span>(nv<span class="dv">-1</span>)<span class="op">+</span>j] &lt;-<span class="st"> </span><span class="cf">if</span>(exchange) <span class="kw">rev</span>(quad) <span class="cf">else</span> quad</a>
<a class="sourceLine" id="cb7-63" title="63">    }</a>
<a class="sourceLine" id="cb7-64" title="64">  }</a>
<a class="sourceLine" id="cb7-65" title="65">  vertices &lt;-<span class="st"> </span><span class="kw">cbind</span>(vertices, <span class="kw">c</span>(<span class="op">-</span><span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>) <span class="op">*</span><span class="st"> </span>vertices)</a>
<a class="sourceLine" id="cb7-66" title="66">  indices &lt;-<span class="st"> </span><span class="kw">cbind</span>(indices, indices[4L<span class="op">:</span>1L,] <span class="op">+</span><span class="st"> </span>nu<span class="op">*</span>nv)</a>
<a class="sourceLine" id="cb7-67" title="67">  Normals &lt;-<span class="st"> </span><span class="kw">cbind</span>(Normals, <span class="kw">c</span>(<span class="op">-</span><span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>) <span class="op">*</span><span class="st"> </span>Normals)</a>
<a class="sourceLine" id="cb7-68" title="68">  vertices &lt;-<span class="st"> </span><span class="kw">cbind</span>(vertices, <span class="kw">c</span>(<span class="dv">1</span>,<span class="op">-</span><span class="dv">1</span>,<span class="dv">1</span>) <span class="op">*</span><span class="st"> </span>vertices)</a>
<a class="sourceLine" id="cb7-69" title="69">  indices &lt;-<span class="st"> </span><span class="kw">cbind</span>(indices, indices[4L<span class="op">:</span>1L,] <span class="op">+</span><span class="st"> </span><span class="dv">2</span><span class="op">*</span>nu<span class="op">*</span>nv)</a>
<a class="sourceLine" id="cb7-70" title="70">  Normals &lt;-<span class="st"> </span><span class="kw">cbind</span>(Normals, <span class="kw">c</span>(<span class="dv">1</span>,<span class="op">-</span><span class="dv">1</span>,<span class="dv">1</span>) <span class="op">*</span><span class="st"> </span>Normals)</a>
<a class="sourceLine" id="cb7-71" title="71">  vertices &lt;-<span class="st"> </span><span class="kw">cbind</span>(vertices, <span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">1</span>,<span class="op">-</span><span class="dv">1</span>) <span class="op">*</span><span class="st"> </span>vertices)</a>
<a class="sourceLine" id="cb7-72" title="72">  indices &lt;-<span class="st"> </span><span class="kw">cbind</span>(indices, indices[4L<span class="op">:</span>1L,] <span class="op">+</span><span class="st"> </span><span class="dv">4</span><span class="op">*</span>nu<span class="op">*</span>nv)</a>
<a class="sourceLine" id="cb7-73" title="73">  Normals &lt;-<span class="st"> </span><span class="kw">cbind</span>(Normals, <span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">1</span>,<span class="op">-</span><span class="dv">1</span>) <span class="op">*</span><span class="st"> </span>Normals)</a>
<a class="sourceLine" id="cb7-74" title="74">  mesh &lt;-<span class="st"> </span><span class="kw">qmesh3d</span>(</a>
<a class="sourceLine" id="cb7-75" title="75">    <span class="dt">vertices =</span> <span class="cf">if</span>(exchange) vertices[<span class="kw">c</span>(1L,3L,2L),] <span class="cf">else</span> vertices,</a>
<a class="sourceLine" id="cb7-76" title="76">    <span class="dt">indices =</span> indices,</a>
<a class="sourceLine" id="cb7-77" title="77">    <span class="dt">homogeneous =</span> <span class="ot">FALSE</span>,</a>
<a class="sourceLine" id="cb7-78" title="78">    <span class="dt">normals =</span> <span class="op">-</span><span class="kw">t</span>(<span class="cf">if</span>(exchange) Normals[<span class="kw">c</span>(1L,3L,2L),] <span class="cf">else</span> Normals)</a>
<a class="sourceLine" id="cb7-79" title="79">  )</a>
<a class="sourceLine" id="cb7-80" title="80">  mesh</a>
<a class="sourceLine" id="cb7-81" title="81">}</a></code></pre></div>
<p>The <code>curvatureLinesH2</code> function below generates some curvature lines of the two-sheeted hyperboloid. The role of the arguments <code>du</code> and <code>dv</code> is similar to the role of the arguments <code>du</code> and <code>dv</code> in <code>curvatureLinesE</code>.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" title="1">curvatureLinesH2 &lt;-<span class="st"> </span><span class="cf">function</span>(a, b, c, signature, nu, nv, vmin, du, dv, </a>
<a class="sourceLine" id="cb8-2" title="2">                             <span class="dt">npoints =</span> <span class="dv">100</span>){</a>
<a class="sourceLine" id="cb8-3" title="3">  <span class="kw">stopifnot</span>(signature <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;+--&quot;</span>, <span class="st">&quot;--+&quot;</span>, <span class="st">&quot;-+-&quot;</span>))</a>
<a class="sourceLine" id="cb8-4" title="4">  <span class="kw">stopifnot</span>(du <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>, dv <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>, vmin <span class="op">&lt;</span><span class="st"> </span><span class="dv">1</span>)</a>
<a class="sourceLine" id="cb8-5" title="5">  <span class="cf">if</span>(signature <span class="op">==</span><span class="st"> &quot;--+&quot;</span>){</a>
<a class="sourceLine" id="cb8-6" title="6">    clines &lt;-<span class="st"> </span></a>
<a class="sourceLine" id="cb8-7" title="7"><span class="st">      </span><span class="kw">curvatureLinesH2</span>(c, b, a, <span class="st">&quot;+--&quot;</span>, nu, nv, vmin, du, dv, npoints)</a>
<a class="sourceLine" id="cb8-8" title="8">    <span class="kw">return</span>(<span class="kw">lapply</span>(clines, <span class="cf">function</span>(l) l[, <span class="kw">c</span>(3L,2L,1L)]))</a>
<a class="sourceLine" id="cb8-9" title="9">  }<span class="cf">else</span> <span class="cf">if</span>(signature <span class="op">==</span><span class="st"> &quot;-+-&quot;</span>){</a>
<a class="sourceLine" id="cb8-10" title="10">    clines &lt;-<span class="st"> </span></a>
<a class="sourceLine" id="cb8-11" title="11"><span class="st">      </span><span class="kw">curvatureLinesH2</span>(b, a, c, <span class="st">&quot;+--&quot;</span>, nu, nv, vmin, du, dv, npoints)</a>
<a class="sourceLine" id="cb8-12" title="12">    <span class="kw">return</span>(<span class="kw">lapply</span>(clines, <span class="cf">function</span>(l) l[, <span class="kw">c</span>(2L,1L,3L)]))</a>
<a class="sourceLine" id="cb8-13" title="13">  }</a>
<a class="sourceLine" id="cb8-14" title="14">  a0 &lt;-<span class="st"> </span>a</a>
<a class="sourceLine" id="cb8-15" title="15">  <span class="cf">if</span>(b <span class="op">&gt;</span><span class="st"> </span>c){</a>
<a class="sourceLine" id="cb8-16" title="16">    exchange &lt;-<span class="st"> </span><span class="ot">TRUE</span></a>
<a class="sourceLine" id="cb8-17" title="17">    b0 &lt;-<span class="st"> </span>c; c0 &lt;-<span class="st"> </span>b</a>
<a class="sourceLine" id="cb8-18" title="18">  }<span class="cf">else</span>{</a>
<a class="sourceLine" id="cb8-19" title="19">    exchange &lt;-<span class="st"> </span><span class="ot">FALSE</span></a>
<a class="sourceLine" id="cb8-20" title="20">    b0 &lt;-<span class="st"> </span>b; c0 &lt;-<span class="st"> </span>c</a>
<a class="sourceLine" id="cb8-21" title="21">  }</a>
<a class="sourceLine" id="cb8-22" title="22">  Nu2 &lt;-<span class="st"> </span>a0<span class="op">^</span><span class="dv">2</span></a>
<a class="sourceLine" id="cb8-23" title="23">  h2ab &lt;-<span class="st"> </span>b0<span class="op">^</span><span class="dv">2</span> <span class="op">+</span><span class="st"> </span>Nu2; h2ac &lt;-<span class="st"> </span>c0<span class="op">^</span><span class="dv">2</span> <span class="op">+</span><span class="st"> </span>Nu2</a>
<a class="sourceLine" id="cb8-24" title="24">  c2 &lt;-<span class="st"> </span><span class="dv">1</span>; a2 &lt;-<span class="st"> </span>c2 <span class="op">+</span><span class="st"> </span>h2ac; b2 &lt;-<span class="st"> </span>a2 <span class="op">-</span><span class="st"> </span>h2ab</a>
<a class="sourceLine" id="cb8-25" title="25">  h2bc &lt;-<span class="st"> </span>b2 <span class="op">-</span><span class="st"> </span>c2</a>
<a class="sourceLine" id="cb8-26" title="26">  <span class="co">#</span></a>
<a class="sourceLine" id="cb8-27" title="27">  <span class="cf">if</span>(b0 <span class="op">!=</span><span class="st"> </span>c0 <span class="op">&amp;&amp;</span><span class="st"> </span>c2<span class="op">+</span>du <span class="op">&gt;=</span><span class="st"> </span>b2){</a>
<a class="sourceLine" id="cb8-28" title="28">    <span class="kw">stop</span>(<span class="st">&quot;`du` is too large.&quot;</span>)</a>
<a class="sourceLine" id="cb8-29" title="29">  }</a>
<a class="sourceLine" id="cb8-30" title="30">  <span class="cf">if</span>(vmin <span class="op">&gt;=</span><span class="st"> </span>c2<span class="op">-</span>dv){</a>
<a class="sourceLine" id="cb8-31" title="31">    <span class="kw">stop</span>(<span class="st">&quot;`dv` is too large&quot;</span>)</a>
<a class="sourceLine" id="cb8-32" title="32">  }</a>
<a class="sourceLine" id="cb8-33" title="33">  v_ &lt;-<span class="st"> </span><span class="kw">seq</span>(vmin, c2<span class="op">-</span>dv, <span class="dt">length.out =</span> nv)</a>
<a class="sourceLine" id="cb8-34" title="34">  t_ &lt;-<span class="st"> </span><span class="kw">seq</span>(vmin, c2, <span class="dt">length.out =</span> npoints)</a>
<a class="sourceLine" id="cb8-35" title="35">  out &lt;-<span class="st"> </span><span class="kw">vector</span>(<span class="st">&quot;list&quot;</span>, <span class="dv">2</span><span class="op">*</span>nv <span class="op">+</span><span class="st"> </span><span class="dv">4</span><span class="op">*</span>nu <span class="op">-</span><span class="st"> </span><span class="dv">2</span>)</a>
<a class="sourceLine" id="cb8-36" title="36">  <span class="co">#</span></a>
<a class="sourceLine" id="cb8-37" title="37">  <span class="cf">if</span>(b0 <span class="op">!=</span><span class="st"> </span>c0){</a>
<a class="sourceLine" id="cb8-38" title="38">    u_ &lt;-<span class="st"> </span><span class="kw">seq</span>(c2<span class="op">+</span>du, b2, <span class="dt">length.out =</span> nu)</a>
<a class="sourceLine" id="cb8-39" title="39">    s_ &lt;-<span class="st"> </span><span class="kw">seq</span>(c2, b2, <span class="dt">length.out =</span> npoints)</a>
<a class="sourceLine" id="cb8-40" title="40">    mx &lt;-<span class="st"> </span>a0 <span class="op">/</span><span class="st"> </span><span class="kw">sqrt</span>(h2ac<span class="op">*</span>h2ab)</a>
<a class="sourceLine" id="cb8-41" title="41">    my &lt;-<span class="st"> </span>b0 <span class="op">/</span><span class="st"> </span><span class="kw">sqrt</span>(h2bc<span class="op">*</span>h2ab)</a>
<a class="sourceLine" id="cb8-42" title="42">    mz &lt;-<span class="st"> </span>c0 <span class="op">/</span><span class="st"> </span><span class="kw">sqrt</span>(h2bc<span class="op">*</span>h2ac)</a>
<a class="sourceLine" id="cb8-43" title="43">    <span class="cf">for</span>(j <span class="cf">in</span> 1L<span class="op">:</span>nv){</a>
<a class="sourceLine" id="cb8-44" title="44">      x &lt;-<span class="st"> </span>mx <span class="op">*</span><span class="st"> </span><span class="kw">sqrt</span>((a2<span class="op">-</span>s_)<span class="op">*</span>(a2<span class="op">-</span>v_[j]))</a>
<a class="sourceLine" id="cb8-45" title="45">      y &lt;-<span class="st"> </span>my <span class="op">*</span><span class="st"> </span><span class="kw">sqrt</span>((b2<span class="op">-</span>s_)<span class="op">*</span>(b2<span class="op">-</span>v_[j]))</a>
<a class="sourceLine" id="cb8-46" title="46">      z &lt;-<span class="st"> </span>mz <span class="op">*</span><span class="st"> </span><span class="kw">sqrt</span>((s_<span class="op">-</span>c2)<span class="op">*</span>(c2<span class="op">-</span>v_[j]))</a>
<a class="sourceLine" id="cb8-47" title="47">      M1 &lt;-<span class="st"> </span><span class="kw">rbind</span>(<span class="kw">cbind</span>(x, y, z), <span class="kw">cbind</span>(x, <span class="op">-</span>y, z)[(npoints<span class="dv">-1</span>)<span class="op">:</span>1L,])</a>
<a class="sourceLine" id="cb8-48" title="48">      M2 &lt;-<span class="st"> </span><span class="kw">cbind</span>(M1[,<span class="kw">c</span>(1L,2L)], <span class="op">-</span>M1[,3L])</a>
<a class="sourceLine" id="cb8-49" title="49">      M &lt;-<span class="st"> </span><span class="kw">rbind</span>(M1, M2[(<span class="dv">2</span><span class="op">*</span>npoints<span class="dv">-2</span>)<span class="op">:</span>1L,])</a>
<a class="sourceLine" id="cb8-50" title="50">      out[[j]] &lt;-<span class="st"> </span><span class="cf">if</span>(exchange) M[,<span class="kw">c</span>(1L,3L,2L)] <span class="cf">else</span> M</a>
<a class="sourceLine" id="cb8-51" title="51">      out[[nv<span class="op">+</span>j]] &lt;-<span class="st"> </span></a>
<a class="sourceLine" id="cb8-52" title="52"><span class="st">        </span><span class="kw">cbind</span>(<span class="op">-</span>M[,1L], <span class="cf">if</span>(exchange) M[,<span class="kw">c</span>(3L,2L)] <span class="cf">else</span> M[,<span class="kw">c</span>(2L,3L)])</a>
<a class="sourceLine" id="cb8-53" title="53">    }</a>
<a class="sourceLine" id="cb8-54" title="54">    <span class="cf">for</span>(i <span class="cf">in</span> 1L<span class="op">:</span>nu){</a>
<a class="sourceLine" id="cb8-55" title="55">      x &lt;-<span class="st"> </span>mx <span class="op">*</span><span class="st"> </span><span class="kw">sqrt</span>((a2<span class="op">-</span>u_[i])<span class="op">*</span>(a2<span class="op">-</span>t_))</a>
<a class="sourceLine" id="cb8-56" title="56">      y &lt;-<span class="st"> </span>my <span class="op">*</span><span class="st"> </span><span class="kw">sqrt</span>((b2<span class="op">-</span>u_[i])<span class="op">*</span>(b2<span class="op">-</span>t_))</a>
<a class="sourceLine" id="cb8-57" title="57">      z &lt;-<span class="st"> </span>mz <span class="op">*</span><span class="st"> </span><span class="kw">sqrt</span>((u_[i]<span class="op">-</span>c2)<span class="op">*</span>(c2<span class="op">-</span>t_))</a>
<a class="sourceLine" id="cb8-58" title="58">      M &lt;-<span class="st"> </span><span class="kw">rbind</span>(<span class="kw">cbind</span>(x, y, z), <span class="kw">cbind</span>(x, y, <span class="op">-</span>z)[(npoints<span class="dv">-1</span>)<span class="op">:</span>1L,])</a>
<a class="sourceLine" id="cb8-59" title="59">      out[[<span class="dv">2</span><span class="op">*</span>nv<span class="op">+</span>i]] &lt;-<span class="st"> </span><span class="cf">if</span>(exchange) M[,<span class="kw">c</span>(1L,3L,2L)] <span class="cf">else</span> M</a>
<a class="sourceLine" id="cb8-60" title="60">      <span class="cf">if</span>(i <span class="op">&lt;</span><span class="st"> </span>nu){</a>
<a class="sourceLine" id="cb8-61" title="61">        out[[<span class="dv">2</span><span class="op">*</span>nv<span class="op">+</span>nu<span class="op">+</span>i]] &lt;-<span class="st"> </span><span class="cf">if</span>(exchange) </a>
<a class="sourceLine" id="cb8-62" title="62">          <span class="kw">cbind</span>(M[,<span class="kw">c</span>(1L,3L)], <span class="op">-</span>M[,2L]) </a>
<a class="sourceLine" id="cb8-63" title="63">        <span class="cf">else</span> </a>
<a class="sourceLine" id="cb8-64" title="64">          <span class="kw">cbind</span>(M[,1L], <span class="op">-</span>M[,2L], M[,3L])</a>
<a class="sourceLine" id="cb8-65" title="65">      }</a>
<a class="sourceLine" id="cb8-66" title="66">    }</a>
<a class="sourceLine" id="cb8-67" title="67">  }<span class="cf">else</span>{ <span class="co"># b0 = c0</span></a>
<a class="sourceLine" id="cb8-68" title="68">    u_ &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="dv">0</span>, <span class="dv">2</span><span class="op">*</span>pi, <span class="dt">length.out =</span> nu<span class="op">+</span><span class="dv">1</span>)[<span class="op">-</span>1L] </a>
<a class="sourceLine" id="cb8-69" title="69">    s_ &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="dv">0</span>, <span class="dv">2</span><span class="op">*</span>pi, <span class="dt">length.out =</span> npoints)</a>
<a class="sourceLine" id="cb8-70" title="70">    mx &lt;-<span class="st"> </span>a0 <span class="op">/</span><span class="st"> </span><span class="kw">sqrt</span>(h2ac)</a>
<a class="sourceLine" id="cb8-71" title="71">    myz &lt;-<span class="st"> </span>b0 <span class="op">/</span><span class="st"> </span><span class="kw">sqrt</span>(h2ab)</a>
<a class="sourceLine" id="cb8-72" title="72">    <span class="cf">for</span>(j <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>nv){</a>
<a class="sourceLine" id="cb8-73" title="73">      x &lt;-<span class="st"> </span>mx <span class="op">*</span><span class="st"> </span><span class="kw">sqrt</span>(a2<span class="op">-</span>v_[j])</a>
<a class="sourceLine" id="cb8-74" title="74">      y &lt;-<span class="st"> </span>myz <span class="op">*</span><span class="st"> </span><span class="kw">sqrt</span>(b2<span class="op">-</span>v_[j]) <span class="op">*</span><span class="st"> </span><span class="kw">cos</span>(s_)</a>
<a class="sourceLine" id="cb8-75" title="75">      z &lt;-<span class="st"> </span>myz <span class="op">*</span><span class="st"> </span><span class="kw">sqrt</span>(c2<span class="op">-</span>v_[j]) <span class="op">*</span><span class="st"> </span><span class="kw">sin</span>(s_)</a>
<a class="sourceLine" id="cb8-76" title="76">      M &lt;-<span class="st"> </span><span class="kw">cbind</span>(x, y, z)</a>
<a class="sourceLine" id="cb8-77" title="77">      out[[j]] &lt;-<span class="st"> </span><span class="cf">if</span>(exchange) M[,<span class="kw">c</span>(1L,3L,2L)] <span class="cf">else</span> M</a>
<a class="sourceLine" id="cb8-78" title="78">      out[[nv<span class="op">+</span>j]] &lt;-<span class="st"> </span></a>
<a class="sourceLine" id="cb8-79" title="79"><span class="st">        </span><span class="kw">cbind</span>(<span class="op">-</span>M[,1L], <span class="cf">if</span>(exchange) M[,<span class="kw">c</span>(3L,2L)] <span class="cf">else</span> M[,<span class="kw">c</span>(2L,3L)])</a>
<a class="sourceLine" id="cb8-80" title="80">    }</a>
<a class="sourceLine" id="cb8-81" title="81">    <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>nu){</a>
<a class="sourceLine" id="cb8-82" title="82">      x &lt;-<span class="st"> </span>mx <span class="op">*</span><span class="st"> </span><span class="kw">sqrt</span>(a2<span class="op">-</span>t_)</a>
<a class="sourceLine" id="cb8-83" title="83">      y &lt;-<span class="st"> </span>myz <span class="op">*</span><span class="st"> </span><span class="kw">sqrt</span>(b2<span class="op">-</span>t_) <span class="op">*</span><span class="st"> </span><span class="kw">cos</span>(u_[i])</a>
<a class="sourceLine" id="cb8-84" title="84">      z &lt;-<span class="st"> </span>myz <span class="op">*</span><span class="st"> </span><span class="kw">sqrt</span>(c2<span class="op">-</span>t_) <span class="op">*</span><span class="st"> </span><span class="kw">sin</span>(u_[i])</a>
<a class="sourceLine" id="cb8-85" title="85">      M &lt;-<span class="st"> </span><span class="kw">rbind</span>(<span class="kw">cbind</span>(x, y, z), <span class="kw">cbind</span>(x, <span class="op">-</span>y, <span class="op">-</span>z)[(npoints<span class="dv">-1</span>)<span class="op">:</span>1L,])</a>
<a class="sourceLine" id="cb8-86" title="86">      out[[<span class="dv">2</span><span class="op">*</span>nv<span class="op">+</span>i]] &lt;-<span class="st"> </span><span class="cf">if</span>(exchange) M[,<span class="kw">c</span>(1L,3L,2L)] <span class="cf">else</span> M</a>
<a class="sourceLine" id="cb8-87" title="87">      <span class="cf">if</span>(i <span class="op">&lt;</span><span class="st"> </span>nu){</a>
<a class="sourceLine" id="cb8-88" title="88">        out[[<span class="dv">2</span><span class="op">*</span>nv<span class="op">+</span>nu<span class="op">+</span>i]] &lt;-<span class="st"> </span><span class="cf">if</span>(exchange) </a>
<a class="sourceLine" id="cb8-89" title="89">          <span class="kw">cbind</span>(M[,<span class="kw">c</span>(1L,3L)], <span class="op">-</span>M[,2L]) </a>
<a class="sourceLine" id="cb8-90" title="90">        <span class="cf">else</span> </a>
<a class="sourceLine" id="cb8-91" title="91">          <span class="kw">cbind</span>(M[,1L], <span class="op">-</span>M[,2L], M[,3L])</a>
<a class="sourceLine" id="cb8-92" title="92">      }</a>
<a class="sourceLine" id="cb8-93" title="93">    }</a>
<a class="sourceLine" id="cb8-94" title="94">  }</a>
<a class="sourceLine" id="cb8-95" title="95">  <span class="co">#</span></a>
<a class="sourceLine" id="cb8-96" title="96">  out[(<span class="dv">2</span><span class="op">*</span>nv<span class="op">+</span><span class="dv">2</span><span class="op">*</span>nu)<span class="op">:</span>(<span class="dv">2</span><span class="op">*</span>nv<span class="op">+</span><span class="dv">4</span><span class="op">*</span>nu<span class="dv">-2</span>)] &lt;-<span class="st"> </span></a>
<a class="sourceLine" id="cb8-97" title="97"><span class="st">    </span><span class="kw">lapply</span>(out[(<span class="dv">2</span><span class="op">*</span>nv<span class="op">+</span><span class="dv">1</span>)<span class="op">:</span>(<span class="dv">2</span><span class="op">*</span>nv<span class="op">+</span><span class="dv">2</span><span class="op">*</span>nu<span class="dv">-1</span>)], <span class="cf">function</span>(M){</a>
<a class="sourceLine" id="cb8-98" title="98">      <span class="kw">cbind</span>(<span class="op">-</span>M[,1L], M[,<span class="kw">c</span>(2L,3L)])</a>
<a class="sourceLine" id="cb8-99" title="99">    })</a>
<a class="sourceLine" id="cb8-100" title="100">  out</a>
<a class="sourceLine" id="cb8-101" title="101">}</a></code></pre></div>
<p>An example:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" title="1">a =<span class="st"> </span><span class="dv">6</span>; b =<span class="st"> </span><span class="dv">5</span>; c =<span class="st"> </span><span class="dv">3</span></a>
<a class="sourceLine" id="cb9-2" title="2">sgntr =<span class="st"> &quot;-+-&quot;</span></a>
<a class="sourceLine" id="cb9-3" title="3">mesh &lt;-<span class="st"> </span><span class="kw">twoSheetsHyperboloidMesh</span>(a, b, c, sgntr, <span class="dv">100</span>, <span class="dv">100</span>, <span class="dt">vmin =</span> <span class="dv">-500</span>)</a>
<a class="sourceLine" id="cb9-4" title="4">clines &lt;-<span class="st"> </span><span class="kw">curvatureLinesH2</span>(a, b, c, sgntr, <span class="dt">nu =</span> <span class="dv">5</span>, <span class="dt">nv =</span> <span class="dv">5</span>, <span class="dt">vmin =</span> <span class="dv">-500</span>, </a>
<a class="sourceLine" id="cb9-5" title="5">                           <span class="dt">du =</span> <span class="dv">1</span>, <span class="dt">dv =</span> <span class="dv">20</span>, <span class="dt">npoints =</span> <span class="dv">300</span>)</a>
<a class="sourceLine" id="cb9-6" title="6"><span class="kw">shade3d</span>(mesh, <span class="dt">color =</span> <span class="st">&quot;navyblue&quot;</span>, <span class="dt">back =</span> <span class="st">&quot;culled&quot;</span>) </a>
<a class="sourceLine" id="cb9-7" title="7"><span class="kw">shade3d</span>(mesh, <span class="dt">color =</span> <span class="st">&quot;goldenrod&quot;</span>, <span class="dt">front =</span> <span class="st">&quot;culled&quot;</span>)</a>
<a class="sourceLine" id="cb9-8" title="8"><span class="kw">invisible</span>(<span class="kw">lapply</span>(clines, <span class="cf">function</span>(l){</a>
<a class="sourceLine" id="cb9-9" title="9">  <span class="kw">shade3d</span>(<span class="kw">cylinder3d</span>(l, <span class="dt">radius =</span> <span class="fl">0.2</span>, <span class="dt">sides =</span> <span class="dv">30</span>))</a>
<a class="sourceLine" id="cb9-10" title="10">}))</a></code></pre></div>
<p><img src="figures/quadrics_H2.png" /></p>
<h1 id="general-quadric">General quadric</h1>
<p>A general quadric in <span class="math inline">\(\mathbb{R}^3\)</span> has equation <span class="math display">\[
(x \quad y \quad z)\, A 
\begin{pmatrix} x \\ y \\ z \end{pmatrix} 
+ J&#39; \begin{pmatrix} x \\ y \\ z \end{pmatrix}
+ K = 0,
\]</span> where <span class="math inline">\(A\)</span> is a symmetric <span class="math inline">\((3\times 3)\)</span>-matrix, <span class="math inline">\(J \in \mathbb{R}^3\)</span>, and <span class="math inline">\(K \in \mathbb{R}\)</span>. Let’s treat an example. We follow the strategy given at page 45 of Brannan &amp; al’s book <em>Geometry</em> (<a href="http://math.haifa.ac.il/ROVENSKI/B2.pdf">pdf</a>).</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" title="1">A =<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">c</span>(</a>
<a class="sourceLine" id="cb10-2" title="2">   <span class="dv">5</span>, <span class="dv">-1</span>, <span class="dv">-1</span>, </a>
<a class="sourceLine" id="cb10-3" title="3">  <span class="dv">-1</span>,  <span class="dv">3</span>,  <span class="dv">1</span>,</a>
<a class="sourceLine" id="cb10-4" title="4">  <span class="dv">-1</span>,  <span class="dv">1</span>, <span class="dv">-3</span></a>
<a class="sourceLine" id="cb10-5" title="5">  ), <span class="dt">nrow =</span> 3L, <span class="dt">ncol =</span> 3L)</a>
<a class="sourceLine" id="cb10-6" title="6">J =<span class="st"> </span><span class="kw">c</span>(<span class="dv">4</span>, <span class="dv">6</span>, <span class="dv">8</span>)</a>
<a class="sourceLine" id="cb10-7" title="7">K =<span class="st"> </span><span class="dv">-10</span></a>
<a class="sourceLine" id="cb10-8" title="8"><span class="co"># computes spectral decomposition of A</span></a>
<a class="sourceLine" id="cb10-9" title="9">eig &lt;-<span class="st"> </span><span class="kw">eigen</span>(A)</a>
<a class="sourceLine" id="cb10-10" title="10">P &lt;-<span class="st"> </span>eig<span class="op">$</span>vectors</a>
<a class="sourceLine" id="cb10-11" title="11">( evalues &lt;-<span class="st"> </span>eig<span class="op">$</span>values )</a>
<a class="sourceLine" id="cb10-12" title="12"><span class="co">## [1]  5.614627  2.632676 -3.247303</span></a></code></pre></div>
<p>There is no eigenvalue equal to <span class="math inline">\(0\)</span>; this is the first necessary condition in order for the solution of the equation to be a focal quadric.</p>
<p>Now we write the equation in the form <span class="math display">\[
\lambda_1 {(x&#39;&#39;)}^2 + \lambda_2 {(y&#39;&#39;)}^2 + \lambda_3 {(z&#39;&#39;)}^2 = 
\mathrm{rhs}
\]</span> where <span class="math inline">\(\lambda_1\)</span>, <span class="math inline">\(\lambda_2\)</span>, <span class="math inline">\(\lambda_3\)</span> are the eigenvalues of <span class="math inline">\(A\)</span>, and <span class="math inline">\((x&#39;&#39;,y&#39;&#39;,z&#39;&#39;)\)</span> is a new coordinate system.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" title="1">center &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="kw">t</span>(J) <span class="op">%*%</span><span class="st"> </span>P) <span class="op">/</span><span class="st"> </span>evalues <span class="op">/</span><span class="st"> </span><span class="dv">2</span></a>
<a class="sourceLine" id="cb11-2" title="2">( rhs &lt;-<span class="st"> </span><span class="kw">sum</span>(evalues <span class="op">*</span><span class="st"> </span>center<span class="op">^</span><span class="dv">2</span>) <span class="op">-</span><span class="st"> </span>K )</a>
<a class="sourceLine" id="cb11-3" title="3"><span class="co">## [1] 11.5</span></a>
<a class="sourceLine" id="cb11-4" title="4">( sgntr &lt;-<span class="st"> </span><span class="kw">paste0</span>(<span class="kw">ifelse</span>(rhs<span class="op">*</span>evalues <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>, <span class="st">&quot;+&quot;</span>, <span class="st">&quot;-&quot;</span>), <span class="dt">collapse =</span> <span class="st">&quot;&quot;</span>) )</a>
<a class="sourceLine" id="cb11-5" title="5"><span class="co">## [1] &quot;++-&quot;</span></a></code></pre></div>
<p>We find <span class="math inline">\(\mathrm{rhs} \neq 0\)</span>, so the solution of the equation is a focal quadric. If <span class="math inline">\(\mathrm{rhs} = 0\)</span>, the solution is a cone.</p>
<p>The signature is <span class="math inline">\(++-\)</span>, so the solution of the equation is a one-sheeted hyperboloid. By dividing both members of the previous equality by <span class="math inline">\(\mathrm{rhs}\)</span>, we get its equation in standard form.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" title="1">abc &lt;-<span class="st"> </span><span class="kw">sqrt</span>(<span class="kw">abs</span>(rhs<span class="op">/</span>evalues))</a>
<a class="sourceLine" id="cb12-2" title="2">a &lt;-<span class="st"> </span>abc[<span class="dv">1</span>]; b &lt;-<span class="st"> </span>abc[<span class="dv">2</span>]; c &lt;-<span class="st"> </span>abc[<span class="dv">3</span>]</a>
<a class="sourceLine" id="cb12-3" title="3">mesh0 &lt;-<span class="st"> </span><span class="kw">hyperboloidMesh</span>(a, b, c, sgntr, <span class="dv">100</span>, <span class="dv">100</span>, <span class="dv">-5</span>)</a>
<a class="sourceLine" id="cb12-4" title="4"><span class="co"># final quadric mesh:</span></a>
<a class="sourceLine" id="cb12-5" title="5">mesh &lt;-<span class="st"> </span><span class="kw">rotate3d</span>(</a>
<a class="sourceLine" id="cb12-6" title="6">  <span class="kw">translate3d</span>(mesh0, <span class="op">-</span>center[<span class="dv">1</span>], <span class="op">-</span>center[<span class="dv">2</span>], <span class="op">-</span>center[<span class="dv">3</span>]), </a>
<a class="sourceLine" id="cb12-7" title="7">  <span class="dt">matrix =</span> <span class="kw">t</span>(P)</a>
<a class="sourceLine" id="cb12-8" title="8">)</a></code></pre></div>
<p>We can check that the equation is fulfilled for some vertices of the final mesh:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb13-1" title="1"><span class="kw">apply</span>(mesh<span class="op">$</span>vb[<span class="op">-</span><span class="dv">4</span>, <span class="dv">1</span><span class="op">:</span><span class="dv">5</span>], 2L, <span class="cf">function</span>(x){</a>
<a class="sourceLine" id="cb13-2" title="2">  <span class="kw">c</span>(<span class="kw">t</span>(x) <span class="op">%*%</span><span class="st"> </span>A <span class="op">%*%</span><span class="st"> </span>x <span class="op">+</span><span class="st"> </span><span class="kw">t</span>(J) <span class="op">%*%</span><span class="st"> </span>x) <span class="op">+</span><span class="st"> </span>K</a>
<a class="sourceLine" id="cb13-3" title="3">})</a>
<a class="sourceLine" id="cb13-4" title="4"><span class="co">## [1] 5.684342e-14 7.105427e-14 4.973799e-14 4.973799e-14 4.263256e-14</span></a></code></pre></div>
<p>Up to small numerical errors, we indeed get <span class="math inline">\(0\)</span> for each of the five vertices.</p>

        </div>


        <div id="footer">
          Site proudly generated by
          <a href="http://jaspervdj.be/hakyll">Hakyll</a>
        </div>

      </div>

    </div>

    <div class="row">
      <div class="col-sm-12">
        <div id="disqus_thread"></div>
        <div class="pagination">
          <ul>
            <li>
              <a href="http://laustep.github.io/stlahblog/">&#171; Back Home</a>
            </li>
          </ul>
        </div>
      </div>
    </div>
    
  </div>

</body>

<script src="/libraries/bootstrap/bootstrap.min.js"></script>
<script>
  var disqus_developer = 1;
  var disqus_shortname = 'stlapblog';
  // required: replace example with your forum shortname
  /* * * DON'T EDIT BELOW THIS LINE * * */
  (function () {
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = 'https://' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] ||
      document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>
<noscript>Please enable JavaScript to view the
  <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a>
</noscript>
<!-- MathJax: Fall back to local if CDN offline but local image fonts are not supported (saves >100MB) -->
<script type="text/x-mathjax-config" src="../libraries/mathjax/config/TeX-MML-AM_CHTML.js"></script>
<!-- <script>
  window.MathJax || document.write('<script type="text/x-mathjax-config">MathJax.Hub.Config({"HTML-CSS":{imageFont:null}});<\/script><script src="../libraries/mathjax/MathJax.js"><\/script>');
</script> -->

  <!-- Google Prettify -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prettify/188.0.0/prettify.js"></script>
  <!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/prettify/r298/prettify.js"></script> -->
  <script src="/libraries/highlighters/prettify/js/lang-r.js"></script>
  <script>
    var pres = document.getElementsByTagName("pre");
    for (var i = 0; i < pres.length; ++i) {
      
        pres[i].className = pres[i].className + " prettyprint linenums";
      
    }
    prettyPrint();
  </script> 


</html>]]></description>
    <pubDate>Sun, 03 May 2020 00:00:00 UT</pubDate>
    <guid>https://laustep.github.io/stlahblog/posts/focalQuadrics.html</guid>
    <dc:creator>Stéphane Laurent</dc:creator>
    
        <category>R</category>
    
</item><item>
    <title>Drawing slices of a hypersurface with R</title>
    <link>https://laustep.github.io/stlahblog/posts/slicedHypersurface.html</link>
    <description><![CDATA[<!DOCTYPE HTML>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Saturn Elephant - Drawing slices of a hypersurface with R</title>
  <link href="/libraries/bootstrap/bootstrap-grid.min.css" rel="stylesheet">
  <link rel="stylesheet" href="/css/post.css" />
  <link rel="stylesheet" href="/css/misc.css" /> 
  
    <link rel="stylesheet" href="/css/pandoc-solarized.css" /> 
   
  
    <link href="/libraries/highlighters/prettify/css/minimal.css" rel="stylesheet"> 
  
  <link href="https://fonts.googleapis.com/css?family=Raleway:400,600,200,800" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/css?family=Droid+Sans" rel="stylesheet" type="text/css">
  <script src="/libraries/jquery.min.js"></script>
  <script type="text/javascript" async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML"></script>
</head>

<body>
  <div class="container-fluid">
    <div class="row">
      <!-- Sidebar. -->
      <div class="sidebar col-sm-3">
        <div style="float:right;clear:both;margin-right:50px;margin-top:150px;">
          <a href="https://www.r-bloggers.com/">
            <img src="https://www.r-bloggers.com/wp-content/uploads/2016/04/R_02_2016-05-01.png" alt="stla" width="100%" />
          </a>
          <br/>
          <a href="http://t-redactyl.io/">
            <span style="color:black;font-weight:bold;font-family:sans-serif;font-size:29px;">Standard error</span>
          </a>
          <a href="http://timelyportfolio.blogspot.be/">
            <span style="color:grey;font-weight:bold;font-family:sans-serif;font-size:27px;">Timely portfolio</span>
          </a>
          <br/>
          <a href="https://antoineguillot.wordpress.com/blog/">
            <span style="color:white;background-color:darkblue;font-weight:bold;font-family:sans-serif;font-size:25px;border:5px solid;border-color:darkblue">ENHANCE DATA</span>
          </a>
          <br/>
          <a href="https://fronkonstin.com/">
            <span style="color:black;background-color:gold;font-weight:bold;font-size:32px;border:3px solid;border-color:gold;">Fronkonstin</span>
          </a>
        </div>
      </div>

      <div class="main col-sm-9">
        <div id="header">
          <div id="logo" style="position:absolute;">
            <a href="/">
              <img src="../images/stla.jpg" alt="stla" width="100px" />
            </a>
          </div>
          <div id="navigation" style="margin-top:50px;">
            <a href="/">Home</a>
            <a href="/about.html">About</a>
            <a href="/contact.html">Contact</a>
            <a href="/archive.html">Archive</a>
          </div>
        </div>

        <div class="content">
          <h1>Drawing slices of a hypersurface with R</h1> 
          <div class="info">
    Posted on May  1, 2020
    
        by Stéphane Laurent
    
</div>
<div class="info">
    
    Tags: <a href="/tags/R.html">R</a>, <a href="/tags/graphics.html">graphics</a>, <a href="/tags/rgl.html">rgl</a>, <a href="/tags/geometry.html">geometry</a>, <a href="/tags/maths.html">maths</a>
    
</div>

<p>Let <span class="math inline">\(s \colon I \times J \times K \to \mathbb{R}^4\)</span> be a parameterization of a hypersurface <span class="math inline">\(\mathcal{S}\)</span>, where <span class="math inline">\(I,J,K \subset \mathbb{R}\)</span> are some intervals. I’m going to show how to draw the cross-section of <span class="math inline">\(\mathcal{S}\)</span> by a hyperplane with R.</p>
<p>For the illustration, we consider the <a href="http://hi.gher.space/wiki/Tiger"><em>tiger</em></a>:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" title="1">R1 =<span class="st"> </span><span class="dv">2</span>; R2 =<span class="st"> </span><span class="dv">2</span>; r =<span class="st"> </span><span class="fl">0.5</span></a>
<a class="sourceLine" id="cb1-2" title="2">s &lt;-<span class="st"> </span><span class="cf">function</span>(u, v, w){</a>
<a class="sourceLine" id="cb1-3" title="3">  <span class="kw">rbind</span>(</a>
<a class="sourceLine" id="cb1-4" title="4">    <span class="kw">cos</span>(u) <span class="op">*</span><span class="st"> </span>(R1 <span class="op">+</span><span class="st"> </span>r<span class="op">*</span><span class="kw">cos</span>(w)),</a>
<a class="sourceLine" id="cb1-5" title="5">    <span class="kw">sin</span>(u) <span class="op">*</span><span class="st"> </span>(R1 <span class="op">+</span><span class="st"> </span>r<span class="op">*</span><span class="kw">cos</span>(w)),</a>
<a class="sourceLine" id="cb1-6" title="6">    <span class="kw">cos</span>(v) <span class="op">*</span><span class="st"> </span>(R2 <span class="op">+</span><span class="st"> </span>r<span class="op">*</span><span class="kw">sin</span>(w)),</a>
<a class="sourceLine" id="cb1-7" title="7">    <span class="kw">sin</span>(v) <span class="op">*</span><span class="st"> </span>(R2 <span class="op">+</span><span class="st"> </span>r<span class="op">*</span><span class="kw">sin</span>(w))</a>
<a class="sourceLine" id="cb1-8" title="8">  )</a>
<a class="sourceLine" id="cb1-9" title="9">}</a></code></pre></div>
<p>Take a hyperplane: <span class="math display">\[
\mathcal{P}\colon \quad \langle \mathbf{a}, \mathbf{x} \rangle = b,
\]</span> let <span class="math inline">\(\vec{\mathbf{n}} = \frac{\mathbf{a}}{\Vert\mathbf{a}\Vert}\)</span> be a unit normal vector of <span class="math inline">\(\mathcal{P}\)</span>, and <span class="math inline">\(\mathbf{x}_0\)</span> be an arbitrary point in <span class="math inline">\(\mathcal{P}\)</span>.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" title="1">a =<span class="st"> </span><span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>); b =<span class="st"> </span><span class="dv">2</span>        <span class="co"># plane x+y+z+w = 2</span></a>
<a class="sourceLine" id="cb2-2" title="2">x0 =<span class="st"> </span><span class="kw">c</span>(b, b, b, b)<span class="op">/</span><span class="dv">4</span>            <span class="co"># a point in this plane</span></a>
<a class="sourceLine" id="cb2-3" title="3">nrml &lt;-<span class="st"> </span>a<span class="op">/</span><span class="kw">sqrt</span>(<span class="kw">c</span>(<span class="kw">crossprod</span>(a))) <span class="co"># unit normal</span></a></code></pre></div>
<p>Compute a mesh <span class="math inline">\(\mathcal{M}_0\)</span> of the isosurface <span class="math display">\[
\bigl(s(u,v,w) - \mathbf{x}_0\bigr) \cdot \vec{\mathbf{n}} = 0.
\]</span></p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" title="1"><span class="kw">library</span>(misc3d)</a>
<a class="sourceLine" id="cb3-2" title="2">f &lt;-<span class="st"> </span><span class="cf">function</span>(u, v, w){</a>
<a class="sourceLine" id="cb3-3" title="3">  <span class="kw">c</span>(<span class="kw">crossprod</span>(<span class="kw">s</span>(u, v, w), nrml))</a>
<a class="sourceLine" id="cb3-4" title="4">}</a>
<a class="sourceLine" id="cb3-5" title="5">u_ &lt;-<span class="st"> </span>v_ &lt;-<span class="st"> </span>w_ &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="dv">0</span>, <span class="dv">2</span><span class="op">*</span>pi, <span class="dt">length.out =</span> 100L)</a>
<a class="sourceLine" id="cb3-6" title="6">g &lt;-<span class="st"> </span><span class="kw">expand.grid</span>(<span class="dt">u =</span> u_, <span class="dt">v =</span> v_, <span class="dt">w =</span> w_)</a>
<a class="sourceLine" id="cb3-7" title="7">voxel &lt;-<span class="st"> </span><span class="kw">array</span>(<span class="kw">with</span>(g, <span class="kw">f</span>(u,v,w)), <span class="dt">dim =</span> <span class="kw">c</span>(100L,100L,100L))</a>
<a class="sourceLine" id="cb3-8" title="8">surf &lt;-<span class="st"> </span><span class="kw">computeContour3d</span>(voxel, <span class="dt">level =</span> <span class="kw">sum</span>(x0<span class="op">*</span>nrml), </a>
<a class="sourceLine" id="cb3-9" title="9">                         <span class="dt">x =</span> u_, <span class="dt">y =</span> v_, <span class="dt">z =</span> w_)</a>
<a class="sourceLine" id="cb3-10" title="10">trgls &lt;-<span class="st"> </span><span class="kw">makeTriangles</span>(surf)</a>
<a class="sourceLine" id="cb3-11" title="11">mesh0 &lt;-<span class="st"> </span>misc3d<span class="op">:::</span><span class="kw">t2ve</span>(trgls)</a></code></pre></div>
<p>Denote by <span class="math inline">\(\mathcal{V}\mathcal{S}_0 \subset I \times J \times K\)</span> the set of vertices of <span class="math inline">\(\mathcal{M}_0\)</span>, and set <span class="math inline">\(\mathcal{V}\mathcal{S} = s(\mathcal{V}\mathcal{S}_0) \subset \mathbb{R}^4\)</span>.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" title="1">VS0 &lt;-<span class="st"> </span>mesh0<span class="op">$</span>vb</a>
<a class="sourceLine" id="cb4-2" title="2">VS &lt;-<span class="st"> </span><span class="kw">s</span>(VS0[1L,], VS0[2L,], VS0[3L,]) </a></code></pre></div>
<p>Let <span class="math inline">\(R\)</span> be a rotation in <span class="math inline">\(\mathbb{R}^4\)</span> which sends <span class="math inline">\(\vec{\mathbf{n}} =: \vec{\mathbf{v}}_1\)</span> to the vector <span class="math inline">\((0,0,0,1) =: \vec{\mathbf{v}}_2\)</span>. One can take <span class="math inline">\(R\)</span> corresponding to the matrix <span class="math display">\[
\frac{2}{{(\vec{\mathbf{v}}_1+\vec{\mathbf{v}}_2)}&#39;
(\vec{\mathbf{v}}_1+\vec{\mathbf{v}}_2)}
(\vec{\mathbf{v}}_1+\vec{\mathbf{v}}_2)
{(\vec{\mathbf{v}}_1+\vec{\mathbf{v}}_2)}&#39; - I_4.
\]</span></p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" title="1">rotationMatrix4D &lt;-<span class="st"> </span><span class="cf">function</span>(v1, v2){</a>
<a class="sourceLine" id="cb5-2" title="2">  v1 &lt;-<span class="st"> </span>v1 <span class="op">/</span><span class="st"> </span><span class="kw">sqrt</span>(<span class="kw">c</span>(<span class="kw">crossprod</span>(v1)))</a>
<a class="sourceLine" id="cb5-3" title="3">  v2 &lt;-<span class="st"> </span>v2 <span class="op">/</span><span class="st"> </span><span class="kw">sqrt</span>(<span class="kw">c</span>(<span class="kw">crossprod</span>(v2)))</a>
<a class="sourceLine" id="cb5-4" title="4">  <span class="dv">2</span><span class="op">*</span><span class="kw">tcrossprod</span>(v1<span class="op">+</span>v2)<span class="op">/</span><span class="kw">c</span>(<span class="kw">crossprod</span>(v1<span class="op">+</span>v2)) <span class="op">-</span><span class="st"> </span><span class="kw">diag</span>(4L)</a>
<a class="sourceLine" id="cb5-5" title="5">}</a>
<a class="sourceLine" id="cb5-6" title="6">Rot &lt;-<span class="st"> </span><span class="kw">rotationMatrix4D</span>(nrml, <span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">1</span>))</a></code></pre></div>
<p>Now define <span class="math inline">\(\mathcal{V}\mathcal{S}&#39; = R(\mathcal{V}\mathcal{S}) \subset \mathbb{R}^4\)</span>. Then all points in <span class="math inline">\(\mathcal{V}\mathcal{S}&#39;\)</span> are equal on their fourth coordinate (up to numerical errors in R):</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" title="1">VSprime &lt;-<span class="st"> </span>Rot <span class="op">%*%</span><span class="st"> </span>VS</a>
<a class="sourceLine" id="cb6-2" title="2"><span class="kw">head</span>(<span class="kw">t</span>(VSprime))</a>
<a class="sourceLine" id="cb6-3" title="3"><span class="co">##           [,1]      [,2]      [,3]      [,4]</span></a>
<a class="sourceLine" id="cb6-4" title="4"><span class="co">## [1,]  2.203740 -1.329658 -1.620365 0.9999785</span></a>
<a class="sourceLine" id="cb6-5" title="5"><span class="co">## [2,] -1.324840  2.206491 -1.657871 1.0002417</span></a>
<a class="sourceLine" id="cb6-6" title="6"><span class="co">## [3,] -1.320131  2.212244 -1.636339 0.9999972</span></a>
<a class="sourceLine" id="cb6-7" title="7"><span class="co">## [4,] -1.417790  2.116178 -1.698381 0.9999926</span></a>
<a class="sourceLine" id="cb6-8" title="8"><span class="co">## [5,]  2.219859 -1.310784 -1.651340 0.9999841</span></a>
<a class="sourceLine" id="cb6-9" title="9"><span class="co">## [6,]  2.253515 -1.275147 -1.633245 1.0005005</span></a></code></pre></div>
<p>Finally, define <span class="math inline">\(\mathcal{V}\mathcal{S}&#39;&#39; \subset \mathbb{R}^3\)</span> as the set obtained by removing the fourth coordinates of the elements of <span class="math inline">\(\mathcal{V}\mathcal{S}&#39;\)</span>, and define the mesh <span class="math inline">\(\mathcal{M}\)</span> whose set of vertices is <span class="math inline">\(\mathcal{V}\mathcal{S}&#39;&#39;\)</span> and with the same edges as <span class="math inline">\(\mathcal{M}_0\)</span>:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" title="1"><span class="kw">library</span>(rgl)</a>
<a class="sourceLine" id="cb7-2" title="2">mesh &lt;-<span class="st"> </span><span class="kw">tmesh3d</span>(</a>
<a class="sourceLine" id="cb7-3" title="3">  <span class="dt">vertices =</span> VSprime[<span class="op">-</span>4L,],</a>
<a class="sourceLine" id="cb7-4" title="4">  <span class="dt">indices =</span> mesh0<span class="op">$</span>ib,</a>
<a class="sourceLine" id="cb7-5" title="5">  <span class="dt">homogeneous =</span> <span class="ot">FALSE</span>,</a>
<a class="sourceLine" id="cb7-6" title="6">  <span class="dt">normals =</span> ?</a>
<a class="sourceLine" id="cb7-7" title="7">)</a></code></pre></div>
<p>What about the normals? If you have an implicit equation defining <span class="math inline">\(\mathcal{S}\)</span>, that is, <span class="math inline">\(\mathcal{S} = \iota^{-1}(0)\)</span> with <span class="math inline">\(\iota\colon \mathbb{R}^4 \to \mathbb{R}\)</span>, then a normal to <span class="math inline">\(\mathcal{S}\)</span> at a point <span class="math inline">\(\mathbf{x} \in \mathbb{R}^4\)</span> is given by the gradient of <span class="math inline">\(\iota\)</span> at <span class="math inline">\(\mathbf{x}\)</span>. For the tiger, we know an implicit equation, and it is not difficult to get the gradient:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" title="1">sNormal &lt;-<span class="st"> </span><span class="cf">function</span>(XYZT){</a>
<a class="sourceLine" id="cb8-2" title="2">  x &lt;-<span class="st"> </span>XYZT[1L,]; y &lt;-<span class="st"> </span>XYZT[2L,]; z &lt;-<span class="st"> </span>XYZT[3L,]; t &lt;-<span class="st"> </span>XYZT[4L,]</a>
<a class="sourceLine" id="cb8-3" title="3">  <span class="kw">rbind</span>(</a>
<a class="sourceLine" id="cb8-4" title="4">    x <span class="op">*</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">-</span><span class="st"> </span>R1<span class="op">/</span><span class="kw">sqrt</span>(x<span class="op">^</span><span class="dv">2</span><span class="op">+</span>y<span class="op">^</span><span class="dv">2</span>)),</a>
<a class="sourceLine" id="cb8-5" title="5">    y <span class="op">*</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">-</span><span class="st"> </span>R1<span class="op">/</span><span class="kw">sqrt</span>(x<span class="op">^</span><span class="dv">2</span><span class="op">+</span>y<span class="op">^</span><span class="dv">2</span>)),</a>
<a class="sourceLine" id="cb8-6" title="6">    z <span class="op">*</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">-</span><span class="st"> </span>R2<span class="op">/</span><span class="kw">sqrt</span>(z<span class="op">^</span><span class="dv">2</span><span class="op">+</span>t<span class="op">^</span><span class="dv">2</span>)),</a>
<a class="sourceLine" id="cb8-7" title="7">    t <span class="op">*</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">-</span><span class="st"> </span>R2<span class="op">/</span><span class="kw">sqrt</span>(z<span class="op">^</span><span class="dv">2</span><span class="op">+</span>t<span class="op">^</span><span class="dv">2</span>))</a>
<a class="sourceLine" id="cb8-8" title="8">  )</a>
<a class="sourceLine" id="cb8-9" title="9">}</a>
<a class="sourceLine" id="cb8-10" title="10">Normals &lt;-<span class="st"> </span><span class="kw">sNormal</span>(VS)</a></code></pre></div>
<p>Once you get the normals:</p>
<ul>
<li><p>project them to the hyperplane <span class="math inline">\(\mathcal{P}\)</span>;</p></li>
<li><p>apply the rotation <span class="math inline">\(R\)</span> to the projected normals;</p></li>
<li><p>remove the fourth coordinates (all equal);</p></li>
<li><p>if necessary, negate the normals.</p></li>
</ul>
<p>The projection of <span class="math inline">\(\mathbf{x} \in \mathbb{R}^4\)</span> to the hyperplane <span class="math inline">\(\mathcal{P}\)</span> is given by <span class="math display">\[
\mathbf{x} - 
\frac{\langle \mathbf{a}, \mathbf{x} \rangle - b}{\Vert \mathbf{a} \Vert^2} 
\mathbf{a}.
\]</span></p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" title="1"><span class="co"># projection onto hyperplane &lt;a,x&gt; = b</span></a>
<a class="sourceLine" id="cb9-2" title="2">projection &lt;-<span class="st"> </span><span class="cf">function</span>(a, b, X){</a>
<a class="sourceLine" id="cb9-3" title="3">  X <span class="op">-</span><span class="st"> </span><span class="kw">tcrossprod</span>(a<span class="op">/</span><span class="kw">c</span>(<span class="kw">crossprod</span>(a)), <span class="kw">colSums</span>(a<span class="op">*</span>X)<span class="op">-</span>b)</a>
<a class="sourceLine" id="cb9-4" title="4">}</a>
<a class="sourceLine" id="cb9-5" title="5">mesh &lt;-<span class="st"> </span><span class="kw">tmesh3d</span>(</a>
<a class="sourceLine" id="cb9-6" title="6">  <span class="dt">vertices =</span> VSprime[<span class="op">-</span>4L,], </a>
<a class="sourceLine" id="cb9-7" title="7">  <span class="dt">indices =</span> mesh0<span class="op">$</span>ib, </a>
<a class="sourceLine" id="cb9-8" title="8">  <span class="dt">homogeneous =</span> <span class="ot">FALSE</span>,</a>
<a class="sourceLine" id="cb9-9" title="9">  <span class="dt">normals =</span> <span class="op">-</span><span class="kw">t</span>((Rot <span class="op">%*%</span><span class="st"> </span><span class="kw">projection</span>(a, b, Normals))[<span class="op">-</span>4L,])</a>
<a class="sourceLine" id="cb9-10" title="10">)</a></code></pre></div>
<p>This works:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" title="1"><span class="kw">shade3d</span>(mesh, <span class="dt">color =</span> <span class="st">&quot;darkmagenta&quot;</span>)</a></code></pre></div>
<p><img src="figures/tiger1.png" /></p>
<p>Here is another way to get the normals. The normal at the point <span class="math inline">\(s(u,v,w)\)</span> is <span class="math display">\[
\frac{\partial s}{\partial u}(u,v,w) \times
\frac{\partial s}{\partial v}(u,v,w) \times
\frac{\partial s}{\partial w}(u,v,w) 
\]</span> where <span class="math inline">\(\cdot \times \cdot \times \cdot\)</span> is the <em>ternary cross-product</em> in <span class="math inline">\(\mathbb{R}^4\)</span>, defined by <span class="math display">\[
\vec v_1 \times \vec v_2 \times \vec v_3 = 
\left\vert\begin{matrix}
\vec i &amp; \vec j &amp; \vec k &amp; \vec l \\ 
v_{1x} &amp; v_{1y} &amp; v_{1z} &amp; v_{1t} \\ 
v_{2x} &amp; v_{2y} &amp; v_{2z} &amp; v_{2t} \\ 
v_{3x} &amp; v_{3y} &amp; v_{3z} &amp; v_{3t} 
\end{matrix}\right\vert.
\]</span></p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" title="1">crossProd4D &lt;-<span class="st"> </span><span class="cf">function</span>(v1, v2, v3){</a>
<a class="sourceLine" id="cb11-2" title="2">  M &lt;-<span class="st"> </span><span class="kw">rbind</span>(v1, v2, v3)</a>
<a class="sourceLine" id="cb11-3" title="3">  <span class="kw">c</span>(<span class="kw">det</span>(M[,<span class="op">-</span>1L]), <span class="op">-</span><span class="kw">det</span>(M[,<span class="op">-</span>2L]), <span class="kw">det</span>(M[,<span class="op">-</span>3L]), <span class="op">-</span><span class="kw">det</span>(M[,<span class="op">-</span>4L]))</a>
<a class="sourceLine" id="cb11-4" title="4">}</a>
<a class="sourceLine" id="cb11-5" title="5">sNormal &lt;-<span class="st"> </span><span class="cf">function</span>(uvw){</a>
<a class="sourceLine" id="cb11-6" title="6">  u &lt;-<span class="st"> </span>uvw[1L]; v &lt;-<span class="st"> </span>uvw[2L]; w &lt;-<span class="st"> </span>uvw[3L]</a>
<a class="sourceLine" id="cb11-7" title="7">  Du &lt;-<span class="st"> </span><span class="kw">c</span>((R1 <span class="op">+</span><span class="st"> </span>r<span class="op">*</span><span class="kw">cos</span>(w))<span class="op">*</span><span class="kw">c</span>(<span class="op">-</span><span class="kw">sin</span>(u),<span class="kw">cos</span>(u)), <span class="dv">0</span>, <span class="dv">0</span>)</a>
<a class="sourceLine" id="cb11-8" title="8">  Dv &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, (R2 <span class="op">+</span><span class="st"> </span>r<span class="op">*</span><span class="kw">sin</span>(w))<span class="op">*</span><span class="kw">c</span>(<span class="op">-</span><span class="kw">sin</span>(v),<span class="kw">cos</span>(v)))</a>
<a class="sourceLine" id="cb11-9" title="9">  Dw &lt;-<span class="st"> </span>r <span class="op">*</span><span class="st"> </span><span class="kw">c</span>(<span class="op">-</span><span class="kw">sin</span>(w)<span class="op">*</span><span class="kw">c</span>(<span class="kw">cos</span>(u),<span class="kw">sin</span>(u)), <span class="kw">cos</span>(w)<span class="op">*</span><span class="kw">c</span>(<span class="kw">cos</span>(v),<span class="kw">sin</span>(v)))</a>
<a class="sourceLine" id="cb11-10" title="10">  <span class="kw">crossProd4D</span>(Du, Dv, Dw)</a>
<a class="sourceLine" id="cb11-11" title="11">}</a>
<a class="sourceLine" id="cb11-12" title="12">Normals &lt;-<span class="st"> </span><span class="kw">apply</span>(VS0, 2L, sNormal)</a></code></pre></div>
<p>Then you can calculate the normals in this way and proceed as before:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" title="1">mesh &lt;-<span class="st"> </span><span class="kw">tmesh3d</span>(</a>
<a class="sourceLine" id="cb12-2" title="2">  <span class="dt">vertices =</span> VSprime[<span class="op">-</span>4L,], </a>
<a class="sourceLine" id="cb12-3" title="3">  <span class="dt">indices =</span> mesh0<span class="op">$</span>ib, </a>
<a class="sourceLine" id="cb12-4" title="4">  <span class="dt">homogeneous =</span> <span class="ot">FALSE</span>,</a>
<a class="sourceLine" id="cb12-5" title="5">  <span class="dt">normals =</span> <span class="kw">t</span>((Rot <span class="op">%*%</span><span class="st"> </span><span class="kw">projection</span>(a, b, Normals))[<span class="op">-</span>4L,])</a>
<a class="sourceLine" id="cb12-6" title="6">)</a></code></pre></div>
<p>Here is how to do an animation:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb13-1" title="1">b_ &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="op">-</span><span class="fl">11.5</span>, <span class="fl">11.5</span>, <span class="dt">length.out =</span> 60L)</a>
<a class="sourceLine" id="cb13-2" title="2"><span class="kw">open3d</span>(<span class="dt">windowRect =</span> <span class="kw">c</span>(<span class="dv">100</span>, <span class="dv">100</span>, <span class="dv">612</span>, <span class="dv">612</span>), <span class="dt">zoom =</span> <span class="fl">0.8</span>)</a>
<a class="sourceLine" id="cb13-3" title="3"><span class="kw">bg3d</span>(<span class="kw">rgb</span>(<span class="dv">54</span>, <span class="dv">57</span>, <span class="dv">64</span>, <span class="dt">maxColorValue =</span> <span class="dv">255</span>))</a>
<a class="sourceLine" id="cb13-4" title="4"><span class="kw">view3d</span>(<span class="dv">45</span>, <span class="dv">40</span>)</a>
<a class="sourceLine" id="cb13-5" title="5"><span class="cf">for</span>(i <span class="cf">in</span> 1L<span class="op">:</span><span class="kw">length</span>(b_)){</a>
<a class="sourceLine" id="cb13-6" title="6">  x0 &lt;-<span class="st"> </span><span class="kw">rep</span>(b_[i]<span class="op">/</span><span class="dv">4</span>, 4L) </a>
<a class="sourceLine" id="cb13-7" title="7">  surf &lt;-<span class="st"> </span><span class="kw">computeContour3d</span>(voxel, <span class="dt">level =</span> <span class="kw">sum</span>(x0<span class="op">*</span>nrml), </a>
<a class="sourceLine" id="cb13-8" title="8">                           <span class="dt">x =</span> u_, <span class="dt">y =</span> v_, <span class="dt">z =</span> w_)</a>
<a class="sourceLine" id="cb13-9" title="9">  trgls &lt;-<span class="st"> </span><span class="kw">makeTriangles</span>(surf)</a>
<a class="sourceLine" id="cb13-10" title="10">  mesh0 &lt;-<span class="st"> </span>misc3d<span class="op">:::</span><span class="kw">t2ve</span>(trgls)</a>
<a class="sourceLine" id="cb13-11" title="11">  VS0 &lt;-<span class="st"> </span>mesh0<span class="op">$</span>vb</a>
<a class="sourceLine" id="cb13-12" title="12">  VS &lt;-<span class="st"> </span><span class="kw">s</span>(VS0[1L,], VS0[2L,], VS0[3L,])</a>
<a class="sourceLine" id="cb13-13" title="13">  Normals &lt;-<span class="st"> </span><span class="kw">sNormal</span>(VS)</a>
<a class="sourceLine" id="cb13-14" title="14">  mesh &lt;-<span class="st"> </span><span class="kw">tmesh3d</span>(</a>
<a class="sourceLine" id="cb13-15" title="15">    <span class="dt">vertices =</span> (Rot <span class="op">%*%</span><span class="st"> </span>VS)[<span class="op">-</span>4L,], </a>
<a class="sourceLine" id="cb13-16" title="16">    <span class="dt">indices =</span> mesh0<span class="op">$</span>ib, </a>
<a class="sourceLine" id="cb13-17" title="17">    <span class="dt">homogeneous =</span> <span class="ot">FALSE</span>,</a>
<a class="sourceLine" id="cb13-18" title="18">    <span class="dt">normals =</span> <span class="op">-</span><span class="kw">t</span>((Rot <span class="op">%*%</span><span class="st"> </span><span class="kw">projection</span>(a, b_[i], Normals))[<span class="op">-</span>4L,])</a>
<a class="sourceLine" id="cb13-19" title="19">  )</a>
<a class="sourceLine" id="cb13-20" title="20">  <span class="kw">shade3d</span>(mesh, <span class="dt">color =</span> <span class="st">&quot;firebrick3&quot;</span>)</a>
<a class="sourceLine" id="cb13-21" title="21">  <span class="kw">snapshot3d</span>(<span class="kw">sprintf</span>(<span class="st">&quot;pic%03d.png&quot;</span>, i))</a>
<a class="sourceLine" id="cb13-22" title="22">  <span class="kw">clear3d</span>()</a>
<a class="sourceLine" id="cb13-23" title="23">}</a>
<a class="sourceLine" id="cb13-24" title="24"><span class="cf">for</span>(i <span class="cf">in</span> 1L<span class="op">:</span>59L){</a>
<a class="sourceLine" id="cb13-25" title="25">  <span class="kw">file.copy</span>(<span class="kw">sprintf</span>(<span class="st">&quot;pic%03d.png&quot;</span>, <span class="dv">60</span><span class="op">-</span>i), <span class="kw">sprintf</span>(<span class="st">&quot;pic%03d.png&quot;</span>, <span class="dv">60</span><span class="op">+</span>i))</a>
<a class="sourceLine" id="cb13-26" title="26">}</a>
<a class="sourceLine" id="cb13-27" title="27"><span class="co"># run gifski</span></a>
<a class="sourceLine" id="cb13-28" title="28">command &lt;-<span class="st"> &quot;gifski --fps 12 pic*.png -o slicedTiger.gif&quot;</span></a>
<a class="sourceLine" id="cb13-29" title="29"><span class="kw">system</span>(command)</a>
<a class="sourceLine" id="cb13-30" title="30"><span class="co"># cleaning</span></a>
<a class="sourceLine" id="cb13-31" title="31">pngfiles &lt;-<span class="st"> </span><span class="kw">list.files</span>(<span class="dt">pattern =</span> <span class="st">&quot;^pic.*png$&quot;</span>)</a>
<a class="sourceLine" id="cb13-32" title="32"><span class="kw">file.remove</span>(pngfiles)</a></code></pre></div>
<p><img src="figures/tiger2.gif" /></p>
<h2 id="toroidal-hyperboloid">Toroidal hyperboloid</h2>
<p>Let’s give another example, a <em>toroidal hyperboloid</em>. This is a quadric with implicit equation <span class="math display">\[
\frac{x^2}{a^2} + \frac{y^2}{b^2} - \frac{z^2}{c^2} - \frac{t^2}{d^2} = 1,
\]</span> and a parameterization of this quadric is <span class="math display">\[
\begin{array}{ccc}
s \colon &amp; (0,2\pi) \times (0,2\pi) \times (0, +\infty[ &amp; 
\longrightarrow &amp; \mathbb{R}^4 \\
 &amp; (u,v,w) &amp; \longmapsto &amp; 
\begin{pmatrix}
a \cos u \cosh w \\ 
b \sin u \cosh w \\
c \cos v \sinh w \\
d \sin v \sinh w 
\end{pmatrix}
\end{array}.
\]</span></p>
<p><img src="figures/toroidalHyperboloid.gif" /></p>

        </div>


        <div id="footer">
          Site proudly generated by
          <a href="http://jaspervdj.be/hakyll">Hakyll</a>
        </div>

      </div>

    </div>

    <div class="row">
      <div class="col-sm-12">
        <div id="disqus_thread"></div>
        <div class="pagination">
          <ul>
            <li>
              <a href="http://laustep.github.io/stlahblog/">&#171; Back Home</a>
            </li>
          </ul>
        </div>
      </div>
    </div>
    
  </div>

</body>

<script src="/libraries/bootstrap/bootstrap.min.js"></script>
<script>
  var disqus_developer = 1;
  var disqus_shortname = 'stlapblog';
  // required: replace example with your forum shortname
  /* * * DON'T EDIT BELOW THIS LINE * * */
  (function () {
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = 'https://' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] ||
      document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>
<noscript>Please enable JavaScript to view the
  <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a>
</noscript>
<!-- MathJax: Fall back to local if CDN offline but local image fonts are not supported (saves >100MB) -->
<script type="text/x-mathjax-config" src="../libraries/mathjax/config/TeX-MML-AM_CHTML.js"></script>
<!-- <script>
  window.MathJax || document.write('<script type="text/x-mathjax-config">MathJax.Hub.Config({"HTML-CSS":{imageFont:null}});<\/script><script src="../libraries/mathjax/MathJax.js"><\/script>');
</script> -->

  <!-- Google Prettify -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prettify/188.0.0/prettify.js"></script>
  <!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/prettify/r298/prettify.js"></script> -->
  <script src="/libraries/highlighters/prettify/js/lang-r.js"></script>
  <script>
    var pres = document.getElementsByTagName("pre");
    for (var i = 0; i < pres.length; ++i) {
      
        pres[i].className = pres[i].className + " prettyprint linenums";
      
    }
    prettyPrint();
  </script> 


</html>]]></description>
    <pubDate>Fri, 01 May 2020 00:00:00 UT</pubDate>
    <guid>https://laustep.github.io/stlahblog/posts/slicedHypersurface.html</guid>
    <dc:creator>Stéphane Laurent</dc:creator>
    
        <category>R</category>
    
</item><item>
    <title>Back to the parametric Hopf torus</title>
    <link>https://laustep.github.io/stlahblog/posts/HopfTorus2.html</link>
    <description><![CDATA[<!DOCTYPE HTML>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Saturn Elephant - Back to the parametric Hopf torus</title>
  <link href="/libraries/bootstrap/bootstrap-grid.min.css" rel="stylesheet">
  <link rel="stylesheet" href="/css/post.css" />
  <link rel="stylesheet" href="/css/misc.css" /> 
  
    <link rel="stylesheet" href="/css/pandoc-solarized.css" /> 
   
  
    <link href="/libraries/highlighters/prettify/css/minimal.css" rel="stylesheet"> 
  
  <link href="https://fonts.googleapis.com/css?family=Raleway:400,600,200,800" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/css?family=Droid+Sans" rel="stylesheet" type="text/css">
  <script src="/libraries/jquery.min.js"></script>
  <script type="text/javascript" async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML"></script>
</head>

<body>
  <div class="container-fluid">
    <div class="row">
      <!-- Sidebar. -->
      <div class="sidebar col-sm-3">
        <div style="float:right;clear:both;margin-right:50px;margin-top:150px;">
          <a href="https://www.r-bloggers.com/">
            <img src="https://www.r-bloggers.com/wp-content/uploads/2016/04/R_02_2016-05-01.png" alt="stla" width="100%" />
          </a>
          <br/>
          <a href="http://t-redactyl.io/">
            <span style="color:black;font-weight:bold;font-family:sans-serif;font-size:29px;">Standard error</span>
          </a>
          <a href="http://timelyportfolio.blogspot.be/">
            <span style="color:grey;font-weight:bold;font-family:sans-serif;font-size:27px;">Timely portfolio</span>
          </a>
          <br/>
          <a href="https://antoineguillot.wordpress.com/blog/">
            <span style="color:white;background-color:darkblue;font-weight:bold;font-family:sans-serif;font-size:25px;border:5px solid;border-color:darkblue">ENHANCE DATA</span>
          </a>
          <br/>
          <a href="https://fronkonstin.com/">
            <span style="color:black;background-color:gold;font-weight:bold;font-size:32px;border:3px solid;border-color:gold;">Fronkonstin</span>
          </a>
        </div>
      </div>

      <div class="main col-sm-9">
        <div id="header">
          <div id="logo" style="position:absolute;">
            <a href="/">
              <img src="../images/stla.jpg" alt="stla" width="100px" />
            </a>
          </div>
          <div id="navigation" style="margin-top:50px;">
            <a href="/">Home</a>
            <a href="/about.html">About</a>
            <a href="/contact.html">Contact</a>
            <a href="/archive.html">Archive</a>
          </div>
        </div>

        <div class="content">
          <h1>Back to the parametric Hopf torus</h1> 
          <div class="info">
    Posted on April 12, 2020
    
        by Stéphane Laurent
    
</div>
<div class="info">
    
    Tags: <a href="/tags/R.html">R</a>, <a href="/tags/graphics.html">graphics</a>, <a href="/tags/rgl.html">rgl</a>, <a href="/tags/geometry.html">geometry</a>, <a href="/tags/maths.html">maths</a>
    
</div>

<p>In a <a href="./HopfTorusParametric.html">previous post</a>, I explained how to get a parameterization of a Hopf cylinder or torus. There is a clearer way, which I present here.</p>
<p>For the Hopf map, the preimage of a point <span class="math inline">\(p=(p_x,p_y,p_z)\)</span> on the unit sphere <span class="math inline">\(S^2\)</span> is the circle on <span class="math inline">\(S^3\)</span> with parametrization: <span class="math display">\[
\begin{array}{ccc}
\mathcal{C}_p \colon &amp; (0,2\pi[ &amp; \longrightarrow &amp; S^3 \\
 &amp; \phi &amp; \longmapsto &amp; \mathcal{C}_p(\phi) 
\end{array}
\]</span> where <span class="math display">\[
\mathcal{C}_p(\phi) = 
\frac{1}{\sqrt{2(1+p_z)}}
\begin{pmatrix}
(1+p_z) \cos(\phi) \\
p_x \sin(\phi) - p_y \cos(\phi) \\
p_x \cos(\phi) + p_y \sin(\phi) \\
(1+p_z) \sin(\phi)
\end{pmatrix}.
\]</span></p>
<p>Now consider a spherical curve. That is, let <span class="math inline">\(\Gamma\)</span> be a function mapping an interval <span class="math inline">\(I \subset \mathbb{R}\)</span> to the unit sphere <span class="math inline">\(S^2\)</span>. Then the Hopf cylinder corresponding to <span class="math inline">\(\Gamma\)</span> has parameterization <span class="math display">\[
\begin{array}{ccc}
H_\Gamma \colon &amp; I \times (0,2\pi[ &amp; \longrightarrow &amp; S^3 \\
 &amp; (t, \phi) &amp; \longmapsto &amp; \mathcal{C}_{\Gamma(t)}(\phi) 
\end{array}.
\]</span> Recall the <a href="./HopfTorusTennisBall.html">tennis ball curve</a> example, given for a real constant <span class="math inline">\(A\)</span> and an integer constant <span class="math inline">\(n\)</span> by: <span class="math display">\[
\Gamma(t) = 
\begin{pmatrix}
\sin\bigl(\pi/2 - (\pi/2 - A) \cos(nt)\bigr) 
\cos\bigl(t + A \sin(2nt)\bigr) \\ 
\sin\bigl(\pi/2 - (\pi/2 - A) \cos(nt)\bigr) 
\sin\bigl(t + A \sin(2nt)\bigr) \\ 
\cos\bigl(\pi/2 - (\pi/2 - A) \cos(nt)\bigr)
\end{pmatrix}, \quad t \in (0,2\pi[.
\]</span></p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" title="1">A &lt;-<span class="st"> </span><span class="fl">0.44</span></a>
<a class="sourceLine" id="cb1-2" title="2">n &lt;-<span class="st"> </span><span class="dv">3</span></a>
<a class="sourceLine" id="cb1-3" title="3">Gamma &lt;-<span class="st"> </span><span class="cf">function</span>(t){</a>
<a class="sourceLine" id="cb1-4" title="4">  alpha &lt;-<span class="st"> </span>pi<span class="op">/</span><span class="dv">2</span> <span class="op">-</span><span class="st"> </span>(pi<span class="op">/</span><span class="dv">2</span><span class="op">-</span>A)<span class="op">*</span><span class="kw">cos</span>(n<span class="op">*</span>t)</a>
<a class="sourceLine" id="cb1-5" title="5">  beta &lt;-<span class="st"> </span>t <span class="op">+</span><span class="st"> </span>A<span class="op">*</span><span class="kw">sin</span>(<span class="dv">2</span><span class="op">*</span>n<span class="op">*</span>t)</a>
<a class="sourceLine" id="cb1-6" title="6">  <span class="kw">c</span>(</a>
<a class="sourceLine" id="cb1-7" title="7">    <span class="kw">sin</span>(alpha) <span class="op">*</span><span class="st"> </span><span class="kw">cos</span>(beta),</a>
<a class="sourceLine" id="cb1-8" title="8">    <span class="kw">sin</span>(alpha) <span class="op">*</span><span class="st"> </span><span class="kw">sin</span>(beta),</a>
<a class="sourceLine" id="cb1-9" title="9">    <span class="kw">cos</span>(alpha)</a>
<a class="sourceLine" id="cb1-10" title="10">  )</a>
<a class="sourceLine" id="cb1-11" title="11">}</a>
<a class="sourceLine" id="cb1-12" title="12">HopfInverse &lt;-<span class="st"> </span><span class="cf">function</span>(p, phi){</a>
<a class="sourceLine" id="cb1-13" title="13">  <span class="kw">c</span>(</a>
<a class="sourceLine" id="cb1-14" title="14">    (<span class="dv">1</span><span class="op">+</span>p[<span class="dv">3</span>])<span class="op">*</span><span class="kw">cos</span>(phi),</a>
<a class="sourceLine" id="cb1-15" title="15">    p[<span class="dv">1</span>]<span class="op">*</span><span class="kw">sin</span>(phi) <span class="op">-</span><span class="st"> </span>p[<span class="dv">2</span>]<span class="op">*</span><span class="kw">cos</span>(phi), </a>
<a class="sourceLine" id="cb1-16" title="16">    p[<span class="dv">1</span>]<span class="op">*</span><span class="kw">cos</span>(phi) <span class="op">+</span><span class="st"> </span>p[<span class="dv">2</span>]<span class="op">*</span><span class="kw">sin</span>(phi),</a>
<a class="sourceLine" id="cb1-17" title="17">    (<span class="dv">1</span><span class="op">+</span>p[<span class="dv">3</span>])<span class="op">*</span><span class="kw">sin</span>(phi)</a>
<a class="sourceLine" id="cb1-18" title="18">  ) <span class="op">/</span><span class="st"> </span><span class="kw">sqrt</span>(<span class="dv">2</span><span class="op">*</span>(<span class="dv">1</span><span class="op">+</span>p[<span class="dv">3</span>])) </a>
<a class="sourceLine" id="cb1-19" title="19">}</a>
<a class="sourceLine" id="cb1-20" title="20">Stereo &lt;-<span class="st"> </span><span class="cf">function</span>(q){</a>
<a class="sourceLine" id="cb1-21" title="21">  <span class="dv">2</span><span class="op">*</span>q[<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>] <span class="op">/</span><span class="st"> </span>(<span class="dv">1</span><span class="op">-</span>q[<span class="dv">4</span>])</a>
<a class="sourceLine" id="cb1-22" title="22">}</a>
<a class="sourceLine" id="cb1-23" title="23">F &lt;-<span class="st"> </span><span class="cf">function</span>(t, phi){</a>
<a class="sourceLine" id="cb1-24" title="24">  <span class="kw">Stereo</span>(<span class="kw">HopfInverse</span>(<span class="kw">Gamma</span>(t), phi))</a>
<a class="sourceLine" id="cb1-25" title="25">}</a></code></pre></div>
<p>Now we’re ready to plot the stereographic projection of the Hopf torus with <code>misc3d</code>:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" title="1">fx &lt;-<span class="st"> </span><span class="kw">Vectorize</span>(<span class="cf">function</span>(u,v) <span class="kw">F</span>(u,v)[<span class="dv">1</span>])</a>
<a class="sourceLine" id="cb2-2" title="2">fy &lt;-<span class="st"> </span><span class="kw">Vectorize</span>(<span class="cf">function</span>(u,v) <span class="kw">F</span>(u,v)[<span class="dv">2</span>])</a>
<a class="sourceLine" id="cb2-3" title="3">fz &lt;-<span class="st"> </span><span class="kw">Vectorize</span>(<span class="cf">function</span>(u,v) <span class="kw">F</span>(u,v)[<span class="dv">3</span>])</a>
<a class="sourceLine" id="cb2-4" title="4"><span class="kw">library</span>(misc3d)</a>
<a class="sourceLine" id="cb2-5" title="5"><span class="kw">parametric3d</span>(fx, fy, fz, <span class="dt">umin =</span> <span class="dv">0</span>, <span class="dt">umax =</span> <span class="dv">2</span><span class="op">*</span>pi, <span class="dt">vmin =</span> <span class="dv">0</span>, <span class="dt">vmax =</span> <span class="dv">2</span><span class="op">*</span>pi, </a>
<a class="sourceLine" id="cb2-6" title="6">             <span class="dt">n =</span> <span class="dv">300</span>, <span class="dt">smooth =</span> <span class="ot">TRUE</span>, <span class="dt">color =</span> <span class="st">&quot;#363940&quot;</span>)</a>
<a class="sourceLine" id="cb2-7" title="7">rgl<span class="op">::</span><span class="kw">view3d</span>(<span class="dv">90</span>, <span class="dv">0</span>, <span class="dt">zoom =</span> <span class="fl">0.65</span>)</a></code></pre></div>
<p><img src="./figures/HopfTorus_grey.png" /></p>
<p>A ring cyclide is a Hopf torus. It corresponds to the case when <span class="math inline">\(\Gamma\)</span> describes a circle on the unit sphere <span class="math inline">\(S^2\)</span>. Below is a R function to compute such a circle.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" title="1"><span class="co"># helper function: plane passing by points p1, p2, p3 </span></a>
<a class="sourceLine" id="cb3-2" title="2">plane3pts &lt;-<span class="st"> </span><span class="cf">function</span>(p1,p2,p3){ </a>
<a class="sourceLine" id="cb3-3" title="3">    xcoef &lt;-<span class="st"> </span>(p1[<span class="dv">2</span>]<span class="op">-</span>p2[<span class="dv">2</span>])<span class="op">*</span>(p2[<span class="dv">3</span>]<span class="op">-</span>p3[<span class="dv">3</span>])<span class="op">-</span>(p1[<span class="dv">3</span>]<span class="op">-</span>p2[<span class="dv">3</span>])<span class="op">*</span>(p2[<span class="dv">2</span>]<span class="op">-</span>p3[<span class="dv">2</span>])</a>
<a class="sourceLine" id="cb3-4" title="4">    ycoef &lt;-<span class="st"> </span>(p1[<span class="dv">3</span>]<span class="op">-</span>p2[<span class="dv">3</span>])<span class="op">*</span>(p2[<span class="dv">1</span>]<span class="op">-</span>p3[<span class="dv">1</span>])<span class="op">-</span>(p1[<span class="dv">1</span>]<span class="op">-</span>p2[<span class="dv">1</span>])<span class="op">*</span>(p2[<span class="dv">3</span>]<span class="op">-</span>p3[<span class="dv">3</span>])</a>
<a class="sourceLine" id="cb3-5" title="5">    zcoef &lt;-<span class="st"> </span>(p1[<span class="dv">1</span>]<span class="op">-</span>p2[<span class="dv">1</span>])<span class="op">*</span>(p2[<span class="dv">2</span>]<span class="op">-</span>p3[<span class="dv">2</span>])<span class="op">-</span>(p1[<span class="dv">2</span>]<span class="op">-</span>p2[<span class="dv">2</span>])<span class="op">*</span>(p2[<span class="dv">1</span>]<span class="op">-</span>p3[<span class="dv">1</span>])</a>
<a class="sourceLine" id="cb3-6" title="6">    offset &lt;-<span class="st"> </span>p1[<span class="dv">1</span>]<span class="op">*</span>xcoef <span class="op">+</span><span class="st"> </span>p1[<span class="dv">2</span>]<span class="op">*</span>ycoef <span class="op">+</span><span class="st"> </span>p1[<span class="dv">3</span>]<span class="op">*</span>zcoef</a>
<a class="sourceLine" id="cb3-7" title="7">    <span class="kw">c</span>(xcoef, ycoef, zcoef, offset)</a>
<a class="sourceLine" id="cb3-8" title="8">}</a>
<a class="sourceLine" id="cb3-9" title="9"></a>
<a class="sourceLine" id="cb3-10" title="10"><span class="co"># helper function: cross product </span></a>
<a class="sourceLine" id="cb3-11" title="11">cross &lt;-<span class="st"> </span><span class="cf">function</span>(v, w){ </a>
<a class="sourceLine" id="cb3-12" title="12">  <span class="kw">c</span>(</a>
<a class="sourceLine" id="cb3-13" title="13">    v[<span class="dv">2</span>] <span class="op">*</span><span class="st"> </span>w[<span class="dv">3</span>] <span class="op">-</span><span class="st"> </span>v[<span class="dv">3</span>] <span class="op">*</span><span class="st"> </span>w[<span class="dv">2</span>], </a>
<a class="sourceLine" id="cb3-14" title="14">    v[<span class="dv">3</span>] <span class="op">*</span><span class="st"> </span>w[<span class="dv">1</span>] <span class="op">-</span><span class="st"> </span>v[<span class="dv">1</span>] <span class="op">*</span><span class="st"> </span>w[<span class="dv">3</span>], </a>
<a class="sourceLine" id="cb3-15" title="15">    v[<span class="dv">1</span>] <span class="op">*</span><span class="st"> </span>w[<span class="dv">2</span>] <span class="op">-</span><span class="st"> </span>v[<span class="dv">2</span>] <span class="op">*</span><span class="st"> </span>w[<span class="dv">1</span>]</a>
<a class="sourceLine" id="cb3-16" title="16">  )</a>
<a class="sourceLine" id="cb3-17" title="17">}</a>
<a class="sourceLine" id="cb3-18" title="18"></a>
<a class="sourceLine" id="cb3-19" title="19"><span class="co"># circle passing by points three points p1, p2, p3 </span></a>
<a class="sourceLine" id="cb3-20" title="20"><span class="co"># given in Cartesian coordinates</span></a>
<a class="sourceLine" id="cb3-21" title="21">circle3pts &lt;-<span class="st"> </span><span class="cf">function</span>(p1, p2, p3){</a>
<a class="sourceLine" id="cb3-22" title="22">  p12 &lt;-<span class="st"> </span>(p1<span class="op">+</span>p2)<span class="op">/</span><span class="dv">2</span></a>
<a class="sourceLine" id="cb3-23" title="23">  p23 &lt;-<span class="st"> </span>(p2<span class="op">+</span>p3)<span class="op">/</span><span class="dv">2</span></a>
<a class="sourceLine" id="cb3-24" title="24">  v12 &lt;-<span class="st"> </span>p2<span class="op">-</span>p1</a>
<a class="sourceLine" id="cb3-25" title="25">  v23 &lt;-<span class="st"> </span>p3<span class="op">-</span>p2</a>
<a class="sourceLine" id="cb3-26" title="26">  plane &lt;-<span class="st"> </span><span class="kw">plane3pts</span>(p1, p2, p3)</a>
<a class="sourceLine" id="cb3-27" title="27">  A &lt;-<span class="st"> </span><span class="kw">rbind</span>(plane[<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>], v12, v23)</a>
<a class="sourceLine" id="cb3-28" title="28">  b &lt;-<span class="st"> </span><span class="kw">c</span>(plane[<span class="dv">4</span>], <span class="kw">sum</span>(p12<span class="op">*</span>v12), <span class="kw">sum</span>(p23<span class="op">*</span>v23))</a>
<a class="sourceLine" id="cb3-29" title="29">  center &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="kw">solve</span>(A) <span class="op">%*%</span><span class="st"> </span>b)</a>
<a class="sourceLine" id="cb3-30" title="30">  r &lt;-<span class="st"> </span><span class="kw">sqrt</span>(<span class="kw">c</span>(<span class="kw">crossprod</span>(p1<span class="op">-</span>center)))</a>
<a class="sourceLine" id="cb3-31" title="31">  i &lt;-<span class="st"> </span>(p1<span class="op">-</span>center) <span class="op">/</span><span class="st"> </span>r</a>
<a class="sourceLine" id="cb3-32" title="32">  normal &lt;-<span class="st"> </span>plane[<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>] <span class="op">/</span><span class="st"> </span><span class="kw">sqrt</span>(<span class="kw">c</span>(<span class="kw">crossprod</span>(plane[<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>])))</a>
<a class="sourceLine" id="cb3-33" title="33">  <span class="kw">list</span>(<span class="dt">center =</span> center, <span class="dt">radius =</span> r, <span class="dt">i =</span> i, <span class="dt">j =</span> <span class="kw">cross</span>(i,normal))</a>
<a class="sourceLine" id="cb3-34" title="34">} <span class="co"># circle parameterization: center + radius*(cos(t)*i + sin(t)*j)</span></a>
<a class="sourceLine" id="cb3-35" title="35"></a>
<a class="sourceLine" id="cb3-36" title="36"><span class="co"># circle on unit sphere passing by three points </span></a>
<a class="sourceLine" id="cb3-37" title="37"><span class="co"># given in spherical coordinates </span></a>
<a class="sourceLine" id="cb3-38" title="38">circleOnUnitSphere &lt;-<span class="st"> </span><span class="cf">function</span>(thph1, thph2, thph3){</a>
<a class="sourceLine" id="cb3-39" title="39">  theta1 &lt;-<span class="st"> </span>thph1[<span class="dv">1</span>]; phi1 &lt;-<span class="st"> </span>thph1[<span class="dv">2</span>]</a>
<a class="sourceLine" id="cb3-40" title="40">  theta2 &lt;-<span class="st"> </span>thph2[<span class="dv">1</span>]; phi2 &lt;-<span class="st"> </span>thph2[<span class="dv">2</span>]</a>
<a class="sourceLine" id="cb3-41" title="41">  theta3 &lt;-<span class="st"> </span>thph3[<span class="dv">1</span>]; phi3 &lt;-<span class="st"> </span>thph3[<span class="dv">2</span>]</a>
<a class="sourceLine" id="cb3-42" title="42">  p1 &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="kw">sin</span>(theta1)<span class="op">*</span><span class="kw">cos</span>(phi1), <span class="kw">sin</span>(theta1)<span class="op">*</span><span class="kw">sin</span>(phi1), <span class="kw">cos</span>(theta1))</a>
<a class="sourceLine" id="cb3-43" title="43">  p2 &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="kw">sin</span>(theta2)<span class="op">*</span><span class="kw">cos</span>(phi2), <span class="kw">sin</span>(theta2)<span class="op">*</span><span class="kw">sin</span>(phi2), <span class="kw">cos</span>(theta2))</a>
<a class="sourceLine" id="cb3-44" title="44">  p3 &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="kw">sin</span>(theta3)<span class="op">*</span><span class="kw">cos</span>(phi3), <span class="kw">sin</span>(theta3)<span class="op">*</span><span class="kw">sin</span>(phi3), <span class="kw">cos</span>(theta3))</a>
<a class="sourceLine" id="cb3-45" title="45">  <span class="kw">circle3pts</span>(p1, p2, p3)</a>
<a class="sourceLine" id="cb3-46" title="46">}</a></code></pre></div>
<p>The function returns a list with four elements: a point <code>center</code>, a number <code>radius</code>, and two vectors <code>i</code> and <code>j</code>. The parameterization of the spherical circle is then <code>center + radius*(cos(t)*i + sin(t)*j)</code> for <code>t</code> <span class="math inline">\(\in (0, 2\pi[\)</span>.</p>
<p>Let’s try. We enter three pairs of spherical coordinates and we apply the <code>circleOnUnitSphere</code> function:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" title="1">thph1 =<span class="st"> </span><span class="kw">c</span>(<span class="fl">1.3</span>, <span class="fl">1.5</span>)</a>
<a class="sourceLine" id="cb4-2" title="2">thph2 =<span class="st"> </span><span class="kw">c</span>(<span class="fl">1.9</span>, <span class="fl">2.8</span>)</a>
<a class="sourceLine" id="cb4-3" title="3">thph3 =<span class="st"> </span><span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span>)</a>
<a class="sourceLine" id="cb4-4" title="4">circ &lt;-<span class="st"> </span><span class="kw">circleOnUnitSphere</span>(thph1, thph2, thph3)</a></code></pre></div>
<p>Then we define the parametrization of the stereographically projected Hopf torus:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" title="1">F &lt;-<span class="st"> </span><span class="cf">function</span>(t, phi){</a>
<a class="sourceLine" id="cb5-2" title="2">  p &lt;-<span class="st"> </span><span class="kw">with</span>(circ, center <span class="op">+</span><span class="st"> </span>radius<span class="op">*</span>(<span class="kw">cos</span>(t)<span class="op">*</span>i <span class="op">+</span><span class="st"> </span><span class="kw">sin</span>(t)<span class="op">*</span>j))</a>
<a class="sourceLine" id="cb5-3" title="3">  <span class="kw">Stereo</span>(<span class="kw">HopfInverse</span>(p, phi))</a>
<a class="sourceLine" id="cb5-4" title="4">}</a></code></pre></div>
<p>And we plot:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" title="1"><span class="kw">parametric3d</span>(fx, fy, fz, <span class="dt">umin =</span> <span class="dv">0</span>, <span class="dt">umax =</span> <span class="dv">2</span><span class="op">*</span>pi, <span class="dt">vmin =</span> <span class="dv">0</span>, <span class="dt">vmax =</span> <span class="dv">2</span><span class="op">*</span>pi, </a>
<a class="sourceLine" id="cb6-2" title="2">             <span class="dt">n =</span> <span class="dv">250</span>, <span class="dt">smooth =</span> <span class="ot">TRUE</span>, <span class="dt">color =</span> <span class="st">&quot;#363940&quot;</span>)</a>
<a class="sourceLine" id="cb6-3" title="3">rgl<span class="op">::</span><span class="kw">view3d</span>(<span class="dv">90</span>, <span class="dv">0</span>, <span class="dt">zoom =</span> <span class="fl">0.65</span>)</a></code></pre></div>
<p><img src="./figures/cyclide_grey.png" /></p>
<p>By rotating our spherical circle about the <span class="math inline">\(z\)</span>-axis, we can obtain the <a href="./linkedCyclidesParametric.html">linked cyclides</a>. Below is a R function to perform a rotation in spherical coordinates. See <a href="http://stla.github.io/stlapblog/posts/RotationSphericalCoordinates.html">this post</a> on my former blog for some explanations.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" title="1"><span class="co"># helper functions: basic rotations ####</span></a>
<a class="sourceLine" id="cb7-2" title="2">Rx &lt;-<span class="st"> </span><span class="cf">function</span>(alpha){</a>
<a class="sourceLine" id="cb7-3" title="3">  <span class="kw">rbind</span>(<span class="kw">c</span>(<span class="kw">cos</span>(alpha<span class="op">/</span><span class="dv">2</span>), <span class="op">-</span>1i<span class="op">*</span><span class="kw">sin</span>(alpha<span class="op">/</span><span class="dv">2</span>)),</a>
<a class="sourceLine" id="cb7-4" title="4">        <span class="kw">c</span>(<span class="op">-</span>1i<span class="op">*</span><span class="kw">sin</span>(alpha<span class="op">/</span><span class="dv">2</span>), <span class="kw">cos</span>(alpha<span class="op">/</span><span class="dv">2</span>)))</a>
<a class="sourceLine" id="cb7-5" title="5">}</a>
<a class="sourceLine" id="cb7-6" title="6">Ry &lt;-<span class="st"> </span><span class="cf">function</span>(alpha){</a>
<a class="sourceLine" id="cb7-7" title="7">  <span class="kw">rbind</span>(<span class="kw">c</span>(<span class="kw">cos</span>(alpha<span class="op">/</span><span class="dv">2</span>), <span class="op">-</span><span class="kw">sin</span>(alpha<span class="op">/</span><span class="dv">2</span>)),</a>
<a class="sourceLine" id="cb7-8" title="8">        <span class="kw">c</span>(<span class="kw">sin</span>(alpha<span class="op">/</span><span class="dv">2</span>), <span class="kw">cos</span>(alpha<span class="op">/</span><span class="dv">2</span>)))</a>
<a class="sourceLine" id="cb7-9" title="9">}</a>
<a class="sourceLine" id="cb7-10" title="10">Rz &lt;-<span class="st"> </span><span class="cf">function</span>(alpha){</a>
<a class="sourceLine" id="cb7-11" title="11">  <span class="kw">rbind</span>(<span class="kw">c</span>(<span class="kw">exp</span>(<span class="op">-</span>1i<span class="op">*</span>alpha<span class="op">/</span><span class="dv">2</span>), <span class="dv">0</span>),</a>
<a class="sourceLine" id="cb7-12" title="12">        <span class="kw">c</span>(<span class="dv">0</span>, <span class="kw">exp</span>(1i<span class="op">*</span>alpha<span class="op">/</span><span class="dv">2</span>)))</a>
<a class="sourceLine" id="cb7-13" title="13">}</a>
<a class="sourceLine" id="cb7-14" title="14"></a>
<a class="sourceLine" id="cb7-15" title="15"><span class="co"># 3D rotation in spherical coordinates ####</span></a>
<a class="sourceLine" id="cb7-16" title="16"><span class="co">#&#39; @description Rotation of a vector given in spherical coordinates.</span></a>
<a class="sourceLine" id="cb7-17" title="17"><span class="co">#&#39; @param theta_phi spherical coordinates, a vector containing the </span></a>
<a class="sourceLine" id="cb7-18" title="18"><span class="co">#&#39; colatitude (or polar angle), between 0 and pi, and the longitude </span></a>
<a class="sourceLine" id="cb7-19" title="19"><span class="co">#&#39; (or azimuthal angle), between 0 and 2pi</span></a>
<a class="sourceLine" id="cb7-20" title="20"><span class="co">#&#39; @param axis either a letter &#39;x&#39;, &#39;y&#39; or &#39;z&#39;, a numeric vector of </span></a>
<a class="sourceLine" id="cb7-21" title="21"><span class="co">#&#39; length 2 (the spherical coordinates of the axis), or a numeric </span></a>
<a class="sourceLine" id="cb7-22" title="22"><span class="co">#&#39; vector of length 3 (the Cartesian coordinates of the axis)</span></a>
<a class="sourceLine" id="cb7-23" title="23"><span class="co">#&#39; @param alpha angle of rotation</span></a>
<a class="sourceLine" id="cb7-24" title="24"><span class="co">#&#39; @return The spherical coordinates of the transformed vector.</span></a>
<a class="sourceLine" id="cb7-25" title="25">rotation &lt;-<span class="st"> </span><span class="cf">function</span>(theta_phi, <span class="dt">axis=</span><span class="st">&quot;x&quot;</span>, alpha){</a>
<a class="sourceLine" id="cb7-26" title="26">  <span class="cf">if</span>(<span class="kw">is.character</span>(axis)){</a>
<a class="sourceLine" id="cb7-27" title="27">    axis &lt;-<span class="st"> </span><span class="kw">match.arg</span>(axis, <span class="kw">c</span>(<span class="st">&quot;x&quot;</span>,<span class="st">&quot;y&quot;</span>,<span class="st">&quot;z&quot;</span>))</a>
<a class="sourceLine" id="cb7-28" title="28">    R &lt;-<span class="st"> </span><span class="cf">switch</span>(axis, </a>
<a class="sourceLine" id="cb7-29" title="29">                <span class="st">&quot;x&quot;</span> =<span class="st"> </span><span class="kw">Rx</span>(alpha),</a>
<a class="sourceLine" id="cb7-30" title="30">                <span class="st">&quot;y&quot;</span> =<span class="st"> </span><span class="kw">Ry</span>(alpha),</a>
<a class="sourceLine" id="cb7-31" title="31">                <span class="st">&quot;z&quot;</span> =<span class="st"> </span><span class="kw">Rz</span>(alpha))</a>
<a class="sourceLine" id="cb7-32" title="32">  }<span class="cf">else</span> <span class="cf">if</span>(<span class="kw">length</span>(axis) <span class="op">==</span><span class="st"> </span><span class="dv">2</span>){</a>
<a class="sourceLine" id="cb7-33" title="33">    Theta &lt;-<span class="st"> </span>axis[<span class="dv">1</span>]; Phi &lt;-<span class="st"> </span>axis[<span class="dv">2</span>]</a>
<a class="sourceLine" id="cb7-34" title="34">    R &lt;-<span class="st"> </span><span class="kw">Rz</span>(Phi) <span class="op">%*%</span><span class="st"> </span><span class="kw">Ry</span>(Theta) <span class="op">%*%</span><span class="st"> </span><span class="kw">Rz</span>(alpha) <span class="op">%*%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb7-35" title="35"><span class="st">           </span><span class="kw">t</span>(<span class="kw">Ry</span>(Theta)) <span class="op">%*%</span><span class="st"> </span><span class="kw">t</span>(<span class="kw">Conj</span>(<span class="kw">Rz</span>(Phi)))</a>
<a class="sourceLine" id="cb7-36" title="36">  }<span class="cf">else</span> <span class="cf">if</span>(<span class="kw">length</span>(axis) <span class="op">==</span><span class="st"> </span><span class="dv">3</span>){</a>
<a class="sourceLine" id="cb7-37" title="37">    axis &lt;-<span class="st"> </span>axis <span class="op">/</span><span class="st"> </span><span class="kw">sqrt</span>(<span class="kw">c</span>(<span class="kw">crossprod</span>(axis)))</a>
<a class="sourceLine" id="cb7-38" title="38">    X &lt;-<span class="st"> </span><span class="kw">rbind</span>(<span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">1</span>), <span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">0</span>))</a>
<a class="sourceLine" id="cb7-39" title="39">    Y &lt;-<span class="st"> </span><span class="kw">rbind</span>(<span class="kw">c</span>(<span class="dv">0</span>,<span class="op">-</span>1i), <span class="kw">c</span>(1i,<span class="dv">0</span>)) </a>
<a class="sourceLine" id="cb7-40" title="40">    Z &lt;-<span class="st"> </span><span class="kw">rbind</span>(<span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">0</span>), <span class="kw">c</span>(<span class="dv">0</span>,<span class="op">-</span><span class="dv">1</span>))</a>
<a class="sourceLine" id="cb7-41" title="41">    R &lt;-<span class="st"> </span><span class="kw">cos</span>(alpha<span class="op">/</span><span class="dv">2</span>)<span class="op">*</span><span class="kw">diag</span>(<span class="dv">2</span>) <span class="op">-</span><span class="st"> </span>1i<span class="op">*</span><span class="kw">sin</span>(alpha<span class="op">/</span><span class="dv">2</span>) <span class="op">*</span><span class="st"> </span></a>
<a class="sourceLine" id="cb7-42" title="42"><span class="st">           </span>(axis[<span class="dv">1</span>]<span class="op">*</span>X <span class="op">+</span><span class="st"> </span>axis[<span class="dv">2</span>]<span class="op">*</span>Y <span class="op">+</span><span class="st"> </span>axis[<span class="dv">3</span>]<span class="op">*</span>Z)</a>
<a class="sourceLine" id="cb7-43" title="43">  }<span class="cf">else</span>{</a>
<a class="sourceLine" id="cb7-44" title="44">    <span class="kw">stop</span>(<span class="st">&quot;`axis` must be either:</span></a>
<a class="sourceLine" id="cb7-45" title="45"><span class="st">         - a letter (&#39;x&#39;, &#39;y&#39; or &#39;z&#39;)</span></a>
<a class="sourceLine" id="cb7-46" title="46"><span class="st">         - a numeric vector of length two (spherical coordinates)</span></a>
<a class="sourceLine" id="cb7-47" title="47"><span class="st">         - a numeric vector of length three (Cartesian coordinates)&quot;</span>)</a>
<a class="sourceLine" id="cb7-48" title="48">  }</a>
<a class="sourceLine" id="cb7-49" title="49">  theta &lt;-<span class="st"> </span>theta_phi[<span class="dv">1</span>]; phi &lt;-<span class="st"> </span>theta_phi[<span class="dv">2</span>]</a>
<a class="sourceLine" id="cb7-50" title="50">  qubit &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="kw">cos</span>(theta<span class="op">/</span><span class="dv">2</span>), <span class="kw">exp</span>(1i<span class="op">*</span>phi)<span class="op">*</span><span class="kw">sin</span>(theta<span class="op">/</span><span class="dv">2</span>))</a>
<a class="sourceLine" id="cb7-51" title="51">  newqubit &lt;-<span class="st"> </span>R <span class="op">%*%</span><span class="st"> </span>qubit</a>
<a class="sourceLine" id="cb7-52" title="52">  z0 &lt;-<span class="st"> </span>newqubit[<span class="dv">1</span>,<span class="dv">1</span>]; z1 &lt;-<span class="st"> </span>newqubit[<span class="dv">2</span>,<span class="dv">1</span>]</a>
<a class="sourceLine" id="cb7-53" title="53">  <span class="kw">c</span>(<span class="dv">2</span><span class="op">*</span><span class="kw">atan</span>(<span class="kw">Mod</span>(z1)<span class="op">/</span><span class="kw">Mod</span>(z0)), <span class="kw">Arg</span>(z1)<span class="op">-</span><span class="kw">Arg</span>(z0))</a>
<a class="sourceLine" id="cb7-54" title="54">}</a></code></pre></div>
<p>Now, let’s rotate our spherical circle and plot:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" title="1">thph1 &lt;-<span class="st"> </span><span class="kw">rotation</span>(thph1, <span class="st">&quot;z&quot;</span>, <span class="dv">2</span><span class="op">*</span>pi<span class="op">/</span><span class="dv">3</span>)</a>
<a class="sourceLine" id="cb8-2" title="2">thph2 &lt;-<span class="st"> </span><span class="kw">rotation</span>(thph2, <span class="st">&quot;z&quot;</span>, <span class="dv">2</span><span class="op">*</span>pi<span class="op">/</span><span class="dv">3</span>)</a>
<a class="sourceLine" id="cb8-3" title="3">thph3 &lt;-<span class="st"> </span><span class="kw">rotation</span>(thph3, <span class="st">&quot;z&quot;</span>, <span class="dv">2</span><span class="op">*</span>pi<span class="op">/</span><span class="dv">3</span>)</a>
<a class="sourceLine" id="cb8-4" title="4">circ &lt;-<span class="st"> </span><span class="kw">circleOnUnitSphere</span>(thph1, thph2, thph3)</a>
<a class="sourceLine" id="cb8-5" title="5"><span class="kw">parametric3d</span>(fx, fy, fz, <span class="dt">umin =</span> <span class="dv">0</span>, <span class="dt">umax =</span> <span class="dv">2</span><span class="op">*</span>pi, <span class="dt">vmin =</span> <span class="dv">0</span>, <span class="dt">vmax =</span> <span class="dv">2</span><span class="op">*</span>pi, </a>
<a class="sourceLine" id="cb8-6" title="6">             <span class="dt">n =</span> <span class="dv">250</span>, <span class="dt">smooth =</span> <span class="ot">TRUE</span>, <span class="dt">color =</span> <span class="st">&quot;#363940&quot;</span>, <span class="dt">add =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb8-7" title="7">thph1 &lt;-<span class="st"> </span><span class="kw">rotation</span>(thph1, <span class="st">&quot;z&quot;</span>, <span class="dv">2</span><span class="op">*</span>pi<span class="op">/</span><span class="dv">3</span>)</a>
<a class="sourceLine" id="cb8-8" title="8">thph2 &lt;-<span class="st"> </span><span class="kw">rotation</span>(thph2, <span class="st">&quot;z&quot;</span>, <span class="dv">2</span><span class="op">*</span>pi<span class="op">/</span><span class="dv">3</span>)</a>
<a class="sourceLine" id="cb8-9" title="9">thph3 &lt;-<span class="st"> </span><span class="kw">rotation</span>(thph3, <span class="st">&quot;z&quot;</span>, <span class="dv">2</span><span class="op">*</span>pi<span class="op">/</span><span class="dv">3</span>)</a>
<a class="sourceLine" id="cb8-10" title="10">circ &lt;-<span class="st"> </span><span class="kw">circleOnUnitSphere</span>(thph1, thph2, thph3)</a>
<a class="sourceLine" id="cb8-11" title="11"><span class="kw">parametric3d</span>(fx, fy, fz, <span class="dt">umin =</span> <span class="dv">0</span>, <span class="dt">umax =</span> <span class="dv">2</span><span class="op">*</span>pi, <span class="dt">vmin =</span> <span class="dv">0</span>, <span class="dt">vmax =</span> <span class="dv">2</span><span class="op">*</span>pi, </a>
<a class="sourceLine" id="cb8-12" title="12">             <span class="dt">n =</span> <span class="dv">250</span>, <span class="dt">smooth =</span> <span class="ot">TRUE</span>, <span class="dt">color =</span> <span class="st">&quot;#363940&quot;</span>, <span class="dt">add =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<p><img src="./figures/linkedCyclides_grey.png" /></p>

        </div>


        <div id="footer">
          Site proudly generated by
          <a href="http://jaspervdj.be/hakyll">Hakyll</a>
        </div>

      </div>

    </div>

    <div class="row">
      <div class="col-sm-12">
        <div id="disqus_thread"></div>
        <div class="pagination">
          <ul>
            <li>
              <a href="http://laustep.github.io/stlahblog/">&#171; Back Home</a>
            </li>
          </ul>
        </div>
      </div>
    </div>
    
  </div>

</body>

<script src="/libraries/bootstrap/bootstrap.min.js"></script>
<script>
  var disqus_developer = 1;
  var disqus_shortname = 'stlapblog';
  // required: replace example with your forum shortname
  /* * * DON'T EDIT BELOW THIS LINE * * */
  (function () {
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = 'https://' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] ||
      document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>
<noscript>Please enable JavaScript to view the
  <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a>
</noscript>
<!-- MathJax: Fall back to local if CDN offline but local image fonts are not supported (saves >100MB) -->
<script type="text/x-mathjax-config" src="../libraries/mathjax/config/TeX-MML-AM_CHTML.js"></script>
<!-- <script>
  window.MathJax || document.write('<script type="text/x-mathjax-config">MathJax.Hub.Config({"HTML-CSS":{imageFont:null}});<\/script><script src="../libraries/mathjax/MathJax.js"><\/script>');
</script> -->

  <!-- Google Prettify -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prettify/188.0.0/prettify.js"></script>
  <!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/prettify/r298/prettify.js"></script> -->
  <script src="/libraries/highlighters/prettify/js/lang-r.js"></script>
  <script>
    var pres = document.getElementsByTagName("pre");
    for (var i = 0; i < pres.length; ++i) {
      
        pres[i].className = pres[i].className + " prettyprint linenums";
      
    }
    prettyPrint();
  </script> 


</html>]]></description>
    <pubDate>Sun, 12 Apr 2020 00:00:00 UT</pubDate>
    <guid>https://laustep.github.io/stlahblog/posts/HopfTorus2.html</guid>
    <dc:creator>Stéphane Laurent</dc:creator>
    
</item><item>
    <title>An orbit of the modular tessellation</title>
    <link>https://laustep.github.io/stlahblog/posts/ModularTessellationOrbit.html</link>
    <description><![CDATA[<!DOCTYPE HTML>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Saturn Elephant - An orbit of the modular tessellation</title>
  <link href="/libraries/bootstrap/bootstrap-grid.min.css" rel="stylesheet">
  <link rel="stylesheet" href="/css/post.css" />
  <link rel="stylesheet" href="/css/misc.css" /> 
  
    <link rel="stylesheet" href="/css/pandoc-solarized.css" /> 
   
  
    <link href="/libraries/highlighters/prettify/css/minimal.css" rel="stylesheet"> 
  
  <link href="https://fonts.googleapis.com/css?family=Raleway:400,600,200,800" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/css?family=Droid+Sans" rel="stylesheet" type="text/css">
  <script src="/libraries/jquery.min.js"></script>
  <script type="text/javascript" async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML"></script>
</head>

<body>
  <div class="container-fluid">
    <div class="row">
      <!-- Sidebar. -->
      <div class="sidebar col-sm-3">
        <div style="float:right;clear:both;margin-right:50px;margin-top:150px;">
          <a href="https://www.r-bloggers.com/">
            <img src="https://www.r-bloggers.com/wp-content/uploads/2016/04/R_02_2016-05-01.png" alt="stla" width="100%" />
          </a>
          <br/>
          <a href="http://t-redactyl.io/">
            <span style="color:black;font-weight:bold;font-family:sans-serif;font-size:29px;">Standard error</span>
          </a>
          <a href="http://timelyportfolio.blogspot.be/">
            <span style="color:grey;font-weight:bold;font-family:sans-serif;font-size:27px;">Timely portfolio</span>
          </a>
          <br/>
          <a href="https://antoineguillot.wordpress.com/blog/">
            <span style="color:white;background-color:darkblue;font-weight:bold;font-family:sans-serif;font-size:25px;border:5px solid;border-color:darkblue">ENHANCE DATA</span>
          </a>
          <br/>
          <a href="https://fronkonstin.com/">
            <span style="color:black;background-color:gold;font-weight:bold;font-size:32px;border:3px solid;border-color:gold;">Fronkonstin</span>
          </a>
        </div>
      </div>

      <div class="main col-sm-9">
        <div id="header">
          <div id="logo" style="position:absolute;">
            <a href="/">
              <img src="../images/stla.jpg" alt="stla" width="100px" />
            </a>
          </div>
          <div id="navigation" style="margin-top:50px;">
            <a href="/">Home</a>
            <a href="/about.html">About</a>
            <a href="/contact.html">Contact</a>
            <a href="/archive.html">Archive</a>
          </div>
        </div>

        <div class="content">
          <h1>An orbit of the modular tessellation</h1> 
          <div class="info">
    Posted on February 19, 2020
    
        by Stéphane Laurent
    
</div>
<div class="info">
    
    Tags: <a href="/tags/R.html">R</a>, <a href="/tags/maths.html">maths</a>, <a href="/tags/geometry.html">geometry</a>
    
</div>

<p>I came across this <a href="https://www3.risc.jku.at/publications/download/risc_5011/DiplomaThesisPonweiser.pdf">interesting paper</a> entitled <em>Complex Variables Visualized</em> and written by Thomas Ponweiser.</p>
<p>In particular, I was intrigued by the <em>generalized powers</em> of a Möbius transformation (of a matrix, actually), and their actions on the modular tessellation.</p>
<p>So I firstly implemented the generalized powers in my package <code>PlaneGeometry</code>. Then I wrote the script below to visualize the orbit of the modular tessellation under the action of <span class="math inline">\(R^t\)</span>, <span class="math inline">\(0 \leqslant t &lt; 3\)</span>, with the notations of the paper. The command <code>fplot(u)</code> generates the modular tessellation under the action of <span class="math inline">\(R^t\)</span> when <code>u</code> is the value of <span class="math inline">\(t\)</span>. Then I use the <code>gifski</code> package to create the animation.</p>
<p>To get the modular transformations <span class="math inline">\(z \mapsto \frac{az+b}{cz+d}\)</span>, I use the <code>unimodular</code> function of the <code>elliptic</code> package. It generates the quadruples <span class="math inline">\((a,b,c,d)\)</span> of <em>positive</em> integers such that <span class="math inline">\(ad-bc=1\)</span>. Then we can get all such quadruples <span class="math inline">\((a,b,c,d) \in \mathbb{Z}^4\)</span> by inverting these modular transformations, swapping <span class="math inline">\(a\)</span> and <span class="math inline">\(d\)</span> and changing their signs.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" title="1"><span class="kw">library</span>(PlaneGeometry)</a>
<a class="sourceLine" id="cb1-2" title="2"><span class="kw">library</span>(elliptic) <span class="co"># for the &#39;unimodular&#39; function</span></a>
<a class="sourceLine" id="cb1-3" title="3"></a>
<a class="sourceLine" id="cb1-4" title="4"><span class="co"># Möbius transformations</span></a>
<a class="sourceLine" id="cb1-5" title="5">T &lt;-<span class="st"> </span>Mobius<span class="op">$</span><span class="kw">new</span>(<span class="kw">rbind</span>(<span class="kw">c</span>(<span class="dv">0</span>,<span class="op">-</span><span class="dv">1</span>), <span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">0</span>)))</a>
<a class="sourceLine" id="cb1-6" title="6">U &lt;-<span class="st"> </span>Mobius<span class="op">$</span><span class="kw">new</span>(<span class="kw">rbind</span>(<span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">1</span>), <span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">1</span>)))</a>
<a class="sourceLine" id="cb1-7" title="7">R &lt;-<span class="st"> </span>U<span class="op">$</span><span class="kw">compose</span>(T)</a>
<a class="sourceLine" id="cb1-8" title="8"><span class="co"># R^t, generalized power</span></a>
<a class="sourceLine" id="cb1-9" title="9">Rt &lt;-<span class="st"> </span><span class="cf">function</span>(t) R<span class="op">$</span><span class="kw">gpower</span>(t)</a>
<a class="sourceLine" id="cb1-10" title="10"></a>
<a class="sourceLine" id="cb1-11" title="11"><span class="co"># starting circles</span></a>
<a class="sourceLine" id="cb1-12" title="12">I &lt;-<span class="st"> </span>Circle<span class="op">$</span><span class="kw">new</span>(<span class="kw">c</span>(<span class="dv">0</span>,<span class="fl">1.5</span>), <span class="fl">0.5</span>)</a>
<a class="sourceLine" id="cb1-13" title="13">TI &lt;-<span class="st"> </span>T<span class="op">$</span><span class="kw">transformCircle</span>(I)</a>
<a class="sourceLine" id="cb1-14" title="14"></a>
<a class="sourceLine" id="cb1-15" title="15"><span class="co"># modified Cayley transformation</span></a>
<a class="sourceLine" id="cb1-16" title="16">Phi &lt;-<span class="st"> </span>Mobius<span class="op">$</span><span class="kw">new</span>(<span class="kw">rbind</span>(<span class="kw">c</span>(1i,<span class="dv">1</span>), <span class="kw">c</span>(<span class="dv">1</span>,1i)))</a>
<a class="sourceLine" id="cb1-17" title="17"></a>
<a class="sourceLine" id="cb1-18" title="18"><span class="co"># plotting function ####</span></a>
<a class="sourceLine" id="cb1-19" title="19">n &lt;-<span class="st"> </span>8L</a>
<a class="sourceLine" id="cb1-20" title="20">transfos &lt;-<span class="st"> </span><span class="kw">unimodular</span>(n)</a>
<a class="sourceLine" id="cb1-21" title="21">fplot &lt;-<span class="st"> </span><span class="cf">function</span>(u){</a>
<a class="sourceLine" id="cb1-22" title="22">  opar &lt;-<span class="st"> </span><span class="kw">par</span>(<span class="dt">mar =</span> <span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>), <span class="dt">bg =</span> <span class="st">&quot;black&quot;</span>)</a>
<a class="sourceLine" id="cb1-23" title="23">  <span class="kw">plot</span>(<span class="ot">NULL</span>, <span class="dt">asp =</span> <span class="dv">1</span>, <span class="dt">xlim =</span> <span class="kw">c</span>(<span class="op">-</span><span class="fl">1.1</span>,<span class="fl">1.1</span>), <span class="dt">ylim =</span> <span class="kw">c</span>(<span class="op">-</span><span class="fl">1.1</span>,<span class="fl">1.1</span>),</a>
<a class="sourceLine" id="cb1-24" title="24">       <span class="dt">xlab =</span> <span class="ot">NA</span>, <span class="dt">ylab =</span> <span class="ot">NA</span>, <span class="dt">axes =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb1-25" title="25">  <span class="kw">draw</span>(unitCircle, <span class="dt">col =</span> <span class="st">&quot;black&quot;</span>)</a>
<a class="sourceLine" id="cb1-26" title="26">  <span class="cf">for</span>(i <span class="cf">in</span> 1L<span class="op">:</span><span class="kw">dim</span>(transfos)[3L]){</a>
<a class="sourceLine" id="cb1-27" title="27">    transfo &lt;-<span class="st"> </span>transfos[,,i]</a>
<a class="sourceLine" id="cb1-28" title="28">    <span class="co">#</span></a>
<a class="sourceLine" id="cb1-29" title="29">    M &lt;-<span class="st"> </span>Mobius<span class="op">$</span><span class="kw">new</span>(transfo)</a>
<a class="sourceLine" id="cb1-30" title="30">    <span class="kw">draw</span>(M<span class="op">$</span><span class="kw">compose</span>(<span class="kw">Rt</span>(u))<span class="op">$</span><span class="kw">compose</span>(Phi)<span class="op">$</span><span class="kw">transformCircle</span>(I),</a>
<a class="sourceLine" id="cb1-31" title="31">         <span class="dt">border =</span> <span class="st">&quot;black&quot;</span>, <span class="dt">col =</span> <span class="st">&quot;magenta&quot;</span>)</a>
<a class="sourceLine" id="cb1-32" title="32">    <span class="kw">draw</span>(M<span class="op">$</span><span class="kw">compose</span>(<span class="kw">Rt</span>(u))<span class="op">$</span><span class="kw">compose</span>(Phi)<span class="op">$</span><span class="kw">transformCircle</span>(TI),</a>
<a class="sourceLine" id="cb1-33" title="33">         <span class="dt">border =</span> <span class="st">&quot;black&quot;</span>, <span class="dt">col =</span> <span class="st">&quot;magenta&quot;</span>)</a>
<a class="sourceLine" id="cb1-34" title="34">    M &lt;-<span class="st"> </span>M<span class="op">$</span><span class="kw">inverse</span>()</a>
<a class="sourceLine" id="cb1-35" title="35">    <span class="kw">draw</span>(M<span class="op">$</span><span class="kw">compose</span>(<span class="kw">Rt</span>(u))<span class="op">$</span><span class="kw">compose</span>(Phi)<span class="op">$</span><span class="kw">transformCircle</span>(I),</a>
<a class="sourceLine" id="cb1-36" title="36">         <span class="dt">border =</span> <span class="st">&quot;black&quot;</span>, <span class="dt">col =</span> <span class="st">&quot;magenta&quot;</span>)</a>
<a class="sourceLine" id="cb1-37" title="37">    <span class="kw">draw</span>(M<span class="op">$</span><span class="kw">compose</span>(<span class="kw">Rt</span>(u))<span class="op">$</span><span class="kw">compose</span>(Phi)<span class="op">$</span><span class="kw">transformCircle</span>(TI),</a>
<a class="sourceLine" id="cb1-38" title="38">         <span class="dt">border =</span> <span class="st">&quot;black&quot;</span>, <span class="dt">col =</span> <span class="st">&quot;magenta&quot;</span>)</a>
<a class="sourceLine" id="cb1-39" title="39">    <span class="co">#</span></a>
<a class="sourceLine" id="cb1-40" title="40">    <span class="kw">diag</span>(transfo) &lt;-<span class="st"> </span><span class="op">-</span><span class="kw">diag</span>(transfo)</a>
<a class="sourceLine" id="cb1-41" title="41">    M &lt;-<span class="st"> </span>Mobius<span class="op">$</span><span class="kw">new</span>(transfo)</a>
<a class="sourceLine" id="cb1-42" title="42">    <span class="kw">draw</span>(M<span class="op">$</span><span class="kw">compose</span>(<span class="kw">Rt</span>(u))<span class="op">$</span><span class="kw">compose</span>(Phi)<span class="op">$</span><span class="kw">transformCircle</span>(I),</a>
<a class="sourceLine" id="cb1-43" title="43">         <span class="dt">border =</span> <span class="st">&quot;black&quot;</span>, <span class="dt">col =</span> <span class="st">&quot;magenta&quot;</span>)</a>
<a class="sourceLine" id="cb1-44" title="44">    <span class="kw">draw</span>(M<span class="op">$</span><span class="kw">compose</span>(<span class="kw">Rt</span>(u))<span class="op">$</span><span class="kw">compose</span>(Phi)<span class="op">$</span><span class="kw">transformCircle</span>(TI),</a>
<a class="sourceLine" id="cb1-45" title="45">         <span class="dt">border =</span> <span class="st">&quot;black&quot;</span>, <span class="dt">col =</span> <span class="st">&quot;magenta&quot;</span>)</a>
<a class="sourceLine" id="cb1-46" title="46">    M &lt;-<span class="st"> </span>M<span class="op">$</span><span class="kw">inverse</span>()</a>
<a class="sourceLine" id="cb1-47" title="47">    <span class="kw">draw</span>(M<span class="op">$</span><span class="kw">compose</span>(<span class="kw">Rt</span>(u))<span class="op">$</span><span class="kw">compose</span>(Phi)<span class="op">$</span><span class="kw">transformCircle</span>(I),</a>
<a class="sourceLine" id="cb1-48" title="48">         <span class="dt">border =</span> <span class="st">&quot;black&quot;</span>, <span class="dt">col =</span> <span class="st">&quot;magenta&quot;</span>)</a>
<a class="sourceLine" id="cb1-49" title="49">    <span class="kw">draw</span>(M<span class="op">$</span><span class="kw">compose</span>(<span class="kw">Rt</span>(u))<span class="op">$</span><span class="kw">compose</span>(Phi)<span class="op">$</span><span class="kw">transformCircle</span>(TI),</a>
<a class="sourceLine" id="cb1-50" title="50">         <span class="dt">border =</span> <span class="st">&quot;black&quot;</span>, <span class="dt">col =</span> <span class="st">&quot;magenta&quot;</span>)</a>
<a class="sourceLine" id="cb1-51" title="51">    <span class="co">#</span></a>
<a class="sourceLine" id="cb1-52" title="52">    d &lt;-<span class="st"> </span><span class="kw">diag</span>(transfo)</a>
<a class="sourceLine" id="cb1-53" title="53">    <span class="cf">if</span>(d[1L] <span class="op">!=</span><span class="st"> </span>d[2L]){</a>
<a class="sourceLine" id="cb1-54" title="54">      <span class="kw">diag</span>(transfo) &lt;-<span class="st"> </span><span class="kw">rev</span>(d)</a>
<a class="sourceLine" id="cb1-55" title="55">      M &lt;-<span class="st"> </span>Mobius<span class="op">$</span><span class="kw">new</span>(transfo)</a>
<a class="sourceLine" id="cb1-56" title="56">      <span class="kw">draw</span>(M<span class="op">$</span><span class="kw">compose</span>(<span class="kw">Rt</span>(u))<span class="op">$</span><span class="kw">compose</span>(Phi)<span class="op">$</span><span class="kw">transformCircle</span>(I),</a>
<a class="sourceLine" id="cb1-57" title="57">           <span class="dt">border =</span> <span class="st">&quot;black&quot;</span>, <span class="dt">col =</span> <span class="st">&quot;magenta&quot;</span>)</a>
<a class="sourceLine" id="cb1-58" title="58">      <span class="kw">draw</span>(M<span class="op">$</span><span class="kw">compose</span>(<span class="kw">Rt</span>(u))<span class="op">$</span><span class="kw">compose</span>(Phi)<span class="op">$</span><span class="kw">transformCircle</span>(TI),</a>
<a class="sourceLine" id="cb1-59" title="59">           <span class="dt">border =</span> <span class="st">&quot;black&quot;</span>, <span class="dt">col =</span> <span class="st">&quot;magenta&quot;</span>)</a>
<a class="sourceLine" id="cb1-60" title="60">      M &lt;-<span class="st"> </span>M<span class="op">$</span><span class="kw">inverse</span>()</a>
<a class="sourceLine" id="cb1-61" title="61">      <span class="kw">draw</span>(M<span class="op">$</span><span class="kw">compose</span>(<span class="kw">Rt</span>(u))<span class="op">$</span><span class="kw">compose</span>(Phi)<span class="op">$</span><span class="kw">transformCircle</span>(I),</a>
<a class="sourceLine" id="cb1-62" title="62">           <span class="dt">border =</span> <span class="st">&quot;black&quot;</span>, <span class="dt">col =</span> <span class="st">&quot;magenta&quot;</span>)</a>
<a class="sourceLine" id="cb1-63" title="63">      <span class="kw">draw</span>(M<span class="op">$</span><span class="kw">compose</span>(<span class="kw">Rt</span>(u))<span class="op">$</span><span class="kw">compose</span>(Phi)<span class="op">$</span><span class="kw">transformCircle</span>(TI),</a>
<a class="sourceLine" id="cb1-64" title="64">           <span class="dt">border =</span> <span class="st">&quot;black&quot;</span>, <span class="dt">col =</span> <span class="st">&quot;magenta&quot;</span>)</a>
<a class="sourceLine" id="cb1-65" title="65">    }</a>
<a class="sourceLine" id="cb1-66" title="66">  }</a>
<a class="sourceLine" id="cb1-67" title="67">  <span class="cf">for</span>(i <span class="cf">in</span> 1L<span class="op">:</span><span class="kw">dim</span>(transfos)[3L]){</a>
<a class="sourceLine" id="cb1-68" title="68">    transfo &lt;-<span class="st"> </span>transfos[,,i]</a>
<a class="sourceLine" id="cb1-69" title="69">    <span class="co">#</span></a>
<a class="sourceLine" id="cb1-70" title="70">    M &lt;-<span class="st"> </span>Mobius<span class="op">$</span><span class="kw">new</span>(transfo)<span class="op">$</span><span class="kw">compose</span>(T)</a>
<a class="sourceLine" id="cb1-71" title="71">    <span class="kw">draw</span>(M<span class="op">$</span><span class="kw">compose</span>(<span class="kw">Rt</span>(u))<span class="op">$</span><span class="kw">compose</span>(Phi)<span class="op">$</span><span class="kw">transformCircle</span>(I),</a>
<a class="sourceLine" id="cb1-72" title="72">         <span class="dt">border =</span> <span class="st">&quot;black&quot;</span>, <span class="dt">col =</span> <span class="st">&quot;magenta&quot;</span>)</a>
<a class="sourceLine" id="cb1-73" title="73">    <span class="kw">draw</span>(M<span class="op">$</span><span class="kw">compose</span>(<span class="kw">Rt</span>(u))<span class="op">$</span><span class="kw">compose</span>(Phi)<span class="op">$</span><span class="kw">transformCircle</span>(TI),</a>
<a class="sourceLine" id="cb1-74" title="74">         <span class="dt">border =</span> <span class="st">&quot;black&quot;</span>, <span class="dt">col =</span> <span class="st">&quot;magenta&quot;</span>)</a>
<a class="sourceLine" id="cb1-75" title="75">    M &lt;-<span class="st"> </span>M<span class="op">$</span><span class="kw">inverse</span>()</a>
<a class="sourceLine" id="cb1-76" title="76">    <span class="kw">draw</span>(M<span class="op">$</span><span class="kw">compose</span>(<span class="kw">Rt</span>(u))<span class="op">$</span><span class="kw">compose</span>(Phi)<span class="op">$</span><span class="kw">transformCircle</span>(I),</a>
<a class="sourceLine" id="cb1-77" title="77">         <span class="dt">border =</span> <span class="st">&quot;black&quot;</span>, <span class="dt">col =</span> <span class="st">&quot;magenta&quot;</span>)</a>
<a class="sourceLine" id="cb1-78" title="78">    <span class="kw">draw</span>(M<span class="op">$</span><span class="kw">compose</span>(<span class="kw">Rt</span>(u))<span class="op">$</span><span class="kw">compose</span>(Phi)<span class="op">$</span><span class="kw">transformCircle</span>(TI),</a>
<a class="sourceLine" id="cb1-79" title="79">         <span class="dt">border =</span> <span class="st">&quot;black&quot;</span>, <span class="dt">col =</span> <span class="st">&quot;magenta&quot;</span>)</a>
<a class="sourceLine" id="cb1-80" title="80">    <span class="co">#</span></a>
<a class="sourceLine" id="cb1-81" title="81">    <span class="kw">diag</span>(transfo) &lt;-<span class="st"> </span><span class="op">-</span><span class="kw">diag</span>(transfo)</a>
<a class="sourceLine" id="cb1-82" title="82">    M &lt;-<span class="st"> </span>Mobius<span class="op">$</span><span class="kw">new</span>(transfo)<span class="op">$</span><span class="kw">compose</span>(T)</a>
<a class="sourceLine" id="cb1-83" title="83">    <span class="kw">draw</span>(M<span class="op">$</span><span class="kw">compose</span>(<span class="kw">Rt</span>(u))<span class="op">$</span><span class="kw">compose</span>(Phi)<span class="op">$</span><span class="kw">transformCircle</span>(I),</a>
<a class="sourceLine" id="cb1-84" title="84">         <span class="dt">border =</span> <span class="st">&quot;black&quot;</span>, <span class="dt">col =</span> <span class="st">&quot;magenta&quot;</span>)</a>
<a class="sourceLine" id="cb1-85" title="85">    <span class="kw">draw</span>(M<span class="op">$</span><span class="kw">compose</span>(<span class="kw">Rt</span>(u))<span class="op">$</span><span class="kw">compose</span>(Phi)<span class="op">$</span><span class="kw">transformCircle</span>(TI),</a>
<a class="sourceLine" id="cb1-86" title="86">         <span class="dt">border =</span> <span class="st">&quot;black&quot;</span>, <span class="dt">col =</span> <span class="st">&quot;magenta&quot;</span>)</a>
<a class="sourceLine" id="cb1-87" title="87">    M &lt;-<span class="st"> </span>M<span class="op">$</span><span class="kw">inverse</span>()</a>
<a class="sourceLine" id="cb1-88" title="88">    <span class="kw">draw</span>(M<span class="op">$</span><span class="kw">compose</span>(<span class="kw">Rt</span>(u))<span class="op">$</span><span class="kw">compose</span>(Phi)<span class="op">$</span><span class="kw">transformCircle</span>(I),</a>
<a class="sourceLine" id="cb1-89" title="89">         <span class="dt">border =</span> <span class="st">&quot;black&quot;</span>, <span class="dt">col =</span> <span class="st">&quot;magenta&quot;</span>)</a>
<a class="sourceLine" id="cb1-90" title="90">    <span class="kw">draw</span>(M<span class="op">$</span><span class="kw">compose</span>(<span class="kw">Rt</span>(u))<span class="op">$</span><span class="kw">compose</span>(Phi)<span class="op">$</span><span class="kw">transformCircle</span>(TI),</a>
<a class="sourceLine" id="cb1-91" title="91">         <span class="dt">border =</span> <span class="st">&quot;black&quot;</span>, <span class="dt">col =</span> <span class="st">&quot;magenta&quot;</span>)</a>
<a class="sourceLine" id="cb1-92" title="92">    <span class="co">#</span></a>
<a class="sourceLine" id="cb1-93" title="93">    d &lt;-<span class="st"> </span><span class="kw">diag</span>(transfo)</a>
<a class="sourceLine" id="cb1-94" title="94">    <span class="cf">if</span>(d[1L] <span class="op">!=</span><span class="st"> </span>d[2L]){</a>
<a class="sourceLine" id="cb1-95" title="95">      <span class="kw">diag</span>(transfo) &lt;-<span class="st"> </span><span class="kw">rev</span>(d)</a>
<a class="sourceLine" id="cb1-96" title="96">      M &lt;-<span class="st"> </span>Mobius<span class="op">$</span><span class="kw">new</span>(transfo)<span class="op">$</span><span class="kw">compose</span>(T)</a>
<a class="sourceLine" id="cb1-97" title="97">      <span class="kw">draw</span>(M<span class="op">$</span><span class="kw">compose</span>(<span class="kw">Rt</span>(u))<span class="op">$</span><span class="kw">compose</span>(Phi)<span class="op">$</span><span class="kw">transformCircle</span>(I),</a>
<a class="sourceLine" id="cb1-98" title="98">           <span class="dt">border =</span> <span class="st">&quot;black&quot;</span>, <span class="dt">col =</span> <span class="st">&quot;magenta&quot;</span>)</a>
<a class="sourceLine" id="cb1-99" title="99">      <span class="kw">draw</span>(M<span class="op">$</span><span class="kw">compose</span>(<span class="kw">Rt</span>(u))<span class="op">$</span><span class="kw">compose</span>(Phi)<span class="op">$</span><span class="kw">transformCircle</span>(TI),</a>
<a class="sourceLine" id="cb1-100" title="100">           <span class="dt">border =</span> <span class="st">&quot;black&quot;</span>, <span class="dt">col =</span> <span class="st">&quot;magenta&quot;</span>)</a>
<a class="sourceLine" id="cb1-101" title="101">      M &lt;-<span class="st"> </span>M<span class="op">$</span><span class="kw">inverse</span>()</a>
<a class="sourceLine" id="cb1-102" title="102">      <span class="kw">draw</span>(M<span class="op">$</span><span class="kw">compose</span>(<span class="kw">Rt</span>(u))<span class="op">$</span><span class="kw">compose</span>(Phi)<span class="op">$</span><span class="kw">transformCircle</span>(I),</a>
<a class="sourceLine" id="cb1-103" title="103">           <span class="dt">border =</span> <span class="st">&quot;black&quot;</span>, <span class="dt">col =</span> <span class="st">&quot;magenta&quot;</span>)</a>
<a class="sourceLine" id="cb1-104" title="104">      <span class="kw">draw</span>(M<span class="op">$</span><span class="kw">compose</span>(<span class="kw">Rt</span>(u))<span class="op">$</span><span class="kw">compose</span>(Phi)<span class="op">$</span><span class="kw">transformCircle</span>(TI),</a>
<a class="sourceLine" id="cb1-105" title="105">           <span class="dt">border =</span> <span class="st">&quot;black&quot;</span>, <span class="dt">col =</span> <span class="st">&quot;magenta&quot;</span>)</a>
<a class="sourceLine" id="cb1-106" title="106">    }</a>
<a class="sourceLine" id="cb1-107" title="107">  }</a>
<a class="sourceLine" id="cb1-108" title="108">}</a>
<a class="sourceLine" id="cb1-109" title="109"></a>
<a class="sourceLine" id="cb1-110" title="110"><span class="co"># animation ####</span></a>
<a class="sourceLine" id="cb1-111" title="111"><span class="kw">library</span>(gifski)</a>
<a class="sourceLine" id="cb1-112" title="112">u_ &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="dv">0</span>, <span class="dv">3</span>, <span class="dt">length.out =</span> 181L)[<span class="op">-</span>1L]</a>
<a class="sourceLine" id="cb1-113" title="113"><span class="kw">save_gif</span>({</a>
<a class="sourceLine" id="cb1-114" title="114">  <span class="cf">for</span>(u <span class="cf">in</span> u_){</a>
<a class="sourceLine" id="cb1-115" title="115">    <span class="kw">fplot</span>(u)</a>
<a class="sourceLine" id="cb1-116" title="116">  }</a>
<a class="sourceLine" id="cb1-117" title="117">}, <span class="st">&quot;ModularTessellation.gif&quot;</span>, <span class="dv">512</span>, <span class="dv">512</span>, <span class="dt">delay =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">12</span>, <span class="dt">res =</span> <span class="dv">144</span>)</a></code></pre></div>
<p><img src="./figures/ModularTessellationOrbit.gif" /></p>

        </div>


        <div id="footer">
          Site proudly generated by
          <a href="http://jaspervdj.be/hakyll">Hakyll</a>
        </div>

      </div>

    </div>

    <div class="row">
      <div class="col-sm-12">
        <div id="disqus_thread"></div>
        <div class="pagination">
          <ul>
            <li>
              <a href="http://laustep.github.io/stlahblog/">&#171; Back Home</a>
            </li>
          </ul>
        </div>
      </div>
    </div>
    
  </div>

</body>

<script src="/libraries/bootstrap/bootstrap.min.js"></script>
<script>
  var disqus_developer = 1;
  var disqus_shortname = 'stlapblog';
  // required: replace example with your forum shortname
  /* * * DON'T EDIT BELOW THIS LINE * * */
  (function () {
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = 'https://' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] ||
      document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>
<noscript>Please enable JavaScript to view the
  <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a>
</noscript>
<!-- MathJax: Fall back to local if CDN offline but local image fonts are not supported (saves >100MB) -->
<script type="text/x-mathjax-config" src="../libraries/mathjax/config/TeX-MML-AM_CHTML.js"></script>
<!-- <script>
  window.MathJax || document.write('<script type="text/x-mathjax-config">MathJax.Hub.Config({"HTML-CSS":{imageFont:null}});<\/script><script src="../libraries/mathjax/MathJax.js"><\/script>');
</script> -->

  <!-- Google Prettify -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prettify/188.0.0/prettify.js"></script>
  <!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/prettify/r298/prettify.js"></script> -->
  <script src="/libraries/highlighters/prettify/js/lang-r.js"></script>
  <script>
    var pres = document.getElementsByTagName("pre");
    for (var i = 0; i < pres.length; ++i) {
      
        pres[i].className = pres[i].className + " prettyprint linenums";
      
    }
    prettyPrint();
  </script> 


</html>]]></description>
    <pubDate>Wed, 19 Feb 2020 00:00:00 UT</pubDate>
    <guid>https://laustep.github.io/stlahblog/posts/ModularTessellationOrbit.html</guid>
    <dc:creator>Stéphane Laurent</dc:creator>
    
        <category>R</category>
    
</item><item>
    <title>Tooltips for the headers of a datatable in Shiny</title>
    <link>https://laustep.github.io/stlahblog/posts/DTqTips.html</link>
    <description><![CDATA[<!DOCTYPE HTML>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Saturn Elephant - Tooltips for the headers of a datatable in Shiny</title>
  <link href="/libraries/bootstrap/bootstrap-grid.min.css" rel="stylesheet">
  <link rel="stylesheet" href="/css/post.css" />
  <link rel="stylesheet" href="/css/misc.css" /> 
  
    <link rel="stylesheet" href="/css/pandoc-solarized.css" /> 
   
  
    <link href="/libraries/highlighters/prettify/css/minimal.css" rel="stylesheet"> 
  
  <link href="https://fonts.googleapis.com/css?family=Raleway:400,600,200,800" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/css?family=Droid+Sans" rel="stylesheet" type="text/css">
  <script src="/libraries/jquery.min.js"></script>
  <script type="text/javascript" async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML"></script>
</head>

<body>
  <div class="container-fluid">
    <div class="row">
      <!-- Sidebar. -->
      <div class="sidebar col-sm-3">
        <div style="float:right;clear:both;margin-right:50px;margin-top:150px;">
          <a href="https://www.r-bloggers.com/">
            <img src="https://www.r-bloggers.com/wp-content/uploads/2016/04/R_02_2016-05-01.png" alt="stla" width="100%" />
          </a>
          <br/>
          <a href="http://t-redactyl.io/">
            <span style="color:black;font-weight:bold;font-family:sans-serif;font-size:29px;">Standard error</span>
          </a>
          <a href="http://timelyportfolio.blogspot.be/">
            <span style="color:grey;font-weight:bold;font-family:sans-serif;font-size:27px;">Timely portfolio</span>
          </a>
          <br/>
          <a href="https://antoineguillot.wordpress.com/blog/">
            <span style="color:white;background-color:darkblue;font-weight:bold;font-family:sans-serif;font-size:25px;border:5px solid;border-color:darkblue">ENHANCE DATA</span>
          </a>
          <br/>
          <a href="https://fronkonstin.com/">
            <span style="color:black;background-color:gold;font-weight:bold;font-size:32px;border:3px solid;border-color:gold;">Fronkonstin</span>
          </a>
        </div>
      </div>

      <div class="main col-sm-9">
        <div id="header">
          <div id="logo" style="position:absolute;">
            <a href="/">
              <img src="../images/stla.jpg" alt="stla" width="100px" />
            </a>
          </div>
          <div id="navigation" style="margin-top:50px;">
            <a href="/">Home</a>
            <a href="/about.html">About</a>
            <a href="/contact.html">Contact</a>
            <a href="/archive.html">Archive</a>
          </div>
        </div>

        <div class="content">
          <h1>Tooltips for the headers of a datatable in Shiny</h1> 
          <div class="info">
    Posted on February 16, 2020
    
        by Stéphane Laurent
    
</div>
<div class="info">
    
    Tags: <a href="/tags/R.html">R</a>, <a href="/tags/datatables.html">datatables</a>, <a href="/tags/javascript.html">javascript</a>, <a href="/tags/shiny.html">shiny</a>
    
</div>

<p>In this post, I show how to use the <a href="http://qtip2.com/">qTip2</a> JavaScript library to create some tooltips on the headers of a <code>DT</code> datatable in Shiny, displaying some information about the columns, such as summary statistics.</p>
<p>Firstly, we write a function returning some JavaScript code that creates some hidden <code>div</code> elements which will contain the contents of the tooltips. This function takes two arguments: <code>n</code>, the number of <code>div</code> elements to create (this will be the number of columns of the table), and <code>prefixID</code>; the i-th <code>div</code> will have the identifier <code>{prefixID}-{i}</code>. We also set a class to each <code>div</code>, namely <code>qtip-big</code>.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" title="1">createDiv &lt;-<span class="st"> </span><span class="cf">function</span>(n, prefixID){</a>
<a class="sourceLine" id="cb1-2" title="2">  <span class="kw">sprintf</span>(<span class="kw">paste</span>(</a>
<a class="sourceLine" id="cb1-3" title="3">    <span class="st">&quot;for(var i = 1; i &lt;= %d; i++){&quot;</span>,</a>
<a class="sourceLine" id="cb1-4" title="4">    <span class="st">&quot;  var div;&quot;</span>,</a>
<a class="sourceLine" id="cb1-5" title="5">    <span class="kw">sprintf</span>(<span class="st">&quot;  var id = &#39;%s-&#39; + i.toString();&quot;</span>, prefixID),</a>
<a class="sourceLine" id="cb1-6" title="6">    <span class="st">&quot;  if(document.getElementById(id) === null){&quot;</span>,</a>
<a class="sourceLine" id="cb1-7" title="7">    <span class="st">&quot;    div = document.createElement(&#39;div&#39;);&quot;</span>,</a>
<a class="sourceLine" id="cb1-8" title="8">    <span class="st">&quot;    div.setAttribute(&#39;id&#39;, id);&quot;</span>,</a>
<a class="sourceLine" id="cb1-9" title="9">    <span class="st">&quot;    div.setAttribute(&#39;class&#39;, &#39;qtip-big&#39;);&quot;</span>,</a>
<a class="sourceLine" id="cb1-10" title="10">    <span class="st">&quot;    div.style.display = &#39;none&#39;;&quot;</span>,</a>
<a class="sourceLine" id="cb1-11" title="11">    <span class="st">&quot;    document.body.appendChild(div);&quot;</span>,</a>
<a class="sourceLine" id="cb1-12" title="12">    <span class="st">&quot;  }&quot;</span>,</a>
<a class="sourceLine" id="cb1-13" title="13">    <span class="st">&quot;}&quot;</span>,</a>
<a class="sourceLine" id="cb1-14" title="14">    <span class="dt">sep =</span> <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span></a>
<a class="sourceLine" id="cb1-15" title="15">  ), n)</a>
<a class="sourceLine" id="cb1-16" title="16">}</a></code></pre></div>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" title="1"><span class="kw">cat</span>(<span class="kw">createDiv</span>(<span class="dv">3</span>, <span class="st">&quot;TOOLTIP&quot;</span>))</a>
<a class="sourceLine" id="cb2-2" title="2"><span class="co">## for(var i = 1; i &lt;= 3; i++){</span></a>
<a class="sourceLine" id="cb2-3" title="3"><span class="co">##   var div;</span></a>
<a class="sourceLine" id="cb2-4" title="4"><span class="co">##   var id = &#39;TOOLTIP-&#39; + i.toString();</span></a>
<a class="sourceLine" id="cb2-5" title="5"><span class="co">##   if(document.getElementById(id) === null){</span></a>
<a class="sourceLine" id="cb2-6" title="6"><span class="co">##     div = document.createElement(&#39;div&#39;);</span></a>
<a class="sourceLine" id="cb2-7" title="7"><span class="co">##     div.setAttribute(&#39;id&#39;, id);</span></a>
<a class="sourceLine" id="cb2-8" title="8"><span class="co">##     div.setAttribute(&#39;class&#39;, &#39;qtip-big&#39;);</span></a>
<a class="sourceLine" id="cb2-9" title="9"><span class="co">##     div.style.display = &#39;none&#39;;</span></a>
<a class="sourceLine" id="cb2-10" title="10"><span class="co">##     document.body.appendChild(div);</span></a>
<a class="sourceLine" id="cb2-11" title="11"><span class="co">##   }</span></a>
<a class="sourceLine" id="cb2-12" title="12"><span class="co">## }</span></a></code></pre></div>
<p>Now we write a function returning some JavaScript code that writes the contents of the <code>div</code> elements. It takes as arguments <code>dat</code>, the dataframe for the table, <code>i</code>, the index of a column of <code>dat</code>, and <code>prefixID</code> as in the function <code>createDiv</code>. If the <code>i</code>-th column is numeric, we fill the <code>div</code> element with some summary statistics of this column, otherwise the information we provide in the <code>div</code> element is the number of levels of the contents of the column, an enumeration of the levels (at most three), and the number of missing values.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" title="1">fillDiv &lt;-<span class="st"> </span><span class="cf">function</span>(dat, i, prefixID){</a>
<a class="sourceLine" id="cb3-2" title="2">  x &lt;-<span class="st"> </span>dat[[i]]</a>
<a class="sourceLine" id="cb3-3" title="3">  <span class="cf">if</span>(<span class="kw">is.numeric</span>(x)){</a>
<a class="sourceLine" id="cb3-4" title="4">    <span class="kw">sprintf</span>(<span class="kw">paste</span>(</a>
<a class="sourceLine" id="cb3-5" title="5">      <span class="st">&quot;var div = document.getElementById(&#39;%s-%d&#39;);&quot;</span>,</a>
<a class="sourceLine" id="cb3-6" title="6">      <span class="st">&quot;var html = &#39;&lt;b&gt; Min: &lt;/b&gt; %s&lt;/br&gt;&#39;;&quot;</span>,</a>
<a class="sourceLine" id="cb3-7" title="7">      <span class="st">&quot;html = html + &#39;&lt;b&gt; Max: &lt;/b&gt; %s&lt;/br&gt;&#39;;&quot;</span>,</a>
<a class="sourceLine" id="cb3-8" title="8">      <span class="st">&quot;html = html + &#39;&lt;b&gt; Mean: &lt;/b&gt; %s&lt;/br&gt;&#39;;&quot;</span>,</a>
<a class="sourceLine" id="cb3-9" title="9">      <span class="st">&quot;html = html + &#39;&lt;b&gt; Std. dev.: &lt;/b&gt; %s&lt;/br&gt;&#39;;&quot;</span>,</a>
<a class="sourceLine" id="cb3-10" title="10">      <span class="st">&quot;html = html + &#39;&lt;b&gt; Missing values: &lt;/b&gt; %d&#39;;&quot;</span>,</a>
<a class="sourceLine" id="cb3-11" title="11">      <span class="st">&quot;div.innerHTML = html;&quot;</span>,</a>
<a class="sourceLine" id="cb3-12" title="12">      <span class="dt">sep =</span> <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span></a>
<a class="sourceLine" id="cb3-13" title="13">    ), </a>
<a class="sourceLine" id="cb3-14" title="14">    prefixID,</a>
<a class="sourceLine" id="cb3-15" title="15">    i, </a>
<a class="sourceLine" id="cb3-16" title="16">    <span class="kw">formatC</span>(<span class="kw">min</span>(x, <span class="dt">na.rm=</span><span class="ot">TRUE</span>)),</a>
<a class="sourceLine" id="cb3-17" title="17">    <span class="kw">formatC</span>(<span class="kw">max</span>(x, <span class="dt">na.rm=</span><span class="ot">TRUE</span>)),</a>
<a class="sourceLine" id="cb3-18" title="18">    <span class="kw">formatC</span>(<span class="kw">mean</span>(x, <span class="dt">na.rm=</span><span class="ot">TRUE</span>)),</a>
<a class="sourceLine" id="cb3-19" title="19">    <span class="kw">formatC</span>(<span class="kw">sd</span>(x, <span class="dt">na.rm=</span><span class="ot">TRUE</span>)),</a>
<a class="sourceLine" id="cb3-20" title="20">    <span class="kw">sum</span>(<span class="kw">is.na</span>(x)))</a>
<a class="sourceLine" id="cb3-21" title="21">  }<span class="cf">else</span>{</a>
<a class="sourceLine" id="cb3-22" title="22">    <span class="cf">if</span>(<span class="kw">is.factor</span>(x)) x &lt;-<span class="st"> </span><span class="kw">as.character</span>(x)</a>
<a class="sourceLine" id="cb3-23" title="23">    levels0 &lt;-<span class="st"> </span><span class="kw">sort</span>(<span class="kw">unique</span>(<span class="kw">na.omit</span>(x)))</a>
<a class="sourceLine" id="cb3-24" title="24">    nlevels &lt;-<span class="st"> </span><span class="kw">length</span>(levels0)</a>
<a class="sourceLine" id="cb3-25" title="25">    levels &lt;-<span class="st"> </span></a>
<a class="sourceLine" id="cb3-26" title="26"><span class="st">      </span><span class="cf">if</span>(nlevels<span class="op">&gt;</span><span class="dv">3</span>) <span class="kw">c</span>(levels0[<span class="dv">1</span><span class="op">:</span><span class="dv">2</span>], levels0[nlevels]) <span class="cf">else</span> levels0</a>
<a class="sourceLine" id="cb3-27" title="27">    ncharMax &lt;-<span class="st"> </span><span class="dv">25</span></a>
<a class="sourceLine" id="cb3-28" title="28">    nchars &lt;-<span class="st"> </span><span class="kw">nchar</span>(levels)</a>
<a class="sourceLine" id="cb3-29" title="29">    <span class="cf">if</span>(<span class="dv">7</span><span class="op">+</span><span class="kw">sum</span>(nchars) <span class="op">&gt;</span><span class="st"> </span>ncharMax){</a>
<a class="sourceLine" id="cb3-30" title="30">      levels[<span class="dv">1</span>] &lt;-<span class="st"> </span><span class="kw">paste0</span>(<span class="st">&quot;&lt;br/&gt;&quot;</span>, levels[<span class="dv">1</span>])</a>
<a class="sourceLine" id="cb3-31" title="31">      <span class="cf">if</span>(nlevels <span class="op">&gt;=</span><span class="st"> </span><span class="dv">2</span> <span class="op">&amp;&amp;</span><span class="st"> </span><span class="kw">sum</span>(nchars) <span class="op">&gt;</span><span class="st"> </span>ncharMax){</a>
<a class="sourceLine" id="cb3-32" title="32">        levels[<span class="dv">2</span>] &lt;-<span class="st"> </span><span class="kw">paste0</span>(<span class="st">&quot;&lt;br/&gt;&quot;</span>, levels[<span class="dv">2</span>])</a>
<a class="sourceLine" id="cb3-33" title="33">        <span class="cf">if</span>(nlevels <span class="op">&gt;=</span><span class="st"> </span><span class="dv">3</span> <span class="op">&amp;&amp;</span><span class="st"> </span><span class="kw">sum</span>(nchars[<span class="dv">2</span><span class="op">:</span><span class="dv">3</span>]) <span class="op">&gt;</span><span class="st"> </span>ncharMax){</a>
<a class="sourceLine" id="cb3-34" title="34">          levels[<span class="dv">3</span>] &lt;-<span class="st"> </span><span class="kw">paste0</span>(<span class="st">&quot;&lt;br/&gt;&quot;</span>, levels[<span class="dv">3</span>])</a>
<a class="sourceLine" id="cb3-35" title="35">        }</a>
<a class="sourceLine" id="cb3-36" title="36">      }</a>
<a class="sourceLine" id="cb3-37" title="37">    }</a>
<a class="sourceLine" id="cb3-38" title="38">    levelsSummary &lt;-<span class="st"> </span><span class="kw">ifelse</span>(nlevels <span class="op">&gt;</span><span class="st"> </span><span class="dv">3</span>,</a>
<a class="sourceLine" id="cb3-39" title="39">                            <span class="kw">paste0</span>(<span class="kw">c</span>(levels[<span class="dv">1</span>],</a>
<a class="sourceLine" id="cb3-40" title="40">                                     <span class="kw">paste0</span>(levels[<span class="dv">2</span>], <span class="st">&quot;, ...&quot;</span>),</a>
<a class="sourceLine" id="cb3-41" title="41">                                     levels[<span class="dv">3</span>]),</a>
<a class="sourceLine" id="cb3-42" title="42">                                   <span class="dt">collapse =</span> <span class="st">&quot;, &quot;</span>),</a>
<a class="sourceLine" id="cb3-43" title="43">                            <span class="kw">paste0</span>(levels, <span class="dt">collapse =</span> <span class="st">&quot;, &quot;</span>))</a>
<a class="sourceLine" id="cb3-44" title="44">    <span class="kw">sprintf</span>(<span class="kw">paste</span>(</a>
<a class="sourceLine" id="cb3-45" title="45">      <span class="st">&quot;var div = document.getElementById(&#39;%s-%d&#39;);&quot;</span>,</a>
<a class="sourceLine" id="cb3-46" title="46">      <span class="st">&quot;var html = &#39;&lt;b&gt; Number of levels: &lt;/b&gt; %d&lt;/br&gt;&#39;;&quot;</span>,</a>
<a class="sourceLine" id="cb3-47" title="47">      <span class="kw">sprintf</span>(<span class="st">&quot;html = html + &#39;&lt;b&gt; Level%s: &lt;/b&gt; %%s&lt;/br&gt;&#39;&quot;</span>, </a>
<a class="sourceLine" id="cb3-48" title="48">              <span class="kw">ifelse</span>(nlevels<span class="op">==</span><span class="dv">1</span>, <span class="st">&quot;&quot;</span>, <span class="st">&quot;s&quot;</span>)),</a>
<a class="sourceLine" id="cb3-49" title="49">      <span class="st">&quot;html = html + &#39;&lt;b&gt; Missing values: &lt;/b&gt; %d&#39;&quot;</span>,</a>
<a class="sourceLine" id="cb3-50" title="50">      <span class="st">&quot;div.innerHTML = html;&quot;</span>,</a>
<a class="sourceLine" id="cb3-51" title="51">      <span class="dt">sep =</span> <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span></a>
<a class="sourceLine" id="cb3-52" title="52">    ),</a>
<a class="sourceLine" id="cb3-53" title="53">    prefixID,</a>
<a class="sourceLine" id="cb3-54" title="54">    i, </a>
<a class="sourceLine" id="cb3-55" title="55">    nlevels,</a>
<a class="sourceLine" id="cb3-56" title="56">    levelsSummary,</a>
<a class="sourceLine" id="cb3-57" title="57">    <span class="kw">sum</span>(<span class="kw">is.na</span>(x)))</a>
<a class="sourceLine" id="cb3-58" title="58">  }</a>
<a class="sourceLine" id="cb3-59" title="59">}</a></code></pre></div>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" title="1"><span class="kw">cat</span>(<span class="kw">fillDiv</span>(iris, <span class="dv">1</span>, <span class="st">&quot;TOOLTIP&quot;</span>))</a>
<a class="sourceLine" id="cb4-2" title="2"><span class="co">## var div = document.getElementById(&#39;TOOLTIP-1&#39;);</span></a>
<a class="sourceLine" id="cb4-3" title="3"><span class="co">## var html = &#39;&lt;b&gt; Min: &lt;/b&gt; 4.3&lt;/br&gt;&#39;;</span></a>
<a class="sourceLine" id="cb4-4" title="4"><span class="co">## html = html + &#39;&lt;b&gt; Max: &lt;/b&gt; 7.9&lt;/br&gt;&#39;;</span></a>
<a class="sourceLine" id="cb4-5" title="5"><span class="co">## html = html + &#39;&lt;b&gt; Mean: &lt;/b&gt; 5.843&lt;/br&gt;&#39;;</span></a>
<a class="sourceLine" id="cb4-6" title="6"><span class="co">## html = html + &#39;&lt;b&gt; Std. dev.: &lt;/b&gt; 0.8281&lt;/br&gt;&#39;;</span></a>
<a class="sourceLine" id="cb4-7" title="7"><span class="co">## html = html + &#39;&lt;b&gt; Missing values: &lt;/b&gt; 0&#39;;</span></a>
<a class="sourceLine" id="cb4-8" title="8"><span class="co">## div.innerHTML = html;</span></a>
<a class="sourceLine" id="cb4-9" title="9"><span class="kw">cat</span>(<span class="kw">fillDiv</span>(iris, <span class="dv">5</span>, <span class="st">&quot;TOOLTIP&quot;</span>))</a>
<a class="sourceLine" id="cb4-10" title="10"><span class="co">## var div = document.getElementById(&#39;TOOLTIP-5&#39;);</span></a>
<a class="sourceLine" id="cb4-11" title="11"><span class="co">## var html = &#39;&lt;b&gt; Number of levels: &lt;/b&gt; 3&lt;/br&gt;&#39;;</span></a>
<a class="sourceLine" id="cb4-12" title="12"><span class="co">## html = html + &#39;&lt;b&gt; Levels: &lt;/b&gt; &lt;br/&gt;setosa, versicolor, virginica&lt;/br&gt;&#39;</span></a>
<a class="sourceLine" id="cb4-13" title="13"><span class="co">## html = html + &#39;&lt;b&gt; Missing values: &lt;/b&gt; 0&#39;</span></a>
<a class="sourceLine" id="cb4-14" title="14"><span class="co">## div.innerHTML = html;</span></a></code></pre></div>
<p>Finally we write a function returning the JavaScript code of the <code>qTip</code> tooltips. Its arguments are <code>n</code>, the number of columns of the table, and <code>prefixID</code> as before.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" title="1">tooltips &lt;-<span class="st"> </span><span class="cf">function</span>(n, prefixID){</a>
<a class="sourceLine" id="cb5-2" title="2">  settings &lt;-<span class="st"> </span><span class="kw">sprintf</span>(<span class="kw">paste</span>(</a>
<a class="sourceLine" id="cb5-3" title="3">    <span class="st">&quot;{&quot;</span>,</a>
<a class="sourceLine" id="cb5-4" title="4">    <span class="st">&quot;  overwrite: true,&quot;</span>,</a>
<a class="sourceLine" id="cb5-5" title="5">    <span class="st">&quot;  content: {&quot;</span>,</a>
<a class="sourceLine" id="cb5-6" title="6">    <span class="kw">sprintf</span>(<span class="st">&quot;    text: $(&#39;#%s-%%s&#39;).clone()&quot;</span>, prefixID),</a>
<a class="sourceLine" id="cb5-7" title="7">    <span class="st">&quot;  },&quot;</span>,</a>
<a class="sourceLine" id="cb5-8" title="8">    <span class="st">&quot;  show: {&quot;</span>,</a>
<a class="sourceLine" id="cb5-9" title="9">    <span class="st">&quot;    ready: false&quot;</span>,</a>
<a class="sourceLine" id="cb5-10" title="10">    <span class="st">&quot;  },&quot;</span>,</a>
<a class="sourceLine" id="cb5-11" title="11">    <span class="st">&quot;  position: {&quot;</span>,</a>
<a class="sourceLine" id="cb5-12" title="12">    <span class="st">&quot;    my: &#39;bottom %%s&#39;,&quot;</span>,</a>
<a class="sourceLine" id="cb5-13" title="13">    <span class="st">&quot;    at: &#39;top center&#39;&quot;</span>,</a>
<a class="sourceLine" id="cb5-14" title="14">    <span class="st">&quot;  },&quot;</span>,</a>
<a class="sourceLine" id="cb5-15" title="15">    <span class="st">&quot;  style: {&quot;</span>,</a>
<a class="sourceLine" id="cb5-16" title="16">    <span class="st">&quot;    classes: &#39;qtip-youtube&#39;&quot;</span>,</a>
<a class="sourceLine" id="cb5-17" title="17">    <span class="st">&quot;  }&quot;</span>,</a>
<a class="sourceLine" id="cb5-18" title="18">    <span class="st">&quot;}&quot;</span>,</a>
<a class="sourceLine" id="cb5-19" title="19">    <span class="dt">sep =</span> <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span></a>
<a class="sourceLine" id="cb5-20" title="20">  ), <span class="dv">1</span><span class="op">:</span>n)</a>
<a class="sourceLine" id="cb5-21" title="21">  settings &lt;-<span class="st"> </span><span class="kw">sprintf</span>(settings, <span class="kw">ifelse</span>(<span class="dv">1</span><span class="op">:</span>n <span class="op">&gt;</span><span class="st"> </span>n<span class="op">/</span><span class="dv">2</span>, <span class="st">&quot;right&quot;</span>, <span class="st">&quot;left&quot;</span>))</a>
<a class="sourceLine" id="cb5-22" title="22">  <span class="kw">sprintf</span>(<span class="st">&quot;var tooltips = [%s];&quot;</span>, <span class="kw">paste0</span>(settings, <span class="dt">collapse=</span><span class="st">&quot;,&quot;</span>))</a>
<a class="sourceLine" id="cb5-23" title="23">}</a></code></pre></div>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" title="1"><span class="kw">cat</span>(<span class="kw">tooltips</span>(<span class="dv">2</span>, <span class="st">&quot;TOOLTIP&quot;</span>))</a>
<a class="sourceLine" id="cb6-2" title="2"><span class="co">## var tooltips = [{</span></a>
<a class="sourceLine" id="cb6-3" title="3"><span class="co">##   overwrite: true,</span></a>
<a class="sourceLine" id="cb6-4" title="4"><span class="co">##   content: {</span></a>
<a class="sourceLine" id="cb6-5" title="5"><span class="co">##     text: $(&#39;#TOOLTIP-1&#39;).clone()</span></a>
<a class="sourceLine" id="cb6-6" title="6"><span class="co">##   },</span></a>
<a class="sourceLine" id="cb6-7" title="7"><span class="co">##   show: {</span></a>
<a class="sourceLine" id="cb6-8" title="8"><span class="co">##     ready: false</span></a>
<a class="sourceLine" id="cb6-9" title="9"><span class="co">##   },</span></a>
<a class="sourceLine" id="cb6-10" title="10"><span class="co">##   position: {</span></a>
<a class="sourceLine" id="cb6-11" title="11"><span class="co">##     my: &#39;bottom left&#39;,</span></a>
<a class="sourceLine" id="cb6-12" title="12"><span class="co">##     at: &#39;top center&#39;</span></a>
<a class="sourceLine" id="cb6-13" title="13"><span class="co">##   },</span></a>
<a class="sourceLine" id="cb6-14" title="14"><span class="co">##   style: {</span></a>
<a class="sourceLine" id="cb6-15" title="15"><span class="co">##     classes: &#39;qtip-youtube&#39;</span></a>
<a class="sourceLine" id="cb6-16" title="16"><span class="co">##   }</span></a>
<a class="sourceLine" id="cb6-17" title="17"><span class="co">## },{</span></a>
<a class="sourceLine" id="cb6-18" title="18"><span class="co">##   overwrite: true,</span></a>
<a class="sourceLine" id="cb6-19" title="19"><span class="co">##   content: {</span></a>
<a class="sourceLine" id="cb6-20" title="20"><span class="co">##     text: $(&#39;#TOOLTIP-2&#39;).clone()</span></a>
<a class="sourceLine" id="cb6-21" title="21"><span class="co">##   },</span></a>
<a class="sourceLine" id="cb6-22" title="22"><span class="co">##   show: {</span></a>
<a class="sourceLine" id="cb6-23" title="23"><span class="co">##     ready: false</span></a>
<a class="sourceLine" id="cb6-24" title="24"><span class="co">##   },</span></a>
<a class="sourceLine" id="cb6-25" title="25"><span class="co">##   position: {</span></a>
<a class="sourceLine" id="cb6-26" title="26"><span class="co">##     my: &#39;bottom right&#39;,</span></a>
<a class="sourceLine" id="cb6-27" title="27"><span class="co">##     at: &#39;top center&#39;</span></a>
<a class="sourceLine" id="cb6-28" title="28"><span class="co">##   },</span></a>
<a class="sourceLine" id="cb6-29" title="29"><span class="co">##   style: {</span></a>
<a class="sourceLine" id="cb6-30" title="30"><span class="co">##     classes: &#39;qtip-youtube&#39;</span></a>
<a class="sourceLine" id="cb6-31" title="31"><span class="co">##   }</span></a>
<a class="sourceLine" id="cb6-32" title="32"><span class="co">## }];</span></a></code></pre></div>
<p>Now we are ready to write the Shiny app. Put the files <strong>jquery.qtip.min.css</strong> and <strong>jquery.qtip.min.js</strong> in the <strong>www</strong> subfolder. We use the <code>shinyjs</code> package to run the JavaScript code with the function <code>runjs</code>.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" title="1"><span class="kw">library</span>(shiny)</a>
<a class="sourceLine" id="cb7-2" title="2"><span class="kw">library</span>(shinyjs)</a>
<a class="sourceLine" id="cb7-3" title="3"><span class="kw">library</span>(DT)</a>
<a class="sourceLine" id="cb7-4" title="4"></a>
<a class="sourceLine" id="cb7-5" title="5">CSS &lt;-<span class="st"> &quot;</span></a>
<a class="sourceLine" id="cb7-6" title="6"><span class="st">.qtip-big { </span></a>
<a class="sourceLine" id="cb7-7" title="7"><span class="st">  font-size: 15px;</span></a>
<a class="sourceLine" id="cb7-8" title="8"><span class="st">  line-height: 18px;</span></a>
<a class="sourceLine" id="cb7-9" title="9"><span class="st">  white-space: nowrap;</span></a>
<a class="sourceLine" id="cb7-10" title="10"><span class="st">  word-spacing: 1px;</span></a>
<a class="sourceLine" id="cb7-11" title="11"><span class="st">}</span></a>
<a class="sourceLine" id="cb7-12" title="12"><span class="st">&quot;</span></a>
<a class="sourceLine" id="cb7-13" title="13"></a>
<a class="sourceLine" id="cb7-14" title="14">ui &lt;-<span class="st"> </span><span class="kw">fluidPage</span>(</a>
<a class="sourceLine" id="cb7-15" title="15">  tags<span class="op">$</span><span class="kw">head</span>(</a>
<a class="sourceLine" id="cb7-16" title="16">    tags<span class="op">$</span><span class="kw">link</span>(<span class="dt">rel =</span> <span class="st">&quot;stylesheet&quot;</span>, <span class="dt">href =</span> <span class="st">&quot;jquery.qtip.min.css&quot;</span>),</a>
<a class="sourceLine" id="cb7-17" title="17">    tags<span class="op">$</span><span class="kw">script</span>(<span class="dt">src =</span> <span class="st">&quot;jquery.qtip.min.js&quot;</span>),</a>
<a class="sourceLine" id="cb7-18" title="18">    tags<span class="op">$</span><span class="kw">style</span>(CSS)</a>
<a class="sourceLine" id="cb7-19" title="19">  ),</a>
<a class="sourceLine" id="cb7-20" title="20">  <span class="kw">useShinyjs</span>(),</a>
<a class="sourceLine" id="cb7-21" title="21">  <span class="kw">br</span>(), <span class="kw">br</span>(), <span class="kw">br</span>(), <span class="kw">br</span>(), <span class="kw">br</span>(), </a>
<a class="sourceLine" id="cb7-22" title="22">  <span class="kw">DTOutput</span>(<span class="st">&quot;dtable&quot;</span>)</a>
<a class="sourceLine" id="cb7-23" title="23">)</a>
<a class="sourceLine" id="cb7-24" title="24"></a>
<a class="sourceLine" id="cb7-25" title="25">server &lt;-<span class="st"> </span><span class="cf">function</span>(input, output, session){</a>
<a class="sourceLine" id="cb7-26" title="26">  </a>
<a class="sourceLine" id="cb7-27" title="27">  output[[<span class="st">&quot;dtable&quot;</span>]] &lt;-<span class="st"> </span><span class="kw">renderDT</span>({</a>
<a class="sourceLine" id="cb7-28" title="28">    </a>
<a class="sourceLine" id="cb7-29" title="29">    dat &lt;-<span class="st"> </span>iris</a>
<a class="sourceLine" id="cb7-30" title="30">    </a>
<a class="sourceLine" id="cb7-31" title="31">    <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="kw">ncol</span>(dat)){</a>
<a class="sourceLine" id="cb7-32" title="32">      <span class="kw">runjs</span>(<span class="kw">createDiv</span>(i, <span class="st">&quot;TOOLTIP&quot;</span>))</a>
<a class="sourceLine" id="cb7-33" title="33">      <span class="kw">runjs</span>(<span class="kw">fillDiv</span>(dat, i, <span class="st">&quot;TOOLTIP&quot;</span>))</a>
<a class="sourceLine" id="cb7-34" title="34">    }</a>
<a class="sourceLine" id="cb7-35" title="35">    </a>
<a class="sourceLine" id="cb7-36" title="36">    headerCallback &lt;-<span class="st"> </span><span class="kw">c</span>(</a>
<a class="sourceLine" id="cb7-37" title="37">      <span class="st">&quot;function(thead, data, start, end, display){&quot;</span>,</a>
<a class="sourceLine" id="cb7-38" title="38">      <span class="st">&quot;  var ncols = data[0].length;&quot;</span>,</a>
<a class="sourceLine" id="cb7-39" title="39">      <span class="kw">tooltips</span>(<span class="kw">ncol</span>(dat), <span class="st">&quot;TOOLTIP&quot;</span>),</a>
<a class="sourceLine" id="cb7-40" title="40">      <span class="st">&quot;  for(var i = 1; i &lt; ncols; i++){&quot;</span>,</a>
<a class="sourceLine" id="cb7-41" title="41">      <span class="st">&quot;    $(&#39;th:eq(&#39; + i + &#39;)&#39;, thead).qtip(tooltips[i-1]);&quot;</span>, </a>
<a class="sourceLine" id="cb7-42" title="42">      <span class="st">&quot;  }&quot;</span>,</a>
<a class="sourceLine" id="cb7-43" title="43">      <span class="st">&quot;}&quot;</span></a>
<a class="sourceLine" id="cb7-44" title="44">    )</a>
<a class="sourceLine" id="cb7-45" title="45">    </a>
<a class="sourceLine" id="cb7-46" title="46">    <span class="kw">datatable</span>(</a>
<a class="sourceLine" id="cb7-47" title="47">      dat, </a>
<a class="sourceLine" id="cb7-48" title="48">      <span class="dt">options =</span> <span class="kw">list</span>(</a>
<a class="sourceLine" id="cb7-49" title="49">        <span class="dt">headerCallback =</span> <span class="kw">JS</span>(headerCallback),</a>
<a class="sourceLine" id="cb7-50" title="50">        <span class="dt">columnDefs =</span> <span class="kw">list</span>(</a>
<a class="sourceLine" id="cb7-51" title="51">          <span class="kw">list</span>(<span class="dt">className =</span> <span class="st">&quot;dt-center&quot;</span>, <span class="dt">targets =</span> <span class="st">&quot;_all&quot;</span>)</a>
<a class="sourceLine" id="cb7-52" title="52">        )</a>
<a class="sourceLine" id="cb7-53" title="53">      )</a>
<a class="sourceLine" id="cb7-54" title="54">    )</a>
<a class="sourceLine" id="cb7-55" title="55">  })</a>
<a class="sourceLine" id="cb7-56" title="56">  </a>
<a class="sourceLine" id="cb7-57" title="57">}</a>
<a class="sourceLine" id="cb7-58" title="58"></a>
<a class="sourceLine" id="cb7-59" title="59"><span class="kw">shinyApp</span>(ui, server)</a></code></pre></div>
<p><img src="./figures/DTqTip.gif" /></p>

        </div>


        <div id="footer">
          Site proudly generated by
          <a href="http://jaspervdj.be/hakyll">Hakyll</a>
        </div>

      </div>

    </div>

    <div class="row">
      <div class="col-sm-12">
        <div id="disqus_thread"></div>
        <div class="pagination">
          <ul>
            <li>
              <a href="http://laustep.github.io/stlahblog/">&#171; Back Home</a>
            </li>
          </ul>
        </div>
      </div>
    </div>
    
  </div>

</body>

<script src="/libraries/bootstrap/bootstrap.min.js"></script>
<script>
  var disqus_developer = 1;
  var disqus_shortname = 'stlapblog';
  // required: replace example with your forum shortname
  /* * * DON'T EDIT BELOW THIS LINE * * */
  (function () {
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = 'https://' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] ||
      document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>
<noscript>Please enable JavaScript to view the
  <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a>
</noscript>
<!-- MathJax: Fall back to local if CDN offline but local image fonts are not supported (saves >100MB) -->
<script type="text/x-mathjax-config" src="../libraries/mathjax/config/TeX-MML-AM_CHTML.js"></script>
<!-- <script>
  window.MathJax || document.write('<script type="text/x-mathjax-config">MathJax.Hub.Config({"HTML-CSS":{imageFont:null}});<\/script><script src="../libraries/mathjax/MathJax.js"><\/script>');
</script> -->

  <!-- Google Prettify -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prettify/188.0.0/prettify.js"></script>
  <!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/prettify/r298/prettify.js"></script> -->
  <script src="/libraries/highlighters/prettify/js/lang-r.js"></script>
  <script>
    var pres = document.getElementsByTagName("pre");
    for (var i = 0; i < pres.length; ++i) {
      
        pres[i].className = pres[i].className + " prettyprint linenums";
      
    }
    prettyPrint();
  </script> 


</html>]]></description>
    <pubDate>Sun, 16 Feb 2020 00:00:00 UT</pubDate>
    <guid>https://laustep.github.io/stlahblog/posts/DTqTips.html</guid>
    <dc:creator>Stéphane Laurent</dc:creator>
    
        <category>R</category>
    
</item><item>
    <title>Drawing a stereographic duoprism</title>
    <link>https://laustep.github.io/stlahblog/posts/DuoprismStereo.html</link>
    <description><![CDATA[<!DOCTYPE HTML>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Saturn Elephant - Drawing a stereographic duoprism</title>
  <link href="/libraries/bootstrap/bootstrap-grid.min.css" rel="stylesheet">
  <link rel="stylesheet" href="/css/post.css" />
  <link rel="stylesheet" href="/css/misc.css" /> 
  
    <link rel="stylesheet" href="/css/pandoc-solarized.css" /> 
   
  
    <link href="/libraries/highlighters/prettify/css/minimal.css" rel="stylesheet"> 
  
  <link href="https://fonts.googleapis.com/css?family=Raleway:400,600,200,800" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/css?family=Droid+Sans" rel="stylesheet" type="text/css">
  <script src="/libraries/jquery.min.js"></script>
  <script type="text/javascript" async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML"></script>
</head>

<body>
  <div class="container-fluid">
    <div class="row">
      <!-- Sidebar. -->
      <div class="sidebar col-sm-3">
        <div style="float:right;clear:both;margin-right:50px;margin-top:150px;">
          <a href="https://www.r-bloggers.com/">
            <img src="https://www.r-bloggers.com/wp-content/uploads/2016/04/R_02_2016-05-01.png" alt="stla" width="100%" />
          </a>
          <br/>
          <a href="http://t-redactyl.io/">
            <span style="color:black;font-weight:bold;font-family:sans-serif;font-size:29px;">Standard error</span>
          </a>
          <a href="http://timelyportfolio.blogspot.be/">
            <span style="color:grey;font-weight:bold;font-family:sans-serif;font-size:27px;">Timely portfolio</span>
          </a>
          <br/>
          <a href="https://antoineguillot.wordpress.com/blog/">
            <span style="color:white;background-color:darkblue;font-weight:bold;font-family:sans-serif;font-size:25px;border:5px solid;border-color:darkblue">ENHANCE DATA</span>
          </a>
          <br/>
          <a href="https://fronkonstin.com/">
            <span style="color:black;background-color:gold;font-weight:bold;font-size:32px;border:3px solid;border-color:gold;">Fronkonstin</span>
          </a>
        </div>
      </div>

      <div class="main col-sm-9">
        <div id="header">
          <div id="logo" style="position:absolute;">
            <a href="/">
              <img src="../images/stla.jpg" alt="stla" width="100px" />
            </a>
          </div>
          <div id="navigation" style="margin-top:50px;">
            <a href="/">Home</a>
            <a href="/about.html">About</a>
            <a href="/contact.html">Contact</a>
            <a href="/archive.html">Archive</a>
          </div>
        </div>

        <div class="content">
          <h1>Drawing a stereographic duoprism</h1> 
          <div class="info">
    Posted on February 11, 2020
    
        by Stéphane Laurent
    
</div>
<div class="info">
    
    Tags: <a href="/tags/R.html">R</a>, <a href="/tags/maths.html">maths</a>, <a href="/tags/geometry.html">geometry</a>, <a href="/tags/graphics.html">graphics</a>, <a href="/tags/rgl.html">rgl</a>, <a href="/tags/asymptote.html">asymptote</a>, <a href="/tags/povray.html">povray</a>
    
</div>

<p>In this post, I’ll show how to draw a stereographic <a href="./Duoprism.html">duoprism</a> using R, Asymptote and POV-Ray.</p>
<h1 id="with-r">With R</h1>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" title="1"><span class="kw">library</span>(rgl)</a>
<a class="sourceLine" id="cb1-2" title="2"></a>
<a class="sourceLine" id="cb1-3" title="3">A &lt;-<span class="st"> </span>8L <span class="co"># number of sides of the first polygon</span></a>
<a class="sourceLine" id="cb1-4" title="4">B &lt;-<span class="st"> </span>4L <span class="co"># number of sides of the second polygon</span></a>
<a class="sourceLine" id="cb1-5" title="5"></a>
<a class="sourceLine" id="cb1-6" title="6"><span class="co"># construction of the vertices</span></a>
<a class="sourceLine" id="cb1-7" title="7">vertices &lt;-<span class="st"> </span><span class="kw">array</span>(<span class="ot">NA_real_</span>, <span class="dt">dim =</span> <span class="kw">c</span>(A,B,4L))</a>
<a class="sourceLine" id="cb1-8" title="8"><span class="cf">for</span>(i <span class="cf">in</span> 1L<span class="op">:</span>A){</a>
<a class="sourceLine" id="cb1-9" title="9">  v1 &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="kw">cos</span>(i<span class="op">/</span>A<span class="op">*</span><span class="dv">2</span><span class="op">*</span>pi), <span class="kw">sin</span>(i<span class="op">/</span>A<span class="op">*</span><span class="dv">2</span><span class="op">*</span>pi))</a>
<a class="sourceLine" id="cb1-10" title="10">  <span class="cf">for</span>(j <span class="cf">in</span> 1L<span class="op">:</span>B){</a>
<a class="sourceLine" id="cb1-11" title="11">    v2 &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="kw">cos</span>(j<span class="op">/</span>B<span class="op">*</span><span class="dv">2</span><span class="op">*</span>pi), <span class="kw">sin</span>(j<span class="op">/</span>B<span class="op">*</span><span class="dv">2</span><span class="op">*</span>pi))</a>
<a class="sourceLine" id="cb1-12" title="12">    vertices[i,j,] &lt;-<span class="st"> </span><span class="kw">c</span>(v1,v2)</a>
<a class="sourceLine" id="cb1-13" title="13">  }</a>
<a class="sourceLine" id="cb1-14" title="14">}</a>
<a class="sourceLine" id="cb1-15" title="15"></a>
<a class="sourceLine" id="cb1-16" title="16"><span class="co"># construction of the edges</span></a>
<a class="sourceLine" id="cb1-17" title="17">edges &lt;-<span class="st"> </span><span class="kw">array</span>(<span class="ot">NA_integer_</span>, <span class="dt">dim =</span> <span class="kw">c</span>(2L,2L,2L<span class="op">*</span>A<span class="op">*</span>B))</a>
<a class="sourceLine" id="cb1-18" title="18">dominates &lt;-<span class="st"> </span><span class="cf">function</span>(c1, c2){</a>
<a class="sourceLine" id="cb1-19" title="19">  c2[1L]<span class="op">&gt;</span>c1[1L] <span class="op">||</span><span class="st"> </span>(c2[1L]<span class="op">==</span>c1[1L] <span class="op">&amp;&amp;</span><span class="st"> </span>c2[2L]<span class="op">&gt;</span>c1[2L])</a>
<a class="sourceLine" id="cb1-20" title="20">}</a>
<a class="sourceLine" id="cb1-21" title="21">counter &lt;-<span class="st"> </span>1L</a>
<a class="sourceLine" id="cb1-22" title="22"><span class="cf">for</span>(i <span class="cf">in</span> <span class="kw">seq_len</span>(A)<span class="op">-</span>1L){</a>
<a class="sourceLine" id="cb1-23" title="23">  <span class="cf">for</span>(j <span class="cf">in</span> <span class="kw">seq_len</span>(B)<span class="op">-</span>1L){</a>
<a class="sourceLine" id="cb1-24" title="24">    c1 &lt;-<span class="st"> </span><span class="kw">c</span>(i,j)</a>
<a class="sourceLine" id="cb1-25" title="25">    candidate &lt;-<span class="st"> </span><span class="kw">c</span>(i, (j<span class="op">-</span>1L)<span class="op">%%</span>B)</a>
<a class="sourceLine" id="cb1-26" title="26">    <span class="cf">if</span>(<span class="kw">dominates</span>(c1, candidate)){</a>
<a class="sourceLine" id="cb1-27" title="27">      edges[,,counter] &lt;-<span class="st"> </span><span class="kw">cbind</span>(c1, candidate) <span class="op">+</span><span class="st"> </span>1L</a>
<a class="sourceLine" id="cb1-28" title="28">      counter &lt;-<span class="st"> </span>counter <span class="op">+</span><span class="st"> </span>1L</a>
<a class="sourceLine" id="cb1-29" title="29">    }</a>
<a class="sourceLine" id="cb1-30" title="30">    candidate &lt;-<span class="st"> </span><span class="kw">c</span>(i, (j<span class="op">+</span>1L)<span class="op">%%</span>B)</a>
<a class="sourceLine" id="cb1-31" title="31">    <span class="cf">if</span>(<span class="kw">dominates</span>(c1, candidate)){</a>
<a class="sourceLine" id="cb1-32" title="32">      edges[,,counter] &lt;-<span class="st"> </span><span class="kw">cbind</span>(c1, candidate) <span class="op">+</span><span class="st"> </span>1L</a>
<a class="sourceLine" id="cb1-33" title="33">      counter &lt;-<span class="st"> </span>counter <span class="op">+</span><span class="st"> </span>1L</a>
<a class="sourceLine" id="cb1-34" title="34">    }</a>
<a class="sourceLine" id="cb1-35" title="35">    candidate &lt;-<span class="st"> </span><span class="kw">c</span>((i<span class="op">-</span>1L)<span class="op">%%</span>A, j)</a>
<a class="sourceLine" id="cb1-36" title="36">    <span class="cf">if</span>(<span class="kw">dominates</span>(c1, candidate)){</a>
<a class="sourceLine" id="cb1-37" title="37">      edges[,,counter] &lt;-<span class="st"> </span><span class="kw">cbind</span>(c1, candidate) <span class="op">+</span><span class="st"> </span>1L</a>
<a class="sourceLine" id="cb1-38" title="38">      counter &lt;-<span class="st"> </span>counter <span class="op">+</span><span class="st"> </span>1L</a>
<a class="sourceLine" id="cb1-39" title="39">    }</a>
<a class="sourceLine" id="cb1-40" title="40">    candidate &lt;-<span class="st"> </span><span class="kw">c</span>((i<span class="op">+</span>1L)<span class="op">%%</span>A, j)</a>
<a class="sourceLine" id="cb1-41" title="41">    <span class="cf">if</span>(<span class="kw">dominates</span>(c1, candidate)){</a>
<a class="sourceLine" id="cb1-42" title="42">      edges[,,counter] &lt;-<span class="st"> </span><span class="kw">cbind</span>(c1, candidate) <span class="op">+</span><span class="st"> </span>1L</a>
<a class="sourceLine" id="cb1-43" title="43">      counter &lt;-<span class="st"> </span>counter <span class="op">+</span><span class="st"> </span>1L</a>
<a class="sourceLine" id="cb1-44" title="44">    }</a>
<a class="sourceLine" id="cb1-45" title="45">  }</a>
<a class="sourceLine" id="cb1-46" title="46">}</a>
<a class="sourceLine" id="cb1-47" title="47"></a>
<a class="sourceLine" id="cb1-48" title="48"><span class="co"># stereographic projection</span></a>
<a class="sourceLine" id="cb1-49" title="49">stereog &lt;-<span class="st"> </span><span class="cf">function</span>(v){</a>
<a class="sourceLine" id="cb1-50" title="50">  v[1L<span class="op">:</span>3L] <span class="op">/</span><span class="st"> </span>(<span class="kw">sqrt</span>(<span class="dv">2</span>) <span class="op">-</span><span class="st"> </span>v[4L])</a>
<a class="sourceLine" id="cb1-51" title="51">}</a>
<a class="sourceLine" id="cb1-52" title="52"></a>
<a class="sourceLine" id="cb1-53" title="53"><span class="co"># spherical segment</span></a>
<a class="sourceLine" id="cb1-54" title="54">sphericalSegment &lt;-<span class="st"> </span><span class="cf">function</span>(P, Q, n){</a>
<a class="sourceLine" id="cb1-55" title="55">  out &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="ot">NA_real_</span>, <span class="dt">nrow =</span> n<span class="op">+</span>1L, <span class="dt">ncol =</span> 4L)</a>
<a class="sourceLine" id="cb1-56" title="56">  <span class="cf">for</span>(i <span class="cf">in</span> 0L<span class="op">:</span>n){</a>
<a class="sourceLine" id="cb1-57" title="57">    pt &lt;-<span class="st"> </span>P <span class="op">+</span><span class="st"> </span>(i<span class="op">/</span>n)<span class="op">*</span>(Q<span class="op">-</span>P)</a>
<a class="sourceLine" id="cb1-58" title="58">    out[i<span class="op">+</span>1L, ] &lt;-<span class="st"> </span><span class="kw">sqrt</span>(<span class="dv">2</span><span class="op">/</span><span class="kw">c</span>(<span class="kw">crossprod</span>(pt))) <span class="op">*</span><span class="st"> </span>pt</a>
<a class="sourceLine" id="cb1-59" title="59">  }</a>
<a class="sourceLine" id="cb1-60" title="60">  out</a>
<a class="sourceLine" id="cb1-61" title="61">}</a>
<a class="sourceLine" id="cb1-62" title="62"></a>
<a class="sourceLine" id="cb1-63" title="63"><span class="co"># stereographic edge</span></a>
<a class="sourceLine" id="cb1-64" title="64">stereoEdge &lt;-<span class="st"> </span><span class="cf">function</span>(verts, v1, v2){</a>
<a class="sourceLine" id="cb1-65" title="65">  P &lt;-<span class="st"> </span>verts[v1[1L], v1[2L], ]</a>
<a class="sourceLine" id="cb1-66" title="66">  Q &lt;-<span class="st"> </span>verts[v2[1L], v2[2L], ]</a>
<a class="sourceLine" id="cb1-67" title="67">  PQ &lt;-<span class="st"> </span><span class="kw">sphericalSegment</span>(P, Q, 100L)</a>
<a class="sourceLine" id="cb1-68" title="68">  pq &lt;-<span class="st"> </span><span class="kw">t</span>(<span class="kw">apply</span>(PQ, 1L, stereog))</a>
<a class="sourceLine" id="cb1-69" title="69">  dists &lt;-<span class="st"> </span><span class="kw">sqrt</span>(<span class="kw">apply</span>(pq, 1L, crossprod))</a>
<a class="sourceLine" id="cb1-70" title="70">  <span class="kw">cylinder3d</span>(pq, <span class="dt">radius =</span> dists<span class="op">/</span><span class="dv">15</span>, <span class="dt">sides =</span> <span class="dv">60</span>)</a>
<a class="sourceLine" id="cb1-71" title="71">}</a>
<a class="sourceLine" id="cb1-72" title="72"></a>
<a class="sourceLine" id="cb1-73" title="73"><span class="co"># projected vertices</span></a>
<a class="sourceLine" id="cb1-74" title="74">vs &lt;-<span class="st"> </span><span class="kw">apply</span>(vertices, <span class="kw">c</span>(1L,2L), stereog)</a>
<a class="sourceLine" id="cb1-75" title="75"></a>
<a class="sourceLine" id="cb1-76" title="76"><span class="co">####~~~~ plot ~~~~####</span></a>
<a class="sourceLine" id="cb1-77" title="77"><span class="kw">open3d</span>(<span class="dt">windowRect =</span> <span class="kw">c</span>(<span class="dv">50</span>, <span class="dv">50</span>, <span class="dv">562</span>, <span class="dv">562</span>), <span class="dt">zoom =</span> <span class="fl">0.9</span>)</a>
<a class="sourceLine" id="cb1-78" title="78"><span class="kw">bg3d</span>(<span class="kw">rgb</span>(<span class="dv">54</span>, <span class="dv">57</span>, <span class="dv">64</span>, <span class="dt">maxColorValue =</span> <span class="dv">255</span>))</a>
<a class="sourceLine" id="cb1-79" title="79"><span class="co">## plot the edges</span></a>
<a class="sourceLine" id="cb1-80" title="80"><span class="cf">for</span>(k <span class="cf">in</span> 1L<span class="op">:</span>(2L<span class="op">*</span>A<span class="op">*</span>B)){</a>
<a class="sourceLine" id="cb1-81" title="81">  v1 &lt;-<span class="st"> </span>edges[, 1L, k]</a>
<a class="sourceLine" id="cb1-82" title="82">  v2 &lt;-<span class="st"> </span>edges[, 2L, k]</a>
<a class="sourceLine" id="cb1-83" title="83">  edge &lt;-<span class="st"> </span><span class="kw">stereoEdge</span>(vertices, v1, v2)</a>
<a class="sourceLine" id="cb1-84" title="84">  <span class="kw">shade3d</span>(edge, <span class="dt">color =</span> <span class="st">&quot;gold&quot;</span>)</a>
<a class="sourceLine" id="cb1-85" title="85">}</a>
<a class="sourceLine" id="cb1-86" title="86"><span class="co">## plot the vertices</span></a>
<a class="sourceLine" id="cb1-87" title="87"><span class="cf">for</span>(i <span class="cf">in</span> 1L<span class="op">:</span>A){</a>
<a class="sourceLine" id="cb1-88" title="88">  <span class="cf">for</span>(j <span class="cf">in</span> 1L<span class="op">:</span>B){</a>
<a class="sourceLine" id="cb1-89" title="89">    v &lt;-<span class="st"> </span>vs[,i,j]</a>
<a class="sourceLine" id="cb1-90" title="90">    <span class="kw">spheres3d</span>(v, <span class="dt">radius =</span> <span class="kw">sqrt</span>(<span class="kw">c</span>(<span class="kw">crossprod</span>(v)))<span class="op">/</span><span class="dv">10</span> , <span class="dt">color =</span> <span class="st">&quot;gold2&quot;</span>)</a>
<a class="sourceLine" id="cb1-91" title="91">  }</a>
<a class="sourceLine" id="cb1-92" title="92">}</a></code></pre></div>
<p><img src="./figures/DuoprismStereo_R.png" /></p>
<h1 id="with-asymptote">With Asymptote</h1>
<div class="sourceCode" id="cb2"><pre class="sourceCode cpp"><code class="sourceCode cpp"><a class="sourceLine" id="cb2-1" title="1">settings.render = <span class="dv">4</span>;</a>
<a class="sourceLine" id="cb2-2" title="2">settings.outformat = <span class="st">&quot;eps&quot;</span>;</a>
<a class="sourceLine" id="cb2-3" title="3">import tube;</a>
<a class="sourceLine" id="cb2-4" title="4">size(<span class="dv">200</span>,<span class="dv">0</span>);</a>
<a class="sourceLine" id="cb2-5" title="5"></a>
<a class="sourceLine" id="cb2-6" title="6">currentprojection = orthographic(<span class="dv">4</span>,<span class="dv">4</span>,<span class="dv">4</span>);</a>
<a class="sourceLine" id="cb2-7" title="7">currentlight = light(gray(<span class="fl">0.85</span>), ambient=black, specularfactor=<span class="dv">3</span>,</a>
<a class="sourceLine" id="cb2-8" title="8">                     (<span class="dv">100</span>,<span class="dv">100</span>,<span class="dv">100</span>), specular=gray(<span class="fl">0.9</span>), viewport=<span class="kw">false</span>);</a>
<a class="sourceLine" id="cb2-9" title="9">currentlight.background = rgb(<span class="st">&quot;363940ff&quot;</span>);</a>
<a class="sourceLine" id="cb2-10" title="10"></a>
<a class="sourceLine" id="cb2-11" title="11"><span class="co">// files to be saved -----------------------------------------------------------</span></a>
<a class="sourceLine" id="cb2-12" title="12">string[] files = {</a>
<a class="sourceLine" id="cb2-13" title="13">    <span class="st">&quot;DP000&quot;</span>, <span class="st">&quot;DP001&quot;</span>, <span class="st">&quot;DP002&quot;</span>, <span class="st">&quot;DP003&quot;</span>, <span class="st">&quot;DP004&quot;</span>, <span class="st">&quot;DP005&quot;</span>,</a>
<a class="sourceLine" id="cb2-14" title="14">    <span class="st">&quot;DP006&quot;</span>, <span class="st">&quot;DP007&quot;</span>, <span class="st">&quot;DP008&quot;</span>, <span class="st">&quot;DP009&quot;</span>, <span class="st">&quot;DP010&quot;</span>, <span class="st">&quot;DP011&quot;</span>,</a>
<a class="sourceLine" id="cb2-15" title="15">    <span class="st">&quot;DP012&quot;</span>, <span class="st">&quot;DP013&quot;</span>, <span class="st">&quot;DP014&quot;</span>, <span class="st">&quot;DP015&quot;</span>, <span class="st">&quot;DP016&quot;</span>, <span class="st">&quot;DP017&quot;</span>,</a>
<a class="sourceLine" id="cb2-16" title="16">    <span class="st">&quot;DP018&quot;</span>, <span class="st">&quot;DP019&quot;</span>, <span class="st">&quot;DP020&quot;</span>, <span class="st">&quot;DP021&quot;</span>, <span class="st">&quot;DP022&quot;</span>, <span class="st">&quot;DP023&quot;</span>,</a>
<a class="sourceLine" id="cb2-17" title="17">    <span class="st">&quot;DP024&quot;</span>, <span class="st">&quot;DP025&quot;</span>, <span class="st">&quot;DP026&quot;</span>, <span class="st">&quot;DP027&quot;</span>, <span class="st">&quot;DP028&quot;</span>, <span class="st">&quot;DP029&quot;</span>,</a>
<a class="sourceLine" id="cb2-18" title="18">    <span class="st">&quot;DP030&quot;</span>, <span class="st">&quot;DP031&quot;</span>, <span class="st">&quot;DP032&quot;</span>, <span class="st">&quot;DP033&quot;</span>, <span class="st">&quot;DP034&quot;</span>, <span class="st">&quot;DP035&quot;</span>,</a>
<a class="sourceLine" id="cb2-19" title="19">    <span class="st">&quot;DP036&quot;</span>, <span class="st">&quot;DP037&quot;</span>, <span class="st">&quot;DP038&quot;</span>, <span class="st">&quot;DP039&quot;</span>, <span class="st">&quot;DP040&quot;</span>, <span class="st">&quot;DP041&quot;</span>,</a>
<a class="sourceLine" id="cb2-20" title="20">    <span class="st">&quot;DP042&quot;</span>, <span class="st">&quot;DP043&quot;</span>, <span class="st">&quot;DP044&quot;</span>, <span class="st">&quot;DP045&quot;</span>, <span class="st">&quot;DP046&quot;</span>, <span class="st">&quot;DP047&quot;</span>,</a>
<a class="sourceLine" id="cb2-21" title="21">    <span class="st">&quot;DP048&quot;</span>, <span class="st">&quot;DP049&quot;</span>, <span class="st">&quot;DP050&quot;</span>, <span class="st">&quot;DP051&quot;</span>, <span class="st">&quot;DP052&quot;</span>, <span class="st">&quot;DP053&quot;</span>,</a>
<a class="sourceLine" id="cb2-22" title="22">    <span class="st">&quot;DP054&quot;</span>, <span class="st">&quot;DP055&quot;</span>, <span class="st">&quot;DP056&quot;</span>, <span class="st">&quot;DP057&quot;</span>, <span class="st">&quot;DP058&quot;</span>, <span class="st">&quot;DP059&quot;</span>,</a>
<a class="sourceLine" id="cb2-23" title="23">    <span class="st">&quot;DP060&quot;</span>, <span class="st">&quot;DP061&quot;</span>, <span class="st">&quot;DP062&quot;</span>, <span class="st">&quot;DP063&quot;</span>, <span class="st">&quot;DP064&quot;</span>, <span class="st">&quot;DP065&quot;</span>,</a>
<a class="sourceLine" id="cb2-24" title="24">    <span class="st">&quot;DP066&quot;</span>, <span class="st">&quot;DP067&quot;</span>, <span class="st">&quot;DP068&quot;</span>, <span class="st">&quot;DP069&quot;</span>, <span class="st">&quot;DP070&quot;</span>, <span class="st">&quot;DP071&quot;</span>,</a>
<a class="sourceLine" id="cb2-25" title="25">    <span class="st">&quot;DP072&quot;</span>, <span class="st">&quot;DP073&quot;</span>, <span class="st">&quot;DP074&quot;</span>, <span class="st">&quot;DP075&quot;</span>, <span class="st">&quot;DP076&quot;</span>, <span class="st">&quot;DP077&quot;</span>,</a>
<a class="sourceLine" id="cb2-26" title="26">    <span class="st">&quot;DP078&quot;</span>, <span class="st">&quot;DP079&quot;</span>, <span class="st">&quot;DP080&quot;</span>, <span class="st">&quot;DP081&quot;</span>, <span class="st">&quot;DP082&quot;</span>, <span class="st">&quot;DP083&quot;</span>,</a>
<a class="sourceLine" id="cb2-27" title="27">    <span class="st">&quot;DP084&quot;</span>, <span class="st">&quot;DP085&quot;</span>, <span class="st">&quot;DP086&quot;</span>, <span class="st">&quot;DP087&quot;</span>, <span class="st">&quot;DP088&quot;</span>, <span class="st">&quot;DP089&quot;</span>,</a>
<a class="sourceLine" id="cb2-28" title="28">    <span class="st">&quot;DP090&quot;</span>, <span class="st">&quot;DP091&quot;</span>, <span class="st">&quot;DP092&quot;</span>, <span class="st">&quot;DP093&quot;</span>, <span class="st">&quot;DP094&quot;</span>, <span class="st">&quot;DP095&quot;</span>,</a>
<a class="sourceLine" id="cb2-29" title="29">    <span class="st">&quot;DP096&quot;</span>, <span class="st">&quot;DP097&quot;</span>, <span class="st">&quot;DP098&quot;</span>, <span class="st">&quot;DP099&quot;</span>, <span class="st">&quot;DP100&quot;</span>, <span class="st">&quot;DP101&quot;</span>,</a>
<a class="sourceLine" id="cb2-30" title="30">    <span class="st">&quot;DP102&quot;</span>, <span class="st">&quot;DP103&quot;</span>, <span class="st">&quot;DP104&quot;</span>, <span class="st">&quot;DP105&quot;</span>, <span class="st">&quot;DP106&quot;</span>, <span class="st">&quot;DP107&quot;</span>,</a>
<a class="sourceLine" id="cb2-31" title="31">    <span class="st">&quot;DP108&quot;</span>, <span class="st">&quot;DP109&quot;</span>, <span class="st">&quot;DP110&quot;</span>, <span class="st">&quot;DP111&quot;</span>, <span class="st">&quot;DP112&quot;</span>, <span class="st">&quot;DP113&quot;</span>,</a>
<a class="sourceLine" id="cb2-32" title="32">    <span class="st">&quot;DP114&quot;</span>, <span class="st">&quot;DP115&quot;</span>, <span class="st">&quot;DP116&quot;</span>, <span class="st">&quot;DP117&quot;</span>, <span class="st">&quot;DP118&quot;</span>, <span class="st">&quot;DP119&quot;</span>,</a>
<a class="sourceLine" id="cb2-33" title="33">    <span class="st">&quot;DP120&quot;</span>, <span class="st">&quot;DP121&quot;</span>, <span class="st">&quot;DP122&quot;</span>, <span class="st">&quot;DP123&quot;</span>, <span class="st">&quot;DP124&quot;</span>, <span class="st">&quot;DP125&quot;</span>,</a>
<a class="sourceLine" id="cb2-34" title="34">    <span class="st">&quot;DP126&quot;</span>, <span class="st">&quot;DP127&quot;</span>, <span class="st">&quot;DP128&quot;</span>, <span class="st">&quot;DP129&quot;</span>, <span class="st">&quot;DP130&quot;</span>, <span class="st">&quot;DP131&quot;</span>,</a>
<a class="sourceLine" id="cb2-35" title="35">    <span class="st">&quot;DP132&quot;</span>, <span class="st">&quot;DP133&quot;</span>, <span class="st">&quot;DP134&quot;</span>, <span class="st">&quot;DP135&quot;</span>, <span class="st">&quot;DP136&quot;</span>, <span class="st">&quot;DP137&quot;</span>,</a>
<a class="sourceLine" id="cb2-36" title="36">    <span class="st">&quot;DP138&quot;</span>, <span class="st">&quot;DP139&quot;</span>, <span class="st">&quot;DP140&quot;</span>, <span class="st">&quot;DP141&quot;</span>, <span class="st">&quot;DP142&quot;</span>, <span class="st">&quot;DP143&quot;</span>,</a>
<a class="sourceLine" id="cb2-37" title="37">    <span class="st">&quot;DP144&quot;</span>, <span class="st">&quot;DP145&quot;</span>, <span class="st">&quot;DP146&quot;</span>, <span class="st">&quot;DP147&quot;</span>, <span class="st">&quot;DP148&quot;</span>, <span class="st">&quot;DP149&quot;</span>,</a>
<a class="sourceLine" id="cb2-38" title="38">    <span class="st">&quot;DP150&quot;</span>, <span class="st">&quot;DP151&quot;</span>, <span class="st">&quot;DP152&quot;</span>, <span class="st">&quot;DP153&quot;</span>, <span class="st">&quot;DP154&quot;</span>, <span class="st">&quot;DP155&quot;</span>,</a>
<a class="sourceLine" id="cb2-39" title="39">    <span class="st">&quot;DP156&quot;</span>, <span class="st">&quot;DP157&quot;</span>, <span class="st">&quot;DP158&quot;</span>, <span class="st">&quot;DP159&quot;</span>, <span class="st">&quot;DP160&quot;</span>, <span class="st">&quot;DP161&quot;</span>,</a>
<a class="sourceLine" id="cb2-40" title="40">    <span class="st">&quot;DP162&quot;</span>, <span class="st">&quot;DP163&quot;</span>, <span class="st">&quot;DP164&quot;</span>, <span class="st">&quot;DP165&quot;</span>, <span class="st">&quot;DP166&quot;</span>, <span class="st">&quot;DP167&quot;</span>,</a>
<a class="sourceLine" id="cb2-41" title="41">    <span class="st">&quot;DP168&quot;</span>, <span class="st">&quot;DP169&quot;</span>, <span class="st">&quot;DP170&quot;</span>, <span class="st">&quot;DP171&quot;</span>, <span class="st">&quot;DP172&quot;</span>, <span class="st">&quot;DP173&quot;</span>,</a>
<a class="sourceLine" id="cb2-42" title="42">    <span class="st">&quot;DP174&quot;</span>, <span class="st">&quot;DP175&quot;</span>, <span class="st">&quot;DP176&quot;</span>, <span class="st">&quot;DP177&quot;</span>, <span class="st">&quot;DP178&quot;</span>, <span class="st">&quot;DP179&quot;</span>};</a>
<a class="sourceLine" id="cb2-43" title="43"></a>
<a class="sourceLine" id="cb2-44" title="44"><span class="co">// lexicographic order ---------------------------------------------------------</span></a>
<a class="sourceLine" id="cb2-45" title="45"><span class="dt">bool</span> dominates(<span class="dt">int</span>[] e1, <span class="dt">int</span>[] e2){</a>
<a class="sourceLine" id="cb2-46" title="46">    <span class="cf">return</span> e2[<span class="dv">0</span>]&gt;e1[<span class="dv">0</span>] || (e2[<span class="dv">0</span>]==e1[<span class="dv">0</span>] &amp;&amp; e2[<span class="dv">1</span>]&gt;e1[<span class="dv">1</span>]);</a>
<a class="sourceLine" id="cb2-47" title="47">}</a>
<a class="sourceLine" id="cb2-48" title="48"></a>
<a class="sourceLine" id="cb2-49" title="49"><span class="co">// vertices --------------------------------------------------------------------</span></a>
<a class="sourceLine" id="cb2-50" title="50"><span class="dt">int</span> A = <span class="dv">8</span>;</a>
<a class="sourceLine" id="cb2-51" title="51"><span class="dt">int</span> B = <span class="dv">4</span>;</a>
<a class="sourceLine" id="cb2-52" title="52"></a>
<a class="sourceLine" id="cb2-53" title="53"><span class="kw">struct</span> quadruple {</a>
<a class="sourceLine" id="cb2-54" title="54">    real x;</a>
<a class="sourceLine" id="cb2-55" title="55">    real y;</a>
<a class="sourceLine" id="cb2-56" title="56">    real z;</a>
<a class="sourceLine" id="cb2-57" title="57">    real t;</a>
<a class="sourceLine" id="cb2-58" title="58">}</a>
<a class="sourceLine" id="cb2-59" title="59"></a>
<a class="sourceLine" id="cb2-60" title="60">real[][] poly1 = <span class="kw">new</span> real[A][<span class="dv">2</span>];</a>
<a class="sourceLine" id="cb2-61" title="61"><span class="cf">for</span>(<span class="dt">int</span> i = <span class="dv">0</span>; i &lt; A; ++i){</a>
<a class="sourceLine" id="cb2-62" title="62">    poly1[i][<span class="dv">0</span>] = cos(i/A*<span class="dv">2</span><span class="er">pi</span>);</a>
<a class="sourceLine" id="cb2-63" title="63">    poly1[i][<span class="dv">1</span>] = sin(i/A*<span class="dv">2</span><span class="er">pi</span>);</a>
<a class="sourceLine" id="cb2-64" title="64">}</a>
<a class="sourceLine" id="cb2-65" title="65">real[][] poly2 = <span class="kw">new</span> real[B][<span class="dv">2</span>];</a>
<a class="sourceLine" id="cb2-66" title="66"><span class="cf">for</span>(<span class="dt">int</span> i = <span class="dv">0</span>; i &lt; B; ++i){</a>
<a class="sourceLine" id="cb2-67" title="67">    poly2[i][<span class="dv">0</span>] = cos(pi/B+i/B*<span class="dv">2</span><span class="er">pi</span>);</a>
<a class="sourceLine" id="cb2-68" title="68">    poly2[i][<span class="dv">1</span>] = sin(pi/B+i/B*<span class="dv">2</span><span class="er">pi</span>);</a>
<a class="sourceLine" id="cb2-69" title="69">}</a>
<a class="sourceLine" id="cb2-70" title="70">quadruple[][] vertices = <span class="kw">new</span> quadruple[A][B];</a>
<a class="sourceLine" id="cb2-71" title="71"><span class="cf">for</span>(<span class="dt">int</span> i = <span class="dv">0</span>; i &lt; A; ++i){</a>
<a class="sourceLine" id="cb2-72" title="72">    <span class="cf">for</span>(<span class="dt">int</span> j = <span class="dv">0</span>; j &lt; B; ++j){</a>
<a class="sourceLine" id="cb2-73" title="73">        quadruple v;</a>
<a class="sourceLine" id="cb2-74" title="74">        v.x = poly1[i][<span class="dv">0</span>]; v.y = poly1[i][<span class="dv">1</span>]; </a>
<a class="sourceLine" id="cb2-75" title="75">        v.z = poly2[j][<span class="dv">0</span>]; v.t = poly2[j][<span class="dv">1</span>];</a>
<a class="sourceLine" id="cb2-76" title="76">        vertices[i][j] = v;</a>
<a class="sourceLine" id="cb2-77" title="77">    }</a>
<a class="sourceLine" id="cb2-78" title="78">}</a>
<a class="sourceLine" id="cb2-79" title="79"></a>
<a class="sourceLine" id="cb2-80" title="80"><span class="co">// edges -----------------------------------------------------------------------</span></a>
<a class="sourceLine" id="cb2-81" title="81"><span class="dt">int</span>[][][] edges;</a>
<a class="sourceLine" id="cb2-82" title="82"><span class="cf">for</span>(<span class="dt">int</span> i = <span class="dv">0</span>; i &lt; A; ++i){</a>
<a class="sourceLine" id="cb2-83" title="83">    <span class="cf">for</span>(<span class="dt">int</span> j = <span class="dv">0</span>; j &lt; B; ++j){</a>
<a class="sourceLine" id="cb2-84" title="84">        <span class="dt">int</span>[] e = {i,j};</a>
<a class="sourceLine" id="cb2-85" title="85">        <span class="dt">int</span>[] candidate = {i,(j-<span class="dv">1</span>)%B};</a>
<a class="sourceLine" id="cb2-86" title="86">        <span class="cf">if</span>(dominates(e,candidate)){</a>
<a class="sourceLine" id="cb2-87" title="87">            <span class="dt">int</span>[][] edge = {e,candidate}; </a>
<a class="sourceLine" id="cb2-88" title="88">            edges.push(edge);</a>
<a class="sourceLine" id="cb2-89" title="89">        }</a>
<a class="sourceLine" id="cb2-90" title="90">        <span class="dt">int</span>[] candidate = {i,(j+<span class="dv">1</span>)%B};</a>
<a class="sourceLine" id="cb2-91" title="91">        <span class="cf">if</span>(dominates(e,candidate)){</a>
<a class="sourceLine" id="cb2-92" title="92">            <span class="dt">int</span>[][] edge = {e,candidate}; </a>
<a class="sourceLine" id="cb2-93" title="93">            edges.push(edge);</a>
<a class="sourceLine" id="cb2-94" title="94">        }</a>
<a class="sourceLine" id="cb2-95" title="95">        <span class="dt">int</span>[] candidate = {(i-<span class="dv">1</span>)%A,j};</a>
<a class="sourceLine" id="cb2-96" title="96">        <span class="cf">if</span>(dominates(e,candidate)){</a>
<a class="sourceLine" id="cb2-97" title="97">            <span class="dt">int</span>[][] edge = {e,candidate}; </a>
<a class="sourceLine" id="cb2-98" title="98">            edges.push(edge);</a>
<a class="sourceLine" id="cb2-99" title="99">        }</a>
<a class="sourceLine" id="cb2-100" title="100">        <span class="dt">int</span>[] candidate = {(i+<span class="dv">1</span>)%A,j};</a>
<a class="sourceLine" id="cb2-101" title="101">        <span class="cf">if</span>(dominates(e,candidate)){</a>
<a class="sourceLine" id="cb2-102" title="102">            <span class="dt">int</span>[][] edge = {e,candidate}; </a>
<a class="sourceLine" id="cb2-103" title="103">            edges.push(edge);</a>
<a class="sourceLine" id="cb2-104" title="104">        }</a>
<a class="sourceLine" id="cb2-105" title="105">    }</a>
<a class="sourceLine" id="cb2-106" title="106">}</a>
<a class="sourceLine" id="cb2-107" title="107"></a>
<a class="sourceLine" id="cb2-108" title="108"><span class="co">// rotation in 4D space (right-isoclinic) --------------------------------------</span></a>
<a class="sourceLine" id="cb2-109" title="109">quadruple rotate4d(real alpha, real beta, real xi, quadruple vec){</a>
<a class="sourceLine" id="cb2-110" title="110">    real a = cos(xi);</a>
<a class="sourceLine" id="cb2-111" title="111">    real b = sin(alpha)*cos(beta)*sin(xi);</a>
<a class="sourceLine" id="cb2-112" title="112">    real c = sin(alpha)*sin(beta)*sin(xi);</a>
<a class="sourceLine" id="cb2-113" title="113">    real d = cos(alpha)*sin(xi);</a>
<a class="sourceLine" id="cb2-114" title="114">    real p = vec.x;</a>
<a class="sourceLine" id="cb2-115" title="115">    real q = vec.y;</a>
<a class="sourceLine" id="cb2-116" title="116">    real r = vec.z;</a>
<a class="sourceLine" id="cb2-117" title="117">    real s = vec.t;</a>
<a class="sourceLine" id="cb2-118" title="118">    quadruple out;</a>
<a class="sourceLine" id="cb2-119" title="119">    out.x = a*p - b*q - c*r - d*s;</a>
<a class="sourceLine" id="cb2-120" title="120">    out.y = a*q + b*p + c*s - d*r;</a>
<a class="sourceLine" id="cb2-121" title="121">    out.z = a*r - b*s + c*p + d*q;</a>
<a class="sourceLine" id="cb2-122" title="122">    out.t = a*s + b*r - c*q + d*p;</a>
<a class="sourceLine" id="cb2-123" title="123">    <span class="cf">return</span> out;</a>
<a class="sourceLine" id="cb2-124" title="124">}</a>
<a class="sourceLine" id="cb2-125" title="125"></a>
<a class="sourceLine" id="cb2-126" title="126"><span class="co">// stereographic projection ----------------------------------------------------</span></a>
<a class="sourceLine" id="cb2-127" title="127">triple stereog(quadruple A, real r){</a>
<a class="sourceLine" id="cb2-128" title="128">    <span class="cf">return</span> (A.x, A.y, A.z) / (r - A.t);</a>
<a class="sourceLine" id="cb2-129" title="129">}</a>
<a class="sourceLine" id="cb2-130" title="130"></a>
<a class="sourceLine" id="cb2-131" title="131"><span class="co">// stereographic path ----------------------------------------------------------</span></a>
<a class="sourceLine" id="cb2-132" title="132">path3 stereoPath(quadruple A, quadruple B, real r, <span class="dt">int</span> n){</a>
<a class="sourceLine" id="cb2-133" title="133">    path3 out;</a>
<a class="sourceLine" id="cb2-134" title="134">    <span class="cf">for</span>(<span class="dt">int</span> i = <span class="dv">0</span>; i &lt;= n; ++i){</a>
<a class="sourceLine" id="cb2-135" title="135">        real t = i/n;</a>
<a class="sourceLine" id="cb2-136" title="136">        quadruple M;</a>
<a class="sourceLine" id="cb2-137" title="137">        real x = (<span class="dv">1</span>-t)*A.x + t*B.x;</a>
<a class="sourceLine" id="cb2-138" title="138">        real y = (<span class="dv">1</span>-t)*A.y + t*B.y;</a>
<a class="sourceLine" id="cb2-139" title="139">        real z = (<span class="dv">1</span>-t)*A.z + t*B.z;</a>
<a class="sourceLine" id="cb2-140" title="140">        real t = (<span class="dv">1</span>-t)*A.t + t*B.t;</a>
<a class="sourceLine" id="cb2-141" title="141">        real lg = sqrt(x*x + y*y + z*z + t*t) / r;</a>
<a class="sourceLine" id="cb2-142" title="142">        M.x = x / lg; M.y = y / lg; M.z = z / lg; M.t = t / lg;</a>
<a class="sourceLine" id="cb2-143" title="143">        out = out .. stereog(M, r);</a>
<a class="sourceLine" id="cb2-144" title="144">    }</a>
<a class="sourceLine" id="cb2-145" title="145">    <span class="cf">return</span> out;</a>
<a class="sourceLine" id="cb2-146" title="146">}</a>
<a class="sourceLine" id="cb2-147" title="147"></a>
<a class="sourceLine" id="cb2-148" title="148"><span class="co">// section transformation ------------------------------------------------------</span></a>
<a class="sourceLine" id="cb2-149" title="149">transform T(path3 p3, real t, <span class="dt">int</span> n){</a>
<a class="sourceLine" id="cb2-150" title="150">    triple M = relpoint(p3, t/(n/<span class="dv">4</span>));</a>
<a class="sourceLine" id="cb2-151" title="151">    <span class="cf">return</span> scale(length(M)/<span class="dv">15</span>); </a>
<a class="sourceLine" id="cb2-152" title="152">}</a>
<a class="sourceLine" id="cb2-153" title="153"></a>
<a class="sourceLine" id="cb2-154" title="154"><span class="co">// bounding box ----------------------------------------------------------------</span></a>
<a class="sourceLine" id="cb2-155" title="155">real f=<span class="dv">3</span>, h = <span class="fl">4.5</span>, g = <span class="fl">1.5</span>;</a>
<a class="sourceLine" id="cb2-156" title="156">path3 boundingbox = (-h,<span class="dv">0</span>,-f)--(-h,<span class="dv">0</span>,g)--(h,<span class="dv">0</span>,f)--(h,<span class="dv">0</span>,-g)--cycle;</a>
<a class="sourceLine" id="cb2-157" title="157"></a>
<a class="sourceLine" id="cb2-158" title="158"><span class="co">// draw the duoprism -----------------------------------------------------------</span></a>
<a class="sourceLine" id="cb2-159" title="159"><span class="dt">int</span> n = <span class="dv">100</span>;</a>
<a class="sourceLine" id="cb2-160" title="160">real r = sqrt(<span class="dv">2</span>);</a>
<a class="sourceLine" id="cb2-161" title="161">real alpha = pi/<span class="dv">2</span>, beta = <span class="dv">0</span>;</a>
<a class="sourceLine" id="cb2-162" title="162"></a>
<a class="sourceLine" id="cb2-163" title="163"><span class="cf">for</span>(<span class="dt">int</span> file = <span class="dv">0</span>; file &lt; <span class="dv">180</span>; ++file){</a>
<a class="sourceLine" id="cb2-164" title="164">    real xi = <span class="dv">2</span>*file*pi/<span class="dv">180</span>;</a>
<a class="sourceLine" id="cb2-165" title="165">    picture pic;</a>
<a class="sourceLine" id="cb2-166" title="166">    <span class="co">// draw bounding box</span></a>
<a class="sourceLine" id="cb2-167" title="167">    draw(pic, boundingbox, rgb(<span class="st">&quot;363940ff&quot;</span>)+opacity(<span class="dv">0</span>));</a>
<a class="sourceLine" id="cb2-168" title="168">    <span class="co">// draw edges</span></a>
<a class="sourceLine" id="cb2-169" title="169">    <span class="cf">for</span>(<span class="dt">int</span> k = <span class="dv">0</span>; k &lt; <span class="dv">2</span>*A*B; ++k){</a>
<a class="sourceLine" id="cb2-170" title="170">        quadruple A = vertices[edges[k][<span class="dv">0</span>][<span class="dv">0</span>]][edges[k][<span class="dv">0</span>][<span class="dv">1</span>]];</a>
<a class="sourceLine" id="cb2-171" title="171">        quadruple B = vertices[edges[k][<span class="dv">1</span>][<span class="dv">0</span>]][edges[k][<span class="dv">1</span>][<span class="dv">1</span>]];</a>
<a class="sourceLine" id="cb2-172" title="172">        path3 p3 = </a>
<a class="sourceLine" id="cb2-173" title="173">            stereoPath(rotate4d(alpha, beta, xi, A), </a>
<a class="sourceLine" id="cb2-174" title="174">                       rotate4d(alpha, beta, xi, B), r, n);</a>
<a class="sourceLine" id="cb2-175" title="175">        transform S(real t){</a>
<a class="sourceLine" id="cb2-176" title="176">            <span class="cf">return</span> T(p3, t, n);</a>
<a class="sourceLine" id="cb2-177" title="177">        }</a>
<a class="sourceLine" id="cb2-178" title="178">        draw(pic, tube(p3, unitcircle, S), rgb(<span class="dv">139</span>,<span class="dv">0</span>,<span class="dv">139</span>), </a>
<a class="sourceLine" id="cb2-179" title="179">                                render(compression=Low, merge=<span class="kw">true</span>));</a>
<a class="sourceLine" id="cb2-180" title="180">    }</a>
<a class="sourceLine" id="cb2-181" title="181">    <span class="co">// draw vertices</span></a>
<a class="sourceLine" id="cb2-182" title="182">    <span class="cf">for</span>(<span class="dt">int</span> i = <span class="dv">0</span>; i &lt; A; ++i){</a>
<a class="sourceLine" id="cb2-183" title="183">        <span class="cf">for</span>(<span class="dt">int</span> j = <span class="dv">0</span>; j &lt; B; ++j){</a>
<a class="sourceLine" id="cb2-184" title="184">            triple Asg = </a>
<a class="sourceLine" id="cb2-185" title="185">                stereog(rotate4d(alpha, beta, xi, vertices[i][j]), r);</a>
<a class="sourceLine" id="cb2-186" title="186">            draw(pic, shift(Asg)*scale3(length(Asg)/<span class="dv">10</span>)*unitsphere, purple);</a>
<a class="sourceLine" id="cb2-187" title="187">        }</a>
<a class="sourceLine" id="cb2-188" title="188">    }</a>
<a class="sourceLine" id="cb2-189" title="189">    <span class="co">// add and save picture</span></a>
<a class="sourceLine" id="cb2-190" title="190">    add(pic);</a>
<a class="sourceLine" id="cb2-191" title="191">    shipout(files[file], bbox(rgb(<span class="st">&quot;363940ff&quot;</span>), FillDraw(rgb(<span class="st">&quot;363940ff&quot;</span>))));</a>
<a class="sourceLine" id="cb2-192" title="192">    erase();</a>
<a class="sourceLine" id="cb2-193" title="193">}</a>
<a class="sourceLine" id="cb2-194" title="194"></a>
<a class="sourceLine" id="cb2-195" title="195"><span class="co">/* to do the animation</span></a>
<a class="sourceLine" id="cb2-196" title="196"><span class="co">gs -dSAFER -dBATCH -dNOPAUSE -dEPSCrop -sDEVICE=png16m -r600 -sOutputFile=zpic%03d.png DP*.eps</span></a>
<a class="sourceLine" id="cb2-197" title="197"><span class="co">mogrify -resize 512x zpic*.png</span></a>
<a class="sourceLine" id="cb2-198" title="198"><span class="co">gifski --fps 12 zpic*.png -o DuoprismStereo.gif</span></a>
<a class="sourceLine" id="cb2-199" title="199"><span class="co">*/</span></a></code></pre></div>
<p><img src="./figures/DuoprismStereo_Asy.gif" /></p>
<h1 id="with-pov-ray">With POV-Ray</h1>
<div class="sourceCode" id="cb3"><pre class="sourceCode povray"><code class="sourceCode povray"><a class="sourceLine" id="cb3-1" title="1"><span class="ot">#version</span> <span class="fl">3.7</span>;</a>
<a class="sourceLine" id="cb3-2" title="2"><span class="kw">global_settings</span> { <span class="kw">assumed_gamma</span> <span class="fl">1</span> }</a>
<a class="sourceLine" id="cb3-3" title="3"><span class="ot">#include</span> <span class="st">&quot;colors.inc&quot;</span></a>
<a class="sourceLine" id="cb3-4" title="4"><span class="ot">#include</span> <span class="st">&quot;textures.inc&quot;</span></a>
<a class="sourceLine" id="cb3-5" title="5"></a>
<a class="sourceLine" id="cb3-6" title="6"><span class="co">/* camera */</span></a>
<a class="sourceLine" id="cb3-7" title="7"><span class="kw">camera</span> {</a>
<a class="sourceLine" id="cb3-8" title="8">  <span class="kw">location</span> &lt;-<span class="fl">11</span>, <span class="fl">7</span>, <span class="fl">-32</span>&gt;</a>
<a class="sourceLine" id="cb3-9" title="9">  <span class="kw">look_at</span> <span class="fl">0</span></a>
<a class="sourceLine" id="cb3-10" title="10">  <span class="kw">angle</span> <span class="fl">45</span></a>
<a class="sourceLine" id="cb3-11" title="11">  <span class="kw">right</span> <span class="kw">x</span>*<span class="kw">image_width</span>/<span class="kw">image_height</span></a>
<a class="sourceLine" id="cb3-12" title="12">}</a>
<a class="sourceLine" id="cb3-13" title="13"></a>
<a class="sourceLine" id="cb3-14" title="14"><span class="co">// sun -------------------------------------------------------------------------</span></a>
<a class="sourceLine" id="cb3-15" title="15"><span class="kw">light_source</span> {&lt; <span class="fl">4000</span>,<span class="fl">6000</span>,-<span class="fl">6000</span>&gt; <span class="kw">color</span> <span class="kw">rgb</span>&lt;<span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span>&gt;*<span class="fl">0.9</span>}           <span class="co">// sun </span></a>
<a class="sourceLine" id="cb3-16" title="16"><span class="kw">light_source</span> {&lt;-<span class="fl">11</span>, <span class="fl">7</span>,-<span class="fl">32</span>&gt;  <span class="kw">color</span> <span class="kw">rgb</span>&lt;<span class="fl">0.9</span>,<span class="fl">0.9</span>,<span class="fl">1</span>&gt;*<span class="fl">0.1</span> <span class="kw">shadowless</span>} <span class="co">// flash</span></a>
<a class="sourceLine" id="cb3-17" title="17"></a>
<a class="sourceLine" id="cb3-18" title="18"><span class="co">// sky -------------------------------------------------------------------------</span></a>
<a class="sourceLine" id="cb3-19" title="19"><span class="kw">plane</span> {</a>
<a class="sourceLine" id="cb3-20" title="20">  &lt;<span class="fl">0</span>,<span class="fl">1</span>,<span class="fl">0</span>&gt;, <span class="fl">1</span> <span class="kw">hollow</span>  </a>
<a class="sourceLine" id="cb3-21" title="21">  <span class="kw">texture</span> {</a>
<a class="sourceLine" id="cb3-22" title="22">    <span class="kw">pigment</span> { </a>
<a class="sourceLine" id="cb3-23" title="23">      <span class="kw">bozo</span> <span class="kw">turbulence</span> <span class="fl">1.3</span></a>
<a class="sourceLine" id="cb3-24" title="24">      <span class="kw">color_map</span> {</a>
<a class="sourceLine" id="cb3-25" title="25">        [<span class="fl">0.00</span> <span class="kw">rgb</span> &lt;<span class="fl">0.24</span>, <span class="fl">0.32</span>, <span class="fl">1.0</span>&gt;*<span class="fl">0.6</span>]</a>
<a class="sourceLine" id="cb3-26" title="26">        [<span class="fl">0.75</span> <span class="kw">rgb</span> &lt;<span class="fl">0.24</span>, <span class="fl">0.32</span>, <span class="fl">1.0</span>&gt;*<span class="fl">0.6</span>]</a>
<a class="sourceLine" id="cb3-27" title="27">        [<span class="fl">0.83</span> <span class="kw">rgb</span> &lt;<span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span>&gt;]</a>
<a class="sourceLine" id="cb3-28" title="28">        [<span class="fl">0.95</span> <span class="kw">rgb</span> &lt;<span class="fl">0.25</span>,<span class="fl">0.25</span>,<span class="fl">0.25</span>&gt;]</a>
<a class="sourceLine" id="cb3-29" title="29">        [<span class="fl">1.0</span> <span class="kw">rgb</span> &lt;<span class="fl">0.5</span>,<span class="fl">0.5</span>,<span class="fl">0.5</span>&gt;]</a>
<a class="sourceLine" id="cb3-30" title="30">      }</a>
<a class="sourceLine" id="cb3-31" title="31">      <span class="kw">scale</span>&lt;<span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span>&gt;*<span class="fl">2.5</span>  <span class="kw">translate</span>&lt; <span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">3</span>&gt;</a>
<a class="sourceLine" id="cb3-32" title="32">    }</a>
<a class="sourceLine" id="cb3-33" title="33">    <span class="kw">finish</span> {</a>
<a class="sourceLine" id="cb3-34" title="34">      <span class="kw">ambient</span> <span class="fl">1</span> </a>
<a class="sourceLine" id="cb3-35" title="35">      <span class="kw">diffuse</span> <span class="fl">0</span></a>
<a class="sourceLine" id="cb3-36" title="36">    } </a>
<a class="sourceLine" id="cb3-37" title="37">  }      </a>
<a class="sourceLine" id="cb3-38" title="38">  <span class="kw">scale</span> <span class="fl">10000</span></a>
<a class="sourceLine" id="cb3-39" title="39">}</a>
<a class="sourceLine" id="cb3-40" title="40"></a>
<a class="sourceLine" id="cb3-41" title="41"><span class="co">// fog on the ground -----------------------------------------------------------</span></a>
<a class="sourceLine" id="cb3-42" title="42"><span class="kw">fog</span> {</a>
<a class="sourceLine" id="cb3-43" title="43">  <span class="kw">fog_type</span>   <span class="fl">2</span></a>
<a class="sourceLine" id="cb3-44" title="44">  <span class="kw">distance</span>   <span class="fl">50</span></a>
<a class="sourceLine" id="cb3-45" title="45">  <span class="kw">color</span>      Gray10  </a>
<a class="sourceLine" id="cb3-46" title="46">  <span class="kw">fog_offset</span> <span class="fl">0.1</span></a>
<a class="sourceLine" id="cb3-47" title="47">  <span class="kw">fog_alt</span>    <span class="fl">1.5</span></a>
<a class="sourceLine" id="cb3-48" title="48">  <span class="kw">turbulence</span> <span class="fl">1.8</span></a>
<a class="sourceLine" id="cb3-49" title="49">}</a>
<a class="sourceLine" id="cb3-50" title="50"></a>
<a class="sourceLine" id="cb3-51" title="51"><span class="co">// ground ----------------------------------------------------------------------</span></a>
<a class="sourceLine" id="cb3-52" title="52"><span class="kw">plane</span> {</a>
<a class="sourceLine" id="cb3-53" title="53">  &lt;<span class="fl">0</span>,<span class="fl">1</span>,<span class="fl">0</span>&gt;, <span class="fl">0</span> </a>
<a class="sourceLine" id="cb3-54" title="54">  <span class="kw">texture</span> {</a>
<a class="sourceLine" id="cb3-55" title="55">    <span class="kw">pigment</span> { <span class="kw">color</span> <span class="kw">rgb</span> &lt;<span class="fl">0.95</span>,<span class="fl">0.9</span>,<span class="fl">0.73</span>&gt;*<span class="fl">0.35</span> }</a>
<a class="sourceLine" id="cb3-56" title="56">    <span class="kw">normal</span> { <span class="kw">bumps</span> <span class="fl">2</span> <span class="kw">scale</span> &lt;<span class="fl">0.25</span>,<span class="fl">0.25</span>,<span class="fl">0.25</span>&gt;*<span class="fl">0.5</span> <span class="kw">turbulence</span> <span class="fl">0.5</span> } </a>
<a class="sourceLine" id="cb3-57" title="57">    <span class="kw">finish</span> { <span class="kw">phong</span> <span class="fl">0.1</span> }</a>
<a class="sourceLine" id="cb3-58" title="58">  } </a>
<a class="sourceLine" id="cb3-59" title="59">} </a>
<a class="sourceLine" id="cb3-60" title="60"></a>
<a class="sourceLine" id="cb3-61" title="61"></a>
<a class="sourceLine" id="cb3-62" title="62"><span class="co">/* ----- vertices ----- */</span></a>
<a class="sourceLine" id="cb3-63" title="63"><span class="kw">#declare A </span>= <span class="fl">4</span>;</a>
<a class="sourceLine" id="cb3-64" title="64"><span class="kw">#declare B </span>= <span class="fl">30</span>;</a>
<a class="sourceLine" id="cb3-65" title="65"></a>
<a class="sourceLine" id="cb3-66" title="66"><span class="kw">#declare poly1 </span>= <span class="kw">array</span>[A];</a>
<a class="sourceLine" id="cb3-67" title="67">#for(i,<span class="fl">0</span>,A<span class="fl">-1</span>)</a>
<a class="sourceLine" id="cb3-68" title="68">  <span class="kw">#declare poly1</span>[i] = <span class="kw">array</span>[<span class="fl">2</span>] {<span class="kw">cos</span>(i/A*<span class="fl">2</span>*<span class="fl">pi</span>), <span class="kw">sin</span>(i/A*<span class="fl">2</span>*<span class="fl">pi</span>)};</a>
<a class="sourceLine" id="cb3-69" title="69"><span class="ot">#end</span></a>
<a class="sourceLine" id="cb3-70" title="70"><span class="kw">#declare poly2 </span>= <span class="kw">array</span>[B];</a>
<a class="sourceLine" id="cb3-71" title="71">#for(i,<span class="fl">0</span>,B<span class="fl">-1</span>)</a>
<a class="sourceLine" id="cb3-72" title="72">  <span class="kw">#declare poly2</span>[i] = <span class="kw">array</span>[<span class="fl">2</span>] {<span class="kw">cos</span>(i/B*<span class="fl">2</span>*<span class="fl">pi</span>), <span class="kw">sin</span>(i/B*<span class="fl">2</span>*<span class="fl">pi</span>)};</a>
<a class="sourceLine" id="cb3-73" title="73"><span class="ot">#end</span></a>
<a class="sourceLine" id="cb3-74" title="74"><span class="kw">#declare vertices </span>= <span class="kw">array</span>[A][B];</a>
<a class="sourceLine" id="cb3-75" title="75">#for(i,<span class="fl">0</span>,A<span class="fl">-1</span>)</a>
<a class="sourceLine" id="cb3-76" title="76">  #for(j,<span class="fl">0</span>,B<span class="fl">-1</span>)</a>
<a class="sourceLine" id="cb3-77" title="77">    <span class="kw">#declare vertices</span>[i][j] = </a>
<a class="sourceLine" id="cb3-78" title="78">      &lt; poly1[i][<span class="fl">0</span>], poly1[i][<span class="fl">1</span>], poly2[j][<span class="fl">0</span>], poly2[j][<span class="fl">1</span>] &gt;;</a>
<a class="sourceLine" id="cb3-79" title="79">  <span class="ot">#end</span></a>
<a class="sourceLine" id="cb3-80" title="80"><span class="ot">#end</span></a>
<a class="sourceLine" id="cb3-81" title="81"></a>
<a class="sourceLine" id="cb3-82" title="82"><span class="co">/* ----- edges ----- */</span></a>
<a class="sourceLine" id="cb3-83" title="83"><span class="kw">#macro dominates</span>(e1,e2)</a>
<a class="sourceLine" id="cb3-84" title="84">  (e2[<span class="fl">0</span>]&gt;e1[<span class="fl">0</span>]) | ((e2[<span class="fl">0</span>]=e1[<span class="fl">0</span>]) &amp; (e2[<span class="fl">1</span>]&gt;e1[<span class="fl">1</span>]))</a>
<a class="sourceLine" id="cb3-85" title="85"><span class="ot">#end</span></a>
<a class="sourceLine" id="cb3-86" title="86"><span class="kw">#declare nedges </span>= <span class="fl">2</span>*A*B;</a>
<a class="sourceLine" id="cb3-87" title="87"><span class="kw">#declare edges </span>= <span class="kw">array</span>[nedges];</a>
<a class="sourceLine" id="cb3-88" title="88"><span class="kw">#declare k</span>=<span class="fl">0</span>;</a>
<a class="sourceLine" id="cb3-89" title="89">#for(i,<span class="fl">0</span>,A<span class="fl">-1</span>)</a>
<a class="sourceLine" id="cb3-90" title="90">  #for(j,<span class="fl">0</span>,B<span class="fl">-1</span>)</a>
<a class="sourceLine" id="cb3-91" title="91">    <span class="kw">#local e </span>= <span class="kw">array</span>[<span class="fl">2</span>] {i,j};</a>
<a class="sourceLine" id="cb3-92" title="92">    <span class="kw">#local candidate </span>= <span class="kw">array</span>[<span class="fl">2</span>] {i,<span class="kw">mod</span>(<span class="kw">mod</span>(j<span class="fl">-1</span>,B)+B,B)};</a>
<a class="sourceLine" id="cb3-93" title="93">    <span class="ot">#if</span>(dominates(e,candidate))</a>
<a class="sourceLine" id="cb3-94" title="94">      <span class="kw">#local edge </span>= <span class="kw">array</span>[<span class="fl">2</span>] {e,candidate};</a>
<a class="sourceLine" id="cb3-95" title="95">      <span class="kw">#declare edges</span>[k] = edge;</a>
<a class="sourceLine" id="cb3-96" title="96">      <span class="kw">#declare k </span>= k+<span class="fl">1</span>;</a>
<a class="sourceLine" id="cb3-97" title="97">    <span class="ot">#end</span></a>
<a class="sourceLine" id="cb3-98" title="98">    <span class="kw">#local candidate </span>= <span class="kw">array</span>[<span class="fl">2</span>] {i,<span class="kw">mod</span>(<span class="kw">mod</span>(j+<span class="fl">1</span>,B)+B,B)};</a>
<a class="sourceLine" id="cb3-99" title="99">    <span class="ot">#if</span>(dominates(e,candidate))</a>
<a class="sourceLine" id="cb3-100" title="100">      <span class="kw">#local edge </span>= <span class="kw">array</span>[<span class="fl">2</span>] {e,candidate};</a>
<a class="sourceLine" id="cb3-101" title="101">      <span class="kw">#declare edges</span>[k] = edge;</a>
<a class="sourceLine" id="cb3-102" title="102">      <span class="kw">#declare k </span>= k+<span class="fl">1</span>;</a>
<a class="sourceLine" id="cb3-103" title="103">    <span class="ot">#end</span></a>
<a class="sourceLine" id="cb3-104" title="104">    <span class="kw">#local candidate </span>= <span class="kw">array</span>[<span class="fl">2</span>] {<span class="kw">mod</span>(<span class="kw">mod</span>(i<span class="fl">-1</span>,A)+A,A),j};</a>
<a class="sourceLine" id="cb3-105" title="105">    <span class="ot">#if</span>(dominates(e,candidate))</a>
<a class="sourceLine" id="cb3-106" title="106">      <span class="kw">#local edge </span>= <span class="kw">array</span>[<span class="fl">2</span>] {e,candidate};</a>
<a class="sourceLine" id="cb3-107" title="107">      <span class="kw">#declare edges</span>[k] = edge;</a>
<a class="sourceLine" id="cb3-108" title="108">      <span class="kw">#declare k </span>= k+<span class="fl">1</span>;</a>
<a class="sourceLine" id="cb3-109" title="109">    <span class="ot">#end</span></a>
<a class="sourceLine" id="cb3-110" title="110">    <span class="kw">#local candidate </span>= <span class="kw">array</span>[<span class="fl">2</span>] {<span class="kw">mod</span>(<span class="kw">mod</span>(i+<span class="fl">1</span>,A)+A,A),j};</a>
<a class="sourceLine" id="cb3-111" title="111">    <span class="ot">#if</span>(dominates(e,candidate))</a>
<a class="sourceLine" id="cb3-112" title="112">      <span class="kw">#local edge </span>= <span class="kw">array</span>[<span class="fl">2</span>] {e,candidate};</a>
<a class="sourceLine" id="cb3-113" title="113">      <span class="kw">#declare edges</span>[k] = edge;</a>
<a class="sourceLine" id="cb3-114" title="114">      <span class="kw">#declare k </span>= k+<span class="fl">1</span>;</a>
<a class="sourceLine" id="cb3-115" title="115">    <span class="ot">#end</span></a>
<a class="sourceLine" id="cb3-116" title="116">  <span class="ot">#end</span></a>
<a class="sourceLine" id="cb3-117" title="117"><span class="ot">#end</span></a>
<a class="sourceLine" id="cb3-118" title="118"></a>
<a class="sourceLine" id="cb3-119" title="119"><span class="co">/* rotation in 4D space */</span></a>
<a class="sourceLine" id="cb3-120" title="120"><span class="kw">#macro rotate4d</span>(theta,phi,xi,vec)</a>
<a class="sourceLine" id="cb3-121" title="121">  <span class="kw">#local a </span>= <span class="kw">cos</span>(xi);</a>
<a class="sourceLine" id="cb3-122" title="122">  <span class="kw">#local b </span>= <span class="kw">sin</span>(theta)*<span class="kw">cos</span>(phi)*<span class="kw">sin</span>(xi);</a>
<a class="sourceLine" id="cb3-123" title="123">  <span class="kw">#local c </span>= <span class="kw">sin</span>(theta)*<span class="kw">sin</span>(phi)*<span class="kw">sin</span>(xi);</a>
<a class="sourceLine" id="cb3-124" title="124">  <span class="kw">#local d </span>= <span class="kw">cos</span>(theta)*<span class="kw">sin</span>(xi);</a>
<a class="sourceLine" id="cb3-125" title="125">  <span class="kw">#local p </span>= vec.<span class="kw">x</span>;</a>
<a class="sourceLine" id="cb3-126" title="126">  <span class="kw">#local q </span>= vec.<span class="kw">y</span>;</a>
<a class="sourceLine" id="cb3-127" title="127">  <span class="kw">#local r </span>= vec.<span class="kw">z</span>;</a>
<a class="sourceLine" id="cb3-128" title="128">  <span class="kw">#local s </span>= vec.<span class="kw">t</span>;</a>
<a class="sourceLine" id="cb3-129" title="129">  &lt; a*p - b*q - c*r - d*s</a>
<a class="sourceLine" id="cb3-130" title="130">  , a*q + b*p + c*s - d*r</a>
<a class="sourceLine" id="cb3-131" title="131">  , a*r - b*s + c*p + d*q</a>
<a class="sourceLine" id="cb3-132" title="132">  , a*s + b*r - c*q + d*p &gt;</a>
<a class="sourceLine" id="cb3-133" title="133"><span class="ot">#end</span></a>
<a class="sourceLine" id="cb3-134" title="134"></a>
<a class="sourceLine" id="cb3-135" title="135"><span class="co">/* stereographic projection */</span></a>
<a class="sourceLine" id="cb3-136" title="136"><span class="kw">#macro StereographicProjection</span>(q)</a>
<a class="sourceLine" id="cb3-137" title="137">  &lt;q.<span class="kw">x</span>,q.<span class="kw">y</span>,q.<span class="kw">z</span>&gt; / (<span class="kw">sqrt</span>(<span class="fl">2</span>)-q.<span class="kw">t</span>)</a>
<a class="sourceLine" id="cb3-138" title="138"><span class="ot">#end</span></a>
<a class="sourceLine" id="cb3-139" title="139"></a>
<a class="sourceLine" id="cb3-140" title="140"><span class="co">/* rotated and projected vertices */</span></a>
<a class="sourceLine" id="cb3-141" title="141"><span class="kw">#macro ProjectedVertices</span>(theta,phi,xi)</a>
<a class="sourceLine" id="cb3-142" title="142">  <span class="kw">#local out </span>= <span class="kw">array</span>[A][B];</a>
<a class="sourceLine" id="cb3-143" title="143">  #for(i,<span class="fl">0</span>,A<span class="fl">-1</span>)</a>
<a class="sourceLine" id="cb3-144" title="144">    #for(j,<span class="fl">0</span>,B<span class="fl">-1</span>)</a>
<a class="sourceLine" id="cb3-145" title="145">      <span class="kw">#local out</span>[i][j] = StereographicProjection(</a>
<a class="sourceLine" id="cb3-146" title="146">                            rotate4d(theta,phi,xi,vertices[i][j])</a>
<a class="sourceLine" id="cb3-147" title="147">                          );</a>
<a class="sourceLine" id="cb3-148" title="148">    <span class="ot">#end</span></a>
<a class="sourceLine" id="cb3-149" title="149">  <span class="ot">#end</span></a>
<a class="sourceLine" id="cb3-150" title="150">  out</a>
<a class="sourceLine" id="cb3-151" title="151"><span class="ot">#end</span></a>
<a class="sourceLine" id="cb3-152" title="152"></a>
<a class="sourceLine" id="cb3-153" title="153"><span class="co">/* macro spherical segment */</span></a>
<a class="sourceLine" id="cb3-154" title="154"><span class="kw">#macro vlength4</span>(P)</a>
<a class="sourceLine" id="cb3-155" title="155">  <span class="kw">sqrt</span>(P.<span class="kw">x</span>*P.<span class="kw">x</span> + P.<span class="kw">y</span>*P.<span class="kw">y</span> + P.<span class="kw">z</span>*P.<span class="kw">z</span> + P.<span class="kw">t</span>*P.<span class="kw">t</span>)</a>
<a class="sourceLine" id="cb3-156" title="156"><span class="ot">#end</span></a>
<a class="sourceLine" id="cb3-157" title="157"></a>
<a class="sourceLine" id="cb3-158" title="158"><span class="kw">#macro sphericalSegment</span>(P, Q, n)</a>
<a class="sourceLine" id="cb3-159" title="159">  <span class="kw">#local out </span>= <span class="kw">array</span>[n+<span class="fl">1</span>];</a>
<a class="sourceLine" id="cb3-160" title="160">  #for(i, <span class="fl">0</span>, n)</a>
<a class="sourceLine" id="cb3-161" title="161">    <span class="kw">#local pt </span>= P + (i/n)*(Q-P);</a>
<a class="sourceLine" id="cb3-162" title="162">    <span class="kw">#local out</span>[i] = <span class="kw">sqrt</span>(<span class="fl">2</span>)/vlength4(pt) * pt;</a>
<a class="sourceLine" id="cb3-163" title="163">  <span class="ot">#end</span></a>
<a class="sourceLine" id="cb3-164" title="164">  out</a>
<a class="sourceLine" id="cb3-165" title="165"><span class="ot">#end</span></a>
<a class="sourceLine" id="cb3-166" title="166"></a>
<a class="sourceLine" id="cb3-167" title="167"><span class="co">/* macro to draw an edge */</span></a>
<a class="sourceLine" id="cb3-168" title="168"><span class="kw">#macro Edge</span>(verts, v1, v2, theta, phi, xi, Tex)</a>
<a class="sourceLine" id="cb3-169" title="169">  <span class="kw">#local P </span>= verts[v1[<span class="fl">0</span>]][v1[<span class="fl">1</span>]];</a>
<a class="sourceLine" id="cb3-170" title="170">  <span class="kw">#local Q </span>= verts[v2[<span class="fl">0</span>]][v2[<span class="fl">1</span>]];</a>
<a class="sourceLine" id="cb3-171" title="171">  <span class="kw">#local PQ </span>= sphericalSegment(P, Q, <span class="fl">100</span>);</a>
<a class="sourceLine" id="cb3-172" title="172">  <span class="kw">sphere_sweep</span> {</a>
<a class="sourceLine" id="cb3-173" title="173">    <span class="kw">b_spline</span> <span class="fl">101</span></a>
<a class="sourceLine" id="cb3-174" title="174">    #for(k,<span class="fl">0</span>,<span class="fl">100</span>)</a>
<a class="sourceLine" id="cb3-175" title="175">      <span class="kw">#local O </span>= </a>
<a class="sourceLine" id="cb3-176" title="176">        StereographicProjection(rotate4d(theta,phi,xi,PQ[k]));</a>
<a class="sourceLine" id="cb3-177" title="177">      O <span class="kw">vlength</span>(O)/<span class="fl">15</span></a>
<a class="sourceLine" id="cb3-178" title="178">    <span class="ot">#end</span></a>
<a class="sourceLine" id="cb3-179" title="179">    <span class="kw">texture</span> { Tex }</a>
<a class="sourceLine" id="cb3-180" title="180">  }</a>
<a class="sourceLine" id="cb3-181" title="181"><span class="ot">#end</span></a>
<a class="sourceLine" id="cb3-182" title="182"></a>
<a class="sourceLine" id="cb3-183" title="183"><span class="co">/*-----------------------------------------*/</span></a>
<a class="sourceLine" id="cb3-184" title="184"><span class="co">/*-----      draw the duoprism       ------*/</span></a>
<a class="sourceLine" id="cb3-185" title="185"><span class="co">/*-----------------------------------------*/</span></a>
<a class="sourceLine" id="cb3-186" title="186"><span class="kw">#declare theta </span>= <span class="fl">pi</span>/<span class="fl">2</span>;</a>
<a class="sourceLine" id="cb3-187" title="187"><span class="kw">#declare phi </span>= <span class="fl">0</span>;</a>
<a class="sourceLine" id="cb3-188" title="188"><span class="kw">#declare xi </span>= <span class="fl">2</span>*<span class="kw">frame_number</span>*<span class="fl">pi</span>/<span class="fl">180</span>; </a>
<a class="sourceLine" id="cb3-189" title="189"></a>
<a class="sourceLine" id="cb3-190" title="190"><span class="kw">#declare vs </span>= ProjectedVertices(theta, phi, xi);</a>
<a class="sourceLine" id="cb3-191" title="191"></a>
<a class="sourceLine" id="cb3-192" title="192"><span class="kw">#declare edgeTexture </span>= <span class="kw">texture</span> {</a>
<a class="sourceLine" id="cb3-193" title="193">  <span class="kw">pigment</span> { <span class="kw">color</span> Red }</a>
<a class="sourceLine" id="cb3-194" title="194">  <span class="kw">finish</span> {</a>
<a class="sourceLine" id="cb3-195" title="195">    <span class="kw">ambient</span> <span class="fl">.1</span></a>
<a class="sourceLine" id="cb3-196" title="196">    <span class="kw">diffuse</span> <span class="fl">.9</span></a>
<a class="sourceLine" id="cb3-197" title="197">    <span class="kw">reflection</span> <span class="fl">0</span></a>
<a class="sourceLine" id="cb3-198" title="198">    <span class="kw">specular</span> <span class="fl">1</span></a>
<a class="sourceLine" id="cb3-199" title="199">    <span class="kw">metallic</span></a>
<a class="sourceLine" id="cb3-200" title="200">  }</a>
<a class="sourceLine" id="cb3-201" title="201">};</a>
<a class="sourceLine" id="cb3-202" title="202"></a>
<a class="sourceLine" id="cb3-203" title="203"><span class="kw">object</span> {</a>
<a class="sourceLine" id="cb3-204" title="204">  <span class="kw">union</span> {</a>
<a class="sourceLine" id="cb3-205" title="205">    <span class="co">/* draw edges */</span></a>
<a class="sourceLine" id="cb3-206" title="206">    #for(i, <span class="fl">0</span>, <span class="fl">2</span>*A*B<span class="fl">-1</span>)</a>
<a class="sourceLine" id="cb3-207" title="207">      Edge(vertices, edges[i][<span class="fl">0</span>], edges[i][<span class="fl">1</span>], </a>
<a class="sourceLine" id="cb3-208" title="208">                    theta, phi, xi, edgeTexture)</a>
<a class="sourceLine" id="cb3-209" title="209">    <span class="ot">#end</span></a>
<a class="sourceLine" id="cb3-210" title="210">    <span class="co">/* draw vertices */</span></a>
<a class="sourceLine" id="cb3-211" title="211">    #for(i,<span class="fl">0</span>,A<span class="fl">-1</span>)</a>
<a class="sourceLine" id="cb3-212" title="212">      #for(j,<span class="fl">0</span>,B<span class="fl">-1</span>)</a>
<a class="sourceLine" id="cb3-213" title="213">        <span class="kw">sphere</span> {</a>
<a class="sourceLine" id="cb3-214" title="214">          vs[i][j], <span class="kw">vlength</span>(vs[i][j])/<span class="fl">10</span></a>
<a class="sourceLine" id="cb3-215" title="215">          <span class="kw">texture</span> { edgeTexture }</a>
<a class="sourceLine" id="cb3-216" title="216">        }</a>
<a class="sourceLine" id="cb3-217" title="217">      <span class="ot">#end</span></a>
<a class="sourceLine" id="cb3-218" title="218">    <span class="ot">#end</span>  </a>
<a class="sourceLine" id="cb3-219" title="219">  }</a>
<a class="sourceLine" id="cb3-220" title="220">  <span class="kw">translate</span> &lt;-<span class="fl">3</span>, <span class="fl">6</span>, <span class="fl">-15</span>&gt;</a>
<a class="sourceLine" id="cb3-221" title="221">  <span class="kw">scale</span> <span class="fl">0.8</span></a>
<a class="sourceLine" id="cb3-222" title="222">}</a>
<a class="sourceLine" id="cb3-223" title="223"></a>
<a class="sourceLine" id="cb3-224" title="224"><span class="co">/* ini file </span></a>
<a class="sourceLine" id="cb3-225" title="225"><span class="co">Width = 512</span></a>
<a class="sourceLine" id="cb3-226" title="226"><span class="co">Height = 512</span></a>
<a class="sourceLine" id="cb3-227" title="227"><span class="co">Antialias = On</span></a>
<a class="sourceLine" id="cb3-228" title="228"><span class="co">Antialias_Threshold = 0.3</span></a>
<a class="sourceLine" id="cb3-229" title="229"><span class="co">Input_File_Name = DuoprismStereographic.pov</span></a>
<a class="sourceLine" id="cb3-230" title="230"><span class="co">Initial_Clock = 0</span></a>
<a class="sourceLine" id="cb3-231" title="231"><span class="co">Final_Clock = 1</span></a>
<a class="sourceLine" id="cb3-232" title="232"><span class="co">Initial_Frame = 0</span></a>
<a class="sourceLine" id="cb3-233" title="233"><span class="co">Final_Frame = 179</span></a>
<a class="sourceLine" id="cb3-234" title="234"><span class="co">Subset_Start_Frame = 0</span></a>
<a class="sourceLine" id="cb3-235" title="235"><span class="co">Cyclic_Animation = on</span></a>
<a class="sourceLine" id="cb3-236" title="236"><span class="co">*/</span></a></code></pre></div>
<p><img src="./figures/DuoprismStereo_POVRAY.gif" /></p>
<p><br/></p>
<p>Here is another one. This is a hexagonal duoprism with a cell colored in red.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode povray"><code class="sourceCode povray"><a class="sourceLine" id="cb4-1" title="1"><span class="ot">#version</span> <span class="fl">3.7</span>;</a>
<a class="sourceLine" id="cb4-2" title="2"><span class="kw">global_settings</span> { <span class="kw">assumed_gamma</span> <span class="fl">1</span> } </a>
<a class="sourceLine" id="cb4-3" title="3"><span class="ot">#include</span> <span class="st">&quot;colors.inc&quot;</span></a>
<a class="sourceLine" id="cb4-4" title="4"><span class="ot">#include</span> <span class="st">&quot;textures.inc&quot;</span></a>
<a class="sourceLine" id="cb4-5" title="5"></a>
<a class="sourceLine" id="cb4-6" title="6"><span class="co">// camera ----------------------------------------------------------------------</span></a>
<a class="sourceLine" id="cb4-7" title="7"><span class="kw">camera</span> {</a>
<a class="sourceLine" id="cb4-8" title="8">  <span class="kw">location</span> &lt;<span class="fl">0</span>, <span class="fl">0</span>,-<span class="fl">10</span>&gt;</a>
<a class="sourceLine" id="cb4-9" title="9">  <span class="kw">look_at</span> <span class="fl">0</span></a>
<a class="sourceLine" id="cb4-10" title="10">  <span class="kw">angle</span> <span class="fl">45</span></a>
<a class="sourceLine" id="cb4-11" title="11">  <span class="kw">right</span> <span class="kw">x</span>*<span class="kw">image_width</span>/<span class="kw">image_height</span></a>
<a class="sourceLine" id="cb4-12" title="12">}</a>
<a class="sourceLine" id="cb4-13" title="13"></a>
<a class="sourceLine" id="cb4-14" title="14"><span class="co">// light sources ---------------------------------------------------------------</span></a>
<a class="sourceLine" id="cb4-15" title="15"><span class="kw">light_source</span> { &lt;<span class="fl">0</span>,<span class="fl">0</span>,-<span class="fl">100</span>&gt; White <span class="kw">shadowless</span> } </a>
<a class="sourceLine" id="cb4-16" title="16"><span class="kw">light_source</span> { &lt;<span class="fl">100</span>,<span class="fl">0</span>,-<span class="fl">100</span>&gt; White <span class="kw">shadowless</span> } </a>
<a class="sourceLine" id="cb4-17" title="17"></a>
<a class="sourceLine" id="cb4-18" title="18"><span class="co">// moon ------------------------------------------------------------------------</span></a>
<a class="sourceLine" id="cb4-19" title="19"><span class="kw">light_source</span> { </a>
<a class="sourceLine" id="cb4-20" title="20">  &lt;-<span class="fl">1000</span>, <span class="fl">800</span>, <span class="fl">3000</span>&gt; </a>
<a class="sourceLine" id="cb4-21" title="21">  <span class="kw">color</span> White</a>
<a class="sourceLine" id="cb4-22" title="22">  <span class="kw">shadowless</span></a>
<a class="sourceLine" id="cb4-23" title="23">  <span class="kw">looks_like</span> { </a>
<a class="sourceLine" id="cb4-24" title="24">    <span class="kw">sphere</span> { </a>
<a class="sourceLine" id="cb4-25" title="25">      &lt;<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span>&gt;, <span class="fl">300</span> </a>
<a class="sourceLine" id="cb4-26" title="26">      <span class="kw">texture</span> { </a>
<a class="sourceLine" id="cb4-27" title="27">        <span class="kw">pigment</span> { </a>
<a class="sourceLine" id="cb4-28" title="28">          <span class="kw">color</span> Yellow</a>
<a class="sourceLine" id="cb4-29" title="29">        }</a>
<a class="sourceLine" id="cb4-30" title="30">        <span class="kw">normal</span> { </a>
<a class="sourceLine" id="cb4-31" title="31">          <span class="kw">bumps</span> <span class="fl">0.5</span></a>
<a class="sourceLine" id="cb4-32" title="32">          <span class="kw">scale</span> <span class="fl">50</span></a>
<a class="sourceLine" id="cb4-33" title="33">        }</a>
<a class="sourceLine" id="cb4-34" title="34">        <span class="kw">finish</span> { </a>
<a class="sourceLine" id="cb4-35" title="35">          <span class="kw">emission</span> <span class="fl">0.8</span>   </a>
<a class="sourceLine" id="cb4-36" title="36">          <span class="kw">diffuse</span> <span class="fl">0.2</span></a>
<a class="sourceLine" id="cb4-37" title="37">          <span class="kw">phong</span> <span class="fl">1</span></a>
<a class="sourceLine" id="cb4-38" title="38">        }                                        </a>
<a class="sourceLine" id="cb4-39" title="39">      } </a>
<a class="sourceLine" id="cb4-40" title="40">    } </a>
<a class="sourceLine" id="cb4-41" title="41">  } </a>
<a class="sourceLine" id="cb4-42" title="42">} </a>
<a class="sourceLine" id="cb4-43" title="43"></a>
<a class="sourceLine" id="cb4-44" title="44"><span class="co">// sky -------------------------------------------------------------------------</span></a>
<a class="sourceLine" id="cb4-45" title="45"><span class="kw">plane</span> { </a>
<a class="sourceLine" id="cb4-46" title="46">  &lt;<span class="fl">0</span>,<span class="fl">1</span>,<span class="fl">0</span>&gt;, <span class="fl">1</span> <span class="kw">hollow</span>  </a>
<a class="sourceLine" id="cb4-47" title="47">  <span class="kw">texture</span> { </a>
<a class="sourceLine" id="cb4-48" title="48">    <span class="kw">pigment</span> { </a>
<a class="sourceLine" id="cb4-49" title="49">      <span class="kw">color</span> <span class="kw">rgb</span> &lt;<span class="fl">0.01</span>, <span class="fl">0.01</span>, <span class="fl">0.2</span>&gt; </a>
<a class="sourceLine" id="cb4-50" title="50">    }</a>
<a class="sourceLine" id="cb4-51" title="51">    <span class="kw">finish</span> { </a>
<a class="sourceLine" id="cb4-52" title="52">      <span class="kw">emission</span> <span class="fl">0.5</span> </a>
<a class="sourceLine" id="cb4-53" title="53">      <span class="kw">diffuse</span> <span class="fl">0.5</span> </a>
<a class="sourceLine" id="cb4-54" title="54">    } </a>
<a class="sourceLine" id="cb4-55" title="55">  }  </a>
<a class="sourceLine" id="cb4-56" title="56">  <span class="kw">scale</span> <span class="fl">10000</span></a>
<a class="sourceLine" id="cb4-57" title="57">}</a>
<a class="sourceLine" id="cb4-58" title="58"></a>
<a class="sourceLine" id="cb4-59" title="59"><span class="co">// the clouds ------------------------------------------------------------------</span></a>
<a class="sourceLine" id="cb4-60" title="60"><span class="kw">plane</span> { </a>
<a class="sourceLine" id="cb4-61" title="61">  &lt;<span class="fl">0</span>,<span class="fl">1</span>,<span class="fl">0</span>&gt;,<span class="fl">1</span> <span class="kw">hollow</span>  </a>
<a class="sourceLine" id="cb4-62" title="62">  <span class="kw">texture</span> { </a>
<a class="sourceLine" id="cb4-63" title="63">    <span class="kw">pigment</span> { </a>
<a class="sourceLine" id="cb4-64" title="64">      <span class="kw">bozo</span> <span class="kw">turbulence</span> <span class="fl">1.3</span></a>
<a class="sourceLine" id="cb4-65" title="65">      <span class="kw">color_map</span> { </a>
<a class="sourceLine" id="cb4-66" title="66">        [<span class="fl">0.00</span> <span class="kw">rgb</span> &lt;<span class="fl">0.24</span>, <span class="fl">0.32</span>, <span class="fl">1.0</span>&gt;*<span class="fl">0.6</span>]</a>
<a class="sourceLine" id="cb4-67" title="67">        [<span class="fl">0.75</span> <span class="kw">rgb</span> &lt;<span class="fl">0.24</span>, <span class="fl">0.32</span>, <span class="fl">1.0</span>&gt;*<span class="fl">0.6</span>]</a>
<a class="sourceLine" id="cb4-68" title="68">        [<span class="fl">0.83</span> <span class="kw">rgb</span> &lt;<span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span>&gt;              ]</a>
<a class="sourceLine" id="cb4-69" title="69">        [<span class="fl">0.95</span> <span class="kw">rgb</span> &lt;<span class="fl">0.25</span>,<span class="fl">0.25</span>,<span class="fl">0.25</span>&gt;     ]</a>
<a class="sourceLine" id="cb4-70" title="70">        [<span class="fl">1.00</span> <span class="kw">rgb</span> &lt;<span class="fl">0.5</span>,<span class="fl">0.5</span>,<span class="fl">0.5</span>&gt;        ]</a>
<a class="sourceLine" id="cb4-71" title="71">      }</a>
<a class="sourceLine" id="cb4-72" title="72">      <span class="kw">scale</span> <span class="fl">2.5</span></a>
<a class="sourceLine" id="cb4-73" title="73">      <span class="kw">translate</span> &lt;<span class="fl">0</span>,<span class="fl">1</span>,<span class="fl">0</span>&gt;</a>
<a class="sourceLine" id="cb4-74" title="74">    }</a>
<a class="sourceLine" id="cb4-75" title="75">    <span class="kw">finish</span> { </a>
<a class="sourceLine" id="cb4-76" title="76">      <span class="kw">emission</span> <span class="fl">0.25</span> </a>
<a class="sourceLine" id="cb4-77" title="77">      <span class="kw">diffuse</span> <span class="fl">0</span></a>
<a class="sourceLine" id="cb4-78" title="78">    } </a>
<a class="sourceLine" id="cb4-79" title="79">  }      </a>
<a class="sourceLine" id="cb4-80" title="80">  <span class="kw">scale</span> <span class="fl">5000</span></a>
<a class="sourceLine" id="cb4-81" title="81">}</a>
<a class="sourceLine" id="cb4-82" title="82"></a>
<a class="sourceLine" id="cb4-83" title="83"><span class="co">// fog on the ground -----------------------------------------------------------</span></a>
<a class="sourceLine" id="cb4-84" title="84"><span class="kw">fog</span> { </a>
<a class="sourceLine" id="cb4-85" title="85">  <span class="kw">fog_type</span>   <span class="fl">2</span></a>
<a class="sourceLine" id="cb4-86" title="86">  <span class="kw">distance</span>   <span class="fl">50</span></a>
<a class="sourceLine" id="cb4-87" title="87">  <span class="kw">color</span>      Gray50  </a>
<a class="sourceLine" id="cb4-88" title="88">  <span class="kw">fog_offset</span> <span class="fl">0.1</span></a>
<a class="sourceLine" id="cb4-89" title="89">  <span class="kw">fog_alt</span>    <span class="fl">1.5</span></a>
<a class="sourceLine" id="cb4-90" title="90">  <span class="kw">turbulence</span> <span class="fl">1.8</span></a>
<a class="sourceLine" id="cb4-91" title="91">}</a>
<a class="sourceLine" id="cb4-92" title="92"></a>
<a class="sourceLine" id="cb4-93" title="93"><span class="co">// sea -------------------------------------------------------------------------</span></a>
<a class="sourceLine" id="cb4-94" title="94"><span class="kw">plane</span> { </a>
<a class="sourceLine" id="cb4-95" title="95">  &lt;<span class="fl">0</span>,<span class="fl">1</span>,<span class="fl">0</span>&gt;, <span class="fl">-1</span> <span class="kw">hollow</span></a>
<a class="sourceLine" id="cb4-96" title="96">  <span class="kw">texture</span>{</a>
<a class="sourceLine" id="cb4-97" title="97">    <span class="kw">pigment</span>{</a>
<a class="sourceLine" id="cb4-98" title="98">      <span class="kw">rgb</span> &lt;.<span class="fl">098</span>,.<span class="fl">098</span>,.<span class="fl">439</span>&gt;</a>
<a class="sourceLine" id="cb4-99" title="99">    }</a>
<a class="sourceLine" id="cb4-100" title="100">    <span class="kw">finish</span> {</a>
<a class="sourceLine" id="cb4-101" title="101">      <span class="kw">ambient</span> <span class="fl">0.15</span></a>
<a class="sourceLine" id="cb4-102" title="102">      <span class="kw">diffuse</span> <span class="fl">0.55</span></a>
<a class="sourceLine" id="cb4-103" title="103">      <span class="kw">brilliance</span> <span class="fl">6.0</span></a>
<a class="sourceLine" id="cb4-104" title="104">      <span class="kw">phong</span> <span class="fl">0.8</span></a>
<a class="sourceLine" id="cb4-105" title="105">      <span class="kw">phong_size</span> <span class="fl">120</span></a>
<a class="sourceLine" id="cb4-106" title="106">      <span class="kw">reflection</span> <span class="fl">0.2</span></a>
<a class="sourceLine" id="cb4-107" title="107">    }</a>
<a class="sourceLine" id="cb4-108" title="108">    <span class="kw">normal</span> { </a>
<a class="sourceLine" id="cb4-109" title="109">      <span class="kw">bumps</span> <span class="fl">0.95</span></a>
<a class="sourceLine" id="cb4-110" title="110">      <span class="kw">turbulence</span> <span class="fl">.05</span> </a>
<a class="sourceLine" id="cb4-111" title="111">      <span class="kw">scale</span> &lt;<span class="fl">1</span>,<span class="fl">0.25</span>,<span class="fl">1</span>&gt; </a>
<a class="sourceLine" id="cb4-112" title="112">    }</a>
<a class="sourceLine" id="cb4-113" title="113">  }</a>
<a class="sourceLine" id="cb4-114" title="114">}</a>
<a class="sourceLine" id="cb4-115" title="115"></a>
<a class="sourceLine" id="cb4-116" title="116"><span class="co">// vertices --------------------------------------------------------------------</span></a>
<a class="sourceLine" id="cb4-117" title="117"><span class="kw">#declare a </span>= <span class="kw">sqrt</span>(<span class="fl">3</span>) / <span class="fl">2</span>;</a>
<a class="sourceLine" id="cb4-118" title="118"><span class="kw">#declare vertices </span>= <span class="kw">array</span>[<span class="fl">36</span>]</a>
<a class="sourceLine" id="cb4-119" title="119">  {</a>
<a class="sourceLine" id="cb4-120" title="120">    &lt;a, <span class="fl">0.5</span>, a, <span class="fl">0.5</span>&gt;,</a>
<a class="sourceLine" id="cb4-121" title="121">    &lt;a, <span class="fl">0.5</span>, <span class="fl">0.0</span>, <span class="fl">1.0</span>&gt;,</a>
<a class="sourceLine" id="cb4-122" title="122">    &lt;a, <span class="fl">0.5</span>, -a, <span class="fl">0.5</span>&gt;,</a>
<a class="sourceLine" id="cb4-123" title="123">    &lt;a, <span class="fl">0.5</span>, -a, <span class="fl">-0.5</span>&gt;,</a>
<a class="sourceLine" id="cb4-124" title="124">    &lt;a, <span class="fl">0.5</span>, <span class="fl">0.0</span>, <span class="fl">-1.0</span>&gt;,</a>
<a class="sourceLine" id="cb4-125" title="125">    &lt;a, <span class="fl">0.5</span>, a, <span class="fl">-0.5</span>&gt;,</a>
<a class="sourceLine" id="cb4-126" title="126">    &lt;<span class="fl">0.0</span>, <span class="fl">1.0</span>, a, <span class="fl">0.5</span>&gt;,</a>
<a class="sourceLine" id="cb4-127" title="127">    &lt;<span class="fl">0.0</span>, <span class="fl">1.0</span>, <span class="fl">0.0</span>, <span class="fl">1.0</span>&gt;,</a>
<a class="sourceLine" id="cb4-128" title="128">    &lt;<span class="fl">0.0</span>, <span class="fl">1.0</span>, -a, <span class="fl">0.5</span>&gt;,</a>
<a class="sourceLine" id="cb4-129" title="129">    &lt;<span class="fl">0.0</span>, <span class="fl">1.0</span>, -a, <span class="fl">-0.5</span>&gt;,</a>
<a class="sourceLine" id="cb4-130" title="130">    &lt;<span class="fl">0.0</span>, <span class="fl">1.0</span>, <span class="fl">0.0</span>, <span class="fl">-1.0</span>&gt;,</a>
<a class="sourceLine" id="cb4-131" title="131">    &lt;<span class="fl">0.0</span>, <span class="fl">1.0</span>, a, <span class="fl">-0.5</span>&gt;,</a>
<a class="sourceLine" id="cb4-132" title="132">    &lt;-a, <span class="fl">0.5</span>, a, <span class="fl">0.5</span>&gt;,</a>
<a class="sourceLine" id="cb4-133" title="133">    &lt;-a, <span class="fl">0.5</span>, <span class="fl">0.0</span>, <span class="fl">1.0</span>&gt;,</a>
<a class="sourceLine" id="cb4-134" title="134">    &lt;-a, <span class="fl">0.5</span>, -a, <span class="fl">0.5</span>&gt;,</a>
<a class="sourceLine" id="cb4-135" title="135">    &lt;-a, <span class="fl">0.5</span>, -a, <span class="fl">-0.5</span>&gt;,</a>
<a class="sourceLine" id="cb4-136" title="136">    &lt;-a, <span class="fl">0.5</span>, <span class="fl">0.0</span>, <span class="fl">-1.0</span>&gt;,</a>
<a class="sourceLine" id="cb4-137" title="137">    &lt;-a, <span class="fl">0.5</span>, a, <span class="fl">-0.5</span>&gt;,</a>
<a class="sourceLine" id="cb4-138" title="138">    &lt;-a, <span class="fl">-0.5</span>, a, <span class="fl">0.5</span>&gt;,</a>
<a class="sourceLine" id="cb4-139" title="139">    &lt;-a, <span class="fl">-0.5</span>, <span class="fl">0.0</span>, <span class="fl">1.0</span>&gt;,</a>
<a class="sourceLine" id="cb4-140" title="140">    &lt;-a, <span class="fl">-0.5</span>, -a, <span class="fl">0.5</span>&gt;,</a>
<a class="sourceLine" id="cb4-141" title="141">    &lt;-a, <span class="fl">-0.5</span>, -a, <span class="fl">-0.5</span>&gt;,</a>
<a class="sourceLine" id="cb4-142" title="142">    &lt;-a, <span class="fl">-0.5</span>, <span class="fl">0.0</span>, <span class="fl">-1.0</span>&gt;,</a>
<a class="sourceLine" id="cb4-143" title="143">    &lt;-a, <span class="fl">-0.5</span>, a, <span class="fl">-0.5</span>&gt;,</a>
<a class="sourceLine" id="cb4-144" title="144">    &lt;<span class="fl">0.0</span>, <span class="fl">-1.0</span>, a, <span class="fl">0.5</span>&gt;,</a>
<a class="sourceLine" id="cb4-145" title="145">    &lt;<span class="fl">0.0</span>, <span class="fl">-1.0</span>, <span class="fl">0.0</span>, <span class="fl">1.0</span>&gt;,</a>
<a class="sourceLine" id="cb4-146" title="146">    &lt;<span class="fl">0.0</span>, <span class="fl">-1.0</span>, -a, <span class="fl">0.5</span>&gt;,</a>
<a class="sourceLine" id="cb4-147" title="147">    &lt;<span class="fl">0.0</span>, <span class="fl">-1.0</span>, -a, <span class="fl">-0.5</span>&gt;,</a>
<a class="sourceLine" id="cb4-148" title="148">    &lt;<span class="fl">0.0</span>, <span class="fl">-1.0</span>, <span class="fl">0.0</span>, <span class="fl">-1.0</span>&gt;,</a>
<a class="sourceLine" id="cb4-149" title="149">    &lt;<span class="fl">0.0</span>, <span class="fl">-1.0</span>, a, <span class="fl">-0.5</span>&gt;,</a>
<a class="sourceLine" id="cb4-150" title="150">    &lt;a, <span class="fl">-0.5</span>, a, <span class="fl">0.5</span>&gt;,</a>
<a class="sourceLine" id="cb4-151" title="151">    &lt;a, <span class="fl">-0.5</span>, <span class="fl">0.0</span>, <span class="fl">1.0</span>&gt;,</a>
<a class="sourceLine" id="cb4-152" title="152">    &lt;a, <span class="fl">-0.5</span>, -a, <span class="fl">0.5</span>&gt;,</a>
<a class="sourceLine" id="cb4-153" title="153">    &lt;a, <span class="fl">-0.5</span>, -a, <span class="fl">-0.5</span>&gt;,</a>
<a class="sourceLine" id="cb4-154" title="154">    &lt;a, <span class="fl">-0.5</span>, <span class="fl">0.0</span>, <span class="fl">-1.0</span>&gt;,</a>
<a class="sourceLine" id="cb4-155" title="155">    &lt;a, <span class="fl">-0.5</span>, a, <span class="fl">-0.5</span>&gt;</a>
<a class="sourceLine" id="cb4-156" title="156">  };</a>
<a class="sourceLine" id="cb4-157" title="157"><span class="kw">#declare facetVertices </span>= <span class="kw">array</span>[<span class="fl">12</span>] {<span class="fl">0</span>,<span class="fl">5</span>,<span class="fl">6</span>,<span class="fl">30</span>,<span class="fl">11</span>,<span class="fl">35</span>,<span class="fl">12</span>,<span class="fl">17</span>,<span class="fl">18</span>,<span class="fl">23</span>,<span class="fl">24</span>,<span class="fl">29</span>};</a>
<a class="sourceLine" id="cb4-158" title="158"><span class="kw">#declare otherVertices </span>= <span class="kw">array</span>[<span class="fl">24</span>] </a>
<a class="sourceLine" id="cb4-159" title="159">  {<span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">3</span>,<span class="fl">4</span>,<span class="fl">7</span>,<span class="fl">8</span>,</a>
<a class="sourceLine" id="cb4-160" title="160">  <span class="fl">9</span>,<span class="fl">10</span>,<span class="fl">13</span>,<span class="fl">14</span>,<span class="fl">15</span>,<span class="fl">16</span>,</a>
<a class="sourceLine" id="cb4-161" title="161">  <span class="fl">19</span>,<span class="fl">20</span>,<span class="fl">21</span>,<span class="fl">22</span>,<span class="fl">25</span>,<span class="fl">26</span>,</a>
<a class="sourceLine" id="cb4-162" title="162">  <span class="fl">27</span>,<span class="fl">28</span>,<span class="fl">31</span>,<span class="fl">32</span>,<span class="fl">33</span>,<span class="fl">34</span>};</a>
<a class="sourceLine" id="cb4-163" title="163"></a>
<a class="sourceLine" id="cb4-164" title="164"><span class="co">// edges -------------------------------------------------------------------</span></a>
<a class="sourceLine" id="cb4-165" title="165"><span class="kw">#declare facetEdges </span>= <span class="kw">array</span>[<span class="fl">18</span>][<span class="fl">2</span>]</a>
<a class="sourceLine" id="cb4-166" title="166">  {</a>
<a class="sourceLine" id="cb4-167" title="167">    {<span class="fl">0</span>, <span class="fl">5</span>},</a>
<a class="sourceLine" id="cb4-168" title="168">    {<span class="fl">0</span>, <span class="fl">6</span>},</a>
<a class="sourceLine" id="cb4-169" title="169">    {<span class="fl">0</span>, <span class="fl">30</span>},</a>
<a class="sourceLine" id="cb4-170" title="170">    {<span class="fl">5</span>, <span class="fl">11</span>},</a>
<a class="sourceLine" id="cb4-171" title="171">    {<span class="fl">5</span>, <span class="fl">35</span>},</a>
<a class="sourceLine" id="cb4-172" title="172">    {<span class="fl">6</span>, <span class="fl">11</span>},</a>
<a class="sourceLine" id="cb4-173" title="173">    {<span class="fl">6</span>, <span class="fl">12</span>},</a>
<a class="sourceLine" id="cb4-174" title="174">    {<span class="fl">11</span>, <span class="fl">17</span>},</a>
<a class="sourceLine" id="cb4-175" title="175">    {<span class="fl">12</span>, <span class="fl">17</span>},</a>
<a class="sourceLine" id="cb4-176" title="176">    {<span class="fl">12</span>, <span class="fl">18</span>},</a>
<a class="sourceLine" id="cb4-177" title="177">    {<span class="fl">17</span>, <span class="fl">23</span>},</a>
<a class="sourceLine" id="cb4-178" title="178">    {<span class="fl">18</span>, <span class="fl">23</span>},</a>
<a class="sourceLine" id="cb4-179" title="179">    {<span class="fl">18</span>, <span class="fl">24</span>},</a>
<a class="sourceLine" id="cb4-180" title="180">    {<span class="fl">23</span>, <span class="fl">29</span>},</a>
<a class="sourceLine" id="cb4-181" title="181">    {<span class="fl">24</span>, <span class="fl">29</span>},</a>
<a class="sourceLine" id="cb4-182" title="182">    {<span class="fl">24</span>, <span class="fl">30</span>},</a>
<a class="sourceLine" id="cb4-183" title="183">    {<span class="fl">29</span>, <span class="fl">35</span>},</a>
<a class="sourceLine" id="cb4-184" title="184">    {<span class="fl">30</span>, <span class="fl">35</span>}</a>
<a class="sourceLine" id="cb4-185" title="185">  };</a>
<a class="sourceLine" id="cb4-186" title="186"><span class="kw">#declare otherEdges </span>= <span class="kw">array</span>[<span class="fl">54</span>][<span class="fl">2</span>]</a>
<a class="sourceLine" id="cb4-187" title="187">  {</a>
<a class="sourceLine" id="cb4-188" title="188">    {<span class="fl">0</span>, <span class="fl">1</span>},</a>
<a class="sourceLine" id="cb4-189" title="189">    {<span class="fl">1</span>, <span class="fl">2</span>},</a>
<a class="sourceLine" id="cb4-190" title="190">    {<span class="fl">1</span>, <span class="fl">7</span>},</a>
<a class="sourceLine" id="cb4-191" title="191">    {<span class="fl">1</span>, <span class="fl">31</span>},</a>
<a class="sourceLine" id="cb4-192" title="192">    {<span class="fl">2</span>, <span class="fl">3</span>},</a>
<a class="sourceLine" id="cb4-193" title="193">    {<span class="fl">2</span>, <span class="fl">8</span>},</a>
<a class="sourceLine" id="cb4-194" title="194">    {<span class="fl">2</span>, <span class="fl">32</span>},</a>
<a class="sourceLine" id="cb4-195" title="195">    {<span class="fl">3</span>, <span class="fl">4</span>},</a>
<a class="sourceLine" id="cb4-196" title="196">    {<span class="fl">3</span>, <span class="fl">9</span>},</a>
<a class="sourceLine" id="cb4-197" title="197">    {<span class="fl">3</span>, <span class="fl">33</span>},</a>
<a class="sourceLine" id="cb4-198" title="198">    {<span class="fl">4</span>, <span class="fl">5</span>},</a>
<a class="sourceLine" id="cb4-199" title="199">    {<span class="fl">4</span>, <span class="fl">10</span>},</a>
<a class="sourceLine" id="cb4-200" title="200">    {<span class="fl">4</span>, <span class="fl">34</span>},</a>
<a class="sourceLine" id="cb4-201" title="201">    {<span class="fl">6</span>, <span class="fl">7</span>},</a>
<a class="sourceLine" id="cb4-202" title="202">    {<span class="fl">7</span>, <span class="fl">8</span>},</a>
<a class="sourceLine" id="cb4-203" title="203">    {<span class="fl">7</span>, <span class="fl">13</span>},</a>
<a class="sourceLine" id="cb4-204" title="204">    {<span class="fl">8</span>, <span class="fl">9</span>},</a>
<a class="sourceLine" id="cb4-205" title="205">    {<span class="fl">8</span>, <span class="fl">14</span>},</a>
<a class="sourceLine" id="cb4-206" title="206">    {<span class="fl">9</span>, <span class="fl">10</span>},</a>
<a class="sourceLine" id="cb4-207" title="207">    {<span class="fl">9</span>, <span class="fl">15</span>},</a>
<a class="sourceLine" id="cb4-208" title="208">    {<span class="fl">10</span>, <span class="fl">11</span>},</a>
<a class="sourceLine" id="cb4-209" title="209">    {<span class="fl">10</span>, <span class="fl">16</span>},</a>
<a class="sourceLine" id="cb4-210" title="210">    {<span class="fl">12</span>, <span class="fl">13</span>},</a>
<a class="sourceLine" id="cb4-211" title="211">    {<span class="fl">13</span>, <span class="fl">14</span>},</a>
<a class="sourceLine" id="cb4-212" title="212">    {<span class="fl">13</span>, <span class="fl">19</span>},</a>
<a class="sourceLine" id="cb4-213" title="213">    {<span class="fl">14</span>, <span class="fl">15</span>},</a>
<a class="sourceLine" id="cb4-214" title="214">    {<span class="fl">14</span>, <span class="fl">20</span>},</a>
<a class="sourceLine" id="cb4-215" title="215">    {<span class="fl">15</span>, <span class="fl">16</span>},</a>
<a class="sourceLine" id="cb4-216" title="216">    {<span class="fl">15</span>, <span class="fl">21</span>},</a>
<a class="sourceLine" id="cb4-217" title="217">    {<span class="fl">16</span>, <span class="fl">17</span>},</a>
<a class="sourceLine" id="cb4-218" title="218">    {<span class="fl">16</span>, <span class="fl">22</span>},</a>
<a class="sourceLine" id="cb4-219" title="219">    {<span class="fl">18</span>, <span class="fl">19</span>},</a>
<a class="sourceLine" id="cb4-220" title="220">    {<span class="fl">19</span>, <span class="fl">20</span>},</a>
<a class="sourceLine" id="cb4-221" title="221">    {<span class="fl">19</span>, <span class="fl">25</span>},</a>
<a class="sourceLine" id="cb4-222" title="222">    {<span class="fl">20</span>, <span class="fl">21</span>},</a>
<a class="sourceLine" id="cb4-223" title="223">    {<span class="fl">20</span>, <span class="fl">26</span>},</a>
<a class="sourceLine" id="cb4-224" title="224">    {<span class="fl">21</span>, <span class="fl">22</span>},</a>
<a class="sourceLine" id="cb4-225" title="225">    {<span class="fl">21</span>, <span class="fl">27</span>},</a>
<a class="sourceLine" id="cb4-226" title="226">    {<span class="fl">22</span>, <span class="fl">23</span>},</a>
<a class="sourceLine" id="cb4-227" title="227">    {<span class="fl">22</span>, <span class="fl">28</span>},</a>
<a class="sourceLine" id="cb4-228" title="228">    {<span class="fl">24</span>, <span class="fl">25</span>},</a>
<a class="sourceLine" id="cb4-229" title="229">    {<span class="fl">25</span>, <span class="fl">26</span>},</a>
<a class="sourceLine" id="cb4-230" title="230">    {<span class="fl">25</span>, <span class="fl">31</span>},</a>
<a class="sourceLine" id="cb4-231" title="231">    {<span class="fl">26</span>, <span class="fl">27</span>},</a>
<a class="sourceLine" id="cb4-232" title="232">    {<span class="fl">26</span>, <span class="fl">32</span>},</a>
<a class="sourceLine" id="cb4-233" title="233">    {<span class="fl">27</span>, <span class="fl">28</span>},</a>
<a class="sourceLine" id="cb4-234" title="234">    {<span class="fl">27</span>, <span class="fl">33</span>},</a>
<a class="sourceLine" id="cb4-235" title="235">    {<span class="fl">28</span>, <span class="fl">29</span>},</a>
<a class="sourceLine" id="cb4-236" title="236">    {<span class="fl">28</span>, <span class="fl">34</span>},</a>
<a class="sourceLine" id="cb4-237" title="237">    {<span class="fl">30</span>, <span class="fl">31</span>},</a>
<a class="sourceLine" id="cb4-238" title="238">    {<span class="fl">31</span>, <span class="fl">32</span>},</a>
<a class="sourceLine" id="cb4-239" title="239">    {<span class="fl">32</span>, <span class="fl">33</span>},</a>
<a class="sourceLine" id="cb4-240" title="240">    {<span class="fl">33</span>, <span class="fl">34</span>},</a>
<a class="sourceLine" id="cb4-241" title="241">    {<span class="fl">34</span>, <span class="fl">35</span>}</a>
<a class="sourceLine" id="cb4-242" title="242">  };</a>
<a class="sourceLine" id="cb4-243" title="243"></a>
<a class="sourceLine" id="cb4-244" title="244"><span class="co">// macros ----------------------------------------------------------------------</span></a>
<a class="sourceLine" id="cb4-245" title="245"><span class="kw">#macro vlength4</span>(P)</a>
<a class="sourceLine" id="cb4-246" title="246">  <span class="kw">sqrt</span>(P.<span class="kw">x</span>*P.<span class="kw">x</span> + P.<span class="kw">y</span>*P.<span class="kw">y</span> + P.<span class="kw">z</span>*P.<span class="kw">z</span> + P.<span class="kw">t</span>*P.<span class="kw">t</span>)</a>
<a class="sourceLine" id="cb4-247" title="247"><span class="ot">#end</span></a>
<a class="sourceLine" id="cb4-248" title="248"></a>
<a class="sourceLine" id="cb4-249" title="249"><span class="kw">#macro sphericalSegment</span>(P, Q, n)</a>
<a class="sourceLine" id="cb4-250" title="250">  <span class="kw">#local out </span>= <span class="kw">array</span>[n+<span class="fl">1</span>];</a>
<a class="sourceLine" id="cb4-251" title="251">  #for(i, <span class="fl">0</span>, n)</a>
<a class="sourceLine" id="cb4-252" title="252">    <span class="kw">#local pt </span>= P + (i/n)*(Q-P);</a>
<a class="sourceLine" id="cb4-253" title="253">    <span class="kw">#local out</span>[i] = <span class="kw">sqrt</span>(<span class="fl">2</span>)/vlength4(pt) * pt;</a>
<a class="sourceLine" id="cb4-254" title="254">  <span class="ot">#end</span></a>
<a class="sourceLine" id="cb4-255" title="255">  out</a>
<a class="sourceLine" id="cb4-256" title="256"><span class="ot">#end</span></a>
<a class="sourceLine" id="cb4-257" title="257"></a>
<a class="sourceLine" id="cb4-258" title="258"><span class="kw">#macro rotate4d</span>(theta,phi,xi,vec)</a>
<a class="sourceLine" id="cb4-259" title="259">  <span class="kw">#local a </span>= <span class="kw">cos</span>(xi);</a>
<a class="sourceLine" id="cb4-260" title="260">  <span class="kw">#local b </span>= <span class="kw">sin</span>(theta)*<span class="kw">cos</span>(phi)*<span class="kw">sin</span>(xi);</a>
<a class="sourceLine" id="cb4-261" title="261">  <span class="kw">#local c </span>= <span class="kw">sin</span>(theta)*<span class="kw">sin</span>(phi)*<span class="kw">sin</span>(xi);</a>
<a class="sourceLine" id="cb4-262" title="262">  <span class="kw">#local d </span>= <span class="kw">cos</span>(theta)*<span class="kw">sin</span>(xi);</a>
<a class="sourceLine" id="cb4-263" title="263">  <span class="kw">#local p </span>= vec.<span class="kw">x</span>;</a>
<a class="sourceLine" id="cb4-264" title="264">  <span class="kw">#local q </span>= vec.<span class="kw">y</span>;</a>
<a class="sourceLine" id="cb4-265" title="265">  <span class="kw">#local r </span>= vec.<span class="kw">z</span>;</a>
<a class="sourceLine" id="cb4-266" title="266">  <span class="kw">#local s </span>= vec.<span class="kw">t</span>;</a>
<a class="sourceLine" id="cb4-267" title="267">  &lt; a*p - b*q - c*r - d*s</a>
<a class="sourceLine" id="cb4-268" title="268">  , a*q + b*p + c*s - d*r</a>
<a class="sourceLine" id="cb4-269" title="269">  , a*r - b*s + c*p + d*q</a>
<a class="sourceLine" id="cb4-270" title="270">  , a*s + b*r - c*q + d*p &gt;</a>
<a class="sourceLine" id="cb4-271" title="271"><span class="ot">#end</span></a>
<a class="sourceLine" id="cb4-272" title="272"></a>
<a class="sourceLine" id="cb4-273" title="273"><span class="kw">#macro StereographicProjection</span>(q) </a>
<a class="sourceLine" id="cb4-274" title="274">  <span class="kw">acos</span>(q.<span class="kw">t</span>/<span class="kw">sqrt</span>(<span class="fl">2</span>))/<span class="kw">sqrt</span>(<span class="fl">2</span>-q.<span class="kw">t</span>*q.<span class="kw">t</span>) * &lt;q.<span class="kw">x</span>,q.<span class="kw">y</span>,q.<span class="kw">z</span>&gt;</a>
<a class="sourceLine" id="cb4-275" title="275"><span class="ot">#end</span></a>
<a class="sourceLine" id="cb4-276" title="276"></a>
<a class="sourceLine" id="cb4-277" title="277"><span class="kw">#macro ProjectedFacetVertices</span>(theta, phi, xi)</a>
<a class="sourceLine" id="cb4-278" title="278">  <span class="kw">#local out </span>= <span class="kw">array</span>[<span class="fl">12</span>];</a>
<a class="sourceLine" id="cb4-279" title="279">  #for(i, <span class="fl">0</span>, <span class="fl">11</span>)</a>
<a class="sourceLine" id="cb4-280" title="280">    <span class="kw">#local out</span>[i] = </a>
<a class="sourceLine" id="cb4-281" title="281">      StereographicProjection(</a>
<a class="sourceLine" id="cb4-282" title="282">        rotate4d(theta, phi, xi, vertices[facetVertices[i]])</a>
<a class="sourceLine" id="cb4-283" title="283">      );</a>
<a class="sourceLine" id="cb4-284" title="284">  <span class="ot">#end</span></a>
<a class="sourceLine" id="cb4-285" title="285">  out</a>
<a class="sourceLine" id="cb4-286" title="286"><span class="ot">#end</span></a>
<a class="sourceLine" id="cb4-287" title="287"></a>
<a class="sourceLine" id="cb4-288" title="288"><span class="kw">#macro ProjectedOtherVertices</span>(theta, phi, xi)</a>
<a class="sourceLine" id="cb4-289" title="289">  <span class="kw">#local out </span>= <span class="kw">array</span>[<span class="fl">24</span>];</a>
<a class="sourceLine" id="cb4-290" title="290">  #for(i, <span class="fl">0</span>, <span class="fl">23</span>)</a>
<a class="sourceLine" id="cb4-291" title="291">    <span class="kw">#local out</span>[i] = </a>
<a class="sourceLine" id="cb4-292" title="292">      StereographicProjection(</a>
<a class="sourceLine" id="cb4-293" title="293">        rotate4d(theta, phi, xi, vertices[otherVertices[i]])</a>
<a class="sourceLine" id="cb4-294" title="294">      );</a>
<a class="sourceLine" id="cb4-295" title="295">  <span class="ot">#end</span></a>
<a class="sourceLine" id="cb4-296" title="296">  out</a>
<a class="sourceLine" id="cb4-297" title="297"><span class="ot">#end</span></a>
<a class="sourceLine" id="cb4-298" title="298"></a>
<a class="sourceLine" id="cb4-299" title="299"><span class="co">// texture ---------------------------------------------------------------------</span></a>
<a class="sourceLine" id="cb4-300" title="300"><span class="kw">#declare edgeTexture1 </span>= </a>
<a class="sourceLine" id="cb4-301" title="301">  <span class="kw">texture</span> {</a>
<a class="sourceLine" id="cb4-302" title="302">    New_Penny</a>
<a class="sourceLine" id="cb4-303" title="303">    <span class="kw">finish</span> {</a>
<a class="sourceLine" id="cb4-304" title="304">      <span class="kw">ambient</span> <span class="fl">0.01</span></a>
<a class="sourceLine" id="cb4-305" title="305">      <span class="kw">diffuse</span> <span class="fl">2</span></a>
<a class="sourceLine" id="cb4-306" title="306">      <span class="kw">reflection</span> <span class="fl">0</span></a>
<a class="sourceLine" id="cb4-307" title="307">      <span class="kw">brilliance</span> <span class="fl">8</span></a>
<a class="sourceLine" id="cb4-308" title="308">      <span class="kw">specular</span> <span class="fl">0.1</span></a>
<a class="sourceLine" id="cb4-309" title="309">      <span class="kw">roughness</span> <span class="fl">0.1</span></a>
<a class="sourceLine" id="cb4-310" title="310">    }</a>
<a class="sourceLine" id="cb4-311" title="311">  };</a>
<a class="sourceLine" id="cb4-312" title="312"></a>
<a class="sourceLine" id="cb4-313" title="313"><span class="kw">#declare edgeTexture2 </span>= </a>
<a class="sourceLine" id="cb4-314" title="314">  <span class="kw">texture</span> {</a>
<a class="sourceLine" id="cb4-315" title="315">    <span class="kw">pigment</span> { Red }</a>
<a class="sourceLine" id="cb4-316" title="316">    <span class="kw">finish</span> {</a>
<a class="sourceLine" id="cb4-317" title="317">      <span class="kw">ambient</span> <span class="fl">0.01</span></a>
<a class="sourceLine" id="cb4-318" title="318">      <span class="kw">diffuse</span> <span class="fl">2</span></a>
<a class="sourceLine" id="cb4-319" title="319">      <span class="kw">reflection</span> <span class="fl">0</span></a>
<a class="sourceLine" id="cb4-320" title="320">      <span class="kw">brilliance</span> <span class="fl">8</span></a>
<a class="sourceLine" id="cb4-321" title="321">      <span class="kw">specular</span> <span class="fl">0.1</span></a>
<a class="sourceLine" id="cb4-322" title="322">      <span class="kw">roughness</span> <span class="fl">0.1</span></a>
<a class="sourceLine" id="cb4-323" title="323">    }</a>
<a class="sourceLine" id="cb4-324" title="324">  };</a>
<a class="sourceLine" id="cb4-325" title="325"></a>
<a class="sourceLine" id="cb4-326" title="326"><span class="co">// draw an edge ----------------------------------------------------------------</span></a>
<a class="sourceLine" id="cb4-327" title="327"><span class="kw">#macro Edge</span>(verts, v1, v2, theta, phi, xi, Tex)</a>
<a class="sourceLine" id="cb4-328" title="328">  <span class="kw">#local P </span>= verts[v1];</a>
<a class="sourceLine" id="cb4-329" title="329">  <span class="kw">#local Q </span>= verts[v2];</a>
<a class="sourceLine" id="cb4-330" title="330">  <span class="kw">#local PQ </span>= sphericalSegment(P, Q, <span class="fl">100</span>);</a>
<a class="sourceLine" id="cb4-331" title="331">  <span class="kw">sphere_sweep</span> {</a>
<a class="sourceLine" id="cb4-332" title="332">    <span class="kw">b_spline</span> <span class="fl">101</span></a>
<a class="sourceLine" id="cb4-333" title="333">    #for(k,<span class="fl">0</span>,<span class="fl">100</span>)</a>
<a class="sourceLine" id="cb4-334" title="334">      <span class="kw">#local O </span>= StereographicProjection(rotate4d(theta,phi,xi,PQ[k]));</a>
<a class="sourceLine" id="cb4-335" title="335">      O <span class="kw">vlength</span>(O)/<span class="fl">20</span></a>
<a class="sourceLine" id="cb4-336" title="336">    <span class="ot">#end</span></a>
<a class="sourceLine" id="cb4-337" title="337">    <span class="kw">texture</span> { </a>
<a class="sourceLine" id="cb4-338" title="338">        Tex</a>
<a class="sourceLine" id="cb4-339" title="339">    }</a>
<a class="sourceLine" id="cb4-340" title="340">  }</a>
<a class="sourceLine" id="cb4-341" title="341"><span class="ot">#end</span></a>
<a class="sourceLine" id="cb4-342" title="342"></a>
<a class="sourceLine" id="cb4-343" title="343"><span class="co">// draw ------------------------------------------------------------------------</span></a>
<a class="sourceLine" id="cb4-344" title="344"><span class="kw">#declare theta </span>= <span class="fl">pi</span>/<span class="fl">2</span>;</a>
<a class="sourceLine" id="cb4-345" title="345"><span class="kw">#declare phi </span>= <span class="fl">0</span>;</a>
<a class="sourceLine" id="cb4-346" title="346"><span class="kw">#declare xi </span>= <span class="fl">2</span>*<span class="kw">frame_number</span>*<span class="fl">pi</span>/<span class="fl">180</span>;</a>
<a class="sourceLine" id="cb4-347" title="347"><span class="kw">#declare vsFacet </span>= ProjectedFacetVertices(theta, phi, xi);</a>
<a class="sourceLine" id="cb4-348" title="348"><span class="kw">#declare vsOther </span>= ProjectedOtherVertices(theta, phi, xi);</a>
<a class="sourceLine" id="cb4-349" title="349"><span class="kw">object</span> {</a>
<a class="sourceLine" id="cb4-350" title="350">  <span class="kw">union</span> {</a>
<a class="sourceLine" id="cb4-351" title="351">    #for(i, <span class="fl">0</span>, <span class="fl">53</span>)</a>
<a class="sourceLine" id="cb4-352" title="352">      Edge(vertices, otherEdges[i][<span class="fl">0</span>], otherEdges[i][<span class="fl">1</span>], </a>
<a class="sourceLine" id="cb4-353" title="353">                            theta, phi, xi, edgeTexture1)</a>
<a class="sourceLine" id="cb4-354" title="354">    <span class="ot">#end</span></a>
<a class="sourceLine" id="cb4-355" title="355">    #for(i, <span class="fl">0</span>, <span class="fl">17</span>)</a>
<a class="sourceLine" id="cb4-356" title="356">      Edge(vertices, facetEdges[i][<span class="fl">0</span>], facetEdges[i][<span class="fl">1</span>], </a>
<a class="sourceLine" id="cb4-357" title="357">                            theta, phi, xi, edgeTexture2)</a>
<a class="sourceLine" id="cb4-358" title="358">    <span class="ot">#end</span></a>
<a class="sourceLine" id="cb4-359" title="359">    #for(i, <span class="fl">0</span>, <span class="fl">23</span>)</a>
<a class="sourceLine" id="cb4-360" title="360">      <span class="kw">sphere</span> {</a>
<a class="sourceLine" id="cb4-361" title="361">        vsOther[i], <span class="kw">vlength</span>(vsOther[i])/<span class="fl">10</span></a>
<a class="sourceLine" id="cb4-362" title="362">        <span class="kw">texture</span> { edgeTexture1 }</a>
<a class="sourceLine" id="cb4-363" title="363">      }</a>
<a class="sourceLine" id="cb4-364" title="364">    <span class="ot">#end</span>  </a>
<a class="sourceLine" id="cb4-365" title="365">    #for(i, <span class="fl">0</span>, <span class="fl">11</span>)</a>
<a class="sourceLine" id="cb4-366" title="366">      <span class="kw">sphere</span> {</a>
<a class="sourceLine" id="cb4-367" title="367">        vsFacet[i], <span class="kw">vlength</span>(vsFacet[i])/<span class="fl">10</span></a>
<a class="sourceLine" id="cb4-368" title="368">        <span class="kw">texture</span> { edgeTexture2 }</a>
<a class="sourceLine" id="cb4-369" title="369">      }</a>
<a class="sourceLine" id="cb4-370" title="370">    <span class="ot">#end</span>  </a>
<a class="sourceLine" id="cb4-371" title="371">  }</a>
<a class="sourceLine" id="cb4-372" title="372">  <span class="kw">scale</span> <span class="fl">0.5</span></a>
<a class="sourceLine" id="cb4-373" title="373">  <span class="kw">rotate</span> &lt;<span class="fl">60</span>, <span class="fl">0</span>, <span class="fl">0</span>&gt;</a>
<a class="sourceLine" id="cb4-374" title="374">  <span class="kw">translate</span> &lt;<span class="fl">0</span>, <span class="fl">0.5</span>, <span class="fl">-2</span>&gt;</a>
<a class="sourceLine" id="cb4-375" title="375">}</a></code></pre></div>
<p><img src="./figures/DuoprismStereo_POVRAY2.gif" /></p>

        </div>


        <div id="footer">
          Site proudly generated by
          <a href="http://jaspervdj.be/hakyll">Hakyll</a>
        </div>

      </div>

    </div>

    <div class="row">
      <div class="col-sm-12">
        <div id="disqus_thread"></div>
        <div class="pagination">
          <ul>
            <li>
              <a href="http://laustep.github.io/stlahblog/">&#171; Back Home</a>
            </li>
          </ul>
        </div>
      </div>
    </div>
    
  </div>

</body>

<script src="/libraries/bootstrap/bootstrap.min.js"></script>
<script>
  var disqus_developer = 1;
  var disqus_shortname = 'stlapblog';
  // required: replace example with your forum shortname
  /* * * DON'T EDIT BELOW THIS LINE * * */
  (function () {
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = 'https://' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] ||
      document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>
<noscript>Please enable JavaScript to view the
  <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a>
</noscript>
<!-- MathJax: Fall back to local if CDN offline but local image fonts are not supported (saves >100MB) -->
<script type="text/x-mathjax-config" src="../libraries/mathjax/config/TeX-MML-AM_CHTML.js"></script>
<!-- <script>
  window.MathJax || document.write('<script type="text/x-mathjax-config">MathJax.Hub.Config({"HTML-CSS":{imageFont:null}});<\/script><script src="../libraries/mathjax/MathJax.js"><\/script>');
</script> -->

  <!-- Google Prettify -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prettify/188.0.0/prettify.js"></script>
  <!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/prettify/r298/prettify.js"></script> -->
  <script src="/libraries/highlighters/prettify/js/lang-r.js"></script>
  <script>
    var pres = document.getElementsByTagName("pre");
    for (var i = 0; i < pres.length; ++i) {
      
        pres[i].className = pres[i].className + " prettyprint linenums";
      
    }
    prettyPrint();
  </script> 


</html>]]></description>
    <pubDate>Tue, 11 Feb 2020 00:00:00 UT</pubDate>
    <guid>https://laustep.github.io/stlahblog/posts/DuoprismStereo.html</guid>
    <dc:creator>Stéphane Laurent</dc:creator>
    
</item>
    </channel>
</rss>