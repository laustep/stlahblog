<?xml version="1.0" encoding="utf-8"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"
    xmlns:dc="http://purl.org/dc/elements/1.1/">
    <channel>
        <title>Saturn Elephant</title>
        <link>https://laustep.github.io/stlahblog</link>
        <description><![CDATA[A blog about R and more.]]></description>
        <atom:link href="https://laustep.github.io/stlahblog/feed.xml" rel="self"
                   type="application/rss+xml" />
        <lastBuildDate>Sat, 10 Sep 2022 00:00:00 UT</lastBuildDate>
        
<item>
    <title>The compound of five tetrahedra</title>
    <link>https://laustep.github.io/stlahblog/posts/tetrahedraCompound.html</link>
    <description><![CDATA[<!DOCTYPE HTML>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Saturn Elephant - The compound of five tetrahedra</title>
  <link href="/libraries/bootstrap/bootstrap-grid.min.css" rel="stylesheet">
  <link rel="stylesheet" href="/css/default2.css" />
  <link rel="stylesheet" href="/css/post.css" />
  <link rel="stylesheet" href="/css/misc.css" /> 
  
    <link rel="stylesheet" href="/css/pandoc-solarized.css" /> 
   
  
  <link href="https://fonts.googleapis.com/css?family=Raleway:400,600,200,800" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/css?family=Droid+Sans" rel="stylesheet" type="text/css">
  <script src="/libraries/jquery.min.js"></script>
  <script type="text/javascript" async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML"></script>
</head>

<body>
  <div class="container-fluid">
    <div class="row">
      <!-- Sidebar. -->
      <div class="sidebar col-sm-2">
        <div class="row">
          <div class="col-sm-12" style="float:right;clear:both;margin-right:50px;margin-top:50px;">
            <a href="https://www.r-bloggers.com/">
              <img src="/images/Rbloggers.png" alt="Rbloggers" width="100%" />
            </a>
            <br/>
            <a href="http://t-redactyl.io/">
              <span style="color:black;font-weight:bold;font-family:sans-serif;font-size:25px;">Standard error</span>
            </a>
            <a href="http://timelyportfolio.blogspot.be/">
              <span style="color:grey;font-weight:bold;font-family:sans-serif;font-size:24px;">Timely portfolio</span>
            </a>
            <br/>
            <a href="https://antoineguillot.wordpress.com/blog/">
              <span style="color:white;background-color:darkblue;font-weight:bold;font-family:sans-serif;font-size:21px;border:5px solid;border-color:darkblue">ENHANCE DATA</span>
            </a>
            <br/>
            <a href="https://fronkonstin.com/">
              <span style="color:black;background-color:gold;font-weight:bold;font-size:29px;border:3px solid;border-color:gold;">Fronkonstin</span>
            </a>
          </div>
        </div>
        <div id="logos">
          <div class="row">
            <div class="col-sm-4">
              <img src="/images/AsymptoteLogo.svg" style="width: 150%; transform: rotateZ(-35deg)"/>
            </div>
            <div class="col-sm-4">
              <img src="/images/Rlogo.svg" style="width: 110%;"/>
            </div>
            <div class="col-sm-4">
              <img src="/images/shiny-hex.png" style="width: 90%;"/>
            </div>
          </div>
          <div class="row">
            <div class="col-sm-4">
              <img src="/images/Povray_logo_sphere.png" style="width: 105%;"/>
            </div>
            <div class="col-sm-4">
              <img src="/images/javascript.svg" style="width: 90%;"/>
            </div>
            <div class="col-sm-4">
              <img src="/images/haskell.svg" style="width: 110%;"/>
            </div>
          </div>
        </div>
      </div>

      <div class="main col-sm-10">
        <div id="header">
          <div id="logo">
            <a href="/">
              <img src="/images/stla.jpg" alt="stla" width="100px" />
            </a>
          </div>
          <div id="navigation" style="margin-top:50px;">
            <a href="/">Home</a>
            <a href="/about.html">About</a>
            <a href="/contact.html">Contact</a>
            <a href="/archive.html">Archive</a>
          </div>
        </div>

        <div class="content">
          <h1>The compound of five tetrahedra</h1> 
          <div class="info">
    Posted on September 10, 2022
    
        by Stéphane Laurent
    
</div>
<div class="info">
    
    Tags: <a title="All pages tagged &#39;R&#39;." href="/tags/R.html">R</a>, <a title="All pages tagged &#39;python&#39;." href="/tags/python.html">python</a>, <a title="All pages tagged &#39;geometry&#39;." href="/tags/geometry.html">geometry</a>, <a title="All pages tagged &#39;maths&#39;." href="/tags/maths.html">maths</a>
    
</div>

<p>In <a href="https://laustep.github.io/stlahblog/posts/BooleanOpsOnMeshes.html">this previous post</a> I was wrong when I said I didn’t have a tool to compute the intersection of the compound of five tetrahedra:</p>
<p><img src="./figures/tetrahedraCompoundIntersection.gif" style="width:60.0%" /></p>
<p>This can be achieved with the help of the <strong>rcdd</strong> package in R.</p>
<p>This package is a wrapper of the C library <strong>cddlib</strong>. It implements the <em>double description</em> of convex polyhedra:</p>
<ul>
<li><p>the <em>V-description</em> is the description by the vertices of the polyhedron;</p></li>
<li><p>the <em>H-description</em> is the description by a set of linear inequalities.</p></li>
</ul>
<p>Once we get the H-description of two or more polyhedra, it is straightforward to get the H-description of their intersection: it suffices to join all the linear inequalities. Then, <strong>cddlib</strong> will give us the corresponding V-representation. That’s it.</p>
<p>The <strong>cddlib</strong> library is also usable in Python, with the <strong>pycddlib</strong> library. I’m going to show how to compute the intersection of the five tetrahedra forming the compound with R and with Python.</p>
<h2 id="the-r-way">The R way</h2>
<p>Here are the vertices of the five tetrahedra:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a><span class="co"># the twenty vertices ####</span></span>
<span id="cb1-2"><a href="#cb1-2"></a>phi &lt;-<span class="st"> </span>(<span class="dv">1</span> <span class="op">+</span><span class="st"> </span><span class="kw">sqrt</span>(<span class="dv">5</span>)) <span class="op">/</span><span class="st"> </span><span class="dv">2</span></span>
<span id="cb1-3"><a href="#cb1-3"></a>a &lt;-<span class="st"> </span><span class="dv">1</span> <span class="op">/</span><span class="st"> </span><span class="kw">sqrt</span>(<span class="dv">3</span>)</span>
<span id="cb1-4"><a href="#cb1-4"></a>b &lt;-<span class="st"> </span>a <span class="op">/</span><span class="st"> </span>phi</span>
<span id="cb1-5"><a href="#cb1-5"></a>c &lt;-<span class="st"> </span>a <span class="op">*</span><span class="st"> </span>phi</span>
<span id="cb1-6"><a href="#cb1-6"></a>vertices &lt;-<span class="st"> </span><span class="kw">rbind</span>(</span>
<span id="cb1-7"><a href="#cb1-7"></a>  <span class="kw">c</span>( a,  a,  a),</span>
<span id="cb1-8"><a href="#cb1-8"></a>  <span class="kw">c</span>( a,  a, <span class="op">-</span>a),</span>
<span id="cb1-9"><a href="#cb1-9"></a>  <span class="kw">c</span>( a, <span class="op">-</span>a,  a),</span>
<span id="cb1-10"><a href="#cb1-10"></a>  <span class="kw">c</span>(<span class="op">-</span>a, <span class="op">-</span>a,  a),</span>
<span id="cb1-11"><a href="#cb1-11"></a>  <span class="kw">c</span>(<span class="op">-</span>a,  a, <span class="op">-</span>a),</span>
<span id="cb1-12"><a href="#cb1-12"></a>  <span class="kw">c</span>(<span class="op">-</span>a,  a,  a),</span>
<span id="cb1-13"><a href="#cb1-13"></a>  <span class="kw">c</span>( <span class="dv">0</span>,  b, <span class="op">-</span>c),</span>
<span id="cb1-14"><a href="#cb1-14"></a>  <span class="kw">c</span>( <span class="dv">0</span>, <span class="op">-</span>b, <span class="op">-</span>c),</span>
<span id="cb1-15"><a href="#cb1-15"></a>  <span class="kw">c</span>( <span class="dv">0</span>, <span class="op">-</span>b,  c),</span>
<span id="cb1-16"><a href="#cb1-16"></a>  <span class="kw">c</span>( c,  <span class="dv">0</span>, <span class="op">-</span>b),</span>
<span id="cb1-17"><a href="#cb1-17"></a>  <span class="kw">c</span>(<span class="op">-</span>c,  <span class="dv">0</span>, <span class="op">-</span>b),</span>
<span id="cb1-18"><a href="#cb1-18"></a>  <span class="kw">c</span>(<span class="op">-</span>c,  <span class="dv">0</span>,  b),</span>
<span id="cb1-19"><a href="#cb1-19"></a>  <span class="kw">c</span>( b,  c,  <span class="dv">0</span>),</span>
<span id="cb1-20"><a href="#cb1-20"></a>  <span class="kw">c</span>( b, <span class="op">-</span>c,  <span class="dv">0</span>),</span>
<span id="cb1-21"><a href="#cb1-21"></a>  <span class="kw">c</span>(<span class="op">-</span>b, <span class="op">-</span>c,  <span class="dv">0</span>),</span>
<span id="cb1-22"><a href="#cb1-22"></a>  <span class="kw">c</span>(<span class="op">-</span>b,  c,  <span class="dv">0</span>),</span>
<span id="cb1-23"><a href="#cb1-23"></a>  <span class="kw">c</span>( <span class="dv">0</span>,  b,  c),</span>
<span id="cb1-24"><a href="#cb1-24"></a>  <span class="kw">c</span>( a, <span class="op">-</span>a, <span class="op">-</span>a),</span>
<span id="cb1-25"><a href="#cb1-25"></a>  <span class="kw">c</span>( c,  <span class="dv">0</span>,  b),</span>
<span id="cb1-26"><a href="#cb1-26"></a>  <span class="kw">c</span>(<span class="op">-</span>a, <span class="op">-</span>a, <span class="op">-</span>a)</span>
<span id="cb1-27"><a href="#cb1-27"></a>)</span>
<span id="cb1-28"><a href="#cb1-28"></a></span>
<span id="cb1-29"><a href="#cb1-29"></a><span class="co"># the five tetrahedra ####</span></span>
<span id="cb1-30"><a href="#cb1-30"></a>th1 &lt;-<span class="st"> </span>vertices[<span class="kw">c</span>(17L, 14L,  2L, 11L), ]</span>
<span id="cb1-31"><a href="#cb1-31"></a>th2 &lt;-<span class="st"> </span>vertices[<span class="kw">c</span>(18L,  1L,  4L,  5L), ]</span>
<span id="cb1-32"><a href="#cb1-32"></a>th3 &lt;-<span class="st"> </span>vertices[<span class="kw">c</span>(19L,  6L, 15L,  7L), ]</span>
<span id="cb1-33"><a href="#cb1-33"></a>th4 &lt;-<span class="st"> </span>vertices[<span class="kw">c</span>( 3L, 13L, 12L,  8L), ]</span>
<span id="cb1-34"><a href="#cb1-34"></a>th5 &lt;-<span class="st"> </span>vertices[<span class="kw">c</span>(20L, 16L, 10L,  9L), ]</span></code></pre></div>
<p>To make a V-description with <strong>rcdd</strong>, one uses the function <code>makeV</code>:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true"></a><span class="kw">library</span>(rcdd)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true"></a>V1 &lt;-<span class="st"> </span><span class="kw">makeV</span>(th1)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true"></a>V2 &lt;-<span class="st"> </span><span class="kw">makeV</span>(th2)</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true"></a>V3 &lt;-<span class="st"> </span><span class="kw">makeV</span>(th3)</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true"></a>V4 &lt;-<span class="st"> </span><span class="kw">makeV</span>(th4)</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true"></a>V5 &lt;-<span class="st"> </span><span class="kw">makeV</span>(th5)</span></code></pre></div>
<p>Let’s look at a V-description in R:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true"></a>V1</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true"></a><span class="co">##      [,1] [,2]       [,3]       [,4]       [,5]</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true"></a><span class="co">## [1,]    0    1  0.0000000  0.3568221  0.9341724</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true"></a><span class="co">## [2,]    0    1  0.3568221 -0.9341724  0.0000000</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true"></a><span class="co">## [3,]    0    1  0.5773503  0.5773503 -0.5773503</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true"></a><span class="co">## [4,]    0    1 -0.9341724  0.0000000 -0.3568221</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true"></a><span class="co">## attr(,&quot;representation&quot;)</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true"></a><span class="co">## [1] &quot;V&quot;</span></span></code></pre></div>
<p>Each row starts with a zero and a one, followed by the coordinates of the vertex. I don’t remember what the zero means. The one means that the subsequent numbers represent a vertex (it is also possible to encode rays and lines in a V-description).</p>
<p>Now we get the H-representations with the help of the <code>scdd</code> function:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true"></a>H1 &lt;-<span class="st"> </span><span class="kw">scdd</span>(V1)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true"></a>H2 &lt;-<span class="st"> </span><span class="kw">scdd</span>(V2)</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true"></a>H3 &lt;-<span class="st"> </span><span class="kw">scdd</span>(V3)</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true"></a>H4 &lt;-<span class="st"> </span><span class="kw">scdd</span>(V4)</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true"></a>H5 &lt;-<span class="st"> </span><span class="kw">scdd</span>(V5)</span></code></pre></div>
<p>Let’s look at a H-description:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true"></a>H1</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true"></a><span class="co">## $output</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true"></a><span class="co">##      [,1] [,2]          [,3]          [,4]          [,5]</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true"></a><span class="co">## [1,]    0    1 -2.802517e+00 -2.220446e-16 -1.070466e+00</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true"></a><span class="co">## [2,]    0    1 -8.881784e-16  1.070466e+00  2.802517e+00</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true"></a><span class="co">## [3,]    0    1  1.070466e+00 -2.802517e+00  9.614813e-17</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true"></a><span class="co">## [4,]    0    1  1.732051e+00  1.732051e+00 -1.732051e+00</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true"></a><span class="co">## attr(,&quot;representation&quot;)</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true"></a><span class="co">## [1] &quot;H&quot;</span></span></code></pre></div>
<p>In the first column, a zero indicates that the corresponding rows represents an inequality. The number in the second column is the right hand side of the inequality, and the subsequent three numbers are the coefficients of the linear inequality.</p>
<p>Now, let’s join all the linear inequalities. That is, we stack the five matrices:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true"></a>H &lt;-<span class="st"> </span><span class="kw">rbind</span>(H1<span class="op">$</span>output, H2<span class="op">$</span>output, H3<span class="op">$</span>output, H4<span class="op">$</span>output, H5<span class="op">$</span>output)</span></code></pre></div>
<p>The <code>scdd</code> function converts from the V-representation to the H-representation and vice-versa. Hence we get the vertices of the intersection by applying this function to the above H-representation:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true"></a>(V &lt;-<span class="st"> </span><span class="kw">scdd</span>(H) )</span></code></pre></div>
<pre><code>## $output
##       [,1] [,2]          [,3]          [,4]          [,5]
##  [1,]    0    1 -2.205282e-01 -8.212094e-16  3.568221e-01
##  [2,]    0    1  4.240675e-16 -3.568221e-01  2.205282e-01
##  [3,]    0    1  5.654233e-16  3.568221e-01  2.205282e-01
##  [4,]    0    1  2.205282e-01  0.000000e+00  3.568221e-01
##  [5,]    0    1  3.568221e-01 -2.205282e-01  4.574370e-17
##  [6,]    0    1  3.568221e-01  2.205282e-01 -4.574370e-17
##  [7,]    0    1  2.205282e-01  3.202059e-16 -3.568221e-01
##  [8,]    0    1  1.017762e-15  3.568221e-01 -2.205282e-01
##  [9,]    0    1  6.785079e-16 -3.568221e-01 -2.205282e-01
## [10,]    0    1 -2.205282e-01 -5.010035e-16 -3.568221e-01
## [11,]    0    1 -3.568221e-01  2.205282e-01  2.795606e-16
## [12,]    0    1 -3.568221e-01 -2.205282e-01 -9.718761e-17
## attr(,&quot;representation&quot;)
## [1] &quot;V&quot;</code></pre>
<p>The vertices are given in the last three columns. Let’s extract them:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true"></a>vertices &lt;-<span class="st"> </span>V<span class="op">$</span>output[, <span class="kw">c</span>(3L, 4L, 5L)]</span></code></pre></div>
<p>There are twelve vertices. The intersection is a regular icosahedron. Now we will plot it. First, we compute the convex hull of these vertices with the <strong>cxhull</strong> package. The icosahedron is convex, so its convex hull is itself. But <strong>cxhull</strong> also provides the faces and the edges that are used for plotting.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true"></a><span class="kw">library</span>(cxhull)</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true"></a>icosahedron &lt;-<span class="st"> </span><span class="kw">cxhull</span>(vertices, <span class="dt">triangulate =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<p>There’s a convenient function in <strong>cxhull</strong> to plot a convec hull with <strong>rgl</strong>, namely <code>plotConvexHull3d</code>:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true"></a><span class="kw">library</span>(rgl)</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true"></a><span class="kw">open3d</span>(<span class="dt">windowRect =</span> <span class="kw">c</span>(<span class="dv">50</span>, <span class="dv">50</span>, <span class="dv">562</span>, <span class="dv">562</span>))</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true"></a><span class="kw">view3d</span>(<span class="dv">10</span>, <span class="dv">80</span>, <span class="dt">zoom =</span> <span class="fl">0.7</span>)</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true"></a><span class="kw">plotConvexHull3d</span>(</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true"></a>  icosahedron, <span class="dt">palette =</span> <span class="kw">hcl.colors</span>(<span class="dv">256</span>, <span class="st">&quot;BuPu&quot;</span>), <span class="dt">bias =</span> <span class="fl">0.25</span>, </span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true"></a>  <span class="dt">edgesColor =</span> <span class="st">&quot;yellow&quot;</span>, <span class="dt">tubesRadius =</span> <span class="fl">0.06</span>, <span class="dt">spheresRadius =</span> <span class="fl">0.08</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true"></a>)</span></code></pre></div>
<p><img src="./figures/icosahedron2.png" style="width:60.0%" /></p>
<h2 id="the-python-way">The Python way</h2>
<p>Here is the Python code computing the intersection of the five tetrahedra:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode numberSource python numberLines"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb12-2"><a href="#cb12-2"></a><span class="im">import</span> cdd <span class="im">as</span> cdd</span>
<span id="cb12-3"><a href="#cb12-3"></a></span>
<span id="cb12-4"><a href="#cb12-4"></a><span class="co"># the twenty vertices </span></span>
<span id="cb12-5"><a href="#cb12-5"></a>phi <span class="op">=</span> (<span class="dv">1</span> <span class="op">+</span> np.sqrt(<span class="dv">5</span>)) <span class="op">/</span> <span class="dv">2</span></span>
<span id="cb12-6"><a href="#cb12-6"></a>a <span class="op">=</span> <span class="dv">1</span> <span class="op">/</span> np.sqrt(<span class="dv">3</span>)</span>
<span id="cb12-7"><a href="#cb12-7"></a>b <span class="op">=</span> a <span class="op">/</span> phi</span>
<span id="cb12-8"><a href="#cb12-8"></a>c <span class="op">=</span> a <span class="op">*</span> phi</span>
<span id="cb12-9"><a href="#cb12-9"></a></span>
<span id="cb12-10"><a href="#cb12-10"></a>vertices <span class="op">=</span> np.vstack(</span>
<span id="cb12-11"><a href="#cb12-11"></a>    (</span>
<span id="cb12-12"><a href="#cb12-12"></a>        np.array([a, a, a]),</span>
<span id="cb12-13"><a href="#cb12-13"></a>        np.array([a, a, <span class="op">-</span>a]),</span>
<span id="cb12-14"><a href="#cb12-14"></a>        np.array([a, <span class="op">-</span>a, a]),</span>
<span id="cb12-15"><a href="#cb12-15"></a>        np.array([<span class="op">-</span>a, <span class="op">-</span>a, a]),</span>
<span id="cb12-16"><a href="#cb12-16"></a>        np.array([<span class="op">-</span>a, a, <span class="op">-</span>a]),</span>
<span id="cb12-17"><a href="#cb12-17"></a>        np.array([<span class="op">-</span>a, a, a]),</span>
<span id="cb12-18"><a href="#cb12-18"></a>        np.array([<span class="dv">0</span>, b, <span class="op">-</span>c]),</span>
<span id="cb12-19"><a href="#cb12-19"></a>        np.array([<span class="dv">0</span>, <span class="op">-</span>b, <span class="op">-</span>c]),</span>
<span id="cb12-20"><a href="#cb12-20"></a>        np.array([<span class="dv">0</span>, <span class="op">-</span>b, c]),</span>
<span id="cb12-21"><a href="#cb12-21"></a>        np.array([c, <span class="dv">0</span>, <span class="op">-</span>b]),</span>
<span id="cb12-22"><a href="#cb12-22"></a>        np.array([<span class="op">-</span>c, <span class="dv">0</span>, <span class="op">-</span>b]),</span>
<span id="cb12-23"><a href="#cb12-23"></a>        np.array([<span class="op">-</span>c, <span class="dv">0</span>, b]),</span>
<span id="cb12-24"><a href="#cb12-24"></a>        np.array([b, c, <span class="dv">0</span>]),</span>
<span id="cb12-25"><a href="#cb12-25"></a>        np.array([b, <span class="op">-</span>c, <span class="dv">0</span>]),</span>
<span id="cb12-26"><a href="#cb12-26"></a>        np.array([<span class="op">-</span>b, <span class="op">-</span>c, <span class="dv">0</span>]),</span>
<span id="cb12-27"><a href="#cb12-27"></a>        np.array([<span class="op">-</span>b, c, <span class="dv">0</span>]),</span>
<span id="cb12-28"><a href="#cb12-28"></a>        np.array([<span class="dv">0</span>, b, c]),</span>
<span id="cb12-29"><a href="#cb12-29"></a>        np.array([a, <span class="op">-</span>a, <span class="op">-</span>a]),</span>
<span id="cb12-30"><a href="#cb12-30"></a>        np.array([c, <span class="dv">0</span>, b]),</span>
<span id="cb12-31"><a href="#cb12-31"></a>        np.array([<span class="op">-</span>a, <span class="op">-</span>a, <span class="op">-</span>a]),</span>
<span id="cb12-32"><a href="#cb12-32"></a>    )</span>
<span id="cb12-33"><a href="#cb12-33"></a>)</span>
<span id="cb12-34"><a href="#cb12-34"></a></span>
<span id="cb12-35"><a href="#cb12-35"></a><span class="co"># tetrahedra vertices </span></span>
<span id="cb12-36"><a href="#cb12-36"></a>tetra1Idxs <span class="op">=</span> [<span class="dv">16</span>, <span class="dv">13</span>, <span class="dv">1</span>, <span class="dv">10</span>]</span>
<span id="cb12-37"><a href="#cb12-37"></a>tetra2Idxs <span class="op">=</span> [<span class="dv">17</span>, <span class="dv">0</span>, <span class="dv">3</span>, <span class="dv">4</span>]</span>
<span id="cb12-38"><a href="#cb12-38"></a>tetra3Idxs <span class="op">=</span> [<span class="dv">18</span>, <span class="dv">5</span>, <span class="dv">14</span>, <span class="dv">6</span>]</span>
<span id="cb12-39"><a href="#cb12-39"></a>tetra4Idxs <span class="op">=</span> [<span class="dv">2</span>, <span class="dv">12</span>, <span class="dv">11</span>, <span class="dv">7</span>]</span>
<span id="cb12-40"><a href="#cb12-40"></a>tetra5Idxs <span class="op">=</span> [<span class="dv">19</span>, <span class="dv">15</span>, <span class="dv">9</span>, <span class="dv">8</span>]</span>
<span id="cb12-41"><a href="#cb12-41"></a>th1 <span class="op">=</span> vertices[tetra1Idxs, :]</span>
<span id="cb12-42"><a href="#cb12-42"></a>th2 <span class="op">=</span> vertices[tetra2Idxs, :]</span>
<span id="cb12-43"><a href="#cb12-43"></a>th3 <span class="op">=</span> vertices[tetra3Idxs, :]</span>
<span id="cb12-44"><a href="#cb12-44"></a>th4 <span class="op">=</span> vertices[tetra4Idxs, :]</span>
<span id="cb12-45"><a href="#cb12-45"></a>th5 <span class="op">=</span> vertices[tetra5Idxs, :]</span>
<span id="cb12-46"><a href="#cb12-46"></a></span>
<span id="cb12-47"><a href="#cb12-47"></a><span class="co"># make the V-representation of each tetrahedron; you have to prepend the </span></span>
<span id="cb12-48"><a href="#cb12-48"></a><span class="co"># vertices array with a column of ones</span></span>
<span id="cb12-49"><a href="#cb12-49"></a>v <span class="op">=</span> np.column_stack((np.ones(<span class="dv">4</span>), th1))</span>
<span id="cb12-50"><a href="#cb12-50"></a>mat <span class="op">=</span> cdd.Matrix(v, number_type<span class="op">=</span><span class="st">&#39;float&#39;</span>) </span>
<span id="cb12-51"><a href="#cb12-51"></a>mat.rep_type <span class="op">=</span> cdd.RepType.GENERATOR</span>
<span id="cb12-52"><a href="#cb12-52"></a>poly1 <span class="op">=</span> cdd.Polyhedron(mat)</span>
<span id="cb12-53"><a href="#cb12-53"></a>v <span class="op">=</span> np.column_stack((np.ones(<span class="dv">4</span>), th2))</span>
<span id="cb12-54"><a href="#cb12-54"></a>mat <span class="op">=</span> cdd.Matrix(v, number_type<span class="op">=</span><span class="st">&#39;float&#39;</span>) </span>
<span id="cb12-55"><a href="#cb12-55"></a>mat.rep_type <span class="op">=</span> cdd.RepType.GENERATOR</span>
<span id="cb12-56"><a href="#cb12-56"></a>poly2 <span class="op">=</span> cdd.Polyhedron(mat)</span>
<span id="cb12-57"><a href="#cb12-57"></a>v <span class="op">=</span> np.column_stack((np.ones(<span class="dv">4</span>), th3))</span>
<span id="cb12-58"><a href="#cb12-58"></a>mat <span class="op">=</span> cdd.Matrix(v, number_type<span class="op">=</span><span class="st">&#39;float&#39;</span>) </span>
<span id="cb12-59"><a href="#cb12-59"></a>mat.rep_type <span class="op">=</span> cdd.RepType.GENERATOR</span>
<span id="cb12-60"><a href="#cb12-60"></a>poly3 <span class="op">=</span> cdd.Polyhedron(mat)</span>
<span id="cb12-61"><a href="#cb12-61"></a>v <span class="op">=</span> np.column_stack((np.ones(<span class="dv">4</span>), th4))</span>
<span id="cb12-62"><a href="#cb12-62"></a>mat <span class="op">=</span> cdd.Matrix(v, number_type<span class="op">=</span><span class="st">&#39;float&#39;</span>) </span>
<span id="cb12-63"><a href="#cb12-63"></a>mat.rep_type <span class="op">=</span> cdd.RepType.GENERATOR</span>
<span id="cb12-64"><a href="#cb12-64"></a>poly4 <span class="op">=</span> cdd.Polyhedron(mat)</span>
<span id="cb12-65"><a href="#cb12-65"></a>v <span class="op">=</span> np.column_stack((np.ones(<span class="dv">4</span>), th5))</span>
<span id="cb12-66"><a href="#cb12-66"></a>mat <span class="op">=</span> cdd.Matrix(v, number_type<span class="op">=</span><span class="st">&#39;float&#39;</span>) </span>
<span id="cb12-67"><a href="#cb12-67"></a>mat.rep_type <span class="op">=</span> cdd.RepType.GENERATOR</span>
<span id="cb12-68"><a href="#cb12-68"></a>poly5 <span class="op">=</span> cdd.Polyhedron(mat)</span>
<span id="cb12-69"><a href="#cb12-69"></a></span>
<span id="cb12-70"><a href="#cb12-70"></a><span class="co"># H-representations of the tetrahedra</span></span>
<span id="cb12-71"><a href="#cb12-71"></a>h1 <span class="op">=</span> poly1.get_inequalities()</span>
<span id="cb12-72"><a href="#cb12-72"></a>h2 <span class="op">=</span> poly2.get_inequalities()</span>
<span id="cb12-73"><a href="#cb12-73"></a>h3 <span class="op">=</span> poly3.get_inequalities()</span>
<span id="cb12-74"><a href="#cb12-74"></a>h4 <span class="op">=</span> poly4.get_inequalities()</span>
<span id="cb12-75"><a href="#cb12-75"></a>h5 <span class="op">=</span> poly5.get_inequalities()</span>
<span id="cb12-76"><a href="#cb12-76"></a></span>
<span id="cb12-77"><a href="#cb12-77"></a><span class="co"># join the five sets of linear inequalities; this will give the intersection</span></span>
<span id="cb12-78"><a href="#cb12-78"></a>hintersection <span class="op">=</span> np.vstack((h1, h2, h3, h4, h5))</span>
<span id="cb12-79"><a href="#cb12-79"></a></span>
<span id="cb12-80"><a href="#cb12-80"></a><span class="co"># make the V-representation of the intersection</span></span>
<span id="cb12-81"><a href="#cb12-81"></a>mat <span class="op">=</span> cdd.Matrix(hintersection, number_type<span class="op">=</span><span class="st">&#39;float&#39;</span>)</span>
<span id="cb12-82"><a href="#cb12-82"></a>mat.rep_type <span class="op">=</span> cdd.RepType.INEQUALITY</span>
<span id="cb12-83"><a href="#cb12-83"></a>polyintersection <span class="op">=</span> cdd.Polyhedron(mat)</span>
<span id="cb12-84"><a href="#cb12-84"></a></span>
<span id="cb12-85"><a href="#cb12-85"></a><span class="co"># get the vertices; they are given in a matrix prepended by a column of ones</span></span>
<span id="cb12-86"><a href="#cb12-86"></a>vintersection <span class="op">=</span> polyintersection.get_generators()</span>
<span id="cb12-87"><a href="#cb12-87"></a></span>
<span id="cb12-88"><a href="#cb12-88"></a><span class="co"># get rid of the column of ones</span></span>
<span id="cb12-89"><a href="#cb12-89"></a>n_inequalities <span class="op">=</span> vintersection.row_size</span>
<span id="cb12-90"><a href="#cb12-90"></a>intersection <span class="op">=</span> np.array([</span>
<span id="cb12-91"><a href="#cb12-91"></a>    vintersection[i][<span class="dv">1</span>:<span class="dv">4</span>] <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(n_inequalities)    </span>
<span id="cb12-92"><a href="#cb12-92"></a>])</span></code></pre></div>
<p>Results are the same as the ones we got with R:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true"></a>array([[<span class="op">-</span><span class="fl">2.20528179e-01</span>, <span class="op">-</span><span class="fl">8.21209393e-16</span>,  <span class="fl">3.56822090e-01</span>],</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true"></a>       [ <span class="fl">4.24067460e-16</span>, <span class="op">-</span><span class="fl">3.56822090e-01</span>,  <span class="fl">2.20528179e-01</span>],</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true"></a>       [ <span class="fl">5.65423280e-16</span>,  <span class="fl">3.56822090e-01</span>,  <span class="fl">2.20528179e-01</span>],</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true"></a>       [ <span class="fl">2.20528179e-01</span>,  <span class="fl">0.00000000e+00</span>,  <span class="fl">3.56822090e-01</span>],</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true"></a>       [ <span class="fl">3.56822090e-01</span>, <span class="op">-</span><span class="fl">2.20528179e-01</span>,  <span class="fl">4.57437043e-17</span>],</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true"></a>       [ <span class="fl">3.56822090e-01</span>,  <span class="fl">2.20528179e-01</span>, <span class="op">-</span><span class="fl">4.57437043e-17</span>],</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true"></a>       [ <span class="fl">2.20528179e-01</span>,  <span class="fl">3.20205930e-16</span>, <span class="op">-</span><span class="fl">3.56822090e-01</span>],</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true"></a>       [ <span class="fl">1.01776190e-15</span>,  <span class="fl">3.56822090e-01</span>, <span class="op">-</span><span class="fl">2.20528179e-01</span>],</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true"></a>       [ <span class="fl">6.78507937e-16</span>, <span class="op">-</span><span class="fl">3.56822090e-01</span>, <span class="op">-</span><span class="fl">2.20528179e-01</span>],</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true"></a>       [<span class="op">-</span><span class="fl">2.20528179e-01</span>, <span class="op">-</span><span class="fl">5.01003463e-16</span>, <span class="op">-</span><span class="fl">3.56822090e-01</span>],</span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true"></a>       [<span class="op">-</span><span class="fl">3.56822090e-01</span>,  <span class="fl">2.20528179e-01</span>,  <span class="fl">2.79560644e-16</span>],</span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true"></a>       [<span class="op">-</span><span class="fl">3.56822090e-01</span>, <span class="op">-</span><span class="fl">2.20528179e-01</span>, <span class="op">-</span><span class="fl">9.71876138e-17</span>]])</span></code></pre></div>
<p>It is possible to get the edges of the polyhedron with <strong>pycddlib</strong>; see how I did in <a href="https://laustep.github.io/stlahblog/posts/E8rootPolytope.html">this post</a>. And to get the convex hull with its faces, one can use <code>scipy.spatial.ConvexHull(intersection)</code>.</p>

        </div>


        <div id="footer">
          Site proudly generated by
          <a href="http://jaspervdj.be/hakyll">Hakyll</a>
        </div>

      </div>

    </div>

    <div class="row">
      <div class="col-sm-12">
        <div id="disqus_thread"></div>
        <div class="pagination">
          <ul>
            <li>
              <a href="http://laustep.github.io/stlahblog/">&#171; Back Home</a>
            </li>
          </ul>
        </div>
      </div>
    </div>
    
  </div>

</body>

<script src="/libraries/bootstrap/bootstrap.min.js"></script>
<script>
  var disqus_developer = 1;
  var disqus_shortname = 'stlapblog';
  // required: replace example with your forum shortname
  /* * * DON'T EDIT BELOW THIS LINE * * */
  (function () {
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = 'https://' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] ||
      document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>
<noscript>Please enable JavaScript to view the
  <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a>
</noscript>
<!-- MathJax: Fall back to local if CDN offline but local image fonts are not supported (saves >100MB) -->
<script type="text/x-mathjax-config" src="/libraries/mathjax/config/TeX-MML-AM_CHTML.js"></script>
<!-- <script>
  window.MathJax || document.write('<script type="text/x-mathjax-config">MathJax.Hub.Config({"HTML-CSS":{imageFont:null}});<\/script><script src="../libraries/mathjax/MathJax.js"><\/script>');
</script> -->


</html>]]></description>
    <pubDate>Sat, 10 Sep 2022 00:00:00 UT</pubDate>
    <guid>https://laustep.github.io/stlahblog/posts/tetrahedraCompound.html</guid>
    <dc:creator>Stéphane Laurent</dc:creator>
    <category>R</category>
</item>


<item>
    <title>Labelling the points of a 'ggplot' with Shiny</title>
    <link>https://laustep.github.io/stlahblog/posts/ggplot2_labelling.html</link>
    <description><![CDATA[<!DOCTYPE HTML>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Saturn Elephant - Labelling the points of a 'ggplot' with Shiny</title>
  <link href="/libraries/bootstrap/bootstrap-grid.min.css" rel="stylesheet">
  <link rel="stylesheet" href="/css/default2.css" />
  <link rel="stylesheet" href="/css/post.css" />
  <link rel="stylesheet" href="/css/misc.css" /> 
  
    <link rel="stylesheet" href="/css/pandoc-solarized.css" /> 
   
  
  <link href="https://fonts.googleapis.com/css?family=Raleway:400,600,200,800" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/css?family=Droid+Sans" rel="stylesheet" type="text/css">
  <script src="/libraries/jquery.min.js"></script>
  <script type="text/javascript" async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML"></script>
</head>

<body>
  <div class="container-fluid">
    <div class="row">
      <!-- Sidebar. -->
      <div class="sidebar col-sm-2">
        <div class="row">
          <div class="col-sm-12" style="float:right;clear:both;margin-right:50px;margin-top:50px;">
            <a href="https://www.r-bloggers.com/">
              <img src="/images/Rbloggers.png" alt="Rbloggers" width="100%" />
            </a>
            <br/>
            <a href="http://t-redactyl.io/">
              <span style="color:black;font-weight:bold;font-family:sans-serif;font-size:25px;">Standard error</span>
            </a>
            <a href="http://timelyportfolio.blogspot.be/">
              <span style="color:grey;font-weight:bold;font-family:sans-serif;font-size:24px;">Timely portfolio</span>
            </a>
            <br/>
            <a href="https://antoineguillot.wordpress.com/blog/">
              <span style="color:white;background-color:darkblue;font-weight:bold;font-family:sans-serif;font-size:21px;border:5px solid;border-color:darkblue">ENHANCE DATA</span>
            </a>
            <br/>
            <a href="https://fronkonstin.com/">
              <span style="color:black;background-color:gold;font-weight:bold;font-size:29px;border:3px solid;border-color:gold;">Fronkonstin</span>
            </a>
          </div>
        </div>
        <div id="logos">
          <div class="row">
            <div class="col-sm-4">
              <img src="/images/AsymptoteLogo.svg" style="width: 150%; transform: rotateZ(-35deg)"/>
            </div>
            <div class="col-sm-4">
              <img src="/images/Rlogo.svg" style="width: 110%;"/>
            </div>
            <div class="col-sm-4">
              <img src="/images/shiny-hex.png" style="width: 90%;"/>
            </div>
          </div>
          <div class="row">
            <div class="col-sm-4">
              <img src="/images/Povray_logo_sphere.png" style="width: 105%;"/>
            </div>
            <div class="col-sm-4">
              <img src="/images/javascript.svg" style="width: 90%;"/>
            </div>
            <div class="col-sm-4">
              <img src="/images/haskell.svg" style="width: 110%;"/>
            </div>
          </div>
        </div>
      </div>

      <div class="main col-sm-10">
        <div id="header">
          <div id="logo">
            <a href="/">
              <img src="/images/stla.jpg" alt="stla" width="100px" />
            </a>
          </div>
          <div id="navigation" style="margin-top:50px;">
            <a href="/">Home</a>
            <a href="/about.html">About</a>
            <a href="/contact.html">Contact</a>
            <a href="/archive.html">Archive</a>
          </div>
        </div>

        <div class="content">
          <h1>Labelling the points of a 'ggplot' with Shiny</h1> 
          <div class="info">
    Posted on August  8, 2022
    
        by Stéphane Laurent
    
</div>
<div class="info">
    
    Tags: <a title="All pages tagged &#39;R&#39;." href="/tags/R.html">R</a>, <a title="All pages tagged &#39;graphics&#39;." href="/tags/graphics.html">graphics</a>, <a title="All pages tagged &#39;shiny&#39;." href="/tags/shiny.html">shiny</a>
    
</div>

<p>The Shiny app below allows to attribute a label to the points of a ‘ggplot’ by double-clicking on the points.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a><span class="kw">library</span>(shiny)</span>
<span id="cb1-2"><a href="#cb1-2"></a><span class="kw">library</span>(rhandsontable)</span>
<span id="cb1-3"><a href="#cb1-3"></a><span class="kw">library</span>(htmlwidgets)</span>
<span id="cb1-4"><a href="#cb1-4"></a><span class="kw">library</span>(colourpicker)</span>
<span id="cb1-5"><a href="#cb1-5"></a><span class="kw">library</span>(ggplot2)</span>
<span id="cb1-6"><a href="#cb1-6"></a><span class="kw">library</span>(ggrepel)</span>
<span id="cb1-7"><a href="#cb1-7"></a></span>
<span id="cb1-8"><a href="#cb1-8"></a><span class="co">#&#39; Add labels to points on a ggplot2 scatterplot</span></span>
<span id="cb1-9"><a href="#cb1-9"></a><span class="co">#&#39; @param gg the ggplot</span></span>
<span id="cb1-10"><a href="#cb1-10"></a><span class="co">#&#39; @param X name of the x-variable</span></span>
<span id="cb1-11"><a href="#cb1-11"></a><span class="co">#&#39; @param Y names of the y-variable</span></span>
<span id="cb1-12"><a href="#cb1-12"></a><span class="co">#&#39; @param labels named list like \code{list(&quot;10&quot; = c(&quot;mylabel&quot;, &quot;blue&quot;))}; </span></span>
<span id="cb1-13"><a href="#cb1-13"></a><span class="co">#&#39; the names of the list are the row names, each component of the list is </span></span>
<span id="cb1-14"><a href="#cb1-14"></a><span class="co">#&#39; a character vector of length two: the label and its color</span></span>
<span id="cb1-15"><a href="#cb1-15"></a><span class="co">#&#39; @importFrom ggrepel geom_text_repel</span></span>
<span id="cb1-16"><a href="#cb1-16"></a>addLabels &lt;-<span class="st"> </span><span class="cf">function</span>(gg, X, Y, labels){</span>
<span id="cb1-17"><a href="#cb1-17"></a>  <span class="cf">if</span>(<span class="kw">is.null</span>(labels)){</span>
<span id="cb1-18"><a href="#cb1-18"></a>    <span class="kw">return</span>(gg)</span>
<span id="cb1-19"><a href="#cb1-19"></a>  }</span>
<span id="cb1-20"><a href="#cb1-20"></a>  dat &lt;-<span class="st"> </span>gg<span class="op">$</span>data</span>
<span id="cb1-21"><a href="#cb1-21"></a>  indices &lt;-<span class="st"> </span><span class="kw">intersect</span>(<span class="kw">names</span>(labels), <span class="kw">rownames</span>(dat)) </span>
<span id="cb1-22"><a href="#cb1-22"></a>  dat[[<span class="st">&quot;..labels&quot;</span>]] &lt;-<span class="st"> &quot;&quot;</span></span>
<span id="cb1-23"><a href="#cb1-23"></a>  dat[[<span class="st">&quot;..colors&quot;</span>]] &lt;-<span class="st"> &quot;black&quot;</span></span>
<span id="cb1-24"><a href="#cb1-24"></a>  dat[indices, <span class="st">&quot;..labels&quot;</span>] &lt;-<span class="st"> </span><span class="kw">sapply</span>(labels[indices], <span class="st">&quot;[[&quot;</span>, 1L)</span>
<span id="cb1-25"><a href="#cb1-25"></a>  dat[indices, <span class="st">&quot;..colors&quot;</span>] &lt;-<span class="st"> </span><span class="kw">sapply</span>(labels[indices], <span class="st">&quot;[[&quot;</span>, 2L)</span>
<span id="cb1-26"><a href="#cb1-26"></a>  range_x &lt;-<span class="st"> </span><span class="kw">diff</span>(<span class="kw">range</span>(dat[[X]], <span class="dt">na.rm =</span> <span class="ot">TRUE</span>))</span>
<span id="cb1-27"><a href="#cb1-27"></a>  range_y &lt;-<span class="st"> </span><span class="kw">diff</span>(<span class="kw">range</span>(dat[[Y]], <span class="dt">na.rm =</span> <span class="ot">TRUE</span>))</span>
<span id="cb1-28"><a href="#cb1-28"></a>  gg <span class="op">+</span><span class="st"> </span><span class="kw">geom_text_repel</span>(</span>
<span id="cb1-29"><a href="#cb1-29"></a>    <span class="kw">aes_</span>(<span class="dt">x =</span> <span class="kw">as.name</span>(X), <span class="dt">y =</span> <span class="kw">as.name</span>(Y), <span class="dt">label =</span> <span class="kw">as.name</span>(<span class="st">&quot;..labels&quot;</span>)), </span>
<span id="cb1-30"><a href="#cb1-30"></a>    <span class="dt">color =</span> dat[[<span class="st">&quot;..colors&quot;</span>]], <span class="dt">size =</span> <span class="dv">9</span>, <span class="dt">max.overlaps =</span> 100L, </span>
<span id="cb1-31"><a href="#cb1-31"></a>    <span class="dt">data =</span> dat, <span class="dt">inherit.aes =</span> <span class="ot">FALSE</span>,   </span>
<span id="cb1-32"><a href="#cb1-32"></a>    <span class="dt">segment.size =</span> <span class="fl">0.2</span>, <span class="dt">min.segment.length =</span> <span class="kw">unit</span>(<span class="dv">0</span>, <span class="st">&#39;lines&#39;</span>), </span>
<span id="cb1-33"><a href="#cb1-33"></a>    <span class="dt">nudge_x =</span> range_x<span class="op">/</span><span class="dv">15</span>, <span class="dt">nudge_y =</span> range_y<span class="op">/</span><span class="dv">15</span></span>
<span id="cb1-34"><a href="#cb1-34"></a>  )</span>
<span id="cb1-35"><a href="#cb1-35"></a>}</span>
<span id="cb1-36"><a href="#cb1-36"></a></span>
<span id="cb1-37"><a href="#cb1-37"></a>ui &lt;-<span class="st"> </span><span class="kw">fluidPage</span>(</span>
<span id="cb1-38"><a href="#cb1-38"></a>  <span class="kw">br</span>(),</span>
<span id="cb1-39"><a href="#cb1-39"></a>  <span class="kw">fluidRow</span>(</span>
<span id="cb1-40"><a href="#cb1-40"></a>    <span class="kw">column</span>(</span>
<span id="cb1-41"><a href="#cb1-41"></a>      <span class="dv">8</span>,</span>
<span id="cb1-42"><a href="#cb1-42"></a>      <span class="kw">plotOutput</span>(<span class="st">&quot;ggplot&quot;</span>, <span class="dt">dblclick =</span> <span class="st">&quot;plotClick&quot;</span>)</span>
<span id="cb1-43"><a href="#cb1-43"></a>    ),</span>
<span id="cb1-44"><a href="#cb1-44"></a>    <span class="kw">column</span>(</span>
<span id="cb1-45"><a href="#cb1-45"></a>      <span class="dv">4</span>,</span>
<span id="cb1-46"><a href="#cb1-46"></a>      tags<span class="op">$</span><span class="kw">div</span>(</span>
<span id="cb1-47"><a href="#cb1-47"></a>        <span class="dt">style =</span> <span class="st">&quot;max-height: 400px; overflow: auto;&quot;</span>,</span>
<span id="cb1-48"><a href="#cb1-48"></a>        <span class="kw">rHandsontableOutput</span>(<span class="st">&quot;hot_pointLabels&quot;</span>)  </span>
<span id="cb1-49"><a href="#cb1-49"></a>      )</span>
<span id="cb1-50"><a href="#cb1-50"></a>    )</span>
<span id="cb1-51"><a href="#cb1-51"></a>  )</span>
<span id="cb1-52"><a href="#cb1-52"></a>)</span>
<span id="cb1-53"><a href="#cb1-53"></a></span>
<span id="cb1-54"><a href="#cb1-54"></a>server &lt;-<span class="st"> </span><span class="cf">function</span>(input, output, session){</span>
<span id="cb1-55"><a href="#cb1-55"></a>  </span>
<span id="cb1-56"><a href="#cb1-56"></a>  Ggplot &lt;-<span class="st"> </span><span class="kw">reactive</span>({</span>
<span id="cb1-57"><a href="#cb1-57"></a>    gg &lt;-<span class="st"> </span><span class="kw">ggplot</span>(iris) <span class="op">+</span><span class="st"> </span></span>
<span id="cb1-58"><a href="#cb1-58"></a><span class="st">      </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">x =</span> Petal.Width, <span class="dt">y =</span> Petal.Length, <span class="dt">color =</span> Species))</span>
<span id="cb1-59"><a href="#cb1-59"></a>    gg</span>
<span id="cb1-60"><a href="#cb1-60"></a>  })</span>
<span id="cb1-61"><a href="#cb1-61"></a>  </span>
<span id="cb1-62"><a href="#cb1-62"></a>  output[[<span class="st">&quot;ggplot&quot;</span>]] &lt;-<span class="st"> </span><span class="kw">renderPlot</span>({</span>
<span id="cb1-63"><a href="#cb1-63"></a>    <span class="kw">addLabels</span>(<span class="kw">Ggplot</span>(), <span class="st">&quot;Petal.Width&quot;</span>, <span class="st">&quot;Petal.Length&quot;</span>, <span class="kw">Labels</span>())</span>
<span id="cb1-64"><a href="#cb1-64"></a>  })</span>
<span id="cb1-65"><a href="#cb1-65"></a>  </span>
<span id="cb1-66"><a href="#cb1-66"></a>  output[[<span class="st">&quot;hot_pointLabels&quot;</span>]] &lt;-<span class="st"> </span><span class="kw">renderRHandsontable</span>({</span>
<span id="cb1-67"><a href="#cb1-67"></a>    <span class="cf">if</span>(<span class="op">!</span><span class="kw">is.null</span>(hot &lt;-<span class="st"> </span>input[[<span class="st">&quot;hot_pointLabels&quot;</span>]])){</span>
<span id="cb1-68"><a href="#cb1-68"></a>      DF &lt;-<span class="st"> </span><span class="kw">hot_to_r</span>(hot)</span>
<span id="cb1-69"><a href="#cb1-69"></a>    } <span class="cf">else</span> {</span>
<span id="cb1-70"><a href="#cb1-70"></a>      DF &lt;-<span class="st"> </span><span class="kw">data.frame</span>(</span>
<span id="cb1-71"><a href="#cb1-71"></a>        <span class="dt">index =</span> <span class="kw">rownames</span>(iris), </span>
<span id="cb1-72"><a href="#cb1-72"></a>        <span class="dt">label =</span> <span class="st">&quot;&quot;</span>, </span>
<span id="cb1-73"><a href="#cb1-73"></a>        <span class="dt">color =</span> <span class="st">&quot;black&quot;</span>,</span>
<span id="cb1-74"><a href="#cb1-74"></a>        <span class="dt">stringsAsFactors =</span> <span class="ot">FALSE</span></span>
<span id="cb1-75"><a href="#cb1-75"></a>      )</span>
<span id="cb1-76"><a href="#cb1-76"></a>    }</span>
<span id="cb1-77"><a href="#cb1-77"></a>    <span class="kw">rhandsontable</span>(DF, <span class="dt">rowHeaders =</span> <span class="ot">NULL</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb1-78"><a href="#cb1-78"></a><span class="st">      </span><span class="kw">hot_col</span>(<span class="st">&quot;index&quot;</span>, <span class="dt">readOnly =</span> <span class="ot">TRUE</span>) <span class="op">%&gt;%</span></span>
<span id="cb1-79"><a href="#cb1-79"></a><span class="st">      </span><span class="kw">hot_cols</span>(<span class="dt">colWidths =</span> <span class="kw">c</span>(<span class="dv">50</span>, <span class="dv">200</span>, <span class="dv">100</span>)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb1-80"><a href="#cb1-80"></a><span class="st">      </span><span class="kw">hot_table</span>(</span>
<span id="cb1-81"><a href="#cb1-81"></a>        <span class="dt">highlightRow =</span> <span class="ot">TRUE</span>, <span class="dt">contextMenu =</span> <span class="ot">FALSE</span>, <span class="dt">fillHandle =</span> <span class="ot">TRUE</span></span>
<span id="cb1-82"><a href="#cb1-82"></a>      ) <span class="op">%&gt;%</span></span>
<span id="cb1-83"><a href="#cb1-83"></a><span class="st">      </span><span class="kw">onRender</span>(</span>
<span id="cb1-84"><a href="#cb1-84"></a>        <span class="st">&quot;function(el, x){</span></span>
<span id="cb1-85"><a href="#cb1-85"></a><span class="st">          var hot = this.hot;</span></span>
<span id="cb1-86"><a href="#cb1-86"></a><span class="st">          Shiny.addCustomMessageHandler(&#39;handler_hot&#39;, function(msg){</span></span>
<span id="cb1-87"><a href="#cb1-87"></a><span class="st">            hot.setDataAtCell(msg.row, 1, msg.label);</span></span>
<span id="cb1-88"><a href="#cb1-88"></a><span class="st">            hot.setDataAtCell(msg.row, 2, msg.color);</span></span>
<span id="cb1-89"><a href="#cb1-89"></a><span class="st">          });</span></span>
<span id="cb1-90"><a href="#cb1-90"></a><span class="st">        }&quot;</span></span>
<span id="cb1-91"><a href="#cb1-91"></a>      )</span>
<span id="cb1-92"><a href="#cb1-92"></a>  })</span>
<span id="cb1-93"><a href="#cb1-93"></a>  </span>
<span id="cb1-94"><a href="#cb1-94"></a>  Index &lt;-<span class="st"> </span><span class="kw">reactiveVal</span>()</span>
<span id="cb1-95"><a href="#cb1-95"></a>  <span class="kw">observeEvent</span>(input[[<span class="st">&quot;plotClick&quot;</span>]], {</span>
<span id="cb1-96"><a href="#cb1-96"></a>    dat &lt;-<span class="st"> </span><span class="kw">droplevels</span>(<span class="kw">Ggplot</span>()<span class="op">$</span>data)</span>
<span id="cb1-97"><a href="#cb1-97"></a>    point &lt;-<span class="st"> </span><span class="kw">nearPoints</span>(</span>
<span id="cb1-98"><a href="#cb1-98"></a>      dat, input[[<span class="st">&quot;plotClick&quot;</span>]], <span class="dt">threshold =</span> <span class="dv">15</span>, <span class="dt">maxpoints =</span> 1L</span>
<span id="cb1-99"><a href="#cb1-99"></a>    )</span>
<span id="cb1-100"><a href="#cb1-100"></a>    <span class="cf">if</span>(<span class="kw">nrow</span>(point)){</span>
<span id="cb1-101"><a href="#cb1-101"></a>      <span class="kw">Index</span>(<span class="kw">as.integer</span>(<span class="kw">rownames</span>(point)))</span>
<span id="cb1-102"><a href="#cb1-102"></a>      <span class="kw">showModal</span>(<span class="kw">modalDialog</span>(</span>
<span id="cb1-103"><a href="#cb1-103"></a>        <span class="dt">title =</span> <span class="st">&quot;Set a label for this point and its color&quot;</span>,</span>
<span id="cb1-104"><a href="#cb1-104"></a>        <span class="kw">textInput</span>(<span class="st">&quot;pointLabel&quot;</span>, <span class="ot">NULL</span>, <span class="dt">placeholder =</span> <span class="st">&quot;label&quot;</span>),</span>
<span id="cb1-105"><a href="#cb1-105"></a>        <span class="kw">colourInput</span>(<span class="st">&quot;pointLabelCol&quot;</span>, <span class="ot">NULL</span>, <span class="dt">value =</span> <span class="st">&quot;black&quot;</span>),</span>
<span id="cb1-106"><a href="#cb1-106"></a>        <span class="dt">footer =</span> <span class="kw">tagList</span>(</span>
<span id="cb1-107"><a href="#cb1-107"></a>          <span class="kw">modalButton</span>(<span class="st">&quot;Cancel&quot;</span>),</span>
<span id="cb1-108"><a href="#cb1-108"></a>          <span class="kw">actionButton</span>(<span class="st">&quot;ok&quot;</span>, <span class="st">&quot;OK&quot;</span>)</span>
<span id="cb1-109"><a href="#cb1-109"></a>        ), </span>
<span id="cb1-110"><a href="#cb1-110"></a>        <span class="dt">size =</span> <span class="st">&quot;s&quot;</span></span>
<span id="cb1-111"><a href="#cb1-111"></a>      ))</span>
<span id="cb1-112"><a href="#cb1-112"></a>    }</span>
<span id="cb1-113"><a href="#cb1-113"></a>  })</span>
<span id="cb1-114"><a href="#cb1-114"></a>  </span>
<span id="cb1-115"><a href="#cb1-115"></a>  <span class="kw">observeEvent</span>(input[[<span class="st">&quot;ok&quot;</span>]], {</span>
<span id="cb1-116"><a href="#cb1-116"></a>    session<span class="op">$</span><span class="kw">sendCustomMessage</span>(</span>
<span id="cb1-117"><a href="#cb1-117"></a>      <span class="st">&quot;handler_hot&quot;</span>, </span>
<span id="cb1-118"><a href="#cb1-118"></a>      <span class="kw">list</span>(</span>
<span id="cb1-119"><a href="#cb1-119"></a>        <span class="st">&quot;row&quot;</span>   =<span class="st"> </span><span class="kw">Index</span>() <span class="op">-</span><span class="st"> </span>1L, </span>
<span id="cb1-120"><a href="#cb1-120"></a>        <span class="st">&quot;label&quot;</span> =<span class="st"> </span>input[[<span class="st">&quot;pointLabel&quot;</span>]], </span>
<span id="cb1-121"><a href="#cb1-121"></a>        <span class="st">&quot;color&quot;</span> =<span class="st"> </span>input[[<span class="st">&quot;pointLabelCol&quot;</span>]]</span>
<span id="cb1-122"><a href="#cb1-122"></a>      )</span>
<span id="cb1-123"><a href="#cb1-123"></a>    )</span>
<span id="cb1-124"><a href="#cb1-124"></a>    <span class="kw">Index</span>(<span class="ot">NULL</span>)</span>
<span id="cb1-125"><a href="#cb1-125"></a>    <span class="kw">removeModal</span>()</span>
<span id="cb1-126"><a href="#cb1-126"></a>  })</span>
<span id="cb1-127"><a href="#cb1-127"></a>  </span>
<span id="cb1-128"><a href="#cb1-128"></a>  pointsLabelsTable &lt;-<span class="st"> </span><span class="kw">reactive</span>({</span>
<span id="cb1-129"><a href="#cb1-129"></a>    <span class="cf">if</span>(<span class="op">!</span><span class="kw">is.null</span>(hot &lt;-<span class="st"> </span>input[[<span class="st">&quot;hot_pointsLabels&quot;</span>]])){</span>
<span id="cb1-130"><a href="#cb1-130"></a>      <span class="kw">hot_to_r</span>(hot)</span>
<span id="cb1-131"><a href="#cb1-131"></a>    }<span class="cf">else</span>{</span>
<span id="cb1-132"><a href="#cb1-132"></a>      <span class="ot">NULL</span></span>
<span id="cb1-133"><a href="#cb1-133"></a>    }</span>
<span id="cb1-134"><a href="#cb1-134"></a>  })</span>
<span id="cb1-135"><a href="#cb1-135"></a>  </span>
<span id="cb1-136"><a href="#cb1-136"></a>  Labels &lt;-<span class="st"> </span><span class="kw">eventReactive</span>(input[[<span class="st">&quot;hot_pointLabels&quot;</span>]], {</span>
<span id="cb1-137"><a href="#cb1-137"></a>    dat &lt;-<span class="st"> </span><span class="kw">hot_to_r</span>(input[[<span class="st">&quot;hot_pointLabels&quot;</span>]])</span>
<span id="cb1-138"><a href="#cb1-138"></a>    indices &lt;-<span class="st"> </span>dat[[<span class="st">&quot;index&quot;</span>]]</span>
<span id="cb1-139"><a href="#cb1-139"></a>    labels  &lt;-<span class="st"> </span>dat[[<span class="st">&quot;label&quot;</span>]]</span>
<span id="cb1-140"><a href="#cb1-140"></a>    colors  &lt;-<span class="st"> </span>dat[[<span class="st">&quot;color&quot;</span>]]</span>
<span id="cb1-141"><a href="#cb1-141"></a>    keep &lt;-<span class="st"> </span>labels <span class="op">!=</span><span class="st"> &quot;&quot;</span></span>
<span id="cb1-142"><a href="#cb1-142"></a>    <span class="cf">if</span>(<span class="kw">any</span>(keep)){</span>
<span id="cb1-143"><a href="#cb1-143"></a>      L &lt;-<span class="st"> </span><span class="kw">mapply</span>(</span>
<span id="cb1-144"><a href="#cb1-144"></a>        c, labels[keep], colors[keep], </span>
<span id="cb1-145"><a href="#cb1-145"></a>        <span class="dt">SIMPLIFY =</span> <span class="ot">FALSE</span>, <span class="dt">USE.NAMES =</span> <span class="ot">FALSE</span></span>
<span id="cb1-146"><a href="#cb1-146"></a>      )</span>
<span id="cb1-147"><a href="#cb1-147"></a>      <span class="kw">setNames</span>(L, indices[keep])</span>
<span id="cb1-148"><a href="#cb1-148"></a>    }<span class="cf">else</span>{</span>
<span id="cb1-149"><a href="#cb1-149"></a>      <span class="ot">NULL</span></span>
<span id="cb1-150"><a href="#cb1-150"></a>    }</span>
<span id="cb1-151"><a href="#cb1-151"></a>  })</span>
<span id="cb1-152"><a href="#cb1-152"></a>  </span>
<span id="cb1-153"><a href="#cb1-153"></a>}</span>
<span id="cb1-154"><a href="#cb1-154"></a></span>
<span id="cb1-155"><a href="#cb1-155"></a><span class="kw">shinyApp</span>(ui, server)</span></code></pre></div>
<p><img src="./figures/ggLabels.gif" style="width:65.0%" /></p>

        </div>


        <div id="footer">
          Site proudly generated by
          <a href="http://jaspervdj.be/hakyll">Hakyll</a>
        </div>

      </div>

    </div>

    <div class="row">
      <div class="col-sm-12">
        <div id="disqus_thread"></div>
        <div class="pagination">
          <ul>
            <li>
              <a href="http://laustep.github.io/stlahblog/">&#171; Back Home</a>
            </li>
          </ul>
        </div>
      </div>
    </div>
    
  </div>

</body>

<script src="/libraries/bootstrap/bootstrap.min.js"></script>
<script>
  var disqus_developer = 1;
  var disqus_shortname = 'stlapblog';
  // required: replace example with your forum shortname
  /* * * DON'T EDIT BELOW THIS LINE * * */
  (function () {
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = 'https://' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] ||
      document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>
<noscript>Please enable JavaScript to view the
  <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a>
</noscript>
<!-- MathJax: Fall back to local if CDN offline but local image fonts are not supported (saves >100MB) -->
<script type="text/x-mathjax-config" src="/libraries/mathjax/config/TeX-MML-AM_CHTML.js"></script>
<!-- <script>
  window.MathJax || document.write('<script type="text/x-mathjax-config">MathJax.Hub.Config({"HTML-CSS":{imageFont:null}});<\/script><script src="../libraries/mathjax/MathJax.js"><\/script>');
</script> -->


</html>]]></description>
    <pubDate>Mon, 08 Aug 2022 00:00:00 UT</pubDate>
    <guid>https://laustep.github.io/stlahblog/posts/ggplot2_labelling.html</guid>
    <dc:creator>Stéphane Laurent</dc:creator>
    <category>R</category>
</item>



<item>
    <title>Expanding a polynomial with 'caracas', part 2</title>
    <link>https://laustep.github.io/stlahblog/posts/caracas02.html</link>
    <description><![CDATA[<!DOCTYPE HTML>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Saturn Elephant - Expanding a polynomial with 'caracas', part 2</title>
  <link href="/libraries/bootstrap/bootstrap-grid.min.css" rel="stylesheet">
  <link rel="stylesheet" href="/css/default2.css" />
  <link rel="stylesheet" href="/css/post.css" />
  <link rel="stylesheet" href="/css/misc.css" /> 
  
    <link rel="stylesheet" href="/css/pandoc-solarized.css" /> 
   
  
  <link href="https://fonts.googleapis.com/css?family=Raleway:400,600,200,800" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/css?family=Droid+Sans" rel="stylesheet" type="text/css">
  <script src="/libraries/jquery.min.js"></script>
  <script type="text/javascript" async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML"></script>
</head>

<body>
  <div class="container-fluid">
    <div class="row">
      <!-- Sidebar. -->
      <div class="sidebar col-sm-2">
        <div class="row">
          <div class="col-sm-12" style="float:right;clear:both;margin-right:50px;margin-top:50px;">
            <a href="https://www.r-bloggers.com/">
              <img src="/images/Rbloggers.png" alt="Rbloggers" width="100%" />
            </a>
            <br/>
            <a href="http://t-redactyl.io/">
              <span style="color:black;font-weight:bold;font-family:sans-serif;font-size:25px;">Standard error</span>
            </a>
            <a href="http://timelyportfolio.blogspot.be/">
              <span style="color:grey;font-weight:bold;font-family:sans-serif;font-size:24px;">Timely portfolio</span>
            </a>
            <br/>
            <a href="https://antoineguillot.wordpress.com/blog/">
              <span style="color:white;background-color:darkblue;font-weight:bold;font-family:sans-serif;font-size:21px;border:5px solid;border-color:darkblue">ENHANCE DATA</span>
            </a>
            <br/>
            <a href="https://fronkonstin.com/">
              <span style="color:black;background-color:gold;font-weight:bold;font-size:29px;border:3px solid;border-color:gold;">Fronkonstin</span>
            </a>
          </div>
        </div>
        <div id="logos">
          <div class="row">
            <div class="col-sm-4">
              <img src="/images/AsymptoteLogo.svg" style="width: 150%; transform: rotateZ(-35deg)"/>
            </div>
            <div class="col-sm-4">
              <img src="/images/Rlogo.svg" style="width: 110%;"/>
            </div>
            <div class="col-sm-4">
              <img src="/images/shiny-hex.png" style="width: 90%;"/>
            </div>
          </div>
          <div class="row">
            <div class="col-sm-4">
              <img src="/images/Povray_logo_sphere.png" style="width: 105%;"/>
            </div>
            <div class="col-sm-4">
              <img src="/images/javascript.svg" style="width: 90%;"/>
            </div>
            <div class="col-sm-4">
              <img src="/images/haskell.svg" style="width: 110%;"/>
            </div>
          </div>
        </div>
      </div>

      <div class="main col-sm-10">
        <div id="header">
          <div id="logo">
            <a href="/">
              <img src="/images/stla.jpg" alt="stla" width="100px" />
            </a>
          </div>
          <div id="navigation" style="margin-top:50px;">
            <a href="/">Home</a>
            <a href="/about.html">About</a>
            <a href="/contact.html">Contact</a>
            <a href="/archive.html">Archive</a>
          </div>
        </div>

        <div class="content">
          <h1>Expanding a polynomial with 'caracas', part 2</h1> 
          <div class="info">
    Posted on July 16, 2022
    
        by Stéphane Laurent
    
</div>
<div class="info">
    
    Tags: <a title="All pages tagged &#39;R&#39;." href="/tags/R.html">R</a>, <a title="All pages tagged &#39;povray&#39;." href="/tags/povray.html">povray</a>, <a title="All pages tagged &#39;graphics&#39;." href="/tags/graphics.html">graphics</a>, <a title="All pages tagged &#39;maths&#39;." href="/tags/maths.html">maths</a>, <a title="All pages tagged &#39;python&#39;." href="/tags/python.html">python</a>
    
</div>

<p>Last month, I posted an <a href="https://laustep.github.io/stlahblog/posts/caracas01.html">article</a> showing a way to expand a polynomial in R when the coefficients of the polynomial contain some literal values, with the help of the <strong>caracas</strong> package. Today I wanted to apply it with a polynomial expression having about 500 characters, and highly factorized. The method took more than 30 minutes, so I looked for a more efficient one.</p>
<p>Thanks to some help on StackOverflow, I came to the following method which is more efficient. It consists in splitting the expression according to its additive terms and to work on each term, instead of expanding the whole polynomial. In the example below I take the polynomial expression defining the isosurface equation of a Solid Möbius strip.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a><span class="kw">library</span>(caracas)</span>
<span id="cb1-2"><a href="#cb1-2"></a>sympy &lt;-<span class="st"> </span><span class="kw">get_sympy</span>()</span>
<span id="cb1-3"><a href="#cb1-3"></a><span class="co"># define the variables x,y,z and the constants a,b</span></span>
<span id="cb1-4"><a href="#cb1-4"></a><span class="kw">def_sym</span>(x, y, z, a, b)</span>
<span id="cb1-5"><a href="#cb1-5"></a><span class="co"># define expression </span></span>
<span id="cb1-6"><a href="#cb1-6"></a>expr &lt;-<span class="st"> </span>sympy<span class="op">$</span><span class="kw">parse_expr</span>(</span>
<span id="cb1-7"><a href="#cb1-7"></a>  <span class="st">&quot;((x*x+y*y+1)*(a*x*x+b*y*y)+z*z*(b*x*x+a*y*y)-2*(a-b)*x*y*z-a*b*(x*x+y*y))**2-4*(x*x+y*y)*(a*x*x+b*y*y-x*y*z*(a-b))**2&quot;</span></span>
<span id="cb1-8"><a href="#cb1-8"></a>) </span>
<span id="cb1-9"><a href="#cb1-9"></a><span class="co"># extraction of monomials in the &#39;povray&#39; list</span></span>
<span id="cb1-10"><a href="#cb1-10"></a>povray &lt;-<span class="st"> </span><span class="kw">list</span>()</span>
<span id="cb1-11"><a href="#cb1-11"></a>terms &lt;-<span class="st"> </span>sympy<span class="op">$</span>Add<span class="op">$</span><span class="kw">make_args</span>(expr)</span>
<span id="cb1-12"><a href="#cb1-12"></a><span class="cf">for</span>(term <span class="cf">in</span> terms){</span>
<span id="cb1-13"><a href="#cb1-13"></a>  f &lt;-<span class="st"> </span>term<span class="op">$</span><span class="kw">expand</span>()</span>
<span id="cb1-14"><a href="#cb1-14"></a>  fterms &lt;-<span class="st"> </span>sympy<span class="op">$</span>Add<span class="op">$</span><span class="kw">make_args</span>(f)</span>
<span id="cb1-15"><a href="#cb1-15"></a>  <span class="cf">for</span>(fterm <span class="cf">in</span> fterms){</span>
<span id="cb1-16"><a href="#cb1-16"></a>    decomp  &lt;-<span class="st"> </span>fterm<span class="op">$</span><span class="kw">as_coeff_mul</span>(x<span class="op">$</span>pyobj, y<span class="op">$</span>pyobj, z<span class="op">$</span>pyobj)</span>
<span id="cb1-17"><a href="#cb1-17"></a>    coef    &lt;-<span class="st"> </span>decomp[[<span class="dv">1</span>]]</span>
<span id="cb1-18"><a href="#cb1-18"></a>    mono    &lt;-<span class="st"> </span>decomp[[<span class="dv">2</span>]]</span>
<span id="cb1-19"><a href="#cb1-19"></a>    polexpr &lt;-<span class="st"> </span>sympy<span class="op">$</span>Mul<span class="op">$</span><span class="kw">fromiter</span>(mono)</span>
<span id="cb1-20"><a href="#cb1-20"></a>    poly    &lt;-<span class="st"> </span>polexpr<span class="op">$</span><span class="kw">as_poly</span>(x<span class="op">$</span>pyobj, y<span class="op">$</span>pyobj, z<span class="op">$</span>pyobj)</span>
<span id="cb1-21"><a href="#cb1-21"></a>    degree  &lt;-<span class="st"> </span><span class="kw">toString</span>(poly<span class="op">$</span><span class="kw">monoms</span>()[[<span class="dv">1</span>]])</span>
<span id="cb1-22"><a href="#cb1-22"></a>    <span class="cf">if</span>(degree <span class="op">%in%</span><span class="st"> </span><span class="kw">names</span>(povray)){</span>
<span id="cb1-23"><a href="#cb1-23"></a>      povray[[degree]] &lt;-<span class="st"> </span>sympy<span class="op">$</span><span class="kw">Add</span>(povray[[degree]], coef)</span>
<span id="cb1-24"><a href="#cb1-24"></a>    }<span class="cf">else</span>{</span>
<span id="cb1-25"><a href="#cb1-25"></a>      povray[[degree]] &lt;-<span class="st"> </span>coef</span>
<span id="cb1-26"><a href="#cb1-26"></a>    }</span>
<span id="cb1-27"><a href="#cb1-27"></a>  }</span>
<span id="cb1-28"><a href="#cb1-28"></a>}</span>
<span id="cb1-29"><a href="#cb1-29"></a>polynomial &lt;-<span class="st"> </span><span class="kw">vapply</span>(<span class="kw">names</span>(povray), <span class="cf">function</span>(degree){</span>
<span id="cb1-30"><a href="#cb1-30"></a>  coeff &lt;-<span class="st"> </span>povray[[degree]] <span class="op">|</span><span class="er">&gt;</span></span>
<span id="cb1-31"><a href="#cb1-31"></a><span class="st">    </span><span class="kw">gsub</span>(<span class="st">&quot;([ab])</span><span class="ch">\\</span><span class="st">*</span><span class="ch">\\</span><span class="st">*(</span><span class="ch">\\</span><span class="st">d+)&quot;</span>, <span class="st">&quot;pow(</span><span class="ch">\\</span><span class="st">1,</span><span class="ch">\\</span><span class="st">2)&quot;</span>, <span class="dt">x =</span> _)</span>
<span id="cb1-32"><a href="#cb1-32"></a>  <span class="kw">sprintf</span>(<span class="st">&quot;xyz(%s): %s,&quot;</span>, degree, coeff)</span>
<span id="cb1-33"><a href="#cb1-33"></a>}, <span class="kw">character</span>(1L))</span>
<span id="cb1-34"><a href="#cb1-34"></a><span class="kw">cat</span>(polynomial, <span class="dt">sep =</span> <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>, <span class="dt">file =</span> <span class="st">&quot;SolidMobiusStrip.txt&quot;</span>)</span></code></pre></div>
<p>At the last step I use <code>gsub</code> to replace the powers like <code>a**2</code> to their POV-Ray syntax <code>pow(a,2)</code>. The above code writes this POV-Ray code:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode povray"><code class="sourceCode povray"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true"></a>xyz(<span class="fl">4</span>, <span class="fl">0</span>, <span class="fl">0</span>): <span class="kw">pow</span>(a,<span class="fl">2</span>)*<span class="kw">pow</span>(b,<span class="fl">2</span>) - <span class="fl">2</span>*<span class="kw">pow</span>(a,<span class="fl">2</span>)*b + <span class="kw">pow</span>(a,<span class="fl">2</span>),</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true"></a>xyz(<span class="fl">8</span>, <span class="fl">0</span>, <span class="fl">0</span>): <span class="kw">pow</span>(a,<span class="fl">2</span>),</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true"></a>xyz(<span class="fl">0</span>, <span class="fl">4</span>, <span class="fl">0</span>): <span class="kw">pow</span>(a,<span class="fl">2</span>)*<span class="kw">pow</span>(b,<span class="fl">2</span>) - <span class="fl">2</span>*a*<span class="kw">pow</span>(b,<span class="fl">2</span>) + <span class="kw">pow</span>(b,<span class="fl">2</span>),</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true"></a>xyz(<span class="fl">0</span>, <span class="fl">8</span>, <span class="fl">0</span>): <span class="kw">pow</span>(b,<span class="fl">2</span>),</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true"></a>xyz(<span class="fl">6</span>, <span class="fl">0</span>, <span class="fl">0</span>): <span class="fl">-2</span>*<span class="kw">pow</span>(a,<span class="fl">2</span>)*b - <span class="fl">2</span>*<span class="kw">pow</span>(a,<span class="fl">2</span>),</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true"></a>xyz(<span class="fl">0</span>, <span class="fl">6</span>, <span class="fl">0</span>): <span class="fl">-2</span>*a*<span class="kw">pow</span>(b,<span class="fl">2</span>) - <span class="fl">2</span>*<span class="kw">pow</span>(b,<span class="fl">2</span>),</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true"></a>xyz(<span class="fl">4</span>, <span class="fl">4</span>, <span class="fl">0</span>): <span class="kw">pow</span>(a,<span class="fl">2</span>) + <span class="fl">4</span>*a*b + <span class="kw">pow</span>(b,<span class="fl">2</span>),</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true"></a>xyz(<span class="fl">0</span>, <span class="fl">4</span>, <span class="fl">4</span>): <span class="kw">pow</span>(a,<span class="fl">2</span>),</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true"></a>xyz(<span class="fl">4</span>, <span class="fl">0</span>, <span class="fl">4</span>): <span class="kw">pow</span>(b,<span class="fl">2</span>),</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true"></a>xyz(<span class="fl">4</span>, <span class="fl">2</span>, <span class="fl">0</span>): <span class="fl">-4</span>*<span class="kw">pow</span>(a,<span class="fl">2</span>)*b - <span class="fl">2</span>*<span class="kw">pow</span>(a,<span class="fl">2</span>) - <span class="fl">2</span>*a*<span class="kw">pow</span>(b,<span class="fl">2</span>) - <span class="fl">4</span>*a*b,</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true"></a>xyz(<span class="fl">6</span>, <span class="fl">2</span>, <span class="fl">0</span>): <span class="fl">2</span>*<span class="kw">pow</span>(a,<span class="fl">2</span>) + <span class="fl">2</span>*a*b,</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true"></a>xyz(<span class="fl">2</span>, <span class="fl">4</span>, <span class="fl">0</span>): <span class="fl">-2</span>*<span class="kw">pow</span>(a,<span class="fl">2</span>)*b - <span class="fl">4</span>*a*<span class="kw">pow</span>(b,<span class="fl">2</span>) - <span class="fl">4</span>*a*b - <span class="fl">2</span>*<span class="kw">pow</span>(b,<span class="fl">2</span>),</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true"></a>xyz(<span class="fl">2</span>, <span class="fl">6</span>, <span class="fl">0</span>): <span class="fl">2</span>*a*b + <span class="fl">2</span>*<span class="kw">pow</span>(b,<span class="fl">2</span>),</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true"></a>xyz(<span class="fl">1</span>, <span class="fl">3</span>, <span class="fl">3</span>): <span class="fl">-4</span>*<span class="kw">pow</span>(a,<span class="fl">2</span>) + <span class="fl">4</span>*a*b,</span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true"></a>xyz(<span class="fl">3</span>, <span class="fl">1</span>, <span class="fl">1</span>): <span class="fl">4</span>*<span class="kw">pow</span>(a,<span class="fl">2</span>)*b - <span class="fl">4</span>*<span class="kw">pow</span>(a,<span class="fl">2</span>) - <span class="fl">4</span>*a*<span class="kw">pow</span>(b,<span class="fl">2</span>) + <span class="fl">4</span>*a*b,</span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true"></a>xyz(<span class="fl">5</span>, <span class="fl">1</span>, <span class="fl">1</span>): <span class="fl">4</span>*<span class="kw">pow</span>(a,<span class="fl">2</span>) - <span class="fl">4</span>*a*b,</span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true"></a>xyz(<span class="fl">3</span>, <span class="fl">3</span>, <span class="fl">1</span>): <span class="fl">4</span>*<span class="kw">pow</span>(a,<span class="fl">2</span>) - <span class="fl">4</span>*<span class="kw">pow</span>(b,<span class="fl">2</span>),</span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true"></a>xyz(<span class="fl">2</span>, <span class="fl">2</span>, <span class="fl">0</span>): <span class="fl">2</span>*<span class="kw">pow</span>(a,<span class="fl">2</span>)*<span class="kw">pow</span>(b,<span class="fl">2</span>) - <span class="fl">2</span>*<span class="kw">pow</span>(a,<span class="fl">2</span>)*b - <span class="fl">2</span>*a*<span class="kw">pow</span>(b,<span class="fl">2</span>) + <span class="fl">2</span>*a*b,</span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true"></a>xyz(<span class="fl">4</span>, <span class="fl">0</span>, <span class="fl">2</span>): <span class="fl">-2</span>*a*<span class="kw">pow</span>(b,<span class="fl">2</span>) + <span class="fl">2</span>*a*b,</span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true"></a>xyz(<span class="fl">0</span>, <span class="fl">4</span>, <span class="fl">2</span>): <span class="fl">-2</span>*<span class="kw">pow</span>(a,<span class="fl">2</span>)*b + <span class="fl">2</span>*a*b,</span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true"></a>xyz(<span class="fl">6</span>, <span class="fl">0</span>, <span class="fl">2</span>): <span class="fl">2</span>*a*b,</span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true"></a>xyz(<span class="fl">0</span>, <span class="fl">6</span>, <span class="fl">2</span>): <span class="fl">2</span>*a*b,</span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true"></a>xyz(<span class="fl">2</span>, <span class="fl">4</span>, <span class="fl">2</span>): <span class="fl">-2</span>*<span class="kw">pow</span>(a,<span class="fl">2</span>) + <span class="fl">10</span>*a*b - <span class="fl">2</span>*<span class="kw">pow</span>(b,<span class="fl">2</span>),</span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true"></a>xyz(<span class="fl">4</span>, <span class="fl">2</span>, <span class="fl">2</span>): <span class="fl">-2</span>*<span class="kw">pow</span>(a,<span class="fl">2</span>) + <span class="fl">10</span>*a*b - <span class="fl">2</span>*<span class="kw">pow</span>(b,<span class="fl">2</span>),</span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true"></a>xyz(<span class="fl">1</span>, <span class="fl">3</span>, <span class="fl">1</span>): <span class="fl">4</span>*<span class="kw">pow</span>(a,<span class="fl">2</span>)*b - <span class="fl">4</span>*a*<span class="kw">pow</span>(b,<span class="fl">2</span>) - <span class="fl">4</span>*a*b + <span class="fl">4</span>*<span class="kw">pow</span>(b,<span class="fl">2</span>),</span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true"></a>xyz(<span class="fl">1</span>, <span class="fl">5</span>, <span class="fl">1</span>): <span class="fl">4</span>*a*b - <span class="fl">4</span>*<span class="kw">pow</span>(b,<span class="fl">2</span>),</span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true"></a>xyz(<span class="fl">3</span>, <span class="fl">1</span>, <span class="fl">3</span>): <span class="fl">-4</span>*a*b + <span class="fl">4</span>*<span class="kw">pow</span>(b,<span class="fl">2</span>),</span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true"></a>xyz(<span class="fl">2</span>, <span class="fl">2</span>, <span class="fl">2</span>): <span class="fl">-2</span>*<span class="kw">pow</span>(a,<span class="fl">2</span>)*b + <span class="fl">6</span>*<span class="kw">pow</span>(a,<span class="fl">2</span>) - <span class="fl">2</span>*a*<span class="kw">pow</span>(b,<span class="fl">2</span>) - <span class="fl">8</span>*a*b + <span class="fl">6</span>*<span class="kw">pow</span>(b,<span class="fl">2</span>),</span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true"></a>xyz(<span class="fl">2</span>, <span class="fl">2</span>, <span class="fl">4</span>): <span class="fl">2</span>*a*b,</span></code></pre></div>
<p>This is very fast for this example, but it still took 20 minutes with my case, which is a slight modification of an animation by ‘ICN5D’; here it is:</p>
<p><img src="./figures/ICN5D_02.gif" /></p>
<p>The difference with the original animation is that this one uses an <a href="https://laustep.github.io/stlahblog/posts/slicedImplicitHypersurface.html">isoclinic rotation</a> for the animation.</p>

        </div>


        <div id="footer">
          Site proudly generated by
          <a href="http://jaspervdj.be/hakyll">Hakyll</a>
        </div>

      </div>

    </div>

    <div class="row">
      <div class="col-sm-12">
        <div id="disqus_thread"></div>
        <div class="pagination">
          <ul>
            <li>
              <a href="http://laustep.github.io/stlahblog/">&#171; Back Home</a>
            </li>
          </ul>
        </div>
      </div>
    </div>
    
  </div>

</body>

<script src="/libraries/bootstrap/bootstrap.min.js"></script>
<script>
  var disqus_developer = 1;
  var disqus_shortname = 'stlapblog';
  // required: replace example with your forum shortname
  /* * * DON'T EDIT BELOW THIS LINE * * */
  (function () {
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = 'https://' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] ||
      document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>
<noscript>Please enable JavaScript to view the
  <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a>
</noscript>
<!-- MathJax: Fall back to local if CDN offline but local image fonts are not supported (saves >100MB) -->
<script type="text/x-mathjax-config" src="/libraries/mathjax/config/TeX-MML-AM_CHTML.js"></script>
<!-- <script>
  window.MathJax || document.write('<script type="text/x-mathjax-config">MathJax.Hub.Config({"HTML-CSS":{imageFont:null}});<\/script><script src="../libraries/mathjax/MathJax.js"><\/script>');
</script> -->


</html>]]></description>
    <pubDate>Sat, 16 Jul 2022 00:00:00 UT</pubDate>
    <guid>https://laustep.github.io/stlahblog/posts/caracas02.html</guid>
    <dc:creator>Stéphane Laurent</dc:creator>
    <category>R</category>
</item>


<item>
    <title>Slices of an implicit hypersurface with R</title>
    <link>https://laustep.github.io/stlahblog/posts/slicedImplicitHypersurface.html</link>
    <description><![CDATA[<!DOCTYPE HTML>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Saturn Elephant - Slices of an implicit hypersurface with R</title>
  <link href="/libraries/bootstrap/bootstrap-grid.min.css" rel="stylesheet">
  <link rel="stylesheet" href="/css/default2.css" />
  <link rel="stylesheet" href="/css/post.css" />
  <link rel="stylesheet" href="/css/misc.css" /> 
  
    <link rel="stylesheet" href="/css/pandoc-solarized.css" /> 
   
  
  <link href="https://fonts.googleapis.com/css?family=Raleway:400,600,200,800" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/css?family=Droid+Sans" rel="stylesheet" type="text/css">
  <script src="/libraries/jquery.min.js"></script>
  <script type="text/javascript" async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML"></script>
</head>

<body>
  <div class="container-fluid">
    <div class="row">
      <!-- Sidebar. -->
      <div class="sidebar col-sm-2">
        <div class="row">
          <div class="col-sm-12" style="float:right;clear:both;margin-right:50px;margin-top:50px;">
            <a href="https://www.r-bloggers.com/">
              <img src="/images/Rbloggers.png" alt="Rbloggers" width="100%" />
            </a>
            <br/>
            <a href="http://t-redactyl.io/">
              <span style="color:black;font-weight:bold;font-family:sans-serif;font-size:25px;">Standard error</span>
            </a>
            <a href="http://timelyportfolio.blogspot.be/">
              <span style="color:grey;font-weight:bold;font-family:sans-serif;font-size:24px;">Timely portfolio</span>
            </a>
            <br/>
            <a href="https://antoineguillot.wordpress.com/blog/">
              <span style="color:white;background-color:darkblue;font-weight:bold;font-family:sans-serif;font-size:21px;border:5px solid;border-color:darkblue">ENHANCE DATA</span>
            </a>
            <br/>
            <a href="https://fronkonstin.com/">
              <span style="color:black;background-color:gold;font-weight:bold;font-size:29px;border:3px solid;border-color:gold;">Fronkonstin</span>
            </a>
          </div>
        </div>
        <div id="logos">
          <div class="row">
            <div class="col-sm-4">
              <img src="/images/AsymptoteLogo.svg" style="width: 150%; transform: rotateZ(-35deg)"/>
            </div>
            <div class="col-sm-4">
              <img src="/images/Rlogo.svg" style="width: 110%;"/>
            </div>
            <div class="col-sm-4">
              <img src="/images/shiny-hex.png" style="width: 90%;"/>
            </div>
          </div>
          <div class="row">
            <div class="col-sm-4">
              <img src="/images/Povray_logo_sphere.png" style="width: 105%;"/>
            </div>
            <div class="col-sm-4">
              <img src="/images/javascript.svg" style="width: 90%;"/>
            </div>
            <div class="col-sm-4">
              <img src="/images/haskell.svg" style="width: 110%;"/>
            </div>
          </div>
        </div>
      </div>

      <div class="main col-sm-10">
        <div id="header">
          <div id="logo">
            <a href="/">
              <img src="/images/stla.jpg" alt="stla" width="100px" />
            </a>
          </div>
          <div id="navigation" style="margin-top:50px;">
            <a href="/">Home</a>
            <a href="/about.html">About</a>
            <a href="/contact.html">Contact</a>
            <a href="/archive.html">Archive</a>
          </div>
        </div>

        <div class="content">
          <h1>Slices of an implicit hypersurface with R</h1> 
          <div class="info">
    Posted on July 15, 2022
    
        by Stéphane Laurent
    
</div>
<div class="info">
    
    Tags: <a title="All pages tagged &#39;R&#39;." href="/tags/R.html">R</a>, <a title="All pages tagged &#39;graphics&#39;." href="/tags/graphics.html">graphics</a>, <a title="All pages tagged &#39;rgl&#39;." href="/tags/rgl.html">rgl</a>, <a title="All pages tagged &#39;geometry&#39;." href="/tags/geometry.html">geometry</a>, <a title="All pages tagged &#39;maths&#39;." href="/tags/maths.html">maths</a>
    
</div>

<p>In a <a href="https://laustep.github.io/stlahblog/posts/slicedHypersurface.html">previous post</a>, I showed how to draw a 3D slice of a 4D hypersurface when a parameterization of this hypersurface is available. Here we deal with the case when an implicit equation of the hypersurface is available. For the illustration, we again consider the <a href="http://hi.gher.space/wiki/Tiger"><em>tiger</em></a>. It is given by the implicit equation <span class="math display">\[
{\bigl(\sqrt{x^2 + y^2} - R_1\bigr)}^2 + 
{\bigl(\sqrt{z^2 + w^2} - R_2\bigr)}^2 = r^2.
\]</span> We will fix a value of the fourth coordinate <span class="math inline">\(w\)</span>, say <span class="math inline">\(w_0\)</span>. That is to say we deal with the cross-section with the hyperplane <span class="math inline">\(\{w = w_0\}\)</span>. And we will rotate the hypersurface in the 4D space. We use a <a href="https://en.wikipedia.org/wiki/Rotations_in_4-dimensional_Euclidean_space"><em>right-isoclinic</em></a> rotation. The function below performs such a rotation, allowing to pass several input vectors as a matrix.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a><span class="co"># right-isoclinic rotation in 4D space </span></span>
<span id="cb1-2"><a href="#cb1-2"></a><span class="co"># xi is the angle of rotation</span></span>
<span id="cb1-3"><a href="#cb1-3"></a>rotate4d &lt;-<span class="st"> </span><span class="cf">function</span>(alpha, beta, xi, vec){</span>
<span id="cb1-4"><a href="#cb1-4"></a>  a &lt;-<span class="st"> </span><span class="kw">cos</span>(xi)</span>
<span id="cb1-5"><a href="#cb1-5"></a>  b &lt;-<span class="st"> </span><span class="kw">sin</span>(alpha) <span class="op">*</span><span class="st"> </span><span class="kw">cos</span>(beta) <span class="op">*</span><span class="st"> </span><span class="kw">sin</span>(xi)</span>
<span id="cb1-6"><a href="#cb1-6"></a>  c &lt;-<span class="st"> </span><span class="kw">sin</span>(alpha) <span class="op">*</span><span class="st"> </span><span class="kw">sin</span>(beta) <span class="op">*</span><span class="st"> </span><span class="kw">sin</span>(xi)</span>
<span id="cb1-7"><a href="#cb1-7"></a>  d &lt;-<span class="st"> </span><span class="kw">cos</span>(alpha) <span class="op">*</span><span class="st"> </span><span class="kw">sin</span>(xi)</span>
<span id="cb1-8"><a href="#cb1-8"></a>  x &lt;-<span class="st"> </span>vec[, 1L]; y &lt;-<span class="st"> </span>vec[, 2L]; z &lt;-<span class="st"> </span>vec[, 3L]; w &lt;-<span class="st"> </span>vec[, 4L]</span>
<span id="cb1-9"><a href="#cb1-9"></a>  <span class="kw">cbind</span>(</span>
<span id="cb1-10"><a href="#cb1-10"></a>    a<span class="op">*</span>x <span class="op">-</span><span class="st"> </span>b<span class="op">*</span>y <span class="op">-</span><span class="st"> </span>c<span class="op">*</span>z <span class="op">-</span><span class="st"> </span>d<span class="op">*</span>w,</span>
<span id="cb1-11"><a href="#cb1-11"></a>    a<span class="op">*</span>y <span class="op">+</span><span class="st"> </span>b<span class="op">*</span>x <span class="op">+</span><span class="st"> </span>c<span class="op">*</span>w <span class="op">-</span><span class="st"> </span>d<span class="op">*</span>z,</span>
<span id="cb1-12"><a href="#cb1-12"></a>    a<span class="op">*</span>z <span class="op">-</span><span class="st"> </span>b<span class="op">*</span>w <span class="op">+</span><span class="st"> </span>c<span class="op">*</span>x <span class="op">+</span><span class="st"> </span>d<span class="op">*</span>y,</span>
<span id="cb1-13"><a href="#cb1-13"></a>    a<span class="op">*</span>w <span class="op">+</span><span class="st"> </span>b<span class="op">*</span>z <span class="op">-</span><span class="st"> </span>c<span class="op">*</span>y <span class="op">+</span><span class="st"> </span>d<span class="op">*</span>x</span>
<span id="cb1-14"><a href="#cb1-14"></a>  )</span>
<span id="cb1-15"><a href="#cb1-15"></a>}</span></code></pre></div>
<p>So, in the implicit equation we fix <span class="math inline">\(w=w_0\)</span> and we perform the rotation, taking arbitrary values for <span class="math inline">\(\alpha\)</span> and <span class="math inline">\(\beta\)</span>:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1"></a>f &lt;-<span class="st"> </span><span class="cf">function</span>(xyz, w0, xi, <span class="dt">R1 =</span> <span class="dv">3</span>, <span class="dt">R2 =</span> <span class="dv">2</span>, <span class="dt">r =</span> <span class="dv">1</span>){</span>
<span id="cb2-2"><a href="#cb2-2"></a>  rxyzw &lt;-<span class="st"> </span><span class="kw">rotate4d</span>(pi<span class="op">/</span><span class="dv">4</span>, pi<span class="op">/</span><span class="dv">4</span>, xi, <span class="kw">cbind</span>(xyz, w0))</span>
<span id="cb2-3"><a href="#cb2-3"></a>  x &lt;-<span class="st"> </span>rxyzw[, 1L]</span>
<span id="cb2-4"><a href="#cb2-4"></a>  y &lt;-<span class="st"> </span>rxyzw[, 2L]</span>
<span id="cb2-5"><a href="#cb2-5"></a>  z &lt;-<span class="st"> </span>rxyzw[, 3L]</span>
<span id="cb2-6"><a href="#cb2-6"></a>  w &lt;-<span class="st"> </span>rxyzw[, 4L]</span>
<span id="cb2-7"><a href="#cb2-7"></a>  (<span class="kw">sqrt</span>(x<span class="op">^</span><span class="dv">2</span><span class="op">+</span>y<span class="op">^</span><span class="dv">2</span>) <span class="op">-</span><span class="st"> </span>R1)<span class="op">^</span><span class="dv">2</span> <span class="op">+</span><span class="st"> </span>(<span class="kw">sqrt</span>(z<span class="op">^</span><span class="dv">2</span><span class="op">+</span>w<span class="op">^</span><span class="dv">2</span>) <span class="op">-</span><span class="st"> </span>R2)<span class="op">^</span><span class="dv">2</span> <span class="op">-</span><span class="st"> </span>r<span class="op">^</span><span class="dv">2</span></span>
<span id="cb2-8"><a href="#cb2-8"></a>}</span></code></pre></div>
<p>To plot the isosurface, we will use the <strong>rmarchingcubes</strong> package, not only for its speed, but also because it computes an excellent approximation of the per-vertex normals (it approximates the gradient of <span class="math inline">\(f\)</span>). So taking a <span class="math inline">\(150 \times 150 \times 150\)</span> grid is enough to get a smooth surface:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a><span class="co"># make grid ####</span></span>
<span id="cb3-2"><a href="#cb3-2"></a>n &lt;-<span class="st"> </span>150L</span>
<span id="cb3-3"><a href="#cb3-3"></a>x &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="op">-</span><span class="dv">5</span>, <span class="dv">5</span>, <span class="dt">len =</span> n)</span>
<span id="cb3-4"><a href="#cb3-4"></a>y &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="op">-</span><span class="dv">5</span>, <span class="dv">5</span>, <span class="dt">len =</span> n)</span>
<span id="cb3-5"><a href="#cb3-5"></a>z &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="op">-</span><span class="dv">5</span>, <span class="dv">5</span>, <span class="dt">len =</span> n)</span>
<span id="cb3-6"><a href="#cb3-6"></a>Grid &lt;-<span class="st"> </span><span class="kw">expand.grid</span>(<span class="dt">X =</span> x, <span class="dt">Y =</span> y, <span class="dt">Z =</span> z)</span>
<span id="cb3-7"><a href="#cb3-7"></a></span>
<span id="cb3-8"><a href="#cb3-8"></a><span class="co"># run the marching cubes #### </span></span>
<span id="cb3-9"><a href="#cb3-9"></a><span class="kw">library</span>(rmarchingcubes)</span>
<span id="cb3-10"><a href="#cb3-10"></a>voxel &lt;-<span class="st"> </span><span class="kw">array</span>(<span class="kw">f</span>(Grid, <span class="dt">w_0 =</span> <span class="fl">0.3</span>, <span class="dt">xi =</span> pi<span class="op">/</span><span class="dv">3</span>), <span class="dt">dim =</span> <span class="kw">c</span>(n, n, n))</span>
<span id="cb3-11"><a href="#cb3-11"></a>cont &lt;-<span class="st"> </span><span class="kw">contour3d</span>(voxel, <span class="dt">level =</span> <span class="dv">0</span>, <span class="dt">x =</span> x, <span class="dt">y =</span> y, <span class="dt">z =</span> z)</span>
<span id="cb3-12"><a href="#cb3-12"></a></span>
<span id="cb3-13"><a href="#cb3-13"></a><span class="co"># plot #### </span></span>
<span id="cb3-14"><a href="#cb3-14"></a><span class="kw">library</span>(rgl)</span>
<span id="cb3-15"><a href="#cb3-15"></a>mesh &lt;-<span class="st"> </span><span class="kw">tmesh3d</span>(</span>
<span id="cb3-16"><a href="#cb3-16"></a>  <span class="dt">vertices =</span> <span class="kw">t</span>(cont[[<span class="st">&quot;vertices&quot;</span>]]),</span>
<span id="cb3-17"><a href="#cb3-17"></a>  <span class="dt">indices  =</span> <span class="kw">t</span>(cont[[<span class="st">&quot;triangles&quot;</span>]]),</span>
<span id="cb3-18"><a href="#cb3-18"></a>  <span class="dt">normals  =</span> cont[[<span class="st">&quot;normals&quot;</span>]],</span>
<span id="cb3-19"><a href="#cb3-19"></a>  <span class="dt">homogeneous =</span> <span class="ot">FALSE</span></span>
<span id="cb3-20"><a href="#cb3-20"></a>)</span>
<span id="cb3-21"><a href="#cb3-21"></a><span class="kw">open3d</span>(<span class="dt">windowRect =</span> <span class="kw">c</span>(<span class="dv">50</span>, <span class="dv">50</span>, <span class="dv">562</span>, <span class="dv">562</span>), <span class="dt">zoom =</span> <span class="fl">0.8</span>)</span>
<span id="cb3-22"><a href="#cb3-22"></a><span class="kw">bg3d</span>(</span>
<span id="cb3-23"><a href="#cb3-23"></a>  <span class="dt">sphere =</span> <span class="ot">FALSE</span>, <span class="dt">texture =</span> <span class="st">&quot;SpaceBackground.png&quot;</span>, <span class="dt">col =</span> <span class="st">&quot;white&quot;</span></span>
<span id="cb3-24"><a href="#cb3-24"></a>)</span>
<span id="cb3-25"><a href="#cb3-25"></a><span class="kw">shade3d</span>(mesh, <span class="dt">color =</span> <span class="st">&quot;maroon&quot;</span>)</span></code></pre></div>
<p><img src="./figures/tiger01(implicit).png" style="width:50.0%" /></p>
<p>Now let’s make an animation by varying the angle of rotation <span class="math inline">\(\xi\)</span> from <span class="math inline">\(0\)</span> to <span class="math inline">\(\pi\)</span>.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1"></a><span class="co"># vector of angles #### </span></span>
<span id="cb4-2"><a href="#cb4-2"></a>nframes &lt;-<span class="st"> </span>60L</span>
<span id="cb4-3"><a href="#cb4-3"></a>xi_ &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="dv">0</span>, pi, <span class="dt">length.out =</span> nframes)</span>
<span id="cb4-4"><a href="#cb4-4"></a><span class="co"># open the 3D engine #### </span></span>
<span id="cb4-5"><a href="#cb4-5"></a><span class="kw">open3d</span>(</span>
<span id="cb4-6"><a href="#cb4-6"></a>  <span class="dt">windowRect =</span> <span class="kw">c</span>(<span class="dv">50</span>, <span class="dv">50</span>, <span class="dv">562</span>, <span class="dv">562</span>),</span>
<span id="cb4-7"><a href="#cb4-7"></a>  <span class="dt">zoom       =</span> <span class="fl">0.85</span>,</span>
<span id="cb4-8"><a href="#cb4-8"></a>  <span class="dt">userMatrix =</span> <span class="kw">rbind</span>(</span>
<span id="cb4-9"><a href="#cb4-9"></a>    <span class="kw">c</span>(<span class="fl">0.93</span>, <span class="fl">-0.16</span>, <span class="fl">-0.33</span>, <span class="dv">0</span>),</span>
<span id="cb4-10"><a href="#cb4-10"></a>    <span class="kw">c</span>(<span class="fl">0.35</span>,  <span class="fl">0.66</span>,  <span class="fl">0.67</span>, <span class="dv">0</span>),</span>
<span id="cb4-11"><a href="#cb4-11"></a>    <span class="kw">c</span>(<span class="fl">0.11</span>, <span class="fl">-0.74</span>,  <span class="fl">0.67</span>, <span class="dv">0</span>),</span>
<span id="cb4-12"><a href="#cb4-12"></a>    <span class="kw">c</span>(   <span class="dv">0</span>,     <span class="dv">0</span>,     <span class="dv">0</span>, <span class="dv">1</span>)</span>
<span id="cb4-13"><a href="#cb4-13"></a>  )</span>
<span id="cb4-14"><a href="#cb4-14"></a>)</span>
<span id="cb4-15"><a href="#cb4-15"></a><span class="kw">bg3d</span>(</span>
<span id="cb4-16"><a href="#cb4-16"></a>  <span class="dt">sphere =</span> <span class="ot">FALSE</span>, <span class="dt">texture =</span> <span class="st">&quot;SpaceBackground.png&quot;</span>, <span class="dt">col =</span> <span class="st">&quot;white&quot;</span></span>
<span id="cb4-17"><a href="#cb4-17"></a>)</span>
<span id="cb4-18"><a href="#cb4-18"></a><span class="co"># save the frames in png files #### </span></span>
<span id="cb4-19"><a href="#cb4-19"></a><span class="cf">for</span>(i <span class="cf">in</span> 1L<span class="op">:</span>nframes){</span>
<span id="cb4-20"><a href="#cb4-20"></a>  v &lt;-<span class="st"> </span><span class="kw">array</span>(<span class="kw">f</span>(Grid, <span class="dt">w0 =</span> <span class="fl">0.3</span>, <span class="dt">xi =</span> xi_[i]), <span class="dt">dim =</span> <span class="kw">c</span>(n, n, n))</span>
<span id="cb4-21"><a href="#cb4-21"></a>  cont &lt;-<span class="st"> </span><span class="kw">contour3d</span>(v, <span class="dt">level =</span> <span class="dv">0</span>, <span class="dt">x =</span> x, <span class="dt">y =</span> y, <span class="dt">z =</span> z)</span>
<span id="cb4-22"><a href="#cb4-22"></a>  mesh &lt;-<span class="st"> </span><span class="kw">tmesh3d</span>(</span>
<span id="cb4-23"><a href="#cb4-23"></a>    <span class="dt">vertices =</span> <span class="kw">t</span>(cont[[<span class="st">&quot;vertices&quot;</span>]]),</span>
<span id="cb4-24"><a href="#cb4-24"></a>    <span class="dt">indices  =</span> <span class="kw">t</span>(cont[[<span class="st">&quot;triangles&quot;</span>]]),</span>
<span id="cb4-25"><a href="#cb4-25"></a>    <span class="dt">normals  =</span> cont[[<span class="st">&quot;normals&quot;</span>]],</span>
<span id="cb4-26"><a href="#cb4-26"></a>    <span class="dt">homogeneous =</span> <span class="ot">FALSE</span></span>
<span id="cb4-27"><a href="#cb4-27"></a>  )</span>
<span id="cb4-28"><a href="#cb4-28"></a>  <span class="kw">shade3d</span>(mesh, <span class="dt">color =</span> <span class="st">&quot;maroon&quot;</span>)</span>
<span id="cb4-29"><a href="#cb4-29"></a>  <span class="kw">snapshot3d</span>(<span class="kw">sprintf</span>(<span class="st">&quot;zzpic%03d.png&quot;</span>, i), <span class="dt">webshot =</span> <span class="ot">FALSE</span>)</span>
<span id="cb4-30"><a href="#cb4-30"></a>  <span class="kw">clear3d</span>()</span>
<span id="cb4-31"><a href="#cb4-31"></a>}</span>
<span id="cb4-32"><a href="#cb4-32"></a><span class="co"># make the animation with ImageMagick #### </span></span>
<span id="cb4-33"><a href="#cb4-33"></a><span class="co"># option &#39;-duplicate 1,-2-1&#39; to get a forward-backward animation</span></span>
<span id="cb4-34"><a href="#cb4-34"></a>command &lt;-<span class="st"> </span><span class="kw">paste0</span>(</span>
<span id="cb4-35"><a href="#cb4-35"></a>  <span class="st">&quot;magick convert -dispose previous -delay 10 &quot;</span>,</span>
<span id="cb4-36"><a href="#cb4-36"></a>  <span class="st">&quot;-duplicate 1,-2-1 zzpic*.png tiger.gif&quot;</span></span>
<span id="cb4-37"><a href="#cb4-37"></a>)</span>
<span id="cb4-38"><a href="#cb4-38"></a><span class="kw">system</span>(command)</span></code></pre></div>
<p><img src="./figures/tiger01(implicit).gif" style="width:50.0%" /></p>
<p>A similar animation with a more complex surface can be found on <a href="https://www.youtube.com/channel/UCQ2hC8ETS9FFm2pzzyZCVUw/videos">my youtube channel</a>.</p>

        </div>


        <div id="footer">
          Site proudly generated by
          <a href="http://jaspervdj.be/hakyll">Hakyll</a>
        </div>

      </div>

    </div>

    <div class="row">
      <div class="col-sm-12">
        <div id="disqus_thread"></div>
        <div class="pagination">
          <ul>
            <li>
              <a href="http://laustep.github.io/stlahblog/">&#171; Back Home</a>
            </li>
          </ul>
        </div>
      </div>
    </div>
    
  </div>

</body>

<script src="/libraries/bootstrap/bootstrap.min.js"></script>
<script>
  var disqus_developer = 1;
  var disqus_shortname = 'stlapblog';
  // required: replace example with your forum shortname
  /* * * DON'T EDIT BELOW THIS LINE * * */
  (function () {
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = 'https://' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] ||
      document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>
<noscript>Please enable JavaScript to view the
  <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a>
</noscript>
<!-- MathJax: Fall back to local if CDN offline but local image fonts are not supported (saves >100MB) -->
<script type="text/x-mathjax-config" src="/libraries/mathjax/config/TeX-MML-AM_CHTML.js"></script>
<!-- <script>
  window.MathJax || document.write('<script type="text/x-mathjax-config">MathJax.Hub.Config({"HTML-CSS":{imageFont:null}});<\/script><script src="../libraries/mathjax/MathJax.js"><\/script>');
</script> -->


</html>]]></description>
    <pubDate>Fri, 15 Jul 2022 00:00:00 UT</pubDate>
    <guid>https://laustep.github.io/stlahblog/posts/slicedImplicitHypersurface.html</guid>
    <dc:creator>Stéphane Laurent</dc:creator>
    <category>R</category>
</item>


<item>
    <title>Pretty tooltips for 'ggplot2'</title>
    <link>https://laustep.github.io/stlahblog/posts/ggplot2_qTipTooltips.html</link>
    <description><![CDATA[<!DOCTYPE HTML>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Saturn Elephant - Pretty tooltips for 'ggplot2'</title>
  <link href="/libraries/bootstrap/bootstrap-grid.min.css" rel="stylesheet">
  <link rel="stylesheet" href="/css/default2.css" />
  <link rel="stylesheet" href="/css/post.css" />
  <link rel="stylesheet" href="/css/misc.css" /> 
  
    <link rel="stylesheet" href="/css/pandoc-solarized.css" /> 
   
  
  <link href="https://fonts.googleapis.com/css?family=Raleway:400,600,200,800" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/css?family=Droid+Sans" rel="stylesheet" type="text/css">
  <script src="/libraries/jquery.min.js"></script>
  <script type="text/javascript" async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML"></script>
</head>

<body>
  <div class="container-fluid">
    <div class="row">
      <!-- Sidebar. -->
      <div class="sidebar col-sm-2">
        <div class="row">
          <div class="col-sm-12" style="float:right;clear:both;margin-right:50px;margin-top:50px;">
            <a href="https://www.r-bloggers.com/">
              <img src="/images/Rbloggers.png" alt="Rbloggers" width="100%" />
            </a>
            <br/>
            <a href="http://t-redactyl.io/">
              <span style="color:black;font-weight:bold;font-family:sans-serif;font-size:25px;">Standard error</span>
            </a>
            <a href="http://timelyportfolio.blogspot.be/">
              <span style="color:grey;font-weight:bold;font-family:sans-serif;font-size:24px;">Timely portfolio</span>
            </a>
            <br/>
            <a href="https://antoineguillot.wordpress.com/blog/">
              <span style="color:white;background-color:darkblue;font-weight:bold;font-family:sans-serif;font-size:21px;border:5px solid;border-color:darkblue">ENHANCE DATA</span>
            </a>
            <br/>
            <a href="https://fronkonstin.com/">
              <span style="color:black;background-color:gold;font-weight:bold;font-size:29px;border:3px solid;border-color:gold;">Fronkonstin</span>
            </a>
          </div>
        </div>
        <div id="logos">
          <div class="row">
            <div class="col-sm-4">
              <img src="/images/AsymptoteLogo.svg" style="width: 150%; transform: rotateZ(-35deg)"/>
            </div>
            <div class="col-sm-4">
              <img src="/images/Rlogo.svg" style="width: 110%;"/>
            </div>
            <div class="col-sm-4">
              <img src="/images/shiny-hex.png" style="width: 90%;"/>
            </div>
          </div>
          <div class="row">
            <div class="col-sm-4">
              <img src="/images/Povray_logo_sphere.png" style="width: 105%;"/>
            </div>
            <div class="col-sm-4">
              <img src="/images/javascript.svg" style="width: 90%;"/>
            </div>
            <div class="col-sm-4">
              <img src="/images/haskell.svg" style="width: 110%;"/>
            </div>
          </div>
        </div>
      </div>

      <div class="main col-sm-10">
        <div id="header">
          <div id="logo">
            <a href="/">
              <img src="/images/stla.jpg" alt="stla" width="100px" />
            </a>
          </div>
          <div id="navigation" style="margin-top:50px;">
            <a href="/">Home</a>
            <a href="/about.html">About</a>
            <a href="/contact.html">Contact</a>
            <a href="/archive.html">Archive</a>
          </div>
        </div>

        <div class="content">
          <h1>Pretty tooltips for 'ggplot2'</h1> 
          <div class="info">
    Posted on July  3, 2022
    
        by Stéphane Laurent
    
</div>
<div class="info">
    
    Tags: <a title="All pages tagged &#39;R&#39;." href="/tags/R.html">R</a>, <a title="All pages tagged &#39;graphics&#39;." href="/tags/graphics.html">graphics</a>, <a title="All pages tagged &#39;javascript&#39;." href="/tags/javascript.html">javascript</a>, <a title="All pages tagged &#39;shiny&#39;." href="/tags/shiny.html">shiny</a>
    
</div>

<p>Below is a simple example of a ‘ggplot2’ graphic with tooltips in a Shiny application. The tooltips are constructed with the help of the <a href="https://github.com/qTip2/qTip2">qTip2</a> JavaScript library.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a><span class="kw">library</span>(shiny)</span>
<span id="cb1-2"><a href="#cb1-2"></a><span class="kw">library</span>(ggplot2)</span>
<span id="cb1-3"><a href="#cb1-3"></a><span class="kw">library</span>(shinyjs)</span>
<span id="cb1-4"><a href="#cb1-4"></a></span>
<span id="cb1-5"><a href="#cb1-5"></a><span class="kw">set.seed</span>(<span class="dv">666</span>)</span>
<span id="cb1-6"><a href="#cb1-6"></a>dat &lt;-<span class="st"> </span><span class="kw">data.frame</span>(</span>
<span id="cb1-7"><a href="#cb1-7"></a>  <span class="dt">x =</span> <span class="kw">rnorm</span>(<span class="dv">10</span>),</span>
<span id="cb1-8"><a href="#cb1-8"></a>  <span class="dt">y =</span> <span class="kw">rnorm</span>(<span class="dv">10</span>),</span>
<span id="cb1-9"><a href="#cb1-9"></a>  <span class="dt">f =</span> <span class="kw">gl</span>(<span class="dv">2</span>, <span class="dv">5</span>, <span class="dt">labels =</span> <span class="kw">c</span>(<span class="st">&quot;A&quot;</span>, <span class="st">&quot;B&quot;</span>))</span>
<span id="cb1-10"><a href="#cb1-10"></a>)</span>
<span id="cb1-11"><a href="#cb1-11"></a></span>
<span id="cb1-12"><a href="#cb1-12"></a>qTipTemplate &lt;-<span class="st"> &quot;</span></span>
<span id="cb1-13"><a href="#cb1-13"></a><span class="st">$(&#39;#hoverinfo&#39;).qtip({</span></span>
<span id="cb1-14"><a href="#cb1-14"></a><span class="st">  overwrite: true,</span></span>
<span id="cb1-15"><a href="#cb1-15"></a><span class="st">  content: {</span></span>
<span id="cb1-16"><a href="#cb1-16"></a><span class="st">    text: $(&#39;#tooltiptext&#39;).clone()</span></span>
<span id="cb1-17"><a href="#cb1-17"></a><span class="st">  },</span></span>
<span id="cb1-18"><a href="#cb1-18"></a><span class="st">  position: {</span></span>
<span id="cb1-19"><a href="#cb1-19"></a><span class="st">    my: &#39;%s&#39;,</span></span>
<span id="cb1-20"><a href="#cb1-20"></a><span class="st">    at: &#39;%s&#39;,</span></span>
<span id="cb1-21"><a href="#cb1-21"></a><span class="st">    target: [%s, %s],</span></span>
<span id="cb1-22"><a href="#cb1-22"></a><span class="st">    container: $(&#39;#ggplot&#39;)</span></span>
<span id="cb1-23"><a href="#cb1-23"></a><span class="st">  },</span></span>
<span id="cb1-24"><a href="#cb1-24"></a><span class="st">  show: {</span></span>
<span id="cb1-25"><a href="#cb1-25"></a><span class="st">    ready: true</span></span>
<span id="cb1-26"><a href="#cb1-26"></a><span class="st">  },</span></span>
<span id="cb1-27"><a href="#cb1-27"></a><span class="st">  hide: {</span></span>
<span id="cb1-28"><a href="#cb1-28"></a><span class="st">    event: false,</span></span>
<span id="cb1-29"><a href="#cb1-29"></a><span class="st">    inactive: 4000</span></span>
<span id="cb1-30"><a href="#cb1-30"></a><span class="st">  },</span></span>
<span id="cb1-31"><a href="#cb1-31"></a><span class="st">  style: {</span></span>
<span id="cb1-32"><a href="#cb1-32"></a><span class="st">    classes: &#39;myqtip&#39;</span></span>
<span id="cb1-33"><a href="#cb1-33"></a><span class="st">  }</span></span>
<span id="cb1-34"><a href="#cb1-34"></a><span class="st">});</span></span>
<span id="cb1-35"><a href="#cb1-35"></a><span class="st">&quot;</span></span>
<span id="cb1-36"><a href="#cb1-36"></a></span>
<span id="cb1-37"><a href="#cb1-37"></a>ui &lt;-<span class="st"> </span><span class="kw">basicPage</span>(</span>
<span id="cb1-38"><a href="#cb1-38"></a>  <span class="kw">useShinyjs</span>(),</span>
<span id="cb1-39"><a href="#cb1-39"></a>  tags<span class="op">$</span><span class="kw">head</span>(</span>
<span id="cb1-40"><a href="#cb1-40"></a>    tags<span class="op">$</span><span class="kw">link</span>(<span class="dt">rel =</span> <span class="st">&quot;stylesheet&quot;</span>, <span class="dt">href =</span> <span class="st">&quot;jquery.qtip.css&quot;</span>),</span>
<span id="cb1-41"><a href="#cb1-41"></a>    tags<span class="op">$</span><span class="kw">script</span>(<span class="dt">src =</span> <span class="st">&quot;jquery.qtip.js&quot;</span>),</span>
<span id="cb1-42"><a href="#cb1-42"></a>    tags<span class="op">$</span><span class="kw">style</span>(<span class="st">&quot;</span></span>
<span id="cb1-43"><a href="#cb1-43"></a><span class="st">      .myqtip {</span></span>
<span id="cb1-44"><a href="#cb1-44"></a><span class="st">        font-size: 15px;</span></span>
<span id="cb1-45"><a href="#cb1-45"></a><span class="st">        line-height: 18px;</span></span>
<span id="cb1-46"><a href="#cb1-46"></a><span class="st">        background-color: rgba(245, 245, 245, 0.8);</span></span>
<span id="cb1-47"><a href="#cb1-47"></a><span class="st">        border-color: rgb(54, 57, 64);</span></span>
<span id="cb1-48"><a href="#cb1-48"></a><span class="st">      }&quot;</span>)</span>
<span id="cb1-49"><a href="#cb1-49"></a>  ),</span>
<span id="cb1-50"><a href="#cb1-50"></a>  <span class="kw">div</span>(</span>
<span id="cb1-51"><a href="#cb1-51"></a>    <span class="dt">id =</span> <span class="st">&quot;tooltiptext&quot;</span>, <span class="dt">style =</span> <span class="st">&quot;display: none;&quot;</span></span>
<span id="cb1-52"><a href="#cb1-52"></a>  ),</span>
<span id="cb1-53"><a href="#cb1-53"></a>  <span class="kw">br</span>(),</span>
<span id="cb1-54"><a href="#cb1-54"></a>  <span class="kw">div</span>(</span>
<span id="cb1-55"><a href="#cb1-55"></a>    <span class="dt">style =</span> <span class="st">&quot;position: relative;&quot;</span>,</span>
<span id="cb1-56"><a href="#cb1-56"></a>    <span class="kw">plotOutput</span>(<span class="st">&quot;ggplot&quot;</span>, <span class="dt">hover =</span> <span class="kw">hoverOpts</span>(<span class="st">&quot;plot_hover&quot;</span>)),</span>
<span id="cb1-57"><a href="#cb1-57"></a>    <span class="kw">div</span>(<span class="dt">id =</span> <span class="st">&quot;hoverinfo&quot;</span>, <span class="dt">style =</span> <span class="st">&quot;position: absolute;&quot;</span>)</span>
<span id="cb1-58"><a href="#cb1-58"></a>  )</span>
<span id="cb1-59"><a href="#cb1-59"></a>)</span>
<span id="cb1-60"><a href="#cb1-60"></a></span>
<span id="cb1-61"><a href="#cb1-61"></a>server &lt;-<span class="st"> </span><span class="cf">function</span>(input, output, session) {</span>
<span id="cb1-62"><a href="#cb1-62"></a>  output<span class="op">$</span>ggplot &lt;-<span class="st"> </span><span class="kw">renderPlot</span>(</span>
<span id="cb1-63"><a href="#cb1-63"></a>    <span class="kw">ggplot</span>(dat, <span class="kw">aes</span>(<span class="dt">x =</span> x, <span class="dt">y =</span> y)) <span class="op">+</span></span>
<span id="cb1-64"><a href="#cb1-64"></a><span class="st">      </span><span class="kw">geom_point</span>(<span class="dt">size =</span> <span class="dv">6</span>) <span class="op">+</span></span>
<span id="cb1-65"><a href="#cb1-65"></a><span class="st">      </span><span class="kw">theme</span>(</span>
<span id="cb1-66"><a href="#cb1-66"></a>        <span class="dt">panel.background =</span> <span class="kw">element_rect</span>(<span class="dt">fill =</span> <span class="st">&quot;#FFCF9E&quot;</span>),</span>
<span id="cb1-67"><a href="#cb1-67"></a>        <span class="dt">axis.title =</span> <span class="kw">element_text</span>(<span class="dt">size =</span> <span class="dv">19</span>),</span>
<span id="cb1-68"><a href="#cb1-68"></a>        <span class="dt">axis.text =</span> <span class="kw">element_text</span>(<span class="dt">size =</span> <span class="dv">16</span>)</span>
<span id="cb1-69"><a href="#cb1-69"></a>      )</span>
<span id="cb1-70"><a href="#cb1-70"></a>  )</span>
<span id="cb1-71"><a href="#cb1-71"></a></span>
<span id="cb1-72"><a href="#cb1-72"></a>  <span class="kw">observeEvent</span>(input[[<span class="st">&quot;plot_hover&quot;</span>]], {</span>
<span id="cb1-73"><a href="#cb1-73"></a>    <span class="cf">if</span>(<span class="kw">is.null</span>(hover &lt;-<span class="st"> </span>input[[<span class="st">&quot;plot_hover&quot;</span>]])) {</span>
<span id="cb1-74"><a href="#cb1-74"></a>      <span class="kw">return</span>(<span class="ot">NULL</span>)</span>
<span id="cb1-75"><a href="#cb1-75"></a>    }</span>
<span id="cb1-76"><a href="#cb1-76"></a>    point &lt;-<span class="st"> </span><span class="kw">nearPoints</span>(dat, hover, <span class="dt">threshold =</span> <span class="dv">15</span>, <span class="dt">maxpoints =</span> 1L)</span>
<span id="cb1-77"><a href="#cb1-77"></a>    <span class="cf">if</span>(<span class="kw">nrow</span>(point) <span class="op">==</span><span class="st"> </span>0L) {</span>
<span id="cb1-78"><a href="#cb1-78"></a>      <span class="kw">return</span>(<span class="ot">NULL</span>)</span>
<span id="cb1-79"><a href="#cb1-79"></a>    }</span>
<span id="cb1-80"><a href="#cb1-80"></a>    left_pct &lt;-</span>
<span id="cb1-81"><a href="#cb1-81"></a><span class="st">      </span>(point[[<span class="st">&quot;x&quot;</span>]] <span class="op">-</span><span class="st"> </span>hover<span class="op">$</span>domain<span class="op">$</span>left) <span class="op">/</span></span>
<span id="cb1-82"><a href="#cb1-82"></a><span class="st">        </span>(hover<span class="op">$</span>domain<span class="op">$</span>right <span class="op">-</span><span class="st"> </span>hover<span class="op">$</span>domain<span class="op">$</span>left)</span>
<span id="cb1-83"><a href="#cb1-83"></a>    top_pct &lt;-</span>
<span id="cb1-84"><a href="#cb1-84"></a><span class="st">      </span>(hover<span class="op">$</span>domain<span class="op">$</span>top <span class="op">-</span><span class="st"> </span>point[[<span class="st">&quot;y&quot;</span>]]) <span class="op">/</span></span>
<span id="cb1-85"><a href="#cb1-85"></a><span class="st">        </span>(hover<span class="op">$</span>domain<span class="op">$</span>top <span class="op">-</span><span class="st"> </span>hover<span class="op">$</span>domain<span class="op">$</span>bottom)</span>
<span id="cb1-86"><a href="#cb1-86"></a>    left_px &lt;-</span>
<span id="cb1-87"><a href="#cb1-87"></a><span class="st">      </span>(hover<span class="op">$</span>range<span class="op">$</span>left <span class="op">+</span><span class="st"> </span>left_pct <span class="op">*</span><span class="st"> </span>(hover<span class="op">$</span>range<span class="op">$</span>right <span class="op">-</span><span class="st"> </span>hover<span class="op">$</span>range<span class="op">$</span>left)) <span class="op">/</span></span>
<span id="cb1-88"><a href="#cb1-88"></a><span class="st">        </span>hover<span class="op">$</span>img_css_ratio<span class="op">$</span>x</span>
<span id="cb1-89"><a href="#cb1-89"></a>    top_px &lt;-</span>
<span id="cb1-90"><a href="#cb1-90"></a><span class="st">      </span>(hover<span class="op">$</span>range<span class="op">$</span>top <span class="op">+</span><span class="st"> </span>top_pct <span class="op">*</span><span class="st"> </span>(hover<span class="op">$</span>range<span class="op">$</span>bottom <span class="op">-</span><span class="st"> </span>hover<span class="op">$</span>range<span class="op">$</span>top)) <span class="op">/</span></span>
<span id="cb1-91"><a href="#cb1-91"></a><span class="st">        </span>hover<span class="op">$</span>img_css_ratio<span class="op">$</span>y</span>
<span id="cb1-92"><a href="#cb1-92"></a>    pos &lt;-<span class="st"> </span><span class="kw">ifelse</span>(left_pct <span class="op">&lt;</span><span class="st"> </span><span class="fl">0.5</span>,</span>
<span id="cb1-93"><a href="#cb1-93"></a>      <span class="kw">ifelse</span>(top_pct <span class="op">&lt;</span><span class="st"> </span><span class="fl">0.5</span>,</span>
<span id="cb1-94"><a href="#cb1-94"></a>        <span class="st">&quot;top left&quot;</span>,</span>
<span id="cb1-95"><a href="#cb1-95"></a>        <span class="st">&quot;bottom left&quot;</span></span>
<span id="cb1-96"><a href="#cb1-96"></a>      ),</span>
<span id="cb1-97"><a href="#cb1-97"></a>      <span class="kw">ifelse</span>(top_pct <span class="op">&lt;</span><span class="st"> </span><span class="fl">0.5</span>,</span>
<span id="cb1-98"><a href="#cb1-98"></a>        <span class="st">&quot;top right&quot;</span>,</span>
<span id="cb1-99"><a href="#cb1-99"></a>        <span class="st">&quot;bottom right&quot;</span></span>
<span id="cb1-100"><a href="#cb1-100"></a>      )</span>
<span id="cb1-101"><a href="#cb1-101"></a>    )</span>
<span id="cb1-102"><a href="#cb1-102"></a>    tooltip &lt;-<span class="st"> </span><span class="kw">paste0</span>(</span>
<span id="cb1-103"><a href="#cb1-103"></a>      <span class="st">&quot;&lt;b&gt; x: &lt;/b&gt;&quot;</span>, <span class="kw">formatC</span>(point[[<span class="st">&quot;x&quot;</span>]]), <span class="st">&quot;&lt;br/&gt;&quot;</span>,</span>
<span id="cb1-104"><a href="#cb1-104"></a>      <span class="st">&quot;&lt;b&gt; y: &lt;/b&gt;&quot;</span>, <span class="kw">formatC</span>(point[[<span class="st">&quot;y&quot;</span>]]), <span class="st">&quot;&lt;br/&gt;&quot;</span>,</span>
<span id="cb1-105"><a href="#cb1-105"></a>      <span class="st">&quot;&lt;b&gt; f: &lt;/b&gt;&quot;</span>, <span class="kw">as.character</span>(point[[<span class="st">&quot;f&quot;</span>]])</span>
<span id="cb1-106"><a href="#cb1-106"></a>    )</span>
<span id="cb1-107"><a href="#cb1-107"></a>    <span class="kw">runjs</span>(</span>
<span id="cb1-108"><a href="#cb1-108"></a>      <span class="kw">paste0</span>(</span>
<span id="cb1-109"><a href="#cb1-109"></a>        <span class="kw">sprintf</span>(</span>
<span id="cb1-110"><a href="#cb1-110"></a>          <span class="st">&quot;$(&#39;#tooltiptext&#39;).html(&#39;%s&#39;);&quot;</span>, tooltip</span>
<span id="cb1-111"><a href="#cb1-111"></a>        ),</span>
<span id="cb1-112"><a href="#cb1-112"></a>        <span class="kw">sprintf</span>(qTipTemplate, pos, pos, left_px, top_px)</span>
<span id="cb1-113"><a href="#cb1-113"></a>      )</span>
<span id="cb1-114"><a href="#cb1-114"></a>    )</span>
<span id="cb1-115"><a href="#cb1-115"></a>  })</span>
<span id="cb1-116"><a href="#cb1-116"></a>}</span>
<span id="cb1-117"><a href="#cb1-117"></a></span>
<span id="cb1-118"><a href="#cb1-118"></a><span class="kw">shinyApp</span>(ui, server)</span></code></pre></div>
<p><img src="./figures/ggplot2_qTipTooltips.gif" style="width:65.0%" /></p>
<p>We can easily set some colors with the help of CSS classes:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1"></a><span class="kw">set.seed</span>(<span class="dv">666</span>)</span>
<span id="cb2-2"><a href="#cb2-2"></a>dat &lt;-<span class="st"> </span><span class="kw">data.frame</span>(</span>
<span id="cb2-3"><a href="#cb2-3"></a>  <span class="dt">x =</span> <span class="kw">c</span>(<span class="kw">rnorm</span>(<span class="dv">10</span>, <span class="dv">0</span>), <span class="kw">rnorm</span>(<span class="dv">10</span>, <span class="dv">2</span>), <span class="kw">rnorm</span>(<span class="dv">10</span>, <span class="dv">4</span>)),</span>
<span id="cb2-4"><a href="#cb2-4"></a>  <span class="dt">y =</span> <span class="kw">c</span>(<span class="kw">rnorm</span>(<span class="dv">10</span>, <span class="dv">0</span>), <span class="kw">rnorm</span>(<span class="dv">10</span>, <span class="dv">2</span>), <span class="kw">rnorm</span>(<span class="dv">10</span>, <span class="dv">4</span>)),</span>
<span id="cb2-5"><a href="#cb2-5"></a>  <span class="dt">f =</span> <span class="kw">gl</span>(<span class="dv">3</span>, <span class="dv">10</span>, <span class="dt">labels =</span> <span class="kw">c</span>(<span class="st">&quot;A&quot;</span>, <span class="st">&quot;B&quot;</span>, <span class="st">&quot;C&quot;</span>))</span>
<span id="cb2-6"><a href="#cb2-6"></a>)</span>
<span id="cb2-7"><a href="#cb2-7"></a></span>
<span id="cb2-8"><a href="#cb2-8"></a>qTipTemplate &lt;-<span class="st"> &quot;</span></span>
<span id="cb2-9"><a href="#cb2-9"></a><span class="st">$(&#39;#hoverinfo&#39;).qtip({</span></span>
<span id="cb2-10"><a href="#cb2-10"></a><span class="st">  overwrite: true,</span></span>
<span id="cb2-11"><a href="#cb2-11"></a><span class="st">  content: {</span></span>
<span id="cb2-12"><a href="#cb2-12"></a><span class="st">    text: $(&#39;#tooltiptext&#39;).clone()</span></span>
<span id="cb2-13"><a href="#cb2-13"></a><span class="st">  },</span></span>
<span id="cb2-14"><a href="#cb2-14"></a><span class="st">  position: {</span></span>
<span id="cb2-15"><a href="#cb2-15"></a><span class="st">    my: &#39;%s&#39;,</span></span>
<span id="cb2-16"><a href="#cb2-16"></a><span class="st">    at: &#39;%s&#39;,</span></span>
<span id="cb2-17"><a href="#cb2-17"></a><span class="st">    target: [%s, %s],</span></span>
<span id="cb2-18"><a href="#cb2-18"></a><span class="st">    container: $(&#39;#ggplot&#39;)</span></span>
<span id="cb2-19"><a href="#cb2-19"></a><span class="st">  },</span></span>
<span id="cb2-20"><a href="#cb2-20"></a><span class="st">  show: {</span></span>
<span id="cb2-21"><a href="#cb2-21"></a><span class="st">    ready: true</span></span>
<span id="cb2-22"><a href="#cb2-22"></a><span class="st">  },</span></span>
<span id="cb2-23"><a href="#cb2-23"></a><span class="st">  hide: {</span></span>
<span id="cb2-24"><a href="#cb2-24"></a><span class="st">    event: false,</span></span>
<span id="cb2-25"><a href="#cb2-25"></a><span class="st">    inactive: 4000</span></span>
<span id="cb2-26"><a href="#cb2-26"></a><span class="st">  },</span></span>
<span id="cb2-27"><a href="#cb2-27"></a><span class="st">  style: {</span></span>
<span id="cb2-28"><a href="#cb2-28"></a><span class="st">    classes: &#39;myqtip %s&#39;</span></span>
<span id="cb2-29"><a href="#cb2-29"></a><span class="st">  }</span></span>
<span id="cb2-30"><a href="#cb2-30"></a><span class="st">});</span></span>
<span id="cb2-31"><a href="#cb2-31"></a><span class="st">&quot;</span></span>
<span id="cb2-32"><a href="#cb2-32"></a></span>
<span id="cb2-33"><a href="#cb2-33"></a>ui &lt;-<span class="st"> </span><span class="kw">basicPage</span>(</span>
<span id="cb2-34"><a href="#cb2-34"></a>  <span class="kw">useShinyjs</span>(),</span>
<span id="cb2-35"><a href="#cb2-35"></a>  tags<span class="op">$</span><span class="kw">head</span>(</span>
<span id="cb2-36"><a href="#cb2-36"></a>    tags<span class="op">$</span><span class="kw">link</span>(<span class="dt">rel =</span> <span class="st">&quot;stylesheet&quot;</span>, <span class="dt">href =</span> <span class="st">&quot;jquery.qtip.css&quot;</span>),</span>
<span id="cb2-37"><a href="#cb2-37"></a>    tags<span class="op">$</span><span class="kw">script</span>(<span class="dt">src =</span> <span class="st">&quot;jquery.qtip.js&quot;</span>),</span>
<span id="cb2-38"><a href="#cb2-38"></a>    tags<span class="op">$</span><span class="kw">style</span>(<span class="st">&quot;</span></span>
<span id="cb2-39"><a href="#cb2-39"></a><span class="st">      .myqtip {</span></span>
<span id="cb2-40"><a href="#cb2-40"></a><span class="st">        font-size: 15px;</span></span>
<span id="cb2-41"><a href="#cb2-41"></a><span class="st">        line-height: 18px;</span></span>
<span id="cb2-42"><a href="#cb2-42"></a><span class="st">        color: white;</span></span>
<span id="cb2-43"><a href="#cb2-43"></a><span class="st">        border-color: rgb(54, 57, 64);</span></span>
<span id="cb2-44"><a href="#cb2-44"></a><span class="st">      }</span></span>
<span id="cb2-45"><a href="#cb2-45"></a><span class="st">      .darkred {</span></span>
<span id="cb2-46"><a href="#cb2-46"></a><span class="st">        background-color: rgba(139, 0, 0, 0.8);</span></span>
<span id="cb2-47"><a href="#cb2-47"></a><span class="st">      }</span></span>
<span id="cb2-48"><a href="#cb2-48"></a><span class="st">      .darkgreen {</span></span>
<span id="cb2-49"><a href="#cb2-49"></a><span class="st">        background-color: rgba(0, 100, 0, 0.8);</span></span>
<span id="cb2-50"><a href="#cb2-50"></a><span class="st">      }</span></span>
<span id="cb2-51"><a href="#cb2-51"></a><span class="st">      .darkblue {</span></span>
<span id="cb2-52"><a href="#cb2-52"></a><span class="st">        background-color: rgba(0, 0, 139, 0.8);</span></span>
<span id="cb2-53"><a href="#cb2-53"></a><span class="st">      }</span></span>
<span id="cb2-54"><a href="#cb2-54"></a><span class="st">      &quot;</span>)</span>
<span id="cb2-55"><a href="#cb2-55"></a>  ),</span>
<span id="cb2-56"><a href="#cb2-56"></a>  <span class="kw">div</span>(</span>
<span id="cb2-57"><a href="#cb2-57"></a>    <span class="dt">id =</span> <span class="st">&quot;tooltiptext&quot;</span>, <span class="dt">style =</span> <span class="st">&quot;display: none;&quot;</span></span>
<span id="cb2-58"><a href="#cb2-58"></a>  ),</span>
<span id="cb2-59"><a href="#cb2-59"></a>  <span class="kw">br</span>(),</span>
<span id="cb2-60"><a href="#cb2-60"></a>  <span class="kw">div</span>(</span>
<span id="cb2-61"><a href="#cb2-61"></a>    <span class="dt">style =</span> <span class="st">&quot;position: relative;&quot;</span>,</span>
<span id="cb2-62"><a href="#cb2-62"></a>    <span class="kw">plotOutput</span>(<span class="st">&quot;ggplot&quot;</span>, <span class="dt">hover =</span> <span class="kw">hoverOpts</span>(<span class="st">&quot;plot_hover&quot;</span>)),</span>
<span id="cb2-63"><a href="#cb2-63"></a>    <span class="kw">div</span>(<span class="dt">id =</span> <span class="st">&quot;hoverinfo&quot;</span>, <span class="dt">style =</span> <span class="st">&quot;position: absolute;&quot;</span>)</span>
<span id="cb2-64"><a href="#cb2-64"></a>  )</span>
<span id="cb2-65"><a href="#cb2-65"></a>)</span>
<span id="cb2-66"><a href="#cb2-66"></a></span>
<span id="cb2-67"><a href="#cb2-67"></a>server &lt;-<span class="st"> </span><span class="cf">function</span>(input, output, session) {</span>
<span id="cb2-68"><a href="#cb2-68"></a>  output<span class="op">$</span>ggplot &lt;-<span class="st"> </span><span class="kw">renderPlot</span>(</span>
<span id="cb2-69"><a href="#cb2-69"></a>    <span class="kw">ggplot</span>(dat, <span class="kw">aes</span>(<span class="dt">x =</span> x, <span class="dt">y =</span> y, <span class="dt">color =</span> f)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>(<span class="dt">size =</span> <span class="dv">4</span>) <span class="op">+</span></span>
<span id="cb2-70"><a href="#cb2-70"></a><span class="st">      </span><span class="kw">scale_color_manual</span>(</span>
<span id="cb2-71"><a href="#cb2-71"></a>        <span class="dt">values =</span> <span class="kw">c</span>(<span class="st">&quot;darkred&quot;</span>, <span class="st">&quot;darkgreen&quot;</span>, <span class="st">&quot;darkblue&quot;</span>)</span>
<span id="cb2-72"><a href="#cb2-72"></a>      ) <span class="op">+</span></span>
<span id="cb2-73"><a href="#cb2-73"></a><span class="st">      </span><span class="kw">theme</span>(</span>
<span id="cb2-74"><a href="#cb2-74"></a>        <span class="dt">panel.background =</span> <span class="kw">element_rect</span>(<span class="dt">fill =</span> <span class="st">&quot;gainsboro&quot;</span>),</span>
<span id="cb2-75"><a href="#cb2-75"></a>        <span class="dt">axis.title =</span> <span class="kw">element_text</span>(<span class="dt">size =</span> <span class="dv">19</span>),</span>
<span id="cb2-76"><a href="#cb2-76"></a>        <span class="dt">axis.text =</span> <span class="kw">element_text</span>(<span class="dt">size =</span> <span class="dv">16</span>),</span>
<span id="cb2-77"><a href="#cb2-77"></a>        <span class="dt">legend.title =</span> <span class="kw">element_text</span>(<span class="dt">size =</span> <span class="dv">18</span>),</span>
<span id="cb2-78"><a href="#cb2-78"></a>        <span class="dt">legend.text =</span> <span class="kw">element_text</span>(<span class="dt">size =</span> <span class="dv">15</span>),</span>
<span id="cb2-79"><a href="#cb2-79"></a>        <span class="dt">legend.key.size =</span> <span class="kw">unit</span>(<span class="dv">4</span>, <span class="st">&quot;points&quot;</span>)</span>
<span id="cb2-80"><a href="#cb2-80"></a>      )</span>
<span id="cb2-81"><a href="#cb2-81"></a>  )</span>
<span id="cb2-82"><a href="#cb2-82"></a></span>
<span id="cb2-83"><a href="#cb2-83"></a>  <span class="kw">observeEvent</span>(input[[<span class="st">&quot;plot_hover&quot;</span>]], {</span>
<span id="cb2-84"><a href="#cb2-84"></a>    <span class="cf">if</span>(<span class="kw">is.null</span>(hover &lt;-<span class="st"> </span>input[[<span class="st">&quot;plot_hover&quot;</span>]])) {</span>
<span id="cb2-85"><a href="#cb2-85"></a>      <span class="kw">return</span>(<span class="ot">NULL</span>)</span>
<span id="cb2-86"><a href="#cb2-86"></a>    }</span>
<span id="cb2-87"><a href="#cb2-87"></a>    point &lt;-<span class="st"> </span><span class="kw">nearPoints</span>(dat, hover, <span class="dt">threshold =</span> <span class="dv">15</span>, <span class="dt">maxpoints =</span> 1L)</span>
<span id="cb2-88"><a href="#cb2-88"></a>    <span class="cf">if</span>(<span class="kw">nrow</span>(point) <span class="op">==</span><span class="st"> </span>0L) {</span>
<span id="cb2-89"><a href="#cb2-89"></a>      <span class="kw">return</span>(<span class="ot">NULL</span>)</span>
<span id="cb2-90"><a href="#cb2-90"></a>    }</span>
<span id="cb2-91"><a href="#cb2-91"></a>    left_pct &lt;-</span>
<span id="cb2-92"><a href="#cb2-92"></a><span class="st">      </span>(point[[<span class="st">&quot;x&quot;</span>]] <span class="op">-</span><span class="st"> </span>hover<span class="op">$</span>domain<span class="op">$</span>left) <span class="op">/</span></span>
<span id="cb2-93"><a href="#cb2-93"></a><span class="st">        </span>(hover<span class="op">$</span>domain<span class="op">$</span>right <span class="op">-</span><span class="st"> </span>hover<span class="op">$</span>domain<span class="op">$</span>left)</span>
<span id="cb2-94"><a href="#cb2-94"></a>    top_pct &lt;-</span>
<span id="cb2-95"><a href="#cb2-95"></a><span class="st">      </span>(hover<span class="op">$</span>domain<span class="op">$</span>top <span class="op">-</span><span class="st"> </span>point[[<span class="st">&quot;y&quot;</span>]]) <span class="op">/</span></span>
<span id="cb2-96"><a href="#cb2-96"></a><span class="st">        </span>(hover<span class="op">$</span>domain<span class="op">$</span>top <span class="op">-</span><span class="st"> </span>hover<span class="op">$</span>domain<span class="op">$</span>bottom)</span>
<span id="cb2-97"><a href="#cb2-97"></a>    left_px &lt;-</span>
<span id="cb2-98"><a href="#cb2-98"></a><span class="st">      </span>(hover<span class="op">$</span>range<span class="op">$</span>left <span class="op">+</span><span class="st"> </span>left_pct <span class="op">*</span><span class="st"> </span>(hover<span class="op">$</span>range<span class="op">$</span>right <span class="op">-</span><span class="st"> </span>hover<span class="op">$</span>range<span class="op">$</span>left)) <span class="op">/</span></span>
<span id="cb2-99"><a href="#cb2-99"></a><span class="st">        </span>hover<span class="op">$</span>img_css_ratio<span class="op">$</span>x</span>
<span id="cb2-100"><a href="#cb2-100"></a>    top_px &lt;-</span>
<span id="cb2-101"><a href="#cb2-101"></a><span class="st">      </span>(hover<span class="op">$</span>range<span class="op">$</span>top <span class="op">+</span><span class="st"> </span>top_pct <span class="op">*</span><span class="st"> </span>(hover<span class="op">$</span>range<span class="op">$</span>bottom <span class="op">-</span><span class="st"> </span>hover<span class="op">$</span>range<span class="op">$</span>top)) <span class="op">/</span></span>
<span id="cb2-102"><a href="#cb2-102"></a><span class="st">        </span>hover<span class="op">$</span>img_css_ratio<span class="op">$</span>y</span>
<span id="cb2-103"><a href="#cb2-103"></a>    pos &lt;-<span class="st"> </span><span class="kw">ifelse</span>(left_pct <span class="op">&lt;</span><span class="st"> </span><span class="fl">0.5</span>,</span>
<span id="cb2-104"><a href="#cb2-104"></a>      <span class="kw">ifelse</span>(top_pct <span class="op">&lt;</span><span class="st"> </span><span class="fl">0.5</span>,</span>
<span id="cb2-105"><a href="#cb2-105"></a>        <span class="st">&quot;top left&quot;</span>,</span>
<span id="cb2-106"><a href="#cb2-106"></a>        <span class="st">&quot;bottom left&quot;</span></span>
<span id="cb2-107"><a href="#cb2-107"></a>      ),</span>
<span id="cb2-108"><a href="#cb2-108"></a>      <span class="kw">ifelse</span>(top_pct <span class="op">&lt;</span><span class="st"> </span><span class="fl">0.5</span>,</span>
<span id="cb2-109"><a href="#cb2-109"></a>        <span class="st">&quot;top right&quot;</span>,</span>
<span id="cb2-110"><a href="#cb2-110"></a>        <span class="st">&quot;bottom right&quot;</span></span>
<span id="cb2-111"><a href="#cb2-111"></a>      )</span>
<span id="cb2-112"><a href="#cb2-112"></a>    )</span>
<span id="cb2-113"><a href="#cb2-113"></a>    f &lt;-<span class="st"> </span><span class="kw">as.character</span>(point[[<span class="st">&quot;f&quot;</span>]])</span>
<span id="cb2-114"><a href="#cb2-114"></a>    color &lt;-<span class="st"> </span><span class="cf">switch</span>(f,</span>
<span id="cb2-115"><a href="#cb2-115"></a>      <span class="dt">A =</span> <span class="st">&quot;darkred&quot;</span>,</span>
<span id="cb2-116"><a href="#cb2-116"></a>      <span class="dt">B =</span> <span class="st">&quot;darkgreen&quot;</span>,</span>
<span id="cb2-117"><a href="#cb2-117"></a>      <span class="dt">C =</span> <span class="st">&quot;darkblue&quot;</span></span>
<span id="cb2-118"><a href="#cb2-118"></a>    )</span>
<span id="cb2-119"><a href="#cb2-119"></a>    tooltip &lt;-<span class="st"> </span><span class="kw">paste0</span>(</span>
<span id="cb2-120"><a href="#cb2-120"></a>      <span class="st">&quot;&lt;b&gt; x: &lt;/b&gt;&quot;</span>, <span class="kw">formatC</span>(point[[<span class="st">&quot;x&quot;</span>]]), <span class="st">&quot;&lt;br/&gt;&quot;</span>,</span>
<span id="cb2-121"><a href="#cb2-121"></a>      <span class="st">&quot;&lt;b&gt; y: &lt;/b&gt;&quot;</span>, <span class="kw">formatC</span>(point[[<span class="st">&quot;y&quot;</span>]]), <span class="st">&quot;&lt;br/&gt;&quot;</span>,</span>
<span id="cb2-122"><a href="#cb2-122"></a>      <span class="st">&quot;&lt;b&gt; f: &lt;/b&gt;&quot;</span>, f</span>
<span id="cb2-123"><a href="#cb2-123"></a>    )</span>
<span id="cb2-124"><a href="#cb2-124"></a>    <span class="kw">runjs</span>(</span>
<span id="cb2-125"><a href="#cb2-125"></a>      <span class="kw">paste0</span>(</span>
<span id="cb2-126"><a href="#cb2-126"></a>        <span class="kw">sprintf</span>(</span>
<span id="cb2-127"><a href="#cb2-127"></a>          <span class="st">&quot;$(&#39;#tooltiptext&#39;).html(&#39;%s&#39;);&quot;</span>, tooltip</span>
<span id="cb2-128"><a href="#cb2-128"></a>        ),</span>
<span id="cb2-129"><a href="#cb2-129"></a>        <span class="kw">sprintf</span>(qTipTemplate, pos, pos, left_px, top_px, color)</span>
<span id="cb2-130"><a href="#cb2-130"></a>      )</span>
<span id="cb2-131"><a href="#cb2-131"></a>    )</span>
<span id="cb2-132"><a href="#cb2-132"></a>  })</span>
<span id="cb2-133"><a href="#cb2-133"></a>}</span>
<span id="cb2-134"><a href="#cb2-134"></a></span>
<span id="cb2-135"><a href="#cb2-135"></a><span class="kw">shinyApp</span>(ui, server)</span></code></pre></div>
<p><img src="./figures/ggplot2_qTipTooltips2.gif" style="width:65.0%" /></p>
<p>Let’s do something a bit more complicated now, with a continuous color scale. The idea is to define a CSS class for each point.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a><span class="kw">library</span>(shiny)</span>
<span id="cb3-2"><a href="#cb3-2"></a><span class="kw">library</span>(shinyjs)</span>
<span id="cb3-3"><a href="#cb3-3"></a><span class="kw">library</span>(ggplot2)</span>
<span id="cb3-4"><a href="#cb3-4"></a><span class="kw">library</span>(viridisLite)</span>
<span id="cb3-5"><a href="#cb3-5"></a></span>
<span id="cb3-6"><a href="#cb3-6"></a><span class="kw">set.seed</span>(666L)</span>
<span id="cb3-7"><a href="#cb3-7"></a>n &lt;-<span class="st"> </span>200L</span>
<span id="cb3-8"><a href="#cb3-8"></a>dat &lt;-<span class="st"> </span><span class="kw">data.frame</span>(</span>
<span id="cb3-9"><a href="#cb3-9"></a>  <span class="dt">x =</span> <span class="dv">1</span><span class="op">:</span>n,</span>
<span id="cb3-10"><a href="#cb3-10"></a>  <span class="dt">y =</span> <span class="kw">runif</span>(n)</span>
<span id="cb3-11"><a href="#cb3-11"></a>)</span>
<span id="cb3-12"><a href="#cb3-12"></a></span>
<span id="cb3-13"><a href="#cb3-13"></a><span class="co"># font color given background color:</span></span>
<span id="cb3-14"><a href="#cb3-14"></a>black_or_white &lt;-<span class="st"> </span><span class="cf">function</span>(color) {</span>
<span id="cb3-15"><a href="#cb3-15"></a>  rgb &lt;-<span class="st"> </span><span class="kw">col2rgb</span>(color)</span>
<span id="cb3-16"><a href="#cb3-16"></a>  <span class="cf">if</span>(rgb[<span class="dv">1</span>]<span class="op">*</span><span class="fl">0.299</span> <span class="op">+</span><span class="st"> </span>rgb[<span class="dv">2</span>]<span class="op">*</span><span class="fl">0.587</span> <span class="op">+</span><span class="st"> </span>rgb[<span class="dv">3</span>]<span class="op">*</span><span class="fl">0.114</span> <span class="op">&gt;</span><span class="st"> </span><span class="dv">186</span>)</span>
<span id="cb3-17"><a href="#cb3-17"></a>    <span class="st">&quot;black&quot;</span> <span class="co"># background color is light</span></span>
<span id="cb3-18"><a href="#cb3-18"></a>  <span class="cf">else</span></span>
<span id="cb3-19"><a href="#cb3-19"></a>    <span class="st">&quot;white&quot;</span> <span class="co"># background color is dark</span></span>
<span id="cb3-20"><a href="#cb3-20"></a>}</span>
<span id="cb3-21"><a href="#cb3-21"></a></span>
<span id="cb3-22"><a href="#cb3-22"></a>ramp &lt;-<span class="st"> </span><span class="kw">colorRamp</span>(<span class="kw">viridis</span>(255L))</span>
<span id="cb3-23"><a href="#cb3-23"></a></span>
<span id="cb3-24"><a href="#cb3-24"></a>bkgs    &lt;-<span class="st"> </span><span class="kw">rgb</span>(<span class="kw">ramp</span>(dat<span class="op">$</span>y), <span class="dt">maxColorValue =</span> <span class="dv">255</span>)</span>
<span id="cb3-25"><a href="#cb3-25"></a>colors  &lt;-<span class="st"> </span><span class="kw">vapply</span>(bkgs, black_or_white, <span class="kw">character</span>(1L))</span>
<span id="cb3-26"><a href="#cb3-26"></a>classes &lt;-<span class="st"> </span><span class="kw">sprintf</span>(<span class="st">&quot;color%03d&quot;</span>, <span class="dv">1</span><span class="op">:</span>n)</span>
<span id="cb3-27"><a href="#cb3-27"></a>dat<span class="op">$</span>class &lt;-<span class="st"> </span>classes</span>
<span id="cb3-28"><a href="#cb3-28"></a></span>
<span id="cb3-29"><a href="#cb3-29"></a>CSSclass &lt;-<span class="st"> </span><span class="cf">function</span>(i) {</span>
<span id="cb3-30"><a href="#cb3-30"></a>  <span class="kw">paste0</span>(</span>
<span id="cb3-31"><a href="#cb3-31"></a>    <span class="st">&quot;.&quot;</span>, classes[i], <span class="st">&quot; {&quot;</span>,</span>
<span id="cb3-32"><a href="#cb3-32"></a>    <span class="st">&quot;color: &quot;</span>, colors[i], <span class="st">&quot;; &quot;</span>,</span>
<span id="cb3-33"><a href="#cb3-33"></a>    <span class="st">&quot;background-color: &quot;</span>, bkgs[i], <span class="st">&quot;;&quot;</span>,</span>
<span id="cb3-34"><a href="#cb3-34"></a>    <span class="st">&quot;}&quot;</span></span>
<span id="cb3-35"><a href="#cb3-35"></a>  )</span>
<span id="cb3-36"><a href="#cb3-36"></a>}</span>
<span id="cb3-37"><a href="#cb3-37"></a>CSS &lt;-<span class="st"> </span><span class="kw">paste0</span>(<span class="kw">vapply</span>(<span class="dv">1</span><span class="op">:</span>n, CSSclass, <span class="kw">character</span>(1L)), <span class="dt">collapse =</span> <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>)</span>
<span id="cb3-38"><a href="#cb3-38"></a></span>
<span id="cb3-39"><a href="#cb3-39"></a>qTipTemplate &lt;-<span class="st"> &quot;</span></span>
<span id="cb3-40"><a href="#cb3-40"></a><span class="st">$(&#39;#hoverinfo&#39;).qtip({</span></span>
<span id="cb3-41"><a href="#cb3-41"></a><span class="st">  overwrite: true,</span></span>
<span id="cb3-42"><a href="#cb3-42"></a><span class="st">  content: {</span></span>
<span id="cb3-43"><a href="#cb3-43"></a><span class="st">    text: $(&#39;#tooltiptext&#39;).clone()</span></span>
<span id="cb3-44"><a href="#cb3-44"></a><span class="st">  },</span></span>
<span id="cb3-45"><a href="#cb3-45"></a><span class="st">  position: {</span></span>
<span id="cb3-46"><a href="#cb3-46"></a><span class="st">    my: &#39;%s&#39;,</span></span>
<span id="cb3-47"><a href="#cb3-47"></a><span class="st">    at: &#39;%s&#39;,</span></span>
<span id="cb3-48"><a href="#cb3-48"></a><span class="st">    target: [%s, %s],</span></span>
<span id="cb3-49"><a href="#cb3-49"></a><span class="st">    container: $(&#39;#ggplot&#39;)</span></span>
<span id="cb3-50"><a href="#cb3-50"></a><span class="st">  },</span></span>
<span id="cb3-51"><a href="#cb3-51"></a><span class="st">  show: {</span></span>
<span id="cb3-52"><a href="#cb3-52"></a><span class="st">    ready: true</span></span>
<span id="cb3-53"><a href="#cb3-53"></a><span class="st">  },</span></span>
<span id="cb3-54"><a href="#cb3-54"></a><span class="st">  hide: {</span></span>
<span id="cb3-55"><a href="#cb3-55"></a><span class="st">    event: false,</span></span>
<span id="cb3-56"><a href="#cb3-56"></a><span class="st">    inactive: 4000</span></span>
<span id="cb3-57"><a href="#cb3-57"></a><span class="st">  },</span></span>
<span id="cb3-58"><a href="#cb3-58"></a><span class="st">  style: {</span></span>
<span id="cb3-59"><a href="#cb3-59"></a><span class="st">    classes: &#39;myqtip %s&#39;</span></span>
<span id="cb3-60"><a href="#cb3-60"></a><span class="st">  }</span></span>
<span id="cb3-61"><a href="#cb3-61"></a><span class="st">});</span></span>
<span id="cb3-62"><a href="#cb3-62"></a><span class="st">&quot;</span></span>
<span id="cb3-63"><a href="#cb3-63"></a></span>
<span id="cb3-64"><a href="#cb3-64"></a>ui &lt;-<span class="st"> </span><span class="kw">basicPage</span>(</span>
<span id="cb3-65"><a href="#cb3-65"></a>  <span class="kw">useShinyjs</span>(),</span>
<span id="cb3-66"><a href="#cb3-66"></a>  tags<span class="op">$</span><span class="kw">head</span>(</span>
<span id="cb3-67"><a href="#cb3-67"></a>    tags<span class="op">$</span><span class="kw">link</span>(<span class="dt">rel =</span> <span class="st">&quot;stylesheet&quot;</span>, <span class="dt">href =</span> <span class="st">&quot;jquery.qtip.css&quot;</span>),</span>
<span id="cb3-68"><a href="#cb3-68"></a>    tags<span class="op">$</span><span class="kw">script</span>(<span class="dt">src =</span> <span class="st">&quot;jquery.qtip.js&quot;</span>),</span>
<span id="cb3-69"><a href="#cb3-69"></a>    tags<span class="op">$</span><span class="kw">style</span>(<span class="st">&quot;</span></span>
<span id="cb3-70"><a href="#cb3-70"></a><span class="st">      .myqtip {</span></span>
<span id="cb3-71"><a href="#cb3-71"></a><span class="st">        font-size: 15px;</span></span>
<span id="cb3-72"><a href="#cb3-72"></a><span class="st">        line-height: 18px;</span></span>
<span id="cb3-73"><a href="#cb3-73"></a><span class="st">        color: white;</span></span>
<span id="cb3-74"><a href="#cb3-74"></a><span class="st">        border-color: rgb(54, 57, 64);</span></span>
<span id="cb3-75"><a href="#cb3-75"></a><span class="st">      }</span></span>
<span id="cb3-76"><a href="#cb3-76"></a><span class="st">    &quot;</span>),</span>
<span id="cb3-77"><a href="#cb3-77"></a>    tags<span class="op">$</span><span class="kw">style</span>(CSS)</span>
<span id="cb3-78"><a href="#cb3-78"></a>  ),</span>
<span id="cb3-79"><a href="#cb3-79"></a>  <span class="kw">div</span>(</span>
<span id="cb3-80"><a href="#cb3-80"></a>    <span class="dt">id =</span> <span class="st">&quot;tooltiptext&quot;</span>, <span class="dt">style =</span> <span class="st">&quot;display: none;&quot;</span></span>
<span id="cb3-81"><a href="#cb3-81"></a>  ),</span>
<span id="cb3-82"><a href="#cb3-82"></a>  <span class="kw">br</span>(),</span>
<span id="cb3-83"><a href="#cb3-83"></a>  <span class="kw">div</span>(</span>
<span id="cb3-84"><a href="#cb3-84"></a>    <span class="dt">style =</span> <span class="st">&quot;position: relative;&quot;</span>,</span>
<span id="cb3-85"><a href="#cb3-85"></a>    <span class="kw">plotOutput</span>(<span class="st">&quot;ggplot&quot;</span>, <span class="dt">hover =</span> <span class="kw">hoverOpts</span>(<span class="st">&quot;plot_hover&quot;</span>)),</span>
<span id="cb3-86"><a href="#cb3-86"></a>    <span class="kw">div</span>(<span class="dt">id =</span> <span class="st">&quot;hoverinfo&quot;</span>, <span class="dt">style =</span> <span class="st">&quot;position: absolute;&quot;</span>)</span>
<span id="cb3-87"><a href="#cb3-87"></a>  )</span>
<span id="cb3-88"><a href="#cb3-88"></a>)</span>
<span id="cb3-89"><a href="#cb3-89"></a></span>
<span id="cb3-90"><a href="#cb3-90"></a>server &lt;-<span class="st"> </span><span class="cf">function</span>(input, output, session) {</span>
<span id="cb3-91"><a href="#cb3-91"></a>  output<span class="op">$</span>ggplot &lt;-<span class="st"> </span><span class="kw">renderPlot</span>(</span>
<span id="cb3-92"><a href="#cb3-92"></a>    <span class="kw">ggplot</span>(dat, <span class="kw">aes</span>(<span class="dt">x =</span> x, <span class="dt">y =</span> y, <span class="dt">color =</span> y)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>(<span class="dt">size =</span> <span class="dv">3</span>) <span class="op">+</span></span>
<span id="cb3-93"><a href="#cb3-93"></a><span class="st">      </span><span class="kw">scale_color_viridis_c</span>() <span class="op">+</span></span>
<span id="cb3-94"><a href="#cb3-94"></a><span class="st">      </span><span class="kw">theme</span>(</span>
<span id="cb3-95"><a href="#cb3-95"></a>        <span class="dt">panel.background =</span> <span class="kw">element_rect</span>(<span class="dt">fill =</span> <span class="st">&quot;gainsboro&quot;</span>),</span>
<span id="cb3-96"><a href="#cb3-96"></a>        <span class="dt">axis.title =</span> <span class="kw">element_text</span>(<span class="dt">size =</span> <span class="dv">19</span>),</span>
<span id="cb3-97"><a href="#cb3-97"></a>        <span class="dt">axis.text =</span> <span class="kw">element_text</span>(<span class="dt">size =</span> <span class="dv">16</span>),</span>
<span id="cb3-98"><a href="#cb3-98"></a>        <span class="dt">legend.title =</span> <span class="kw">element_text</span>(<span class="dt">size =</span> <span class="dv">18</span>)</span>
<span id="cb3-99"><a href="#cb3-99"></a>      )</span>
<span id="cb3-100"><a href="#cb3-100"></a>  )</span>
<span id="cb3-101"><a href="#cb3-101"></a></span>
<span id="cb3-102"><a href="#cb3-102"></a>  <span class="kw">observeEvent</span>(input[[<span class="st">&quot;plot_hover&quot;</span>]], {</span>
<span id="cb3-103"><a href="#cb3-103"></a>    <span class="cf">if</span>(<span class="kw">is.null</span>(hover &lt;-<span class="st"> </span>input[[<span class="st">&quot;plot_hover&quot;</span>]])) {</span>
<span id="cb3-104"><a href="#cb3-104"></a>      <span class="kw">return</span>(<span class="ot">NULL</span>)</span>
<span id="cb3-105"><a href="#cb3-105"></a>    }</span>
<span id="cb3-106"><a href="#cb3-106"></a>    point &lt;-<span class="st"> </span><span class="kw">nearPoints</span>(dat, hover, <span class="dt">threshold =</span> <span class="dv">15</span>, <span class="dt">maxpoints =</span> 1L)</span>
<span id="cb3-107"><a href="#cb3-107"></a>    <span class="cf">if</span>(<span class="kw">nrow</span>(point) <span class="op">==</span><span class="st"> </span>0L) {</span>
<span id="cb3-108"><a href="#cb3-108"></a>      <span class="kw">return</span>(<span class="ot">NULL</span>)</span>
<span id="cb3-109"><a href="#cb3-109"></a>    }</span>
<span id="cb3-110"><a href="#cb3-110"></a>    left_pct &lt;-</span>
<span id="cb3-111"><a href="#cb3-111"></a><span class="st">      </span>(point[[<span class="st">&quot;x&quot;</span>]] <span class="op">-</span><span class="st"> </span>hover<span class="op">$</span>domain<span class="op">$</span>left) <span class="op">/</span></span>
<span id="cb3-112"><a href="#cb3-112"></a><span class="st">        </span>(hover<span class="op">$</span>domain<span class="op">$</span>right <span class="op">-</span><span class="st"> </span>hover<span class="op">$</span>domain<span class="op">$</span>left)</span>
<span id="cb3-113"><a href="#cb3-113"></a>    top_pct &lt;-</span>
<span id="cb3-114"><a href="#cb3-114"></a><span class="st">      </span>(hover<span class="op">$</span>domain<span class="op">$</span>top <span class="op">-</span><span class="st"> </span>point[[<span class="st">&quot;y&quot;</span>]]) <span class="op">/</span></span>
<span id="cb3-115"><a href="#cb3-115"></a><span class="st">        </span>(hover<span class="op">$</span>domain<span class="op">$</span>top <span class="op">-</span><span class="st"> </span>hover<span class="op">$</span>domain<span class="op">$</span>bottom)</span>
<span id="cb3-116"><a href="#cb3-116"></a>    left_px &lt;-</span>
<span id="cb3-117"><a href="#cb3-117"></a><span class="st">      </span>(hover<span class="op">$</span>range<span class="op">$</span>left <span class="op">+</span><span class="st"> </span>left_pct <span class="op">*</span><span class="st"> </span>(hover<span class="op">$</span>range<span class="op">$</span>right <span class="op">-</span><span class="st"> </span>hover<span class="op">$</span>range<span class="op">$</span>left)) <span class="op">/</span></span>
<span id="cb3-118"><a href="#cb3-118"></a><span class="st">        </span>hover<span class="op">$</span>img_css_ratio<span class="op">$</span>x</span>
<span id="cb3-119"><a href="#cb3-119"></a>    top_px &lt;-</span>
<span id="cb3-120"><a href="#cb3-120"></a><span class="st">      </span>(hover<span class="op">$</span>range<span class="op">$</span>top <span class="op">+</span><span class="st"> </span>top_pct <span class="op">*</span><span class="st"> </span>(hover<span class="op">$</span>range<span class="op">$</span>bottom <span class="op">-</span><span class="st"> </span>hover<span class="op">$</span>range<span class="op">$</span>top)) <span class="op">/</span></span>
<span id="cb3-121"><a href="#cb3-121"></a><span class="st">        </span>hover<span class="op">$</span>img_css_ratio<span class="op">$</span>y</span>
<span id="cb3-122"><a href="#cb3-122"></a>    pos &lt;-<span class="st"> </span><span class="kw">ifelse</span>(left_pct <span class="op">&lt;</span><span class="st"> </span><span class="fl">0.5</span>,</span>
<span id="cb3-123"><a href="#cb3-123"></a>      <span class="kw">ifelse</span>(top_pct <span class="op">&lt;</span><span class="st"> </span><span class="fl">0.5</span>,</span>
<span id="cb3-124"><a href="#cb3-124"></a>        <span class="st">&quot;top left&quot;</span>,</span>
<span id="cb3-125"><a href="#cb3-125"></a>        <span class="st">&quot;bottom left&quot;</span></span>
<span id="cb3-126"><a href="#cb3-126"></a>      ),</span>
<span id="cb3-127"><a href="#cb3-127"></a>      <span class="kw">ifelse</span>(top_pct <span class="op">&lt;</span><span class="st"> </span><span class="fl">0.5</span>,</span>
<span id="cb3-128"><a href="#cb3-128"></a>        <span class="st">&quot;top right&quot;</span>,</span>
<span id="cb3-129"><a href="#cb3-129"></a>        <span class="st">&quot;bottom right&quot;</span></span>
<span id="cb3-130"><a href="#cb3-130"></a>      )</span>
<span id="cb3-131"><a href="#cb3-131"></a>    )</span>
<span id="cb3-132"><a href="#cb3-132"></a>    cssClass &lt;-<span class="st"> </span>point[[<span class="st">&quot;class&quot;</span>]]</span>
<span id="cb3-133"><a href="#cb3-133"></a>    tooltip &lt;-<span class="st"> </span><span class="kw">paste0</span>(</span>
<span id="cb3-134"><a href="#cb3-134"></a>      <span class="st">&quot;&lt;b&gt; x: &lt;/b&gt;&quot;</span>, <span class="kw">formatC</span>(point[[<span class="st">&quot;x&quot;</span>]]), <span class="st">&quot;&lt;br/&gt;&quot;</span>,</span>
<span id="cb3-135"><a href="#cb3-135"></a>      <span class="st">&quot;&lt;b&gt; y: &lt;/b&gt;&quot;</span>, <span class="kw">formatC</span>(point[[<span class="st">&quot;y&quot;</span>]]), <span class="st">&quot;&lt;br/&gt;&quot;</span></span>
<span id="cb3-136"><a href="#cb3-136"></a>    )</span>
<span id="cb3-137"><a href="#cb3-137"></a>    <span class="kw">runjs</span>(</span>
<span id="cb3-138"><a href="#cb3-138"></a>      <span class="kw">paste0</span>(</span>
<span id="cb3-139"><a href="#cb3-139"></a>        <span class="kw">sprintf</span>(</span>
<span id="cb3-140"><a href="#cb3-140"></a>          <span class="st">&quot;$(&#39;#tooltiptext&#39;).html(&#39;%s&#39;);&quot;</span>, tooltip</span>
<span id="cb3-141"><a href="#cb3-141"></a>        ),</span>
<span id="cb3-142"><a href="#cb3-142"></a>        <span class="kw">sprintf</span>(qTipTemplate, pos, pos, left_px, top_px, cssClass)</span>
<span id="cb3-143"><a href="#cb3-143"></a>      )</span>
<span id="cb3-144"><a href="#cb3-144"></a>    )</span>
<span id="cb3-145"><a href="#cb3-145"></a>  })</span>
<span id="cb3-146"><a href="#cb3-146"></a>}</span>
<span id="cb3-147"><a href="#cb3-147"></a></span>
<span id="cb3-148"><a href="#cb3-148"></a><span class="kw">shinyApp</span>(ui, server)</span></code></pre></div>
<p><img src="./figures/ggplot2_qTipTooltips3.gif" style="width:65.0%" /></p>

        </div>


        <div id="footer">
          Site proudly generated by
          <a href="http://jaspervdj.be/hakyll">Hakyll</a>
        </div>

      </div>

    </div>

    <div class="row">
      <div class="col-sm-12">
        <div id="disqus_thread"></div>
        <div class="pagination">
          <ul>
            <li>
              <a href="http://laustep.github.io/stlahblog/">&#171; Back Home</a>
            </li>
          </ul>
        </div>
      </div>
    </div>
    
  </div>

</body>

<script src="/libraries/bootstrap/bootstrap.min.js"></script>
<script>
  var disqus_developer = 1;
  var disqus_shortname = 'stlapblog';
  // required: replace example with your forum shortname
  /* * * DON'T EDIT BELOW THIS LINE * * */
  (function () {
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = 'https://' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] ||
      document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>
<noscript>Please enable JavaScript to view the
  <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a>
</noscript>
<!-- MathJax: Fall back to local if CDN offline but local image fonts are not supported (saves >100MB) -->
<script type="text/x-mathjax-config" src="/libraries/mathjax/config/TeX-MML-AM_CHTML.js"></script>
<!-- <script>
  window.MathJax || document.write('<script type="text/x-mathjax-config">MathJax.Hub.Config({"HTML-CSS":{imageFont:null}});<\/script><script src="../libraries/mathjax/MathJax.js"><\/script>');
</script> -->


</html>]]></description>
    <pubDate>Sun, 03 Jul 2022 00:00:00 UT</pubDate>
    <guid>https://laustep.github.io/stlahblog/posts/ggplot2_qTipTooltips.html</guid>
    <dc:creator>Stéphane Laurent</dc:creator>
    <category>R</category>
</item>


<item>
    <title>Search in a 'DT' table w/ or w/o a regular expression</title>
    <link>https://laustep.github.io/stlahblog/posts/DT_SearchBuilder.html</link>
    <description><![CDATA[<!DOCTYPE HTML>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Saturn Elephant - Search in a 'DT' table w/ or w/o a regular expression</title>
  <link href="/libraries/bootstrap/bootstrap-grid.min.css" rel="stylesheet">
  <link rel="stylesheet" href="/css/default2.css" />
  <link rel="stylesheet" href="/css/post.css" />
  <link rel="stylesheet" href="/css/misc.css" /> 
  
    <link rel="stylesheet" href="/css/pandoc-solarized.css" /> 
   
  
  <link href="https://fonts.googleapis.com/css?family=Raleway:400,600,200,800" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/css?family=Droid+Sans" rel="stylesheet" type="text/css">
  <script src="/libraries/jquery.min.js"></script>
  <script type="text/javascript" async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML"></script>
</head>

<body>
  <div class="container-fluid">
    <div class="row">
      <!-- Sidebar. -->
      <div class="sidebar col-sm-2">
        <div class="row">
          <div class="col-sm-12" style="float:right;clear:both;margin-right:50px;margin-top:50px;">
            <a href="https://www.r-bloggers.com/">
              <img src="/images/Rbloggers.png" alt="Rbloggers" width="100%" />
            </a>
            <br/>
            <a href="http://t-redactyl.io/">
              <span style="color:black;font-weight:bold;font-family:sans-serif;font-size:25px;">Standard error</span>
            </a>
            <a href="http://timelyportfolio.blogspot.be/">
              <span style="color:grey;font-weight:bold;font-family:sans-serif;font-size:24px;">Timely portfolio</span>
            </a>
            <br/>
            <a href="https://antoineguillot.wordpress.com/blog/">
              <span style="color:white;background-color:darkblue;font-weight:bold;font-family:sans-serif;font-size:21px;border:5px solid;border-color:darkblue">ENHANCE DATA</span>
            </a>
            <br/>
            <a href="https://fronkonstin.com/">
              <span style="color:black;background-color:gold;font-weight:bold;font-size:29px;border:3px solid;border-color:gold;">Fronkonstin</span>
            </a>
          </div>
        </div>
        <div id="logos">
          <div class="row">
            <div class="col-sm-4">
              <img src="/images/AsymptoteLogo.svg" style="width: 150%; transform: rotateZ(-35deg)"/>
            </div>
            <div class="col-sm-4">
              <img src="/images/Rlogo.svg" style="width: 110%;"/>
            </div>
            <div class="col-sm-4">
              <img src="/images/shiny-hex.png" style="width: 90%;"/>
            </div>
          </div>
          <div class="row">
            <div class="col-sm-4">
              <img src="/images/Povray_logo_sphere.png" style="width: 105%;"/>
            </div>
            <div class="col-sm-4">
              <img src="/images/javascript.svg" style="width: 90%;"/>
            </div>
            <div class="col-sm-4">
              <img src="/images/haskell.svg" style="width: 110%;"/>
            </div>
          </div>
        </div>
      </div>

      <div class="main col-sm-10">
        <div id="header">
          <div id="logo">
            <a href="/">
              <img src="/images/stla.jpg" alt="stla" width="100px" />
            </a>
          </div>
          <div id="navigation" style="margin-top:50px;">
            <a href="/">Home</a>
            <a href="/about.html">About</a>
            <a href="/contact.html">Contact</a>
            <a href="/archive.html">Archive</a>
          </div>
        </div>

        <div class="content">
          <h1>Search in a 'DT' table w/ or w/o a regular expression</h1> 
          <div class="info">
    Posted on July  3, 2022
    
        by Stéphane Laurent
    
</div>
<div class="info">
    
    Tags: <a title="All pages tagged &#39;R&#39;." href="/tags/R.html">R</a>, <a title="All pages tagged &#39;datatables&#39;." href="/tags/datatables.html">datatables</a>, <a title="All pages tagged &#39;javascript&#39;." href="/tags/javascript.html">javascript</a>
    
</div>

<p>It is possible to search in a ‘DT’ table with a regular expression:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a><span class="kw">datatable</span>(</span>
<span id="cb1-2"><a href="#cb1-2"></a>  <span class="dt">data =</span> dat,</span>
<span id="cb1-3"><a href="#cb1-3"></a>  <span class="dt">options =</span> <span class="kw">list</span>(</span>
<span id="cb1-4"><a href="#cb1-4"></a>    <span class="dt">search =</span> <span class="kw">list</span>(<span class="dt">regex =</span> <span class="ot">TRUE</span>)</span>
<span id="cb1-5"><a href="#cb1-5"></a>  )</span>
<span id="cb1-6"><a href="#cb1-6"></a>)</span></code></pre></div>
<p>But it could be desirable to have the possibility to search either with a regular expression or with an ordinary string.</p>
<p>The <strong>SearchBuilder</strong> extension allows to search in a table using numerous useful criteria, such as <em>“contains”</em>, <em>“starts with”</em>, <em>“ends with”</em>, etc:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1"></a><span class="kw">library</span>(DT)</span>
<span id="cb2-2"><a href="#cb2-2"></a></span>
<span id="cb2-3"><a href="#cb2-3"></a>dat &lt;-<span class="st"> </span>iris[<span class="kw">c</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>, <span class="dv">51</span><span class="op">:</span><span class="dv">53</span>, <span class="dv">101</span><span class="op">:</span><span class="dv">103</span>), ]</span>
<span id="cb2-4"><a href="#cb2-4"></a></span>
<span id="cb2-5"><a href="#cb2-5"></a><span class="kw">datatable</span>(</span>
<span id="cb2-6"><a href="#cb2-6"></a>  dat,</span>
<span id="cb2-7"><a href="#cb2-7"></a>  <span class="dt">extensions =</span> <span class="st">&quot;SearchBuilder&quot;</span>,</span>
<span id="cb2-8"><a href="#cb2-8"></a>  <span class="dt">options =</span> <span class="kw">list</span>(</span>
<span id="cb2-9"><a href="#cb2-9"></a>    <span class="dt">dom =</span> <span class="st">&quot;Qlfrtip&quot;</span>,</span>
<span id="cb2-10"><a href="#cb2-10"></a>    <span class="dt">searchBuilder =</span> <span class="ot">TRUE</span></span>
<span id="cb2-11"><a href="#cb2-11"></a>  )</span>
<span id="cb2-12"><a href="#cb2-12"></a>)</span></code></pre></div>
<p><img src="./figures/DT_SearchBuilder1.gif" style="width:65.0%" /></p>
<p>In general, this is enough. But if really needed, it is possible to add a custom search criterion. Here is how to add a <em>“matches regexp”</em> criterion, to search with a regular expression:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a><span class="kw">datatable</span>(</span>
<span id="cb3-2"><a href="#cb3-2"></a>  dat,</span>
<span id="cb3-3"><a href="#cb3-3"></a>  <span class="dt">extensions =</span> <span class="st">&quot;SearchBuilder&quot;</span>,</span>
<span id="cb3-4"><a href="#cb3-4"></a>  <span class="dt">options =</span> <span class="kw">list</span>(</span>
<span id="cb3-5"><a href="#cb3-5"></a>    <span class="dt">dom =</span> <span class="st">&quot;Qlfrtip&quot;</span>,</span>
<span id="cb3-6"><a href="#cb3-6"></a>    <span class="dt">searchBuilder =</span> <span class="kw">list</span>(</span>
<span id="cb3-7"><a href="#cb3-7"></a>      <span class="dt">conditions =</span> <span class="kw">list</span>(</span>
<span id="cb3-8"><a href="#cb3-8"></a>        <span class="dt">string =</span> <span class="kw">list</span>(</span>
<span id="cb3-9"><a href="#cb3-9"></a>          <span class="dt">regexp =</span> <span class="kw">list</span>(</span>
<span id="cb3-10"><a href="#cb3-10"></a>            <span class="dt">conditionName =</span> <span class="st">&quot;Matches Regexp&quot;</span>,</span>
<span id="cb3-11"><a href="#cb3-11"></a>            <span class="dt">init =</span> <span class="kw">JS</span>(</span>
<span id="cb3-12"><a href="#cb3-12"></a>              <span class="st">&quot;function (that, fn, preDefined = null) {&quot;</span>,</span>
<span id="cb3-13"><a href="#cb3-13"></a>              <span class="st">&quot;  var el = $(&#39;&lt;input/&gt;&#39;).on(&#39;input&#39;, function() {&quot;</span>,</span>
<span id="cb3-14"><a href="#cb3-14"></a>              <span class="st">&quot;    fn(that, this);&quot;</span>,</span>
<span id="cb3-15"><a href="#cb3-15"></a>              <span class="st">&quot;   });&quot;</span>,</span>
<span id="cb3-16"><a href="#cb3-16"></a>              <span class="st">&quot;  if (preDefined !== null) {&quot;</span>,</span>
<span id="cb3-17"><a href="#cb3-17"></a>              <span class="st">&quot;     $(el).val(preDefined[0]);&quot;</span>,</span>
<span id="cb3-18"><a href="#cb3-18"></a>              <span class="st">&quot;  }&quot;</span>,</span>
<span id="cb3-19"><a href="#cb3-19"></a>              <span class="st">&quot;  return el;&quot;</span>,</span>
<span id="cb3-20"><a href="#cb3-20"></a>              <span class="st">&quot;}&quot;</span></span>
<span id="cb3-21"><a href="#cb3-21"></a>            ),</span>
<span id="cb3-22"><a href="#cb3-22"></a>            <span class="dt">inputValue =</span> <span class="kw">JS</span>(</span>
<span id="cb3-23"><a href="#cb3-23"></a>              <span class="st">&quot;function (el) {&quot;</span>,</span>
<span id="cb3-24"><a href="#cb3-24"></a>              <span class="st">&quot;  return $(el[0]).val();&quot;</span>,</span>
<span id="cb3-25"><a href="#cb3-25"></a>              <span class="st">&quot;}&quot;</span></span>
<span id="cb3-26"><a href="#cb3-26"></a>            ),</span>
<span id="cb3-27"><a href="#cb3-27"></a>            <span class="dt">isInputValid =</span> <span class="kw">JS</span>(</span>
<span id="cb3-28"><a href="#cb3-28"></a>              <span class="st">&quot;function (el, that) {&quot;</span>,</span>
<span id="cb3-29"><a href="#cb3-29"></a>              <span class="st">&quot;  var regexp = $(el[0]).val();&quot;</span>,</span>
<span id="cb3-30"><a href="#cb3-30"></a>              <span class="st">&quot;  var valid = true;&quot;</span>,</span>
<span id="cb3-31"><a href="#cb3-31"></a>              <span class="st">&quot;  try {&quot;</span>,</span>
<span id="cb3-32"><a href="#cb3-32"></a>              <span class="st">&quot;    new RegExp(regexp, &#39;g&#39;);&quot;</span>,</span>
<span id="cb3-33"><a href="#cb3-33"></a>              <span class="st">&quot;  } catch(e) {&quot;</span>,</span>
<span id="cb3-34"><a href="#cb3-34"></a>              <span class="st">&quot;    valid = false;&quot;</span>,</span>
<span id="cb3-35"><a href="#cb3-35"></a>              <span class="st">&quot;  }&quot;</span>,</span>
<span id="cb3-36"><a href="#cb3-36"></a>              <span class="st">&quot;  return valid;&quot;</span>,</span>
<span id="cb3-37"><a href="#cb3-37"></a>              <span class="st">&quot;}&quot;</span></span>
<span id="cb3-38"><a href="#cb3-38"></a>            ),</span>
<span id="cb3-39"><a href="#cb3-39"></a>            <span class="dt">search =</span> <span class="kw">JS</span>(</span>
<span id="cb3-40"><a href="#cb3-40"></a>              <span class="st">&quot;function (value, regexp) {&quot;</span>,</span>
<span id="cb3-41"><a href="#cb3-41"></a>              <span class="st">&quot;  var reg = new RegExp(regexp, &#39;g&#39;);&quot;</span>,</span>
<span id="cb3-42"><a href="#cb3-42"></a>              <span class="st">&quot;  return reg.test(value);&quot;</span>,</span>
<span id="cb3-43"><a href="#cb3-43"></a>              <span class="st">&quot;}&quot;</span></span>
<span id="cb3-44"><a href="#cb3-44"></a>            )</span>
<span id="cb3-45"><a href="#cb3-45"></a>          )</span>
<span id="cb3-46"><a href="#cb3-46"></a>        )</span>
<span id="cb3-47"><a href="#cb3-47"></a>      )</span>
<span id="cb3-48"><a href="#cb3-48"></a>    )</span>
<span id="cb3-49"><a href="#cb3-49"></a>  )</span>
<span id="cb3-50"><a href="#cb3-50"></a>)</span></code></pre></div>
<p><img src="./figures/DT_SearchBuilder2.gif" style="width:65.0%" /></p>

        </div>


        <div id="footer">
          Site proudly generated by
          <a href="http://jaspervdj.be/hakyll">Hakyll</a>
        </div>

      </div>

    </div>

    <div class="row">
      <div class="col-sm-12">
        <div id="disqus_thread"></div>
        <div class="pagination">
          <ul>
            <li>
              <a href="http://laustep.github.io/stlahblog/">&#171; Back Home</a>
            </li>
          </ul>
        </div>
      </div>
    </div>
    
  </div>

</body>

<script src="/libraries/bootstrap/bootstrap.min.js"></script>
<script>
  var disqus_developer = 1;
  var disqus_shortname = 'stlapblog';
  // required: replace example with your forum shortname
  /* * * DON'T EDIT BELOW THIS LINE * * */
  (function () {
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = 'https://' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] ||
      document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>
<noscript>Please enable JavaScript to view the
  <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a>
</noscript>
<!-- MathJax: Fall back to local if CDN offline but local image fonts are not supported (saves >100MB) -->
<script type="text/x-mathjax-config" src="/libraries/mathjax/config/TeX-MML-AM_CHTML.js"></script>
<!-- <script>
  window.MathJax || document.write('<script type="text/x-mathjax-config">MathJax.Hub.Config({"HTML-CSS":{imageFont:null}});<\/script><script src="../libraries/mathjax/MathJax.js"><\/script>');
</script> -->


</html>]]></description>
    <pubDate>Sun, 03 Jul 2022 00:00:00 UT</pubDate>
    <guid>https://laustep.github.io/stlahblog/posts/DT_SearchBuilder.html</guid>
    <dc:creator>Stéphane Laurent</dc:creator>
    <category>R</category>
</item>


<item>
    <title>Mapping a picture on a donut or a Hopf torus</title>
    <link>https://laustep.github.io/stlahblog/posts/ConformalTorus.html</link>
    <description><![CDATA[<!DOCTYPE HTML>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Saturn Elephant - Mapping a picture on a donut or a Hopf torus</title>
  <link href="/libraries/bootstrap/bootstrap-grid.min.css" rel="stylesheet">
  <link rel="stylesheet" href="/css/default2.css" />
  <link rel="stylesheet" href="/css/post.css" />
  <link rel="stylesheet" href="/css/misc.css" /> 
  
    <link rel="stylesheet" href="/css/pandoc-solarized.css" /> 
   
  
  <link href="https://fonts.googleapis.com/css?family=Raleway:400,600,200,800" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/css?family=Droid+Sans" rel="stylesheet" type="text/css">
  <script src="/libraries/jquery.min.js"></script>
  <script type="text/javascript" async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML"></script>
</head>

<body>
  <div class="container-fluid">
    <div class="row">
      <!-- Sidebar. -->
      <div class="sidebar col-sm-2">
        <div class="row">
          <div class="col-sm-12" style="float:right;clear:both;margin-right:50px;margin-top:50px;">
            <a href="https://www.r-bloggers.com/">
              <img src="/images/Rbloggers.png" alt="Rbloggers" width="100%" />
            </a>
            <br/>
            <a href="http://t-redactyl.io/">
              <span style="color:black;font-weight:bold;font-family:sans-serif;font-size:25px;">Standard error</span>
            </a>
            <a href="http://timelyportfolio.blogspot.be/">
              <span style="color:grey;font-weight:bold;font-family:sans-serif;font-size:24px;">Timely portfolio</span>
            </a>
            <br/>
            <a href="https://antoineguillot.wordpress.com/blog/">
              <span style="color:white;background-color:darkblue;font-weight:bold;font-family:sans-serif;font-size:21px;border:5px solid;border-color:darkblue">ENHANCE DATA</span>
            </a>
            <br/>
            <a href="https://fronkonstin.com/">
              <span style="color:black;background-color:gold;font-weight:bold;font-size:29px;border:3px solid;border-color:gold;">Fronkonstin</span>
            </a>
          </div>
        </div>
        <div id="logos">
          <div class="row">
            <div class="col-sm-4">
              <img src="/images/AsymptoteLogo.svg" style="width: 150%; transform: rotateZ(-35deg)"/>
            </div>
            <div class="col-sm-4">
              <img src="/images/Rlogo.svg" style="width: 110%;"/>
            </div>
            <div class="col-sm-4">
              <img src="/images/shiny-hex.png" style="width: 90%;"/>
            </div>
          </div>
          <div class="row">
            <div class="col-sm-4">
              <img src="/images/Povray_logo_sphere.png" style="width: 105%;"/>
            </div>
            <div class="col-sm-4">
              <img src="/images/javascript.svg" style="width: 90%;"/>
            </div>
            <div class="col-sm-4">
              <img src="/images/haskell.svg" style="width: 110%;"/>
            </div>
          </div>
        </div>
      </div>

      <div class="main col-sm-10">
        <div id="header">
          <div id="logo">
            <a href="/">
              <img src="/images/stla.jpg" alt="stla" width="100px" />
            </a>
          </div>
          <div id="navigation" style="margin-top:50px;">
            <a href="/">Home</a>
            <a href="/about.html">About</a>
            <a href="/contact.html">Contact</a>
            <a href="/archive.html">Archive</a>
          </div>
        </div>

        <div class="content">
          <h1>Mapping a picture on a donut or a Hopf torus</h1> 
          <div class="info">
    Posted on June 30, 2022
    
        by Stéphane Laurent
    
</div>
<div class="info">
    
    Tags: <a title="All pages tagged &#39;R&#39;." href="/tags/R.html">R</a>, <a title="All pages tagged &#39;maths&#39;." href="/tags/maths.html">maths</a>, <a title="All pages tagged &#39;geometry&#39;." href="/tags/geometry.html">geometry</a>, <a title="All pages tagged &#39;graphics&#39;." href="/tags/graphics.html">graphics</a>, <a title="All pages tagged &#39;rgl&#39;." href="/tags/rgl.html">rgl</a>
    
</div>

<h1 id="the-donut-torus">The donut torus</h1>
<p>Given a number <span class="math inline">\(s \geqslant 1\)</span>, the following map: <span class="math display">\[
(u, v) \mapsto (x, y, z) = 
\frac{\Bigl(s\cos\frac{u}{s}, s\sin\frac{u}{s}, \sin v\Bigr)}{\sqrt{s^2+1}-\cos v}
\]</span> is a <em>conformal parameterization</em> of the torus (the donut), where <span class="math inline">\(-s\pi \leqslant u &lt; s\pi\)</span> and <span class="math inline">\(\pi \leqslant v &lt; \pi\)</span>. I found it in <a href="https://static1.bridgesmathart.org/2011/cdrom/proceedings/134/paper_134.pdf">this paper by J.M. Sullivan</a>. The number <span class="math inline">\(s\)</span> is the ratio of the major radius over the minor radius.</p>
<p>The conformality of the map has the following consequence: you can easily map a doubly periodic image on the torus in such a way that it will perfectly fit on the torus.</p>
<h2 id="mapping-a-checkerboard">Mapping a checkerboard</h2>
<p>Let me show what I mean. The code below generates a mesh of the torus with a checkerboard mapped on its surface:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a><span class="kw">library</span>(rgl)</span>
<span id="cb1-2"><a href="#cb1-2"></a><span class="kw">library</span>(Rvcg) <span class="co"># to use vcgUpdateNormals()</span></span>
<span id="cb1-3"><a href="#cb1-3"></a></span>
<span id="cb1-4"><a href="#cb1-4"></a>torusMesh &lt;-<span class="st"> </span><span class="cf">function</span>(s, nu, nv){</span>
<span id="cb1-5"><a href="#cb1-5"></a>  nu &lt;-<span class="st"> </span><span class="kw">as.integer</span>(nu)</span>
<span id="cb1-6"><a href="#cb1-6"></a>  nv &lt;-<span class="st"> </span><span class="kw">as.integer</span>(nv)</span>
<span id="cb1-7"><a href="#cb1-7"></a>  nunv &lt;-<span class="st"> </span>nu <span class="op">*</span><span class="st"> </span>nv</span>
<span id="cb1-8"><a href="#cb1-8"></a>  vs      &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="ot">NA_real_</span>, <span class="dt">nrow =</span> 3L, <span class="dt">ncol =</span> nunv)</span>
<span id="cb1-9"><a href="#cb1-9"></a>  tris1   &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="ot">NA_integer_</span>, <span class="dt">nrow =</span> 3L, <span class="dt">ncol =</span> nunv)</span>
<span id="cb1-10"><a href="#cb1-10"></a>  tris2   &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="ot">NA_integer_</span>, <span class="dt">nrow =</span> 3L, <span class="dt">ncol =</span> nunv)</span>
<span id="cb1-11"><a href="#cb1-11"></a>  u_ &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="op">-</span>pi<span class="op">*</span>s, pi<span class="op">*</span>s, <span class="dt">length.out =</span> nu <span class="op">+</span><span class="st"> </span>1L)[<span class="op">-</span>1L]</span>
<span id="cb1-12"><a href="#cb1-12"></a>  v_ &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="op">-</span>pi, pi, <span class="dt">length.out =</span> nv <span class="op">+</span><span class="st"> </span>1L)[<span class="op">-</span>1L]</span>
<span id="cb1-13"><a href="#cb1-13"></a>  scosu_ &lt;-<span class="st"> </span>s <span class="op">*</span><span class="st"> </span><span class="kw">cos</span>(u_ <span class="op">/</span><span class="st"> </span>s)</span>
<span id="cb1-14"><a href="#cb1-14"></a>  ssinu_ &lt;-<span class="st"> </span>s <span class="op">*</span><span class="st"> </span><span class="kw">sin</span>(u_ <span class="op">/</span><span class="st"> </span>s)</span>
<span id="cb1-15"><a href="#cb1-15"></a>  sinv_ &lt;-<span class="st"> </span><span class="kw">sin</span>(v_)</span>
<span id="cb1-16"><a href="#cb1-16"></a>  w     &lt;-<span class="st"> </span><span class="kw">sqrt</span>(s<span class="op">*</span>s <span class="op">+</span><span class="st"> </span><span class="dv">1</span>) <span class="op">-</span><span class="st"> </span><span class="kw">cos</span>(v_)</span>
<span id="cb1-17"><a href="#cb1-17"></a>  jp1_ &lt;-<span class="st"> </span><span class="kw">c</span>(2L<span class="op">:</span>nv, 1L)</span>
<span id="cb1-18"><a href="#cb1-18"></a>  j_ &lt;-<span class="st"> </span>1L<span class="op">:</span>nv</span>
<span id="cb1-19"><a href="#cb1-19"></a>  color &lt;-<span class="st"> </span><span class="ot">NULL</span></span>
<span id="cb1-20"><a href="#cb1-20"></a>  <span class="cf">for</span>(i <span class="cf">in</span> 1L<span class="op">:</span>(nu<span class="op">-</span>1L)){</span>
<span id="cb1-21"><a href="#cb1-21"></a>    i_nv &lt;-<span class="st"> </span>i<span class="op">*</span>nv</span>
<span id="cb1-22"><a href="#cb1-22"></a>    rg &lt;-<span class="st"> </span>(i_nv <span class="op">-</span><span class="st"> </span>nv <span class="op">+</span><span class="st"> </span>1L)<span class="op">:</span>i_nv</span>
<span id="cb1-23"><a href="#cb1-23"></a>    vs[, rg] &lt;-<span class="st"> </span><span class="kw">rbind</span>(</span>
<span id="cb1-24"><a href="#cb1-24"></a>      scosu_[i] <span class="op">/</span><span class="st"> </span>w,</span>
<span id="cb1-25"><a href="#cb1-25"></a>      ssinu_[i] <span class="op">/</span><span class="st"> </span>w,</span>
<span id="cb1-26"><a href="#cb1-26"></a>      sinv_     <span class="op">/</span><span class="st"> </span>w</span>
<span id="cb1-27"><a href="#cb1-27"></a>    )</span>
<span id="cb1-28"><a href="#cb1-28"></a>    color &lt;-<span class="st"> </span><span class="kw">c</span>(</span>
<span id="cb1-29"><a href="#cb1-29"></a>      color,</span>
<span id="cb1-30"><a href="#cb1-30"></a>      <span class="cf">if</span>(<span class="kw">mod</span>(<span class="kw">floor</span>(<span class="dv">5</span> <span class="op">*</span><span class="st"> </span>u_[i] <span class="op">/</span><span class="st"> </span>(pi<span class="op">*</span>s)), <span class="dv">2</span>) <span class="op">==</span><span class="st"> </span><span class="dv">0</span>){</span>
<span id="cb1-31"><a href="#cb1-31"></a>        <span class="kw">ifelse</span>(</span>
<span id="cb1-32"><a href="#cb1-32"></a>          <span class="kw">floor</span>(<span class="dv">5</span> <span class="op">*</span><span class="st"> </span>v_ <span class="op">/</span><span class="st"> </span>pi) <span class="op">%%</span><span class="st"> </span><span class="dv">2</span> <span class="op">==</span><span class="st"> </span><span class="dv">0</span>, <span class="st">&quot;yellow&quot;</span>, <span class="st">&quot;navy&quot;</span></span>
<span id="cb1-33"><a href="#cb1-33"></a>        )</span>
<span id="cb1-34"><a href="#cb1-34"></a>      }<span class="cf">else</span>{</span>
<span id="cb1-35"><a href="#cb1-35"></a>        <span class="kw">ifelse</span>(</span>
<span id="cb1-36"><a href="#cb1-36"></a>          <span class="kw">floor</span>(<span class="dv">5</span> <span class="op">*</span><span class="st"> </span>v_ <span class="op">/</span><span class="st"> </span>pi) <span class="op">%%</span><span class="st"> </span><span class="dv">2</span> <span class="op">==</span><span class="st"> </span><span class="dv">0</span>, <span class="st">&quot;navy&quot;</span>, <span class="st">&quot;yellow&quot;</span></span>
<span id="cb1-37"><a href="#cb1-37"></a>        )</span>
<span id="cb1-38"><a href="#cb1-38"></a>      }</span>
<span id="cb1-39"><a href="#cb1-39"></a>    )</span>
<span id="cb1-40"><a href="#cb1-40"></a>    k1 &lt;-<span class="st"> </span>i_nv <span class="op">-</span><span class="st"> </span>nv</span>
<span id="cb1-41"><a href="#cb1-41"></a>    k_ &lt;-<span class="st"> </span>k1 <span class="op">+</span><span class="st"> </span>j_</span>
<span id="cb1-42"><a href="#cb1-42"></a>    l_ &lt;-<span class="st"> </span>k1 <span class="op">+</span><span class="st"> </span>jp1_</span>
<span id="cb1-43"><a href="#cb1-43"></a>    m_ &lt;-<span class="st"> </span>i_nv <span class="op">+</span><span class="st"> </span>j_</span>
<span id="cb1-44"><a href="#cb1-44"></a>    tris1[, k_] &lt;-<span class="st"> </span><span class="kw">rbind</span>(m_, l_, k_)</span>
<span id="cb1-45"><a href="#cb1-45"></a>    tris2[, k_] &lt;-<span class="st"> </span><span class="kw">rbind</span>(m_, i_nv <span class="op">+</span><span class="st"> </span>jp1_, l_)</span>
<span id="cb1-46"><a href="#cb1-46"></a>  }</span>
<span id="cb1-47"><a href="#cb1-47"></a>  i_nv &lt;-<span class="st"> </span>nunv</span>
<span id="cb1-48"><a href="#cb1-48"></a>  rg &lt;-<span class="st"> </span>(i_nv <span class="op">-</span><span class="st"> </span>nv <span class="op">+</span><span class="st"> </span>1L)<span class="op">:</span>i_nv</span>
<span id="cb1-49"><a href="#cb1-49"></a>  vs[, rg] &lt;-<span class="st"> </span><span class="kw">rbind</span>(</span>
<span id="cb1-50"><a href="#cb1-50"></a>    scosu_[nu] <span class="op">/</span><span class="st"> </span>w,</span>
<span id="cb1-51"><a href="#cb1-51"></a>    ssinu_[nu] <span class="op">/</span><span class="st"> </span>w,</span>
<span id="cb1-52"><a href="#cb1-52"></a>    sinv_      <span class="op">/</span><span class="st"> </span>w</span>
<span id="cb1-53"><a href="#cb1-53"></a>  )</span>
<span id="cb1-54"><a href="#cb1-54"></a>  color &lt;-<span class="st"> </span><span class="kw">c</span>(</span>
<span id="cb1-55"><a href="#cb1-55"></a>    color,</span>
<span id="cb1-56"><a href="#cb1-56"></a>    <span class="kw">ifelse</span>(</span>
<span id="cb1-57"><a href="#cb1-57"></a>      <span class="kw">floor</span>(<span class="dv">5</span> <span class="op">*</span><span class="st"> </span>v_ <span class="op">/</span><span class="st"> </span>pi) <span class="op">%%</span><span class="st"> </span><span class="dv">2</span> <span class="op">==</span><span class="st"> </span><span class="dv">0</span>, <span class="st">&quot;yellow&quot;</span>, <span class="st">&quot;navy&quot;</span></span>
<span id="cb1-58"><a href="#cb1-58"></a>    )</span>
<span id="cb1-59"><a href="#cb1-59"></a>  )</span>
<span id="cb1-60"><a href="#cb1-60"></a>  k1 &lt;-<span class="st"> </span>i_nv <span class="op">-</span><span class="st"> </span>nv</span>
<span id="cb1-61"><a href="#cb1-61"></a>  l_ &lt;-<span class="st"> </span>k1 <span class="op">+</span><span class="st"> </span>jp1_</span>
<span id="cb1-62"><a href="#cb1-62"></a>  k_ &lt;-<span class="st"> </span>k1 <span class="op">+</span><span class="st"> </span>j_</span>
<span id="cb1-63"><a href="#cb1-63"></a>  tris1[, k_] &lt;-<span class="st"> </span><span class="kw">rbind</span>(j_, l_, k_)</span>
<span id="cb1-64"><a href="#cb1-64"></a>  tris2[, k_] &lt;-<span class="st"> </span><span class="kw">rbind</span>(j_, jp1_, l_)</span>
<span id="cb1-65"><a href="#cb1-65"></a>  tmesh &lt;-<span class="st"> </span><span class="kw">tmesh3d</span>(</span>
<span id="cb1-66"><a href="#cb1-66"></a>    <span class="dt">vertices    =</span> vs,</span>
<span id="cb1-67"><a href="#cb1-67"></a>    <span class="dt">indices     =</span> <span class="kw">cbind</span>(tris1, tris2),</span>
<span id="cb1-68"><a href="#cb1-68"></a>    <span class="dt">homogeneous =</span> <span class="ot">FALSE</span>,</span>
<span id="cb1-69"><a href="#cb1-69"></a>    <span class="dt">material    =</span> <span class="kw">list</span>(<span class="st">&quot;color&quot;</span> =<span class="st"> </span>color)</span>
<span id="cb1-70"><a href="#cb1-70"></a>  )</span>
<span id="cb1-71"><a href="#cb1-71"></a>  <span class="kw">vcgUpdateNormals</span>(tmesh)</span>
<span id="cb1-72"><a href="#cb1-72"></a>}</span></code></pre></div>
<p>Let’s see:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true"></a>mesh &lt;-<span class="st"> </span><span class="kw">torusMesh</span>(<span class="dt">s =</span> <span class="kw">sqrt</span>(<span class="dv">2</span>), <span class="dt">nu =</span> <span class="dv">500</span>, <span class="dt">nv =</span> <span class="dv">500</span>)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true"></a></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true"></a><span class="kw">open3d</span>(<span class="dt">windowRect =</span> <span class="kw">c</span>(<span class="dv">50</span>, <span class="dv">50</span>, <span class="dv">562</span>, <span class="dv">562</span>), <span class="dt">zoom =</span> <span class="fl">0.85</span>)</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true"></a><span class="kw">bg3d</span>(<span class="st">&quot;gainsboro&quot;</span>)</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true"></a><span class="kw">shade3d</span>(mesh)</span></code></pre></div>
<p><img src="./figures/ConformalTorusCheckerboard.gif" style="width:55.0%" /></p>
<p>Now you surely see what I mean.</p>
<h2 id="mapping-a-gray-scott-picture">Mapping a Gray-Scott picture</h2>
<p>I am a fan of the <a href="https://fronkonstin.com/">Fronkonstin blog</a>. Maybe you already see <a href="https://fronkonstin.com/2019/12/28/reaction-diffusion/">this article about the Gray-Scott reaction-diffusion model</a> (it appeared on R-bloggers). It shows how to generate some beautiful pictures which are doubly periodic. So let’s map such a picture on the donut:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a>......</span>
<span id="cb3-2"><a href="#cb3-2"></a></span>
<span id="cb3-3"><a href="#cb3-3"></a>fcolor &lt;-<span class="st"> </span><span class="kw">colorRamp</span>(viridisLite<span class="op">::</span><span class="kw">magma</span>(255L))</span>
<span id="cb3-4"><a href="#cb3-4"></a>getColors &lt;-<span class="st"> </span><span class="cf">function</span>(B){</span>
<span id="cb3-5"><a href="#cb3-5"></a>  rgbs &lt;-<span class="st"> </span><span class="kw">fcolor</span>(B)</span>
<span id="cb3-6"><a href="#cb3-6"></a>  <span class="kw">rgb</span>(rgbs[, 1L], rgbs[, 2L], rgbs[, 3L], <span class="dt">maxColorValue =</span> <span class="dv">255</span>)</span>
<span id="cb3-7"><a href="#cb3-7"></a>}</span>
<span id="cb3-8"><a href="#cb3-8"></a></span>
<span id="cb3-9"><a href="#cb3-9"></a>X &lt;-<span class="st"> </span><span class="kw">iterate_Gray_Scott</span>(X, L, DA, DB, <span class="dv">500</span>)</span>
<span id="cb3-10"><a href="#cb3-10"></a>Colors &lt;-<span class="st"> </span><span class="kw">getColors</span>(<span class="kw">c</span>(X[,,2L]))</span>
<span id="cb3-11"><a href="#cb3-11"></a></span>
<span id="cb3-12"><a href="#cb3-12"></a>mesh &lt;-<span class="st"> </span><span class="kw">torusMesh</span>(<span class="dt">s =</span> <span class="kw">sqrt</span>(<span class="dv">2</span>), <span class="dt">nu =</span> <span class="dv">600</span>, <span class="dt">nv =</span> <span class="dv">600</span>)</span>
<span id="cb3-13"><a href="#cb3-13"></a>mesh[[<span class="st">&quot;material&quot;</span>]] &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="st">&quot;color&quot;</span> =<span class="st"> </span>Colors)</span>
<span id="cb3-14"><a href="#cb3-14"></a></span>
<span id="cb3-15"><a href="#cb3-15"></a><span class="kw">open3d</span>(<span class="dt">windowRect =</span> <span class="kw">c</span>(<span class="dv">50</span>, <span class="dv">50</span>, <span class="dv">562</span>, <span class="dv">562</span>), <span class="dt">zoom =</span> <span class="fl">0.85</span>)</span>
<span id="cb3-16"><a href="#cb3-16"></a><span class="kw">bg3d</span>(<span class="st">&quot;gainsboro&quot;</span>)</span>
<span id="cb3-17"><a href="#cb3-17"></a><span class="kw">shade3d</span>(mesh)</span></code></pre></div>
<p><img src="./figures/ConformalTorusGrayScott.gif" style="width:55.0%" /></p>
<p>Beautiful!</p>
<h1 id="the-hopf-torus">The Hopf torus</h1>
<p>We can similarly map a picture on a Hopf torus, with this conformal parameterization:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1"></a>HT &lt;-<span class="st"> </span><span class="cf">function</span>(h, nlobes, t, phi){</span>
<span id="cb4-2"><a href="#cb4-2"></a>  <span class="co"># the spherical curve</span></span>
<span id="cb4-3"><a href="#cb4-3"></a>  p1 &lt;-<span class="st"> </span><span class="kw">sin</span>(h <span class="op">*</span><span class="st"> </span><span class="kw">cos</span>(nlobes<span class="op">*</span>t))</span>
<span id="cb4-4"><a href="#cb4-4"></a>  p2 &lt;-<span class="st"> </span><span class="kw">cos</span>(t) <span class="op">*</span><span class="st"> </span><span class="kw">cos</span>(h <span class="op">*</span><span class="st"> </span><span class="kw">cos</span>(nlobes<span class="op">*</span>t))</span>
<span id="cb4-5"><a href="#cb4-5"></a>  p3 &lt;-<span class="st"> </span><span class="kw">sin</span>(t) <span class="op">*</span><span class="st"> </span><span class="kw">cos</span>(h <span class="op">*</span><span class="st"> </span><span class="kw">cos</span>(nlobes<span class="op">*</span>t))</span>
<span id="cb4-6"><a href="#cb4-6"></a>  <span class="co"># parameterization</span></span>
<span id="cb4-7"><a href="#cb4-7"></a>  yden &lt;-<span class="st"> </span><span class="kw">sqrt</span>(<span class="dv">2</span><span class="op">*</span>(<span class="dv">1</span><span class="op">+</span>p1))</span>
<span id="cb4-8"><a href="#cb4-8"></a>  y1 &lt;-<span class="st"> </span>(<span class="dv">1</span><span class="op">+</span>p1)<span class="op">/</span>yden</span>
<span id="cb4-9"><a href="#cb4-9"></a>  y2 &lt;-<span class="st"> </span>p2<span class="op">/</span>yden</span>
<span id="cb4-10"><a href="#cb4-10"></a>  y3 &lt;-<span class="st"> </span>p3<span class="op">/</span>yden</span>
<span id="cb4-11"><a href="#cb4-11"></a>  cosphi &lt;-<span class="st"> </span><span class="kw">cos</span>(phi)</span>
<span id="cb4-12"><a href="#cb4-12"></a>  sinphi &lt;-<span class="st"> </span><span class="kw">sin</span>(phi)</span>
<span id="cb4-13"><a href="#cb4-13"></a>  x1 &lt;-<span class="st"> </span>cosphi<span class="op">*</span>y1</span>
<span id="cb4-14"><a href="#cb4-14"></a>  x2 &lt;-<span class="st"> </span>sinphi<span class="op">*</span>y1</span>
<span id="cb4-15"><a href="#cb4-15"></a>  x3 &lt;-<span class="st"> </span>cosphi<span class="op">*</span>y2 <span class="op">-</span><span class="st"> </span>sinphi<span class="op">*</span>y3</span>
<span id="cb4-16"><a href="#cb4-16"></a>  x4 &lt;-<span class="st"> </span>cosphi<span class="op">*</span>y3 <span class="op">+</span><span class="st"> </span>sinphi<span class="op">*</span>y2  </span>
<span id="cb4-17"><a href="#cb4-17"></a>  <span class="kw">return</span>(<span class="kw">rbind</span>(x1<span class="op">/</span>(<span class="dv">1</span><span class="op">-</span>x4), x2<span class="op">/</span>(<span class="dv">1</span><span class="op">-</span>x4), x3<span class="op">/</span>(<span class="dv">1</span><span class="op">-</span>x4)))</span>
<span id="cb4-18"><a href="#cb4-18"></a>}</span></code></pre></div>
<h2 id="checkerboard">Checkerboard</h2>
<p>The code to construct the mesh with the checkerboard is similar to the one for the donut torus:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1"></a>HopfTorusMesh &lt;-<span class="st"> </span><span class="cf">function</span>(h, nlobes, nu, nv){</span>
<span id="cb5-2"><a href="#cb5-2"></a>  nu &lt;-<span class="st"> </span><span class="kw">as.integer</span>(nu)</span>
<span id="cb5-3"><a href="#cb5-3"></a>  nv &lt;-<span class="st"> </span><span class="kw">as.integer</span>(nv)</span>
<span id="cb5-4"><a href="#cb5-4"></a>  vs    &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="ot">NA_real_</span>, <span class="dt">nrow =</span> 3L, <span class="dt">ncol =</span> nu<span class="op">*</span>nv)</span>
<span id="cb5-5"><a href="#cb5-5"></a>  tris1 &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="ot">NA_integer_</span>, <span class="dt">nrow =</span> 3L, <span class="dt">ncol =</span> nu<span class="op">*</span>nv)</span>
<span id="cb5-6"><a href="#cb5-6"></a>  tris2 &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="ot">NA_integer_</span>, <span class="dt">nrow =</span> 3L, <span class="dt">ncol =</span> nu<span class="op">*</span>nv)</span>
<span id="cb5-7"><a href="#cb5-7"></a>  u_ &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="op">-</span>pi, pi, <span class="dt">length.out =</span> nu <span class="op">+</span><span class="st"> </span>1L)[<span class="op">-</span>1L]</span>
<span id="cb5-8"><a href="#cb5-8"></a>  v_ &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="op">-</span>pi, pi, <span class="dt">length.out =</span> nv <span class="op">+</span><span class="st"> </span>1L)[<span class="op">-</span>1L]</span>
<span id="cb5-9"><a href="#cb5-9"></a>  jp1_ &lt;-<span class="st"> </span><span class="kw">c</span>(2L<span class="op">:</span>nv, 1L)</span>
<span id="cb5-10"><a href="#cb5-10"></a>  j_ &lt;-<span class="st"> </span>1L<span class="op">:</span>nv</span>
<span id="cb5-11"><a href="#cb5-11"></a>  color &lt;-<span class="st"> </span><span class="ot">NULL</span></span>
<span id="cb5-12"><a href="#cb5-12"></a>  <span class="cf">for</span>(i <span class="cf">in</span> 1L<span class="op">:</span>(nu<span class="op">-</span>1L)){</span>
<span id="cb5-13"><a href="#cb5-13"></a>    i_nv &lt;-<span class="st"> </span>i<span class="op">*</span>nv</span>
<span id="cb5-14"><a href="#cb5-14"></a>    vs[, (i_nv <span class="op">-</span><span class="st"> </span>nv <span class="op">+</span><span class="st"> </span>1L)<span class="op">:</span>i_nv] &lt;-<span class="st"> </span><span class="kw">HT</span>(h, nlobes, u_[i], v_)</span>
<span id="cb5-15"><a href="#cb5-15"></a>    color &lt;-<span class="st"> </span><span class="kw">c</span>(</span>
<span id="cb5-16"><a href="#cb5-16"></a>      color,</span>
<span id="cb5-17"><a href="#cb5-17"></a>      <span class="cf">if</span>(<span class="kw">mod</span>(<span class="kw">floor</span>(<span class="dv">10</span> <span class="op">*</span><span class="st"> </span>u_[i] <span class="op">/</span><span class="st"> </span>pi), <span class="dv">2</span>) <span class="op">==</span><span class="st"> </span><span class="dv">0</span>){</span>
<span id="cb5-18"><a href="#cb5-18"></a>        <span class="kw">ifelse</span>(</span>
<span id="cb5-19"><a href="#cb5-19"></a>          <span class="kw">floor</span>(<span class="dv">10</span> <span class="op">*</span><span class="st"> </span>v_ <span class="op">/</span><span class="st"> </span>pi) <span class="op">%%</span><span class="st"> </span><span class="dv">2</span> <span class="op">==</span><span class="st"> </span><span class="dv">0</span>, <span class="st">&quot;yellow&quot;</span>, <span class="st">&quot;navy&quot;</span></span>
<span id="cb5-20"><a href="#cb5-20"></a>        )</span>
<span id="cb5-21"><a href="#cb5-21"></a>      }<span class="cf">else</span>{</span>
<span id="cb5-22"><a href="#cb5-22"></a>        <span class="kw">ifelse</span>(</span>
<span id="cb5-23"><a href="#cb5-23"></a>          <span class="kw">floor</span>(<span class="dv">10</span> <span class="op">*</span><span class="st"> </span>v_ <span class="op">/</span><span class="st"> </span>pi) <span class="op">%%</span><span class="st"> </span><span class="dv">2</span> <span class="op">==</span><span class="st"> </span><span class="dv">0</span>, <span class="st">&quot;navy&quot;</span>, <span class="st">&quot;yellow&quot;</span></span>
<span id="cb5-24"><a href="#cb5-24"></a>        )</span>
<span id="cb5-25"><a href="#cb5-25"></a>      }</span>
<span id="cb5-26"><a href="#cb5-26"></a>    )</span>
<span id="cb5-27"><a href="#cb5-27"></a>    k1 &lt;-<span class="st"> </span>i_nv <span class="op">-</span><span class="st"> </span>nv</span>
<span id="cb5-28"><a href="#cb5-28"></a>    k_ &lt;-<span class="st"> </span>k1 <span class="op">+</span><span class="st"> </span>j_</span>
<span id="cb5-29"><a href="#cb5-29"></a>    l_ &lt;-<span class="st"> </span>k1 <span class="op">+</span><span class="st"> </span>jp1_</span>
<span id="cb5-30"><a href="#cb5-30"></a>    m_ &lt;-<span class="st"> </span>i_nv <span class="op">+</span><span class="st"> </span>j_</span>
<span id="cb5-31"><a href="#cb5-31"></a>    tris1[, k_] &lt;-<span class="st"> </span><span class="kw">rbind</span>(k_, l_, m_)</span>
<span id="cb5-32"><a href="#cb5-32"></a>    tris2[, k_] &lt;-<span class="st"> </span><span class="kw">rbind</span>(l_, i_nv <span class="op">+</span><span class="st"> </span>jp1_, m_)</span>
<span id="cb5-33"><a href="#cb5-33"></a>  }</span>
<span id="cb5-34"><a href="#cb5-34"></a>  i_nv &lt;-<span class="st"> </span>nu<span class="op">*</span>nv</span>
<span id="cb5-35"><a href="#cb5-35"></a>  vs[, (i_nv <span class="op">-</span><span class="st"> </span>nv <span class="op">+</span><span class="st"> </span>1L)<span class="op">:</span>i_nv] &lt;-<span class="st"> </span><span class="kw">HT</span>(h, nlobes, pi, v_)</span>
<span id="cb5-36"><a href="#cb5-36"></a>  color &lt;-<span class="st"> </span><span class="kw">c</span>(</span>
<span id="cb5-37"><a href="#cb5-37"></a>    color,</span>
<span id="cb5-38"><a href="#cb5-38"></a>    <span class="kw">ifelse</span>(</span>
<span id="cb5-39"><a href="#cb5-39"></a>      <span class="kw">floor</span>(<span class="dv">10</span> <span class="op">*</span><span class="st"> </span>v_ <span class="op">/</span><span class="st"> </span>pi) <span class="op">%%</span><span class="st"> </span><span class="dv">2</span> <span class="op">==</span><span class="st"> </span><span class="dv">0</span>, <span class="st">&quot;yellow&quot;</span>, <span class="st">&quot;navy&quot;</span></span>
<span id="cb5-40"><a href="#cb5-40"></a>    )</span>
<span id="cb5-41"><a href="#cb5-41"></a>  )</span>
<span id="cb5-42"><a href="#cb5-42"></a>  k1 &lt;-<span class="st"> </span>i_nv <span class="op">-</span><span class="st"> </span>nv</span>
<span id="cb5-43"><a href="#cb5-43"></a>  k_ &lt;-<span class="st"> </span>k1 <span class="op">+</span><span class="st"> </span>j_</span>
<span id="cb5-44"><a href="#cb5-44"></a>  l_ &lt;-<span class="st"> </span>k1 <span class="op">+</span><span class="st"> </span>jp1_</span>
<span id="cb5-45"><a href="#cb5-45"></a>  tris1[, k_] &lt;-<span class="st"> </span><span class="kw">rbind</span>(k_, l_, j_)</span>
<span id="cb5-46"><a href="#cb5-46"></a>  tris2[, k_] &lt;-<span class="st"> </span><span class="kw">rbind</span>(l_, jp1_, j_)</span>
<span id="cb5-47"><a href="#cb5-47"></a>  <span class="kw">vcgUpdateNormals</span>(<span class="kw">tmesh3d</span>(</span>
<span id="cb5-48"><a href="#cb5-48"></a>    <span class="dt">vertices    =</span> vs,</span>
<span id="cb5-49"><a href="#cb5-49"></a>    <span class="dt">indices     =</span> <span class="kw">cbind</span>(tris1, tris2),</span>
<span id="cb5-50"><a href="#cb5-50"></a>    <span class="dt">homogeneous =</span> <span class="ot">FALSE</span>,</span>
<span id="cb5-51"><a href="#cb5-51"></a>    <span class="dt">material    =</span> <span class="kw">list</span>(<span class="st">&quot;color&quot;</span> =<span class="st"> </span>color) </span>
<span id="cb5-52"><a href="#cb5-52"></a>  ))</span>
<span id="cb5-53"><a href="#cb5-53"></a>}</span>
<span id="cb5-54"><a href="#cb5-54"></a></span>
<span id="cb5-55"><a href="#cb5-55"></a>mesh &lt;-<span class="st"> </span><span class="kw">HopfTorusMesh</span>(<span class="dt">h =</span> <span class="fl">0.4</span>, <span class="dt">nlobes =</span> <span class="dv">4</span>, <span class="dt">nu =</span> <span class="dv">500</span>, <span class="dt">nv =</span> <span class="dv">500</span>)</span>
<span id="cb5-56"><a href="#cb5-56"></a></span>
<span id="cb5-57"><a href="#cb5-57"></a><span class="kw">open3d</span>(<span class="dt">windowRect =</span> <span class="kw">c</span>(<span class="dv">50</span>, <span class="dv">50</span>, <span class="dv">562</span>, <span class="dv">562</span>), <span class="dt">zoom =</span> <span class="fl">0.85</span>)</span>
<span id="cb5-58"><a href="#cb5-58"></a><span class="kw">bg3d</span>(<span class="st">&quot;gainsboro&quot;</span>)</span>
<span id="cb5-59"><a href="#cb5-59"></a><span class="kw">shade3d</span>(mesh)</span></code></pre></div>
<p><img src="./figures/ConformalHopfTorusCheckerboard.gif" style="width:55.0%" /></p>
<p>I really like it.</p>
<h2 id="gray-scott-picture">Gray-Scott picture</h2>
<p>To map the Gray-Scott picture, we proceed as for the donut torus. Here is the result:</p>
<p><img src="./figures/ConformalHopfTorusGrayScott.gif" style="width:55.0%" /></p>

        </div>


        <div id="footer">
          Site proudly generated by
          <a href="http://jaspervdj.be/hakyll">Hakyll</a>
        </div>

      </div>

    </div>

    <div class="row">
      <div class="col-sm-12">
        <div id="disqus_thread"></div>
        <div class="pagination">
          <ul>
            <li>
              <a href="http://laustep.github.io/stlahblog/">&#171; Back Home</a>
            </li>
          </ul>
        </div>
      </div>
    </div>
    
  </div>

</body>

<script src="/libraries/bootstrap/bootstrap.min.js"></script>
<script>
  var disqus_developer = 1;
  var disqus_shortname = 'stlapblog';
  // required: replace example with your forum shortname
  /* * * DON'T EDIT BELOW THIS LINE * * */
  (function () {
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = 'https://' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] ||
      document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>
<noscript>Please enable JavaScript to view the
  <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a>
</noscript>
<!-- MathJax: Fall back to local if CDN offline but local image fonts are not supported (saves >100MB) -->
<script type="text/x-mathjax-config" src="/libraries/mathjax/config/TeX-MML-AM_CHTML.js"></script>
<!-- <script>
  window.MathJax || document.write('<script type="text/x-mathjax-config">MathJax.Hub.Config({"HTML-CSS":{imageFont:null}});<\/script><script src="../libraries/mathjax/MathJax.js"><\/script>');
</script> -->


</html>]]></description>
    <pubDate>Thu, 30 Jun 2022 00:00:00 UT</pubDate>
    <guid>https://laustep.github.io/stlahblog/posts/ConformalTorus.html</guid>
    <dc:creator>Stéphane Laurent</dc:creator>
    <category>R</category>
</item>


<item>
    <title>On a Möbius transformation</title>
    <link>https://laustep.github.io/stlahblog/posts/OnAMobiusTransformation.html</link>
    <description><![CDATA[<!DOCTYPE HTML>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Saturn Elephant - On a Möbius transformation</title>
  <link href="/libraries/bootstrap/bootstrap-grid.min.css" rel="stylesheet">
  <link rel="stylesheet" href="/css/default2.css" />
  <link rel="stylesheet" href="/css/post.css" />
  <link rel="stylesheet" href="/css/misc.css" /> 
  
    <link rel="stylesheet" href="/css/pandoc-solarized.css" /> 
   
  
  <link href="https://fonts.googleapis.com/css?family=Raleway:400,600,200,800" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/css?family=Droid+Sans" rel="stylesheet" type="text/css">
  <script src="/libraries/jquery.min.js"></script>
  <script type="text/javascript" async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML"></script>
</head>

<body>
  <div class="container-fluid">
    <div class="row">
      <!-- Sidebar. -->
      <div class="sidebar col-sm-2">
        <div class="row">
          <div class="col-sm-12" style="float:right;clear:both;margin-right:50px;margin-top:50px;">
            <a href="https://www.r-bloggers.com/">
              <img src="/images/Rbloggers.png" alt="Rbloggers" width="100%" />
            </a>
            <br/>
            <a href="http://t-redactyl.io/">
              <span style="color:black;font-weight:bold;font-family:sans-serif;font-size:25px;">Standard error</span>
            </a>
            <a href="http://timelyportfolio.blogspot.be/">
              <span style="color:grey;font-weight:bold;font-family:sans-serif;font-size:24px;">Timely portfolio</span>
            </a>
            <br/>
            <a href="https://antoineguillot.wordpress.com/blog/">
              <span style="color:white;background-color:darkblue;font-weight:bold;font-family:sans-serif;font-size:21px;border:5px solid;border-color:darkblue">ENHANCE DATA</span>
            </a>
            <br/>
            <a href="https://fronkonstin.com/">
              <span style="color:black;background-color:gold;font-weight:bold;font-size:29px;border:3px solid;border-color:gold;">Fronkonstin</span>
            </a>
          </div>
        </div>
        <div id="logos">
          <div class="row">
            <div class="col-sm-4">
              <img src="/images/AsymptoteLogo.svg" style="width: 150%; transform: rotateZ(-35deg)"/>
            </div>
            <div class="col-sm-4">
              <img src="/images/Rlogo.svg" style="width: 110%;"/>
            </div>
            <div class="col-sm-4">
              <img src="/images/shiny-hex.png" style="width: 90%;"/>
            </div>
          </div>
          <div class="row">
            <div class="col-sm-4">
              <img src="/images/Povray_logo_sphere.png" style="width: 105%;"/>
            </div>
            <div class="col-sm-4">
              <img src="/images/javascript.svg" style="width: 90%;"/>
            </div>
            <div class="col-sm-4">
              <img src="/images/haskell.svg" style="width: 110%;"/>
            </div>
          </div>
        </div>
      </div>

      <div class="main col-sm-10">
        <div id="header">
          <div id="logo">
            <a href="/">
              <img src="/images/stla.jpg" alt="stla" width="100px" />
            </a>
          </div>
          <div id="navigation" style="margin-top:50px;">
            <a href="/">Home</a>
            <a href="/about.html">About</a>
            <a href="/contact.html">Contact</a>
            <a href="/archive.html">Archive</a>
          </div>
        </div>

        <div class="content">
          <h1>On a Möbius transformation</h1> 
          <div class="info">
    Posted on June 21, 2022
    
        by Stéphane Laurent
    
</div>
<div class="info">
    
    Tags: <a title="All pages tagged &#39;R&#39;." href="/tags/R.html">R</a>, <a title="All pages tagged &#39;maths&#39;." href="/tags/maths.html">maths</a>, <a title="All pages tagged &#39;geometry&#39;." href="/tags/geometry.html">geometry</a>, <a title="All pages tagged &#39;graphics&#39;." href="/tags/graphics.html">graphics</a>, <a title="All pages tagged &#39;special-functions&#39;." href="/tags/special-functions.html">special-functions</a>, <a title="All pages tagged &#39;Rcpp&#39;." href="/tags/Rcpp.html">Rcpp</a>
    
</div>

<p>Consider a complex number <span class="math inline">\(\gamma\)</span> such that <span class="math inline">\(|\gamma| &lt; 1\)</span> and the following matrix: <span class="math display">\[
M = \begin{pmatrix}
i &amp; \gamma \\
\bar\gamma &amp; -i
\end{pmatrix}.
\]</span></p>
<p>Then the Möbius transformation associated to this matrix is nice. Why? Because:</p>
<ul>
<li><p>it maps the unit disk to itself;</p></li>
<li><p>it is of order <span class="math inline">\(2\)</span>;</p></li>
<li><p>its fractional powers have a closed form.</p></li>
</ul>
<p>For these reasons, I often use this Möbius transformation in <a href="https://laustep.github.io/stlahblog/frames/shaders_index.html">my shaders</a>.</p>
<p>Let us derive the fractional powers of <span class="math inline">\(M\)</span>. We set <span class="math inline">\(h = \sqrt{1-|\gamma|^2}\)</span>.</p>
<p>The eigenvalues of <span class="math inline">\(M\)</span> are <span class="math display">\[
\begin{align}
\lambda_1 &amp; = -ih \\
\lambda_2 &amp; = ih = \bar{\lambda_1}
\end{align}
\]</span> with corresponding eigen vectors <span class="math display">\[
\begin{align}
v_1 &amp; = \begin{pmatrix} (1-h)\dfrac{i\gamma}{|\gamma|^2} \\ 1 \end{pmatrix} \\
v_2 &amp; = \begin{pmatrix} (1+h)\dfrac{i\gamma}{|\gamma|^2} \\ 1 \end{pmatrix}.
\end{align}
\]</span> Let <span class="math inline">\(P = \begin{pmatrix} v_1 &amp; v_2 \end{pmatrix}\)</span>. Then <span class="math display">\[
\frac{1}{\det(P)} = \frac{i\bar\gamma}{2h}
\]</span> and for any complex numbers <span class="math inline">\(d_1\)</span> and <span class="math inline">\(d_2\)</span>, <span class="math display">\[
P \begin{pmatrix}
 d_1 &amp; 0  \\
 0 &amp; d_2
\end{pmatrix} P^{-1} = 
\frac{1}{2h}
\begin{pmatrix}
d_2(1+h)-d_1(1-h)
  &amp; 
i(d_1-d_2)\gamma
  \\
i(d_1-d_2)\bar\gamma
  &amp; 
d_1(1+h)-d_2(1-h)
\end{pmatrix}.
\]</span></p>
<p>In particular, <span class="math inline">\(M^t\)</span> is given by <span class="math display">\[
\begin{pmatrix}
 a &amp; b  \\
 \bar b &amp; \bar a
\end{pmatrix}
\]</span> where <span class="math display">\[
\begin{align}
a &amp; = \Re(d_1) - i \dfrac{\Im(d_1)}{h}, \\
b &amp; = \gamma \dfrac{\Im(d_2)}{h}, \\
d_1 &amp; = \bar{d_2}, \\
d_2 &amp; = h^t \exp\left(i\dfrac{t\pi}{2}\right).
\end{align}
\]</span></p>
<div class="sourceCode" id="cb1"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a>M_power_t &lt;-<span class="st"> </span><span class="cf">function</span>(gamma, t){</span>
<span id="cb1-2"><a href="#cb1-2"></a>  h &lt;-<span class="st"> </span><span class="kw">sqrt</span>(<span class="dv">1</span><span class="op">-</span><span class="kw">Mod</span>(gamma)<span class="op">^</span><span class="dv">2</span>)</span>
<span id="cb1-3"><a href="#cb1-3"></a>  d2 &lt;-<span class="st"> </span>h<span class="op">^</span>t <span class="op">*</span><span class="st"> </span>(<span class="kw">cos</span>(t<span class="op">*</span>pi<span class="op">/</span><span class="dv">2</span>) <span class="op">+</span><span class="st"> </span>1i<span class="op">*</span><span class="kw">sin</span>(t<span class="op">*</span>pi<span class="op">/</span><span class="dv">2</span>))</span>
<span id="cb1-4"><a href="#cb1-4"></a>  d1 &lt;-<span class="st"> </span><span class="kw">Conj</span>(d2)</span>
<span id="cb1-5"><a href="#cb1-5"></a>  a &lt;-<span class="st"> </span><span class="kw">Re</span>(d1) <span class="op">-</span><span class="st"> </span>1i<span class="op">*</span><span class="kw">Im</span>(d1)<span class="op">/</span>h</span>
<span id="cb1-6"><a href="#cb1-6"></a>  b &lt;-<span class="st"> </span>gamma <span class="op">*</span><span class="st"> </span><span class="kw">Im</span>(d2)<span class="op">/</span>h</span>
<span id="cb1-7"><a href="#cb1-7"></a>  c &lt;-<span class="st"> </span><span class="kw">Conj</span>(b)</span>
<span id="cb1-8"><a href="#cb1-8"></a>  d &lt;-<span class="st"> </span><span class="kw">Conj</span>(a)</span>
<span id="cb1-9"><a href="#cb1-9"></a>  <span class="kw">c</span>(<span class="dt">a =</span> a, <span class="dt">b =</span> b, <span class="dt">c =</span> c, <span class="dt">d =</span> d)</span>
<span id="cb1-10"><a href="#cb1-10"></a>}</span></code></pre></div>
<p>Let’s apply this Möbius transformation now. Here is a visualization of the <em>Dedekind eta function</em>, a complex function availale in the <strong>jacobi</strong> package:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1"></a><span class="co"># background color</span></span>
<span id="cb2-2"><a href="#cb2-2"></a>bkgcol &lt;-<span class="st"> </span><span class="kw">rgb</span>(<span class="dv">21</span>, <span class="dv">25</span>, <span class="dv">30</span>, <span class="dt">maxColorValue =</span> <span class="dv">255</span>)</span>
<span id="cb2-3"><a href="#cb2-3"></a></span>
<span id="cb2-4"><a href="#cb2-4"></a>modulo &lt;-<span class="st"> </span><span class="cf">function</span>(a, p) {</span>
<span id="cb2-5"><a href="#cb2-5"></a>  a <span class="op">-</span><span class="st"> </span>p <span class="op">*</span><span class="st"> </span><span class="kw">ifelse</span>(a <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>, <span class="kw">floor</span>(a<span class="op">/</span>p), <span class="kw">ceiling</span>(a<span class="op">/</span>p))</span>
<span id="cb2-6"><a href="#cb2-6"></a>}</span>
<span id="cb2-7"><a href="#cb2-7"></a></span>
<span id="cb2-8"><a href="#cb2-8"></a>colormap &lt;-<span class="st"> </span><span class="cf">function</span>(z){</span>
<span id="cb2-9"><a href="#cb2-9"></a>  <span class="cf">if</span>(<span class="kw">is.na</span>(z)){</span>
<span id="cb2-10"><a href="#cb2-10"></a>    <span class="kw">return</span>(bkgcol)</span>
<span id="cb2-11"><a href="#cb2-11"></a>  }</span>
<span id="cb2-12"><a href="#cb2-12"></a>  <span class="cf">if</span>(<span class="kw">is.infinite</span>(z) <span class="op">||</span><span class="st"> </span><span class="kw">is.nan</span>(z)){</span>
<span id="cb2-13"><a href="#cb2-13"></a>    <span class="kw">return</span>(<span class="st">&quot;#000000&quot;</span>)</span>
<span id="cb2-14"><a href="#cb2-14"></a>  }</span>
<span id="cb2-15"><a href="#cb2-15"></a>  x &lt;-<span class="st"> </span><span class="kw">Re</span>(z)</span>
<span id="cb2-16"><a href="#cb2-16"></a>  y &lt;-<span class="st"> </span><span class="kw">Im</span>(z)</span>
<span id="cb2-17"><a href="#cb2-17"></a>  r &lt;-<span class="st"> </span><span class="kw">modulo</span>(<span class="kw">Mod</span>(z), <span class="dv">1</span>)</span>
<span id="cb2-18"><a href="#cb2-18"></a>  g &lt;-<span class="st"> </span><span class="dv">2</span> <span class="op">*</span><span class="st"> </span><span class="kw">abs</span>(<span class="kw">modulo</span>(<span class="kw">atan2</span>(y, x), <span class="fl">0.5</span>))</span>
<span id="cb2-19"><a href="#cb2-19"></a>  b &lt;-<span class="st"> </span><span class="kw">abs</span>(<span class="kw">modulo</span>(x<span class="op">*</span>y, <span class="dv">1</span>))</span>
<span id="cb2-20"><a href="#cb2-20"></a>  <span class="cf">if</span>(<span class="kw">is.nan</span>(b)){</span>
<span id="cb2-21"><a href="#cb2-21"></a>    <span class="kw">return</span>(<span class="st">&quot;#000000&quot;</span>)</span>
<span id="cb2-22"><a href="#cb2-22"></a>  }</span>
<span id="cb2-23"><a href="#cb2-23"></a>  <span class="kw">rgb</span>(</span>
<span id="cb2-24"><a href="#cb2-24"></a>    <span class="dv">8</span> <span class="op">*</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">-</span><span class="st"> </span><span class="kw">cos</span>(r<span class="fl">-0.5</span>)), </span>
<span id="cb2-25"><a href="#cb2-25"></a>    <span class="dv">8</span> <span class="op">*</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">-</span><span class="st"> </span><span class="kw">cos</span>(g<span class="fl">-0.5</span>)), </span>
<span id="cb2-26"><a href="#cb2-26"></a>    <span class="dv">8</span> <span class="op">*</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">-</span><span class="st"> </span><span class="kw">cos</span>(b<span class="fl">-0.5</span>)),</span>
<span id="cb2-27"><a href="#cb2-27"></a>    <span class="dt">maxColorValue =</span> <span class="dv">1</span></span>
<span id="cb2-28"><a href="#cb2-28"></a>  )</span>
<span id="cb2-29"><a href="#cb2-29"></a>}</span>
<span id="cb2-30"><a href="#cb2-30"></a></span>
<span id="cb2-31"><a href="#cb2-31"></a><span class="kw">library</span>(jacobi)</span>
<span id="cb2-32"><a href="#cb2-32"></a>f &lt;-<span class="st"> </span><span class="kw">Vectorize</span>(<span class="cf">function</span>(x, y){</span>
<span id="cb2-33"><a href="#cb2-33"></a>  q &lt;-<span class="st"> </span>x <span class="op">+</span><span class="st"> </span>1i<span class="op">*</span>y</span>
<span id="cb2-34"><a href="#cb2-34"></a>  <span class="cf">if</span>(<span class="kw">Mod</span>(q) <span class="op">&gt;</span><span class="st"> </span><span class="fl">0.9999</span> <span class="op">||</span><span class="st"> </span>(<span class="kw">Im</span>(q) <span class="op">==</span><span class="st"> </span><span class="dv">0</span> <span class="op">&amp;&amp;</span><span class="st"> </span><span class="kw">Re</span>(q) <span class="op">&lt;=</span><span class="st"> </span><span class="dv">0</span>)){</span>
<span id="cb2-35"><a href="#cb2-35"></a>    <span class="kw">return</span>(bkgcol)</span>
<span id="cb2-36"><a href="#cb2-36"></a>  }</span>
<span id="cb2-37"><a href="#cb2-37"></a>  tau &lt;-<span class="st"> </span><span class="op">-</span>1i <span class="op">*</span><span class="st"> </span><span class="kw">log</span>(q) <span class="op">/</span><span class="st"> </span>pi</span>
<span id="cb2-38"><a href="#cb2-38"></a>  z &lt;-<span class="st"> </span><span class="kw">eta</span>(tau)</span>
<span id="cb2-39"><a href="#cb2-39"></a>  <span class="kw">colormap</span>(z)</span>
<span id="cb2-40"><a href="#cb2-40"></a>})</span>
<span id="cb2-41"><a href="#cb2-41"></a></span>
<span id="cb2-42"><a href="#cb2-42"></a>x &lt;-<span class="st"> </span>y &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="op">-</span><span class="dv">1</span>, <span class="dv">1</span>, <span class="dt">len =</span> <span class="dv">2000</span>)</span>
<span id="cb2-43"><a href="#cb2-43"></a>image &lt;-<span class="st"> </span><span class="kw">outer</span>(x, y, f)</span>
<span id="cb2-44"><a href="#cb2-44"></a></span>
<span id="cb2-45"><a href="#cb2-45"></a>opar &lt;-<span class="st"> </span><span class="kw">par</span>(<span class="dt">mar =</span> <span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>), <span class="dt">bg =</span> bkgcol)</span>
<span id="cb2-46"><a href="#cb2-46"></a><span class="kw">plot</span>(</span>
<span id="cb2-47"><a href="#cb2-47"></a>  <span class="kw">c</span>(<span class="op">-</span><span class="dv">100</span>, <span class="dv">100</span>), <span class="kw">c</span>(<span class="op">-</span><span class="dv">100</span>, <span class="dv">100</span>), <span class="dt">type =</span> <span class="st">&quot;n&quot;</span>, </span>
<span id="cb2-48"><a href="#cb2-48"></a>  <span class="dt">xlab =</span> <span class="st">&quot;&quot;</span>, <span class="dt">ylab =</span> <span class="st">&quot;&quot;</span>, <span class="dt">axes =</span> <span class="ot">FALSE</span>, <span class="dt">asp =</span> <span class="dv">1</span></span>
<span id="cb2-49"><a href="#cb2-49"></a>)</span>
<span id="cb2-50"><a href="#cb2-50"></a><span class="kw">rasterImage</span>(image, <span class="dv">-100</span>, <span class="dv">-100</span>, <span class="dv">100</span>, <span class="dv">100</span>)</span>
<span id="cb2-51"><a href="#cb2-51"></a><span class="kw">par</span>(opar)</span></code></pre></div>
<p><img src="./figures/Dedekind.png" style="width:55.0%" /></p>
<p>Here is how to apply the Möbius transformation for one value of the power <span class="math inline">\(t\)</span>:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a>Mobius &lt;-<span class="st"> </span><span class="kw">M_power_t</span>(<span class="dt">gamma =</span> <span class="fl">0.7</span> <span class="op">-</span><span class="st"> </span><span class="fl">0.3</span>i, <span class="dt">t =</span> ...)</span>
<span id="cb3-2"><a href="#cb3-2"></a>a &lt;-<span class="st"> </span>Mobius[<span class="st">&quot;a&quot;</span>]</span>
<span id="cb3-3"><a href="#cb3-3"></a>b &lt;-<span class="st"> </span>Mobius[<span class="st">&quot;b&quot;</span>]</span>
<span id="cb3-4"><a href="#cb3-4"></a>c &lt;-<span class="st"> </span>Mobius[<span class="st">&quot;c&quot;</span>]</span>
<span id="cb3-5"><a href="#cb3-5"></a>d &lt;-<span class="st"> </span>Mobius[<span class="st">&quot;d&quot;</span>]; </span>
<span id="cb3-6"><a href="#cb3-6"></a>f &lt;-<span class="st"> </span><span class="kw">Vectorize</span>(<span class="cf">function</span>(x, y){</span>
<span id="cb3-7"><a href="#cb3-7"></a>  q0 &lt;-<span class="st"> </span>x <span class="op">+</span><span class="st"> </span>1i<span class="op">*</span>y</span>
<span id="cb3-8"><a href="#cb3-8"></a>  q &lt;-<span class="st"> </span>(a<span class="op">*</span>q0 <span class="op">+</span><span class="st"> </span>b) <span class="op">/</span><span class="st"> </span>(c<span class="op">*</span>q0 <span class="op">+</span><span class="st"> </span>d)</span>
<span id="cb3-9"><a href="#cb3-9"></a>  <span class="cf">if</span>(<span class="kw">Mod</span>(q) <span class="op">&gt;</span><span class="st"> </span><span class="fl">0.9999</span> <span class="op">||</span><span class="st"> </span>(<span class="kw">Im</span>(q) <span class="op">==</span><span class="st"> </span><span class="dv">0</span> <span class="op">&amp;&amp;</span><span class="st"> </span><span class="kw">Re</span>(q) <span class="op">&lt;=</span><span class="st"> </span><span class="dv">0</span>)){</span>
<span id="cb3-10"><a href="#cb3-10"></a>    <span class="kw">return</span>(bkgcol)</span>
<span id="cb3-11"><a href="#cb3-11"></a>  }</span>
<span id="cb3-12"><a href="#cb3-12"></a>  tau &lt;-<span class="st"> </span><span class="op">-</span>1i <span class="op">*</span><span class="st"> </span><span class="kw">log</span>(q) <span class="op">/</span><span class="st"> </span>pi</span>
<span id="cb3-13"><a href="#cb3-13"></a>  z &lt;-<span class="st"> </span><span class="kw">eta</span>(tau)</span>
<span id="cb3-14"><a href="#cb3-14"></a>  <span class="kw">colormap</span>(z)</span>
<span id="cb3-15"><a href="#cb3-15"></a>})</span>
<span id="cb3-16"><a href="#cb3-16"></a></span>
<span id="cb3-17"><a href="#cb3-17"></a>x &lt;-<span class="st"> </span>y &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="op">-</span><span class="dv">1</span>, <span class="dv">1</span>, <span class="dt">len =</span> <span class="dv">2000</span>)</span>
<span id="cb3-18"><a href="#cb3-18"></a>image &lt;-<span class="st"> </span><span class="kw">outer</span>(x, y, f)</span></code></pre></div>
<p>Then it suffices to run this code for <span class="math inline">\(t\)</span> varying from <span class="math inline">\(0\)</span> to <span class="math inline">\(2\)</span>, and to save the image for each value of <span class="math inline">\(t\)</span>. But this would be very slow. Actually I implemented the image generation with <strong>Rcpp</strong>. Here is the result:</p>
<p><img src="./figures/Dedekind.gif" style="width:55.0%" /></p>
<p>My <strong>Rcpp</strong> code is available in the <a href="https://github.com/stla/jacobi">Github version</a> of the <strong>jacobi</strong> package. The R code which generates an image for one value of <span class="math inline">\(t\)</span> is:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1"></a>x &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="op">-</span><span class="dv">1</span>, <span class="dv">1</span>, <span class="dt">len =</span> 2000L)</span>
<span id="cb4-2"><a href="#cb4-2"></a>gamma &lt;-<span class="st"> </span><span class="fl">0.7</span> <span class="op">-</span><span class="st"> </span><span class="fl">0.3</span>i</span>
<span id="cb4-3"><a href="#cb4-3"></a>t &lt;-<span class="st"> </span>...</span>
<span id="cb4-4"><a href="#cb4-4"></a>image &lt;-<span class="st"> </span>jacobi<span class="op">:::</span><span class="kw">Image_eta</span>(x, gamma, t)</span>
<span id="cb4-5"><a href="#cb4-5"></a>opar &lt;-<span class="st"> </span><span class="kw">par</span>(<span class="dt">mar =</span> <span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>), <span class="dt">bg =</span> bkgcol)</span>
<span id="cb4-6"><a href="#cb4-6"></a><span class="kw">plot</span>(</span>
<span id="cb4-7"><a href="#cb4-7"></a>  <span class="kw">c</span>(<span class="op">-</span><span class="dv">100</span>, <span class="dv">100</span>), <span class="kw">c</span>(<span class="op">-</span><span class="dv">100</span>, <span class="dv">100</span>), <span class="dt">type =</span> <span class="st">&quot;n&quot;</span>, </span>
<span id="cb4-8"><a href="#cb4-8"></a>  <span class="dt">xlab =</span> <span class="st">&quot;&quot;</span>, <span class="dt">ylab =</span> <span class="st">&quot;&quot;</span>, <span class="dt">axes =</span> <span class="ot">FALSE</span>, <span class="dt">asp =</span> <span class="dv">1</span></span>
<span id="cb4-9"><a href="#cb4-9"></a>)</span>
<span id="cb4-10"><a href="#cb4-10"></a><span class="kw">rasterImage</span>(image, <span class="dv">-100</span>, <span class="dv">-100</span>, <span class="dv">100</span>, <span class="dv">100</span>)</span>
<span id="cb4-11"><a href="#cb4-11"></a><span class="kw">par</span>(opar)</span></code></pre></div>
<p>You can also play with <code>jacobi:::Image_E4</code> and <code>jacobi:::Image_E6</code>, which respectively generate a visualization of the Eisenstein series of weight <span class="math inline">\(4\)</span> and a visualization of the Eisenstein series of weight <span class="math inline">\(6\)</span>.</p>

        </div>


        <div id="footer">
          Site proudly generated by
          <a href="http://jaspervdj.be/hakyll">Hakyll</a>
        </div>

      </div>

    </div>

    <div class="row">
      <div class="col-sm-12">
        <div id="disqus_thread"></div>
        <div class="pagination">
          <ul>
            <li>
              <a href="http://laustep.github.io/stlahblog/">&#171; Back Home</a>
            </li>
          </ul>
        </div>
      </div>
    </div>
    
  </div>

</body>

<script src="/libraries/bootstrap/bootstrap.min.js"></script>
<script>
  var disqus_developer = 1;
  var disqus_shortname = 'stlapblog';
  // required: replace example with your forum shortname
  /* * * DON'T EDIT BELOW THIS LINE * * */
  (function () {
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = 'https://' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] ||
      document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>
<noscript>Please enable JavaScript to view the
  <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a>
</noscript>
<!-- MathJax: Fall back to local if CDN offline but local image fonts are not supported (saves >100MB) -->
<script type="text/x-mathjax-config" src="/libraries/mathjax/config/TeX-MML-AM_CHTML.js"></script>
<!-- <script>
  window.MathJax || document.write('<script type="text/x-mathjax-config">MathJax.Hub.Config({"HTML-CSS":{imageFont:null}});<\/script><script src="../libraries/mathjax/MathJax.js"><\/script>');
</script> -->


</html>]]></description>
    <pubDate>Tue, 21 Jun 2022 00:00:00 UT</pubDate>
    <guid>https://laustep.github.io/stlahblog/posts/OnAMobiusTransformation.html</guid>
    <dc:creator>Stéphane Laurent</dc:creator>
    <category>R</category>
</item>


<item>
    <title>Beautiful complex functions</title>
    <link>https://laustep.github.io/stlahblog/posts/beautifulComplexFunctions.html</link>
    <description><![CDATA[<!DOCTYPE HTML>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Saturn Elephant - Beautiful complex functions</title>
  <link href="/libraries/bootstrap/bootstrap-grid.min.css" rel="stylesheet">
  <link rel="stylesheet" href="/css/default2.css" />
  <link rel="stylesheet" href="/css/post.css" />
  <link rel="stylesheet" href="/css/misc.css" /> 
  
    <link rel="stylesheet" href="/css/pandoc-solarized.css" /> 
   
  
  <link href="https://fonts.googleapis.com/css?family=Raleway:400,600,200,800" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/css?family=Droid+Sans" rel="stylesheet" type="text/css">
  <script src="/libraries/jquery.min.js"></script>
  <script type="text/javascript" async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML"></script>
</head>

<body>
  <div class="container-fluid">
    <div class="row">
      <!-- Sidebar. -->
      <div class="sidebar col-sm-2">
        <div class="row">
          <div class="col-sm-12" style="float:right;clear:both;margin-right:50px;margin-top:50px;">
            <a href="https://www.r-bloggers.com/">
              <img src="/images/Rbloggers.png" alt="Rbloggers" width="100%" />
            </a>
            <br/>
            <a href="http://t-redactyl.io/">
              <span style="color:black;font-weight:bold;font-family:sans-serif;font-size:25px;">Standard error</span>
            </a>
            <a href="http://timelyportfolio.blogspot.be/">
              <span style="color:grey;font-weight:bold;font-family:sans-serif;font-size:24px;">Timely portfolio</span>
            </a>
            <br/>
            <a href="https://antoineguillot.wordpress.com/blog/">
              <span style="color:white;background-color:darkblue;font-weight:bold;font-family:sans-serif;font-size:21px;border:5px solid;border-color:darkblue">ENHANCE DATA</span>
            </a>
            <br/>
            <a href="https://fronkonstin.com/">
              <span style="color:black;background-color:gold;font-weight:bold;font-size:29px;border:3px solid;border-color:gold;">Fronkonstin</span>
            </a>
          </div>
        </div>
        <div id="logos">
          <div class="row">
            <div class="col-sm-4">
              <img src="/images/AsymptoteLogo.svg" style="width: 150%; transform: rotateZ(-35deg)"/>
            </div>
            <div class="col-sm-4">
              <img src="/images/Rlogo.svg" style="width: 110%;"/>
            </div>
            <div class="col-sm-4">
              <img src="/images/shiny-hex.png" style="width: 90%;"/>
            </div>
          </div>
          <div class="row">
            <div class="col-sm-4">
              <img src="/images/Povray_logo_sphere.png" style="width: 105%;"/>
            </div>
            <div class="col-sm-4">
              <img src="/images/javascript.svg" style="width: 90%;"/>
            </div>
            <div class="col-sm-4">
              <img src="/images/haskell.svg" style="width: 110%;"/>
            </div>
          </div>
        </div>
      </div>

      <div class="main col-sm-10">
        <div id="header">
          <div id="logo">
            <a href="/">
              <img src="/images/stla.jpg" alt="stla" width="100px" />
            </a>
          </div>
          <div id="navigation" style="margin-top:50px;">
            <a href="/">Home</a>
            <a href="/about.html">About</a>
            <a href="/contact.html">Contact</a>
            <a href="/archive.html">Archive</a>
          </div>
        </div>

        <div class="content">
          <h1>Beautiful complex functions</h1> 
          <div class="info">
    Posted on June 20, 2022
    
        by Stéphane Laurent
    
</div>
<div class="info">
    
    Tags: <a title="All pages tagged &#39;R&#39;." href="/tags/R.html">R</a>, <a title="All pages tagged &#39;maths&#39;." href="/tags/maths.html">maths</a>, <a title="All pages tagged &#39;graphics&#39;." href="/tags/graphics.html">graphics</a>, <a title="All pages tagged &#39;special-functions&#39;." href="/tags/special-functions.html">special-functions</a>
    
</div>

<p>I’ve just submitted a new package to CRAN: <strong>jacobi</strong>. It allows to evaluate the Jacobi theta functions as well as some related functions. In particular, some Eisenstein series, that you will see below.</p>
<p>To represent a complex function, a color map is needed, that is to say a function which maps each complex number to a color. I’m using two different color maps:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a>modulo &lt;-<span class="st"> </span><span class="cf">function</span>(a, p) {</span>
<span id="cb1-2"><a href="#cb1-2"></a>  a <span class="op">-</span><span class="st"> </span>p <span class="op">*</span><span class="st"> </span><span class="kw">ifelse</span>(a <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>, <span class="kw">floor</span>(a<span class="op">/</span>p), <span class="kw">ceiling</span>(a<span class="op">/</span>p))</span>
<span id="cb1-3"><a href="#cb1-3"></a>}</span>
<span id="cb1-4"><a href="#cb1-4"></a></span>
<span id="cb1-5"><a href="#cb1-5"></a>colormap1 &lt;-<span class="st"> </span><span class="cf">function</span>(z){</span>
<span id="cb1-6"><a href="#cb1-6"></a>  <span class="cf">if</span>(<span class="kw">is.infinite</span>(z) <span class="op">||</span><span class="st"> </span><span class="kw">is.nan</span>(z)) <span class="kw">return</span>(<span class="st">&quot;#000000&quot;</span>)</span>
<span id="cb1-7"><a href="#cb1-7"></a>  x &lt;-<span class="st"> </span><span class="kw">Re</span>(z)</span>
<span id="cb1-8"><a href="#cb1-8"></a>  y &lt;-<span class="st"> </span><span class="kw">Im</span>(z)</span>
<span id="cb1-9"><a href="#cb1-9"></a>  a &lt;-<span class="st"> </span><span class="kw">atan2</span>(y, x)</span>
<span id="cb1-10"><a href="#cb1-10"></a>  r &lt;-<span class="st"> </span><span class="kw">modulo</span>(<span class="kw">Mod</span>(z), <span class="dv">1</span>)</span>
<span id="cb1-11"><a href="#cb1-11"></a>  g &lt;-<span class="st"> </span><span class="kw">abs</span>(<span class="kw">modulo</span>(a, <span class="fl">0.5</span>)) <span class="op">*</span><span class="st"> </span><span class="dv">2</span></span>
<span id="cb1-12"><a href="#cb1-12"></a>  b &lt;-<span class="st"> </span><span class="kw">abs</span>(<span class="kw">modulo</span>(x<span class="op">*</span>y, <span class="dv">1</span>))</span>
<span id="cb1-13"><a href="#cb1-13"></a>  <span class="cf">if</span>(<span class="kw">is.nan</span>(b)){</span>
<span id="cb1-14"><a href="#cb1-14"></a>    <span class="kw">return</span>(<span class="st">&quot;#000000&quot;</span>)</span>
<span id="cb1-15"><a href="#cb1-15"></a>  }</span>
<span id="cb1-16"><a href="#cb1-16"></a>  <span class="kw">rgb</span>(</span>
<span id="cb1-17"><a href="#cb1-17"></a>    (<span class="fl">1.0</span> <span class="op">-</span><span class="st"> </span><span class="kw">cos</span>(r<span class="fl">-0.5</span>))<span class="op">*</span><span class="fl">8.0</span>, </span>
<span id="cb1-18"><a href="#cb1-18"></a>    (<span class="fl">1.0</span> <span class="op">-</span><span class="st"> </span><span class="kw">cos</span>(g<span class="fl">-0.5</span>))<span class="op">*</span><span class="fl">8.0</span>, </span>
<span id="cb1-19"><a href="#cb1-19"></a>    (<span class="fl">1.0</span> <span class="op">-</span><span class="st"> </span><span class="kw">cos</span>(b<span class="fl">-0.5</span>))<span class="op">*</span><span class="fl">8.0</span>,</span>
<span id="cb1-20"><a href="#cb1-20"></a>    <span class="dt">maxColorValue =</span> <span class="dv">1</span></span>
<span id="cb1-21"><a href="#cb1-21"></a>  )</span>
<span id="cb1-22"><a href="#cb1-22"></a>}</span>
<span id="cb1-23"><a href="#cb1-23"></a></span>
<span id="cb1-24"><a href="#cb1-24"></a>colormap2 &lt;-<span class="st"> </span><span class="cf">function</span>(z){</span>
<span id="cb1-25"><a href="#cb1-25"></a>  <span class="cf">if</span>(<span class="kw">is.infinite</span>(z) <span class="op">||</span><span class="st"> </span><span class="kw">is.nan</span>(z)) <span class="kw">return</span>(<span class="st">&quot;#000000&quot;</span>)</span>
<span id="cb1-26"><a href="#cb1-26"></a>  arg &lt;-<span class="st"> </span><span class="kw">Arg</span>(z)</span>
<span id="cb1-27"><a href="#cb1-27"></a>  <span class="cf">if</span>(arg <span class="op">&lt;</span><span class="st"> </span><span class="dv">0</span>) arg &lt;-<span class="st"> </span><span class="dv">2</span><span class="op">*</span>pi <span class="op">+</span><span class="st"> </span>arg</span>
<span id="cb1-28"><a href="#cb1-28"></a>  h &lt;-<span class="st"> </span>arg <span class="op">/</span><span class="st"> </span><span class="dv">2</span> <span class="op">/</span><span class="st"> </span>pi</span>
<span id="cb1-29"><a href="#cb1-29"></a>  s &lt;-<span class="st"> </span><span class="kw">sqrt</span>((<span class="dv">1</span> <span class="op">+</span><span class="st"> </span><span class="kw">sin</span>(<span class="dv">2</span><span class="op">*</span>pi<span class="op">*</span><span class="kw">log</span>(<span class="dv">1</span><span class="op">+</span><span class="kw">Mod</span>(z))))<span class="op">/</span><span class="dv">2</span>)</span>
<span id="cb1-30"><a href="#cb1-30"></a>  v &lt;-<span class="st"> </span>(<span class="dv">1</span> <span class="op">+</span><span class="st"> </span><span class="kw">cos</span>(<span class="dv">2</span><span class="op">*</span>pi<span class="op">*</span><span class="kw">log</span>(<span class="dv">1</span><span class="op">+</span><span class="kw">Mod</span>(z))))<span class="op">/</span><span class="dv">2</span></span>
<span id="cb1-31"><a href="#cb1-31"></a>  <span class="kw">hsv</span>(h, s, v)</span>
<span id="cb1-32"><a href="#cb1-32"></a>}</span></code></pre></div>
<p>Here is the <span class="math inline">\(E_4\)</span> Eisenstein series:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1"></a><span class="co"># background color</span></span>
<span id="cb2-2"><a href="#cb2-2"></a>bkgcol &lt;-<span class="st"> </span><span class="kw">rgb</span>(<span class="dv">21</span>, <span class="dv">25</span>, <span class="dv">30</span>, <span class="dt">maxColorValue =</span> <span class="dv">255</span>)</span>
<span id="cb2-3"><a href="#cb2-3"></a></span>
<span id="cb2-4"><a href="#cb2-4"></a>f &lt;-<span class="st"> </span><span class="kw">Vectorize</span>(<span class="cf">function</span>(x, y){</span>
<span id="cb2-5"><a href="#cb2-5"></a>  q &lt;-<span class="st"> </span>x <span class="op">+</span><span class="st"> </span>1i<span class="op">*</span>y</span>
<span id="cb2-6"><a href="#cb2-6"></a>  <span class="cf">if</span>(<span class="kw">Mod</span>(q) <span class="op">&gt;=</span><span class="st"> </span><span class="fl">0.99</span> <span class="op">||</span><span class="st"> </span>(<span class="kw">Im</span>(q) <span class="op">==</span><span class="st"> </span><span class="dv">0</span> <span class="op">&amp;&amp;</span><span class="st"> </span><span class="kw">Re</span>(q) <span class="op">&lt;=</span><span class="st"> </span><span class="dv">0</span>)) <span class="kw">return</span>(bkgcol)</span>
<span id="cb2-7"><a href="#cb2-7"></a>  z &lt;-<span class="st"> </span><span class="kw">En</span>(<span class="dv">4</span>, q)</span>
<span id="cb2-8"><a href="#cb2-8"></a>  <span class="kw">colormap1</span>(<span class="dv">1</span><span class="op">/</span>z)</span>
<span id="cb2-9"><a href="#cb2-9"></a>})</span>
<span id="cb2-10"><a href="#cb2-10"></a></span>
<span id="cb2-11"><a href="#cb2-11"></a>x &lt;-<span class="st"> </span>y &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="op">-</span><span class="dv">1</span>, <span class="dv">1</span>, <span class="dt">len =</span> <span class="dv">2000</span>)</span>
<span id="cb2-12"><a href="#cb2-12"></a>image &lt;-<span class="st"> </span><span class="kw">outer</span>(x, y, f)</span>
<span id="cb2-13"><a href="#cb2-13"></a></span>
<span id="cb2-14"><a href="#cb2-14"></a>opar &lt;-<span class="st"> </span><span class="kw">par</span>(<span class="dt">mar =</span> <span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>), <span class="dt">bg =</span> bkgcol)</span>
<span id="cb2-15"><a href="#cb2-15"></a><span class="kw">plot</span>(</span>
<span id="cb2-16"><a href="#cb2-16"></a>  <span class="kw">c</span>(<span class="op">-</span><span class="dv">100</span>, <span class="dv">100</span>), <span class="kw">c</span>(<span class="op">-</span><span class="dv">100</span>, <span class="dv">100</span>), <span class="dt">type =</span> <span class="st">&quot;n&quot;</span>, </span>
<span id="cb2-17"><a href="#cb2-17"></a>  <span class="dt">xlab =</span> <span class="st">&quot;&quot;</span>, <span class="dt">ylab =</span> <span class="st">&quot;&quot;</span>, <span class="dt">axes =</span> <span class="ot">FALSE</span>, <span class="dt">asp =</span> <span class="dv">1</span></span>
<span id="cb2-18"><a href="#cb2-18"></a>)</span>
<span id="cb2-19"><a href="#cb2-19"></a><span class="kw">rasterImage</span>(image, <span class="dv">-100</span>, <span class="dv">-100</span>, <span class="dv">100</span>, <span class="dv">100</span>)</span>
<span id="cb2-20"><a href="#cb2-20"></a><span class="kw">par</span>(opar)</span></code></pre></div>
<p><img src="./figures/Eisenstein4.png" style="width:55.0%" /></p>
<p>It makes me think to a beetle.</p>
<p>And here is the <span class="math inline">\(E_6\)</span> Eisenstein series:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a>f &lt;-<span class="st"> </span><span class="kw">Vectorize</span>(<span class="cf">function</span>(x, y){</span>
<span id="cb3-2"><a href="#cb3-2"></a>  q &lt;-<span class="st"> </span>x <span class="op">+</span><span class="st"> </span>1i<span class="op">*</span>y</span>
<span id="cb3-3"><a href="#cb3-3"></a>  <span class="cf">if</span>(<span class="kw">Mod</span>(q) <span class="op">&gt;=</span><span class="st"> </span><span class="fl">0.99</span> <span class="op">||</span><span class="st"> </span>(<span class="kw">Im</span>(q) <span class="op">==</span><span class="st"> </span><span class="dv">0</span> <span class="op">&amp;&amp;</span><span class="st"> </span><span class="kw">Re</span>(q) <span class="op">&lt;=</span><span class="st"> </span><span class="dv">0</span>)) <span class="kw">return</span>(bkgcol)</span>
<span id="cb3-4"><a href="#cb3-4"></a>  z &lt;-<span class="st"> </span><span class="kw">En</span>(<span class="dv">6</span>, q)</span>
<span id="cb3-5"><a href="#cb3-5"></a>  <span class="kw">colormap2</span>(z)</span>
<span id="cb3-6"><a href="#cb3-6"></a>})</span></code></pre></div>
<p><img src="./figures/Eisenstein6.png" style="width:55.0%" /></p>

        </div>


        <div id="footer">
          Site proudly generated by
          <a href="http://jaspervdj.be/hakyll">Hakyll</a>
        </div>

      </div>

    </div>

    <div class="row">
      <div class="col-sm-12">
        <div id="disqus_thread"></div>
        <div class="pagination">
          <ul>
            <li>
              <a href="http://laustep.github.io/stlahblog/">&#171; Back Home</a>
            </li>
          </ul>
        </div>
      </div>
    </div>
    
  </div>

</body>

<script src="/libraries/bootstrap/bootstrap.min.js"></script>
<script>
  var disqus_developer = 1;
  var disqus_shortname = 'stlapblog';
  // required: replace example with your forum shortname
  /* * * DON'T EDIT BELOW THIS LINE * * */
  (function () {
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = 'https://' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] ||
      document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>
<noscript>Please enable JavaScript to view the
  <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a>
</noscript>
<!-- MathJax: Fall back to local if CDN offline but local image fonts are not supported (saves >100MB) -->
<script type="text/x-mathjax-config" src="/libraries/mathjax/config/TeX-MML-AM_CHTML.js"></script>
<!-- <script>
  window.MathJax || document.write('<script type="text/x-mathjax-config">MathJax.Hub.Config({"HTML-CSS":{imageFont:null}});<\/script><script src="../libraries/mathjax/MathJax.js"><\/script>');
</script> -->


</html>]]></description>
    <pubDate>Mon, 20 Jun 2022 00:00:00 UT</pubDate>
    <guid>https://laustep.github.io/stlahblog/posts/beautifulComplexFunctions.html</guid>
    <dc:creator>Stéphane Laurent</dc:creator>
    <category>R</category>
</item>


<item>
    <title>Scrollbar for the Shiny sidebar</title>
    <link>https://laustep.github.io/stlahblog/posts/shinySidebarScrollbar.html</link>
    <description><![CDATA[<!DOCTYPE HTML>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Saturn Elephant - Scrollbar for the Shiny sidebar</title>
  <link href="/libraries/bootstrap/bootstrap-grid.min.css" rel="stylesheet">
  <link rel="stylesheet" href="/css/default2.css" />
  <link rel="stylesheet" href="/css/post.css" />
  <link rel="stylesheet" href="/css/misc.css" /> 
  
    <link rel="stylesheet" href="/css/pandoc-solarized.css" /> 
   
  
  <link href="https://fonts.googleapis.com/css?family=Raleway:400,600,200,800" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/css?family=Droid+Sans" rel="stylesheet" type="text/css">
  <script src="/libraries/jquery.min.js"></script>
  <script type="text/javascript" async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML"></script>
</head>

<body>
  <div class="container-fluid">
    <div class="row">
      <!-- Sidebar. -->
      <div class="sidebar col-sm-2">
        <div class="row">
          <div class="col-sm-12" style="float:right;clear:both;margin-right:50px;margin-top:50px;">
            <a href="https://www.r-bloggers.com/">
              <img src="/images/Rbloggers.png" alt="Rbloggers" width="100%" />
            </a>
            <br/>
            <a href="http://t-redactyl.io/">
              <span style="color:black;font-weight:bold;font-family:sans-serif;font-size:25px;">Standard error</span>
            </a>
            <a href="http://timelyportfolio.blogspot.be/">
              <span style="color:grey;font-weight:bold;font-family:sans-serif;font-size:24px;">Timely portfolio</span>
            </a>
            <br/>
            <a href="https://antoineguillot.wordpress.com/blog/">
              <span style="color:white;background-color:darkblue;font-weight:bold;font-family:sans-serif;font-size:21px;border:5px solid;border-color:darkblue">ENHANCE DATA</span>
            </a>
            <br/>
            <a href="https://fronkonstin.com/">
              <span style="color:black;background-color:gold;font-weight:bold;font-size:29px;border:3px solid;border-color:gold;">Fronkonstin</span>
            </a>
          </div>
        </div>
        <div id="logos">
          <div class="row">
            <div class="col-sm-4">
              <img src="/images/AsymptoteLogo.svg" style="width: 150%; transform: rotateZ(-35deg)"/>
            </div>
            <div class="col-sm-4">
              <img src="/images/Rlogo.svg" style="width: 110%;"/>
            </div>
            <div class="col-sm-4">
              <img src="/images/shiny-hex.png" style="width: 90%;"/>
            </div>
          </div>
          <div class="row">
            <div class="col-sm-4">
              <img src="/images/Povray_logo_sphere.png" style="width: 105%;"/>
            </div>
            <div class="col-sm-4">
              <img src="/images/javascript.svg" style="width: 90%;"/>
            </div>
            <div class="col-sm-4">
              <img src="/images/haskell.svg" style="width: 110%;"/>
            </div>
          </div>
        </div>
      </div>

      <div class="main col-sm-10">
        <div id="header">
          <div id="logo">
            <a href="/">
              <img src="/images/stla.jpg" alt="stla" width="100px" />
            </a>
          </div>
          <div id="navigation" style="margin-top:50px;">
            <a href="/">Home</a>
            <a href="/about.html">About</a>
            <a href="/contact.html">Contact</a>
            <a href="/archive.html">Archive</a>
          </div>
        </div>

        <div class="content">
          <h1>Scrollbar for the Shiny sidebar</h1> 
          <div class="info">
    Posted on June 17, 2022
    
        by Stéphane Laurent
    
</div>
<div class="info">
    
    Tags: <a title="All pages tagged &#39;R&#39;." href="/tags/R.html">R</a>, <a title="All pages tagged &#39;shiny&#39;." href="/tags/shiny.html">shiny</a>, <a title="All pages tagged &#39;javascript&#39;." href="/tags/javascript.html">javascript</a>
    
</div>

<p>It is easy to have a scrollbar for the sidebar of a Shiny app: one just has to use the CSS <code>height: 90vh; overflow-y: auto;</code>:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a><span class="kw">library</span>(shiny)</span>
<span id="cb1-2"><a href="#cb1-2"></a><span class="kw">library</span>(shinyWidgets)</span>
<span id="cb1-3"><a href="#cb1-3"></a></span>
<span id="cb1-4"><a href="#cb1-4"></a>ui &lt;-<span class="st"> </span><span class="kw">fluidPage</span>(</span>
<span id="cb1-5"><a href="#cb1-5"></a>  <span class="kw">titlePanel</span>(<span class="st">&quot;Sidebar with scrollbar&quot;</span>),</span>
<span id="cb1-6"><a href="#cb1-6"></a>  <span class="kw">sidebarLayout</span>(</span>
<span id="cb1-7"><a href="#cb1-7"></a>    <span class="kw">sidebarPanel</span>(</span>
<span id="cb1-8"><a href="#cb1-8"></a>      <span class="dt">style =</span> <span class="st">&quot;height: 90vh; overflow-y: auto;&quot;</span>, </span>
<span id="cb1-9"><a href="#cb1-9"></a>      <span class="kw">sliderInput</span>(<span class="st">&quot;bins&quot;</span>, <span class="st">&quot;Number of bins:&quot;</span>, <span class="dt">min =</span> <span class="dv">1</span>, <span class="dt">max =</span> <span class="dv">50</span>, <span class="dt">value =</span> <span class="dv">30</span>),</span>
<span id="cb1-10"><a href="#cb1-10"></a>      <span class="kw">br</span>(),</span>
<span id="cb1-11"><a href="#cb1-11"></a>      <span class="kw">dropdown</span>(</span>
<span id="cb1-12"><a href="#cb1-12"></a>        tags<span class="op">$</span><span class="kw">h1</span>(<span class="st">&quot;A very large dropdown&quot;</span>),</span>
<span id="cb1-13"><a href="#cb1-13"></a>        <span class="dt">status =</span> <span class="st">&quot;danger&quot;</span>,</span>
<span id="cb1-14"><a href="#cb1-14"></a>        <span class="dt">size   =</span> <span class="st">&quot;lg&quot;</span>,</span>
<span id="cb1-15"><a href="#cb1-15"></a>        <span class="dt">label  =</span> <span class="st">&quot;Open me!&quot;</span>,</span>
<span id="cb1-16"><a href="#cb1-16"></a>        <span class="dt">width  =</span> <span class="st">&quot;500px&quot;</span></span>
<span id="cb1-17"><a href="#cb1-17"></a>      ),</span>
<span id="cb1-18"><a href="#cb1-18"></a>      <span class="kw">br</span>(),</span>
<span id="cb1-19"><a href="#cb1-19"></a>      <span class="kw">sliderInput</span>(<span class="st">&quot;bins2&quot;</span>, <span class="st">&quot;Number of bins:&quot;</span>, <span class="dt">min =</span> <span class="dv">1</span>, <span class="dt">max =</span> <span class="dv">50</span>, <span class="dt">value =</span> <span class="dv">30</span>),</span>
<span id="cb1-20"><a href="#cb1-20"></a>      <span class="kw">br</span>(),</span>
<span id="cb1-21"><a href="#cb1-21"></a>      <span class="kw">sliderInput</span>(<span class="st">&quot;bins3&quot;</span>, <span class="st">&quot;Number of bins:&quot;</span>, <span class="dt">min =</span> <span class="dv">1</span>, <span class="dt">max =</span> <span class="dv">50</span>, <span class="dt">value =</span> <span class="dv">30</span>),</span>
<span id="cb1-22"><a href="#cb1-22"></a>      <span class="kw">br</span>(),</span>
<span id="cb1-23"><a href="#cb1-23"></a>      <span class="kw">sliderInput</span>(<span class="st">&quot;bins4&quot;</span>, <span class="st">&quot;Number of bins:&quot;</span>, <span class="dt">min =</span> <span class="dv">1</span>, <span class="dt">max =</span> <span class="dv">50</span>, <span class="dt">value =</span> <span class="dv">30</span>),</span>
<span id="cb1-24"><a href="#cb1-24"></a>      <span class="kw">br</span>(),</span>
<span id="cb1-25"><a href="#cb1-25"></a>      <span class="kw">sliderInput</span>(<span class="st">&quot;bins5&quot;</span>, <span class="st">&quot;Number of bins:&quot;</span>, <span class="dt">min =</span> <span class="dv">1</span>, <span class="dt">max =</span> <span class="dv">50</span>, <span class="dt">value =</span> <span class="dv">30</span>),</span>
<span id="cb1-26"><a href="#cb1-26"></a>      <span class="kw">br</span>(),</span>
<span id="cb1-27"><a href="#cb1-27"></a>      <span class="kw">sliderInput</span>(<span class="st">&quot;bins6&quot;</span>, <span class="st">&quot;Number of bins:&quot;</span>, <span class="dt">min =</span> <span class="dv">1</span>, <span class="dt">max =</span> <span class="dv">50</span>, <span class="dt">value =</span> <span class="dv">30</span>),</span>
<span id="cb1-28"><a href="#cb1-28"></a>      <span class="kw">br</span>(),</span>
<span id="cb1-29"><a href="#cb1-29"></a>      <span class="kw">sliderInput</span>(<span class="st">&quot;bins7&quot;</span>, <span class="st">&quot;Number of bins:&quot;</span>, <span class="dt">min =</span> <span class="dv">1</span>, <span class="dt">max =</span> <span class="dv">50</span>, <span class="dt">value =</span> <span class="dv">30</span>),</span>
<span id="cb1-30"><a href="#cb1-30"></a>    ),</span>
<span id="cb1-31"><a href="#cb1-31"></a>    </span>
<span id="cb1-32"><a href="#cb1-32"></a>    <span class="kw">mainPanel</span>(</span>
<span id="cb1-33"><a href="#cb1-33"></a>      <span class="kw">plotOutput</span>(<span class="st">&quot;distPlot&quot;</span>)</span>
<span id="cb1-34"><a href="#cb1-34"></a>    )</span>
<span id="cb1-35"><a href="#cb1-35"></a>    </span>
<span id="cb1-36"><a href="#cb1-36"></a>  )</span>
<span id="cb1-37"><a href="#cb1-37"></a>)</span>
<span id="cb1-38"><a href="#cb1-38"></a></span>
<span id="cb1-39"><a href="#cb1-39"></a>server &lt;-<span class="st"> </span><span class="cf">function</span>(input, output) {</span>
<span id="cb1-40"><a href="#cb1-40"></a>  output[[<span class="st">&quot;distPlot&quot;</span>]] &lt;-<span class="st"> </span><span class="kw">renderPlot</span>({</span>
<span id="cb1-41"><a href="#cb1-41"></a>    x    &lt;-<span class="st"> </span>faithful[, <span class="dv">2</span>] </span>
<span id="cb1-42"><a href="#cb1-42"></a>    bins &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="kw">min</span>(x), <span class="kw">max</span>(x), <span class="dt">length.out =</span> input[[<span class="st">&quot;bins&quot;</span>]] <span class="op">+</span><span class="st"> </span><span class="dv">1</span>)</span>
<span id="cb1-43"><a href="#cb1-43"></a>    <span class="kw">hist</span>(x, <span class="dt">breaks =</span> bins, <span class="dt">col =</span> <span class="st">&quot;darkred&quot;</span>, <span class="dt">border =</span> <span class="st">&quot;white&quot;</span>)</span>
<span id="cb1-44"><a href="#cb1-44"></a>  })</span>
<span id="cb1-45"><a href="#cb1-45"></a>}</span>
<span id="cb1-46"><a href="#cb1-46"></a></span>
<span id="cb1-47"><a href="#cb1-47"></a><span class="kw">shinyApp</span>(<span class="dt">ui =</span> ui, <span class="dt">server =</span> server)</span></code></pre></div>
<p><img src="./figures/shiny_sidebar_scrollbar1.gif" style="width:70.0%" /></p>
<p>But, as you can see, there is an issue with the <code>shinyWidgets::dropdown</code>: when one opens it, the part outside the sidebar is hidden. Here is a JavaScript solution for this issue:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1"></a><span class="kw">library</span>(shiny)</span>
<span id="cb2-2"><a href="#cb2-2"></a><span class="kw">library</span>(shinyWidgets)</span>
<span id="cb2-3"><a href="#cb2-3"></a></span>
<span id="cb2-4"><a href="#cb2-4"></a>js &lt;-<span class="st"> &#39;</span></span>
<span id="cb2-5"><a href="#cb2-5"></a><span class="st">$(document).ready(function(){</span></span>
<span id="cb2-6"><a href="#cb2-6"></a><span class="st">  $(&quot;[id^=sw-content-]&quot;).on(&quot;shown&quot;, function(){</span></span>
<span id="cb2-7"><a href="#cb2-7"></a><span class="st">    $(&quot;.sidebar&quot;).css({&quot;overflow-y&quot;: &quot;visible&quot;});</span></span>
<span id="cb2-8"><a href="#cb2-8"></a><span class="st">  }).on(&quot;hidden&quot;, function(){</span></span>
<span id="cb2-9"><a href="#cb2-9"></a><span class="st">    $(&quot;.sidebar&quot;).css({&quot;overflow-y&quot;: &quot;auto&quot;});</span></span>
<span id="cb2-10"><a href="#cb2-10"></a><span class="st">  });</span></span>
<span id="cb2-11"><a href="#cb2-11"></a><span class="st">});</span></span>
<span id="cb2-12"><a href="#cb2-12"></a><span class="st">&#39;</span></span>
<span id="cb2-13"><a href="#cb2-13"></a></span>
<span id="cb2-14"><a href="#cb2-14"></a>ui &lt;-<span class="st"> </span><span class="kw">fluidPage</span>(</span>
<span id="cb2-15"><a href="#cb2-15"></a>  tags<span class="op">$</span><span class="kw">head</span>(tags<span class="op">$</span><span class="kw">script</span>(<span class="kw">HTML</span>(js))),</span>
<span id="cb2-16"><a href="#cb2-16"></a>  <span class="kw">titlePanel</span>(<span class="st">&quot;Sidebar with scrollbar&quot;</span>),</span>
<span id="cb2-17"><a href="#cb2-17"></a>  <span class="kw">sidebarLayout</span>(</span>
<span id="cb2-18"><a href="#cb2-18"></a>    <span class="kw">sidebarPanel</span>(</span>
<span id="cb2-19"><a href="#cb2-19"></a>      <span class="dt">class =</span> <span class="st">&quot;sidebar&quot;</span>,</span>
<span id="cb2-20"><a href="#cb2-20"></a>      <span class="dt">style =</span> <span class="st">&quot;height: 90vh; overflow-y: auto;&quot;</span>, </span>
<span id="cb2-21"><a href="#cb2-21"></a>      <span class="kw">sliderInput</span>(<span class="st">&quot;bins&quot;</span>, <span class="st">&quot;Number of bins:&quot;</span>, <span class="dt">min =</span> <span class="dv">1</span>, <span class="dt">max =</span> <span class="dv">50</span>, <span class="dt">value =</span> <span class="dv">30</span>),</span>
<span id="cb2-22"><a href="#cb2-22"></a>      ......</span></code></pre></div>
<p><img src="./figures/shiny_sidebar_scrollbar2.gif" style="width:70.0%" /></p>
<p>I find the native HTML scrollbars a bit ugly. It is possible to customize them: <a href="https://css-tricks.com/the-current-state-of-styling-scrollbars-in-css/">Styling scrollbars in CSS</a>.</p>

        </div>


        <div id="footer">
          Site proudly generated by
          <a href="http://jaspervdj.be/hakyll">Hakyll</a>
        </div>

      </div>

    </div>

    <div class="row">
      <div class="col-sm-12">
        <div id="disqus_thread"></div>
        <div class="pagination">
          <ul>
            <li>
              <a href="http://laustep.github.io/stlahblog/">&#171; Back Home</a>
            </li>
          </ul>
        </div>
      </div>
    </div>
    
  </div>

</body>

<script src="/libraries/bootstrap/bootstrap.min.js"></script>
<script>
  var disqus_developer = 1;
  var disqus_shortname = 'stlapblog';
  // required: replace example with your forum shortname
  /* * * DON'T EDIT BELOW THIS LINE * * */
  (function () {
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = 'https://' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] ||
      document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>
<noscript>Please enable JavaScript to view the
  <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a>
</noscript>
<!-- MathJax: Fall back to local if CDN offline but local image fonts are not supported (saves >100MB) -->
<script type="text/x-mathjax-config" src="/libraries/mathjax/config/TeX-MML-AM_CHTML.js"></script>
<!-- <script>
  window.MathJax || document.write('<script type="text/x-mathjax-config">MathJax.Hub.Config({"HTML-CSS":{imageFont:null}});<\/script><script src="../libraries/mathjax/MathJax.js"><\/script>');
</script> -->


</html>]]></description>
    <pubDate>Fri, 17 Jun 2022 00:00:00 UT</pubDate>
    <guid>https://laustep.github.io/stlahblog/posts/shinySidebarScrollbar.html</guid>
    <dc:creator>Stéphane Laurent</dc:creator>
    <category>R</category>
</item>


<item>
    <title>SVG to PNG</title>
    <link>https://laustep.github.io/stlahblog/posts/SVG2PNG.html</link>
    <description><![CDATA[<!DOCTYPE HTML>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Saturn Elephant - SVG to PNG</title>
  <link href="/libraries/bootstrap/bootstrap-grid.min.css" rel="stylesheet">
  <link rel="stylesheet" href="/css/default2.css" />
  <link rel="stylesheet" href="/css/post.css" />
  <link rel="stylesheet" href="/css/misc.css" /> 
  
    <link rel="stylesheet" href="/css/pandoc-solarized.css" /> 
   
  
  <link href="https://fonts.googleapis.com/css?family=Raleway:400,600,200,800" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/css?family=Droid+Sans" rel="stylesheet" type="text/css">
  <script src="/libraries/jquery.min.js"></script>
  <script type="text/javascript" async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML"></script>
</head>

<body>
  <div class="container-fluid">
    <div class="row">
      <!-- Sidebar. -->
      <div class="sidebar col-sm-2">
        <div class="row">
          <div class="col-sm-12" style="float:right;clear:both;margin-right:50px;margin-top:50px;">
            <a href="https://www.r-bloggers.com/">
              <img src="/images/Rbloggers.png" alt="Rbloggers" width="100%" />
            </a>
            <br/>
            <a href="http://t-redactyl.io/">
              <span style="color:black;font-weight:bold;font-family:sans-serif;font-size:25px;">Standard error</span>
            </a>
            <a href="http://timelyportfolio.blogspot.be/">
              <span style="color:grey;font-weight:bold;font-family:sans-serif;font-size:24px;">Timely portfolio</span>
            </a>
            <br/>
            <a href="https://antoineguillot.wordpress.com/blog/">
              <span style="color:white;background-color:darkblue;font-weight:bold;font-family:sans-serif;font-size:21px;border:5px solid;border-color:darkblue">ENHANCE DATA</span>
            </a>
            <br/>
            <a href="https://fronkonstin.com/">
              <span style="color:black;background-color:gold;font-weight:bold;font-size:29px;border:3px solid;border-color:gold;">Fronkonstin</span>
            </a>
          </div>
        </div>
        <div id="logos">
          <div class="row">
            <div class="col-sm-4">
              <img src="/images/AsymptoteLogo.svg" style="width: 150%; transform: rotateZ(-35deg)"/>
            </div>
            <div class="col-sm-4">
              <img src="/images/Rlogo.svg" style="width: 110%;"/>
            </div>
            <div class="col-sm-4">
              <img src="/images/shiny-hex.png" style="width: 90%;"/>
            </div>
          </div>
          <div class="row">
            <div class="col-sm-4">
              <img src="/images/Povray_logo_sphere.png" style="width: 105%;"/>
            </div>
            <div class="col-sm-4">
              <img src="/images/javascript.svg" style="width: 90%;"/>
            </div>
            <div class="col-sm-4">
              <img src="/images/haskell.svg" style="width: 110%;"/>
            </div>
          </div>
        </div>
      </div>

      <div class="main col-sm-10">
        <div id="header">
          <div id="logo">
            <a href="/">
              <img src="/images/stla.jpg" alt="stla" width="100px" />
            </a>
          </div>
          <div id="navigation" style="margin-top:50px;">
            <a href="/">Home</a>
            <a href="/about.html">About</a>
            <a href="/contact.html">Contact</a>
            <a href="/archive.html">Archive</a>
          </div>
        </div>

        <div class="content">
          <h1>SVG to PNG</h1> 
          <div class="info">
    Posted on June 17, 2022
    
        by Stéphane Laurent
    
</div>
<div class="info">
    
    Tags: <a title="All pages tagged &#39;R&#39;." href="/tags/R.html">R</a>, <a title="All pages tagged &#39;graphics&#39;." href="/tags/graphics.html">graphics</a>
    
</div>

<p>Here is a way to get a high-quality PNG image with R: save it as SVG first, then convert the SVG file to a PNG file, with the <strong>rsvg</strong> package.</p>
<p>Let’s see. I construct a hyperbolic Delaunay triangulation with the <strong>gyro</strong> package:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true"></a><span class="kw">library</span>(gyro)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true"></a>phi &lt;-<span class="st"> </span>(<span class="dv">1</span> <span class="op">+</span><span class="st"> </span><span class="kw">sqrt</span>(<span class="dv">5</span>)) <span class="op">/</span><span class="st"> </span><span class="dv">2</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true"></a>theta &lt;-<span class="st"> </span><span class="kw">head</span>(<span class="kw">seq</span>(<span class="dv">0</span>, pi<span class="op">/</span><span class="dv">2</span>, <span class="dt">length.out =</span> <span class="dv">11</span>), <span class="op">-</span>1L)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true"></a>a &lt;-<span class="st"> </span>phi<span class="op">^</span>((<span class="dv">2</span><span class="op">*</span>theta<span class="op">/</span>pi)<span class="op">^</span><span class="fl">0.8</span> <span class="op">-</span><span class="st"> </span><span class="dv">1</span>)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true"></a>u &lt;-<span class="st"> </span>a <span class="op">*</span><span class="st"> </span><span class="kw">cos</span>(theta)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true"></a>v &lt;-<span class="st"> </span>a <span class="op">*</span><span class="st"> </span><span class="kw">sin</span>(theta)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true"></a>x &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">0</span>, u, <span class="op">-</span>v, <span class="op">-</span>u, v)</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true"></a>y &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">0</span>, v, u, <span class="op">-</span>v, <span class="op">-</span>u)</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true"></a>pts &lt;-<span class="st"> </span><span class="kw">cbind</span>(x, y) <span class="op">/</span><span class="st"> </span><span class="fl">1.07</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true"></a></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true"></a>hdel &lt;-<span class="st"> </span><span class="kw">hdelaunay</span>(pts, <span class="dt">model =</span> <span class="st">&quot;U&quot;</span>)</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true"></a></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true"></a>fcolor &lt;-<span class="st"> </span><span class="cf">function</span>(t){</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true"></a>  RGB &lt;-<span class="st"> </span><span class="kw">colorRamp</span>(<span class="kw">hcl.colors</span>(20L, <span class="st">&quot;Berlin&quot;</span>))(t)</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true"></a>  <span class="kw">rgb</span>(RGB[, 1L], RGB[, 2L], RGB[, 3L], <span class="dt">maxColorValue =</span> <span class="dv">255</span>)</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true"></a>}</span></code></pre></div>
<p>Now let’s save the plot as a PNG, directly:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true"></a><span class="kw">png</span>(<span class="st">&quot;hdelaunayU.png&quot;</span>, <span class="dt">width =</span> <span class="dv">512</span>, <span class="dt">height =</span> <span class="dv">512</span>)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true"></a><span class="kw">plotHdelaunay</span>(</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true"></a>  hdel, <span class="dt">vertices =</span> <span class="ot">FALSE</span>, <span class="dt">color =</span> fcolor</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true"></a>)</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true"></a><span class="kw">dev.off</span>()</span></code></pre></div>
<p>And now let’s save it as SVG then convert it to PNG:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true"></a><span class="kw">svg</span>(<span class="st">&quot;hdelaunayU.svg&quot;</span>)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true"></a><span class="kw">plotHdelaunay</span>(</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true"></a>  hdel, <span class="dt">vertices =</span> <span class="ot">FALSE</span>, <span class="dt">color =</span> fcolor</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true"></a>)</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true"></a><span class="kw">dev.off</span>()</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true"></a></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true"></a>rsvg<span class="op">::</span><span class="kw">rsvg_png</span>(</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true"></a>  <span class="st">&quot;hdelaunayU.svg&quot;</span>, <span class="st">&quot;hdelaunayU_from_svg.png&quot;</span>,</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true"></a>  <span class="dt">width =</span> <span class="dv">512</span>, <span class="dt">height =</span> <span class="dv">512</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true"></a>)</span></code></pre></div>
<p>Observe the difference:</p>
<p><img src="./figures/hdelaunayU.png" style="width:95.0%" /></p>
<p><img src="./figures/hdelaunayU_from_svg.png" style="width:95.0%" /></p>

        </div>


        <div id="footer">
          Site proudly generated by
          <a href="http://jaspervdj.be/hakyll">Hakyll</a>
        </div>

      </div>

    </div>

    <div class="row">
      <div class="col-sm-12">
        <div id="disqus_thread"></div>
        <div class="pagination">
          <ul>
            <li>
              <a href="http://laustep.github.io/stlahblog/">&#171; Back Home</a>
            </li>
          </ul>
        </div>
      </div>
    </div>
    
  </div>

</body>

<script src="/libraries/bootstrap/bootstrap.min.js"></script>
<script>
  var disqus_developer = 1;
  var disqus_shortname = 'stlapblog';
  // required: replace example with your forum shortname
  /* * * DON'T EDIT BELOW THIS LINE * * */
  (function () {
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = 'https://' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] ||
      document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>
<noscript>Please enable JavaScript to view the
  <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a>
</noscript>
<!-- MathJax: Fall back to local if CDN offline but local image fonts are not supported (saves >100MB) -->
<script type="text/x-mathjax-config" src="/libraries/mathjax/config/TeX-MML-AM_CHTML.js"></script>
<!-- <script>
  window.MathJax || document.write('<script type="text/x-mathjax-config">MathJax.Hub.Config({"HTML-CSS":{imageFont:null}});<\/script><script src="../libraries/mathjax/MathJax.js"><\/script>');
</script> -->


</html>]]></description>
    <pubDate>Fri, 17 Jun 2022 00:00:00 UT</pubDate>
    <guid>https://laustep.github.io/stlahblog/posts/SVG2PNG.html</guid>
    <dc:creator>Stéphane Laurent</dc:creator>
    <category>R</category>
</item>


<item>
    <title>Hopf torus, circle by circle</title>
    <link>https://laustep.github.io/stlahblog/posts/HopfTorusCircleByCircle.html</link>
    <description><![CDATA[<!DOCTYPE HTML>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Saturn Elephant - Hopf torus, circle by circle</title>
  <link href="/libraries/bootstrap/bootstrap-grid.min.css" rel="stylesheet">
  <link rel="stylesheet" href="/css/default2.css" />
  <link rel="stylesheet" href="/css/post.css" />
  <link rel="stylesheet" href="/css/misc.css" /> 
  
    <link rel="stylesheet" href="/css/pandoc-solarized.css" /> 
   
  
  <link href="https://fonts.googleapis.com/css?family=Raleway:400,600,200,800" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/css?family=Droid+Sans" rel="stylesheet" type="text/css">
  <script src="/libraries/jquery.min.js"></script>
  <script type="text/javascript" async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML"></script>
</head>

<body>
  <div class="container-fluid">
    <div class="row">
      <!-- Sidebar. -->
      <div class="sidebar col-sm-2">
        <div class="row">
          <div class="col-sm-12" style="float:right;clear:both;margin-right:50px;margin-top:50px;">
            <a href="https://www.r-bloggers.com/">
              <img src="/images/Rbloggers.png" alt="Rbloggers" width="100%" />
            </a>
            <br/>
            <a href="http://t-redactyl.io/">
              <span style="color:black;font-weight:bold;font-family:sans-serif;font-size:25px;">Standard error</span>
            </a>
            <a href="http://timelyportfolio.blogspot.be/">
              <span style="color:grey;font-weight:bold;font-family:sans-serif;font-size:24px;">Timely portfolio</span>
            </a>
            <br/>
            <a href="https://antoineguillot.wordpress.com/blog/">
              <span style="color:white;background-color:darkblue;font-weight:bold;font-family:sans-serif;font-size:21px;border:5px solid;border-color:darkblue">ENHANCE DATA</span>
            </a>
            <br/>
            <a href="https://fronkonstin.com/">
              <span style="color:black;background-color:gold;font-weight:bold;font-size:29px;border:3px solid;border-color:gold;">Fronkonstin</span>
            </a>
          </div>
        </div>
        <div id="logos">
          <div class="row">
            <div class="col-sm-4">
              <img src="/images/AsymptoteLogo.svg" style="width: 150%; transform: rotateZ(-35deg)"/>
            </div>
            <div class="col-sm-4">
              <img src="/images/Rlogo.svg" style="width: 110%;"/>
            </div>
            <div class="col-sm-4">
              <img src="/images/shiny-hex.png" style="width: 90%;"/>
            </div>
          </div>
          <div class="row">
            <div class="col-sm-4">
              <img src="/images/Povray_logo_sphere.png" style="width: 105%;"/>
            </div>
            <div class="col-sm-4">
              <img src="/images/javascript.svg" style="width: 90%;"/>
            </div>
            <div class="col-sm-4">
              <img src="/images/haskell.svg" style="width: 110%;"/>
            </div>
          </div>
        </div>
      </div>

      <div class="main col-sm-10">
        <div id="header">
          <div id="logo">
            <a href="/">
              <img src="/images/stla.jpg" alt="stla" width="100px" />
            </a>
          </div>
          <div id="navigation" style="margin-top:50px;">
            <a href="/">Home</a>
            <a href="/about.html">About</a>
            <a href="/contact.html">Contact</a>
            <a href="/archive.html">Archive</a>
          </div>
        </div>

        <div class="content">
          <h1>Hopf torus, circle by circle</h1> 
          <div class="info">
    Posted on June 13, 2022
    
        by Stéphane Laurent
    
</div>
<div class="info">
    
    Tags: <a title="All pages tagged &#39;geometry&#39;." href="/tags/geometry.html">geometry</a>, <a title="All pages tagged &#39;R&#39;." href="/tags/R.html">R</a>, <a title="All pages tagged &#39;rgl&#39;." href="/tags/rgl.html">rgl</a>, <a title="All pages tagged &#39;graphics&#39;." href="/tags/graphics.html">graphics</a>, <a title="All pages tagged &#39;maths&#39;." href="/tags/maths.html">maths</a>
    
</div>

<p>Remember my <a href="https://laustep.github.io/stlahblog/posts/HopfTorus_3over3.html">first post</a> on the Hopf torus? I constructed it circle by circle. Below are some animations of this construction. I save the image each time a circle is added. The <strong>rgl</strong> package automatically centers the plot, and this gives a nice effect.</p>
<p>First animation, three lobes, using a <a href="https://laustep.github.io/stlahblog/posts/ModifiedStereographicProjection.html">modified stereographic projection</a>:</p>
<p><img src="./figures/HopfTorusCircleByCircle_3lobes.gif" /></p>
<p>Here is the code producing this animation:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a><span class="co"># Hopf fiber</span></span>
<span id="cb1-2"><a href="#cb1-2"></a>HopfFiber &lt;-<span class="st"> </span><span class="cf">function</span>(q, t){ </span>
<span id="cb1-3"><a href="#cb1-3"></a>  <span class="dv">1</span><span class="op">/</span><span class="kw">sqrt</span>(<span class="dv">2</span><span class="op">*</span>(<span class="dv">1</span><span class="op">+</span>q[1L])) <span class="op">*</span><span class="st"> </span><span class="kw">c</span>(q[3L]<span class="op">*</span><span class="kw">cos</span>(t) <span class="op">+</span><span class="st"> </span>q[2L]<span class="op">*</span><span class="kw">sin</span>(t),</span>
<span id="cb1-4"><a href="#cb1-4"></a>                          q[2L]<span class="op">*</span><span class="kw">cos</span>(t) <span class="op">-</span><span class="st"> </span>q[3L]<span class="op">*</span><span class="kw">sin</span>(t),</span>
<span id="cb1-5"><a href="#cb1-5"></a>                          <span class="kw">sin</span>(t)<span class="op">*</span>(<span class="dv">1</span><span class="op">+</span>q[1L]),</span>
<span id="cb1-6"><a href="#cb1-6"></a>                          <span class="kw">cos</span>(t)<span class="op">*</span>(<span class="dv">1</span><span class="op">+</span>q[1L])) </span>
<span id="cb1-7"><a href="#cb1-7"></a>}</span>
<span id="cb1-8"><a href="#cb1-8"></a><span class="co"># Modified stereographic projection</span></span>
<span id="cb1-9"><a href="#cb1-9"></a>mstereog &lt;-<span class="st"> </span><span class="cf">function</span>(x){</span>
<span id="cb1-10"><a href="#cb1-10"></a>  <span class="kw">acos</span>(x[4L])<span class="op">/</span><span class="kw">sqrt</span>(<span class="dv">1</span><span class="op">-</span>x[4L]<span class="op">^</span><span class="dv">2</span>) <span class="op">*</span><span class="st"> </span>x[1L<span class="op">:</span>3L]</span>
<span id="cb1-11"><a href="#cb1-11"></a>}</span>
<span id="cb1-12"><a href="#cb1-12"></a></span>
<span id="cb1-13"><a href="#cb1-13"></a><span class="co"># plot</span></span>
<span id="cb1-14"><a href="#cb1-14"></a><span class="kw">library</span>(rgl)</span>
<span id="cb1-15"><a href="#cb1-15"></a><span class="kw">open3d</span>(<span class="dt">windowRect =</span> <span class="kw">c</span>(<span class="dv">50</span>, <span class="dv">50</span>, <span class="dv">562</span>, <span class="dv">562</span>))</span>
<span id="cb1-16"><a href="#cb1-16"></a><span class="kw">bg3d</span>(<span class="st">&quot;#666970&quot;</span>)</span>
<span id="cb1-17"><a href="#cb1-17"></a><span class="kw">view3d</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dt">zoom =</span> <span class="fl">0.9</span>)</span>
<span id="cb1-18"><a href="#cb1-18"></a>t_ &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="dv">0</span>, <span class="dv">2</span><span class="op">*</span>pi, <span class="dt">len =</span> 200L) <span class="co"># 200 subdivisions per circle</span></span>
<span id="cb1-19"><a href="#cb1-19"></a>u_ &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="dv">0</span>, <span class="dv">2</span><span class="op">*</span>pi, <span class="dt">len =</span> 300L) <span class="co"># 300 circles</span></span>
<span id="cb1-20"><a href="#cb1-20"></a>nlobes &lt;-<span class="st"> </span>3L <span class="co"># number of lobes of the Hopf torus</span></span>
<span id="cb1-21"><a href="#cb1-21"></a>colors &lt;-<span class="st"> </span><span class="kw">colorRampPalette</span>( <span class="co"># colors</span></span>
<span id="cb1-22"><a href="#cb1-22"></a>  <span class="kw">head</span>(trekcolors<span class="op">::</span><span class="kw">trek_pal</span>(<span class="st">&quot;klingon&quot;</span>), <span class="op">-</span>2L),</span>
<span id="cb1-23"><a href="#cb1-23"></a>  <span class="dt">interpolate =</span> <span class="st">&quot;spline&quot;</span>, <span class="dt">bias =</span> <span class="fl">0.15</span></span>
<span id="cb1-24"><a href="#cb1-24"></a>)(150L)</span>
<span id="cb1-25"><a href="#cb1-25"></a>colors &lt;-<span class="st"> </span><span class="kw">c</span>(colors, <span class="kw">rev</span>(colors))</span>
<span id="cb1-26"><a href="#cb1-26"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(u_)){</span>
<span id="cb1-27"><a href="#cb1-27"></a>  u &lt;-<span class="st"> </span>u_[i]</span>
<span id="cb1-28"><a href="#cb1-28"></a>  x &lt;-<span class="st">  </span><span class="kw">cos</span>(pi<span class="op">/</span><span class="dv">2</span> <span class="op">-</span><span class="st"> </span>(pi<span class="op">/</span><span class="dv">2</span><span class="fl">-0.44</span>)<span class="op">*</span><span class="kw">cos</span>(nlobes<span class="op">*</span>u))</span>
<span id="cb1-29"><a href="#cb1-29"></a>  z &lt;-<span class="st">  </span><span class="kw">sin</span>(pi<span class="op">/</span><span class="dv">2</span> <span class="op">-</span><span class="st"> </span>(pi<span class="op">/</span><span class="dv">2</span><span class="fl">-0.44</span>)<span class="op">*</span><span class="kw">cos</span>(nlobes<span class="op">*</span>u)) <span class="op">*</span><span class="st"> </span><span class="kw">cos</span>(u<span class="fl">+0.44</span><span class="op">*</span><span class="kw">sin</span>(<span class="dv">2</span><span class="op">*</span>nlobes))</span>
<span id="cb1-30"><a href="#cb1-30"></a>  y &lt;-<span class="st"> </span><span class="op">-</span><span class="kw">sin</span>(pi<span class="op">/</span><span class="dv">2</span> <span class="op">-</span><span class="st"> </span>(pi<span class="op">/</span><span class="dv">2</span><span class="fl">-0.44</span>)<span class="op">*</span><span class="kw">cos</span>(nlobes<span class="op">*</span>u)) <span class="op">*</span><span class="st"> </span><span class="kw">sin</span>(u<span class="fl">+0.44</span><span class="op">*</span><span class="kw">sin</span>(<span class="dv">2</span><span class="op">*</span>nlobes))</span>
<span id="cb1-31"><a href="#cb1-31"></a>  circle4d &lt;-<span class="st"> </span><span class="kw">vapply</span>(t_, <span class="cf">function</span>(t){</span>
<span id="cb1-32"><a href="#cb1-32"></a>    <span class="kw">HopfFiber</span>(<span class="kw">c</span>(x, y, z), t)  </span>
<span id="cb1-33"><a href="#cb1-33"></a>  }, <span class="kw">numeric</span>(4L))</span>
<span id="cb1-34"><a href="#cb1-34"></a>  circle3d &lt;-<span class="st"> </span><span class="kw">t</span>(<span class="kw">apply</span>(circle4d, 2L, mstereog))</span>
<span id="cb1-35"><a href="#cb1-35"></a>  <span class="kw">shade3d</span>(</span>
<span id="cb1-36"><a href="#cb1-36"></a>    <span class="kw">cylinder3d</span>(circle3d, <span class="dt">radius =</span> <span class="fl">0.1</span>, <span class="dt">sides =</span> <span class="dv">15</span>), </span>
<span id="cb1-37"><a href="#cb1-37"></a>    <span class="dt">color =</span> colors[i]</span>
<span id="cb1-38"><a href="#cb1-38"></a>  )</span>
<span id="cb1-39"><a href="#cb1-39"></a>  <span class="kw">rgl.snapshot</span>(<span class="kw">sprintf</span>(<span class="st">&quot;pic%03d.png&quot;</span>, i)) <span class="co"># save</span></span>
<span id="cb1-40"><a href="#cb1-40"></a>}</span>
<span id="cb1-41"><a href="#cb1-41"></a></span>
<span id="cb1-42"><a href="#cb1-42"></a><span class="co"># duplicate last pic to make a pause at the end of the animation</span></span>
<span id="cb1-43"><a href="#cb1-43"></a><span class="cf">for</span>(i <span class="cf">in</span> 301L<span class="op">:</span>350L){</span>
<span id="cb1-44"><a href="#cb1-44"></a>  <span class="kw">file.copy</span>(<span class="st">&quot;pic300.png&quot;</span>, <span class="kw">sprintf</span>(<span class="st">&quot;pic%03d.png&quot;</span>, i))</span>
<span id="cb1-45"><a href="#cb1-45"></a>}</span>
<span id="cb1-46"><a href="#cb1-46"></a><span class="co"># make animation</span></span>
<span id="cb1-47"><a href="#cb1-47"></a>pngFiles &lt;-<span class="st"> </span><span class="kw">list.files</span>(<span class="dt">pattern =</span> <span class="st">&quot;^pic?.*png$&quot;</span>)</span>
<span id="cb1-48"><a href="#cb1-48"></a><span class="kw">library</span>(gifski)</span>
<span id="cb1-49"><a href="#cb1-49"></a><span class="kw">gifski</span>(</span>
<span id="cb1-50"><a href="#cb1-50"></a>  pngFiles,</span>
<span id="cb1-51"><a href="#cb1-51"></a>  <span class="dt">gif_file =</span> <span class="st">&quot;HopfTorusCircleByCircle_3lobes.gif&quot;</span>,</span>
<span id="cb1-52"><a href="#cb1-52"></a>  <span class="dt">width    =</span> <span class="dv">512</span>, <span class="dt">height   =</span> <span class="dv">512</span>,</span>
<span id="cb1-53"><a href="#cb1-53"></a>  <span class="dt">delay    =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">9</span> <span class="co"># 9 pics per second</span></span>
<span id="cb1-54"><a href="#cb1-54"></a>)</span>
<span id="cb1-55"><a href="#cb1-55"></a><span class="co"># delete png files</span></span>
<span id="cb1-56"><a href="#cb1-56"></a><span class="kw">file.remove</span>(pngFiles)</span></code></pre></div>
<p>Four lobes, modified stereographic projection, with the ‘rocket’ color palette (in <strong>grDevices</strong> package):</p>
<p><img src="./figures/HopfTorusCircleByCircle_4lobes.gif" /></p>
<p>Two lobes, classical stereographic projection:</p>
<p><img src="./figures/HopfTorusCircleByCircle_2lobes.gif" /></p>

        </div>


        <div id="footer">
          Site proudly generated by
          <a href="http://jaspervdj.be/hakyll">Hakyll</a>
        </div>

      </div>

    </div>

    <div class="row">
      <div class="col-sm-12">
        <div id="disqus_thread"></div>
        <div class="pagination">
          <ul>
            <li>
              <a href="http://laustep.github.io/stlahblog/">&#171; Back Home</a>
            </li>
          </ul>
        </div>
      </div>
    </div>
    
  </div>

</body>

<script src="/libraries/bootstrap/bootstrap.min.js"></script>
<script>
  var disqus_developer = 1;
  var disqus_shortname = 'stlapblog';
  // required: replace example with your forum shortname
  /* * * DON'T EDIT BELOW THIS LINE * * */
  (function () {
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = 'https://' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] ||
      document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>
<noscript>Please enable JavaScript to view the
  <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a>
</noscript>
<!-- MathJax: Fall back to local if CDN offline but local image fonts are not supported (saves >100MB) -->
<script type="text/x-mathjax-config" src="/libraries/mathjax/config/TeX-MML-AM_CHTML.js"></script>
<!-- <script>
  window.MathJax || document.write('<script type="text/x-mathjax-config">MathJax.Hub.Config({"HTML-CSS":{imageFont:null}});<\/script><script src="../libraries/mathjax/MathJax.js"><\/script>');
</script> -->


</html>]]></description>
    <pubDate>Mon, 13 Jun 2022 00:00:00 UT</pubDate>
    <guid>https://laustep.github.io/stlahblog/posts/HopfTorusCircleByCircle.html</guid>
    <dc:creator>Stéphane Laurent</dc:creator>
    <category>R</category>
</item>


<item>
    <title>An example of the Minkowski addition</title>
    <link>https://laustep.github.io/stlahblog/posts/MinkowskiSumLeonardo.html</link>
    <description><![CDATA[<!DOCTYPE HTML>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Saturn Elephant - An example of the Minkowski addition</title>
  <link href="/libraries/bootstrap/bootstrap-grid.min.css" rel="stylesheet">
  <link rel="stylesheet" href="/css/default2.css" />
  <link rel="stylesheet" href="/css/post.css" />
  <link rel="stylesheet" href="/css/misc.css" /> 
  
    <link rel="stylesheet" href="/css/pandoc-solarized.css" /> 
   
  
  <link href="https://fonts.googleapis.com/css?family=Raleway:400,600,200,800" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/css?family=Droid+Sans" rel="stylesheet" type="text/css">
  <script src="/libraries/jquery.min.js"></script>
  <script type="text/javascript" async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML"></script>
</head>

<body>
  <div class="container-fluid">
    <div class="row">
      <!-- Sidebar. -->
      <div class="sidebar col-sm-2">
        <div class="row">
          <div class="col-sm-12" style="float:right;clear:both;margin-right:50px;margin-top:50px;">
            <a href="https://www.r-bloggers.com/">
              <img src="/images/Rbloggers.png" alt="Rbloggers" width="100%" />
            </a>
            <br/>
            <a href="http://t-redactyl.io/">
              <span style="color:black;font-weight:bold;font-family:sans-serif;font-size:25px;">Standard error</span>
            </a>
            <a href="http://timelyportfolio.blogspot.be/">
              <span style="color:grey;font-weight:bold;font-family:sans-serif;font-size:24px;">Timely portfolio</span>
            </a>
            <br/>
            <a href="https://antoineguillot.wordpress.com/blog/">
              <span style="color:white;background-color:darkblue;font-weight:bold;font-family:sans-serif;font-size:21px;border:5px solid;border-color:darkblue">ENHANCE DATA</span>
            </a>
            <br/>
            <a href="https://fronkonstin.com/">
              <span style="color:black;background-color:gold;font-weight:bold;font-size:29px;border:3px solid;border-color:gold;">Fronkonstin</span>
            </a>
          </div>
        </div>
        <div id="logos">
          <div class="row">
            <div class="col-sm-4">
              <img src="/images/AsymptoteLogo.svg" style="width: 150%; transform: rotateZ(-35deg)"/>
            </div>
            <div class="col-sm-4">
              <img src="/images/Rlogo.svg" style="width: 110%;"/>
            </div>
            <div class="col-sm-4">
              <img src="/images/shiny-hex.png" style="width: 90%;"/>
            </div>
          </div>
          <div class="row">
            <div class="col-sm-4">
              <img src="/images/Povray_logo_sphere.png" style="width: 105%;"/>
            </div>
            <div class="col-sm-4">
              <img src="/images/javascript.svg" style="width: 90%;"/>
            </div>
            <div class="col-sm-4">
              <img src="/images/haskell.svg" style="width: 110%;"/>
            </div>
          </div>
        </div>
      </div>

      <div class="main col-sm-10">
        <div id="header">
          <div id="logo">
            <a href="/">
              <img src="/images/stla.jpg" alt="stla" width="100px" />
            </a>
          </div>
          <div id="navigation" style="margin-top:50px;">
            <a href="/">Home</a>
            <a href="/about.html">About</a>
            <a href="/contact.html">Contact</a>
            <a href="/archive.html">Archive</a>
          </div>
        </div>

        <div class="content">
          <h1>An example of the Minkowski addition</h1> 
          <div class="info">
    Posted on June 11, 2022
    
        by Stéphane Laurent
    
</div>
<div class="info">
    
    Tags: <a title="All pages tagged &#39;geometry&#39;." href="/tags/geometry.html">geometry</a>, <a title="All pages tagged &#39;R&#39;." href="/tags/R.html">R</a>, <a title="All pages tagged &#39;rgl&#39;." href="/tags/rgl.html">rgl</a>, <a title="All pages tagged &#39;graphics&#39;." href="/tags/graphics.html">graphics</a>, <a title="All pages tagged &#39;C++&#39;." href="/tags/C%2B%2B.html">C++</a>, <a title="All pages tagged &#39;Rcpp&#39;." href="/tags/Rcpp.html">Rcpp</a>
    
</div>

<p>Now the <strong>MeshesOperations</strong> package can construct the <a href="https://www.wikiwand.com/en/Minkowski_addition">Minkowski sum</a> of two polyhedra, thanks to the C++ library <strong>CGAL</strong> and the R package <strong>RcppCGAL</strong>. Let’s see an example: the Minkowski sum of Leonardo da Vinci’s 72-sided sphere and a truncated icosahedron. Here are these two polyhedra:</p>
<p><img src="./figures/LeonardoAndTruncIco.png" /></p>
<p>The mesh of the truncated icosahedron is provided by the <strong>MeshesOperations</strong> package. Here are the (rounded) vertices and the faces of da Vinci’s 72-sided sphere:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true"></a>vertices &lt;-<span class="st"> </span><span class="kw">rbind</span>(</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true"></a>  <span class="kw">c</span>( <span class="fl">1.61352</span>, <span class="fl">-0.43234</span>,  <span class="fl">1.18620</span>),</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true"></a>  <span class="kw">c</span>( <span class="fl">1.18118</span>, <span class="fl">-1.18118</span>,  <span class="fl">1.18620</span>),</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true"></a>  <span class="kw">c</span>( <span class="fl">0.43234</span>, <span class="fl">-1.61352</span>,  <span class="fl">1.18620</span>),</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true"></a>  <span class="kw">c</span>(<span class="op">-</span><span class="fl">0.43234</span>, <span class="fl">-1.61352</span>,  <span class="fl">1.18620</span>),</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true"></a>  <span class="kw">c</span>(<span class="op">-</span><span class="fl">1.18118</span>, <span class="fl">-1.18118</span>,  <span class="fl">1.18620</span>),</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true"></a>  <span class="kw">c</span>(<span class="op">-</span><span class="fl">1.61352</span>, <span class="fl">-0.43234</span>,  <span class="fl">1.18620</span>),</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true"></a>  <span class="kw">c</span>(<span class="op">-</span><span class="fl">1.61352</span>,  <span class="fl">0.43234</span>,  <span class="fl">1.18620</span>),</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true"></a>  <span class="kw">c</span>(<span class="op">-</span><span class="fl">1.18118</span>,  <span class="fl">1.18118</span>,  <span class="fl">1.18620</span>),</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true"></a>  <span class="kw">c</span>(<span class="op">-</span><span class="fl">0.43234</span>,  <span class="fl">1.61352</span>,  <span class="fl">1.18620</span>),</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true"></a>  <span class="kw">c</span>( <span class="fl">0.43234</span>,  <span class="fl">1.61352</span>,  <span class="fl">1.18620</span>),</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true"></a>  <span class="kw">c</span>( <span class="fl">1.18118</span>,  <span class="fl">1.18118</span>,  <span class="fl">1.18620</span>),</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true"></a>  <span class="kw">c</span>( <span class="fl">1.61352</span>,  <span class="fl">0.43234</span>,  <span class="fl">1.18620</span>),</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true"></a>  <span class="kw">c</span>( <span class="fl">1.61352</span>, <span class="fl">-0.43234</span>, <span class="fl">-1.18620</span>),</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true"></a>  <span class="kw">c</span>( <span class="fl">1.61352</span>,  <span class="fl">0.43234</span>, <span class="fl">-1.18620</span>),</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true"></a>  <span class="kw">c</span>( <span class="fl">1.18118</span>,  <span class="fl">1.18118</span>, <span class="fl">-1.18620</span>),</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true"></a>  <span class="kw">c</span>( <span class="fl">0.43234</span>,  <span class="fl">1.61352</span>, <span class="fl">-1.18620</span>),</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true"></a>  <span class="kw">c</span>(<span class="op">-</span><span class="fl">0.43234</span>,  <span class="fl">1.61352</span>, <span class="fl">-1.18620</span>),</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true"></a>  <span class="kw">c</span>(<span class="op">-</span><span class="fl">1.18118</span>,  <span class="fl">1.18118</span>, <span class="fl">-1.18620</span>),</span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true"></a>  <span class="kw">c</span>(<span class="op">-</span><span class="fl">1.61352</span>,  <span class="fl">0.43234</span>, <span class="fl">-1.18620</span>),</span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true"></a>  <span class="kw">c</span>(<span class="op">-</span><span class="fl">1.61352</span>, <span class="fl">-0.43234</span>, <span class="fl">-1.18620</span>),</span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true"></a>  <span class="kw">c</span>(<span class="op">-</span><span class="fl">1.18118</span>, <span class="fl">-1.18118</span>, <span class="fl">-1.18620</span>),</span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true"></a>  <span class="kw">c</span>(<span class="op">-</span><span class="fl">0.43234</span>, <span class="fl">-1.61352</span>, <span class="fl">-1.18620</span>),</span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true"></a>  <span class="kw">c</span>( <span class="fl">0.43234</span>, <span class="fl">-1.61352</span>, <span class="fl">-1.18620</span>),</span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true"></a>  <span class="kw">c</span>( <span class="fl">1.18118</span>, <span class="fl">-1.18118</span>, <span class="fl">-1.18620</span>),</span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true"></a>  <span class="kw">c</span>( <span class="fl">2.01020</span>,  <span class="fl">0.53863</span>,  <span class="fl">0.00000</span>),</span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true"></a>  <span class="kw">c</span>( <span class="fl">1.47157</span>,  <span class="fl">1.47157</span>,  <span class="fl">0.00000</span>),</span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true"></a>  <span class="kw">c</span>( <span class="fl">0.53863</span>,  <span class="fl">2.01020</span>,  <span class="fl">0.00000</span>),</span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true"></a>  <span class="kw">c</span>(<span class="op">-</span><span class="fl">0.53863</span>,  <span class="fl">2.01020</span>,  <span class="fl">0.00000</span>),</span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true"></a>  <span class="kw">c</span>(<span class="op">-</span><span class="fl">1.47157</span>,  <span class="fl">1.47157</span>,  <span class="fl">0.00000</span>),</span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true"></a>  <span class="kw">c</span>(<span class="op">-</span><span class="fl">2.01020</span>,  <span class="fl">0.53863</span>,  <span class="fl">0.00000</span>),</span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true"></a>  <span class="kw">c</span>(<span class="op">-</span><span class="fl">2.01020</span>, <span class="fl">-0.53863</span>,  <span class="fl">0.00000</span>),</span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true"></a>  <span class="kw">c</span>(<span class="op">-</span><span class="fl">1.47157</span>, <span class="fl">-1.47157</span>,  <span class="fl">0.00000</span>),</span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true"></a>  <span class="kw">c</span>(<span class="op">-</span><span class="fl">0.53863</span>, <span class="fl">-2.01020</span>,  <span class="fl">0.00000</span>),</span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true"></a>  <span class="kw">c</span>( <span class="fl">0.53863</span>, <span class="fl">-2.01020</span>,  <span class="fl">0.00000</span>),</span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true"></a>  <span class="kw">c</span>( <span class="fl">1.47157</span>, <span class="fl">-1.47157</span>,  <span class="fl">0.00000</span>),</span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true"></a>  <span class="kw">c</span>( <span class="fl">2.01020</span>, <span class="fl">-0.53863</span>,  <span class="fl">0.00000</span>),</span>
<span id="cb1-38"><a href="#cb1-38" aria-hidden="true"></a>  <span class="kw">c</span>( <span class="fl">0.89068</span>,  <span class="fl">0.23866</span>,  <span class="fl">1.77777</span>),</span>
<span id="cb1-39"><a href="#cb1-39" aria-hidden="true"></a>  <span class="kw">c</span>( <span class="fl">0.89068</span>, <span class="fl">-0.23866</span>,  <span class="fl">1.77777</span>),</span>
<span id="cb1-40"><a href="#cb1-40" aria-hidden="true"></a>  <span class="kw">c</span>( <span class="fl">0.65202</span>, <span class="fl">-0.65202</span>,  <span class="fl">1.77777</span>),</span>
<span id="cb1-41"><a href="#cb1-41" aria-hidden="true"></a>  <span class="kw">c</span>( <span class="fl">0.23866</span>, <span class="fl">-0.89068</span>,  <span class="fl">1.77777</span>),</span>
<span id="cb1-42"><a href="#cb1-42" aria-hidden="true"></a>  <span class="kw">c</span>(<span class="op">-</span><span class="fl">0.23866</span>, <span class="fl">-0.89068</span>,  <span class="fl">1.77777</span>),</span>
<span id="cb1-43"><a href="#cb1-43" aria-hidden="true"></a>  <span class="kw">c</span>(<span class="op">-</span><span class="fl">0.65202</span>, <span class="fl">-0.65202</span>,  <span class="fl">1.77777</span>),</span>
<span id="cb1-44"><a href="#cb1-44" aria-hidden="true"></a>  <span class="kw">c</span>(<span class="op">-</span><span class="fl">0.89068</span>, <span class="fl">-0.23866</span>,  <span class="fl">1.77777</span>),</span>
<span id="cb1-45"><a href="#cb1-45" aria-hidden="true"></a>  <span class="kw">c</span>(<span class="op">-</span><span class="fl">0.89068</span>,  <span class="fl">0.23866</span>,  <span class="fl">1.77777</span>),</span>
<span id="cb1-46"><a href="#cb1-46" aria-hidden="true"></a>  <span class="kw">c</span>(<span class="op">-</span><span class="fl">0.65202</span>,  <span class="fl">0.65202</span>,  <span class="fl">1.77777</span>),</span>
<span id="cb1-47"><a href="#cb1-47" aria-hidden="true"></a>  <span class="kw">c</span>(<span class="op">-</span><span class="fl">0.23866</span>,  <span class="fl">0.89068</span>,  <span class="fl">1.77777</span>),</span>
<span id="cb1-48"><a href="#cb1-48" aria-hidden="true"></a>  <span class="kw">c</span>( <span class="fl">0.23866</span>,  <span class="fl">0.89068</span>,  <span class="fl">1.77777</span>),</span>
<span id="cb1-49"><a href="#cb1-49" aria-hidden="true"></a>  <span class="kw">c</span>( <span class="fl">0.65202</span>,  <span class="fl">0.65202</span>,  <span class="fl">1.77777</span>),</span>
<span id="cb1-50"><a href="#cb1-50" aria-hidden="true"></a>  <span class="kw">c</span>( <span class="fl">0.65202</span>, <span class="fl">-0.65202</span>, <span class="fl">-1.77777</span>),</span>
<span id="cb1-51"><a href="#cb1-51" aria-hidden="true"></a>  <span class="kw">c</span>( <span class="fl">0.89068</span>, <span class="fl">-0.23866</span>, <span class="fl">-1.77777</span>),</span>
<span id="cb1-52"><a href="#cb1-52" aria-hidden="true"></a>  <span class="kw">c</span>( <span class="fl">0.89068</span>,  <span class="fl">0.23866</span>, <span class="fl">-1.77777</span>),</span>
<span id="cb1-53"><a href="#cb1-53" aria-hidden="true"></a>  <span class="kw">c</span>( <span class="fl">0.65202</span>,  <span class="fl">0.65202</span>, <span class="fl">-1.77777</span>),</span>
<span id="cb1-54"><a href="#cb1-54" aria-hidden="true"></a>  <span class="kw">c</span>( <span class="fl">0.23866</span>,  <span class="fl">0.89068</span>, <span class="fl">-1.77777</span>),</span>
<span id="cb1-55"><a href="#cb1-55" aria-hidden="true"></a>  <span class="kw">c</span>(<span class="op">-</span><span class="fl">0.23866</span>,  <span class="fl">0.89068</span>, <span class="fl">-1.77777</span>),</span>
<span id="cb1-56"><a href="#cb1-56" aria-hidden="true"></a>  <span class="kw">c</span>(<span class="op">-</span><span class="fl">0.65202</span>,  <span class="fl">0.65202</span>, <span class="fl">-1.77777</span>),</span>
<span id="cb1-57"><a href="#cb1-57" aria-hidden="true"></a>  <span class="kw">c</span>(<span class="op">-</span><span class="fl">0.89068</span>,  <span class="fl">0.23866</span>, <span class="fl">-1.77777</span>),</span>
<span id="cb1-58"><a href="#cb1-58" aria-hidden="true"></a>  <span class="kw">c</span>(<span class="op">-</span><span class="fl">0.89068</span>, <span class="fl">-0.23866</span>, <span class="fl">-1.77777</span>),</span>
<span id="cb1-59"><a href="#cb1-59" aria-hidden="true"></a>  <span class="kw">c</span>(<span class="op">-</span><span class="fl">0.65202</span>, <span class="fl">-0.65202</span>, <span class="fl">-1.77777</span>),</span>
<span id="cb1-60"><a href="#cb1-60" aria-hidden="true"></a>  <span class="kw">c</span>(<span class="op">-</span><span class="fl">0.23866</span>, <span class="fl">-0.89068</span>, <span class="fl">-1.77777</span>),</span>
<span id="cb1-61"><a href="#cb1-61" aria-hidden="true"></a>  <span class="kw">c</span>( <span class="fl">0.23866</span>, <span class="fl">-0.89068</span>, <span class="fl">-1.77777</span>),</span>
<span id="cb1-62"><a href="#cb1-62" aria-hidden="true"></a>  <span class="kw">c</span>( <span class="fl">0.00000</span>,  <span class="fl">0.00000</span>,  <span class="fl">2.04922</span>),</span>
<span id="cb1-63"><a href="#cb1-63" aria-hidden="true"></a>  <span class="kw">c</span>( <span class="fl">0.00000</span>,  <span class="fl">0.00000</span>, <span class="fl">-2.04922</span>)</span>
<span id="cb1-64"><a href="#cb1-64" aria-hidden="true"></a>)</span>
<span id="cb1-65"><a href="#cb1-65" aria-hidden="true"></a></span>
<span id="cb1-66"><a href="#cb1-66" aria-hidden="true"></a>triangles &lt;-<span class="st"> </span><span class="kw">lapply</span>(<span class="kw">list</span>(</span>
<span id="cb1-67"><a href="#cb1-67" aria-hidden="true"></a>  <span class="kw">c</span>(<span class="dv">36</span>, <span class="dv">60</span>, <span class="dv">47</span>), </span>
<span id="cb1-68"><a href="#cb1-68" aria-hidden="true"></a>  <span class="kw">c</span>(<span class="dv">37</span>, <span class="dv">60</span>, <span class="dv">36</span>), </span>
<span id="cb1-69"><a href="#cb1-69" aria-hidden="true"></a>  <span class="kw">c</span>(<span class="dv">38</span>, <span class="dv">60</span>, <span class="dv">37</span>), </span>
<span id="cb1-70"><a href="#cb1-70" aria-hidden="true"></a>  <span class="kw">c</span>(<span class="dv">39</span>, <span class="dv">60</span>, <span class="dv">38</span>), </span>
<span id="cb1-71"><a href="#cb1-71" aria-hidden="true"></a>  <span class="kw">c</span>(<span class="dv">40</span>, <span class="dv">60</span>, <span class="dv">39</span>), </span>
<span id="cb1-72"><a href="#cb1-72" aria-hidden="true"></a>  <span class="kw">c</span>(<span class="dv">41</span>, <span class="dv">60</span>, <span class="dv">40</span>), </span>
<span id="cb1-73"><a href="#cb1-73" aria-hidden="true"></a>  <span class="kw">c</span>(<span class="dv">42</span>, <span class="dv">60</span>, <span class="dv">41</span>), </span>
<span id="cb1-74"><a href="#cb1-74" aria-hidden="true"></a>  <span class="kw">c</span>(<span class="dv">43</span>, <span class="dv">60</span>, <span class="dv">42</span>), </span>
<span id="cb1-75"><a href="#cb1-75" aria-hidden="true"></a>  <span class="kw">c</span>(<span class="dv">44</span>, <span class="dv">60</span>, <span class="dv">43</span>), </span>
<span id="cb1-76"><a href="#cb1-76" aria-hidden="true"></a>  <span class="kw">c</span>(<span class="dv">45</span>, <span class="dv">60</span>, <span class="dv">44</span>), </span>
<span id="cb1-77"><a href="#cb1-77" aria-hidden="true"></a>  <span class="kw">c</span>(<span class="dv">46</span>, <span class="dv">60</span>, <span class="dv">45</span>), </span>
<span id="cb1-78"><a href="#cb1-78" aria-hidden="true"></a>  <span class="kw">c</span>(<span class="dv">47</span>, <span class="dv">60</span>, <span class="dv">46</span>), </span>
<span id="cb1-79"><a href="#cb1-79" aria-hidden="true"></a>  <span class="kw">c</span>(<span class="dv">48</span>, <span class="dv">61</span>, <span class="dv">59</span>), </span>
<span id="cb1-80"><a href="#cb1-80" aria-hidden="true"></a>  <span class="kw">c</span>(<span class="dv">49</span>, <span class="dv">61</span>, <span class="dv">48</span>), </span>
<span id="cb1-81"><a href="#cb1-81" aria-hidden="true"></a>  <span class="kw">c</span>(<span class="dv">50</span>, <span class="dv">61</span>, <span class="dv">49</span>), </span>
<span id="cb1-82"><a href="#cb1-82" aria-hidden="true"></a>  <span class="kw">c</span>(<span class="dv">51</span>, <span class="dv">61</span>, <span class="dv">50</span>), </span>
<span id="cb1-83"><a href="#cb1-83" aria-hidden="true"></a>  <span class="kw">c</span>(<span class="dv">52</span>, <span class="dv">61</span>, <span class="dv">51</span>), </span>
<span id="cb1-84"><a href="#cb1-84" aria-hidden="true"></a>  <span class="kw">c</span>(<span class="dv">53</span>, <span class="dv">61</span>, <span class="dv">52</span>), </span>
<span id="cb1-85"><a href="#cb1-85" aria-hidden="true"></a>  <span class="kw">c</span>(<span class="dv">54</span>, <span class="dv">61</span>, <span class="dv">53</span>), </span>
<span id="cb1-86"><a href="#cb1-86" aria-hidden="true"></a>  <span class="kw">c</span>(<span class="dv">55</span>, <span class="dv">61</span>, <span class="dv">54</span>), </span>
<span id="cb1-87"><a href="#cb1-87" aria-hidden="true"></a>  <span class="kw">c</span>(<span class="dv">56</span>, <span class="dv">61</span>, <span class="dv">55</span>), </span>
<span id="cb1-88"><a href="#cb1-88" aria-hidden="true"></a>  <span class="kw">c</span>(<span class="dv">57</span>, <span class="dv">61</span>, <span class="dv">56</span>), </span>
<span id="cb1-89"><a href="#cb1-89" aria-hidden="true"></a>  <span class="kw">c</span>(<span class="dv">58</span>, <span class="dv">61</span>, <span class="dv">57</span>), </span>
<span id="cb1-90"><a href="#cb1-90" aria-hidden="true"></a>  <span class="kw">c</span>(<span class="dv">59</span>, <span class="dv">61</span>, <span class="dv">58</span>)</span>
<span id="cb1-91"><a href="#cb1-91" aria-hidden="true"></a>), <span class="cf">function</span>(x) x <span class="op">+</span><span class="st"> </span><span class="dv">1</span>)</span>
<span id="cb1-92"><a href="#cb1-92" aria-hidden="true"></a>quads &lt;-<span class="st"> </span><span class="kw">lapply</span>(<span class="kw">list</span>(</span>
<span id="cb1-93"><a href="#cb1-93" aria-hidden="true"></a>  <span class="kw">c</span>( <span class="dv">0</span>, <span class="dv">11</span>, <span class="dv">24</span>, <span class="dv">35</span>), </span>
<span id="cb1-94"><a href="#cb1-94" aria-hidden="true"></a>  <span class="kw">c</span>(<span class="dv">10</span>, <span class="dv">25</span>, <span class="dv">24</span>, <span class="dv">11</span>), </span>
<span id="cb1-95"><a href="#cb1-95" aria-hidden="true"></a>  <span class="kw">c</span>( <span class="dv">9</span>, <span class="dv">26</span>, <span class="dv">25</span>, <span class="dv">10</span>), </span>
<span id="cb1-96"><a href="#cb1-96" aria-hidden="true"></a>  <span class="kw">c</span>( <span class="dv">8</span>, <span class="dv">27</span>, <span class="dv">26</span>,  <span class="dv">9</span>), </span>
<span id="cb1-97"><a href="#cb1-97" aria-hidden="true"></a>  <span class="kw">c</span>( <span class="dv">7</span>, <span class="dv">28</span>, <span class="dv">27</span>,  <span class="dv">8</span>), </span>
<span id="cb1-98"><a href="#cb1-98" aria-hidden="true"></a>  <span class="kw">c</span>( <span class="dv">6</span>, <span class="dv">29</span>, <span class="dv">28</span>,  <span class="dv">7</span>), </span>
<span id="cb1-99"><a href="#cb1-99" aria-hidden="true"></a>  <span class="kw">c</span>( <span class="dv">5</span>, <span class="dv">30</span>, <span class="dv">29</span>,  <span class="dv">6</span>), </span>
<span id="cb1-100"><a href="#cb1-100" aria-hidden="true"></a>  <span class="kw">c</span>( <span class="dv">4</span>, <span class="dv">31</span>, <span class="dv">30</span>,  <span class="dv">5</span>), </span>
<span id="cb1-101"><a href="#cb1-101" aria-hidden="true"></a>  <span class="kw">c</span>( <span class="dv">3</span>, <span class="dv">32</span>, <span class="dv">31</span>,  <span class="dv">4</span>), </span>
<span id="cb1-102"><a href="#cb1-102" aria-hidden="true"></a>  <span class="kw">c</span>( <span class="dv">2</span>, <span class="dv">33</span>, <span class="dv">32</span>,  <span class="dv">3</span>), </span>
<span id="cb1-103"><a href="#cb1-103" aria-hidden="true"></a>  <span class="kw">c</span>( <span class="dv">1</span>, <span class="dv">34</span>, <span class="dv">33</span>,  <span class="dv">2</span>), </span>
<span id="cb1-104"><a href="#cb1-104" aria-hidden="true"></a>  <span class="kw">c</span>( <span class="dv">0</span>, <span class="dv">35</span>, <span class="dv">34</span>,  <span class="dv">1</span>), </span>
<span id="cb1-105"><a href="#cb1-105" aria-hidden="true"></a>  <span class="kw">c</span>(<span class="dv">12</span>, <span class="dv">35</span>, <span class="dv">24</span>, <span class="dv">13</span>), </span>
<span id="cb1-106"><a href="#cb1-106" aria-hidden="true"></a>  <span class="kw">c</span>(<span class="dv">13</span>, <span class="dv">24</span>, <span class="dv">25</span>, <span class="dv">14</span>), </span>
<span id="cb1-107"><a href="#cb1-107" aria-hidden="true"></a>  <span class="kw">c</span>(<span class="dv">14</span>, <span class="dv">25</span>, <span class="dv">26</span>, <span class="dv">15</span>), </span>
<span id="cb1-108"><a href="#cb1-108" aria-hidden="true"></a>  <span class="kw">c</span>(<span class="dv">15</span>, <span class="dv">26</span>, <span class="dv">27</span>, <span class="dv">16</span>), </span>
<span id="cb1-109"><a href="#cb1-109" aria-hidden="true"></a>  <span class="kw">c</span>(<span class="dv">16</span>, <span class="dv">27</span>, <span class="dv">28</span>, <span class="dv">17</span>), </span>
<span id="cb1-110"><a href="#cb1-110" aria-hidden="true"></a>  <span class="kw">c</span>(<span class="dv">17</span>, <span class="dv">28</span>, <span class="dv">29</span>, <span class="dv">18</span>), </span>
<span id="cb1-111"><a href="#cb1-111" aria-hidden="true"></a>  <span class="kw">c</span>(<span class="dv">18</span>, <span class="dv">29</span>, <span class="dv">30</span>, <span class="dv">19</span>), </span>
<span id="cb1-112"><a href="#cb1-112" aria-hidden="true"></a>  <span class="kw">c</span>(<span class="dv">19</span>, <span class="dv">30</span>, <span class="dv">31</span>, <span class="dv">20</span>), </span>
<span id="cb1-113"><a href="#cb1-113" aria-hidden="true"></a>  <span class="kw">c</span>(<span class="dv">20</span>, <span class="dv">31</span>, <span class="dv">32</span>, <span class="dv">21</span>), </span>
<span id="cb1-114"><a href="#cb1-114" aria-hidden="true"></a>  <span class="kw">c</span>(<span class="dv">21</span>, <span class="dv">32</span>, <span class="dv">33</span>, <span class="dv">22</span>), </span>
<span id="cb1-115"><a href="#cb1-115" aria-hidden="true"></a>  <span class="kw">c</span>(<span class="dv">22</span>, <span class="dv">33</span>, <span class="dv">34</span>, <span class="dv">23</span>), </span>
<span id="cb1-116"><a href="#cb1-116" aria-hidden="true"></a>  <span class="kw">c</span>(<span class="dv">12</span>, <span class="dv">23</span>, <span class="dv">34</span>, <span class="dv">35</span>), </span>
<span id="cb1-117"><a href="#cb1-117" aria-hidden="true"></a>  <span class="kw">c</span>( <span class="dv">0</span>, <span class="dv">37</span>, <span class="dv">36</span>, <span class="dv">11</span>), </span>
<span id="cb1-118"><a href="#cb1-118" aria-hidden="true"></a>  <span class="kw">c</span>( <span class="dv">0</span>,  <span class="dv">1</span>, <span class="dv">38</span>, <span class="dv">37</span>), </span>
<span id="cb1-119"><a href="#cb1-119" aria-hidden="true"></a>  <span class="kw">c</span>( <span class="dv">1</span>,  <span class="dv">2</span>, <span class="dv">39</span>, <span class="dv">38</span>), </span>
<span id="cb1-120"><a href="#cb1-120" aria-hidden="true"></a>  <span class="kw">c</span>( <span class="dv">2</span>,  <span class="dv">3</span>, <span class="dv">40</span>, <span class="dv">39</span>), </span>
<span id="cb1-121"><a href="#cb1-121" aria-hidden="true"></a>  <span class="kw">c</span>( <span class="dv">3</span>,  <span class="dv">4</span>, <span class="dv">41</span>, <span class="dv">40</span>), </span>
<span id="cb1-122"><a href="#cb1-122" aria-hidden="true"></a>  <span class="kw">c</span>( <span class="dv">4</span>,  <span class="dv">5</span>, <span class="dv">42</span>, <span class="dv">41</span>), </span>
<span id="cb1-123"><a href="#cb1-123" aria-hidden="true"></a>  <span class="kw">c</span>( <span class="dv">5</span>,  <span class="dv">6</span>, <span class="dv">43</span>, <span class="dv">42</span>), </span>
<span id="cb1-124"><a href="#cb1-124" aria-hidden="true"></a>  <span class="kw">c</span>( <span class="dv">6</span>,  <span class="dv">7</span>, <span class="dv">44</span>, <span class="dv">43</span>), </span>
<span id="cb1-125"><a href="#cb1-125" aria-hidden="true"></a>  <span class="kw">c</span>( <span class="dv">7</span>,  <span class="dv">8</span>, <span class="dv">45</span>, <span class="dv">44</span>), </span>
<span id="cb1-126"><a href="#cb1-126" aria-hidden="true"></a>  <span class="kw">c</span>( <span class="dv">8</span>,  <span class="dv">9</span>, <span class="dv">46</span>, <span class="dv">45</span>), </span>
<span id="cb1-127"><a href="#cb1-127" aria-hidden="true"></a>  <span class="kw">c</span>( <span class="dv">9</span>, <span class="dv">10</span>, <span class="dv">47</span>, <span class="dv">46</span>), </span>
<span id="cb1-128"><a href="#cb1-128" aria-hidden="true"></a>  <span class="kw">c</span>(<span class="dv">10</span>, <span class="dv">11</span>, <span class="dv">36</span>, <span class="dv">47</span>), </span>
<span id="cb1-129"><a href="#cb1-129" aria-hidden="true"></a>  <span class="kw">c</span>(<span class="dv">12</span>, <span class="dv">49</span>, <span class="dv">48</span>, <span class="dv">23</span>), </span>
<span id="cb1-130"><a href="#cb1-130" aria-hidden="true"></a>  <span class="kw">c</span>(<span class="dv">12</span>, <span class="dv">13</span>, <span class="dv">50</span>, <span class="dv">49</span>), </span>
<span id="cb1-131"><a href="#cb1-131" aria-hidden="true"></a>  <span class="kw">c</span>(<span class="dv">13</span>, <span class="dv">14</span>, <span class="dv">51</span>, <span class="dv">50</span>), </span>
<span id="cb1-132"><a href="#cb1-132" aria-hidden="true"></a>  <span class="kw">c</span>(<span class="dv">14</span>, <span class="dv">15</span>, <span class="dv">52</span>, <span class="dv">51</span>), </span>
<span id="cb1-133"><a href="#cb1-133" aria-hidden="true"></a>  <span class="kw">c</span>(<span class="dv">15</span>, <span class="dv">16</span>, <span class="dv">53</span>, <span class="dv">52</span>), </span>
<span id="cb1-134"><a href="#cb1-134" aria-hidden="true"></a>  <span class="kw">c</span>(<span class="dv">16</span>, <span class="dv">17</span>, <span class="dv">54</span>, <span class="dv">53</span>), </span>
<span id="cb1-135"><a href="#cb1-135" aria-hidden="true"></a>  <span class="kw">c</span>(<span class="dv">17</span>, <span class="dv">18</span>, <span class="dv">55</span>, <span class="dv">54</span>), </span>
<span id="cb1-136"><a href="#cb1-136" aria-hidden="true"></a>  <span class="kw">c</span>(<span class="dv">18</span>, <span class="dv">19</span>, <span class="dv">56</span>, <span class="dv">55</span>), </span>
<span id="cb1-137"><a href="#cb1-137" aria-hidden="true"></a>  <span class="kw">c</span>(<span class="dv">19</span>, <span class="dv">20</span>, <span class="dv">57</span>, <span class="dv">56</span>), </span>
<span id="cb1-138"><a href="#cb1-138" aria-hidden="true"></a>  <span class="kw">c</span>(<span class="dv">20</span>, <span class="dv">21</span>, <span class="dv">58</span>, <span class="dv">57</span>), </span>
<span id="cb1-139"><a href="#cb1-139" aria-hidden="true"></a>  <span class="kw">c</span>(<span class="dv">21</span>, <span class="dv">22</span>, <span class="dv">59</span>, <span class="dv">58</span>), </span>
<span id="cb1-140"><a href="#cb1-140" aria-hidden="true"></a>  <span class="kw">c</span>(<span class="dv">22</span>, <span class="dv">23</span>, <span class="dv">48</span>, <span class="dv">59</span>)</span>
<span id="cb1-141"><a href="#cb1-141" aria-hidden="true"></a>), <span class="cf">function</span>(x) x <span class="op">+</span><span class="st"> </span><span class="dv">1</span>)</span>
<span id="cb1-142"><a href="#cb1-142" aria-hidden="true"></a>faces &lt;-<span class="st"> </span><span class="kw">c</span>(triangles, quads)</span>
<span id="cb1-143"><a href="#cb1-143" aria-hidden="true"></a></span>
<span id="cb1-144"><a href="#cb1-144" aria-hidden="true"></a>Leonardo &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">vertices =</span> vertices, <span class="dt">faces =</span> faces)</span></code></pre></div>
<p>In order to produce the above plot with <strong>rgl</strong>, I triangulated the two meshes. Actually this is not necessary for the Leonardo mesh, since <strong>rgl</strong> allows meshes with triangles and quads. This is necessary for the mesh of the truncated icosahedron, because it has some faces with more than four sides.</p>
<p>To triangulate a mesh with <strong>MeshesOperations</strong>, I recommend to use the option <code>numbersType = "lazyExact"</code>:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true"></a><span class="kw">library</span>(MeshesOperations)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true"></a>tLeonardo &lt;-<span class="st"> </span><span class="kw">Mesh</span>(</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true"></a>  <span class="dt">mesh =</span> Leonardo, <span class="dt">triangulate =</span> <span class="ot">TRUE</span>,</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true"></a>  <span class="dt">numbersType =</span> <span class="st">&quot;lazyExact&quot;</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true"></a>)</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true"></a>tmesh     &lt;-<span class="st"> </span><span class="kw">Mesh</span>(</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true"></a>  <span class="dt">mesh =</span> truncatedIcosahedron, <span class="dt">triangulate =</span> <span class="ot">TRUE</span>,</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true"></a>  <span class="dt">numbersType =</span> <span class="st">&quot;lazyExact&quot;</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true"></a>)</span></code></pre></div>
<p>Now, here is the code which generates the picture shown before:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true"></a><span class="kw">library</span>(rgl)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true"></a><span class="kw">open3d</span>(<span class="dt">windowRect =</span> <span class="kw">c</span>(<span class="dv">50</span>, <span class="dv">50</span>, <span class="dv">850</span>, <span class="dv">450</span>))</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true"></a><span class="kw">mfrow3d</span>(1L, 2L)</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true"></a><span class="kw">view3d</span>(<span class="dv">30</span>, <span class="dv">30</span>, <span class="dt">zoom =</span> <span class="fl">0.7</span>)</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true"></a><span class="kw">shade3d</span>(<span class="kw">toRGL</span>(tLeonardo), <span class="dt">color =</span> <span class="st">&quot;navy&quot;</span>)</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true"></a><span class="kw">plotEdges</span>(</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true"></a>  tLeonardo[[<span class="st">&quot;vertices&quot;</span>]], tLeonardo[[<span class="st">&quot;exteriorEdges&quot;</span>]], </span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true"></a>  <span class="dt">color =</span> <span class="st">&quot;gold&quot;</span>, <span class="dt">tubesRadius =</span> <span class="fl">0.06</span>, <span class="dt">spheresRadius =</span> <span class="fl">0.08</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true"></a>)</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true"></a><span class="kw">next3d</span>()</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true"></a><span class="kw">view3d</span>(<span class="dv">30</span>, <span class="dv">30</span>, <span class="dt">zoom =</span> <span class="fl">0.7</span>)</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true"></a><span class="kw">shade3d</span>(<span class="kw">toRGL</span>(tmesh), <span class="dt">color =</span> <span class="st">&quot;navy&quot;</span>)</span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true"></a><span class="kw">plotEdges</span>(</span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true"></a>  tmesh[[<span class="st">&quot;vertices&quot;</span>]], tmesh[[<span class="st">&quot;exteriorEdges&quot;</span>]], </span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true"></a>  <span class="dt">color =</span> <span class="st">&quot;gold&quot;</span>, <span class="dt">tubesRadius =</span> <span class="fl">0.06</span>, <span class="dt">spheresRadius =</span> <span class="fl">0.08</span></span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true"></a>)</span></code></pre></div>
<p>Now let’s see the Minkowski sum of these two polyhedra:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true"></a>MinkMesh &lt;-<span class="st"> </span><span class="kw">MinkowskiSum</span>(Leonardo, truncatedIcosahedron) </span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true"></a></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true"></a><span class="kw">open3d</span>(<span class="dt">windowRect =</span> <span class="kw">c</span>(<span class="dv">50</span>, <span class="dv">50</span>, <span class="dv">562</span>, <span class="dv">562</span>), <span class="dt">zoom =</span> <span class="fl">0.8</span>)</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true"></a><span class="kw">shade3d</span>(<span class="kw">toRGL</span>(MinkMesh), <span class="dt">color=</span><span class="st">&quot;navy&quot;</span>)</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true"></a><span class="kw">plotEdges</span>(</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true"></a>  MinkMesh[[<span class="st">&quot;vertices&quot;</span>]], MinkMesh[[<span class="st">&quot;exteriorEdges&quot;</span>]], </span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true"></a>  <span class="dt">color =</span> <span class="st">&quot;gold&quot;</span>, <span class="dt">tubesRadius =</span> <span class="fl">0.06</span>, <span class="dt">spheresRadius =</span> <span class="fl">0.08</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true"></a>)</span></code></pre></div>
<p><img src="./figures/DaVinciPlusTruncIco.gif" /></p>
<p>Beautiful. The generation of the Minkowski sum is fast for this example. But it can be very slow for meshes with numerous vertices.</p>

        </div>


        <div id="footer">
          Site proudly generated by
          <a href="http://jaspervdj.be/hakyll">Hakyll</a>
        </div>

      </div>

    </div>

    <div class="row">
      <div class="col-sm-12">
        <div id="disqus_thread"></div>
        <div class="pagination">
          <ul>
            <li>
              <a href="http://laustep.github.io/stlahblog/">&#171; Back Home</a>
            </li>
          </ul>
        </div>
      </div>
    </div>
    
  </div>

</body>

<script src="/libraries/bootstrap/bootstrap.min.js"></script>
<script>
  var disqus_developer = 1;
  var disqus_shortname = 'stlapblog';
  // required: replace example with your forum shortname
  /* * * DON'T EDIT BELOW THIS LINE * * */
  (function () {
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = 'https://' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] ||
      document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>
<noscript>Please enable JavaScript to view the
  <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a>
</noscript>
<!-- MathJax: Fall back to local if CDN offline but local image fonts are not supported (saves >100MB) -->
<script type="text/x-mathjax-config" src="/libraries/mathjax/config/TeX-MML-AM_CHTML.js"></script>
<!-- <script>
  window.MathJax || document.write('<script type="text/x-mathjax-config">MathJax.Hub.Config({"HTML-CSS":{imageFont:null}});<\/script><script src="../libraries/mathjax/MathJax.js"><\/script>');
</script> -->


</html>]]></description>
    <pubDate>Sat, 11 Jun 2022 00:00:00 UT</pubDate>
    <guid>https://laustep.github.io/stlahblog/posts/MinkowskiSumLeonardo.html</guid>
    <dc:creator>Stéphane Laurent</dc:creator>
    <category>R</category>
</item>


<item>
    <title>Expanding a polynomial with 'caracas'</title>
    <link>https://laustep.github.io/stlahblog/posts/caracas01.html</link>
    <description><![CDATA[<!DOCTYPE HTML>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Saturn Elephant - Expanding a polynomial with 'caracas'</title>
  <link href="/libraries/bootstrap/bootstrap-grid.min.css" rel="stylesheet">
  <link rel="stylesheet" href="/css/default2.css" />
  <link rel="stylesheet" href="/css/post.css" />
  <link rel="stylesheet" href="/css/misc.css" /> 
  
    <link rel="stylesheet" href="/css/pandoc-solarized.css" /> 
   
  
  <link href="https://fonts.googleapis.com/css?family=Raleway:400,600,200,800" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/css?family=Droid+Sans" rel="stylesheet" type="text/css">
  <script src="/libraries/jquery.min.js"></script>
  <script type="text/javascript" async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML"></script>
</head>

<body>
  <div class="container-fluid">
    <div class="row">
      <!-- Sidebar. -->
      <div class="sidebar col-sm-2">
        <div class="row">
          <div class="col-sm-12" style="float:right;clear:both;margin-right:50px;margin-top:50px;">
            <a href="https://www.r-bloggers.com/">
              <img src="/images/Rbloggers.png" alt="Rbloggers" width="100%" />
            </a>
            <br/>
            <a href="http://t-redactyl.io/">
              <span style="color:black;font-weight:bold;font-family:sans-serif;font-size:25px;">Standard error</span>
            </a>
            <a href="http://timelyportfolio.blogspot.be/">
              <span style="color:grey;font-weight:bold;font-family:sans-serif;font-size:24px;">Timely portfolio</span>
            </a>
            <br/>
            <a href="https://antoineguillot.wordpress.com/blog/">
              <span style="color:white;background-color:darkblue;font-weight:bold;font-family:sans-serif;font-size:21px;border:5px solid;border-color:darkblue">ENHANCE DATA</span>
            </a>
            <br/>
            <a href="https://fronkonstin.com/">
              <span style="color:black;background-color:gold;font-weight:bold;font-size:29px;border:3px solid;border-color:gold;">Fronkonstin</span>
            </a>
          </div>
        </div>
        <div id="logos">
          <div class="row">
            <div class="col-sm-4">
              <img src="/images/AsymptoteLogo.svg" style="width: 150%; transform: rotateZ(-35deg)"/>
            </div>
            <div class="col-sm-4">
              <img src="/images/Rlogo.svg" style="width: 110%;"/>
            </div>
            <div class="col-sm-4">
              <img src="/images/shiny-hex.png" style="width: 90%;"/>
            </div>
          </div>
          <div class="row">
            <div class="col-sm-4">
              <img src="/images/Povray_logo_sphere.png" style="width: 105%;"/>
            </div>
            <div class="col-sm-4">
              <img src="/images/javascript.svg" style="width: 90%;"/>
            </div>
            <div class="col-sm-4">
              <img src="/images/haskell.svg" style="width: 110%;"/>
            </div>
          </div>
        </div>
      </div>

      <div class="main col-sm-10">
        <div id="header">
          <div id="logo">
            <a href="/">
              <img src="/images/stla.jpg" alt="stla" width="100px" />
            </a>
          </div>
          <div id="navigation" style="margin-top:50px;">
            <a href="/">Home</a>
            <a href="/about.html">About</a>
            <a href="/contact.html">Contact</a>
            <a href="/archive.html">Archive</a>
          </div>
        </div>

        <div class="content">
          <h1>Expanding a polynomial with 'caracas'</h1> 
          <div class="info">
    Posted on June  7, 2022
    
        by Stéphane Laurent
    
</div>
<div class="info">
    
    Tags: <a title="All pages tagged &#39;R&#39;." href="/tags/R.html">R</a>, <a title="All pages tagged &#39;povray&#39;." href="/tags/povray.html">povray</a>, <a title="All pages tagged &#39;graphics&#39;." href="/tags/graphics.html">graphics</a>, <a title="All pages tagged &#39;maths&#39;." href="/tags/maths.html">maths</a>, <a title="All pages tagged &#39;python&#39;." href="/tags/python.html">python</a>
    
</div>

<p>I wanted to plot an algebraic isosurface with <strong>POV-Ray</strong> but the expression of the polynomial defining the isosurface was very long (the polynomial had degree 12). Moreover there was a square root in the coefficients (<span class="math inline">\(\sqrt{3}\)</span>) as well as <span class="math inline">\(\cos t\)</span> and <span class="math inline">\(\sin t\)</span>, where <span class="math inline">\(t\)</span> is a parameter I wanted to vary in order to make an animation. So I needed a tool able to expand a polynomial with some literal values in the coefficients. This is not possible with the <strong>Ryacas</strong> package.</p>
<p>I finally found this tool: the <strong>caracas</strong> package. It allows to use the Python library <strong>SymPy</strong> in R. I didn’t carefully read its documentation yet, I don’t know whether it has other features. But this feature is a great one.</p>
<p>Here is a small example:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true"></a><span class="kw">library</span>(caracas)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true"></a><span class="kw">def_sym</span>(x, y, z, a, b) <span class="co"># symbolic values</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true"></a>poly &lt;-<span class="st"> </span><span class="kw">sympy_func</span>(</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true"></a>  x<span class="op">^</span><span class="dv">2</span> <span class="op">+</span><span class="st"> </span>a<span class="op">*</span>x<span class="op">^</span><span class="dv">2</span> <span class="op">+</span><span class="st"> </span><span class="dv">2</span><span class="op">/</span><span class="dv">3</span><span class="op">*</span>y <span class="op">+</span><span class="st"> </span>b<span class="op">*</span>y <span class="op">+</span><span class="st"> </span>x<span class="op">*</span>z <span class="op">+</span><span class="st"> </span>a<span class="op">*</span>x<span class="op">*</span>z, <span class="st">&quot;Poly&quot;</span>, <span class="dt">domain =</span> <span class="st">&quot;QQ[a,b]&quot;</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true"></a>)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true"></a><span class="kw">as.character</span>(poly)</span></code></pre></div>
<p>This gives:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true"></a><span class="st">&quot;Poly((a + 1)*x^2 + (a + 1)*x*z + (b + 2/3)*y, x, y, z, domain=&#39;QQ[a,b]&#39;)&quot;</span></span></code></pre></div>
<p>That is great. Here <code>QQ[a,b]</code> is the field <span class="math inline">\(\mathbb{Q}[a,b]\)</span>. I lost a significant part of my knowledge in mathematics but I think this is a field. It doesn’t matter. Roughly speaking, this is the set of rational numbers to which we add the two elements <span class="math inline">\(a\)</span> and <span class="math inline">\(b\)</span>. So there are treated as constants, as if they were some numbers.</p>
<p>To get a coefficient, for example the one of <span class="math inline">\(xz = x^1y^0z^1\)</span>:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true"></a>sympy &lt;-<span class="st"> </span><span class="kw">get_sympy</span>()</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true"></a>sympy<span class="op">$</span>Poly<span class="op">$</span><span class="kw">nth</span>(poly<span class="op">$</span>pyobj, 1L, 0L, 1L)</span></code></pre></div>
<p>This gives:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true"></a>a <span class="op">+</span><span class="st"> </span><span class="dv">1</span></span></code></pre></div>
<p>Everything needed for writing the POV-Ray code was there. I wrote a small script in addition to generate this code. I show it below with the above small example:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true"></a><span class="kw">library</span>(caracas)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true"></a><span class="kw">library</span>(partitions) <span class="co"># to get the compositions of an integer, </span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true"></a>                    <span class="co"># representing the degrees with a given total</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true"></a><span class="kw">def_sym</span>(x, y, z, a, b) </span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true"></a>poly &lt;-<span class="st"> </span><span class="kw">sympy_func</span>(</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true"></a>  x<span class="op">^</span><span class="dv">2</span> <span class="op">+</span><span class="st"> </span>a<span class="op">*</span>x<span class="op">^</span><span class="dv">2</span> <span class="op">+</span><span class="st"> </span><span class="dv">2</span><span class="op">/</span><span class="dv">3</span><span class="op">*</span>y <span class="op">+</span><span class="st"> </span>b<span class="op">*</span>y <span class="op">+</span><span class="st"> </span>x<span class="op">*</span>z <span class="op">+</span><span class="st"> </span>a<span class="op">*</span>x<span class="op">*</span>z, <span class="st">&quot;Poly&quot;</span>, <span class="dt">domain =</span> <span class="st">&quot;QQ[a,b]&quot;</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true"></a>)</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true"></a>sympy &lt;-<span class="st"> </span><span class="kw">get_sympy</span>()</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true"></a>f &lt;-<span class="st"> </span><span class="cf">function</span>(comp){</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true"></a>  xyz &lt;-<span class="st"> </span><span class="kw">sprintf</span>(<span class="st">&quot;xyz(%s): &quot;</span>, <span class="kw">toString</span>(comp))</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true"></a>  coef &lt;-<span class="st"> </span>sympy<span class="op">$</span>Poly<span class="op">$</span><span class="kw">nth</span>(poly<span class="op">$</span>pyobj, comp[1L], comp[2L], comp[3L])</span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true"></a>  <span class="cf">if</span>(coef <span class="op">==</span><span class="st"> </span><span class="dv">0</span>) <span class="kw">return</span>(<span class="ot">NULL</span>)</span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true"></a>  <span class="kw">paste0</span>(xyz, coef, <span class="st">&quot;,&quot;</span>)</span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true"></a>}</span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true"></a><span class="cf">for</span>(deg <span class="cf">in</span> 0L<span class="op">:</span>2L){</span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true"></a>  comps &lt;-<span class="st"> </span><span class="kw">compositions</span>(deg, 3L)</span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true"></a>  povray &lt;-<span class="st"> </span><span class="kw">apply</span>(comps, 2L, f, <span class="dt">simplify =</span> <span class="ot">FALSE</span>)</span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true"></a>  <span class="kw">cat</span>(</span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true"></a>    <span class="kw">unlist</span>(povray), <span class="dt">sep =</span> <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>, <span class="dt">file =</span> <span class="st">&quot;povray.txt&quot;</span>, <span class="dt">append =</span> deg <span class="op">&gt;</span><span class="st"> </span>0L</span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true"></a>  )</span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true"></a>}</span></code></pre></div>
<p>And here is the <strong>povray.txt</strong> file generated by this script:</p>
<pre><code>xyz(0, 1, 0): b + 2/3,
xyz(2, 0, 0): a + 1,
xyz(1, 0, 1): a + 1,</code></pre>
<p>One just has to remove the trailing comma, and this the desired POV-Ray code.</p>
<p>I won’t leave you without showing the animation:</p>
<p><img src="./figures/ICN5D_01.gif" /></p>
<p>Credit to ‘<strong>ICN5D</strong>’ for the isosurface.</p>

        </div>


        <div id="footer">
          Site proudly generated by
          <a href="http://jaspervdj.be/hakyll">Hakyll</a>
        </div>

      </div>

    </div>

    <div class="row">
      <div class="col-sm-12">
        <div id="disqus_thread"></div>
        <div class="pagination">
          <ul>
            <li>
              <a href="http://laustep.github.io/stlahblog/">&#171; Back Home</a>
            </li>
          </ul>
        </div>
      </div>
    </div>
    
  </div>

</body>

<script src="/libraries/bootstrap/bootstrap.min.js"></script>
<script>
  var disqus_developer = 1;
  var disqus_shortname = 'stlapblog';
  // required: replace example with your forum shortname
  /* * * DON'T EDIT BELOW THIS LINE * * */
  (function () {
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = 'https://' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] ||
      document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>
<noscript>Please enable JavaScript to view the
  <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a>
</noscript>
<!-- MathJax: Fall back to local if CDN offline but local image fonts are not supported (saves >100MB) -->
<script type="text/x-mathjax-config" src="/libraries/mathjax/config/TeX-MML-AM_CHTML.js"></script>
<!-- <script>
  window.MathJax || document.write('<script type="text/x-mathjax-config">MathJax.Hub.Config({"HTML-CSS":{imageFont:null}});<\/script><script src="../libraries/mathjax/MathJax.js"><\/script>');
</script> -->


</html>]]></description>
    <pubDate>Tue, 07 Jun 2022 00:00:00 UT</pubDate>
    <guid>https://laustep.github.io/stlahblog/posts/caracas01.html</guid>
    <dc:creator>Stéphane Laurent</dc:creator>
    <category>R</category>
</item>


<item>
    <title>Update of 'gyro'</title>
    <link>https://laustep.github.io/stlahblog/posts/gyroUpdate.html</link>
    <description><![CDATA[<!DOCTYPE HTML>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Saturn Elephant - Update of 'gyro'</title>
  <link href="/libraries/bootstrap/bootstrap-grid.min.css" rel="stylesheet">
  <link rel="stylesheet" href="/css/default2.css" />
  <link rel="stylesheet" href="/css/post.css" />
  <link rel="stylesheet" href="/css/misc.css" /> 
  
    <link rel="stylesheet" href="/css/pandoc-solarized.css" /> 
   
  
  <link href="https://fonts.googleapis.com/css?family=Raleway:400,600,200,800" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/css?family=Droid+Sans" rel="stylesheet" type="text/css">
  <script src="/libraries/jquery.min.js"></script>
  <script type="text/javascript" async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML"></script>
</head>

<body>
  <div class="container-fluid">
    <div class="row">
      <!-- Sidebar. -->
      <div class="sidebar col-sm-2">
        <div class="row">
          <div class="col-sm-12" style="float:right;clear:both;margin-right:50px;margin-top:50px;">
            <a href="https://www.r-bloggers.com/">
              <img src="/images/Rbloggers.png" alt="Rbloggers" width="100%" />
            </a>
            <br/>
            <a href="http://t-redactyl.io/">
              <span style="color:black;font-weight:bold;font-family:sans-serif;font-size:25px;">Standard error</span>
            </a>
            <a href="http://timelyportfolio.blogspot.be/">
              <span style="color:grey;font-weight:bold;font-family:sans-serif;font-size:24px;">Timely portfolio</span>
            </a>
            <br/>
            <a href="https://antoineguillot.wordpress.com/blog/">
              <span style="color:white;background-color:darkblue;font-weight:bold;font-family:sans-serif;font-size:21px;border:5px solid;border-color:darkblue">ENHANCE DATA</span>
            </a>
            <br/>
            <a href="https://fronkonstin.com/">
              <span style="color:black;background-color:gold;font-weight:bold;font-size:29px;border:3px solid;border-color:gold;">Fronkonstin</span>
            </a>
          </div>
        </div>
        <div id="logos">
          <div class="row">
            <div class="col-sm-4">
              <img src="/images/AsymptoteLogo.svg" style="width: 150%; transform: rotateZ(-35deg)"/>
            </div>
            <div class="col-sm-4">
              <img src="/images/Rlogo.svg" style="width: 110%;"/>
            </div>
            <div class="col-sm-4">
              <img src="/images/shiny-hex.png" style="width: 90%;"/>
            </div>
          </div>
          <div class="row">
            <div class="col-sm-4">
              <img src="/images/Povray_logo_sphere.png" style="width: 105%;"/>
            </div>
            <div class="col-sm-4">
              <img src="/images/javascript.svg" style="width: 90%;"/>
            </div>
            <div class="col-sm-4">
              <img src="/images/haskell.svg" style="width: 110%;"/>
            </div>
          </div>
        </div>
      </div>

      <div class="main col-sm-10">
        <div id="header">
          <div id="logo">
            <a href="/">
              <img src="/images/stla.jpg" alt="stla" width="100px" />
            </a>
          </div>
          <div id="navigation" style="margin-top:50px;">
            <a href="/">Home</a>
            <a href="/about.html">About</a>
            <a href="/contact.html">Contact</a>
            <a href="/archive.html">Archive</a>
          </div>
        </div>

        <div class="content">
          <h1>Update of 'gyro'</h1> 
          <div class="info">
    Posted on June  4, 2022
    
        by Stéphane Laurent
    
</div>
<div class="info">
    
    Tags: <a title="All pages tagged &#39;geometry&#39;." href="/tags/geometry.html">geometry</a>, <a title="All pages tagged &#39;R&#39;." href="/tags/R.html">R</a>, <a title="All pages tagged &#39;graphics&#39;." href="/tags/graphics.html">graphics</a>
    
</div>

<p>I updated the <strong>gyro</strong> package (soon on CRAN). Here are the new features.</p>
<h2 id="hyperbolic-polyhedra-in-the-poincaré-model">Hyperbolic polyhedra in the Poincaré model</h2>
<p>The previous version of the package only dealt with hyperbolic polyhedra in the Minkowski model. Now it is possible to get hyperbolic polyhedra in the Poincaré model. I don’t provide some example, because they look similar to the polyhedra in the Minkowski model (see <a href="https://laustep.github.io/stlahblog/posts/hyperbolicPolyhedra.html">this post</a>). I prefer the Minkowski model because one can change the hyperbolic curvature in this model.</p>
<h2 id="hyperbolic-tilings-of-the-poincaré-disk">Hyperbolic tilings of the Poincaré disk</h2>
<p>The package now provides the <code>tiling</code> function, which draws a hyperbolic tiling of the Poincaré disk.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true"></a><span class="kw">library</span>(gyro)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true"></a><span class="kw">tiling</span>(<span class="dv">7</span>, <span class="dv">4</span>, <span class="dt">depth =</span> <span class="dv">4</span>, <span class="dt">border =</span> <span class="st">&quot;darkred&quot;</span>, <span class="dt">lwd =</span> <span class="dv">2</span>)</span></code></pre></div>
<p><img src="./figures/htiling_7-4.png" /></p>
<h2 id="hyperbolic-delaunay-tessellations">Hyperbolic Delaunay tessellations</h2>
<p>The package now provides the <code>hdelaunay</code> function, which constructs a hyperbolic Delaunay triangulation in the Poincaré disk thanks to the C++ library <strong>CGAL</strong>, and the <code>plotHdelaunay</code> function, which plots such a triangulation.</p>
<p>Unfortunately, this new feature will not be included in the CRAN version, because of a C++ issue spotted by Valgrind. If you want to use it, you have to install the <strong>hdelaunay</strong> branch of the Github repo:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true"></a>remotes<span class="op">::</span><span class="kw">install_github</span>(<span class="st">&quot;stla/gyro@hdelaunay&quot;</span>, <span class="dt">build_vignettes =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<p>Here is a first example:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true"></a><span class="kw">library</span>(gyro)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true"></a><span class="kw">library</span>(uniformly)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true"></a><span class="kw">set.seed</span>(<span class="dv">666</span>)</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true"></a>points &lt;-<span class="st"> </span><span class="kw">runif_in_sphere</span>(50L, <span class="dt">d =</span> <span class="dv">2</span>)</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true"></a>hdel &lt;-<span class="st"> </span><span class="kw">hdelaunay</span>(points)</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true"></a><span class="kw">plotHdelaunay</span>(hdel, <span class="dt">color=</span><span class="st">&quot;random&quot;</span>, <span class="dt">luminosity=</span><span class="st">&quot;bright&quot;</span>)</span></code></pre></div>
<p><img src="./figures/hdelaunay1.png" /></p>
<p>Actually the faces of the hyperbolic Delaunay triangulation are the same as the ones of the Euclidean Delaunay triangulation, except that they are hyperbolic, up to this point: as you can see on the above plot, there are some edges without incident face; this occurs when the circumcircle of the missing Euclidean Delaunay face is not contained in the unit disk.</p>
<p>Here is a second example, not random:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true"></a><span class="kw">library</span>(gyro)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true"></a><span class="kw">library</span>(trekcolors)</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true"></a>phi &lt;-<span class="st"> </span>(<span class="dv">1</span> <span class="op">+</span><span class="st"> </span><span class="kw">sqrt</span>(<span class="dv">5</span>)) <span class="op">/</span><span class="st"> </span><span class="dv">2</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true"></a>theta &lt;-<span class="st"> </span><span class="kw">head</span>(<span class="kw">seq</span>(<span class="dv">0</span>, pi<span class="op">/</span><span class="dv">2</span>, <span class="dt">length.out =</span> 11L), <span class="op">-</span>1L)</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true"></a>a &lt;-<span class="st"> </span>phi<span class="op">^</span>((<span class="dv">2</span><span class="op">*</span>theta<span class="op">/</span>pi)<span class="op">^</span><span class="fl">0.8</span> <span class="op">-</span><span class="st"> </span><span class="dv">1</span>)</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true"></a>u &lt;-<span class="st"> </span>a <span class="op">*</span><span class="st"> </span><span class="kw">cos</span>(theta)</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true"></a>v &lt;-<span class="st"> </span>a <span class="op">*</span><span class="st"> </span><span class="kw">sin</span>(theta)</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true"></a>x &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">0</span>, u, <span class="op">-</span>v, <span class="op">-</span>u, v)</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true"></a>y &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">0</span>, v, u, <span class="op">-</span>v, <span class="op">-</span>u)</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true"></a>pts &lt;-<span class="st"> </span><span class="kw">cbind</span>(x, y) <span class="op">/</span><span class="st"> </span><span class="fl">1.03</span></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true"></a>hdel &lt;-<span class="st"> </span><span class="kw">hdelaunay</span>(pts, <span class="dt">centroids =</span> <span class="ot">TRUE</span>, <span class="dt">exact =</span> <span class="ot">TRUE</span>)</span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true"></a>fcolor &lt;-<span class="st"> </span><span class="cf">function</span>(t){</span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true"></a>    RGB &lt;-<span class="st"> </span><span class="kw">colorRamp</span>(<span class="kw">trek_pal</span>(<span class="st">&quot;klingon&quot;</span>))(t)</span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true"></a>    <span class="kw">rgb</span>(RGB[, 1L], RGB[, 2L], RGB[, 3L], <span class="dt">maxColorValue =</span> <span class="dv">255</span>)</span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true"></a>}</span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true"></a><span class="kw">plotHdelaunay</span>(</span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true"></a>        hdel, <span class="dt">vertices =</span> <span class="ot">FALSE</span>, <span class="dt">circle =</span> <span class="ot">FALSE</span>, <span class="dt">color =</span> fcolor</span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true"></a>)</span></code></pre></div>
<p><img src="./figures/hdelaunay2.png" /></p>

        </div>


        <div id="footer">
          Site proudly generated by
          <a href="http://jaspervdj.be/hakyll">Hakyll</a>
        </div>

      </div>

    </div>

    <div class="row">
      <div class="col-sm-12">
        <div id="disqus_thread"></div>
        <div class="pagination">
          <ul>
            <li>
              <a href="http://laustep.github.io/stlahblog/">&#171; Back Home</a>
            </li>
          </ul>
        </div>
      </div>
    </div>
    
  </div>

</body>

<script src="/libraries/bootstrap/bootstrap.min.js"></script>
<script>
  var disqus_developer = 1;
  var disqus_shortname = 'stlapblog';
  // required: replace example with your forum shortname
  /* * * DON'T EDIT BELOW THIS LINE * * */
  (function () {
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = 'https://' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] ||
      document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>
<noscript>Please enable JavaScript to view the
  <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a>
</noscript>
<!-- MathJax: Fall back to local if CDN offline but local image fonts are not supported (saves >100MB) -->
<script type="text/x-mathjax-config" src="/libraries/mathjax/config/TeX-MML-AM_CHTML.js"></script>
<!-- <script>
  window.MathJax || document.write('<script type="text/x-mathjax-config">MathJax.Hub.Config({"HTML-CSS":{imageFont:null}});<\/script><script src="../libraries/mathjax/MathJax.js"><\/script>');
</script> -->


</html>]]></description>
    <pubDate>Sat, 04 Jun 2022 00:00:00 UT</pubDate>
    <guid>https://laustep.github.io/stlahblog/posts/gyroUpdate.html</guid>
    <dc:creator>Stéphane Laurent</dc:creator>
    <category>R</category>
</item>


<item>
    <title>Splitting RCGAL... and the connected components</title>
    <link>https://laustep.github.io/stlahblog/posts/splittingRCGAL.html</link>
    <description><![CDATA[<!DOCTYPE HTML>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Saturn Elephant - Splitting RCGAL... and the connected components</title>
  <link href="/libraries/bootstrap/bootstrap-grid.min.css" rel="stylesheet">
  <link rel="stylesheet" href="/css/default2.css" />
  <link rel="stylesheet" href="/css/post.css" />
  <link rel="stylesheet" href="/css/misc.css" /> 
  
    <link rel="stylesheet" href="/css/pandoc-solarized.css" /> 
   
  
  <link href="https://fonts.googleapis.com/css?family=Raleway:400,600,200,800" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/css?family=Droid+Sans" rel="stylesheet" type="text/css">
  <script src="/libraries/jquery.min.js"></script>
  <script type="text/javascript" async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML"></script>
</head>

<body>
  <div class="container-fluid">
    <div class="row">
      <!-- Sidebar. -->
      <div class="sidebar col-sm-2">
        <div class="row">
          <div class="col-sm-12" style="float:right;clear:both;margin-right:50px;margin-top:50px;">
            <a href="https://www.r-bloggers.com/">
              <img src="/images/Rbloggers.png" alt="Rbloggers" width="100%" />
            </a>
            <br/>
            <a href="http://t-redactyl.io/">
              <span style="color:black;font-weight:bold;font-family:sans-serif;font-size:25px;">Standard error</span>
            </a>
            <a href="http://timelyportfolio.blogspot.be/">
              <span style="color:grey;font-weight:bold;font-family:sans-serif;font-size:24px;">Timely portfolio</span>
            </a>
            <br/>
            <a href="https://antoineguillot.wordpress.com/blog/">
              <span style="color:white;background-color:darkblue;font-weight:bold;font-family:sans-serif;font-size:21px;border:5px solid;border-color:darkblue">ENHANCE DATA</span>
            </a>
            <br/>
            <a href="https://fronkonstin.com/">
              <span style="color:black;background-color:gold;font-weight:bold;font-size:29px;border:3px solid;border-color:gold;">Fronkonstin</span>
            </a>
          </div>
        </div>
        <div id="logos">
          <div class="row">
            <div class="col-sm-4">
              <img src="/images/AsymptoteLogo.svg" style="width: 150%; transform: rotateZ(-35deg)"/>
            </div>
            <div class="col-sm-4">
              <img src="/images/Rlogo.svg" style="width: 110%;"/>
            </div>
            <div class="col-sm-4">
              <img src="/images/shiny-hex.png" style="width: 90%;"/>
            </div>
          </div>
          <div class="row">
            <div class="col-sm-4">
              <img src="/images/Povray_logo_sphere.png" style="width: 105%;"/>
            </div>
            <div class="col-sm-4">
              <img src="/images/javascript.svg" style="width: 90%;"/>
            </div>
            <div class="col-sm-4">
              <img src="/images/haskell.svg" style="width: 110%;"/>
            </div>
          </div>
        </div>
      </div>

      <div class="main col-sm-10">
        <div id="header">
          <div id="logo">
            <a href="/">
              <img src="/images/stla.jpg" alt="stla" width="100px" />
            </a>
          </div>
          <div id="navigation" style="margin-top:50px;">
            <a href="/">Home</a>
            <a href="/about.html">About</a>
            <a href="/contact.html">Contact</a>
            <a href="/archive.html">Archive</a>
          </div>
        </div>

        <div class="content">
          <h1>Splitting RCGAL... and the connected components</h1> 
          <div class="info">
    Posted on May 27, 2022
    
        by Stéphane Laurent
    
</div>
<div class="info">
    
    Tags: <a title="All pages tagged &#39;geometry&#39;." href="/tags/geometry.html">geometry</a>, <a title="All pages tagged &#39;R&#39;." href="/tags/R.html">R</a>, <a title="All pages tagged &#39;rgl&#39;." href="/tags/rgl.html">rgl</a>, <a title="All pages tagged &#39;graphics&#39;." href="/tags/graphics.html">graphics</a>, <a title="All pages tagged &#39;C++&#39;." href="/tags/C%2B%2B.html">C++</a>, <a title="All pages tagged &#39;Rcpp&#39;." href="/tags/Rcpp.html">Rcpp</a>
    
</div>

<p>I published two posts here about my package <strong>RCGAL</strong>, the <a href="https://laustep.github.io/stlahblog/posts/SurfaceReconstruction.html">first one</a> about surface reconstruction, and the <a href="https://laustep.github.io/stlahblog/posts/BooleanOpsOnMeshes.html">second one</a> about Boolean operations on 3D meshes.</p>
<p>Now I decided to split this package into two packages: <a href="https://github.com/stla/SurfaceReconstruction">SurfaceReconstruction</a>, and <a href="https://github.com/stla/MeshesOperations">MeshesOperations</a>.</p>
<p>I think <strong>MeshesOperations</strong> is almost ready for submission to CRAN. I have just started <strong>SurfaceReconstruction</strong> today, but it already works.</p>
<h2 id="dealing-with-a-r-cmd-check-issue">Dealing with a ‘R CMD check’ issue</h2>
<p>A technical note before playing with the <strong>MeshesOperations</strong> package. Feel free to skip this section.</p>
<p>I faced a ‘R CMD check’ issue on ‘win-builder’ with <strong>MeshesOperations</strong>. Namely, this so-called significant warning:</p>
<pre><code>C:/.../BH/include/boost/container/detail/copy_move_algo.hpp:184:19: warning: 
&#39;void* memmove(void*, const void*, size_t)&#39; writing to an object of type &#39;value_type&#39; 
{aka &#39;struct std::pair, std::allocator &gt;, long long unsigned int&gt; &gt; &gt;, 
std::allocator, std::allocator &gt;, long long unsigned int&gt; &gt; &gt; &gt; &gt;,
CGAL::internal::In_place_list_iterator, std::allocator &gt;, 
long long unsigned int&gt; &gt; &gt;, std::allocator, std::allocator &gt;, 
long long unsigned int&gt; &gt; &gt; &gt; &gt; &gt;&#39;} 
with no trivial copy-assignment; use copy-assignment or copy-initialization 
instead [-Wclass-memaccess]</code></pre>
<p>This is a warning from the <strong>BH</strong> package (which allows to use the C++ library <strong>Boost</strong> with <strong>Rcpp</strong>). On Linux, the ‘R CMD check’ report was clean.</p>
<p>I found a solution to this issue. I describe it here, in case it could help someone.</p>
<p>In order to use the <strong>BH</strong> package, I included it in the <strong>LinkingTo</strong> field of the <strong>DESCRIPTION</strong> file. Then I discovered that this was not necessary with R-4.2.0, and that’s because <strong>Rtools42</strong> contains the <strong>Boost</strong> library.</p>
<p>So this solved the problem for Windows, but created a new problem for the other OSs. Then I solved this new problem by:</p>
<ul>
<li><p>putting <strong>BH</strong> in the <strong>Suggests</strong> field of <strong>DESCRIPTION</strong> (and only in this field)</p></li>
<li><p>adding the following lines in the <strong>Makevars</strong> file in the <strong>src</strong> folder of the package (breaking the first line for display here):</p></li>
</ul>
<!-- -->
<pre><code>BH_PATH = `echo &#39;cat(system.file(&quot;include&quot;, package = &quot;BH&quot;, mustWork=TRUE))&#39; \ 
| &quot;${R_HOME}/bin/R&quot; --vanilla --no-echo`
PKG_CXXFLAGS = -I$(BH_PATH)</code></pre>
<p>The first line allows to call R to get the path of the <strong>include</strong> folder of the <strong>BH</strong> package, and this path is set to the variable <strong>BH_PATH</strong>.</p>
<p>Of course I didn’t change the <strong>Makevars.win</strong> file. This works, but I don’t know yet whether this is acceptable for CRAN. However I am optimistic, since such a technique can be found in <em>‘Writing R extensions’</em>.</p>
<h2 id="connected-components">Connected components</h2>
<p>There’s something new in <strong>MeshesOperations</strong> as compared to <strong>RCGAL</strong>: the computation of the connected components of a mesh. I’m going to show you an example. Note that the mesh in this example is triangle (i.e. it only has triangular faces), and then one could alternatively use my package <a href="https://github.com/stla/concomp">MeshesOperations</a> (not submitted to CRAN yet) to get the connected components of this mesh.</p>
<p>So let’s try this feature. Our example is an isosurface called the <em>C8 surface</em>. Unfortunately I do not remember where I found it. I’m using the <strong>rmarchingcubes</strong> to construct a mesh of this isosurface.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true"></a>f &lt;-<span class="st"> </span><span class="cf">function</span>(x, y, z){</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true"></a>  <span class="dv">64</span><span class="op">*</span>x<span class="op">**</span><span class="dv">8</span> <span class="op">-</span><span class="st"> </span><span class="dv">128</span><span class="op">*</span>x<span class="op">**</span><span class="dv">6</span> <span class="op">+</span><span class="st"> </span><span class="dv">80</span><span class="op">*</span>x<span class="op">**</span><span class="dv">4</span> <span class="op">-</span><span class="st"> </span><span class="dv">16</span><span class="op">*</span>x<span class="op">**</span><span class="dv">2</span> <span class="op">+</span><span class="st"> </span><span class="dv">2</span> <span class="op">+</span><span class="st"> </span><span class="dv">64</span><span class="op">*</span>y<span class="op">**</span><span class="dv">8</span> <span class="op">-</span><span class="st"> </span><span class="dv">128</span><span class="op">*</span>y<span class="op">**</span><span class="dv">6</span> <span class="op">+</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true"></a><span class="st">    </span><span class="dv">80</span><span class="op">*</span>y<span class="op">**</span><span class="dv">4</span> <span class="op">-</span><span class="st"> </span><span class="dv">16</span><span class="op">*</span>y<span class="op">**</span><span class="dv">2</span> <span class="op">+</span><span class="st"> </span><span class="dv">64</span><span class="op">*</span>z<span class="op">**</span><span class="dv">8</span> <span class="op">-</span><span class="st"> </span><span class="dv">128</span><span class="op">*</span>z<span class="op">**</span><span class="dv">6</span> <span class="op">+</span><span class="st"> </span><span class="dv">80</span><span class="op">*</span>z<span class="op">**</span><span class="dv">4</span> <span class="op">-</span><span class="st"> </span><span class="dv">16</span><span class="op">*</span>z<span class="op">**</span><span class="dv">2</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true"></a>}</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true"></a></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true"></a>ngrid &lt;-<span class="st"> </span>150L</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true"></a>x &lt;-<span class="st"> </span>y &lt;-<span class="st"> </span>z &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="op">-</span><span class="fl">1.1</span>, <span class="fl">1.1</span>, <span class="dt">len =</span> ngrid)</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true"></a>Grid &lt;-<span class="st"> </span><span class="kw">expand.grid</span>(<span class="dt">X =</span> x, <span class="dt">Y =</span> y, <span class="dt">Z =</span> z)</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true"></a>voxel &lt;-<span class="st"> </span><span class="kw">array</span>(</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true"></a>  <span class="kw">with</span>(Grid, <span class="kw">f</span>(X, Y, Z)), <span class="dt">dim =</span> <span class="kw">c</span>(ngrid, ngrid, ngrid)</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true"></a>)</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true"></a></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true"></a><span class="kw">library</span>(rmarchingcubes)</span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true"></a>contour_shape &lt;-<span class="st"> </span><span class="kw">contour3d</span>(</span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true"></a>  <span class="dt">griddata =</span> voxel, <span class="dt">level =</span> <span class="fl">-0.1</span>,</span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true"></a>  <span class="dt">x =</span> x, <span class="dt">y =</span> y, <span class="dt">z =</span> z</span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true"></a>)</span></code></pre></div>
<p>Now let’s plot it with rgl:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true"></a><span class="kw">library</span>(rgl)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true"></a>tmesh &lt;-<span class="st"> </span><span class="kw">tmesh3d</span>(</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true"></a>  <span class="dt">vertices =</span> <span class="kw">t</span>(contour_shape[[<span class="st">&quot;vertices&quot;</span>]]),</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true"></a>  <span class="dt">indices =</span> <span class="kw">t</span>(contour_shape[[<span class="st">&quot;triangles&quot;</span>]]),</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true"></a>  <span class="dt">normals =</span> contour_shape[[<span class="st">&quot;normals&quot;</span>]],</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true"></a>  <span class="dt">homogeneous =</span> <span class="ot">FALSE</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true"></a>)</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true"></a><span class="kw">open3d</span>(<span class="dt">windowRect =</span> <span class="kw">c</span>(<span class="dv">50</span>, <span class="dv">50</span>, <span class="dv">562</span>, <span class="dv">562</span>))</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true"></a><span class="kw">shade3d</span>(tmesh, <span class="dt">color =</span> <span class="st">&quot;darkred&quot;</span>)</span></code></pre></div>
<p><img src="./figures/C8surface.gif" /></p>
<p>As you can see, it has many isolated parts, the so-called <em>connected components</em>.</p>
<p>Now we use the <strong>MeshesOperations</strong> package to extract these connected components, while requesting the vertex normals of each component:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true"></a><span class="kw">library</span>(MeshesOperations)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true"></a>meshes &lt;-<span class="st"> </span><span class="kw">connectedComponents</span>(</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true"></a>  <span class="dt">vertices =</span> contour_shape[[<span class="st">&quot;vertices&quot;</span>]],</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true"></a>  <span class="dt">faces    =</span> contour_shape[[<span class="st">&quot;triangles&quot;</span>]],</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true"></a>  <span class="dt">normals  =</span> <span class="ot">TRUE</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true"></a>)</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true"></a><span class="co"># Found 64 components.</span></span></code></pre></div>
<p>Now let’s plot all theses meshes, one color per mesh:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true"></a>ncc &lt;-<span class="st"> </span><span class="kw">length</span>(meshes)</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true"></a><span class="kw">library</span>(randomcoloR)</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true"></a>colors &lt;-<span class="st"> </span><span class="kw">randomColor</span>(ncc, <span class="dt">hue =</span> <span class="st">&quot;random&quot;</span>, <span class="dt">luminosity =</span> <span class="st">&quot;dark&quot;</span>)</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true"></a></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true"></a><span class="kw">open3d</span>(<span class="dt">windowRect =</span> <span class="kw">c</span>(<span class="dv">50</span>, <span class="dv">50</span>, <span class="dv">562</span>, <span class="dv">562</span>))</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true"></a><span class="cf">for</span>(i <span class="cf">in</span> 1L<span class="op">:</span>ncc){</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true"></a>  cc &lt;-<span class="st"> </span>meshes[[i]]</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true"></a>  tmesh &lt;-<span class="st"> </span><span class="kw">tmesh3d</span>(</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true"></a>    <span class="dt">vertices =</span> <span class="kw">t</span>(cc[[<span class="st">&quot;vertices&quot;</span>]]),</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true"></a>    <span class="dt">indices  =</span> <span class="kw">t</span>(cc[[<span class="st">&quot;faces&quot;</span>]]),</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true"></a>    <span class="dt">normals  =</span> cc[[<span class="st">&quot;normals&quot;</span>]],</span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true"></a>    <span class="dt">homogeneous =</span> <span class="ot">FALSE</span></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true"></a>  )</span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true"></a>  <span class="kw">shade3d</span>(tmesh, <span class="dt">color =</span> colors[i])</span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true"></a>}</span></code></pre></div>
<p><img src="./figures/C8_components.gif" /></p>
<p>Nice. However there is one problem: compare the smoothness of these meshes to the smoothness of our first plot. It is not as smooth.</p>
<p>I think I know why. The smoothness depends on the vertex normals. Here we computed the normals with CGAL, then each vertex normal is obtained by averaging the normals of the surrounding faces of this vertex. We could have used <code>rgl::addNormals</code> instead, the result would be the same. But there is a convenient way to get the “true” vertex normals of an isosurface: the normal associated to a vertex is the gradient of the isosurface function evaluated at the coordinates of this vertex. So my guess is that <strong>rmarchingcubes</strong> uses the gradient. I am still thinking of having the possibility to preserve the original normals when computing the connected components, I didn’t have the time yet to find how to do that. This is not a problem, we will compute the true normals with R. In fact we will probably do better than <strong>rmarchingcubes</strong>: surely this package numerically computes the gradient, while we will use the <em>exact</em> gradient. How? Look at the isosurface function <code>f</code>: this is a multivariate polynomial. So it is easy to calculate its derivatives. This would be tedious to calculate them by hand however, so let’s use the <strong>spray</strong> package:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true"></a><span class="kw">library</span>(spray)</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true"></a><span class="co"># define the polynomial corresponding to f:</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true"></a>P &lt;-<span class="st"> </span><span class="kw">f</span>(<span class="kw">lone</span>(<span class="dv">1</span>,<span class="dv">3</span>), <span class="kw">lone</span>(<span class="dv">2</span>,<span class="dv">3</span>), <span class="kw">lone</span>(<span class="dv">3</span>,<span class="dv">3</span>))</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true"></a><span class="co"># and its derivatives:</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true"></a>dfx &lt;-<span class="st"> </span><span class="kw">as.function</span>(<span class="kw">deriv</span>(P, 1L))</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true"></a>dfy &lt;-<span class="st"> </span><span class="kw">as.function</span>(<span class="kw">deriv</span>(P, 2L))</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true"></a>dfz &lt;-<span class="st"> </span><span class="kw">as.function</span>(<span class="kw">deriv</span>(P, 3L))</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true"></a><span class="co"># the gradient is:</span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true"></a>gradient &lt;-<span class="st"> </span><span class="cf">function</span>(xyz){</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true"></a>  <span class="kw">cbind</span>(<span class="kw">dfx</span>(xyz), <span class="kw">dfy</span>(xyz), <span class="kw">dfz</span>(xyz))</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true"></a>}</span></code></pre></div>
<p>Just a couple of lines of code… Now let’s do the plot with the true normals:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true"></a><span class="kw">open3d</span>(<span class="dt">windowRect =</span> <span class="kw">c</span>(<span class="dv">50</span>, <span class="dv">50</span>, <span class="dv">562</span>, <span class="dv">562</span>))</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>ncc){</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true"></a>  cc &lt;-<span class="st"> </span>meshes[[i]]</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true"></a>  tmesh &lt;-<span class="st"> </span><span class="kw">tmesh3d</span>(</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true"></a>    <span class="dt">vertices =</span> <span class="kw">t</span>(cc<span class="op">$</span>vertices),</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true"></a>    <span class="dt">indices  =</span> <span class="kw">t</span>(cc<span class="op">$</span>faces),</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true"></a>    <span class="dt">normals  =</span> <span class="kw">gradient</span>(cc<span class="op">$</span>vertices),</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true"></a>    <span class="dt">homogeneous =</span> <span class="ot">FALSE</span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true"></a>  )</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true"></a>  <span class="kw">shade3d</span>(tmesh, <span class="dt">color =</span> colors[i])</span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true"></a>}</span></code></pre></div>
<p><img src="./figures/C8_components_trueNormals.gif" /></p>
<p>A perfect smoothness!</p>

        </div>


        <div id="footer">
          Site proudly generated by
          <a href="http://jaspervdj.be/hakyll">Hakyll</a>
        </div>

      </div>

    </div>

    <div class="row">
      <div class="col-sm-12">
        <div id="disqus_thread"></div>
        <div class="pagination">
          <ul>
            <li>
              <a href="http://laustep.github.io/stlahblog/">&#171; Back Home</a>
            </li>
          </ul>
        </div>
      </div>
    </div>
    
  </div>

</body>

<script src="/libraries/bootstrap/bootstrap.min.js"></script>
<script>
  var disqus_developer = 1;
  var disqus_shortname = 'stlapblog';
  // required: replace example with your forum shortname
  /* * * DON'T EDIT BELOW THIS LINE * * */
  (function () {
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = 'https://' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] ||
      document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>
<noscript>Please enable JavaScript to view the
  <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a>
</noscript>
<!-- MathJax: Fall back to local if CDN offline but local image fonts are not supported (saves >100MB) -->
<script type="text/x-mathjax-config" src="/libraries/mathjax/config/TeX-MML-AM_CHTML.js"></script>
<!-- <script>
  window.MathJax || document.write('<script type="text/x-mathjax-config">MathJax.Hub.Config({"HTML-CSS":{imageFont:null}});<\/script><script src="../libraries/mathjax/MathJax.js"><\/script>');
</script> -->


</html>]]></description>
    <pubDate>Fri, 27 May 2022 00:00:00 UT</pubDate>
    <guid>https://laustep.github.io/stlahblog/posts/splittingRCGAL.html</guid>
    <dc:creator>Stéphane Laurent</dc:creator>
    <category>R</category>
</item>


<item>
    <title>Animated multibarchart with (R)nvd3</title>
    <link>https://laustep.github.io/stlahblog/posts/Rnvd3.html</link>
    <description><![CDATA[<!DOCTYPE HTML>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Saturn Elephant - Animated multibarchart with (R)nvd3</title>
  <link href="/libraries/bootstrap/bootstrap-grid.min.css" rel="stylesheet">
  <link rel="stylesheet" href="/css/default2.css" />
  <link rel="stylesheet" href="/css/post.css" />
  <link rel="stylesheet" href="/css/misc.css" /> 
  
    <link rel="stylesheet" href="/css/pandoc-solarized.css" /> 
   
  
  <link href="https://fonts.googleapis.com/css?family=Raleway:400,600,200,800" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/css?family=Droid+Sans" rel="stylesheet" type="text/css">
  <script src="/libraries/jquery.min.js"></script>
  <script type="text/javascript" async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML"></script>
</head>

<body>
  <div class="container-fluid">
    <div class="row">
      <!-- Sidebar. -->
      <div class="sidebar col-sm-2">
        <div class="row">
          <div class="col-sm-12" style="float:right;clear:both;margin-right:50px;margin-top:50px;">
            <a href="https://www.r-bloggers.com/">
              <img src="/images/Rbloggers.png" alt="Rbloggers" width="100%" />
            </a>
            <br/>
            <a href="http://t-redactyl.io/">
              <span style="color:black;font-weight:bold;font-family:sans-serif;font-size:25px;">Standard error</span>
            </a>
            <a href="http://timelyportfolio.blogspot.be/">
              <span style="color:grey;font-weight:bold;font-family:sans-serif;font-size:24px;">Timely portfolio</span>
            </a>
            <br/>
            <a href="https://antoineguillot.wordpress.com/blog/">
              <span style="color:white;background-color:darkblue;font-weight:bold;font-family:sans-serif;font-size:21px;border:5px solid;border-color:darkblue">ENHANCE DATA</span>
            </a>
            <br/>
            <a href="https://fronkonstin.com/">
              <span style="color:black;background-color:gold;font-weight:bold;font-size:29px;border:3px solid;border-color:gold;">Fronkonstin</span>
            </a>
          </div>
        </div>
        <div id="logos">
          <div class="row">
            <div class="col-sm-4">
              <img src="/images/AsymptoteLogo.svg" style="width: 150%; transform: rotateZ(-35deg)"/>
            </div>
            <div class="col-sm-4">
              <img src="/images/Rlogo.svg" style="width: 110%;"/>
            </div>
            <div class="col-sm-4">
              <img src="/images/shiny-hex.png" style="width: 90%;"/>
            </div>
          </div>
          <div class="row">
            <div class="col-sm-4">
              <img src="/images/Povray_logo_sphere.png" style="width: 105%;"/>
            </div>
            <div class="col-sm-4">
              <img src="/images/javascript.svg" style="width: 90%;"/>
            </div>
            <div class="col-sm-4">
              <img src="/images/haskell.svg" style="width: 110%;"/>
            </div>
          </div>
        </div>
      </div>

      <div class="main col-sm-10">
        <div id="header">
          <div id="logo">
            <a href="/">
              <img src="/images/stla.jpg" alt="stla" width="100px" />
            </a>
          </div>
          <div id="navigation" style="margin-top:50px;">
            <a href="/">Home</a>
            <a href="/about.html">About</a>
            <a href="/contact.html">Contact</a>
            <a href="/archive.html">Archive</a>
          </div>
        </div>

        <div class="content">
          <h1>Animated multibarchart with (R)nvd3</h1> 
          <div class="info">
    Posted on May 20, 2022
    
        by Stéphane Laurent
    
</div>
<div class="info">
    
    Tags: <a title="All pages tagged &#39;R&#39;." href="/tags/R.html">R</a>, <a title="All pages tagged &#39;graphics&#39;." href="/tags/graphics.html">graphics</a>, <a title="All pages tagged &#39;JavaScript&#39;." href="/tags/JavaScript.html">JavaScript</a>
    
</div>

<p>I really like the animated multibarchart of the JavaScript library <a href="https://nvd3.org/">NVD3</a>. That’s why I did the ‘Rnvd3’ package.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true"></a><span class="kw">library</span>(Rnvd3)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true"></a>dat &lt;-<span class="st"> </span>reshape2<span class="op">::</span><span class="kw">melt</span>(</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true"></a>  <span class="kw">apply</span>(HairEyeColor, <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span>), sum), <span class="dt">value.name =</span> <span class="st">&quot;Count&quot;</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true"></a>)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true"></a></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true"></a><span class="co"># style axis titles with CSS ####</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true"></a><span class="kw">library</span>(htmltools)</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true"></a>CSS &lt;-<span class="st"> </span><span class="kw">HTML</span>(</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true"></a>  <span class="st">&quot;.nvd3 .nv-axis.nv-x text.nv-axislabel,</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true"></a><span class="st">   .nvd3 .nv-axis.nv-y text.nv-axislabel {</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true"></a><span class="st">     font-size: 2rem;</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true"></a><span class="st">     fill: red;</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true"></a><span class="st">  }&quot;</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true"></a>)</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true"></a></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true"></a>widget &lt;-<span class="st"> </span><span class="kw">multiBarChart</span>(</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true"></a>  dat, Count <span class="op">~</span><span class="st"> </span>Eye, <span class="st">&quot;Hair&quot;</span>, <span class="dt">palette =</span> <span class="st">&quot;turbo&quot;</span></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true"></a>)</span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true"></a><span class="kw">prependContent</span>(</span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true"></a>  widget,</span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true"></a>  tags<span class="op">$</span><span class="kw">style</span>(CSS)</span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true"></a>)</span></code></pre></div>
<p><img src="./figures/Rnvd3.gif" /></p>
<p>This chart is also available in the ‘rCharts’ package, but this package is not maintained.</p>

        </div>


        <div id="footer">
          Site proudly generated by
          <a href="http://jaspervdj.be/hakyll">Hakyll</a>
        </div>

      </div>

    </div>

    <div class="row">
      <div class="col-sm-12">
        <div id="disqus_thread"></div>
        <div class="pagination">
          <ul>
            <li>
              <a href="http://laustep.github.io/stlahblog/">&#171; Back Home</a>
            </li>
          </ul>
        </div>
      </div>
    </div>
    
  </div>

</body>

<script src="/libraries/bootstrap/bootstrap.min.js"></script>
<script>
  var disqus_developer = 1;
  var disqus_shortname = 'stlapblog';
  // required: replace example with your forum shortname
  /* * * DON'T EDIT BELOW THIS LINE * * */
  (function () {
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = 'https://' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] ||
      document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>
<noscript>Please enable JavaScript to view the
  <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a>
</noscript>
<!-- MathJax: Fall back to local if CDN offline but local image fonts are not supported (saves >100MB) -->
<script type="text/x-mathjax-config" src="/libraries/mathjax/config/TeX-MML-AM_CHTML.js"></script>
<!-- <script>
  window.MathJax || document.write('<script type="text/x-mathjax-config">MathJax.Hub.Config({"HTML-CSS":{imageFont:null}});<\/script><script src="../libraries/mathjax/MathJax.js"><\/script>');
</script> -->


</html>]]></description>
    <pubDate>Fri, 20 May 2022 00:00:00 UT</pubDate>
    <guid>https://laustep.github.io/stlahblog/posts/Rnvd3.html</guid>
    <dc:creator>Stéphane Laurent</dc:creator>
    <category>R</category>
</item>


<item>
    <title>Hierarchical data visualization with Shiny and D3</title>
    <link>https://laustep.github.io/stlahblog/posts/HierarchicalDataViz.html</link>
    <description><![CDATA[<!DOCTYPE HTML>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Saturn Elephant - Hierarchical data visualization with Shiny and D3</title>
  <link href="/libraries/bootstrap/bootstrap-grid.min.css" rel="stylesheet">
  <link rel="stylesheet" href="/css/default2.css" />
  <link rel="stylesheet" href="/css/post.css" />
  <link rel="stylesheet" href="/css/misc.css" /> 
  
    <link rel="stylesheet" href="/css/pandoc-solarized.css" /> 
   
  
  <link href="https://fonts.googleapis.com/css?family=Raleway:400,600,200,800" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/css?family=Droid+Sans" rel="stylesheet" type="text/css">
  <script src="/libraries/jquery.min.js"></script>
  <script type="text/javascript" async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML"></script>
</head>

<body>
  <div class="container-fluid">
    <div class="row">
      <!-- Sidebar. -->
      <div class="sidebar col-sm-2">
        <div class="row">
          <div class="col-sm-12" style="float:right;clear:both;margin-right:50px;margin-top:50px;">
            <a href="https://www.r-bloggers.com/">
              <img src="/images/Rbloggers.png" alt="Rbloggers" width="100%" />
            </a>
            <br/>
            <a href="http://t-redactyl.io/">
              <span style="color:black;font-weight:bold;font-family:sans-serif;font-size:25px;">Standard error</span>
            </a>
            <a href="http://timelyportfolio.blogspot.be/">
              <span style="color:grey;font-weight:bold;font-family:sans-serif;font-size:24px;">Timely portfolio</span>
            </a>
            <br/>
            <a href="https://antoineguillot.wordpress.com/blog/">
              <span style="color:white;background-color:darkblue;font-weight:bold;font-family:sans-serif;font-size:21px;border:5px solid;border-color:darkblue">ENHANCE DATA</span>
            </a>
            <br/>
            <a href="https://fronkonstin.com/">
              <span style="color:black;background-color:gold;font-weight:bold;font-size:29px;border:3px solid;border-color:gold;">Fronkonstin</span>
            </a>
          </div>
        </div>
        <div id="logos">
          <div class="row">
            <div class="col-sm-4">
              <img src="/images/AsymptoteLogo.svg" style="width: 150%; transform: rotateZ(-35deg)"/>
            </div>
            <div class="col-sm-4">
              <img src="/images/Rlogo.svg" style="width: 110%;"/>
            </div>
            <div class="col-sm-4">
              <img src="/images/shiny-hex.png" style="width: 90%;"/>
            </div>
          </div>
          <div class="row">
            <div class="col-sm-4">
              <img src="/images/Povray_logo_sphere.png" style="width: 105%;"/>
            </div>
            <div class="col-sm-4">
              <img src="/images/javascript.svg" style="width: 90%;"/>
            </div>
            <div class="col-sm-4">
              <img src="/images/haskell.svg" style="width: 110%;"/>
            </div>
          </div>
        </div>
      </div>

      <div class="main col-sm-10">
        <div id="header">
          <div id="logo">
            <a href="/">
              <img src="/images/stla.jpg" alt="stla" width="100px" />
            </a>
          </div>
          <div id="navigation" style="margin-top:50px;">
            <a href="/">Home</a>
            <a href="/about.html">About</a>
            <a href="/contact.html">Contact</a>
            <a href="/archive.html">Archive</a>
          </div>
        </div>

        <div class="content">
          <h1>Hierarchical data visualization with Shiny and D3</h1> 
          <div class="info">
    Posted on May 20, 2022
    
        by Stéphane Laurent
    
</div>
<div class="info">
    
    Tags: <a title="All pages tagged &#39;R&#39;." href="/tags/R.html">R</a>, <a title="All pages tagged &#39;shiny&#39;." href="/tags/shiny.html">shiny</a>, <a title="All pages tagged &#39;graphics&#39;." href="/tags/graphics.html">graphics</a>, <a title="All pages tagged &#39;javascript&#39;." href="/tags/javascript.html">javascript</a>
    
</div>

<p>I refreshed my old package ‘<strong>dir2json</strong>’ (5 years old). It uses a Haskell DLL and can only work on Windows. You can install it from Github:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true"></a>remotes<span class="op">::</span><span class="kw">install_github</span>(<span class="st">&quot;stla/dir2json&quot;</span>)</span></code></pre></div>
<p>This package contains two Shiny apps. The first one allows to represent a folder structure as a tree network diagram (called a <em>Reingold-Tilford</em> tree), thanks to the amazing JavaScript library ‘<strong>D3</strong>’:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true"></a><span class="kw">library</span>(dir2json)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true"></a><span class="co"># don&#39;t forget to limit the depth if the folder is deep!</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true"></a><span class="kw">shinyDirTree</span>(<span class="dt">dir =</span> <span class="st">&quot;inst&quot;</span>, <span class="dt">depth =</span> <span class="dv">3</span>)</span></code></pre></div>
<p><img src="./figures/shinyDirTree.gif" style="width:95.0%" /></p>
<p>As you can see, it also allows to search a file in the tree. And it is possible to zoom and to drag.</p>
<p>This Shiny app was already included in the original version of the package. The second Shiny app is new. It is similar to the first one, but instead of a folder, it allows to represent any dataset with a hierarchical structure:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true"></a><span class="kw">library</span>(dir2json)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true"></a>dat &lt;-<span class="st"> </span>tibble<span class="op">::</span><span class="kw">tribble</span>(</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true"></a>  <span class="op">~</span>level1, <span class="op">~</span>level2, <span class="op">~</span>level3, <span class="op">~</span>level4, </span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true"></a>  <span class="st">&quot;Beverages&quot;</span>, <span class="st">&quot;Water&quot;</span>, <span class="st">&quot;&quot;</span>, <span class="st">&quot;&quot;</span>, </span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true"></a>  <span class="st">&quot;Beverages&quot;</span>, <span class="st">&quot;Coffee&quot;</span>, <span class="st">&quot;&quot;</span>, <span class="st">&quot;&quot;</span>, </span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true"></a>  <span class="st">&quot;Beverages&quot;</span>, <span class="st">&quot;Tea&quot;</span>, <span class="st">&quot;Black tea&quot;</span>, <span class="st">&quot;&quot;</span>, </span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true"></a>  <span class="st">&quot;Beverages&quot;</span>, <span class="st">&quot;Tea&quot;</span>, <span class="st">&quot;White tea&quot;</span>, <span class="st">&quot;&quot;</span>, </span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true"></a>  <span class="st">&quot;Beverages&quot;</span>, <span class="st">&quot;Tea&quot;</span>, <span class="st">&quot;Green tea&quot;</span>, <span class="st">&quot;Sencha&quot;</span>, </span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true"></a>  <span class="st">&quot;Beverages&quot;</span>, <span class="st">&quot;Tea&quot;</span>, <span class="st">&quot;Green tea&quot;</span>, <span class="st">&quot;Gyokuro&quot;</span>, </span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true"></a>  <span class="st">&quot;Beverages&quot;</span>, <span class="st">&quot;Tea&quot;</span>, <span class="st">&quot;Green tea&quot;</span>, <span class="st">&quot;Matcha&quot;</span>, </span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true"></a>  <span class="st">&quot;Beverages&quot;</span>, <span class="st">&quot;Tea&quot;</span>, <span class="st">&quot;Green tea&quot;</span>, <span class="st">&quot;Pi Lo Chun&quot;</span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true"></a>)</span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true"></a><span class="kw">shinyDataTree</span>(dat, <span class="dt">root =</span> <span class="ot">FALSE</span>)</span></code></pre></div>
<p><img src="./figures/shinyDataTree.gif" style="width:95.0%" /></p>

        </div>


        <div id="footer">
          Site proudly generated by
          <a href="http://jaspervdj.be/hakyll">Hakyll</a>
        </div>

      </div>

    </div>

    <div class="row">
      <div class="col-sm-12">
        <div id="disqus_thread"></div>
        <div class="pagination">
          <ul>
            <li>
              <a href="http://laustep.github.io/stlahblog/">&#171; Back Home</a>
            </li>
          </ul>
        </div>
      </div>
    </div>
    
  </div>

</body>

<script src="/libraries/bootstrap/bootstrap.min.js"></script>
<script>
  var disqus_developer = 1;
  var disqus_shortname = 'stlapblog';
  // required: replace example with your forum shortname
  /* * * DON'T EDIT BELOW THIS LINE * * */
  (function () {
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = 'https://' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] ||
      document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>
<noscript>Please enable JavaScript to view the
  <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a>
</noscript>
<!-- MathJax: Fall back to local if CDN offline but local image fonts are not supported (saves >100MB) -->
<script type="text/x-mathjax-config" src="/libraries/mathjax/config/TeX-MML-AM_CHTML.js"></script>
<!-- <script>
  window.MathJax || document.write('<script type="text/x-mathjax-config">MathJax.Hub.Config({"HTML-CSS":{imageFont:null}});<\/script><script src="../libraries/mathjax/MathJax.js"><\/script>');
</script> -->


</html>]]></description>
    <pubDate>Fri, 20 May 2022 00:00:00 UT</pubDate>
    <guid>https://laustep.github.io/stlahblog/posts/HierarchicalDataViz.html</guid>
    <dc:creator>Stéphane Laurent</dc:creator>
    <category>R</category>
</item>


<item>
    <title>The 'rAmCharts4' package</title>
    <link>https://laustep.github.io/stlahblog/posts/rAmCharts4.html</link>
    <description><![CDATA[<!DOCTYPE HTML>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Saturn Elephant - The 'rAmCharts4' package</title>
  <link href="/libraries/bootstrap/bootstrap-grid.min.css" rel="stylesheet">
  <link rel="stylesheet" href="/css/default2.css" />
  <link rel="stylesheet" href="/css/post.css" />
  <link rel="stylesheet" href="/css/misc.css" /> 
  
    <link rel="stylesheet" href="/css/pandoc-solarized.css" /> 
   
  
  <link href="https://fonts.googleapis.com/css?family=Raleway:400,600,200,800" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/css?family=Droid+Sans" rel="stylesheet" type="text/css">
  <script src="/libraries/jquery.min.js"></script>
  <script type="text/javascript" async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML"></script>
</head>

<body>
  <div class="container-fluid">
    <div class="row">
      <!-- Sidebar. -->
      <div class="sidebar col-sm-2">
        <div class="row">
          <div class="col-sm-12" style="float:right;clear:both;margin-right:50px;margin-top:50px;">
            <a href="https://www.r-bloggers.com/">
              <img src="/images/Rbloggers.png" alt="Rbloggers" width="100%" />
            </a>
            <br/>
            <a href="http://t-redactyl.io/">
              <span style="color:black;font-weight:bold;font-family:sans-serif;font-size:25px;">Standard error</span>
            </a>
            <a href="http://timelyportfolio.blogspot.be/">
              <span style="color:grey;font-weight:bold;font-family:sans-serif;font-size:24px;">Timely portfolio</span>
            </a>
            <br/>
            <a href="https://antoineguillot.wordpress.com/blog/">
              <span style="color:white;background-color:darkblue;font-weight:bold;font-family:sans-serif;font-size:21px;border:5px solid;border-color:darkblue">ENHANCE DATA</span>
            </a>
            <br/>
            <a href="https://fronkonstin.com/">
              <span style="color:black;background-color:gold;font-weight:bold;font-size:29px;border:3px solid;border-color:gold;">Fronkonstin</span>
            </a>
          </div>
        </div>
        <div id="logos">
          <div class="row">
            <div class="col-sm-4">
              <img src="/images/AsymptoteLogo.svg" style="width: 150%; transform: rotateZ(-35deg)"/>
            </div>
            <div class="col-sm-4">
              <img src="/images/Rlogo.svg" style="width: 110%;"/>
            </div>
            <div class="col-sm-4">
              <img src="/images/shiny-hex.png" style="width: 90%;"/>
            </div>
          </div>
          <div class="row">
            <div class="col-sm-4">
              <img src="/images/Povray_logo_sphere.png" style="width: 105%;"/>
            </div>
            <div class="col-sm-4">
              <img src="/images/javascript.svg" style="width: 90%;"/>
            </div>
            <div class="col-sm-4">
              <img src="/images/haskell.svg" style="width: 110%;"/>
            </div>
          </div>
        </div>
      </div>

      <div class="main col-sm-10">
        <div id="header">
          <div id="logo">
            <a href="/">
              <img src="/images/stla.jpg" alt="stla" width="100px" />
            </a>
          </div>
          <div id="navigation" style="margin-top:50px;">
            <a href="/">Home</a>
            <a href="/about.html">About</a>
            <a href="/contact.html">Contact</a>
            <a href="/archive.html">Archive</a>
          </div>
        </div>

        <div class="content">
          <h1>The 'rAmCharts4' package</h1> 
          <div class="info">
    Posted on May 15, 2022
    
        by Stéphane Laurent
    
</div>
<div class="info">
    
    Tags: <a title="All pages tagged &#39;R&#39;." href="/tags/R.html">R</a>, <a title="All pages tagged &#39;graphics&#39;." href="/tags/graphics.html">graphics</a>, <a title="All pages tagged &#39;JavaScript&#39;." href="/tags/JavaScript.html">JavaScript</a>
    
</div>

<p>My package <a href="https://github.com/stla/rAmCharts4">rAmCharts4</a> has a moderate success on Github (twenty stars). So I decided to present it here.</p>
<p><img src="./figures/rAmCharts4.gif" /></p>

        </div>


        <div id="footer">
          Site proudly generated by
          <a href="http://jaspervdj.be/hakyll">Hakyll</a>
        </div>

      </div>

    </div>

    <div class="row">
      <div class="col-sm-12">
        <div id="disqus_thread"></div>
        <div class="pagination">
          <ul>
            <li>
              <a href="http://laustep.github.io/stlahblog/">&#171; Back Home</a>
            </li>
          </ul>
        </div>
      </div>
    </div>
    
  </div>

</body>

<script src="/libraries/bootstrap/bootstrap.min.js"></script>
<script>
  var disqus_developer = 1;
  var disqus_shortname = 'stlapblog';
  // required: replace example with your forum shortname
  /* * * DON'T EDIT BELOW THIS LINE * * */
  (function () {
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = 'https://' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] ||
      document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>
<noscript>Please enable JavaScript to view the
  <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a>
</noscript>
<!-- MathJax: Fall back to local if CDN offline but local image fonts are not supported (saves >100MB) -->
<script type="text/x-mathjax-config" src="/libraries/mathjax/config/TeX-MML-AM_CHTML.js"></script>
<!-- <script>
  window.MathJax || document.write('<script type="text/x-mathjax-config">MathJax.Hub.Config({"HTML-CSS":{imageFont:null}});<\/script><script src="../libraries/mathjax/MathJax.js"><\/script>');
</script> -->


</html>]]></description>
    <pubDate>Sun, 15 May 2022 00:00:00 UT</pubDate>
    <guid>https://laustep.github.io/stlahblog/posts/rAmCharts4.html</guid>
    <dc:creator>Stéphane Laurent</dc:creator>
    <category>R</category>
</item>


<item>
    <title>Boolean operations on meshes with R(CGAL)</title>
    <link>https://laustep.github.io/stlahblog/posts/BooleanOpsOnMeshes.html</link>
    <description><![CDATA[<!DOCTYPE HTML>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Saturn Elephant - Boolean operations on meshes with R(CGAL)</title>
  <link href="/libraries/bootstrap/bootstrap-grid.min.css" rel="stylesheet">
  <link rel="stylesheet" href="/css/default2.css" />
  <link rel="stylesheet" href="/css/post.css" />
  <link rel="stylesheet" href="/css/misc.css" /> 
  
    <link rel="stylesheet" href="/css/pandoc-solarized.css" /> 
   
  
  <link href="https://fonts.googleapis.com/css?family=Raleway:400,600,200,800" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/css?family=Droid+Sans" rel="stylesheet" type="text/css">
  <script src="/libraries/jquery.min.js"></script>
  <script type="text/javascript" async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML"></script>
</head>

<body>
  <div class="container-fluid">
    <div class="row">
      <!-- Sidebar. -->
      <div class="sidebar col-sm-2">
        <div class="row">
          <div class="col-sm-12" style="float:right;clear:both;margin-right:50px;margin-top:50px;">
            <a href="https://www.r-bloggers.com/">
              <img src="/images/Rbloggers.png" alt="Rbloggers" width="100%" />
            </a>
            <br/>
            <a href="http://t-redactyl.io/">
              <span style="color:black;font-weight:bold;font-family:sans-serif;font-size:25px;">Standard error</span>
            </a>
            <a href="http://timelyportfolio.blogspot.be/">
              <span style="color:grey;font-weight:bold;font-family:sans-serif;font-size:24px;">Timely portfolio</span>
            </a>
            <br/>
            <a href="https://antoineguillot.wordpress.com/blog/">
              <span style="color:white;background-color:darkblue;font-weight:bold;font-family:sans-serif;font-size:21px;border:5px solid;border-color:darkblue">ENHANCE DATA</span>
            </a>
            <br/>
            <a href="https://fronkonstin.com/">
              <span style="color:black;background-color:gold;font-weight:bold;font-size:29px;border:3px solid;border-color:gold;">Fronkonstin</span>
            </a>
          </div>
        </div>
        <div id="logos">
          <div class="row">
            <div class="col-sm-4">
              <img src="/images/AsymptoteLogo.svg" style="width: 150%; transform: rotateZ(-35deg)"/>
            </div>
            <div class="col-sm-4">
              <img src="/images/Rlogo.svg" style="width: 110%;"/>
            </div>
            <div class="col-sm-4">
              <img src="/images/shiny-hex.png" style="width: 90%;"/>
            </div>
          </div>
          <div class="row">
            <div class="col-sm-4">
              <img src="/images/Povray_logo_sphere.png" style="width: 105%;"/>
            </div>
            <div class="col-sm-4">
              <img src="/images/javascript.svg" style="width: 90%;"/>
            </div>
            <div class="col-sm-4">
              <img src="/images/haskell.svg" style="width: 110%;"/>
            </div>
          </div>
        </div>
      </div>

      <div class="main col-sm-10">
        <div id="header">
          <div id="logo">
            <a href="/">
              <img src="/images/stla.jpg" alt="stla" width="100px" />
            </a>
          </div>
          <div id="navigation" style="margin-top:50px;">
            <a href="/">Home</a>
            <a href="/about.html">About</a>
            <a href="/contact.html">Contact</a>
            <a href="/archive.html">Archive</a>
          </div>
        </div>

        <div class="content">
          <h1>Boolean operations on meshes with R(CGAL)</h1> 
          <div class="info">
    Posted on May 14, 2022
    
        by Stéphane Laurent
    
</div>
<div class="info">
    
    Tags: <a title="All pages tagged &#39;geometry&#39;." href="/tags/geometry.html">geometry</a>, <a title="All pages tagged &#39;R&#39;." href="/tags/R.html">R</a>, <a title="All pages tagged &#39;rgl&#39;." href="/tags/rgl.html">rgl</a>, <a title="All pages tagged &#39;graphics&#39;." href="/tags/graphics.html">graphics</a>, <a title="All pages tagged &#39;C++&#39;." href="/tags/C%2B%2B.html">C++</a>
    
</div>

<p>I’m still working on my package <strong>RCGAL</strong>, that I already present in <a href="./SurfaceReconstruction.html">a previous post</a>.</p>
<p>This previous post was about the reconstruction of surfaces. Now I implemented the <em>Boolean operations on meshes</em>. Here are some simple examples.</p>
<h4 id="union-of-two-cubes">Union of two cubes:</h4>
<p><img src="./figures/cubesUnion.png" /></p>
<h4 id="intersection-of-two-cubes-one-rotated">Intersection of two cubes (one rotated):</h4>
<p><img src="./figures/interCubeRotatedCube.gif" /></p>
<h4 id="difference-of-two-cubes">Difference of two cubes:</h4>
<p><img src="./figures/cubesDifference.png" /></p>
<h4 id="intersection-of-a-cube-and-a-truncated-icosahedron">Intersection of a cube and a truncated icosahedron:</h4>
<p><img src="./figures/cubesIntersection.png" /></p>
<p>The code generating these plots is given in the RCGAL examples.</p>
<p>Now let’s turn to a more interesting example.</p>
<h2 id="the-compound-of-five-tetrahedra">The compound of five tetrahedra</h2>
<p>The compound of five tetrahedra is provided by <strong>RCGAL</strong>. These are five tetrahedra in a pretty configuration, each centered at the origin. You can get their meshes by typing <code>tetrahedraCompound</code>. This is a list with two components: a field <code>meshes</code> providing for each tetrahderon its vertices and its faces, and a field <code>rglmeshes</code>, similar to <code>meshes</code> but these meshes are ready for plotting with the <strong>rgl</strong> package. Here it is:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true"></a><span class="kw">library</span>(RCGAL)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true"></a><span class="kw">library</span>(rgl)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true"></a>rglmeshes &lt;-<span class="st"> </span>tetrahedraCompound[[<span class="st">&quot;rglmeshes&quot;</span>]]</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true"></a><span class="kw">open3d</span>(<span class="dt">windowRect =</span> <span class="kw">c</span>(<span class="dv">50</span>, <span class="dv">50</span>, <span class="dv">562</span>, <span class="dv">562</span>), <span class="dt">zoom =</span> <span class="fl">0.75</span>)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true"></a><span class="kw">bg3d</span>(<span class="st">&quot;#363940&quot;</span>)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true"></a>colors &lt;-<span class="st"> </span><span class="kw">hcl.colors</span>(<span class="dv">5</span>, <span class="dt">palette =</span> <span class="st">&quot;Spectral&quot;</span>)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true"></a><span class="kw">invisible</span>(<span class="kw">lapply</span>(</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true"></a>  <span class="dv">1</span><span class="op">:</span><span class="dv">5</span>, <span class="cf">function</span>(i) <span class="kw">shade3d</span>(rglmeshes[[i]], <span class="dt">color =</span> colors[i])</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true"></a>))</span></code></pre></div>
<p><img src="./figures/tetrahedraCompound.gif" /></p>
<p>I wondered for a long time what is the intersection of these five tetrahedra. But I didn’t have any tool to compute it. Now I have. Let’s see.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true"></a><span class="co"># compute the intersection ####</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true"></a>inter &lt;-<span class="st"> </span><span class="kw">MeshesIntersection</span>(</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true"></a>  tetrahedraCompound[[<span class="st">&quot;meshes&quot;</span>]], <span class="dt">numbersType =</span> <span class="st">&quot;lazyExact&quot;</span>, <span class="dt">clean =</span> <span class="ot">TRUE</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true"></a>)</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true"></a><span class="co"># plot ####</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true"></a><span class="kw">open3d</span>(<span class="dt">windowRect =</span> <span class="kw">c</span>(<span class="dv">50</span>, <span class="dv">50</span>, <span class="dv">562</span>, <span class="dv">562</span>), <span class="dt">zoom =</span> <span class="fl">0.75</span>)</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true"></a><span class="kw">bg3d</span>(<span class="st">&quot;#363940&quot;</span>)</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true"></a><span class="co"># first the five tetrahedra with transparency ####</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true"></a><span class="kw">invisible</span>(<span class="kw">lapply</span>(</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true"></a>  rglmeshes, shade3d, <span class="dt">color =</span> <span class="st">&quot;yellow&quot;</span>, <span class="dt">alpha =</span> <span class="fl">0.1</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true"></a>))</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true"></a><span class="co"># now the intersection ####</span></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true"></a>rglinter &lt;-<span class="st"> </span><span class="kw">tmesh3d</span>(</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true"></a>  <span class="st">&quot;vertices&quot;</span>    =<span class="st"> </span><span class="kw">t</span>(inter[[<span class="st">&quot;vertices&quot;</span>]]),</span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true"></a>  <span class="st">&quot;indices&quot;</span>     =<span class="st"> </span><span class="kw">t</span>(inter[[<span class="st">&quot;faces&quot;</span>]]),</span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true"></a>  <span class="st">&quot;homogeneous&quot;</span> =<span class="st"> </span><span class="ot">FALSE</span></span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true"></a>)</span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true"></a><span class="kw">shade3d</span>(rglinter, <span class="dt">color =</span> <span class="st">&quot;gainsboro&quot;</span>)</span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true"></a><span class="co"># and finally the edges ####</span></span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true"></a><span class="kw">plotEdges</span>(</span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true"></a>  inter[[<span class="st">&quot;vertices&quot;</span>]], inter[[<span class="st">&quot;exteriorEdges&quot;</span>]],</span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true"></a>  <span class="dt">only =</span> inter[[<span class="st">&quot;exteriorVertices&quot;</span>]], <span class="dt">color =</span> <span class="st">&quot;darkmagenta&quot;</span></span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true"></a>)</span></code></pre></div>
<p>Here is the result:</p>
<p><img src="./figures/tetrahedraCompoundIntersection.gif" /></p>
<p>This is an icosahedron, I think.</p>
<p>Unfortunately, R CMD CHECK still throws some warnings which prevent me to publish this package on CRAN. I hope this issue will be solved.</p>

        </div>


        <div id="footer">
          Site proudly generated by
          <a href="http://jaspervdj.be/hakyll">Hakyll</a>
        </div>

      </div>

    </div>

    <div class="row">
      <div class="col-sm-12">
        <div id="disqus_thread"></div>
        <div class="pagination">
          <ul>
            <li>
              <a href="http://laustep.github.io/stlahblog/">&#171; Back Home</a>
            </li>
          </ul>
        </div>
      </div>
    </div>
    
  </div>

</body>

<script src="/libraries/bootstrap/bootstrap.min.js"></script>
<script>
  var disqus_developer = 1;
  var disqus_shortname = 'stlapblog';
  // required: replace example with your forum shortname
  /* * * DON'T EDIT BELOW THIS LINE * * */
  (function () {
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = 'https://' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] ||
      document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>
<noscript>Please enable JavaScript to view the
  <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a>
</noscript>
<!-- MathJax: Fall back to local if CDN offline but local image fonts are not supported (saves >100MB) -->
<script type="text/x-mathjax-config" src="/libraries/mathjax/config/TeX-MML-AM_CHTML.js"></script>
<!-- <script>
  window.MathJax || document.write('<script type="text/x-mathjax-config">MathJax.Hub.Config({"HTML-CSS":{imageFont:null}});<\/script><script src="../libraries/mathjax/MathJax.js"><\/script>');
</script> -->


</html>]]></description>
    <pubDate>Sat, 14 May 2022 00:00:00 UT</pubDate>
    <guid>https://laustep.github.io/stlahblog/posts/BooleanOpsOnMeshes.html</guid>
    <dc:creator>Stéphane Laurent</dc:creator>
    <category>R</category>
</item>


<item>
    <title>Copy 'plotly' image to the clipboard</title>
    <link>https://laustep.github.io/stlahblog/posts/plotly_copyToClipboard.html</link>
    <description><![CDATA[<!DOCTYPE HTML>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Saturn Elephant - Copy 'plotly' image to the clipboard</title>
  <link href="/libraries/bootstrap/bootstrap-grid.min.css" rel="stylesheet">
  <link rel="stylesheet" href="/css/default2.css" />
  <link rel="stylesheet" href="/css/post.css" />
  <link rel="stylesheet" href="/css/misc.css" /> 
  
    <link rel="stylesheet" href="/css/pandoc-solarized.css" /> 
   
  
  <link href="https://fonts.googleapis.com/css?family=Raleway:400,600,200,800" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/css?family=Droid+Sans" rel="stylesheet" type="text/css">
  <script src="/libraries/jquery.min.js"></script>
  <script type="text/javascript" async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML"></script>
</head>

<body>
  <div class="container-fluid">
    <div class="row">
      <!-- Sidebar. -->
      <div class="sidebar col-sm-2">
        <div class="row">
          <div class="col-sm-12" style="float:right;clear:both;margin-right:50px;margin-top:50px;">
            <a href="https://www.r-bloggers.com/">
              <img src="/images/Rbloggers.png" alt="Rbloggers" width="100%" />
            </a>
            <br/>
            <a href="http://t-redactyl.io/">
              <span style="color:black;font-weight:bold;font-family:sans-serif;font-size:25px;">Standard error</span>
            </a>
            <a href="http://timelyportfolio.blogspot.be/">
              <span style="color:grey;font-weight:bold;font-family:sans-serif;font-size:24px;">Timely portfolio</span>
            </a>
            <br/>
            <a href="https://antoineguillot.wordpress.com/blog/">
              <span style="color:white;background-color:darkblue;font-weight:bold;font-family:sans-serif;font-size:21px;border:5px solid;border-color:darkblue">ENHANCE DATA</span>
            </a>
            <br/>
            <a href="https://fronkonstin.com/">
              <span style="color:black;background-color:gold;font-weight:bold;font-size:29px;border:3px solid;border-color:gold;">Fronkonstin</span>
            </a>
          </div>
        </div>
        <div id="logos">
          <div class="row">
            <div class="col-sm-4">
              <img src="/images/AsymptoteLogo.svg" style="width: 150%; transform: rotateZ(-35deg)"/>
            </div>
            <div class="col-sm-4">
              <img src="/images/Rlogo.svg" style="width: 110%;"/>
            </div>
            <div class="col-sm-4">
              <img src="/images/shiny-hex.png" style="width: 90%;"/>
            </div>
          </div>
          <div class="row">
            <div class="col-sm-4">
              <img src="/images/Povray_logo_sphere.png" style="width: 105%;"/>
            </div>
            <div class="col-sm-4">
              <img src="/images/javascript.svg" style="width: 90%;"/>
            </div>
            <div class="col-sm-4">
              <img src="/images/haskell.svg" style="width: 110%;"/>
            </div>
          </div>
        </div>
      </div>

      <div class="main col-sm-10">
        <div id="header">
          <div id="logo">
            <a href="/">
              <img src="/images/stla.jpg" alt="stla" width="100px" />
            </a>
          </div>
          <div id="navigation" style="margin-top:50px;">
            <a href="/">Home</a>
            <a href="/about.html">About</a>
            <a href="/contact.html">Contact</a>
            <a href="/archive.html">Archive</a>
          </div>
        </div>

        <div class="content">
          <h1>Copy 'plotly' image to the clipboard</h1> 
          <div class="info">
    Posted on March 16, 2022
    
        by Stéphane Laurent
    
</div>
<div class="info">
    
    Tags: <a title="All pages tagged &#39;R&#39;." href="/tags/R.html">R</a>, <a title="All pages tagged &#39;graphics&#39;." href="/tags/graphics.html">graphics</a>, <a title="All pages tagged &#39;plotly&#39;." href="/tags/plotly.html">plotly</a>, <a title="All pages tagged &#39;javascript&#39;." href="/tags/javascript.html">javascript</a>
    
</div>

<p>The R code below shows how to get a <em>“Copy to clipboard”</em> button in the <code>plotly</code> toolbar.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a><span class="kw">library</span>(plotly)</span>
<span id="cb1-2"><a href="#cb1-2"></a></span>
<span id="cb1-3"><a href="#cb1-3"></a><span class="kw">set.seed</span>(666L)</span>
<span id="cb1-4"><a href="#cb1-4"></a>asd &lt;-<span class="st"> </span><span class="kw">data.frame</span>(</span>
<span id="cb1-5"><a href="#cb1-5"></a>  <span class="dt">week =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">6</span>, <span class="dv">7</span>, <span class="dv">8</span>), </span>
<span id="cb1-6"><a href="#cb1-6"></a>  <span class="dt">a    =</span> <span class="kw">rpois</span>(8L, <span class="dv">30</span>), </span>
<span id="cb1-7"><a href="#cb1-7"></a>  <span class="dt">b    =</span> <span class="kw">rpois</span>(8L, <span class="dv">25</span>)</span>
<span id="cb1-8"><a href="#cb1-8"></a>)</span>
<span id="cb1-9"><a href="#cb1-9"></a></span>
<span id="cb1-10"><a href="#cb1-10"></a>js &lt;-<span class="st"> </span><span class="kw">c</span>(</span>
<span id="cb1-11"><a href="#cb1-11"></a>  <span class="st">&#39;function(gd) {&#39;</span>,</span>
<span id="cb1-12"><a href="#cb1-12"></a>  <span class="st">&#39;  Plotly.Snapshot.toImage(gd, {format: &quot;png&quot;}).once(&#39;</span>,</span>
<span id="cb1-13"><a href="#cb1-13"></a>  <span class="st">&#39;    &quot;success&quot;,&#39;</span>,</span>
<span id="cb1-14"><a href="#cb1-14"></a>  <span class="st">&#39;    async function(url) {&#39;</span>,</span>
<span id="cb1-15"><a href="#cb1-15"></a>  <span class="st">&#39;      try {&#39;</span>,</span>
<span id="cb1-16"><a href="#cb1-16"></a>  <span class="st">&#39;        const data = await fetch(url);&#39;</span>,</span>
<span id="cb1-17"><a href="#cb1-17"></a>  <span class="st">&#39;        const blob = await data.blob();&#39;</span>,</span>
<span id="cb1-18"><a href="#cb1-18"></a>  <span class="st">&#39;        await navigator.clipboard.write([&#39;</span>,</span>
<span id="cb1-19"><a href="#cb1-19"></a>  <span class="st">&#39;          new ClipboardItem({&#39;</span>,</span>
<span id="cb1-20"><a href="#cb1-20"></a>  <span class="st">&#39;            [blob.type]: blob&#39;</span>,</span>
<span id="cb1-21"><a href="#cb1-21"></a>  <span class="st">&#39;          })&#39;</span>,</span>
<span id="cb1-22"><a href="#cb1-22"></a>  <span class="st">&#39;        ]);&#39;</span>,</span>
<span id="cb1-23"><a href="#cb1-23"></a>  <span class="st">&#39;        console.log(&quot;Image copied.&quot;);&#39;</span>,</span>
<span id="cb1-24"><a href="#cb1-24"></a>  <span class="st">&#39;        var $div = $(&quot;&lt;div&gt;Image copied to clipboard&lt;/div&gt;&quot;);&#39;</span>,</span>
<span id="cb1-25"><a href="#cb1-25"></a>  <span class="st">&#39;        $div.css({&#39;</span>,</span>
<span id="cb1-26"><a href="#cb1-26"></a>  <span class="st">&#39;          display: &quot;none&quot;,&#39;</span>,</span>
<span id="cb1-27"><a href="#cb1-27"></a>  <span class="st">&#39;          position: &quot;absolute&quot;,&#39;</span>,</span>
<span id="cb1-28"><a href="#cb1-28"></a>  <span class="st">&#39;          top: &quot;5%&quot;,&#39;</span>,</span>
<span id="cb1-29"><a href="#cb1-29"></a>  <span class="st">&#39;          left: &quot;50%&quot;,&#39;</span>,</span>
<span id="cb1-30"><a href="#cb1-30"></a>  <span class="st">&#39;          transform: &quot;translate(-50%, 0)&quot;,&#39;</span>,</span>
<span id="cb1-31"><a href="#cb1-31"></a>  <span class="st">&#39;          &quot;font-size&quot;: &quot;30px&quot;,&#39;</span>,</span>
<span id="cb1-32"><a href="#cb1-32"></a>  <span class="st">&#39;          &quot;font-family&quot;: &quot;Tahoma, sans-serif&quot;,&#39;</span>,</span>
<span id="cb1-33"><a href="#cb1-33"></a>  <span class="st">&#39;          &quot;font-style&quot;: &quot;italic&quot;,&#39;</span>,</span>
<span id="cb1-34"><a href="#cb1-34"></a>  <span class="st">&#39;          &quot;background-color&quot;: &quot;seashell&quot;,&#39;</span>,</span>
<span id="cb1-35"><a href="#cb1-35"></a>  <span class="st">&#39;          padding: &quot;10px&quot;,&#39;</span>,</span>
<span id="cb1-36"><a href="#cb1-36"></a>  <span class="st">&#39;          border: &quot;2px solid black&quot;,&#39;</span>,</span>
<span id="cb1-37"><a href="#cb1-37"></a>  <span class="st">&#39;          &quot;border-radius&quot;: &quot;5px&quot;&#39;</span>,</span>
<span id="cb1-38"><a href="#cb1-38"></a>  <span class="st">&#39;        });&#39;</span>,</span>
<span id="cb1-39"><a href="#cb1-39"></a>  <span class="st">&#39;        $div.appendTo(&quot;body&quot;);&#39;</span>,</span>
<span id="cb1-40"><a href="#cb1-40"></a>  <span class="st">&#39;        $div.fadeIn(3000, function() {&#39;</span>,</span>
<span id="cb1-41"><a href="#cb1-41"></a>  <span class="st">&#39;          $div.fadeOut(3000);&#39;</span>,</span>
<span id="cb1-42"><a href="#cb1-42"></a>  <span class="st">&#39;        });&#39;</span>,</span>
<span id="cb1-43"><a href="#cb1-43"></a>  <span class="st">&#39;      } catch(err) {&#39;</span>,</span>
<span id="cb1-44"><a href="#cb1-44"></a>  <span class="st">&#39;        console.error(err.name, err.message);&#39;</span>,</span>
<span id="cb1-45"><a href="#cb1-45"></a>  <span class="st">&#39;      }&#39;</span>,</span>
<span id="cb1-46"><a href="#cb1-46"></a>  <span class="st">&#39;    }&#39;</span>,</span>
<span id="cb1-47"><a href="#cb1-47"></a>  <span class="st">&#39;  );&#39;</span>,</span>
<span id="cb1-48"><a href="#cb1-48"></a>  <span class="st">&#39;}&#39;</span></span>
<span id="cb1-49"><a href="#cb1-49"></a>)</span>
<span id="cb1-50"><a href="#cb1-50"></a></span>
<span id="cb1-51"><a href="#cb1-51"></a>SVGicon_path &lt;-<span class="st"> </span><span class="kw">paste0</span>(</span>
<span id="cb1-52"><a href="#cb1-52"></a>  <span class="st">&quot;M97.67,20.81L97.67,20.81l0.01,0.02c3.7,0.01,7.04,1.51,9.46,3.93c2.4,2.&quot;</span>,</span>
<span id="cb1-53"><a href="#cb1-53"></a>  <span class="st">&quot;41,3.9,5.74,3.9,9.42h0.02v0.02v75.28 v0.01h-0.02c-0.01,3.68-1.51,7.03-&quot;</span>,</span>
<span id="cb1-54"><a href="#cb1-54"></a>  <span class="st">&quot;3.93,9.46c-2.41,2.4-5.74,3.9-9.42,3.9v0.02h-0.02H38.48h-0.01v-0.02 c-3&quot;</span>,</span>
<span id="cb1-55"><a href="#cb1-55"></a>  <span class="st">&quot;.69-0.01-7.04-1.5-9.46-3.93c-2.4-2.41-3.9-5.74-3.91-9.42H25.1c0-25.96,&quot;</span>,</span>
<span id="cb1-56"><a href="#cb1-56"></a>  <span class="st">&quot;0-49.34,0-75.3v-0.01h0.02 c0.01-3.69,1.52-7.04,3.94-9.46c2.41-2.4,5.73&quot;</span>,</span>
<span id="cb1-57"><a href="#cb1-57"></a>  <span class="st">&quot;-3.9,9.42-3.91v-0.02h0.02C58.22,20.81,77.95,20.81,97.67,20.81L97.67,20&quot;</span>,</span>
<span id="cb1-58"><a href="#cb1-58"></a>  <span class="st">&quot;.81z M0.02,75.38L0,13.39v-0.01h0.02c0.01-3.69,1.52-7.04,3.93-9.46c2.41&quot;</span>,</span>
<span id="cb1-59"><a href="#cb1-59"></a>  <span class="st">&quot;-2.4,5.74-3.9,9.42-3.91V0h0.02h59.19 c7.69,0,8.9,9.96,0.01,10.16H13.4h&quot;</span>,</span>
<span id="cb1-60"><a href="#cb1-60"></a>  <span class="st">&quot;-0.02v-0.02c-0.88,0-1.68,0.37-2.27,0.97c-0.59,0.58-0.96,1.4-0.96,2.27h&quot;</span>,</span>
<span id="cb1-61"><a href="#cb1-61"></a>  <span class="st">&quot;0.02v0.01v3.17 c0,19.61,0,39.21,0,58.81C10.17,83.63,0.02,84.09,0.02,75&quot;</span>,</span>
<span id="cb1-62"><a href="#cb1-62"></a>  <span class="st">&quot;.38L0.02,75.38z M100.91,109.49V34.2v-0.02h0.02 c0-0.87-0.37-1.68-0.97-&quot;</span>,</span>
<span id="cb1-63"><a href="#cb1-63"></a>  <span class="st">&quot;2.27c-0.59-0.58-1.4-0.96-2.28-0.96v0.02h-0.01H38.48h-0.02v-0.02c-0.88,&quot;</span>,</span>
<span id="cb1-64"><a href="#cb1-64"></a>  <span class="st">&quot;0-1.68,0.38-2.27,0.97 c-0.59,0.58-0.96,1.4-0.96,2.27h0.02v0.01v75.28v0&quot;</span>,</span>
<span id="cb1-65"><a href="#cb1-65"></a>  <span class="st">&quot;.02h-0.02c0,0.88,0.38,1.68,0.97,2.27c0.59,0.59,1.4,0.96,2.27,0.96v-0.0&quot;</span>,</span>
<span id="cb1-66"><a href="#cb1-66"></a>  <span class="st">&quot;2h0.01 h59.19h0.02v0.02c0.87,0,1.68-0.38,2.27-0.97c0.59-0.58,0.96-1.4,&quot;</span>,</span>
<span id="cb1-67"><a href="#cb1-67"></a>  <span class="st">&quot;0.96-2.27L100.91,109.49L100.91,109.49L100.91,109.49 L100.91,109.49z&quot;</span></span>
<span id="cb1-68"><a href="#cb1-68"></a>)</span>
<span id="cb1-69"><a href="#cb1-69"></a></span>
<span id="cb1-70"><a href="#cb1-70"></a>CopyToClipboard &lt;-<span class="st"> </span><span class="kw">list</span>(</span>
<span id="cb1-71"><a href="#cb1-71"></a>  <span class="dt">name =</span> <span class="st">&quot;Copy&quot;</span>,</span>
<span id="cb1-72"><a href="#cb1-72"></a>  <span class="dt">icon =</span> <span class="kw">list</span>(</span>
<span id="cb1-73"><a href="#cb1-73"></a>    <span class="dt">path   =</span> SVGicon_path,</span>
<span id="cb1-74"><a href="#cb1-74"></a>    <span class="dt">width  =</span> <span class="dv">111</span>,</span>
<span id="cb1-75"><a href="#cb1-75"></a>    <span class="dt">height =</span> <span class="dv">123</span></span>
<span id="cb1-76"><a href="#cb1-76"></a>  ),</span>
<span id="cb1-77"><a href="#cb1-77"></a>  <span class="dt">click =</span> htmlwidgets<span class="op">::</span><span class="kw">JS</span>(js)</span>
<span id="cb1-78"><a href="#cb1-78"></a>)</span>
<span id="cb1-79"><a href="#cb1-79"></a></span>
<span id="cb1-80"><a href="#cb1-80"></a><span class="kw">plot_ly</span>(</span>
<span id="cb1-81"><a href="#cb1-81"></a>  asd, <span class="dt">x =</span> <span class="op">~</span>week, <span class="dt">y =</span> <span class="op">~</span>a, <span class="dt">name =</span> <span class="st">&quot;a&quot;</span>, <span class="dt">type =</span> <span class="st">&quot;scatter&quot;</span>, <span class="dt">mode =</span> <span class="st">&quot;lines&quot;</span></span>
<span id="cb1-82"><a href="#cb1-82"></a>) <span class="op">%&gt;%</span></span>
<span id="cb1-83"><a href="#cb1-83"></a><span class="st">  </span><span class="kw">add_trace</span>(<span class="dt">y =</span> <span class="op">~</span>b, <span class="dt">name =</span> <span class="st">&quot;b&quot;</span>, <span class="dt">mode =</span> <span class="st">&quot;lines&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb1-84"><a href="#cb1-84"></a><span class="st">  </span><span class="kw">layout</span>(</span>
<span id="cb1-85"><a href="#cb1-85"></a>    <span class="dt">margin =</span> <span class="kw">list</span>(<span class="dt">l =</span> <span class="dv">100</span>, <span class="dt">r =</span> <span class="dv">100</span>, <span class="dt">b =</span> <span class="dv">100</span>, <span class="dt">t =</span> <span class="dv">100</span>), </span>
<span id="cb1-86"><a href="#cb1-86"></a>    <span class="dt">xaxis =</span> <span class="kw">list</span>(</span>
<span id="cb1-87"><a href="#cb1-87"></a>      <span class="dt">title     =</span> <span class="st">&quot;Week&quot;</span>, </span>
<span id="cb1-88"><a href="#cb1-88"></a>      <span class="dt">showgrid  =</span> <span class="ot">FALSE</span>, </span>
<span id="cb1-89"><a href="#cb1-89"></a>      <span class="dt">rangemode =</span> <span class="st">&quot;normal&quot;</span></span>
<span id="cb1-90"><a href="#cb1-90"></a>    ),</span>
<span id="cb1-91"><a href="#cb1-91"></a>    <span class="dt">yaxis =</span> <span class="kw">list</span>(</span>
<span id="cb1-92"><a href="#cb1-92"></a>      <span class="dt">title     =</span> <span class="st">&quot;&quot;</span>, </span>
<span id="cb1-93"><a href="#cb1-93"></a>      <span class="dt">showgrid  =</span> <span class="ot">FALSE</span>, </span>
<span id="cb1-94"><a href="#cb1-94"></a>      <span class="dt">rangemode =</span> <span class="st">&quot;tozero&quot;</span></span>
<span id="cb1-95"><a href="#cb1-95"></a>    ),</span>
<span id="cb1-96"><a href="#cb1-96"></a>    <span class="dt">hovermode =</span> <span class="st">&quot;x unified&quot;</span></span>
<span id="cb1-97"><a href="#cb1-97"></a>  ) <span class="op">%&gt;%</span></span>
<span id="cb1-98"><a href="#cb1-98"></a><span class="st">  </span><span class="kw">config</span>(<span class="dt">modeBarButtonsToAdd =</span> <span class="kw">list</span>(CopyToClipboard))</span></code></pre></div>
<p><img src="figures/plotly_copyToClipboard.gif" style="width:75.0%" /></p>

        </div>


        <div id="footer">
          Site proudly generated by
          <a href="http://jaspervdj.be/hakyll">Hakyll</a>
        </div>

      </div>

    </div>

    <div class="row">
      <div class="col-sm-12">
        <div id="disqus_thread"></div>
        <div class="pagination">
          <ul>
            <li>
              <a href="http://laustep.github.io/stlahblog/">&#171; Back Home</a>
            </li>
          </ul>
        </div>
      </div>
    </div>
    
  </div>

</body>

<script src="/libraries/bootstrap/bootstrap.min.js"></script>
<script>
  var disqus_developer = 1;
  var disqus_shortname = 'stlapblog';
  // required: replace example with your forum shortname
  /* * * DON'T EDIT BELOW THIS LINE * * */
  (function () {
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = 'https://' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] ||
      document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>
<noscript>Please enable JavaScript to view the
  <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a>
</noscript>
<!-- MathJax: Fall back to local if CDN offline but local image fonts are not supported (saves >100MB) -->
<script type="text/x-mathjax-config" src="/libraries/mathjax/config/TeX-MML-AM_CHTML.js"></script>
<!-- <script>
  window.MathJax || document.write('<script type="text/x-mathjax-config">MathJax.Hub.Config({"HTML-CSS":{imageFont:null}});<\/script><script src="../libraries/mathjax/MathJax.js"><\/script>');
</script> -->


</html>]]></description>
    <pubDate>Wed, 16 Mar 2022 00:00:00 UT</pubDate>
    <guid>https://laustep.github.io/stlahblog/posts/plotly_copyToClipboard.html</guid>
    <dc:creator>Stéphane Laurent</dc:creator>
    <category>R</category>
</item>


<item>
    <title>The E8 root polytope</title>
    <link>https://laustep.github.io/stlahblog/posts/E8rootPolytope.html</link>
    <description><![CDATA[<!DOCTYPE HTML>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Saturn Elephant - The E8 root polytope</title>
  <link href="/libraries/bootstrap/bootstrap-grid.min.css" rel="stylesheet">
  <link rel="stylesheet" href="/css/default2.css" />
  <link rel="stylesheet" href="/css/post.css" />
  <link rel="stylesheet" href="/css/misc.css" /> 
  
    <link rel="stylesheet" href="/css/pandoc-solarized.css" /> 
   
  
  <link href="https://fonts.googleapis.com/css?family=Raleway:400,600,200,800" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/css?family=Droid+Sans" rel="stylesheet" type="text/css">
  <script src="/libraries/jquery.min.js"></script>
  <script type="text/javascript" async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML"></script>
</head>

<body>
  <div class="container-fluid">
    <div class="row">
      <!-- Sidebar. -->
      <div class="sidebar col-sm-2">
        <div class="row">
          <div class="col-sm-12" style="float:right;clear:both;margin-right:50px;margin-top:50px;">
            <a href="https://www.r-bloggers.com/">
              <img src="/images/Rbloggers.png" alt="Rbloggers" width="100%" />
            </a>
            <br/>
            <a href="http://t-redactyl.io/">
              <span style="color:black;font-weight:bold;font-family:sans-serif;font-size:25px;">Standard error</span>
            </a>
            <a href="http://timelyportfolio.blogspot.be/">
              <span style="color:grey;font-weight:bold;font-family:sans-serif;font-size:24px;">Timely portfolio</span>
            </a>
            <br/>
            <a href="https://antoineguillot.wordpress.com/blog/">
              <span style="color:white;background-color:darkblue;font-weight:bold;font-family:sans-serif;font-size:21px;border:5px solid;border-color:darkblue">ENHANCE DATA</span>
            </a>
            <br/>
            <a href="https://fronkonstin.com/">
              <span style="color:black;background-color:gold;font-weight:bold;font-size:29px;border:3px solid;border-color:gold;">Fronkonstin</span>
            </a>
          </div>
        </div>
        <div id="logos">
          <div class="row">
            <div class="col-sm-4">
              <img src="/images/AsymptoteLogo.svg" style="width: 150%; transform: rotateZ(-35deg)"/>
            </div>
            <div class="col-sm-4">
              <img src="/images/Rlogo.svg" style="width: 110%;"/>
            </div>
            <div class="col-sm-4">
              <img src="/images/shiny-hex.png" style="width: 90%;"/>
            </div>
          </div>
          <div class="row">
            <div class="col-sm-4">
              <img src="/images/Povray_logo_sphere.png" style="width: 105%;"/>
            </div>
            <div class="col-sm-4">
              <img src="/images/javascript.svg" style="width: 90%;"/>
            </div>
            <div class="col-sm-4">
              <img src="/images/haskell.svg" style="width: 110%;"/>
            </div>
          </div>
        </div>
      </div>

      <div class="main col-sm-10">
        <div id="header">
          <div id="logo">
            <a href="/">
              <img src="/images/stla.jpg" alt="stla" width="100px" />
            </a>
          </div>
          <div id="navigation" style="margin-top:50px;">
            <a href="/">Home</a>
            <a href="/about.html">About</a>
            <a href="/contact.html">Contact</a>
            <a href="/archive.html">Archive</a>
          </div>
        </div>

        <div class="content">
          <h1>The E8 root polytope</h1> 
          <div class="info">
    Posted on March 14, 2022
    
        by Stéphane Laurent
    
</div>
<div class="info">
    
    Tags: <a title="All pages tagged &#39;R&#39;." href="/tags/R.html">R</a>, <a title="All pages tagged &#39;maths&#39;." href="/tags/maths.html">maths</a>, <a title="All pages tagged &#39;geometry&#39;." href="/tags/geometry.html">geometry</a>, <a title="All pages tagged &#39;graphics&#39;." href="/tags/graphics.html">graphics</a>, <a title="All pages tagged &#39;python&#39;." href="/tags/python.html">python</a>, <a title="All pages tagged &#39;julia&#39;." href="/tags/julia.html">julia</a>
    
</div>

<h2 id="the-e8-root-polytope-its-vertices-and-its-edges">The E8 root polytope, its vertices and its edges</h2>
<p>The <em>E8 root polytope</em>, also known as the <a href="https://en.wikipedia.org/wiki/4_21_polytope"><span class="math inline">\(4_{21}\)</span> polytope</a> is a 8-dimensional polytope. The Cartesian coordinates of its vertices are described in the above linked Wikipedia page. It has 240 vertices, that can be separated in two sets. The first set is obtained from <span class="math inline">\((\pm 2, \pm 2, 0, 0, 0, 0, 0, 0)\)</span> by taking an arbitrary combination of the signs and an arbitrary permutation of the coordinates. This gives <span class="math inline">\(2^2 \tbinom{8}{2} = 112\)</span> vertices, that one can obtain as follows in R:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true"></a>combs &lt;-<span class="st"> </span>arrangements<span class="op">::</span><span class="kw">combinations</span>(8L, 2L)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true"></a>vertices1 &lt;-<span class="st"> </span><span class="ot">NULL</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true"></a><span class="cf">for</span>(i <span class="cf">in</span> 1L<span class="op">:</span><span class="kw">nrow</span>(combs)){</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true"></a>  comb &lt;-<span class="st"> </span>combs[i, ]</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true"></a>  <span class="cf">for</span>(x <span class="cf">in</span> <span class="kw">c</span>(<span class="op">-</span><span class="dv">2</span>, <span class="dv">2</span>)){</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true"></a>    <span class="cf">for</span>(y <span class="cf">in</span> <span class="kw">c</span>(<span class="op">-</span><span class="dv">2</span>, <span class="dv">2</span>)){</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true"></a>      zeros &lt;-<span class="st"> </span><span class="kw">rep</span>(<span class="dv">0</span>, 8L)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true"></a>      zeros[comb[1L]] &lt;-<span class="st"> </span>x</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true"></a>      zeros[comb[2L]] &lt;-<span class="st"> </span>y</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true"></a>      vertices1 &lt;-<span class="st"> </span><span class="kw">rbind</span>(vertices1, zeros)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true"></a>    }</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true"></a>  }</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true"></a>}</span></code></pre></div>
<p>Indeed we get <span class="math inline">\(112\)</span> vertices, in a matrix with stupid row names:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true"></a><span class="kw">str</span>(vertices1)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true"></a><span class="co">##  num [1:112, 1:8] -2 -2 2 2 -2 -2 2 2 -2 -2 ...</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true"></a><span class="co">##  - attr(*, &quot;dimnames&quot;)=List of 2</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true"></a><span class="co">##   ..$ : chr [1:112] &quot;zeros&quot; &quot;zeros&quot; &quot;zeros&quot; &quot;zeros&quot; ...</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true"></a><span class="co">##   ..$ : NULL</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true"></a><span class="kw">head</span>(vertices1)</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true"></a><span class="co">##       [,1] [,2] [,3] [,4] [,5] [,6] [,7] [,8]</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true"></a><span class="co">## zeros   -2   -2    0    0    0    0    0    0</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true"></a><span class="co">## zeros   -2    2    0    0    0    0    0    0</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true"></a><span class="co">## zeros    2   -2    0    0    0    0    0    0</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true"></a><span class="co">## zeros    2    2    0    0    0    0    0    0</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true"></a><span class="co">## zeros   -2    0   -2    0    0    0    0    0</span></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true"></a><span class="co">## zeros   -2    0    2    0    0    0    0    0</span></span></code></pre></div>
<p>The second set of vertices is obtained from <span class="math inline">\((\pm 1, \ldots, \pm 1)\)</span> by taking an even number of minus signs. As noted in the Wikipedia article, this amounts to say that the sum of the coordinates is a multiple of <span class="math inline">\(4\)</span>.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true"></a>vertices2 &lt;-<span class="st"> </span><span class="ot">NULL</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true"></a>grd &lt;-<span class="st"> </span><span class="kw">as.matrix</span>(<span class="kw">expand.grid</span>(<span class="kw">rep</span>(<span class="kw">list</span>(<span class="kw">c</span>(<span class="op">-</span><span class="dv">1</span>, <span class="dv">1</span>)), 8L)))</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true"></a><span class="cf">for</span>(i <span class="cf">in</span> 1L<span class="op">:</span><span class="kw">nrow</span>(grd)){</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true"></a>  v &lt;-<span class="st"> </span>grd[i, ]</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true"></a>  <span class="cf">if</span>(<span class="kw">sum</span>(v) <span class="op">%%</span><span class="st"> </span><span class="dv">4</span> <span class="op">==</span><span class="st"> </span><span class="dv">0</span>){</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true"></a>    vertices2 &lt;-<span class="st"> </span><span class="kw">rbind</span>(vertices2, v)</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true"></a>  }</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true"></a>}</span></code></pre></div>
<p>This gives <span class="math inline">\(128\)</span> vertices, again in a matrix with stupid row names:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true"></a><span class="kw">str</span>(vertices2)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true"></a><span class="co">##  num [1:128, 1:8] -1 1 1 -1 1 -1 -1 1 1 -1 ...</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true"></a><span class="co">##  - attr(*, &quot;dimnames&quot;)=List of 2</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true"></a><span class="co">##   ..$ : chr [1:128] &quot;v&quot; &quot;v&quot; &quot;v&quot; &quot;v&quot; ...</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true"></a><span class="co">##   ..$ : chr [1:8] &quot;Var1&quot; &quot;Var2&quot; &quot;Var3&quot; &quot;Var4&quot; ...</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true"></a><span class="kw">head</span>(vertices2)</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true"></a><span class="co">##   Var1 Var2 Var3 Var4 Var5 Var6 Var7 Var8</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true"></a><span class="co">## v   -1   -1   -1   -1   -1   -1   -1   -1</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true"></a><span class="co">## v    1    1   -1   -1   -1   -1   -1   -1</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true"></a><span class="co">## v    1   -1    1   -1   -1   -1   -1   -1</span></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true"></a><span class="co">## v   -1    1    1   -1   -1   -1   -1   -1</span></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true"></a><span class="co">## v    1   -1   -1    1   -1   -1   -1   -1</span></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true"></a><span class="co">## v   -1    1   -1    1   -1   -1   -1   -1</span></span></code></pre></div>
<p>So here is our matrix of <span class="math inline">\(240\)</span> vertices:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true"></a>vertices &lt;-<span class="st"> </span><span class="kw">rbind</span>(vertices1, vertices2)</span></code></pre></div>
<p>Well. Now, how to get the <em>edges</em> of the polytope? An edge is a pair of connected (adjacent) vertices, and it is better to store them as pairs of vertex indices (the row indices of our <code>vertices</code> matrix).</p>
<p>My first attempt was to resort to my package <strong>cxhull</strong>. Indeed, the E8 root polytope is convex, therefore its convex hull is itself, and the <code>cxhull</code> function of the <strong>cxhull</strong> package provides the edges of the convex hull. Therefore, I ran:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true"></a><span class="kw">library</span>(cxhull)</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true"></a>hull &lt;-<span class="st"> </span><span class="kw">cxhull</span>(vertices, <span class="dt">triangulate =</span> <span class="ot">FALSE</span>)</span></code></pre></div>
<p>What a disaster! <strong><em>Do not run this code!</em></strong> It totally crashed my laptop. Perhaps that can work with more RAM, I don’t know (I have only 8 Gb). I searched and I searched on the web, with no luck, I didn’t find these edges. So I decided to search another computational geometry library, able to get these edges. I thought of the C library <a href="https://people.inf.ethz.ch/fukudak/cdd_home/">cddlib</a>. I’m not a star in C but this library is wrapped in the Julia library <a href="https://github.com/JuliaPolyhedra/CDDLib.jl">CDDLib.jl</a>. No luck: this wrapper is incomplete and the vertex adjacency was not available in this library. Then I opened an issue on the Github repo to request this feature, and I looked at the documentation of the Python wrapper of <strong>cddlib</strong>: the <strong>pycddlib</strong> library. Very nice: it provides the vertex adjacency feature. I didn’t have the courage to program the construction of the vertices in Python, so I used <a href="https://laustep.github.io/stlahblog/posts/Rmatrix2HaskellList.html">my old blog post</a>, <em>“A R matrix to a Haskell list”</em>, since it is also usable for Python instead of Haskell. But now let’s show how to construct the vertices in Python:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true"></a><span class="im">from</span> itertools <span class="im">import</span> product, combinations</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true"></a></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true"></a>vertices <span class="op">=</span> []</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true"></a></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true"></a><span class="co"># our `vertices1` in R:</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true"></a><span class="cf">for</span> i, j <span class="kw">in</span> combinations(<span class="bu">range</span>(<span class="dv">8</span>), <span class="dv">2</span>):</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true"></a>    <span class="cf">for</span> x, y <span class="kw">in</span> product([<span class="op">-</span><span class="dv">2</span>, <span class="dv">2</span>], repeat <span class="op">=</span> <span class="dv">2</span>):</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true"></a>        v <span class="op">=</span> np.zeros(<span class="dv">8</span>)</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true"></a>        v[i] <span class="op">=</span> x</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true"></a>        v[j] <span class="op">=</span> y</span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true"></a>        vertices.append(v)</span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true"></a></span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true"></a><span class="co"># our `vertices2` in R:</span></span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true"></a><span class="cf">for</span> v <span class="kw">in</span> product([<span class="op">-</span><span class="dv">1</span>, <span class="dv">1</span>], repeat <span class="op">=</span> <span class="dv">8</span>):</span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true"></a>    <span class="cf">if</span> <span class="bu">sum</span>(v) <span class="op">%</span> <span class="dv">4</span> <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true"></a>        vertices.append(v)</span></code></pre></div>
<p>Actually I’m not the author of this code (I will come back to this point later). I have a long experience with R and a short experience with Python, so for me the construction of the vertices is easier in R. But I have to be honest: the Python code is more elegant.</p>
<p>Now, the edges. In fact <strong>pycddlib</strong> is simply called <strong>cdd</strong> in Python:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true"></a><span class="im">import</span> cdd <span class="im">as</span> pcdd</span></code></pre></div>
<p>We want to do the so-called V-representation of the polytope (representation by the vertices), and then (I refer you to the documentation for this point), we have to prepend a <span class="math inline">\(1\)</span> to each vertex coordinates:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true"></a>vertices <span class="op">=</span> np.hstack((np.ones((<span class="dv">240</span>, <span class="dv">1</span>)), vertices))</span></code></pre></div>
<p>Now we’re ready for using <strong>pycddlib</strong>. Here is how I proceeded. I used the <code>get_input_adjacency</code> method to get the list of adjacent vertices for each vertex and from this list I constructed a two-columns matrix <code>Edges</code> to store the edges as pairs of vertex indices:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true"></a><span class="co"># make the polytope</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true"></a>mat <span class="op">=</span> pcdd.Matrix(vertices, linear <span class="op">=</span> <span class="va">False</span>, number_type <span class="op">=</span> <span class="st">&quot;fraction&quot;</span>) </span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true"></a>mat.rep_type <span class="op">=</span> pcdd.RepType.GENERATOR</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true"></a>poly <span class="op">=</span> pcdd.Polyhedron(mat)</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true"></a><span class="co"># get the list of adjacencies</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true"></a>adjacencies <span class="op">=</span> [<span class="bu">list</span>(x) <span class="cf">for</span> x <span class="kw">in</span> poly.get_input_adjacency()]</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true"></a><span class="co"># construct the matrix of edges</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true"></a>edges <span class="op">=</span> [<span class="va">None</span>]<span class="op">*</span><span class="dv">240</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true"></a><span class="cf">for</span> i, indices <span class="kw">in</span> <span class="bu">enumerate</span>(adjacencies):</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true"></a>    indices <span class="op">=</span> <span class="bu">list</span>(<span class="bu">filter</span>(<span class="kw">lambda</span> x: x<span class="op">&gt;</span>i, indices))</span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true"></a>    l <span class="op">=</span> <span class="bu">len</span>(indices)</span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true"></a>    col1 <span class="op">=</span> np.full((l, <span class="dv">1</span>), i)</span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true"></a>    indices <span class="op">=</span> np.reshape(indices, (l, <span class="dv">1</span>))</span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true"></a>    edges[i] <span class="op">=</span> np.hstack((col1, indices))</span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true"></a>Edges <span class="op">=</span> np.vstack(<span class="bu">tuple</span>(edges))</span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true"></a>np.savetxt(<span class="st">&quot;E8_edges.csv&quot;</span>, Edges, fmt <span class="op">=</span> <span class="st">&quot;</span><span class="sc">%d</span><span class="st">&quot;</span>, delimiter <span class="op">=</span> <span class="st">&quot;,&quot;</span>)</span></code></pre></div>
<p>I saved the edges matrix in a <strong>csv</strong> file to import it in R (don’t forget to add <span class="math inline">\(1\)</span> to the indices if you do that).</p>
<p>In the meantime, the author of the Julia library <strong>CDDLib.jl</strong> kindly replied to my feature request, and now the vertex adjacencies are available in this library.</p>
<h2 id="projection-on-the-coxeter-plane">Projection on the Coxeter plane</h2>
<p>That’s fine to have the vertices and the edges of a 8-dimensional polytope but it remains to project it in 2D or 3D if we want to visualize something. The most known figure of a projection of the E8 root polytope is the one of its projection to the so-called Coxeter plane. No luck, I didn’t find on the web how to do this projection. I found another one, <a href="https://theoryofeverything.org/theToE/2016/03/16/e8-in-e6-petrie-projection/">here</a>. The author of this article provides an orthonormal basis of a plane in the 8D space, and when one takes the two coordinates of the projections of the vertices on this plane, one gets this figure:</p>
<p><img src="figures/E8_Petrie.png" /></p>
<p>Not bad. Of course I did a GIF:</p>
<p><img src="figures/E8_Petrie.gif" /></p>
<p>Finally, I found the orthonormal basis of the Coxeter plane in a <a href="https://github.com/SuperJason/python/blob/96989d1681085a87a0d7f488d926a1677cd7041f/famous_math_graphics/e8.py">Python script on Github</a>.</p>
<p>Do you recognize the beginning of the code? The author of this script is also the author of the Python code I provided earlier. I was astonished: he doesn’t use any computational geometry library to get the edges! I don’t know why, but two vertices are connected by an edge if and only if the squared distance between these vertices is <span class="math inline">\(8\)</span>. So you get the edges like this in R:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true"></a>edges &lt;-<span class="st"> </span><span class="ot">NULL</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true"></a><span class="cf">for</span>(i <span class="cf">in</span> 1L<span class="op">:</span>(<span class="kw">nrow</span>(vertices)<span class="op">-</span>1L)){</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true"></a>  v1 &lt;-<span class="st"> </span>vertices[i, ]</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true"></a>  <span class="cf">for</span>(j <span class="cf">in</span> (i<span class="op">+</span>1L)<span class="op">:</span><span class="kw">nrow</span>(vertices)){</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true"></a>    v2 &lt;-<span class="st"> </span>vertices[j, ]</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true"></a>    <span class="cf">if</span>(<span class="kw">c</span>(<span class="kw">crossprod</span>(v1<span class="op">-</span>v2)) <span class="op">==</span><span class="st"> </span><span class="dv">8</span>){</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true"></a>      edges &lt;-<span class="st"> </span><span class="kw">rbind</span>(edges, <span class="kw">c</span>(i, j))</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true"></a>    }</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true"></a>  }</span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true"></a>}</span></code></pre></div>
<p>Also, I don’t understand the derivation of the basis of the Coxeter plane that is provided by this Python script. But it is easy to translate it in R. Here is the code, where I kept the comments of the Python script:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true"></a><span class="co"># A set of simple roots, listed by the rows of &#39;delta&#39;</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true"></a>delta &lt;-<span class="st"> </span><span class="kw">rbind</span>(</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true"></a>  <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">-1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>),</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true"></a>  <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">-1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>),</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true"></a>  <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">-1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>),</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true"></a>  <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">-1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>),</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true"></a>  <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">-1</span>, <span class="dv">0</span>, <span class="dv">0</span>),</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true"></a>  <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true"></a>  <span class="kw">c</span>(<span class="op">-</span>.<span class="dv">5</span>, <span class="fl">-.5</span>, <span class="fl">-.5</span>, <span class="fl">-.5</span>, <span class="fl">-.5</span>, <span class="fl">-.5</span>, <span class="fl">-.5</span>, <span class="fl">-.5</span>),</span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true"></a>  <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">-1</span>, <span class="dv">0</span>)</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true"></a>)</span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true"></a></span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true"></a><span class="co"># Dynkin diagram of E8:</span></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true"></a><span class="co"># 1---2---3---4---5---6---7</span></span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true"></a><span class="co">#                 |</span></span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true"></a><span class="co">#                 8</span></span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true"></a><span class="co"># where vertex i is the i-th simple root.</span></span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true"></a></span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true"></a><span class="co"># The Cartan matrix:</span></span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true"></a>Cartan &lt;-<span class="st"> </span><span class="kw">tcrossprod</span>(delta)</span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true"></a></span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true"></a><span class="co"># Now we split the simple roots into two disjoint sets I and J</span></span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true"></a><span class="co"># such that the simple roots in each set are pairwise orthogonal.</span></span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true"></a><span class="co"># It&#39;s obvious to see how to find such a partition given the</span></span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true"></a><span class="co"># Dynkin graph above: I = [1, 3, 5, 7] and J = [2, 4, 6, 8],</span></span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true"></a><span class="co"># since roots are not connected by an edge if and only if they are orthogonal.</span></span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true"></a><span class="co"># Then a basis of the Coxeter plane is given by</span></span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true"></a><span class="co"># u1 = sum (c[i] * delta[i]) for i in I,</span></span>
<span id="cb12-29"><a href="#cb12-29" aria-hidden="true"></a><span class="co"># u2 = sum (c[j] * delta[j]) for j in J,</span></span>
<span id="cb12-30"><a href="#cb12-30" aria-hidden="true"></a><span class="co"># where c is an eigenvector for the minimal</span></span>
<span id="cb12-31"><a href="#cb12-31" aria-hidden="true"></a><span class="co"># eigenvalue of the Cartan matrix.</span></span>
<span id="cb12-32"><a href="#cb12-32" aria-hidden="true"></a>eig &lt;-<span class="st"> </span><span class="kw">eigen</span>(Cartan)</span>
<span id="cb12-33"><a href="#cb12-33" aria-hidden="true"></a></span>
<span id="cb12-34"><a href="#cb12-34" aria-hidden="true"></a><span class="co"># The eigenvalues returned by eigen() are in descending order</span></span>
<span id="cb12-35"><a href="#cb12-35" aria-hidden="true"></a><span class="co"># and the eigenvectors are listed by columns.</span></span>
<span id="cb12-36"><a href="#cb12-36" aria-hidden="true"></a>ev &lt;-<span class="st"> </span>eig<span class="op">$</span>vectors[, 8L]</span>
<span id="cb12-37"><a href="#cb12-37" aria-hidden="true"></a>u1 &lt;-<span class="st"> </span><span class="kw">rowSums</span>(<span class="kw">vapply</span>(<span class="kw">c</span>(1L, 3L, 5L, 7L), <span class="cf">function</span>(i){</span>
<span id="cb12-38"><a href="#cb12-38" aria-hidden="true"></a>  ev[i] <span class="op">*</span><span class="st"> </span>delta[i, ]</span>
<span id="cb12-39"><a href="#cb12-39" aria-hidden="true"></a>}, <span class="kw">numeric</span>(8L)))</span>
<span id="cb12-40"><a href="#cb12-40" aria-hidden="true"></a>u2 &lt;-<span class="st"> </span><span class="kw">rowSums</span>(<span class="kw">vapply</span>(<span class="kw">c</span>(2L, 4L, 6L, 8L), <span class="cf">function</span>(i){</span>
<span id="cb12-41"><a href="#cb12-41" aria-hidden="true"></a>  ev[i] <span class="op">*</span><span class="st"> </span>delta[i, ]</span>
<span id="cb12-42"><a href="#cb12-42" aria-hidden="true"></a>}, <span class="kw">numeric</span>(8L)))</span>
<span id="cb12-43"><a href="#cb12-43" aria-hidden="true"></a></span>
<span id="cb12-44"><a href="#cb12-44" aria-hidden="true"></a><span class="co"># Gram-Schmidt u1, u2 </span></span>
<span id="cb12-45"><a href="#cb12-45" aria-hidden="true"></a>u1 &lt;-<span class="st"> </span>u1 <span class="op">/</span><span class="st"> </span><span class="kw">sqrt</span>(<span class="kw">c</span>(<span class="kw">crossprod</span>(u1)))</span>
<span id="cb12-46"><a href="#cb12-46" aria-hidden="true"></a>u2 &lt;-<span class="st"> </span>u2 <span class="op">-</span><span class="st"> </span><span class="kw">c</span>(<span class="kw">crossprod</span>(u1, u2)) <span class="op">*</span><span class="st"> </span>u1</span>
<span id="cb12-47"><a href="#cb12-47" aria-hidden="true"></a>u2 &lt;-<span class="st"> </span>u2 <span class="op">/</span><span class="st"> </span><span class="kw">sqrt</span>(<span class="kw">c</span>(<span class="kw">crossprod</span>(u2)))</span></code></pre></div>
<p>I understand nothing, except the Gram-Schmidt step.</p>
<p>But this works. Let’s project the vertices to the Coxeter plane, i.e. the plane with the orthonormal basis <span class="math inline">\((u_1, u_2)\)</span>:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true"></a><span class="co"># projections on the Coxeter plane</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true"></a>proj &lt;-<span class="st"> </span><span class="cf">function</span>(v){</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true"></a>  <span class="kw">c</span>(<span class="kw">c</span>(<span class="kw">crossprod</span>(v, u1)), <span class="kw">c</span>(<span class="kw">crossprod</span>(v, u2)))</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true"></a>}</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true"></a>points &lt;-<span class="st"> </span><span class="kw">t</span>(<span class="kw">apply</span>(vertices<span class="op">/</span><span class="dv">2</span>, 1L, proj))</span></code></pre></div>
<p>Now you can represent these 2D points and connect them with the edges. But if you do that with an ordinary base R plot, you will not get a pretty figure, because there are too many edges. So I do a SVG plot:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true"></a><span class="co"># save plot as SVG</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true"></a><span class="kw">svg</span>(<span class="dt">filename =</span> <span class="st">&quot;E8_Coxeter.svg&quot;</span>, <span class="dt">onefile =</span> <span class="ot">TRUE</span>)</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true"></a>opar &lt;-<span class="st"> </span><span class="kw">par</span>(<span class="dt">mar =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>))</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true"></a><span class="kw">plot</span>(</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true"></a>  points[<span class="op">!</span><span class="kw">duplicated</span>(points), ], <span class="dt">pch =</span> <span class="dv">19</span>, <span class="dt">cex =</span> <span class="fl">0.3</span>, <span class="dt">asp =</span> <span class="dv">1</span>, </span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true"></a>  <span class="dt">axes =</span> <span class="ot">FALSE</span>, <span class="dt">xlab =</span> <span class="ot">NA</span>, <span class="dt">ylab =</span> <span class="ot">NA</span></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true"></a>)</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true"></a><span class="cf">for</span>(i <span class="cf">in</span> 1L<span class="op">:</span><span class="kw">nrow</span>(edges)){</span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true"></a>  <span class="kw">lines</span>(points[edges[i, ], ], <span class="dt">lwd =</span> <span class="fl">0.1</span>)</span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true"></a>}</span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true"></a><span class="kw">par</span>(opar)</span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true"></a><span class="kw">dev.off</span>()</span></code></pre></div>
<p>And then I convert it to a PNG image with the help of the <strong>rsvg</strong> package:</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true"></a>rsvg<span class="op">::</span><span class="kw">rsvg_png</span>(<span class="st">&quot;E8_Coxeter.svg&quot;</span>, <span class="dt">file =</span> <span class="st">&quot;E8_Coxeter.png&quot;</span>)</span></code></pre></div>
<p>This gives this image:</p>
<p><img src="figures/E8_Coxeter.png" /></p>
<p>Rather pretty. But this lacks of colors. And of motion. Well, you see what I mean: I did a GIF.</p>
<p><img src="figures/E8_Coxeter.gif" /></p>
<p>If you want to know how I did this GIF, visit <a href="https://gist.github.com/stla/19529d44a20bab4420bdd1a213ebcdbc">my gist</a>.</p>
<p>In this gist, you will also find another basis for Coxeter plane. This one does not resort to eigenvectors. I found it in <a href="https://vixra.org/pdf/1411.0130v1.pdf">this paper</a>.</p>
<p>Consider the matrix <span class="math display">\[
H4_{\text{fold}} = 
\begin{pmatrix}
\varphi^2 &amp; 0 &amp; 0 &amp; 0 &amp; 1/\varphi &amp; 0 &amp; 0 &amp; 0 \\
0 &amp; 1 &amp; \varphi &amp; 0 &amp; 0 &amp; -1 &amp; \varphi &amp; 0 \\
0 &amp; \varphi &amp; 0 &amp; 1 &amp; 0 &amp; \varphi &amp; 0 &amp; -1 \\
0 &amp; 0 &amp; 1 &amp; \varphi &amp; 0 &amp; 0 &amp; -1 &amp; \varphi \\
1/\varphi &amp; 0 &amp; 0 &amp; 0 &amp; \varphi^2 &amp; 0 &amp; 0 &amp; 0 \\
0 &amp; -1 &amp; \varphi &amp; 0 &amp; 0 &amp; 1 &amp; \varphi &amp; 0 \\
0 &amp; \varphi &amp; 0 &amp; -1 &amp; 0 &amp; \varphi &amp; 0 &amp; 1 \\
0 &amp; 0 &amp; -1 &amp; \varphi &amp; 0 &amp; 0 &amp; 1 &amp; \varphi 
\end{pmatrix}
\]</span> where <span class="math inline">\(\varphi\)</span> is the golden number, and consider the two vectors <span class="math display">\[
x = \bigl(0, 2 \varphi \sin(\pi/30), 0, 1, 0, 0, 0, 0\bigr)
\]</span> and <span class="math display">\[
y = \bigl(2 \varphi \sin(\pi/15), 0, 2 \sin(2\pi/15), 0, 0, 0, 0, 0\bigr)
\]</span></p>
<p>Then the other basis of the Coxeter plane is given by the normalized columns of <span class="math inline">\(H4_{\text{fold}}^{-1}\begin{pmatrix}x &amp; y \end{pmatrix}\)</span>.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true"></a>phi &lt;-<span class="st"> </span>(<span class="dv">1</span> <span class="op">+</span><span class="st"> </span><span class="kw">sqrt</span>(<span class="dv">5</span>)) <span class="op">/</span><span class="st"> </span><span class="dv">2</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true"></a>H4fold &lt;-<span class="st"> </span><span class="kw">rbind</span>(</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true"></a>  <span class="kw">c</span>(phi<span class="op">^</span><span class="dv">2</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span><span class="op">/</span>phi, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>),</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true"></a>  <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">1</span>, phi, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">-1</span>, phi, <span class="dv">0</span>),</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true"></a>  <span class="kw">c</span>(<span class="dv">0</span>, phi, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>, phi, <span class="dv">0</span>, <span class="dv">-1</span>),</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true"></a>  <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, phi, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">-1</span>, phi),</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true"></a>  <span class="kw">c</span>(<span class="dv">1</span><span class="op">/</span>phi, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, phi<span class="op">^</span><span class="dv">2</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>),</span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true"></a>  <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">-1</span>, phi, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, phi, <span class="dv">0</span>),</span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true"></a>  <span class="kw">c</span>(<span class="dv">0</span>, phi, <span class="dv">0</span>, <span class="dv">-1</span>, <span class="dv">0</span>, phi, <span class="dv">0</span>, <span class="dv">1</span>),</span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true"></a>  <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">-1</span>, phi, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, phi)</span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true"></a>)</span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true"></a>x &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">2</span><span class="op">*</span>phi<span class="op">*</span><span class="kw">sin</span>(pi<span class="op">/</span><span class="dv">30</span>), <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>)</span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true"></a>y &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">2</span><span class="op">*</span>phi<span class="op">*</span><span class="kw">sin</span>(pi<span class="op">/</span><span class="dv">15</span>), <span class="dv">0</span>, <span class="dv">2</span><span class="op">*</span><span class="kw">sin</span>(<span class="dv">2</span><span class="op">*</span>pi<span class="op">/</span><span class="dv">15</span>), <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>)</span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true"></a>XY &lt;-<span class="st"> </span><span class="kw">solve</span>(H4fold) <span class="op">%*%</span><span class="st"> </span><span class="kw">cbind</span>(x, y)</span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true"></a>X &lt;-<span class="st"> </span>XY[, 1L]; Y &lt;-<span class="st"> </span>XY[, 2L]</span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true"></a>X &lt;-<span class="st"> </span>X <span class="op">/</span><span class="st"> </span><span class="kw">sqrt</span>(<span class="kw">c</span>(<span class="kw">crossprod</span>(X)))</span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true"></a>Y &lt;-<span class="st"> </span>Y <span class="op">/</span><span class="st"> </span><span class="kw">sqrt</span>(<span class="kw">c</span>(<span class="kw">crossprod</span>(Y)))</span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true"></a><span class="co"># projections on the plane</span></span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true"></a>proj &lt;-<span class="st"> </span><span class="cf">function</span>(v){</span>
<span id="cb16-20"><a href="#cb16-20" aria-hidden="true"></a>  <span class="kw">c</span>(<span class="kw">c</span>(<span class="kw">crossprod</span>(v, X)), <span class="kw">c</span>(<span class="kw">crossprod</span>(v, Y)))</span>
<span id="cb16-21"><a href="#cb16-21" aria-hidden="true"></a>}</span>
<span id="cb16-22"><a href="#cb16-22" aria-hidden="true"></a>points &lt;-<span class="st"> </span><span class="kw">t</span>(<span class="kw">apply</span>(vertices<span class="op">/</span><span class="dv">2</span>, 1L, proj))</span></code></pre></div>
<p>Below I show how to do a plot with colors, by assigning to each edge a color depending on the lengths of the two vertices of this edge.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true"></a><span class="co"># make colors ####</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true"></a>norms2 &lt;-<span class="st"> </span><span class="kw">unique</span>(<span class="kw">round</span>(<span class="kw">apply</span>(points, 1L, crossprod), 2L))</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true"></a>grd &lt;-<span class="st"> </span><span class="kw">as.matrix</span>(<span class="kw">expand.grid</span>(norms2, norms2))</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true"></a>grd &lt;-<span class="st"> </span>grd[grd[, 1L] <span class="op">&lt;=</span><span class="st"> </span>grd[, 2L], ]</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true"></a>pairs &lt;-<span class="st"> </span><span class="kw">apply</span>(grd, 1L, paste0, <span class="dt">collapse =</span> <span class="st">&quot;-&quot;</span>)</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true"></a>colors &lt;-<span class="st"> </span>viridisLite<span class="op">::</span><span class="kw">cividis</span>(<span class="kw">length</span>(pairs))</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true"></a>colors &lt;-<span class="st"> </span>colorspace<span class="op">::</span><span class="kw">darken</span>(colors, <span class="dt">amount =</span> <span class="fl">0.25</span>)</span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true"></a><span class="kw">names</span>(colors) &lt;-<span class="st"> </span>pairs</span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true"></a><span class="co"># save plot as SVG with colors</span></span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true"></a><span class="kw">svg</span>(<span class="dt">filename =</span> <span class="st">&quot;E8_Coxeter_other_basis.svg&quot;</span>, <span class="dt">onefile =</span> <span class="ot">TRUE</span>)</span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true"></a>opar &lt;-<span class="st"> </span><span class="kw">par</span>(<span class="dt">mar =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>))</span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true"></a><span class="kw">plot</span>(</span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true"></a>  points[<span class="op">!</span><span class="kw">duplicated</span>(points), ], <span class="dt">pch =</span> <span class="dv">19</span>, <span class="dt">cex =</span> <span class="fl">0.3</span>, <span class="dt">asp =</span> <span class="dv">1</span>, </span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true"></a>  <span class="dt">axes =</span> <span class="ot">FALSE</span>, <span class="dt">xlab =</span> <span class="ot">NA</span>, <span class="dt">ylab =</span> <span class="ot">NA</span></span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true"></a>)</span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true"></a><span class="cf">for</span>(i <span class="cf">in</span> 1L<span class="op">:</span><span class="kw">nrow</span>(edges)){</span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true"></a>  twopoints &lt;-<span class="st"> </span>points[edges[i, ], ]</span>
<span id="cb17-18"><a href="#cb17-18" aria-hidden="true"></a>  pair &lt;-<span class="st"> </span><span class="kw">paste0</span>(<span class="kw">round</span>(</span>
<span id="cb17-19"><a href="#cb17-19" aria-hidden="true"></a>    <span class="kw">sort</span>(<span class="kw">apply</span>(twopoints, 1L, crossprod)), 2L</span>
<span id="cb17-20"><a href="#cb17-20" aria-hidden="true"></a>  ), <span class="dt">collapse =</span> <span class="st">&quot;-&quot;</span>)</span>
<span id="cb17-21"><a href="#cb17-21" aria-hidden="true"></a>  <span class="kw">lines</span>(twopoints, <span class="dt">lwd =</span> <span class="fl">0.1</span>, <span class="dt">col =</span> colors[pair])</span>
<span id="cb17-22"><a href="#cb17-22" aria-hidden="true"></a>}</span>
<span id="cb17-23"><a href="#cb17-23" aria-hidden="true"></a><span class="kw">par</span>(opar)</span>
<span id="cb17-24"><a href="#cb17-24" aria-hidden="true"></a><span class="kw">dev.off</span>()</span>
<span id="cb17-25"><a href="#cb17-25" aria-hidden="true"></a><span class="co"># convert to PNG</span></span>
<span id="cb17-26"><a href="#cb17-26" aria-hidden="true"></a>rsvg<span class="op">::</span><span class="kw">rsvg_png</span>(</span>
<span id="cb17-27"><a href="#cb17-27" aria-hidden="true"></a>  <span class="st">&quot;E8_Coxeter_other_basis.svg&quot;</span>, <span class="dt">file =</span> <span class="st">&quot;E8_Coxeter_other_basis.png&quot;</span></span>
<span id="cb17-28"><a href="#cb17-28" aria-hidden="true"></a>)</span></code></pre></div>
<p><img src="figures/E8_Coxeter_other_basis.png" /></p>
<p>If this post pleased you, you might also be interested in <a href="https://gist.github.com/stla/2ed8d9f107ce3ae311ed365e83d66dbd">this gist</a>, which deals with the projection to a Coxeter plane of the so-called *600-cell° polytope. I even provide a hyperbolic version:</p>
<p><img src="figures/H4_600-cell_hyperbolic.png" /></p>

        </div>


        <div id="footer">
          Site proudly generated by
          <a href="http://jaspervdj.be/hakyll">Hakyll</a>
        </div>

      </div>

    </div>

    <div class="row">
      <div class="col-sm-12">
        <div id="disqus_thread"></div>
        <div class="pagination">
          <ul>
            <li>
              <a href="http://laustep.github.io/stlahblog/">&#171; Back Home</a>
            </li>
          </ul>
        </div>
      </div>
    </div>
    
  </div>

</body>

<script src="/libraries/bootstrap/bootstrap.min.js"></script>
<script>
  var disqus_developer = 1;
  var disqus_shortname = 'stlapblog';
  // required: replace example with your forum shortname
  /* * * DON'T EDIT BELOW THIS LINE * * */
  (function () {
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = 'https://' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] ||
      document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>
<noscript>Please enable JavaScript to view the
  <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a>
</noscript>
<!-- MathJax: Fall back to local if CDN offline but local image fonts are not supported (saves >100MB) -->
<script type="text/x-mathjax-config" src="/libraries/mathjax/config/TeX-MML-AM_CHTML.js"></script>
<!-- <script>
  window.MathJax || document.write('<script type="text/x-mathjax-config">MathJax.Hub.Config({"HTML-CSS":{imageFont:null}});<\/script><script src="../libraries/mathjax/MathJax.js"><\/script>');
</script> -->


</html>]]></description>
    <pubDate>Mon, 14 Mar 2022 00:00:00 UT</pubDate>
    <guid>https://laustep.github.io/stlahblog/posts/E8rootPolytope.html</guid>
    <dc:creator>Stéphane Laurent</dc:creator>
    <category>R</category>
</item>


<item>
    <title>The modified stereographic projection</title>
    <link>https://laustep.github.io/stlahblog/posts/ModifiedStereographicProjection.html</link>
    <description><![CDATA[<!DOCTYPE HTML>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Saturn Elephant - The modified stereographic projection</title>
  <link href="/libraries/bootstrap/bootstrap-grid.min.css" rel="stylesheet">
  <link rel="stylesheet" href="/css/default2.css" />
  <link rel="stylesheet" href="/css/post.css" />
  <link rel="stylesheet" href="/css/misc.css" /> 
  
    <link rel="stylesheet" href="/css/pandoc-solarized.css" /> 
   
  
  <link href="https://fonts.googleapis.com/css?family=Raleway:400,600,200,800" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/css?family=Droid+Sans" rel="stylesheet" type="text/css">
  <script src="/libraries/jquery.min.js"></script>
  <script type="text/javascript" async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML"></script>
</head>

<body>
  <div class="container-fluid">
    <div class="row">
      <!-- Sidebar. -->
      <div class="sidebar col-sm-2">
        <div class="row">
          <div class="col-sm-12" style="float:right;clear:both;margin-right:50px;margin-top:50px;">
            <a href="https://www.r-bloggers.com/">
              <img src="/images/Rbloggers.png" alt="Rbloggers" width="100%" />
            </a>
            <br/>
            <a href="http://t-redactyl.io/">
              <span style="color:black;font-weight:bold;font-family:sans-serif;font-size:25px;">Standard error</span>
            </a>
            <a href="http://timelyportfolio.blogspot.be/">
              <span style="color:grey;font-weight:bold;font-family:sans-serif;font-size:24px;">Timely portfolio</span>
            </a>
            <br/>
            <a href="https://antoineguillot.wordpress.com/blog/">
              <span style="color:white;background-color:darkblue;font-weight:bold;font-family:sans-serif;font-size:21px;border:5px solid;border-color:darkblue">ENHANCE DATA</span>
            </a>
            <br/>
            <a href="https://fronkonstin.com/">
              <span style="color:black;background-color:gold;font-weight:bold;font-size:29px;border:3px solid;border-color:gold;">Fronkonstin</span>
            </a>
          </div>
        </div>
        <div id="logos">
          <div class="row">
            <div class="col-sm-4">
              <img src="/images/AsymptoteLogo.svg" style="width: 150%; transform: rotateZ(-35deg)"/>
            </div>
            <div class="col-sm-4">
              <img src="/images/Rlogo.svg" style="width: 110%;"/>
            </div>
            <div class="col-sm-4">
              <img src="/images/shiny-hex.png" style="width: 90%;"/>
            </div>
          </div>
          <div class="row">
            <div class="col-sm-4">
              <img src="/images/Povray_logo_sphere.png" style="width: 105%;"/>
            </div>
            <div class="col-sm-4">
              <img src="/images/javascript.svg" style="width: 90%;"/>
            </div>
            <div class="col-sm-4">
              <img src="/images/haskell.svg" style="width: 110%;"/>
            </div>
          </div>
        </div>
      </div>

      <div class="main col-sm-10">
        <div id="header">
          <div id="logo">
            <a href="/">
              <img src="/images/stla.jpg" alt="stla" width="100px" />
            </a>
          </div>
          <div id="navigation" style="margin-top:50px;">
            <a href="/">Home</a>
            <a href="/about.html">About</a>
            <a href="/contact.html">Contact</a>
            <a href="/archive.html">Archive</a>
          </div>
        </div>

        <div class="content">
          <h1>The modified stereographic projection</h1> 
          <div class="info">
    Posted on March  1, 2022
    
        by Stéphane Laurent
    
</div>
<div class="info">
    
    Tags: <a title="All pages tagged &#39;R&#39;." href="/tags/R.html">R</a>, <a title="All pages tagged &#39;rgl&#39;." href="/tags/rgl.html">rgl</a>, <a title="All pages tagged &#39;misc3d&#39;." href="/tags/misc3d.html">misc3d</a>, <a title="All pages tagged &#39;graphics&#39;." href="/tags/graphics.html">graphics</a>, <a title="All pages tagged &#39;geometry&#39;." href="/tags/geometry.html">geometry</a>, <a title="All pages tagged &#39;maths&#39;." href="/tags/maths.html">maths</a>
    
</div>

<p>Some of my 3D animations start with a 4D object (such as a polytope) and I project it to the three-dimensional space with a stereographic projection. For example, the <a href="https://laustep.github.io/stlahblog/posts/HyperbolicGircope.html">hyperbolic gircope</a>. For this animation, I use the ordinary stereographic projection. But sometimes I don’t get a nice result with the ordinary stereographic projection, and then I use a “modified” stereographic projection, defined by <span class="math display">\[
\text{Stereo}_\gamma(x) = 
\frac{\arccos(x_4/r)}{{\bigl(r^\gamma - {|x_4|}^\gamma\bigr)}^{\frac{1}{\gamma}}}
\times (x_1, x_2, x_3),
\]</span> where <span class="math inline">\(r\)</span> is the radius of the centered sphere in <span class="math inline">\(\mathbb{R}^4\)</span> that we consider (for example <span class="math inline">\(r = \Vert x \Vert\)</span> for a polytope whose all vertices have the same norm, otherwise one can take the higher norm).</p>
<p>In this post, I will show the result of this modified stereographic projection on some examples, with various values of <span class="math inline">\(\gamma\)</span>.</p>
<h2 id="truncated-tesseract">Truncated tesseract</h2>
<div class="sourceCode" id="cb1"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a><span class="kw">library</span>(cxhull)</span>
<span id="cb1-2"><a href="#cb1-2"></a></span>
<span id="cb1-3"><a href="#cb1-3"></a><span class="co"># Stereographic-like projection ####</span></span>
<span id="cb1-4"><a href="#cb1-4"></a>sproj &lt;-<span class="st"> </span><span class="cf">function</span>(v, r, gamma){</span>
<span id="cb1-5"><a href="#cb1-5"></a>  <span class="kw">acos</span>(v[4L]<span class="op">/</span>r) <span class="op">/</span><span class="st"> </span>(r<span class="op">^</span>gamma <span class="op">-</span><span class="st"> </span><span class="kw">abs</span>(v[4L])<span class="op">^</span>gamma)<span class="op">^</span>(<span class="dv">1</span><span class="op">/</span>gamma) <span class="op">*</span><span class="st"> </span>v[1L<span class="op">:</span>3L]</span>
<span id="cb1-6"><a href="#cb1-6"></a>}</span>
<span id="cb1-7"><a href="#cb1-7"></a></span>
<span id="cb1-8"><a href="#cb1-8"></a><span class="co"># vertices ####</span></span>
<span id="cb1-9"><a href="#cb1-9"></a>sqr2p1 &lt;-<span class="st"> </span><span class="kw">sqrt</span>(<span class="dv">2</span>) <span class="op">+</span><span class="st"> </span><span class="dv">1</span></span>
<span id="cb1-10"><a href="#cb1-10"></a>vertices &lt;-<span class="st"> </span><span class="kw">rbind</span>(</span>
<span id="cb1-11"><a href="#cb1-11"></a>  <span class="kw">c</span>(      <span class="dv">-1</span>, <span class="op">-</span>sqr2p1, <span class="op">-</span>sqr2p1, <span class="op">-</span>sqr2p1 ),</span>
<span id="cb1-12"><a href="#cb1-12"></a>  <span class="kw">c</span>(      <span class="dv">-1</span>, <span class="op">-</span>sqr2p1, <span class="op">-</span>sqr2p1,  sqr2p1 ),</span>
<span id="cb1-13"><a href="#cb1-13"></a>  <span class="kw">c</span>(      <span class="dv">-1</span>, <span class="op">-</span>sqr2p1,  sqr2p1, <span class="op">-</span>sqr2p1 ),</span>
<span id="cb1-14"><a href="#cb1-14"></a>  <span class="kw">c</span>(      <span class="dv">-1</span>, <span class="op">-</span>sqr2p1,  sqr2p1,  sqr2p1 ),</span>
<span id="cb1-15"><a href="#cb1-15"></a>  <span class="kw">c</span>(      <span class="dv">-1</span>,  sqr2p1, <span class="op">-</span>sqr2p1, <span class="op">-</span>sqr2p1 ),</span>
<span id="cb1-16"><a href="#cb1-16"></a>  <span class="kw">c</span>(      <span class="dv">-1</span>,  sqr2p1, <span class="op">-</span>sqr2p1,  sqr2p1 ),</span>
<span id="cb1-17"><a href="#cb1-17"></a>  <span class="kw">c</span>(      <span class="dv">-1</span>,  sqr2p1,  sqr2p1, <span class="op">-</span>sqr2p1 ),</span>
<span id="cb1-18"><a href="#cb1-18"></a>  <span class="kw">c</span>(      <span class="dv">-1</span>,  sqr2p1,  sqr2p1,  sqr2p1 ),</span>
<span id="cb1-19"><a href="#cb1-19"></a>  <span class="kw">c</span>(       <span class="dv">1</span>, <span class="op">-</span>sqr2p1, <span class="op">-</span>sqr2p1, <span class="op">-</span>sqr2p1 ),</span>
<span id="cb1-20"><a href="#cb1-20"></a>  <span class="kw">c</span>(       <span class="dv">1</span>, <span class="op">-</span>sqr2p1, <span class="op">-</span>sqr2p1,  sqr2p1 ),</span>
<span id="cb1-21"><a href="#cb1-21"></a>  <span class="kw">c</span>(       <span class="dv">1</span>, <span class="op">-</span>sqr2p1,  sqr2p1, <span class="op">-</span>sqr2p1 ),</span>
<span id="cb1-22"><a href="#cb1-22"></a>  <span class="kw">c</span>(       <span class="dv">1</span>, <span class="op">-</span>sqr2p1,  sqr2p1,  sqr2p1 ),</span>
<span id="cb1-23"><a href="#cb1-23"></a>  <span class="kw">c</span>(       <span class="dv">1</span>,  sqr2p1, <span class="op">-</span>sqr2p1, <span class="op">-</span>sqr2p1 ),</span>
<span id="cb1-24"><a href="#cb1-24"></a>  <span class="kw">c</span>(       <span class="dv">1</span>,  sqr2p1, <span class="op">-</span>sqr2p1,  sqr2p1 ),</span>
<span id="cb1-25"><a href="#cb1-25"></a>  <span class="kw">c</span>(       <span class="dv">1</span>,  sqr2p1,  sqr2p1, <span class="op">-</span>sqr2p1 ),</span>
<span id="cb1-26"><a href="#cb1-26"></a>  <span class="kw">c</span>(       <span class="dv">1</span>,  sqr2p1,  sqr2p1,  sqr2p1 ),</span>
<span id="cb1-27"><a href="#cb1-27"></a>  <span class="kw">c</span>( <span class="op">-</span>sqr2p1,      <span class="dv">-1</span>, <span class="op">-</span>sqr2p1, <span class="op">-</span>sqr2p1 ),</span>
<span id="cb1-28"><a href="#cb1-28"></a>  <span class="kw">c</span>( <span class="op">-</span>sqr2p1,      <span class="dv">-1</span>, <span class="op">-</span>sqr2p1,  sqr2p1 ),</span>
<span id="cb1-29"><a href="#cb1-29"></a>  <span class="kw">c</span>( <span class="op">-</span>sqr2p1,      <span class="dv">-1</span>,  sqr2p1, <span class="op">-</span>sqr2p1 ),</span>
<span id="cb1-30"><a href="#cb1-30"></a>  <span class="kw">c</span>( <span class="op">-</span>sqr2p1,      <span class="dv">-1</span>,  sqr2p1,  sqr2p1 ),</span>
<span id="cb1-31"><a href="#cb1-31"></a>  <span class="kw">c</span>( <span class="op">-</span>sqr2p1,       <span class="dv">1</span>, <span class="op">-</span>sqr2p1, <span class="op">-</span>sqr2p1 ),</span>
<span id="cb1-32"><a href="#cb1-32"></a>  <span class="kw">c</span>( <span class="op">-</span>sqr2p1,       <span class="dv">1</span>, <span class="op">-</span>sqr2p1,  sqr2p1 ),</span>
<span id="cb1-33"><a href="#cb1-33"></a>  <span class="kw">c</span>( <span class="op">-</span>sqr2p1,       <span class="dv">1</span>,  sqr2p1, <span class="op">-</span>sqr2p1 ),</span>
<span id="cb1-34"><a href="#cb1-34"></a>  <span class="kw">c</span>( <span class="op">-</span>sqr2p1,       <span class="dv">1</span>,  sqr2p1,  sqr2p1 ),</span>
<span id="cb1-35"><a href="#cb1-35"></a>  <span class="kw">c</span>(  sqr2p1,      <span class="dv">-1</span>, <span class="op">-</span>sqr2p1, <span class="op">-</span>sqr2p1 ),</span>
<span id="cb1-36"><a href="#cb1-36"></a>  <span class="kw">c</span>(  sqr2p1,      <span class="dv">-1</span>, <span class="op">-</span>sqr2p1,  sqr2p1 ),</span>
<span id="cb1-37"><a href="#cb1-37"></a>  <span class="kw">c</span>(  sqr2p1,      <span class="dv">-1</span>,  sqr2p1, <span class="op">-</span>sqr2p1 ),</span>
<span id="cb1-38"><a href="#cb1-38"></a>  <span class="kw">c</span>(  sqr2p1,      <span class="dv">-1</span>,  sqr2p1,  sqr2p1 ),</span>
<span id="cb1-39"><a href="#cb1-39"></a>  <span class="kw">c</span>(  sqr2p1,       <span class="dv">1</span>, <span class="op">-</span>sqr2p1, <span class="op">-</span>sqr2p1 ),</span>
<span id="cb1-40"><a href="#cb1-40"></a>  <span class="kw">c</span>(  sqr2p1,       <span class="dv">1</span>, <span class="op">-</span>sqr2p1,  sqr2p1 ),</span>
<span id="cb1-41"><a href="#cb1-41"></a>  <span class="kw">c</span>(  sqr2p1,       <span class="dv">1</span>,  sqr2p1, <span class="op">-</span>sqr2p1 ),</span>
<span id="cb1-42"><a href="#cb1-42"></a>  <span class="kw">c</span>(  sqr2p1,       <span class="dv">1</span>,  sqr2p1,  sqr2p1 ),</span>
<span id="cb1-43"><a href="#cb1-43"></a>  <span class="kw">c</span>( <span class="op">-</span>sqr2p1, <span class="op">-</span>sqr2p1,      <span class="dv">-1</span>, <span class="op">-</span>sqr2p1 ),</span>
<span id="cb1-44"><a href="#cb1-44"></a>  <span class="kw">c</span>( <span class="op">-</span>sqr2p1, <span class="op">-</span>sqr2p1,      <span class="dv">-1</span>,  sqr2p1 ),</span>
<span id="cb1-45"><a href="#cb1-45"></a>  <span class="kw">c</span>( <span class="op">-</span>sqr2p1, <span class="op">-</span>sqr2p1,       <span class="dv">1</span>, <span class="op">-</span>sqr2p1 ),</span>
<span id="cb1-46"><a href="#cb1-46"></a>  <span class="kw">c</span>( <span class="op">-</span>sqr2p1, <span class="op">-</span>sqr2p1,       <span class="dv">1</span>,  sqr2p1 ),</span>
<span id="cb1-47"><a href="#cb1-47"></a>  <span class="kw">c</span>( <span class="op">-</span>sqr2p1,  sqr2p1,      <span class="dv">-1</span>, <span class="op">-</span>sqr2p1 ),</span>
<span id="cb1-48"><a href="#cb1-48"></a>  <span class="kw">c</span>( <span class="op">-</span>sqr2p1,  sqr2p1,      <span class="dv">-1</span>,  sqr2p1 ),</span>
<span id="cb1-49"><a href="#cb1-49"></a>  <span class="kw">c</span>( <span class="op">-</span>sqr2p1,  sqr2p1,       <span class="dv">1</span>, <span class="op">-</span>sqr2p1 ),</span>
<span id="cb1-50"><a href="#cb1-50"></a>  <span class="kw">c</span>( <span class="op">-</span>sqr2p1,  sqr2p1,       <span class="dv">1</span>,  sqr2p1 ),</span>
<span id="cb1-51"><a href="#cb1-51"></a>  <span class="kw">c</span>(  sqr2p1, <span class="op">-</span>sqr2p1,      <span class="dv">-1</span>, <span class="op">-</span>sqr2p1 ),</span>
<span id="cb1-52"><a href="#cb1-52"></a>  <span class="kw">c</span>(  sqr2p1, <span class="op">-</span>sqr2p1,      <span class="dv">-1</span>,  sqr2p1 ),</span>
<span id="cb1-53"><a href="#cb1-53"></a>  <span class="kw">c</span>(  sqr2p1, <span class="op">-</span>sqr2p1,       <span class="dv">1</span>, <span class="op">-</span>sqr2p1 ),</span>
<span id="cb1-54"><a href="#cb1-54"></a>  <span class="kw">c</span>(  sqr2p1, <span class="op">-</span>sqr2p1,       <span class="dv">1</span>,  sqr2p1 ),</span>
<span id="cb1-55"><a href="#cb1-55"></a>  <span class="kw">c</span>(  sqr2p1,  sqr2p1,      <span class="dv">-1</span>, <span class="op">-</span>sqr2p1 ),</span>
<span id="cb1-56"><a href="#cb1-56"></a>  <span class="kw">c</span>(  sqr2p1,  sqr2p1,      <span class="dv">-1</span>,  sqr2p1 ),</span>
<span id="cb1-57"><a href="#cb1-57"></a>  <span class="kw">c</span>(  sqr2p1,  sqr2p1,       <span class="dv">1</span>, <span class="op">-</span>sqr2p1 ),</span>
<span id="cb1-58"><a href="#cb1-58"></a>  <span class="kw">c</span>(  sqr2p1,  sqr2p1,       <span class="dv">1</span>,  sqr2p1 ),</span>
<span id="cb1-59"><a href="#cb1-59"></a>  <span class="kw">c</span>( <span class="op">-</span>sqr2p1, <span class="op">-</span>sqr2p1, <span class="op">-</span>sqr2p1,      <span class="dv">-1</span> ),</span>
<span id="cb1-60"><a href="#cb1-60"></a>  <span class="kw">c</span>( <span class="op">-</span>sqr2p1, <span class="op">-</span>sqr2p1, <span class="op">-</span>sqr2p1,       <span class="dv">1</span> ),</span>
<span id="cb1-61"><a href="#cb1-61"></a>  <span class="kw">c</span>( <span class="op">-</span>sqr2p1, <span class="op">-</span>sqr2p1,  sqr2p1,      <span class="dv">-1</span> ),</span>
<span id="cb1-62"><a href="#cb1-62"></a>  <span class="kw">c</span>( <span class="op">-</span>sqr2p1, <span class="op">-</span>sqr2p1,  sqr2p1,       <span class="dv">1</span> ),</span>
<span id="cb1-63"><a href="#cb1-63"></a>  <span class="kw">c</span>( <span class="op">-</span>sqr2p1,  sqr2p1, <span class="op">-</span>sqr2p1,      <span class="dv">-1</span> ),</span>
<span id="cb1-64"><a href="#cb1-64"></a>  <span class="kw">c</span>( <span class="op">-</span>sqr2p1,  sqr2p1, <span class="op">-</span>sqr2p1,       <span class="dv">1</span> ),</span>
<span id="cb1-65"><a href="#cb1-65"></a>  <span class="kw">c</span>( <span class="op">-</span>sqr2p1,  sqr2p1,  sqr2p1,      <span class="dv">-1</span> ),</span>
<span id="cb1-66"><a href="#cb1-66"></a>  <span class="kw">c</span>( <span class="op">-</span>sqr2p1,  sqr2p1,  sqr2p1,       <span class="dv">1</span> ),</span>
<span id="cb1-67"><a href="#cb1-67"></a>  <span class="kw">c</span>(  sqr2p1, <span class="op">-</span>sqr2p1, <span class="op">-</span>sqr2p1,      <span class="dv">-1</span> ),</span>
<span id="cb1-68"><a href="#cb1-68"></a>  <span class="kw">c</span>(  sqr2p1, <span class="op">-</span>sqr2p1, <span class="op">-</span>sqr2p1,       <span class="dv">1</span> ),</span>
<span id="cb1-69"><a href="#cb1-69"></a>  <span class="kw">c</span>(  sqr2p1, <span class="op">-</span>sqr2p1,  sqr2p1,      <span class="dv">-1</span> ),</span>
<span id="cb1-70"><a href="#cb1-70"></a>  <span class="kw">c</span>(  sqr2p1, <span class="op">-</span>sqr2p1,  sqr2p1,       <span class="dv">1</span> ),</span>
<span id="cb1-71"><a href="#cb1-71"></a>  <span class="kw">c</span>(  sqr2p1,  sqr2p1, <span class="op">-</span>sqr2p1,      <span class="dv">-1</span> ),</span>
<span id="cb1-72"><a href="#cb1-72"></a>  <span class="kw">c</span>(  sqr2p1,  sqr2p1, <span class="op">-</span>sqr2p1,       <span class="dv">1</span> ),</span>
<span id="cb1-73"><a href="#cb1-73"></a>  <span class="kw">c</span>(  sqr2p1,  sqr2p1,  sqr2p1,      <span class="dv">-1</span> ),</span>
<span id="cb1-74"><a href="#cb1-74"></a>  <span class="kw">c</span>(  sqr2p1,  sqr2p1,  sqr2p1,       <span class="dv">1</span> )</span>
<span id="cb1-75"><a href="#cb1-75"></a>)</span>
<span id="cb1-76"><a href="#cb1-76"></a></span>
<span id="cb1-77"><a href="#cb1-77"></a><span class="co"># convex hull (= truncated tesseract, cause it is convex) ####</span></span>
<span id="cb1-78"><a href="#cb1-78"></a>hull &lt;-<span class="st"> </span><span class="kw">cxhull</span>(vertices)</span>
<span id="cb1-79"><a href="#cb1-79"></a>edges  &lt;-<span class="st"> </span>hull[[<span class="st">&quot;edges&quot;</span>]]</span>
<span id="cb1-80"><a href="#cb1-80"></a>ridges &lt;-<span class="st"> </span>hull[[<span class="st">&quot;ridges&quot;</span>]]</span>
<span id="cb1-81"><a href="#cb1-81"></a></span>
<span id="cb1-82"><a href="#cb1-82"></a><span class="co"># triangles (of the tetrahedra in the corners) ####</span></span>
<span id="cb1-83"><a href="#cb1-83"></a>ridgeSizes &lt;-<span class="st"> </span><span class="kw">vapply</span>(ridges, <span class="cf">function</span>(ridge){</span>
<span id="cb1-84"><a href="#cb1-84"></a>  <span class="kw">length</span>(ridge[[<span class="st">&quot;vertices&quot;</span>]])</span>
<span id="cb1-85"><a href="#cb1-85"></a>}, <span class="kw">integer</span>(1L))</span>
<span id="cb1-86"><a href="#cb1-86"></a>triangles &lt;-<span class="st"> </span><span class="kw">t</span>(<span class="kw">vapply</span>(</span>
<span id="cb1-87"><a href="#cb1-87"></a>  ridges[ridgeSizes <span class="op">==</span><span class="st"> </span>3L], </span>
<span id="cb1-88"><a href="#cb1-88"></a>  <span class="cf">function</span>(ridge) ridge[[<span class="st">&quot;vertices&quot;</span>]],</span>
<span id="cb1-89"><a href="#cb1-89"></a>  <span class="kw">integer</span>(3L)</span>
<span id="cb1-90"><a href="#cb1-90"></a>))</span>
<span id="cb1-91"><a href="#cb1-91"></a></span>
<span id="cb1-92"><a href="#cb1-92"></a><span class="co"># projected vertices ####</span></span>
<span id="cb1-93"><a href="#cb1-93"></a><span class="co">#   we also normalize them so that the higher norm is 1</span></span>
<span id="cb1-94"><a href="#cb1-94"></a>r &lt;-<span class="st"> </span><span class="kw">sqrt</span>(<span class="dv">1</span> <span class="op">+</span><span class="st"> </span><span class="dv">3</span><span class="op">*</span>sqr2p1<span class="op">^</span><span class="dv">2</span>)</span>
<span id="cb1-95"><a href="#cb1-95"></a>verts3D &lt;-<span class="st"> </span><span class="cf">function</span>(gamma){</span>
<span id="cb1-96"><a href="#cb1-96"></a>  verts &lt;-<span class="st"> </span><span class="kw">t</span>(<span class="kw">apply</span>(vertices, 1L, <span class="cf">function</span>(v) <span class="kw">sproj</span>(v, r, gamma)))</span>
<span id="cb1-97"><a href="#cb1-97"></a>  verts <span class="op">/</span><span class="st"> </span><span class="kw">sqrt</span>(<span class="kw">max</span>(<span class="kw">apply</span>(verts, 1L, crossprod)))</span>
<span id="cb1-98"><a href="#cb1-98"></a>}</span></code></pre></div>
<p>Below is the code for the animation (<span class="math inline">\(\gamma\)</span> varies from <span class="math inline">\(1.5\)</span> to <span class="math inline">\(2.5\)</span>). I use <a href="https://laustep.github.io/stlahblog/posts/gifskiBash.html">my ‘gifski’ batch command</a> to make the GIF.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1"></a><span class="kw">library</span>(rgl)</span>
<span id="cb2-2"><a href="#cb2-2"></a>gamma_ &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="fl">1.5</span>, <span class="fl">2.5</span>, <span class="dt">by =</span> <span class="fl">0.025</span>)</span>
<span id="cb2-3"><a href="#cb2-3"></a><span class="kw">open3d</span>(<span class="dt">windowRect =</span> <span class="kw">c</span>(<span class="dv">100</span>, <span class="dv">100</span>, <span class="dv">612</span>, <span class="dv">612</span>))</span>
<span id="cb2-4"><a href="#cb2-4"></a><span class="kw">bg3d</span>(<span class="st">&quot;#363940&quot;</span>)</span>
<span id="cb2-5"><a href="#cb2-5"></a><span class="kw">view3d</span>(<span class="dv">15</span>, <span class="dv">25</span>, <span class="dt">zoom =</span> <span class="fl">0.9</span>)</span>
<span id="cb2-6"><a href="#cb2-6"></a><span class="cf">for</span>(j <span class="cf">in</span> <span class="kw">seq_along</span>(gamma_)){</span>
<span id="cb2-7"><a href="#cb2-7"></a>  points &lt;-<span class="st"> </span><span class="kw">verts3D</span>(gamma_[j])</span>
<span id="cb2-8"><a href="#cb2-8"></a>  <span class="cf">for</span>(i <span class="cf">in</span> 1L<span class="op">:</span><span class="kw">nrow</span>(edges)){</span>
<span id="cb2-9"><a href="#cb2-9"></a>    edge &lt;-<span class="st"> </span>edges[i, ]</span>
<span id="cb2-10"><a href="#cb2-10"></a>    <span class="kw">shade3d</span>(<span class="kw">cylinder3d</span>(</span>
<span id="cb2-11"><a href="#cb2-11"></a>      <span class="kw">rbind</span>(</span>
<span id="cb2-12"><a href="#cb2-12"></a>        points[edge[1L], ], </span>
<span id="cb2-13"><a href="#cb2-13"></a>        points[edge[2L], ]</span>
<span id="cb2-14"><a href="#cb2-14"></a>      ), </span>
<span id="cb2-15"><a href="#cb2-15"></a>      <span class="dt">radius =</span> <span class="fl">0.015</span>, <span class="dt">sides =</span> <span class="dv">90</span></span>
<span id="cb2-16"><a href="#cb2-16"></a>    ), <span class="dt">color =</span> <span class="st">&quot;gold&quot;</span>)</span>
<span id="cb2-17"><a href="#cb2-17"></a>  }</span>
<span id="cb2-18"><a href="#cb2-18"></a>  <span class="cf">for</span>(i <span class="cf">in</span> 1L<span class="op">:</span><span class="kw">nrow</span>(triangles)){</span>
<span id="cb2-19"><a href="#cb2-19"></a>    triangle &lt;-<span class="st"> </span>triangles[i, ]</span>
<span id="cb2-20"><a href="#cb2-20"></a>    <span class="kw">triangles3d</span>(</span>
<span id="cb2-21"><a href="#cb2-21"></a>      <span class="kw">rbind</span>(</span>
<span id="cb2-22"><a href="#cb2-22"></a>        points[triangle[1L], ],</span>
<span id="cb2-23"><a href="#cb2-23"></a>        points[triangle[2L], ],</span>
<span id="cb2-24"><a href="#cb2-24"></a>        points[triangle[3L], ]</span>
<span id="cb2-25"><a href="#cb2-25"></a>      ),</span>
<span id="cb2-26"><a href="#cb2-26"></a>      <span class="dt">color =</span> <span class="st">&quot;red&quot;</span>, <span class="dt">alpha =</span> <span class="fl">0.4</span></span>
<span id="cb2-27"><a href="#cb2-27"></a>    )</span>
<span id="cb2-28"><a href="#cb2-28"></a>  }</span>
<span id="cb2-29"><a href="#cb2-29"></a>  <span class="kw">spheres3d</span>(points, <span class="dt">radius =</span> <span class="fl">0.025</span>, <span class="dt">color =</span> <span class="st">&quot;orange&quot;</span>)</span>
<span id="cb2-30"><a href="#cb2-30"></a>  <span class="kw">rgl.snapshot</span>(<span class="kw">sprintf</span>(<span class="st">&quot;pic%03d.png&quot;</span>, j))</span>
<span id="cb2-31"><a href="#cb2-31"></a>  <span class="kw">clear3d</span>()</span>
<span id="cb2-32"><a href="#cb2-32"></a>}</span>
<span id="cb2-33"><a href="#cb2-33"></a></span>
<span id="cb2-34"><a href="#cb2-34"></a>command &lt;-<span class="st"> </span></span>
<span id="cb2-35"><a href="#cb2-35"></a><span class="st">  &quot;gifski --frames=pic*.png --fps=9 -b -o ModifStereoTruncTesseract.gif&quot;</span></span>
<span id="cb2-36"><a href="#cb2-36"></a><span class="kw">system</span>(command)</span></code></pre></div>
<p><img src="figures/ModifStereoTruncatedTesseract.gif" /></p>
<p>The effect of <span class="math inline">\(\gamma\)</span> is interesting: the interior tetrahedra become bigger when it increases while the exterior tetrahedra become smaller.</p>
<h2 id="hopf-torus">Hopf torus</h2>
<p>Now, the <a href="https://laustep.github.io/stlahblog/posts/HopfTorus2.html">Hopf torus</a>. For more efficiency, I modify the <code>parametric3d</code> function of the <strong>misc3d</strong> package.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a><span class="kw">library</span>(rgl)</span>
<span id="cb3-2"><a href="#cb3-2"></a><span class="kw">library</span>(misc3d)</span>
<span id="cb3-3"><a href="#cb3-3"></a></span>
<span id="cb3-4"><a href="#cb3-4"></a>Stereo &lt;-<span class="st"> </span><span class="cf">function</span>(q, gamma){</span>
<span id="cb3-5"><a href="#cb3-5"></a>  <span class="kw">acos</span>(q[, 4L]) <span class="op">/</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">-</span><span class="st"> </span><span class="kw">abs</span>(q[, 4L])<span class="op">^</span>gamma)<span class="op">^</span>(<span class="dv">1</span><span class="op">/</span>gamma) <span class="op">*</span><span class="st"> </span>q[, 1L<span class="op">:</span>3L]</span>
<span id="cb3-6"><a href="#cb3-6"></a>}</span>
<span id="cb3-7"><a href="#cb3-7"></a></span>
<span id="cb3-8"><a href="#cb3-8"></a>parametricMesh3d &lt;-<span class="st"> </span><span class="cf">function</span>(gamma, r1, r2, r3){</span>
<span id="cb3-9"><a href="#cb3-9"></a>  v1 &lt;-<span class="st"> </span><span class="kw">Stereo</span>(r1, gamma)</span>
<span id="cb3-10"><a href="#cb3-10"></a>  v2 &lt;-<span class="st"> </span><span class="kw">Stereo</span>(r2, gamma)</span>
<span id="cb3-11"><a href="#cb3-11"></a>  v3 &lt;-<span class="st"> </span><span class="kw">Stereo</span>(r3, gamma)</span>
<span id="cb3-12"><a href="#cb3-12"></a>  tris &lt;-<span class="st"> </span><span class="kw">makeTriangles</span>(v1, v2, v3)</span>
<span id="cb3-13"><a href="#cb3-13"></a>  mesh0 &lt;-<span class="st"> </span>misc3d<span class="op">:::</span><span class="kw">t2ve</span>(tris)</span>
<span id="cb3-14"><a href="#cb3-14"></a>  <span class="kw">addNormals</span>(</span>
<span id="cb3-15"><a href="#cb3-15"></a>    <span class="kw">tmesh3d</span>(</span>
<span id="cb3-16"><a href="#cb3-16"></a>      <span class="dt">vertices =</span> mesh0<span class="op">$</span>vb,</span>
<span id="cb3-17"><a href="#cb3-17"></a>      <span class="dt">indices  =</span> mesh0<span class="op">$</span>ib</span>
<span id="cb3-18"><a href="#cb3-18"></a>    )</span>
<span id="cb3-19"><a href="#cb3-19"></a>  )</span>
<span id="cb3-20"><a href="#cb3-20"></a>}</span>
<span id="cb3-21"><a href="#cb3-21"></a></span>
<span id="cb3-22"><a href="#cb3-22"></a>A &lt;-<span class="st"> </span><span class="fl">0.44</span></span>
<span id="cb3-23"><a href="#cb3-23"></a>n &lt;-<span class="st"> </span><span class="dv">3</span></span>
<span id="cb3-24"><a href="#cb3-24"></a>Hopf4D &lt;-<span class="st"> </span><span class="cf">function</span>(t, phi){ </span>
<span id="cb3-25"><a href="#cb3-25"></a>  alpha &lt;-<span class="st"> </span>pi<span class="op">/</span><span class="dv">2</span> <span class="op">-</span><span class="st"> </span>(pi<span class="op">/</span><span class="dv">2</span><span class="op">-</span>A)<span class="op">*</span><span class="kw">cos</span>(n<span class="op">*</span>t)</span>
<span id="cb3-26"><a href="#cb3-26"></a>  beta &lt;-<span class="st"> </span>t <span class="op">+</span><span class="st"> </span>A<span class="op">*</span><span class="kw">sin</span>(<span class="dv">2</span><span class="op">*</span>n<span class="op">*</span>t)</span>
<span id="cb3-27"><a href="#cb3-27"></a>  sin_alpha &lt;-<span class="st"> </span><span class="kw">sin</span>(alpha)</span>
<span id="cb3-28"><a href="#cb3-28"></a>  p1 &lt;-<span class="st"> </span>sin_alpha <span class="op">*</span><span class="st"> </span><span class="kw">cos</span>(beta)</span>
<span id="cb3-29"><a href="#cb3-29"></a>  p2 &lt;-<span class="st"> </span>sin_alpha <span class="op">*</span><span class="st"> </span><span class="kw">sin</span>(beta)</span>
<span id="cb3-30"><a href="#cb3-30"></a>  p3 &lt;-<span class="st"> </span><span class="dv">1</span> <span class="op">+</span><span class="st"> </span><span class="kw">cos</span>(alpha)</span>
<span id="cb3-31"><a href="#cb3-31"></a>  cos_phi &lt;-<span class="st"> </span><span class="kw">cos</span>(phi)</span>
<span id="cb3-32"><a href="#cb3-32"></a>  sin_phi &lt;-<span class="st"> </span><span class="kw">sin</span>(phi)</span>
<span id="cb3-33"><a href="#cb3-33"></a>  <span class="kw">cbind</span>(</span>
<span id="cb3-34"><a href="#cb3-34"></a>    cos_phi<span class="op">*</span>p3,</span>
<span id="cb3-35"><a href="#cb3-35"></a>    sin_phi<span class="op">*</span>p1 <span class="op">-</span><span class="st"> </span>cos_phi<span class="op">*</span>p2, </span>
<span id="cb3-36"><a href="#cb3-36"></a>    cos_phi<span class="op">*</span>p1 <span class="op">+</span><span class="st"> </span>sin_phi<span class="op">*</span>p2,</span>
<span id="cb3-37"><a href="#cb3-37"></a>    sin_phi<span class="op">*</span>p3</span>
<span id="cb3-38"><a href="#cb3-38"></a>  ) <span class="op">/</span><span class="st"> </span><span class="kw">sqrt</span>(<span class="dv">2</span><span class="op">*</span>p3)</span>
<span id="cb3-39"><a href="#cb3-39"></a>}</span>
<span id="cb3-40"><a href="#cb3-40"></a>u &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="op">-</span>pi, pi, <span class="dt">length.out =</span> <span class="dv">300</span>)</span>
<span id="cb3-41"><a href="#cb3-41"></a>v &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="dv">0</span>, <span class="dv">2</span><span class="op">*</span>pi, <span class="dt">length.out =</span> <span class="dv">200</span>)</span>
<span id="cb3-42"><a href="#cb3-42"></a>tg &lt;-<span class="st"> </span>misc3d<span class="op">:::</span><span class="kw">expandTriangleGrid</span>(u, v)</span>
<span id="cb3-43"><a href="#cb3-43"></a>h &lt;-<span class="st"> </span><span class="cf">function</span>(uv) <span class="kw">Hopf4D</span>(uv[, 1L], uv[, 2L])</span>
<span id="cb3-44"><a href="#cb3-44"></a>r1 &lt;-<span class="st"> </span><span class="kw">h</span>(tg<span class="op">$</span>v1); r2 &lt;-<span class="st"> </span><span class="kw">h</span>(tg<span class="op">$</span>v2); r3 &lt;-<span class="st"> </span><span class="kw">h</span>(tg<span class="op">$</span>v3)</span></code></pre></div>
<p>Below is the animation when <span class="math inline">\(\gamma\)</span> varies from <span class="math inline">\(0.8\)</span> to <span class="math inline">\(2\)</span>.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1"></a>gamma_ &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="fl">0.8</span>, <span class="dv">2</span>, <span class="dt">by =</span> <span class="fl">0.025</span>)</span>
<span id="cb4-2"><a href="#cb4-2"></a><span class="kw">open3d</span>(<span class="dt">windowRect =</span> <span class="kw">c</span>(<span class="dv">100</span>, <span class="dv">100</span>, <span class="dv">612</span>, <span class="dv">612</span>))</span>
<span id="cb4-3"><a href="#cb4-3"></a><span class="kw">bg3d</span>(<span class="st">&quot;#363940&quot;</span>)</span>
<span id="cb4-4"><a href="#cb4-4"></a><span class="kw">view3d</span>(<span class="dv">90</span>, <span class="dv">0</span>, <span class="dt">zoom =</span> <span class="fl">0.7</span>)</span>
<span id="cb4-5"><a href="#cb4-5"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="kw">seq_along</span>(gamma_)){</span>
<span id="cb4-6"><a href="#cb4-6"></a>  mesh &lt;-<span class="st"> </span><span class="kw">parametricMesh3d</span>(<span class="dt">gamma =</span> gamma_[i], r1, r2, r3)</span>
<span id="cb4-7"><a href="#cb4-7"></a>  <span class="kw">shade3d</span>(mesh, <span class="dt">color =</span> <span class="st">&quot;green&quot;</span>)</span>
<span id="cb4-8"><a href="#cb4-8"></a>  <span class="kw">rgl.snapshot</span>(<span class="kw">sprintf</span>(<span class="st">&quot;pic%03d.png&quot;</span>, i))</span>
<span id="cb4-9"><a href="#cb4-9"></a>  <span class="kw">clear3d</span>()</span>
<span id="cb4-10"><a href="#cb4-10"></a>}</span>
<span id="cb4-11"><a href="#cb4-11"></a></span>
<span id="cb4-12"><a href="#cb4-12"></a>command &lt;-<span class="st"> </span></span>
<span id="cb4-13"><a href="#cb4-13"></a><span class="st">  &quot;gifski --frames=pic*.png --fps=9 -b -o ModifStereoHopfTorus.gif&quot;</span></span>
<span id="cb4-14"><a href="#cb4-14"></a><span class="kw">system</span>(command)</span></code></pre></div>
<p><img src="figures/ModifStereoHopfTorus.gif" /></p>
<p>So the Hopf torus becomes more compact as <span class="math inline">\(\gamma\)</span> increases.</p>
<h2 id="stereographic-duoprism">Stereographic duoprism</h2>
<p>In the post devoted to the <a href="https://laustep.github.io/stlahblog/posts/DuoprismStereo.html">stereographic duoprism</a> I also use the ordinary stereographic projection. Let’s see what happens with the modified stereographic projection.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1"></a><span class="kw">library</span>(rgl)</span>
<span id="cb5-2"><a href="#cb5-2"></a></span>
<span id="cb5-3"><a href="#cb5-3"></a>A &lt;-<span class="st"> </span>3L</span>
<span id="cb5-4"><a href="#cb5-4"></a>B &lt;-<span class="st"> </span>24L</span>
<span id="cb5-5"><a href="#cb5-5"></a></span>
<span id="cb5-6"><a href="#cb5-6"></a><span class="co"># construction of the vertices ####</span></span>
<span id="cb5-7"><a href="#cb5-7"></a>vertices &lt;-<span class="st"> </span><span class="kw">array</span>(<span class="ot">NA_real_</span>, <span class="dt">dim =</span> <span class="kw">c</span>(A, B, 4L))</span>
<span id="cb5-8"><a href="#cb5-8"></a><span class="cf">for</span>(i <span class="cf">in</span> 1L<span class="op">:</span>A){</span>
<span id="cb5-9"><a href="#cb5-9"></a>  v1 &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="kw">cos</span>(i<span class="op">/</span>A<span class="op">*</span><span class="dv">2</span><span class="op">*</span>pi), <span class="kw">sin</span>(i<span class="op">/</span>A<span class="op">*</span><span class="dv">2</span><span class="op">*</span>pi))</span>
<span id="cb5-10"><a href="#cb5-10"></a>  <span class="cf">for</span>(j <span class="cf">in</span> 1L<span class="op">:</span>B){</span>
<span id="cb5-11"><a href="#cb5-11"></a>    v2 &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="kw">cos</span>(j<span class="op">/</span>B<span class="op">*</span><span class="dv">2</span><span class="op">*</span>pi), <span class="kw">sin</span>(j<span class="op">/</span>B<span class="op">*</span><span class="dv">2</span><span class="op">*</span>pi))</span>
<span id="cb5-12"><a href="#cb5-12"></a>    vertices[i, j, ] &lt;-<span class="st"> </span><span class="kw">c</span>(v1, v2)</span>
<span id="cb5-13"><a href="#cb5-13"></a>  }</span>
<span id="cb5-14"><a href="#cb5-14"></a>}</span>
<span id="cb5-15"><a href="#cb5-15"></a></span>
<span id="cb5-16"><a href="#cb5-16"></a><span class="co"># construction of the edges ####</span></span>
<span id="cb5-17"><a href="#cb5-17"></a>edges &lt;-<span class="st"> </span><span class="kw">array</span>(<span class="ot">NA_integer_</span>, <span class="dt">dim =</span> <span class="kw">c</span>(2L, 2L, 2L<span class="op">*</span>A<span class="op">*</span>B))</span>
<span id="cb5-18"><a href="#cb5-18"></a>dominates &lt;-<span class="st"> </span><span class="cf">function</span>(c1, c2){</span>
<span id="cb5-19"><a href="#cb5-19"></a>  c2[1L] <span class="op">&gt;</span><span class="st"> </span>c1[1L] <span class="op">||</span><span class="st"> </span>(c2[1L] <span class="op">==</span><span class="st"> </span>c1[1L] <span class="op">&amp;&amp;</span><span class="st"> </span>c2[2L] <span class="op">&gt;</span><span class="st"> </span>c1[2L])</span>
<span id="cb5-20"><a href="#cb5-20"></a>}</span>
<span id="cb5-21"><a href="#cb5-21"></a>counter &lt;-<span class="st"> </span>1L</span>
<span id="cb5-22"><a href="#cb5-22"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="kw">seq_len</span>(A)<span class="op">-</span>1L){</span>
<span id="cb5-23"><a href="#cb5-23"></a>  <span class="cf">for</span>(j <span class="cf">in</span> <span class="kw">seq_len</span>(B)<span class="op">-</span>1L){</span>
<span id="cb5-24"><a href="#cb5-24"></a>    c1 &lt;-<span class="st"> </span><span class="kw">c</span>(i, j)</span>
<span id="cb5-25"><a href="#cb5-25"></a>    candidate &lt;-<span class="st"> </span><span class="kw">c</span>(i, (j<span class="op">-</span>1L) <span class="op">%%</span><span class="st"> </span>B)</span>
<span id="cb5-26"><a href="#cb5-26"></a>    <span class="cf">if</span>(<span class="kw">dominates</span>(c1, candidate)){</span>
<span id="cb5-27"><a href="#cb5-27"></a>      edges[, , counter] &lt;-<span class="st"> </span><span class="kw">cbind</span>(c1, candidate) <span class="op">+</span><span class="st"> </span>1L</span>
<span id="cb5-28"><a href="#cb5-28"></a>      counter &lt;-<span class="st"> </span>counter <span class="op">+</span><span class="st"> </span>1L</span>
<span id="cb5-29"><a href="#cb5-29"></a>    }</span>
<span id="cb5-30"><a href="#cb5-30"></a>    candidate &lt;-<span class="st"> </span><span class="kw">c</span>(i, (j<span class="op">+</span>1L) <span class="op">%%</span><span class="st"> </span>B)</span>
<span id="cb5-31"><a href="#cb5-31"></a>    <span class="cf">if</span>(<span class="kw">dominates</span>(c1, candidate)){</span>
<span id="cb5-32"><a href="#cb5-32"></a>      edges[, , counter] &lt;-<span class="st"> </span><span class="kw">cbind</span>(c1, candidate) <span class="op">+</span><span class="st"> </span>1L</span>
<span id="cb5-33"><a href="#cb5-33"></a>      counter &lt;-<span class="st"> </span>counter <span class="op">+</span><span class="st"> </span>1L</span>
<span id="cb5-34"><a href="#cb5-34"></a>    }</span>
<span id="cb5-35"><a href="#cb5-35"></a>    candidate &lt;-<span class="st"> </span><span class="kw">c</span>((i<span class="op">-</span>1L) <span class="op">%%</span><span class="st"> </span>A, j)</span>
<span id="cb5-36"><a href="#cb5-36"></a>    <span class="cf">if</span>(<span class="kw">dominates</span>(c1, candidate)){</span>
<span id="cb5-37"><a href="#cb5-37"></a>      edges[, , counter] &lt;-<span class="st"> </span><span class="kw">cbind</span>(c1, candidate) <span class="op">+</span><span class="st"> </span>1L</span>
<span id="cb5-38"><a href="#cb5-38"></a>      counter &lt;-<span class="st"> </span>counter <span class="op">+</span><span class="st"> </span>1L</span>
<span id="cb5-39"><a href="#cb5-39"></a>    }</span>
<span id="cb5-40"><a href="#cb5-40"></a>    candidate &lt;-<span class="st"> </span><span class="kw">c</span>((i<span class="op">+</span>1L) <span class="op">%%</span><span class="st"> </span>A, j)</span>
<span id="cb5-41"><a href="#cb5-41"></a>    <span class="cf">if</span>(<span class="kw">dominates</span>(c1, candidate)){</span>
<span id="cb5-42"><a href="#cb5-42"></a>      edges[, , counter] &lt;-<span class="st"> </span><span class="kw">cbind</span>(c1, candidate) <span class="op">+</span><span class="st"> </span>1L</span>
<span id="cb5-43"><a href="#cb5-43"></a>      counter &lt;-<span class="st"> </span>counter <span class="op">+</span><span class="st"> </span>1L</span>
<span id="cb5-44"><a href="#cb5-44"></a>    }</span>
<span id="cb5-45"><a href="#cb5-45"></a>  }</span>
<span id="cb5-46"><a href="#cb5-46"></a>}</span>
<span id="cb5-47"><a href="#cb5-47"></a></span>
<span id="cb5-48"><a href="#cb5-48"></a><span class="co"># stereographic-like projection</span></span>
<span id="cb5-49"><a href="#cb5-49"></a>stereog &lt;-<span class="st"> </span><span class="cf">function</span>(v, gamma){</span>
<span id="cb5-50"><a href="#cb5-50"></a>  r &lt;-<span class="st"> </span><span class="kw">sqrt</span>(<span class="dv">2</span>)</span>
<span id="cb5-51"><a href="#cb5-51"></a>  <span class="kw">acos</span>(v[4L]<span class="op">/</span>r) <span class="op">/</span><span class="st"> </span>(r<span class="op">^</span>gamma <span class="op">-</span><span class="st"> </span><span class="kw">abs</span>(v[4L])<span class="op">^</span>gamma)<span class="op">^</span>(<span class="dv">1</span><span class="op">/</span>gamma) <span class="op">*</span><span class="st"> </span>v[1L<span class="op">:</span>3L]</span>
<span id="cb5-52"><a href="#cb5-52"></a>}</span>
<span id="cb5-53"><a href="#cb5-53"></a></span>
<span id="cb5-54"><a href="#cb5-54"></a><span class="co"># spherical segment</span></span>
<span id="cb5-55"><a href="#cb5-55"></a>sphericalSegment &lt;-<span class="st"> </span><span class="cf">function</span>(P, Q, n){</span>
<span id="cb5-56"><a href="#cb5-56"></a>  out &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="ot">NA_real_</span>, <span class="dt">nrow =</span> n <span class="op">+</span><span class="st"> </span>1L, <span class="dt">ncol =</span> 4L)</span>
<span id="cb5-57"><a href="#cb5-57"></a>  <span class="cf">for</span>(i <span class="cf">in</span> 0L<span class="op">:</span>n){</span>
<span id="cb5-58"><a href="#cb5-58"></a>    pt &lt;-<span class="st"> </span>P <span class="op">+</span><span class="st"> </span>(i<span class="op">/</span>n)<span class="op">*</span>(Q<span class="op">-</span>P)</span>
<span id="cb5-59"><a href="#cb5-59"></a>    out[i<span class="op">+</span>1L, ] &lt;-<span class="st"> </span><span class="kw">sqrt</span>(<span class="dv">2</span><span class="op">/</span><span class="kw">c</span>(<span class="kw">crossprod</span>(pt))) <span class="op">*</span><span class="st"> </span>pt</span>
<span id="cb5-60"><a href="#cb5-60"></a>  }</span>
<span id="cb5-61"><a href="#cb5-61"></a>  out</span>
<span id="cb5-62"><a href="#cb5-62"></a>}</span>
<span id="cb5-63"><a href="#cb5-63"></a></span>
<span id="cb5-64"><a href="#cb5-64"></a><span class="co"># stereographic edge</span></span>
<span id="cb5-65"><a href="#cb5-65"></a>stereoEdge &lt;-<span class="st"> </span><span class="cf">function</span>(verts, v1, v2, gamma){</span>
<span id="cb5-66"><a href="#cb5-66"></a>  P &lt;-<span class="st"> </span>verts[v1[1L], v1[2L], ]</span>
<span id="cb5-67"><a href="#cb5-67"></a>  Q &lt;-<span class="st"> </span>verts[v2[1L], v2[2L], ]</span>
<span id="cb5-68"><a href="#cb5-68"></a>  PQ &lt;-<span class="st"> </span><span class="kw">sphericalSegment</span>(P, Q, 100L)</span>
<span id="cb5-69"><a href="#cb5-69"></a>  pq &lt;-<span class="st"> </span><span class="kw">t</span>(<span class="kw">apply</span>(PQ, 1L, stereog, <span class="dt">gamma =</span> gamma))</span>
<span id="cb5-70"><a href="#cb5-70"></a>  dists &lt;-<span class="st"> </span><span class="kw">sqrt</span>(<span class="kw">apply</span>(pq, 1L, crossprod))</span>
<span id="cb5-71"><a href="#cb5-71"></a>  <span class="kw">cylinder3d</span>(pq, <span class="dt">radius =</span> dists<span class="op">/</span><span class="dv">15</span>, <span class="dt">sides =</span> <span class="dv">60</span>)</span>
<span id="cb5-72"><a href="#cb5-72"></a>}</span>
<span id="cb5-73"><a href="#cb5-73"></a></span>
<span id="cb5-74"><a href="#cb5-74"></a><span class="co"># projected vertices</span></span>
<span id="cb5-75"><a href="#cb5-75"></a>verts3D &lt;-<span class="st"> </span><span class="cf">function</span>(gamma){</span>
<span id="cb5-76"><a href="#cb5-76"></a>  <span class="kw">apply</span>(vertices, <span class="kw">c</span>(1L, 2L), stereog, <span class="dt">gamma =</span> gamma)</span>
<span id="cb5-77"><a href="#cb5-77"></a>}</span></code></pre></div>
<p>The animation for <span class="math inline">\(\gamma\)</span> varying from <span class="math inline">\(0.8\)</span> to <span class="math inline">\(2\)</span>:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1"></a>gamma_ &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="fl">0.8</span>, <span class="dv">2</span>, <span class="dt">by =</span> <span class="fl">0.025</span>)</span>
<span id="cb6-2"><a href="#cb6-2"></a><span class="kw">open3d</span>(<span class="dt">windowRect =</span> <span class="kw">c</span>(<span class="dv">50</span>, <span class="dv">50</span>, <span class="dv">562</span>, <span class="dv">562</span>))</span>
<span id="cb6-3"><a href="#cb6-3"></a><span class="kw">view3d</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dt">zoom =</span> <span class="fl">0.7</span>)</span>
<span id="cb6-4"><a href="#cb6-4"></a><span class="kw">bg3d</span>(<span class="kw">rgb</span>(<span class="dv">54</span>, <span class="dv">57</span>, <span class="dv">64</span>, <span class="dt">maxColorValue =</span> <span class="dv">255</span>))</span>
<span id="cb6-5"><a href="#cb6-5"></a><span class="cf">for</span>(frame <span class="cf">in</span> <span class="kw">seq_along</span>(gamma_)){</span>
<span id="cb6-6"><a href="#cb6-6"></a>  gamma &lt;-<span class="st"> </span>gamma_[frame]</span>
<span id="cb6-7"><a href="#cb6-7"></a>  <span class="co">## plot the edges</span></span>
<span id="cb6-8"><a href="#cb6-8"></a>  <span class="cf">for</span>(k <span class="cf">in</span> 1L<span class="op">:</span>(2L<span class="op">*</span>A<span class="op">*</span>B)){</span>
<span id="cb6-9"><a href="#cb6-9"></a>    v1 &lt;-<span class="st"> </span>edges[, 1L, k]</span>
<span id="cb6-10"><a href="#cb6-10"></a>    v2 &lt;-<span class="st"> </span>edges[, 2L, k]</span>
<span id="cb6-11"><a href="#cb6-11"></a>    edge &lt;-<span class="st"> </span><span class="kw">stereoEdge</span>(vertices, v1, v2, gamma)</span>
<span id="cb6-12"><a href="#cb6-12"></a>    <span class="kw">shade3d</span>(edge, <span class="dt">color =</span> <span class="st">&quot;gold&quot;</span>)</span>
<span id="cb6-13"><a href="#cb6-13"></a>  }</span>
<span id="cb6-14"><a href="#cb6-14"></a>  <span class="co">## plot the vertices</span></span>
<span id="cb6-15"><a href="#cb6-15"></a>  vs &lt;-<span class="st"> </span><span class="kw">verts3D</span>(gamma)</span>
<span id="cb6-16"><a href="#cb6-16"></a>  <span class="cf">for</span>(i <span class="cf">in</span> 1L<span class="op">:</span>A){</span>
<span id="cb6-17"><a href="#cb6-17"></a>    <span class="cf">for</span>(j <span class="cf">in</span> 1L<span class="op">:</span>B){</span>
<span id="cb6-18"><a href="#cb6-18"></a>      v &lt;-<span class="st"> </span>vs[, i, j]</span>
<span id="cb6-19"><a href="#cb6-19"></a>      <span class="kw">spheres3d</span>(v, <span class="dt">radius =</span> <span class="kw">sqrt</span>(<span class="kw">c</span>(<span class="kw">crossprod</span>(v)))<span class="op">/</span><span class="dv">10</span>, <span class="dt">color =</span> <span class="st">&quot;gold2&quot;</span>)</span>
<span id="cb6-20"><a href="#cb6-20"></a>    }</span>
<span id="cb6-21"><a href="#cb6-21"></a>  }</span>
<span id="cb6-22"><a href="#cb6-22"></a>  <span class="kw">rgl.snapshot</span>(<span class="kw">sprintf</span>(<span class="st">&quot;pic%03d.png&quot;</span>, frame))</span>
<span id="cb6-23"><a href="#cb6-23"></a>  <span class="kw">clear3d</span>()</span>
<span id="cb6-24"><a href="#cb6-24"></a>}</span>
<span id="cb6-25"><a href="#cb6-25"></a></span>
<span id="cb6-26"><a href="#cb6-26"></a>command &lt;-<span class="st"> </span></span>
<span id="cb6-27"><a href="#cb6-27"></a><span class="st">  &quot;gifski --frames=pic*.png --fps=9 -b -o ModifStereoDuoprism.gif&quot;</span></span>
<span id="cb6-28"><a href="#cb6-28"></a><span class="kw">system</span>(command)</span></code></pre></div>
<p><img src="figures/ModifStereoDuoprism.gif" /></p>

        </div>


        <div id="footer">
          Site proudly generated by
          <a href="http://jaspervdj.be/hakyll">Hakyll</a>
        </div>

      </div>

    </div>

    <div class="row">
      <div class="col-sm-12">
        <div id="disqus_thread"></div>
        <div class="pagination">
          <ul>
            <li>
              <a href="http://laustep.github.io/stlahblog/">&#171; Back Home</a>
            </li>
          </ul>
        </div>
      </div>
    </div>
    
  </div>

</body>

<script src="/libraries/bootstrap/bootstrap.min.js"></script>
<script>
  var disqus_developer = 1;
  var disqus_shortname = 'stlapblog';
  // required: replace example with your forum shortname
  /* * * DON'T EDIT BELOW THIS LINE * * */
  (function () {
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = 'https://' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] ||
      document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>
<noscript>Please enable JavaScript to view the
  <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a>
</noscript>
<!-- MathJax: Fall back to local if CDN offline but local image fonts are not supported (saves >100MB) -->
<script type="text/x-mathjax-config" src="/libraries/mathjax/config/TeX-MML-AM_CHTML.js"></script>
<!-- <script>
  window.MathJax || document.write('<script type="text/x-mathjax-config">MathJax.Hub.Config({"HTML-CSS":{imageFont:null}});<\/script><script src="../libraries/mathjax/MathJax.js"><\/script>');
</script> -->


</html>]]></description>
    <pubDate>Tue, 01 Mar 2022 00:00:00 UT</pubDate>
    <guid>https://laustep.github.io/stlahblog/posts/ModifiedStereographicProjection.html</guid>
    <dc:creator>Stéphane Laurent</dc:creator>
    <category>R</category>
</item>


<item>
    <title>Hyperbolic gircope - using 'cxhull' and 'gyro'</title>
    <link>https://laustep.github.io/stlahblog/posts/HyperbolicGircope.html</link>
    <description><![CDATA[<!DOCTYPE HTML>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Saturn Elephant - Hyperbolic gircope - using 'cxhull' and 'gyro'</title>
  <link href="/libraries/bootstrap/bootstrap-grid.min.css" rel="stylesheet">
  <link rel="stylesheet" href="/css/default2.css" />
  <link rel="stylesheet" href="/css/post.css" />
  <link rel="stylesheet" href="/css/misc.css" /> 
  
    <link rel="stylesheet" href="/css/pandoc-solarized.css" /> 
   
  
  <link href="https://fonts.googleapis.com/css?family=Raleway:400,600,200,800" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/css?family=Droid+Sans" rel="stylesheet" type="text/css">
  <script src="/libraries/jquery.min.js"></script>
  <script type="text/javascript" async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML"></script>
</head>

<body>
  <div class="container-fluid">
    <div class="row">
      <!-- Sidebar. -->
      <div class="sidebar col-sm-2">
        <div class="row">
          <div class="col-sm-12" style="float:right;clear:both;margin-right:50px;margin-top:50px;">
            <a href="https://www.r-bloggers.com/">
              <img src="/images/Rbloggers.png" alt="Rbloggers" width="100%" />
            </a>
            <br/>
            <a href="http://t-redactyl.io/">
              <span style="color:black;font-weight:bold;font-family:sans-serif;font-size:25px;">Standard error</span>
            </a>
            <a href="http://timelyportfolio.blogspot.be/">
              <span style="color:grey;font-weight:bold;font-family:sans-serif;font-size:24px;">Timely portfolio</span>
            </a>
            <br/>
            <a href="https://antoineguillot.wordpress.com/blog/">
              <span style="color:white;background-color:darkblue;font-weight:bold;font-family:sans-serif;font-size:21px;border:5px solid;border-color:darkblue">ENHANCE DATA</span>
            </a>
            <br/>
            <a href="https://fronkonstin.com/">
              <span style="color:black;background-color:gold;font-weight:bold;font-size:29px;border:3px solid;border-color:gold;">Fronkonstin</span>
            </a>
          </div>
        </div>
        <div id="logos">
          <div class="row">
            <div class="col-sm-4">
              <img src="/images/AsymptoteLogo.svg" style="width: 150%; transform: rotateZ(-35deg)"/>
            </div>
            <div class="col-sm-4">
              <img src="/images/Rlogo.svg" style="width: 110%;"/>
            </div>
            <div class="col-sm-4">
              <img src="/images/shiny-hex.png" style="width: 90%;"/>
            </div>
          </div>
          <div class="row">
            <div class="col-sm-4">
              <img src="/images/Povray_logo_sphere.png" style="width: 105%;"/>
            </div>
            <div class="col-sm-4">
              <img src="/images/javascript.svg" style="width: 90%;"/>
            </div>
            <div class="col-sm-4">
              <img src="/images/haskell.svg" style="width: 110%;"/>
            </div>
          </div>
        </div>
      </div>

      <div class="main col-sm-10">
        <div id="header">
          <div id="logo">
            <a href="/">
              <img src="/images/stla.jpg" alt="stla" width="100px" />
            </a>
          </div>
          <div id="navigation" style="margin-top:50px;">
            <a href="/">Home</a>
            <a href="/about.html">About</a>
            <a href="/contact.html">Contact</a>
            <a href="/archive.html">Archive</a>
          </div>
        </div>

        <div class="content">
          <h1>Hyperbolic gircope - using 'cxhull' and 'gyro'</h1> 
          <div class="info">
    Posted on February 28, 2022
    
        by Stéphane Laurent
    
</div>
<div class="info">
    
    Tags: <a title="All pages tagged &#39;R&#39;." href="/tags/R.html">R</a>, <a title="All pages tagged &#39;maths&#39;." href="/tags/maths.html">maths</a>, <a title="All pages tagged &#39;geometry&#39;." href="/tags/geometry.html">geometry</a>, <a title="All pages tagged &#39;rgl&#39;." href="/tags/rgl.html">rgl</a>, <a title="All pages tagged &#39;graphics&#39;." href="/tags/graphics.html">graphics</a>
    
</div>

<p>This post is a demonstration of the <strong>cxhull</strong> and <strong>gyro</strong> packages. I will use these packages (and others) to draw an hyperbolic version of the stereographic projection of a convex 4D polytope, the <em>gircope</em> or <em>great rhombicuboctahedral prism</em>. The gircope has twenty-eight cells, but I will only draw the twelve cubes among them.</p>
<p>As said in <a href="https://polytope.miraheze.org/wiki/Great_rhombicuboctahedral_prism">this wiki</a>, the vertices of the gircope are given by all permutations of the first three coordinates of: <span class="math display">\[
\left(\pm\frac{1+2\sqrt{2}}{2}, \pm\frac{1+\sqrt{2}}{2}, 
      \pm\frac{1}{2}, \pm\frac{1}{2}\right).
\]</span></p>
<p>I define these vertices in R as follows:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true"></a><span class="kw">library</span>(gyro)         <span class="co"># to use the `changesOfSign` function</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true"></a><span class="kw">library</span>(arrangements) <span class="co"># to use the `permutations` function</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true"></a>x &lt;-<span class="st"> </span><span class="kw">c</span>(</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true"></a>  (<span class="dv">1</span> <span class="op">+</span><span class="st"> </span><span class="dv">2</span><span class="op">*</span><span class="kw">sqrt</span>(<span class="dv">2</span>)) <span class="op">/</span><span class="st"> </span><span class="dv">2</span>,</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true"></a>  (<span class="dv">1</span> <span class="op">+</span><span class="st"> </span><span class="kw">sqrt</span>(<span class="dv">2</span>)) <span class="op">/</span><span class="st"> </span><span class="dv">2</span>,</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true"></a>  <span class="dv">1</span><span class="op">/</span><span class="dv">2</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true"></a>)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true"></a>vertices &lt;-<span class="st"> </span><span class="kw">changesOfSign</span>(</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true"></a>  <span class="kw">cbind</span>(</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true"></a>    <span class="kw">t</span>(<span class="kw">apply</span>(<span class="kw">permutations</span>(3L), 1L, <span class="cf">function</span>(perm) x[perm])), </span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true"></a>    <span class="dv">1</span><span class="op">/</span><span class="dv">2</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true"></a>  )</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true"></a>)</span></code></pre></div>
<p>Obviously, the vertices of the gircope lie on a sphere centered at the origin:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true"></a><span class="kw">apply</span>(vertices, 1L, crossprod)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true"></a><span class="co">##  [1] 5.62132 5.62132 5.62132 5.62132 5.62132 5.62132 5.62132 5.62132 5.62132</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true"></a><span class="co">## [10] 5.62132 5.62132 5.62132 5.62132 5.62132 5.62132 5.62132 5.62132 5.62132</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true"></a><span class="co">## [19] 5.62132 5.62132 5.62132 5.62132 5.62132 5.62132 5.62132 5.62132 5.62132</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true"></a><span class="co">## [28] 5.62132 5.62132 5.62132 5.62132 5.62132 5.62132 5.62132 5.62132 5.62132</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true"></a><span class="co">## [37] 5.62132 5.62132 5.62132 5.62132 5.62132 5.62132 5.62132 5.62132 5.62132</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true"></a><span class="co">## [46] 5.62132 5.62132 5.62132 5.62132 5.62132 5.62132 5.62132 5.62132 5.62132</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true"></a><span class="co">## [55] 5.62132 5.62132 5.62132 5.62132 5.62132 5.62132 5.62132 5.62132 5.62132</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true"></a><span class="co">## [64] 5.62132 5.62132 5.62132 5.62132 5.62132 5.62132 5.62132 5.62132 5.62132</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true"></a><span class="co">## [73] 5.62132 5.62132 5.62132 5.62132 5.62132 5.62132 5.62132 5.62132 5.62132</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true"></a><span class="co">## [82] 5.62132 5.62132 5.62132 5.62132 5.62132 5.62132 5.62132 5.62132 5.62132</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true"></a><span class="co">## [91] 5.62132 5.62132 5.62132 5.62132 5.62132 5.62132</span></span></code></pre></div>
<p>We will need the value of the radius of this sphere later, for the stereographic projection:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true"></a>R &lt;-<span class="st"> </span><span class="kw">sqrt</span>(<span class="kw">c</span>(<span class="kw">crossprod</span>(vertices[1L, ])))</span></code></pre></div>
<p>The gircope is convex, hence it equals its convex hull. But we have only its vertices so far, and we need its edges, its cells, and its ridges (faces of the cells). This is why we use <strong>cxhull</strong> now:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true"></a><span class="kw">library</span>(cxhull)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true"></a>hull &lt;-<span class="st"> </span><span class="kw">cxhull</span>(vertices)</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true"></a>edges &lt;-<span class="st"> </span>hull[[<span class="st">&quot;edges&quot;</span>]]</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true"></a>cells &lt;-<span class="st"> </span>hull[[<span class="st">&quot;facets&quot;</span>]]</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true"></a>ridges &lt;-<span class="st"> </span>hull[[<span class="st">&quot;ridges&quot;</span>]]</span></code></pre></div>
<p>A cube has eight vertices, and among the cells of the gircope, only the cubic ones have eight vertices. So we get all the cubic cells like this:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true"></a>cubicCells &lt;-</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true"></a><span class="st">  </span><span class="kw">Filter</span>(<span class="cf">function</span>(cell) <span class="kw">length</span>(cell[[<span class="st">&quot;vertices&quot;</span>]]) <span class="op">==</span><span class="st"> </span>8L, cells)</span></code></pre></div>
<p>No we need the faces of the cubes (squares). We can easily get the indices of their vertices but we have to order them. That’s what the <code>polygonize</code> function below does:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true"></a>polygonize &lt;-<span class="st"> </span><span class="cf">function</span>(edges){</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true"></a>  nedges &lt;-<span class="st"> </span><span class="kw">nrow</span>(edges)</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true"></a>  indices &lt;-<span class="st"> </span>edges[1L, ]</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true"></a>  i &lt;-<span class="st"> </span>indices[2L]</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true"></a>  edges &lt;-<span class="st"> </span>edges[<span class="op">-</span>1L, ]</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true"></a>  <span class="cf">for</span>(. <span class="cf">in</span> 1L<span class="op">:</span>(nedges<span class="op">-</span>2L)){</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true"></a>    j &lt;-<span class="st"> </span><span class="kw">which</span>(<span class="kw">apply</span>(edges, 1L, <span class="cf">function</span>(e) i <span class="op">%in%</span><span class="st"> </span>e))</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true"></a>    i &lt;-<span class="st"> </span>edges[j, ][<span class="kw">which</span>(edges[j, ] <span class="op">!=</span><span class="st"> </span>i)]</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true"></a>    indices &lt;-<span class="st"> </span><span class="kw">c</span>(indices, i)</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true"></a>    edges &lt;-<span class="st"> </span>edges[<span class="op">-</span>j, ]</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true"></a>  }</span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true"></a>  indices</span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true"></a>}</span></code></pre></div>
<p>Now we can get the indices of the vertices of the squares:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true"></a>squares &lt;-<span class="st"> </span><span class="kw">t</span>(<span class="kw">vapply</span>(</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true"></a>  <span class="kw">do.call</span>(c, <span class="kw">lapply</span>(cubicCells, <span class="st">`</span><span class="dt">[[</span><span class="st">`</span>, <span class="st">&quot;ridges&quot;</span>)),</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true"></a>  <span class="cf">function</span>(r) <span class="kw">polygonize</span>(ridges[[r]][[<span class="st">&quot;edges&quot;</span>]]),</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true"></a>  <span class="kw">integer</span>(4L)</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true"></a>))</span></code></pre></div>
<p>Now, let’s project the 4D vertices to the 3D space, with a stereographic projection:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true"></a>verts3D &lt;-<span class="st"> </span><span class="kw">t</span>(<span class="kw">apply</span>(vertices, 1L, <span class="cf">function</span>(v){</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true"></a>  v[1L<span class="op">:</span>3L] <span class="op">/</span><span class="st"> </span>(R <span class="op">-</span><span class="st"> </span>v[4L])</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true"></a>}))</span></code></pre></div>
<p>We are ready for plotting. We can’t directly draw hyperbolic squares with the <strong>gyro</strong> package. It only allows to draw hyperbolic triangles, with the <code>gyrotriangle</code> function. So we draw an hyperbolic square by splitting it into two triangles, we merge these two triangles with <code>Morpho::mergeMeshes</code> and we remove the duplicated vertices of the resulting mesh with <code>Rvcg::vcgClean</code>.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true"></a><span class="kw">library</span>(rgl)</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true"></a><span class="kw">library</span>(Morpho) <span class="co"># to use the `mergeMeshes` function</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true"></a><span class="kw">library</span>(Rvcg)   <span class="co"># to use the `vcgClean` function</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true"></a>s &lt;-<span class="st"> </span><span class="fl">0.5</span> <span class="co"># hyperbolic curvature</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true"></a><span class="kw">open3d</span>(<span class="dt">windowRect =</span> <span class="kw">c</span>(<span class="dv">50</span>, <span class="dv">50</span>, <span class="dv">562</span>, <span class="dv">562</span>), <span class="dt">zoom =</span> <span class="fl">0.8</span>)</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true"></a><span class="kw">bg3d</span>(<span class="kw">rgb</span>(<span class="dv">54</span>, <span class="dv">57</span>, <span class="dv">64</span>, <span class="dt">maxColorValue =</span> <span class="dv">255</span>))</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true"></a><span class="cf">for</span>(i <span class="cf">in</span> 1L<span class="op">:</span><span class="kw">nrow</span>(squares)){</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true"></a>  square &lt;-<span class="st"> </span>squares[i, ]</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true"></a>  mesh1 &lt;-<span class="st"> </span><span class="kw">gyrotriangle</span>(</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true"></a>    verts3D[square[1L], ], verts3D[square[2L], ], verts3D[square[3L], ],</span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true"></a>    <span class="dt">s =</span> s</span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true"></a>  )</span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true"></a>  mesh2 &lt;-<span class="st"> </span><span class="kw">gyrotriangle</span>(</span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true"></a>    verts3D[square[1L], ], verts3D[square[3L], ], verts3D[square[4L], ],</span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true"></a>    <span class="dt">s =</span> s</span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true"></a>  )</span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true"></a>  mesh &lt;-<span class="st"> </span><span class="kw">vcgClean</span>(<span class="kw">mergeMeshes</span>(mesh1, mesh2), <span class="dt">sel =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">7</span>), <span class="dt">silent =</span> <span class="ot">TRUE</span>)</span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true"></a>  <span class="kw">shade3d</span>(mesh, <span class="dt">color =</span> <span class="st">&quot;violetred&quot;</span>)</span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true"></a>}</span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true"></a><span class="cf">for</span>(i <span class="cf">in</span> 1L<span class="op">:</span><span class="kw">nrow</span>(edges)){</span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true"></a>  edge &lt;-<span class="st"> </span>edges[i, ]</span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true"></a>  A &lt;-<span class="st"> </span>verts3D[edge[1L], ]; B &lt;-<span class="st"> </span>verts3D[edge[2L], ]</span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true"></a>  tube &lt;-<span class="st"> </span><span class="kw">gyrotube</span>(A, B, <span class="dt">s =</span> s, <span class="dt">radius =</span> <span class="fl">0.025</span>)</span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true"></a>  <span class="kw">shade3d</span>(tube, <span class="dt">color =</span> <span class="st">&quot;whitesmoke&quot;</span>)</span>
<span id="cb9-25"><a href="#cb9-25" aria-hidden="true"></a>}</span>
<span id="cb9-26"><a href="#cb9-26" aria-hidden="true"></a><span class="kw">spheres3d</span>(verts3D, <span class="dt">radius =</span> <span class="fl">0.03</span>, <span class="dt">color =</span> <span class="st">&quot;whitesmoke&quot;</span>)</span></code></pre></div>
<p><img src="figures/hyperbolicGircope.gif" /></p>
<p>To make the animation, I used the following code.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true"></a><span class="kw">movie3d</span>(</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true"></a>  <span class="kw">spin3d</span>(<span class="dt">axis =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>), <span class="dt">rpm =</span> <span class="dv">10</span>),</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true"></a>  <span class="dt">duration =</span> <span class="dv">6</span>, <span class="dt">fps =</span> <span class="dv">10</span>,</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true"></a>  <span class="dt">movie =</span> <span class="st">&quot;pic&quot;</span>, <span class="dt">dir =</span> <span class="st">&quot;.&quot;</span>,</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true"></a>  <span class="dt">convert =</span> <span class="ot">FALSE</span>,</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true"></a>  <span class="dt">startTime =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">10</span>,</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true"></a>  <span class="dt">webshot =</span> <span class="ot">FALSE</span>)</span></code></pre></div>
<p>This code produces the files <strong>pic001.png</strong>, … <strong>pic060.png</strong>. Then I assembled them into a GIF with <a href="https://laustep.github.io/stlahblog/posts/gifskiBash.html">gifski</a> (you can use <strong>ImageMagick</strong> instead).</p>

        </div>


        <div id="footer">
          Site proudly generated by
          <a href="http://jaspervdj.be/hakyll">Hakyll</a>
        </div>

      </div>

    </div>

    <div class="row">
      <div class="col-sm-12">
        <div id="disqus_thread"></div>
        <div class="pagination">
          <ul>
            <li>
              <a href="http://laustep.github.io/stlahblog/">&#171; Back Home</a>
            </li>
          </ul>
        </div>
      </div>
    </div>
    
  </div>

</body>

<script src="/libraries/bootstrap/bootstrap.min.js"></script>
<script>
  var disqus_developer = 1;
  var disqus_shortname = 'stlapblog';
  // required: replace example with your forum shortname
  /* * * DON'T EDIT BELOW THIS LINE * * */
  (function () {
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = 'https://' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] ||
      document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>
<noscript>Please enable JavaScript to view the
  <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a>
</noscript>
<!-- MathJax: Fall back to local if CDN offline but local image fonts are not supported (saves >100MB) -->
<script type="text/x-mathjax-config" src="/libraries/mathjax/config/TeX-MML-AM_CHTML.js"></script>
<!-- <script>
  window.MathJax || document.write('<script type="text/x-mathjax-config">MathJax.Hub.Config({"HTML-CSS":{imageFont:null}});<\/script><script src="../libraries/mathjax/MathJax.js"><\/script>');
</script> -->


</html>]]></description>
    <pubDate>Mon, 28 Feb 2022 00:00:00 UT</pubDate>
    <guid>https://laustep.github.io/stlahblog/posts/HyperbolicGircope.html</guid>
    <dc:creator>Stéphane Laurent</dc:creator>
    <category>R</category>
</item>


<item>
    <title>Volume under surface from points</title>
    <link>https://laustep.github.io/stlahblog/posts/volumeUnderSurface.html</link>
    <description><![CDATA[<!DOCTYPE HTML>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Saturn Elephant - Volume under surface from points</title>
  <link href="/libraries/bootstrap/bootstrap-grid.min.css" rel="stylesheet">
  <link rel="stylesheet" href="/css/default2.css" />
  <link rel="stylesheet" href="/css/post.css" />
  <link rel="stylesheet" href="/css/misc.css" /> 
  
    <link rel="stylesheet" href="/css/pandoc-solarized.css" /> 
   
  
  <link href="https://fonts.googleapis.com/css?family=Raleway:400,600,200,800" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/css?family=Droid+Sans" rel="stylesheet" type="text/css">
  <script src="/libraries/jquery.min.js"></script>
  <script type="text/javascript" async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML"></script>
</head>

<body>
  <div class="container-fluid">
    <div class="row">
      <!-- Sidebar. -->
      <div class="sidebar col-sm-2">
        <div class="row">
          <div class="col-sm-12" style="float:right;clear:both;margin-right:50px;margin-top:50px;">
            <a href="https://www.r-bloggers.com/">
              <img src="/images/Rbloggers.png" alt="Rbloggers" width="100%" />
            </a>
            <br/>
            <a href="http://t-redactyl.io/">
              <span style="color:black;font-weight:bold;font-family:sans-serif;font-size:25px;">Standard error</span>
            </a>
            <a href="http://timelyportfolio.blogspot.be/">
              <span style="color:grey;font-weight:bold;font-family:sans-serif;font-size:24px;">Timely portfolio</span>
            </a>
            <br/>
            <a href="https://antoineguillot.wordpress.com/blog/">
              <span style="color:white;background-color:darkblue;font-weight:bold;font-family:sans-serif;font-size:21px;border:5px solid;border-color:darkblue">ENHANCE DATA</span>
            </a>
            <br/>
            <a href="https://fronkonstin.com/">
              <span style="color:black;background-color:gold;font-weight:bold;font-size:29px;border:3px solid;border-color:gold;">Fronkonstin</span>
            </a>
          </div>
        </div>
        <div id="logos">
          <div class="row">
            <div class="col-sm-4">
              <img src="/images/AsymptoteLogo.svg" style="width: 150%; transform: rotateZ(-35deg)"/>
            </div>
            <div class="col-sm-4">
              <img src="/images/Rlogo.svg" style="width: 110%;"/>
            </div>
            <div class="col-sm-4">
              <img src="/images/shiny-hex.png" style="width: 90%;"/>
            </div>
          </div>
          <div class="row">
            <div class="col-sm-4">
              <img src="/images/Povray_logo_sphere.png" style="width: 105%;"/>
            </div>
            <div class="col-sm-4">
              <img src="/images/javascript.svg" style="width: 90%;"/>
            </div>
            <div class="col-sm-4">
              <img src="/images/haskell.svg" style="width: 110%;"/>
            </div>
          </div>
        </div>
      </div>

      <div class="main col-sm-10">
        <div id="header">
          <div id="logo">
            <a href="/">
              <img src="/images/stla.jpg" alt="stla" width="100px" />
            </a>
          </div>
          <div id="navigation" style="margin-top:50px;">
            <a href="/">Home</a>
            <a href="/about.html">About</a>
            <a href="/contact.html">Contact</a>
            <a href="/archive.html">Archive</a>
          </div>
        </div>

        <div class="content">
          <h1>Volume under surface from points</h1> 
          <div class="info">
    Posted on February 26, 2022
    
        by Stéphane Laurent
    
</div>
<div class="info">
    
    Tags: <a title="All pages tagged &#39;R&#39;." href="/tags/R.html">R</a>, <a title="All pages tagged &#39;maths&#39;." href="/tags/maths.html">maths</a>, <a title="All pages tagged &#39;geometry&#39;." href="/tags/geometry.html">geometry</a>, <a title="All pages tagged &#39;rgl&#39;." href="/tags/rgl.html">rgl</a>
    
</div>

<h2 id="the-problem">The problem</h2>
<p>Suppose you want to get the volume under a surface but you only have some points on this surface. For the illustration, I will take the surface defined by <span class="math inline">\(z = \exp\bigl(-(x^2 + y^2)\bigr)\)</span> on the square <span class="math inline">\([-5, 5] \times [-5, 5]\)</span>. Then the volume we’re looking for is close to <span class="math inline">\(\pi\)</span> (the integral on <span class="math inline">\([-\infty, +\infty] \times [-\infty, +\infty]\)</span> is exactly <span class="math inline">\(\pi\)</span>).</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true"></a>f &lt;-<span class="st"> </span><span class="cf">function</span>(x, y){</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true"></a>  <span class="kw">exp</span>(<span class="op">-</span>(x<span class="op">*</span>x <span class="op">+</span><span class="st"> </span>y<span class="op">*</span>y))</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true"></a>}</span></code></pre></div>
<p>Now let’s define a grid on <span class="math inline">\([-5, 5] \times [-5, 5]\)</span> and the value of <span class="math inline">\(z\)</span> for each point on this grid:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true"></a>x &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="op">-</span><span class="dv">5</span>, <span class="dv">5</span>, <span class="dt">length.out =</span> <span class="dv">100</span>)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true"></a>y &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="op">-</span><span class="dv">5</span>, <span class="dv">5</span>, <span class="dt">length.out =</span> <span class="dv">100</span>)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true"></a>grd &lt;-<span class="st"> </span><span class="kw">transform</span>( <span class="co"># data (x_i, y_i, z_i)</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true"></a>  <span class="kw">expand.grid</span>(<span class="dt">x =</span> x, <span class="dt">y =</span> y), <span class="dt">z =</span> <span class="kw">f</span>(x, y)</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true"></a>) </span></code></pre></div>
<h2 id="elevated-delaunay-tessellation---using-deldir">Elevated Delaunay tessellation - using ‘deldir’</h2>
<p>A solution consists in constructing a Delaunay tessellation of the surface and then to sum the volumes under the Delaunay triangles. The <strong>deldir</strong> package allows to construct such a Delaunay tessellation (which I call an <em>elevated Delaunay tessellation</em>).</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true"></a><span class="kw">library</span>(deldir)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true"></a>del &lt;-<span class="st"> </span><span class="kw">deldir</span>( <span class="co"># Delaunay</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true"></a>  <span class="dt">x =</span> grd[[<span class="st">&quot;x&quot;</span>]], <span class="dt">y =</span> grd[[<span class="st">&quot;y&quot;</span>]], <span class="dt">z =</span> grd[[<span class="st">&quot;z&quot;</span>]],</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true"></a>  <span class="dt">rw =</span> <span class="kw">c</span>(<span class="op">-</span><span class="dv">5</span>, <span class="dv">5</span>, <span class="dv">-5</span>, <span class="dv">5</span>), <span class="dt">round =</span> <span class="ot">FALSE</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true"></a>) </span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true"></a>trgls &lt;-<span class="st"> </span><span class="kw">triang.list</span>(del) <span class="co"># extracts all triangles</span></span></code></pre></div>
<p>The function below calculates the volume under a triangle:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true"></a>volume_under_triangle &lt;-<span class="st"> </span><span class="cf">function</span>(trgl){</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true"></a>  <span class="kw">with</span>(</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true"></a>    trgl, </span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true"></a>    <span class="kw">sum</span>(z) <span class="op">*</span><span class="st"> </span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true"></a><span class="st">      </span>(x[1L]<span class="op">*</span>y[2L] <span class="op">-</span><span class="st"> </span>x[2L]<span class="op">*</span>y[1L] <span class="op">+</span><span class="st"> </span>x[2L]<span class="op">*</span>y[3L] <span class="op">-</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true"></a><span class="st">         </span>x[3L]<span class="op">*</span>y[2L] <span class="op">+</span><span class="st"> </span>x[3L]<span class="op">*</span>y[1L] <span class="op">-</span><span class="st"> </span>x[1L]<span class="op">*</span>y[3L]) <span class="op">/</span><span class="st"> </span><span class="dv">6</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true"></a>  )</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true"></a>}</span></code></pre></div>
<p>So here is our approximation of the volume:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true"></a>volumes &lt;-<span class="st"> </span><span class="kw">vapply</span>(trgls, volume_under_triangle, <span class="kw">numeric</span>(1L))</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true"></a><span class="kw">sum</span>(volumes)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true"></a><span class="co">## [1] 3.141592</span></span></code></pre></div>
<h2 id="using-rcgal">Using ‘RCGAL’</h2>
<p>If you ran the above code, you noticed that the <code>deldir</code> function as well as the <code>triang.list</code> function are a bit slow. My package <a href="https://laustep.github.io/stlahblog/posts/SurfaceReconstruction.html">RCGAL</a> (not on CRAN) can construct an elevated Delaunay tessellation, and it is faster.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true"></a><span class="kw">library</span>(RCGAL)</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true"></a>points &lt;-<span class="st"> </span><span class="kw">as.matrix</span>(grd)</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true"></a>del &lt;-<span class="st"> </span><span class="kw">delaunay</span>(points, <span class="dt">elevation =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<p>You can directly get the volume:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true"></a>del[[<span class="st">&quot;volume&quot;</span>]]</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true"></a><span class="co">## [1] 3.141593</span></span></code></pre></div>
<p>And you can easily plot the elevated Delaunay tessellation with the help of the <strong>rgl</strong> package:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true"></a>mesh &lt;-<span class="st"> </span>del[[<span class="st">&quot;mesh&quot;</span>]]</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true"></a><span class="kw">library</span>(rgl)</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true"></a><span class="kw">open3d</span>(<span class="dt">windowRect =</span> <span class="kw">c</span>(<span class="dv">50</span>, <span class="dv">50</span>, <span class="dv">562</span>, <span class="dv">306</span>), <span class="dt">zoom =</span> <span class="fl">0.5</span>)</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true"></a><span class="kw">aspect3d</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">3</span>)</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true"></a><span class="kw">shade3d</span>(mesh, <span class="dt">color =</span> <span class="st">&quot;limegreen&quot;</span>)</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true"></a><span class="kw">wire3d</span>(mesh)</span></code></pre></div>
<p><img src="figures/rgl_elevated_delaunay.png" /></p>
<h2 id="update-2022-03-02-using-tessellation">Update 2022-03-02: using ‘tessellation’</h2>
<p>The elevated Delaunay tessellation is now available in my package <a href="https://github.com/stla/tessellation">tessellation</a>. The command to get it is the same as the ‘RCGAL’ command and the output is similar.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true"></a>del &lt;-<span class="st"> </span>tessellation<span class="op">::</span><span class="kw">delaunay</span>(points, <span class="dt">elevation =</span> <span class="ot">TRUE</span>)</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true"></a>del[[<span class="st">&quot;volume&quot;</span>]]</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true"></a><span class="co">## [1] 3.141593</span></span></code></pre></div>
<h2 id="update-2022-03-10-using-rcdt">Update 2022-03-10: using ‘RCDT’</h2>
<p>The elevated Delaunay triangulation is now available in my package <a href="https://github.com/stla/RCDT">RCDT</a>.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true"></a>del &lt;-<span class="st"> </span>RCDT<span class="op">::</span><span class="kw">delaunay</span>(points, <span class="dt">elevation =</span> <span class="ot">TRUE</span>)</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true"></a>del[[<span class="st">&quot;volume&quot;</span>]]</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true"></a><span class="co">## [1] 3.141593</span></span></code></pre></div>
<h2 id="interactive-plot-with-deldir">Interactive plot with ‘deldir’</h2>
<p>The <strong>deldir</strong> also allows to get an interactive graphic from the elevated Delaunay tessellation. This requires the <strong>rgl</strong> package. I do it below with a less fine grid, otherwise the visualization is not nice (too dense):</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true"></a>x &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="op">-</span><span class="dv">3</span>, <span class="dv">3</span>, <span class="dt">length.out =</span> <span class="dv">20</span>)</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true"></a>y &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="op">-</span><span class="dv">3</span>, <span class="dv">3</span>, <span class="dt">length.out =</span> <span class="dv">20</span>)</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true"></a>grd &lt;-<span class="st"> </span><span class="kw">transform</span>(</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true"></a>  <span class="kw">expand.grid</span>(<span class="dt">x =</span> x, <span class="dt">y =</span> y), <span class="dt">z =</span> <span class="kw">f</span>(x, y)</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true"></a>) </span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true"></a>del &lt;-<span class="st"> </span><span class="kw">deldir</span>(</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true"></a>  <span class="dt">x =</span> grd[[<span class="st">&quot;x&quot;</span>]], <span class="dt">y =</span> grd[[<span class="st">&quot;y&quot;</span>]], <span class="dt">z =</span> grd[[<span class="st">&quot;z&quot;</span>]],</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true"></a>  <span class="dt">rw =</span> <span class="kw">c</span>(<span class="op">-</span><span class="dv">3</span>, <span class="dv">3</span>, <span class="dv">-3</span>, <span class="dv">3</span>), <span class="dt">round =</span> <span class="ot">FALSE</span></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true"></a>) </span></code></pre></div>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true"></a><span class="kw">library</span>(rgl)</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true"></a><span class="kw">persp3d</span>(del, <span class="dt">front =</span> <span class="st">&quot;lines&quot;</span>, <span class="dt">back =</span> <span class="st">&quot;lines&quot;</span>, <span class="dt">col =</span> <span class="st">&quot;blue&quot;</span>)</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true"></a><span class="kw">aspect3d</span>(<span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">1</span>)</span></code></pre></div>
<p><img src="figures/deldir_elevated_delaunay.gif" /></p>

        </div>


        <div id="footer">
          Site proudly generated by
          <a href="http://jaspervdj.be/hakyll">Hakyll</a>
        </div>

      </div>

    </div>

    <div class="row">
      <div class="col-sm-12">
        <div id="disqus_thread"></div>
        <div class="pagination">
          <ul>
            <li>
              <a href="http://laustep.github.io/stlahblog/">&#171; Back Home</a>
            </li>
          </ul>
        </div>
      </div>
    </div>
    
  </div>

</body>

<script src="/libraries/bootstrap/bootstrap.min.js"></script>
<script>
  var disqus_developer = 1;
  var disqus_shortname = 'stlapblog';
  // required: replace example with your forum shortname
  /* * * DON'T EDIT BELOW THIS LINE * * */
  (function () {
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = 'https://' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] ||
      document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>
<noscript>Please enable JavaScript to view the
  <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a>
</noscript>
<!-- MathJax: Fall back to local if CDN offline but local image fonts are not supported (saves >100MB) -->
<script type="text/x-mathjax-config" src="/libraries/mathjax/config/TeX-MML-AM_CHTML.js"></script>
<!-- <script>
  window.MathJax || document.write('<script type="text/x-mathjax-config">MathJax.Hub.Config({"HTML-CSS":{imageFont:null}});<\/script><script src="../libraries/mathjax/MathJax.js"><\/script>');
</script> -->


</html>]]></description>
    <pubDate>Sat, 26 Feb 2022 00:00:00 UT</pubDate>
    <guid>https://laustep.github.io/stlahblog/posts/volumeUnderSurface.html</guid>
    <dc:creator>Stéphane Laurent</dc:creator>
    <category>R</category>
</item>



<item>
    <title>Nice DT filters</title>
    <link>https://laustep.github.io/stlahblog/posts/DTselect2Filters.html</link>
    <description><![CDATA[<!DOCTYPE HTML>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Saturn Elephant - Nice DT filters</title>
  <link href="/libraries/bootstrap/bootstrap-grid.min.css" rel="stylesheet">
  <link rel="stylesheet" href="/css/default2.css" />
  <link rel="stylesheet" href="/css/post.css" />
  <link rel="stylesheet" href="/css/misc.css" /> 
  
    <link rel="stylesheet" href="/css/pandoc-solarized.css" /> 
   
  
  <link href="https://fonts.googleapis.com/css?family=Raleway:400,600,200,800" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/css?family=Droid+Sans" rel="stylesheet" type="text/css">
  <script src="/libraries/jquery.min.js"></script>
  <script type="text/javascript" async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML"></script>
</head>

<body>
  <div class="container-fluid">
    <div class="row">
      <!-- Sidebar. -->
      <div class="sidebar col-sm-2">
        <div class="row">
          <div class="col-sm-12" style="float:right;clear:both;margin-right:50px;margin-top:50px;">
            <a href="https://www.r-bloggers.com/">
              <img src="/images/Rbloggers.png" alt="Rbloggers" width="100%" />
            </a>
            <br/>
            <a href="http://t-redactyl.io/">
              <span style="color:black;font-weight:bold;font-family:sans-serif;font-size:25px;">Standard error</span>
            </a>
            <a href="http://timelyportfolio.blogspot.be/">
              <span style="color:grey;font-weight:bold;font-family:sans-serif;font-size:24px;">Timely portfolio</span>
            </a>
            <br/>
            <a href="https://antoineguillot.wordpress.com/blog/">
              <span style="color:white;background-color:darkblue;font-weight:bold;font-family:sans-serif;font-size:21px;border:5px solid;border-color:darkblue">ENHANCE DATA</span>
            </a>
            <br/>
            <a href="https://fronkonstin.com/">
              <span style="color:black;background-color:gold;font-weight:bold;font-size:29px;border:3px solid;border-color:gold;">Fronkonstin</span>
            </a>
          </div>
        </div>
        <div id="logos">
          <div class="row">
            <div class="col-sm-4">
              <img src="/images/AsymptoteLogo.svg" style="width: 150%; transform: rotateZ(-35deg)"/>
            </div>
            <div class="col-sm-4">
              <img src="/images/Rlogo.svg" style="width: 110%;"/>
            </div>
            <div class="col-sm-4">
              <img src="/images/shiny-hex.png" style="width: 90%;"/>
            </div>
          </div>
          <div class="row">
            <div class="col-sm-4">
              <img src="/images/Povray_logo_sphere.png" style="width: 105%;"/>
            </div>
            <div class="col-sm-4">
              <img src="/images/javascript.svg" style="width: 90%;"/>
            </div>
            <div class="col-sm-4">
              <img src="/images/haskell.svg" style="width: 110%;"/>
            </div>
          </div>
        </div>
      </div>

      <div class="main col-sm-10">
        <div id="header">
          <div id="logo">
            <a href="/">
              <img src="/images/stla.jpg" alt="stla" width="100px" />
            </a>
          </div>
          <div id="navigation" style="margin-top:50px;">
            <a href="/">Home</a>
            <a href="/about.html">About</a>
            <a href="/contact.html">Contact</a>
            <a href="/archive.html">Archive</a>
          </div>
        </div>

        <div class="content">
          <h1>Nice DT filters</h1> 
          <div class="info">
    Posted on February 11, 2022
    
        by Stéphane Laurent
    
</div>
<div class="info">
    
    Tags: <a title="All pages tagged &#39;R&#39;." href="/tags/R.html">R</a>, <a title="All pages tagged &#39;datatables&#39;." href="/tags/datatables.html">datatables</a>, <a title="All pages tagged &#39;shiny&#39;." href="/tags/shiny.html">shiny</a>, <a title="All pages tagged &#39;javascript&#39;." href="/tags/javascript.html">javascript</a>
    
</div>

<p>I am not a big fan of the built-in filters of <strong>DT</strong>. I prefer the ones below, made with the help of the JavaScript library <strong>select2</strong>.</p>
<p><img src="figures/DTselect2Filters.gif" style="width:75.0%" /></p>
<p>First, <a href="https://cdnjs.com/libraries/select2">download</a> the files <strong>select2.min.js</strong> and <strong>select2.min.css</strong>. Now, here is the code:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a><span class="kw">library</span>(DT)</span>
<span id="cb1-2"><a href="#cb1-2"></a><span class="kw">library</span>(htmltools)</span>
<span id="cb1-3"><a href="#cb1-3"></a></span>
<span id="cb1-4"><a href="#cb1-4"></a>dat &lt;-<span class="st"> </span>iris</span>
<span id="cb1-5"><a href="#cb1-5"></a></span>
<span id="cb1-6"><a href="#cb1-6"></a>sketch &lt;-<span class="st"> </span>tags<span class="op">$</span><span class="kw">table</span>(</span>
<span id="cb1-7"><a href="#cb1-7"></a>  tags<span class="op">$</span><span class="kw">thead</span>(</span>
<span id="cb1-8"><a href="#cb1-8"></a>    tags<span class="op">$</span><span class="kw">tr</span>(</span>
<span id="cb1-9"><a href="#cb1-9"></a>      tags<span class="op">$</span><span class="kw">th</span>(), <span class="kw">lapply</span>(<span class="kw">names</span>(dat), tags<span class="op">$</span>th)</span>
<span id="cb1-10"><a href="#cb1-10"></a>    ),</span>
<span id="cb1-11"><a href="#cb1-11"></a>    tags<span class="op">$</span><span class="kw">tr</span>(</span>
<span id="cb1-12"><a href="#cb1-12"></a>      <span class="kw">lapply</span>(<span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">1</span><span class="op">:</span><span class="kw">ncol</span>(dat)), <span class="cf">function</span>(i) tags<span class="op">$</span><span class="kw">th</span>(<span class="dt">id =</span> <span class="kw">paste0</span>(<span class="st">&quot;th&quot;</span>, i)))</span>
<span id="cb1-13"><a href="#cb1-13"></a>    )</span>
<span id="cb1-14"><a href="#cb1-14"></a>  )</span>
<span id="cb1-15"><a href="#cb1-15"></a>)</span>
<span id="cb1-16"><a href="#cb1-16"></a></span>
<span id="cb1-17"><a href="#cb1-17"></a>js &lt;-<span class="st"> </span><span class="kw">c</span>(</span>
<span id="cb1-18"><a href="#cb1-18"></a>  <span class="st">&quot;function(){&quot;</span>, </span>
<span id="cb1-19"><a href="#cb1-19"></a>  <span class="st">&quot;  this.api().columns().every(function(i){&quot;</span>,</span>
<span id="cb1-20"><a href="#cb1-20"></a>  <span class="st">&quot;    var column = this;&quot;</span>,</span>
<span id="cb1-21"><a href="#cb1-21"></a>  <span class="st">&quot;    var $select =&quot;</span>,</span>
<span id="cb1-22"><a href="#cb1-22"></a>  <span class="st">&quot;      $(&#39;&lt;select multiple=</span><span class="ch">\&quot;</span><span class="st">multiple</span><span class="ch">\&quot;</span><span class="st">&gt;&#39; +&quot;</span>,</span>
<span id="cb1-23"><a href="#cb1-23"></a>  <span class="st">&quot;         &#39;&lt;option value=</span><span class="ch">\&quot;\&quot;</span><span class="st">&gt;&lt;/option&gt;&#39; +&quot;</span>,</span>
<span id="cb1-24"><a href="#cb1-24"></a>  <span class="st">&quot;      &#39;&lt;/select&gt;&#39;)&quot;</span>,</span>
<span id="cb1-25"><a href="#cb1-25"></a>  <span class="st">&quot;      .appendTo($(&#39;#th&#39;+i).empty())&quot;</span>, </span>
<span id="cb1-26"><a href="#cb1-26"></a>  <span class="st">&quot;      .on(&#39;change&#39;, function(){&quot;</span>,</span>
<span id="cb1-27"><a href="#cb1-27"></a>  <span class="st">&quot;        var vals = $(&#39;option:selected&#39;, this).map(function(idx, element){&quot;</span>,</span>
<span id="cb1-28"><a href="#cb1-28"></a>  <span class="st">&quot;          return $.fn.dataTable.util.escapeRegex($(element).val());&quot;</span>,</span>
<span id="cb1-29"><a href="#cb1-29"></a>  <span class="st">&quot;        }).toArray().join(&#39;|&#39;);&quot;</span>,</span>
<span id="cb1-30"><a href="#cb1-30"></a>  <span class="st">&quot;        column.search(&quot;</span>,</span>
<span id="cb1-31"><a href="#cb1-31"></a>  <span class="st">&quot;          vals.length &gt; 0 ? &#39;^(&#39; + vals + &#39;)$&#39; : &#39;&#39;, true, false&quot;</span>,</span>
<span id="cb1-32"><a href="#cb1-32"></a>  <span class="st">&quot;        ).draw();&quot;</span>,</span>
<span id="cb1-33"><a href="#cb1-33"></a>  <span class="st">&quot;      });&quot;</span>,</span>
<span id="cb1-34"><a href="#cb1-34"></a>  <span class="st">&quot;    var data = column.data();&quot;</span>,</span>
<span id="cb1-35"><a href="#cb1-35"></a>  <span class="st">&quot;    if(i == 0){&quot;</span>,</span>
<span id="cb1-36"><a href="#cb1-36"></a>  <span class="st">&quot;      data.each(function(d, j){&quot;</span>,</span>
<span id="cb1-37"><a href="#cb1-37"></a>  <span class="st">&quot;        $select.append(&#39;&lt;option value=</span><span class="ch">\&quot;</span><span class="st">&#39; + d + &#39;</span><span class="ch">\&quot;</span><span class="st">&gt;&#39; + d + &#39;&lt;/option&gt;&#39;);&quot;</span>,</span>
<span id="cb1-38"><a href="#cb1-38"></a>  <span class="st">&quot;      });&quot;</span>,</span>
<span id="cb1-39"><a href="#cb1-39"></a>  <span class="st">&quot;    }else{&quot;</span>,</span>
<span id="cb1-40"><a href="#cb1-40"></a>  <span class="st">&quot;      data.unique().sort().each(function(d, j){&quot;</span>,</span>
<span id="cb1-41"><a href="#cb1-41"></a>  <span class="st">&quot;        $select.append(&#39;&lt;option value=</span><span class="ch">\&quot;</span><span class="st">&#39; + d + &#39;</span><span class="ch">\&quot;</span><span class="st">&gt;&#39; + d + &#39;&lt;/option&gt;&#39;);&quot;</span>,</span>
<span id="cb1-42"><a href="#cb1-42"></a>  <span class="st">&quot;      });&quot;</span>,</span>
<span id="cb1-43"><a href="#cb1-43"></a>  <span class="st">&quot;    }&quot;</span>,</span>
<span id="cb1-44"><a href="#cb1-44"></a>  <span class="st">&quot;    $select.select2({width: &#39;100%&#39;, closeOnSelect: false});&quot;</span>,</span>
<span id="cb1-45"><a href="#cb1-45"></a>  <span class="st">&quot;  });&quot;</span>,</span>
<span id="cb1-46"><a href="#cb1-46"></a>  <span class="st">&quot;}&quot;</span>)</span>
<span id="cb1-47"><a href="#cb1-47"></a></span>
<span id="cb1-48"><a href="#cb1-48"></a>htmlDep &lt;-<span class="st"> </span><span class="kw">htmlDependency</span>(</span>
<span id="cb1-49"><a href="#cb1-49"></a>  <span class="dt">name =</span> <span class="st">&quot;select2&quot;</span>, </span>
<span id="cb1-50"><a href="#cb1-50"></a>  <span class="dt">version =</span> <span class="st">&quot;4.0.13&quot;</span>, </span>
<span id="cb1-51"><a href="#cb1-51"></a>  <span class="dt">src =</span> <span class="st">&quot;path/to/select2&quot;</span>, <span class="co"># path to the folder containing the &#39;select2&#39; files </span></span>
<span id="cb1-52"><a href="#cb1-52"></a>  <span class="dt">script =</span> <span class="st">&quot;select2.min.js&quot;</span>, </span>
<span id="cb1-53"><a href="#cb1-53"></a>  <span class="dt">stylesheet =</span> <span class="st">&quot;select2.min.css&quot;</span>, </span>
<span id="cb1-54"><a href="#cb1-54"></a>  <span class="dt">all_files =</span> <span class="ot">FALSE</span></span>
<span id="cb1-55"><a href="#cb1-55"></a>)</span>
<span id="cb1-56"><a href="#cb1-56"></a></span>
<span id="cb1-57"><a href="#cb1-57"></a>dtable &lt;-<span class="st"> </span></span>
<span id="cb1-58"><a href="#cb1-58"></a><span class="st">  </span><span class="kw">datatable</span>(</span>
<span id="cb1-59"><a href="#cb1-59"></a>    dat, </span>
<span id="cb1-60"><a href="#cb1-60"></a>    <span class="dt">container =</span> sketch, </span>
<span id="cb1-61"><a href="#cb1-61"></a>    <span class="dt">options =</span> <span class="kw">list</span>(</span>
<span id="cb1-62"><a href="#cb1-62"></a>      <span class="dt">orderCellsTop =</span> <span class="ot">TRUE</span>,</span>
<span id="cb1-63"><a href="#cb1-63"></a>      <span class="dt">initComplete =</span> <span class="kw">JS</span>(js),</span>
<span id="cb1-64"><a href="#cb1-64"></a>      <span class="dt">columnDefs =</span> <span class="kw">list</span>(</span>
<span id="cb1-65"><a href="#cb1-65"></a>        <span class="kw">list</span>(<span class="dt">targets =</span> <span class="st">&quot;_all&quot;</span>, <span class="dt">className =</span> <span class="st">&quot;dt-center&quot;</span>)</span>
<span id="cb1-66"><a href="#cb1-66"></a>      )</span>
<span id="cb1-67"><a href="#cb1-67"></a>    )</span>
<span id="cb1-68"><a href="#cb1-68"></a>  )</span>
<span id="cb1-69"><a href="#cb1-69"></a>dtable[[<span class="st">&quot;dependencies&quot;</span>]] &lt;-<span class="st"> </span><span class="kw">c</span>(dtable[[<span class="st">&quot;dependencies&quot;</span>]], <span class="kw">list</span>(htmlDep))</span>
<span id="cb1-70"><a href="#cb1-70"></a>dtable</span></code></pre></div>

        </div>


        <div id="footer">
          Site proudly generated by
          <a href="http://jaspervdj.be/hakyll">Hakyll</a>
        </div>

      </div>

    </div>

    <div class="row">
      <div class="col-sm-12">
        <div id="disqus_thread"></div>
        <div class="pagination">
          <ul>
            <li>
              <a href="http://laustep.github.io/stlahblog/">&#171; Back Home</a>
            </li>
          </ul>
        </div>
      </div>
    </div>
    
  </div>

</body>

<script src="/libraries/bootstrap/bootstrap.min.js"></script>
<script>
  var disqus_developer = 1;
  var disqus_shortname = 'stlapblog';
  // required: replace example with your forum shortname
  /* * * DON'T EDIT BELOW THIS LINE * * */
  (function () {
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = 'https://' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] ||
      document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>
<noscript>Please enable JavaScript to view the
  <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a>
</noscript>
<!-- MathJax: Fall back to local if CDN offline but local image fonts are not supported (saves >100MB) -->
<script type="text/x-mathjax-config" src="/libraries/mathjax/config/TeX-MML-AM_CHTML.js"></script>
<!-- <script>
  window.MathJax || document.write('<script type="text/x-mathjax-config">MathJax.Hub.Config({"HTML-CSS":{imageFont:null}});<\/script><script src="../libraries/mathjax/MathJax.js"><\/script>');
</script> -->


</html>]]></description>
    <pubDate>Fri, 11 Feb 2022 00:00:00 UT</pubDate>
    <guid>https://laustep.github.io/stlahblog/posts/DTselect2Filters.html</guid>
    <dc:creator>Stéphane Laurent</dc:creator>
    <category>R</category>
</item>


<item>
    <title>Gyrotriangle (aka hyperbolic triangle) with moving colors</title>
    <link>https://laustep.github.io/stlahblog/posts/gyrotriangle.html</link>
    <description><![CDATA[<!DOCTYPE HTML>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Saturn Elephant - Gyrotriangle (aka hyperbolic triangle) with moving colors</title>
  <link href="/libraries/bootstrap/bootstrap-grid.min.css" rel="stylesheet">
  <link rel="stylesheet" href="/css/default2.css" />
  <link rel="stylesheet" href="/css/post.css" />
  <link rel="stylesheet" href="/css/misc.css" /> 
  
    <link rel="stylesheet" href="/css/pandoc-solarized.css" /> 
   
  
  <link href="https://fonts.googleapis.com/css?family=Raleway:400,600,200,800" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/css?family=Droid+Sans" rel="stylesheet" type="text/css">
  <script src="/libraries/jquery.min.js"></script>
  <script type="text/javascript" async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML"></script>
</head>

<body>
  <div class="container-fluid">
    <div class="row">
      <!-- Sidebar. -->
      <div class="sidebar col-sm-2">
        <div class="row">
          <div class="col-sm-12" style="float:right;clear:both;margin-right:50px;margin-top:50px;">
            <a href="https://www.r-bloggers.com/">
              <img src="/images/Rbloggers.png" alt="Rbloggers" width="100%" />
            </a>
            <br/>
            <a href="http://t-redactyl.io/">
              <span style="color:black;font-weight:bold;font-family:sans-serif;font-size:25px;">Standard error</span>
            </a>
            <a href="http://timelyportfolio.blogspot.be/">
              <span style="color:grey;font-weight:bold;font-family:sans-serif;font-size:24px;">Timely portfolio</span>
            </a>
            <br/>
            <a href="https://antoineguillot.wordpress.com/blog/">
              <span style="color:white;background-color:darkblue;font-weight:bold;font-family:sans-serif;font-size:21px;border:5px solid;border-color:darkblue">ENHANCE DATA</span>
            </a>
            <br/>
            <a href="https://fronkonstin.com/">
              <span style="color:black;background-color:gold;font-weight:bold;font-size:29px;border:3px solid;border-color:gold;">Fronkonstin</span>
            </a>
          </div>
        </div>
        <div id="logos">
          <div class="row">
            <div class="col-sm-4">
              <img src="/images/AsymptoteLogo.svg" style="width: 150%; transform: rotateZ(-35deg)"/>
            </div>
            <div class="col-sm-4">
              <img src="/images/Rlogo.svg" style="width: 110%;"/>
            </div>
            <div class="col-sm-4">
              <img src="/images/shiny-hex.png" style="width: 90%;"/>
            </div>
          </div>
          <div class="row">
            <div class="col-sm-4">
              <img src="/images/Povray_logo_sphere.png" style="width: 105%;"/>
            </div>
            <div class="col-sm-4">
              <img src="/images/javascript.svg" style="width: 90%;"/>
            </div>
            <div class="col-sm-4">
              <img src="/images/haskell.svg" style="width: 110%;"/>
            </div>
          </div>
        </div>
      </div>

      <div class="main col-sm-10">
        <div id="header">
          <div id="logo">
            <a href="/">
              <img src="/images/stla.jpg" alt="stla" width="100px" />
            </a>
          </div>
          <div id="navigation" style="margin-top:50px;">
            <a href="/">Home</a>
            <a href="/about.html">About</a>
            <a href="/contact.html">Contact</a>
            <a href="/archive.html">Archive</a>
          </div>
        </div>

        <div class="content">
          <h1>Gyrotriangle (aka hyperbolic triangle) with moving colors</h1> 
          <div class="info">
    Posted on February  5, 2022
    
        by Stéphane Laurent
    
</div>
<div class="info">
    
    Tags: <a title="All pages tagged &#39;R&#39;." href="/tags/R.html">R</a>, <a title="All pages tagged &#39;maths&#39;." href="/tags/maths.html">maths</a>, <a title="All pages tagged &#39;geometry&#39;." href="/tags/geometry.html">geometry</a>, <a title="All pages tagged &#39;graphics&#39;." href="/tags/graphics.html">graphics</a>, <a title="All pages tagged &#39;rgl&#39;." href="/tags/rgl.html">rgl</a>
    
</div>

<p>My package <a href="https://github.com/stla/gyro">gyro</a> has been freshly released on CRAN. I implemented the ideas given in <a href="https://laustep.github.io/stlahblog/posts/hyperbolicPolyhedra.html">this blog post</a> in this package. It has a short <a href="https://cran.r-project.org/web/packages/gyro/vignettes/getstarted.html">vignette</a>.</p>
<p>The <code>gyrodemos</code> function provides some examples. But none of them explains how I did the moving colors on this polyhedra that you can see on the Github repo:</p>
<p><img src="https://raw.githubusercontent.com/stla/gyro/main/inst/images/icosahedron_dynamic_colors.gif" /></p>
<p>So I will explain here. In fact, this is similar to the method I presented <a href="https://laustep.github.io/stlahblog/posts/PyVistaDynamicCmap.html">here</a> for <strong>PyVista</strong> and <a href="https://laustep.github.io/stlahblog/posts/HopfTorusDynamicColors.html">here</a> for <strong>rgl</strong>.</p>
<p>The <code>gyrotriangle</code> function of the <strong>gyro</strong> package has a <code>palette</code> argument, in which the user provides a vector of colors. Here is an example:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true"></a><span class="kw">library</span>(gyro)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true"></a><span class="kw">library</span>(rgl)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true"></a>s &lt;-<span class="st"> </span><span class="fl">0.6</span> <span class="co"># hyperbolic curvature</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true"></a>A &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>); B &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>); C &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true"></a>ABC &lt;-<span class="st"> </span><span class="kw">gyrotriangle</span>(</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true"></a>  A, B, C, <span class="dt">s =</span> s,</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true"></a>  <span class="dt">palette =</span> <span class="kw">hcl.colors</span>(<span class="dt">n =</span> <span class="dv">256</span>, <span class="dt">palette =</span> <span class="st">&quot;Berlin&quot;</span>)</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true"></a>)</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true"></a></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true"></a><span class="kw">open3d</span>(<span class="dt">windowRect =</span> <span class="kw">c</span>(<span class="dv">50</span>, <span class="dv">50</span>, <span class="dv">562</span>, <span class="dv">562</span>))</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true"></a><span class="kw">material3d</span>(<span class="dt">lit =</span> <span class="ot">FALSE</span>)</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true"></a><span class="kw">view3d</span>(<span class="dv">10</span>, <span class="dv">40</span>, <span class="dt">zoom =</span> <span class="fl">0.8</span>)</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true"></a><span class="kw">shade3d</span>(ABC)</span></code></pre></div>
<p><img src="figures/gyrotriangle.png" /></p>
<p>Under the hood, the <code>gyrotriangle</code> function uses the <a href="https://www.rdocumentation.org/packages/grDevices/versions/3.6.2/topics/colorRamp">colorRamp</a> with the vector of colors passed to the <code>palette</code> argument. This creates a function, let’s call it <code>fpalette</code>, that assigns a color to each number in the interval <span class="math inline">\([0, 1]\)</span>. Then, <code>gyrotriangle</code> calculates all the distances from the points in the mesh forming the triangle to the gyrocentroid of the triangle. Finally, it linearly normalizes these distances to the interval <span class="math inline">\([0, 1]\)</span>, and it applies the <code>fpalette</code> function to the normalized distances.</p>
<p>Now, the <code>gyrotriangle</code> function has a <code>g</code> argument. This is the key to make the moving colors. This argument <code>g</code> must be a function from <span class="math inline">\([0, 1]\)</span> to <span class="math inline">\([0, 1]\)</span>, by default it is the <code>identity</code> function, and <code>fpalette</code> is actually applied to the normalized distances transformed by <code>g</code>.</p>
<p>So, here is how we can do to get some moving colors:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true"></a>shift_ &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dt">length.out =</span> <span class="dv">61</span>)[<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="kw">seq_along</span>(shift_)){</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true"></a>  ABC &lt;-<span class="st"> </span><span class="kw">gyrotriangle</span>(</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true"></a>    A, B, C, s,</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true"></a>    <span class="dt">palette =</span> <span class="kw">hcl.colors</span>(<span class="dt">n =</span> <span class="dv">256</span>, <span class="dt">palette =</span> <span class="st">&quot;Berlin&quot;</span>), </span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true"></a>    <span class="dt">g =</span> <span class="cf">function</span>(u) (<span class="kw">sin</span>(<span class="dv">2</span><span class="op">*</span>pi<span class="op">*</span>(u <span class="op">-</span><span class="st"> </span>shift_[i])) <span class="op">+</span><span class="st"> </span><span class="dv">1</span>) <span class="op">/</span><span class="st"> </span><span class="dv">2</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true"></a>  )</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true"></a>  <span class="kw">open3d</span>(<span class="dt">windowRect =</span> <span class="kw">c</span>(<span class="dv">50</span>, <span class="dv">50</span>, <span class="dv">562</span>, <span class="dv">562</span>))</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true"></a>  <span class="kw">material3d</span>(<span class="dt">lit =</span> <span class="ot">FALSE</span>)</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true"></a>  <span class="kw">view3d</span>(<span class="dv">10</span>, <span class="dv">40</span>, <span class="dt">zoom =</span> <span class="fl">0.8</span>)</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true"></a>  <span class="kw">shade3d</span>(ABC)</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true"></a>  <span class="kw">rgl.snapshot</span>(<span class="kw">sprintf</span>(<span class="st">&quot;snapshot%03d&quot;</span>, i))</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true"></a>  <span class="kw">close3d</span>()</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true"></a>}</span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true"></a></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true"></a><span class="kw">library</span>(gifski)</span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true"></a>pngs &lt;-<span class="st"> </span><span class="kw">list.files</span>(<span class="dt">pattern =</span> <span class="st">&quot;^snapshot&quot;</span>)</span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true"></a><span class="kw">gifski</span>(</span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true"></a>  pngs,</span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true"></a>  <span class="dt">gif_file =</span> <span class="st">&quot;gyrotriangle.gif&quot;</span>,</span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true"></a>  <span class="dt">width =</span> <span class="dv">512</span>,</span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true"></a>  <span class="dt">height =</span> <span class="dv">512</span>,</span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true"></a>  <span class="dt">delay =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">8</span></span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true"></a>)</span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true"></a></span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true"></a><span class="kw">file.remove</span>(pngs)</span></code></pre></div>
<p><img src="figures/gyrotriangle.gif" /></p>

        </div>


        <div id="footer">
          Site proudly generated by
          <a href="http://jaspervdj.be/hakyll">Hakyll</a>
        </div>

      </div>

    </div>

    <div class="row">
      <div class="col-sm-12">
        <div id="disqus_thread"></div>
        <div class="pagination">
          <ul>
            <li>
              <a href="http://laustep.github.io/stlahblog/">&#171; Back Home</a>
            </li>
          </ul>
        </div>
      </div>
    </div>
    
  </div>

</body>

<script src="/libraries/bootstrap/bootstrap.min.js"></script>
<script>
  var disqus_developer = 1;
  var disqus_shortname = 'stlapblog';
  // required: replace example with your forum shortname
  /* * * DON'T EDIT BELOW THIS LINE * * */
  (function () {
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = 'https://' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] ||
      document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>
<noscript>Please enable JavaScript to view the
  <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a>
</noscript>
<!-- MathJax: Fall back to local if CDN offline but local image fonts are not supported (saves >100MB) -->
<script type="text/x-mathjax-config" src="/libraries/mathjax/config/TeX-MML-AM_CHTML.js"></script>
<!-- <script>
  window.MathJax || document.write('<script type="text/x-mathjax-config">MathJax.Hub.Config({"HTML-CSS":{imageFont:null}});<\/script><script src="../libraries/mathjax/MathJax.js"><\/script>');
</script> -->


</html>]]></description>
    <pubDate>Sat, 05 Feb 2022 00:00:00 UT</pubDate>
    <guid>https://laustep.github.io/stlahblog/posts/gyrotriangle.html</guid>
    <dc:creator>Stéphane Laurent</dc:creator>
    <category>R</category>
</item>


<item>
    <title>Some simple RStudio addins</title>
    <link>https://laustep.github.io/stlahblog/posts/rstudioAddins.html</link>
    <description><![CDATA[<!DOCTYPE HTML>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Saturn Elephant - Some simple RStudio addins</title>
  <link href="/libraries/bootstrap/bootstrap-grid.min.css" rel="stylesheet">
  <link rel="stylesheet" href="/css/default2.css" />
  <link rel="stylesheet" href="/css/post.css" />
  <link rel="stylesheet" href="/css/misc.css" /> 
  
    <link rel="stylesheet" href="/css/pandoc-solarized.css" /> 
   
  
  <link href="https://fonts.googleapis.com/css?family=Raleway:400,600,200,800" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/css?family=Droid+Sans" rel="stylesheet" type="text/css">
  <script src="/libraries/jquery.min.js"></script>
  <script type="text/javascript" async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML"></script>
</head>

<body>
  <div class="container-fluid">
    <div class="row">
      <!-- Sidebar. -->
      <div class="sidebar col-sm-2">
        <div class="row">
          <div class="col-sm-12" style="float:right;clear:both;margin-right:50px;margin-top:50px;">
            <a href="https://www.r-bloggers.com/">
              <img src="/images/Rbloggers.png" alt="Rbloggers" width="100%" />
            </a>
            <br/>
            <a href="http://t-redactyl.io/">
              <span style="color:black;font-weight:bold;font-family:sans-serif;font-size:25px;">Standard error</span>
            </a>
            <a href="http://timelyportfolio.blogspot.be/">
              <span style="color:grey;font-weight:bold;font-family:sans-serif;font-size:24px;">Timely portfolio</span>
            </a>
            <br/>
            <a href="https://antoineguillot.wordpress.com/blog/">
              <span style="color:white;background-color:darkblue;font-weight:bold;font-family:sans-serif;font-size:21px;border:5px solid;border-color:darkblue">ENHANCE DATA</span>
            </a>
            <br/>
            <a href="https://fronkonstin.com/">
              <span style="color:black;background-color:gold;font-weight:bold;font-size:29px;border:3px solid;border-color:gold;">Fronkonstin</span>
            </a>
          </div>
        </div>
        <div id="logos">
          <div class="row">
            <div class="col-sm-4">
              <img src="/images/AsymptoteLogo.svg" style="width: 150%; transform: rotateZ(-35deg)"/>
            </div>
            <div class="col-sm-4">
              <img src="/images/Rlogo.svg" style="width: 110%;"/>
            </div>
            <div class="col-sm-4">
              <img src="/images/shiny-hex.png" style="width: 90%;"/>
            </div>
          </div>
          <div class="row">
            <div class="col-sm-4">
              <img src="/images/Povray_logo_sphere.png" style="width: 105%;"/>
            </div>
            <div class="col-sm-4">
              <img src="/images/javascript.svg" style="width: 90%;"/>
            </div>
            <div class="col-sm-4">
              <img src="/images/haskell.svg" style="width: 110%;"/>
            </div>
          </div>
        </div>
      </div>

      <div class="main col-sm-10">
        <div id="header">
          <div id="logo">
            <a href="/">
              <img src="/images/stla.jpg" alt="stla" width="100px" />
            </a>
          </div>
          <div id="navigation" style="margin-top:50px;">
            <a href="/">Home</a>
            <a href="/about.html">About</a>
            <a href="/contact.html">Contact</a>
            <a href="/archive.html">Archive</a>
          </div>
        </div>

        <div class="content">
          <h1>Some simple RStudio addins</h1> 
          <div class="info">
    Posted on February  3, 2022
    
        by Stéphane Laurent
    
</div>
<div class="info">
    
    Tags: <a title="All pages tagged &#39;R&#39;." href="/tags/R.html">R</a>, <a title="All pages tagged &#39;misc&#39;." href="/tags/misc.html">misc</a>
    
</div>

<p>In this blog post I introduce three small <strong>RStudio</strong> addins I did.</p>
<h2 id="bracketify">‘bracketify’</h2>
<p>I prefer subsetting with the double brackets than with the dollar in R, because this is more readable in <strong>RStudio</strong> thanks to the syntax highlighting. That’s why I did <a href="https://github.com/stla/bracketify">bracketify</a>. This addin replaces all occurrences of <code>foo$bar</code> with <code>foo[["bar"]]</code>, either in a whole file or only in the current selection.</p>
<p><img src="https://raw.githubusercontent.com/stla/bracketify/main/inst/screenshots/bracketify.gif" /></p>
<p>To use carefully: if you have some dollar symbols in your code which are not used for subsetting (e.g. in a regular expression), they can be transformed by <strong>bracketify</strong>.</p>
<h2 id="pasteascomment">‘pasteAsComment’</h2>
<p>Originally, I made <a href="https://github.com/stla/pasteAsComment">pasteAsComment</a> to paste the content of the clipboard as a comment:</p>
<p><img src="https://raw.githubusercontent.com/stla/pasteAsComment/main/inst/screenshots/pasteAsComment.gif" style="width:75.0%" /></p>
<p>I updated this package today. Now it also allows to paste the content of the clipboard as <strong>roxygen</strong> lines. This is particularly useful to write some code in the <code>@examples</code> field:</p>
<p><img src="https://raw.githubusercontent.com/stla/pasteAsComment/main/inst/screenshots/pasteAsRoxygen.gif" style="width:75.0%" /></p>
<h2 id="jsconsole">‘JSconsole’</h2>
<p><a href="https://github.com/stla/JSconsole">JSconsole</a> is available on CRAN. This addin allows to send some selected JavaScript code to the V8 console. This is useful when you want to test a function.</p>
<p><img src="https://raw.githubusercontent.com/stla/JSconsole/master/inst/screenshots/JSconsole.gif" /></p>

        </div>


        <div id="footer">
          Site proudly generated by
          <a href="http://jaspervdj.be/hakyll">Hakyll</a>
        </div>

      </div>

    </div>

    <div class="row">
      <div class="col-sm-12">
        <div id="disqus_thread"></div>
        <div class="pagination">
          <ul>
            <li>
              <a href="http://laustep.github.io/stlahblog/">&#171; Back Home</a>
            </li>
          </ul>
        </div>
      </div>
    </div>
    
  </div>

</body>

<script src="/libraries/bootstrap/bootstrap.min.js"></script>
<script>
  var disqus_developer = 1;
  var disqus_shortname = 'stlapblog';
  // required: replace example with your forum shortname
  /* * * DON'T EDIT BELOW THIS LINE * * */
  (function () {
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = 'https://' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] ||
      document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>
<noscript>Please enable JavaScript to view the
  <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a>
</noscript>
<!-- MathJax: Fall back to local if CDN offline but local image fonts are not supported (saves >100MB) -->
<script type="text/x-mathjax-config" src="/libraries/mathjax/config/TeX-MML-AM_CHTML.js"></script>
<!-- <script>
  window.MathJax || document.write('<script type="text/x-mathjax-config">MathJax.Hub.Config({"HTML-CSS":{imageFont:null}});<\/script><script src="../libraries/mathjax/MathJax.js"><\/script>');
</script> -->


</html>]]></description>
    <pubDate>Thu, 03 Feb 2022 00:00:00 UT</pubDate>
    <guid>https://laustep.github.io/stlahblog/posts/rstudioAddins.html</guid>
    <dc:creator>Stéphane Laurent</dc:creator>
    <category>R</category>
</item>


<item>
    <title>Hopf torus with dynamic colors</title>
    <link>https://laustep.github.io/stlahblog/posts/HopfTorusDynamicColors.html</link>
    <description><![CDATA[<!DOCTYPE HTML>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Saturn Elephant - Hopf torus with dynamic colors</title>
  <link href="/libraries/bootstrap/bootstrap-grid.min.css" rel="stylesheet">
  <link rel="stylesheet" href="/css/default2.css" />
  <link rel="stylesheet" href="/css/post.css" />
  <link rel="stylesheet" href="/css/misc.css" /> 
  
    <link rel="stylesheet" href="/css/pandoc-solarized.css" /> 
   
  
  <link href="https://fonts.googleapis.com/css?family=Raleway:400,600,200,800" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/css?family=Droid+Sans" rel="stylesheet" type="text/css">
  <script src="/libraries/jquery.min.js"></script>
  <script type="text/javascript" async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML"></script>
</head>

<body>
  <div class="container-fluid">
    <div class="row">
      <!-- Sidebar. -->
      <div class="sidebar col-sm-2">
        <div class="row">
          <div class="col-sm-12" style="float:right;clear:both;margin-right:50px;margin-top:50px;">
            <a href="https://www.r-bloggers.com/">
              <img src="/images/Rbloggers.png" alt="Rbloggers" width="100%" />
            </a>
            <br/>
            <a href="http://t-redactyl.io/">
              <span style="color:black;font-weight:bold;font-family:sans-serif;font-size:25px;">Standard error</span>
            </a>
            <a href="http://timelyportfolio.blogspot.be/">
              <span style="color:grey;font-weight:bold;font-family:sans-serif;font-size:24px;">Timely portfolio</span>
            </a>
            <br/>
            <a href="https://antoineguillot.wordpress.com/blog/">
              <span style="color:white;background-color:darkblue;font-weight:bold;font-family:sans-serif;font-size:21px;border:5px solid;border-color:darkblue">ENHANCE DATA</span>
            </a>
            <br/>
            <a href="https://fronkonstin.com/">
              <span style="color:black;background-color:gold;font-weight:bold;font-size:29px;border:3px solid;border-color:gold;">Fronkonstin</span>
            </a>
          </div>
        </div>
        <div id="logos">
          <div class="row">
            <div class="col-sm-4">
              <img src="/images/AsymptoteLogo.svg" style="width: 150%; transform: rotateZ(-35deg)"/>
            </div>
            <div class="col-sm-4">
              <img src="/images/Rlogo.svg" style="width: 110%;"/>
            </div>
            <div class="col-sm-4">
              <img src="/images/shiny-hex.png" style="width: 90%;"/>
            </div>
          </div>
          <div class="row">
            <div class="col-sm-4">
              <img src="/images/Povray_logo_sphere.png" style="width: 105%;"/>
            </div>
            <div class="col-sm-4">
              <img src="/images/javascript.svg" style="width: 90%;"/>
            </div>
            <div class="col-sm-4">
              <img src="/images/haskell.svg" style="width: 110%;"/>
            </div>
          </div>
        </div>
      </div>

      <div class="main col-sm-10">
        <div id="header">
          <div id="logo">
            <a href="/">
              <img src="/images/stla.jpg" alt="stla" width="100px" />
            </a>
          </div>
          <div id="navigation" style="margin-top:50px;">
            <a href="/">Home</a>
            <a href="/about.html">About</a>
            <a href="/contact.html">Contact</a>
            <a href="/archive.html">Archive</a>
          </div>
        </div>

        <div class="content">
          <h1>Hopf torus with dynamic colors</h1> 
          <div class="info">
    Posted on January 29, 2022
    
        by Stéphane Laurent
    
</div>
<div class="info">
    
    Tags: <a title="All pages tagged &#39;R&#39;." href="/tags/R.html">R</a>, <a title="All pages tagged &#39;rgl&#39;." href="/tags/rgl.html">rgl</a>, <a title="All pages tagged &#39;misc3d&#39;." href="/tags/misc3d.html">misc3d</a>, <a title="All pages tagged &#39;graphics&#39;." href="/tags/graphics.html">graphics</a>
    
</div>

<p>In a <a href="https://laustep.github.io/stlahblog/posts/PyVistaDynamicCmap.html">recent post</a> I explained how to decorate a surface with moving colors with the Python library <strong>PyVista</strong>. Here I expose this method for the R package <strong>rgl</strong>.</p>
<p>I will take a Hopf torus with fives lobes for the illustration. The following R function is a slight modification of the <code>parametric3d</code> function of the <strong>misc3d</strong> package. It is more efficient for the Hopf torus parameterization and it returns a <strong>rgl</strong> object of class <code>mesh3d</code>.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true"></a><span class="kw">library</span>(misc3d)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true"></a><span class="kw">library</span>(rgl)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true"></a>parametricMesh3d &lt;-<span class="st"> </span><span class="cf">function</span>(</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true"></a>  Fxyz, umin, umax, vmin, vmax, nu, nv </span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true"></a>){</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true"></a>  u &lt;-<span class="st"> </span><span class="kw">seq</span>(umin, umax, <span class="dt">length.out =</span> nu)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true"></a>  v &lt;-<span class="st"> </span><span class="kw">seq</span>(vmin, vmax, <span class="dt">length.out =</span> nv)</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true"></a>  tg &lt;-<span class="st"> </span>misc3d<span class="op">:::</span><span class="kw">expandTriangleGrid</span>(u, v)</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true"></a>  f &lt;-<span class="st"> </span><span class="cf">function</span>(uv) <span class="kw">Fxyz</span>(uv[, 1L], uv[, 2L])</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true"></a>  v1 &lt;-<span class="st"> </span><span class="kw">f</span>(tg<span class="op">$</span>v1)</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true"></a>  v2 &lt;-<span class="st"> </span><span class="kw">f</span>(tg<span class="op">$</span>v2)</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true"></a>  v3 &lt;-<span class="st"> </span><span class="kw">f</span>(tg<span class="op">$</span>v3)</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true"></a>  tris &lt;-<span class="st"> </span><span class="kw">makeTriangles</span>(v1, v2, v3)</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true"></a>  mesh0 &lt;-<span class="st"> </span>misc3d<span class="op">:::</span><span class="kw">t2ve</span>(tris)</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true"></a>  <span class="kw">addNormals</span>(</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true"></a>    <span class="kw">tmesh3d</span>(</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true"></a>      <span class="dt">vertices =</span> mesh0<span class="op">$</span>vb,</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true"></a>      <span class="dt">indices  =</span> mesh0<span class="op">$</span>ib</span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true"></a>    )</span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true"></a>  )</span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true"></a>}</span></code></pre></div>
<p>The R function below is the parameterization of the Hopf torus.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true"></a>HTxyz &lt;-<span class="st"> </span><span class="cf">function</span>(u, v, <span class="dt">nlobes =</span> <span class="dv">5</span>, <span class="dt">A =</span> <span class="fl">0.38</span>){</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true"></a>  C &lt;-<span class="st"> </span>pi<span class="op">/</span><span class="dv">2</span> <span class="op">-</span><span class="st"> </span>(pi<span class="op">/</span><span class="dv">2</span><span class="op">-</span>A)<span class="op">*</span><span class="kw">cos</span>(u<span class="op">*</span>nlobes)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true"></a>  sinC &lt;-<span class="st"> </span><span class="kw">sin</span>(C)</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true"></a>  D &lt;-<span class="st"> </span>u <span class="op">+</span><span class="st"> </span>A<span class="op">*</span><span class="kw">sin</span>(<span class="dv">2</span><span class="op">*</span>u<span class="op">*</span>nlobes)</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true"></a>  p1 &lt;-<span class="st"> </span><span class="kw">cos</span>(C) <span class="op">+</span><span class="st"> </span><span class="dv">1</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true"></a>  p2 &lt;-<span class="st"> </span>sinC <span class="op">*</span><span class="st"> </span><span class="kw">cos</span>(D)</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true"></a>  p3 &lt;-<span class="st"> </span>sinC <span class="op">*</span><span class="st"> </span><span class="kw">sin</span>(D)</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true"></a>  cos_v &lt;-<span class="st"> </span><span class="kw">cos</span>(v)</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true"></a>  sin_v &lt;-<span class="st"> </span><span class="kw">sin</span>(v)</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true"></a>  x1 &lt;-<span class="st"> </span>cos_v<span class="op">*</span>p3 <span class="op">+</span><span class="st"> </span>sin_v<span class="op">*</span>p2</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true"></a>  x2 &lt;-<span class="st"> </span>cos_v<span class="op">*</span>p2 <span class="op">-</span><span class="st"> </span>sin_v<span class="op">*</span>p3</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true"></a>  x3 &lt;-<span class="st"> </span>sin_v <span class="op">*</span><span class="st"> </span>p1</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true"></a>  xden &lt;-<span class="st"> </span><span class="kw">sqrt</span>(<span class="dv">2</span><span class="op">*</span>p1) <span class="op">-</span><span class="st"> </span>cos_v<span class="op">*</span>p1</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true"></a>  <span class="kw">cbind</span>(x1<span class="op">/</span>xden, x2<span class="op">/</span>xden, x3<span class="op">/</span>xden)</span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true"></a>}</span></code></pre></div>
<p>Let’s make the Hopf torus mesh now.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true"></a>mesh &lt;-<span class="st"> </span><span class="kw">parametricMesh3d</span>(</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true"></a>  HTxyz, <span class="dt">umin =</span> <span class="dv">0</span>, <span class="dt">umax =</span> <span class="dv">2</span><span class="op">*</span>pi, <span class="dt">vmin =</span> <span class="op">-</span>pi, <span class="dt">vmax =</span> pi, <span class="dt">nu =</span> <span class="dv">600</span>, <span class="dt">nv =</span> <span class="dv">400</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true"></a>)</span></code></pre></div>
<p>We will assign a color to each point on the surface, according to the distance from the point to the origin. We calculate these distances below, and we linearly map them to the interval <span class="math inline">\([0, 2\pi]\)</span>.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true"></a>d &lt;-<span class="st"> </span><span class="kw">sqrt</span>(<span class="kw">apply</span>(mesh<span class="op">$</span>vb[<span class="op">-</span>4L, ], 2L, crossprod))</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true"></a>d &lt;-<span class="st"> </span><span class="dv">2</span><span class="op">*</span>pi <span class="op">*</span><span class="st"> </span>(d <span class="op">-</span><span class="st"> </span><span class="kw">min</span>(d)) <span class="op">/</span><span class="st"> </span><span class="kw">diff</span>(<span class="kw">range</span>(d))</span></code></pre></div>
<p>Now we introduce a color palette function. The <strong>trekcolors</strong> package has nice color palettes. I’m taking the <code>dominion</code> palette.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true"></a><span class="kw">library</span>(trekcolors)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true"></a>fpalette &lt;-<span class="st"> </span><span class="kw">colorRamp</span>(</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true"></a>  <span class="kw">trek_pal</span>(<span class="st">&quot;dominion&quot;</span>), <span class="dt">bias =</span> <span class="fl">0.6</span>, <span class="dt">interpolate =</span> <span class="st">&quot;spline&quot;</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true"></a>)</span></code></pre></div>
<p>This function <code>fpalette</code> assign a color, given by its RGB values, to each number between <span class="math inline">\(0\)</span> and <span class="math inline">\(1\)</span>. As in Python, we will calculate <span class="math inline">\(\sin(d -t)\)</span> to move the colors, with <span class="math inline">\(t\)</span> varying from <span class="math inline">\(0\)</span> to <span class="math inline">\(2\pi\)</span>. The sine function takes its values in <span class="math inline">\([-1, 1]\)</span> so we will map this interval to <span class="math inline">\([0,1]\)</span> with the affine function <span class="math inline">\(x \mapsto \frac{x+1}{2}\)</span> in order to apply the <code>fpalette</code> function.</p>
<p>We will also rotate the Hopf torus around the <span class="math inline">\(z\)</span>-axis. By the symmetry of the Hopf torus, it suffices to make the rotation with an angle varying from <span class="math inline">\(0\)</span> to <span class="math inline">\(2\pi/5\)</span>.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true"></a>t_ &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="dv">0</span>, <span class="dv">2</span><span class="op">*</span>pi, <span class="dt">length.out =</span> <span class="dv">73</span>)[<span class="op">-</span>1L]</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true"></a>angle_ &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="dv">0</span>, <span class="dv">2</span><span class="op">*</span>pi<span class="op">/</span><span class="dv">5</span>, <span class="dt">length.out =</span> <span class="dv">73</span>)[<span class="op">-</span>1L]</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="kw">seq_along</span>(t_)){</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true"></a>  RGB &lt;-<span class="st"> </span><span class="kw">fpalette</span>( (<span class="kw">sin</span>(d<span class="op">-</span>t_[i])<span class="op">+</span><span class="dv">1</span>)<span class="op">/</span><span class="dv">2</span> )</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true"></a>  mesh[[<span class="st">&quot;material&quot;</span>]] &lt;-<span class="st"> </span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true"></a><span class="st">    </span><span class="kw">list</span>(<span class="dt">color =</span> <span class="kw">rgb</span>(RGB[, 1L], RGB[, 2L], RGB[, 3L], <span class="dt">maxColorValue =</span> <span class="dv">255</span>))</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true"></a>  rmesh &lt;-<span class="st"> </span><span class="kw">rotate3d</span>(mesh, angle_[i], <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>)</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true"></a>  <span class="kw">open3d</span>(<span class="dt">windowRect =</span> <span class="kw">c</span>(<span class="dv">50</span>, <span class="dv">50</span>, <span class="dv">562</span>, <span class="dv">562</span>))</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true"></a>  <span class="kw">view3d</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dt">zoom =</span> <span class="fl">0.55</span>)</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true"></a>  <span class="kw">spheres3d</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dt">radius =</span> <span class="dv">11</span>, <span class="dt">color =</span> <span class="st">&quot;white&quot;</span>, <span class="dt">alpha =</span> <span class="dv">0</span>) <span class="co"># to fix the view</span></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true"></a>  <span class="kw">shade3d</span>(rmesh)</span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true"></a>  <span class="kw">rgl.snapshot</span>(<span class="kw">sprintf</span>(<span class="st">&quot;pic%03d.png&quot;</span>, i))</span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true"></a>  <span class="kw">close3d</span>()</span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true"></a>}</span></code></pre></div>
<p>This code generates a series of <code>png</code> files <code>pic001.png</code>, …, <code>pic072.png</code>. Using <strong>ImageMagick</strong> or <strong>gifski</strong>, we obtain this <code>gif</code> animation from these files:</p>
<p><img src="figures/HTdominion.gif" /></p>
<p>Very well. But these are not my favorite colors. And I prefer the Hopf torus with three lobes. Below it is, decorated with the <code>klingon</code> color palette of <strong>trekcolors</strong>; I prefer this one.</p>
<p><img src="figures/HTklingon2.gif" /></p>

        </div>


        <div id="footer">
          Site proudly generated by
          <a href="http://jaspervdj.be/hakyll">Hakyll</a>
        </div>

      </div>

    </div>

    <div class="row">
      <div class="col-sm-12">
        <div id="disqus_thread"></div>
        <div class="pagination">
          <ul>
            <li>
              <a href="http://laustep.github.io/stlahblog/">&#171; Back Home</a>
            </li>
          </ul>
        </div>
      </div>
    </div>
    
  </div>

</body>

<script src="/libraries/bootstrap/bootstrap.min.js"></script>
<script>
  var disqus_developer = 1;
  var disqus_shortname = 'stlapblog';
  // required: replace example with your forum shortname
  /* * * DON'T EDIT BELOW THIS LINE * * */
  (function () {
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = 'https://' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] ||
      document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>
<noscript>Please enable JavaScript to view the
  <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a>
</noscript>
<!-- MathJax: Fall back to local if CDN offline but local image fonts are not supported (saves >100MB) -->
<script type="text/x-mathjax-config" src="/libraries/mathjax/config/TeX-MML-AM_CHTML.js"></script>
<!-- <script>
  window.MathJax || document.write('<script type="text/x-mathjax-config">MathJax.Hub.Config({"HTML-CSS":{imageFont:null}});<\/script><script src="../libraries/mathjax/MathJax.js"><\/script>');
</script> -->


</html>]]></description>
    <pubDate>Sat, 29 Jan 2022 00:00:00 UT</pubDate>
    <guid>https://laustep.github.io/stlahblog/posts/HopfTorusDynamicColors.html</guid>
    <dc:creator>Stéphane Laurent</dc:creator>
    <category>R</category>
</item>


<item>
    <title>'gifski' as a bash command using R</title>
    <link>https://laustep.github.io/stlahblog/posts/gifskiBash.html</link>
    <description><![CDATA[<!DOCTYPE HTML>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Saturn Elephant - 'gifski' as a bash command using R</title>
  <link href="/libraries/bootstrap/bootstrap-grid.min.css" rel="stylesheet">
  <link rel="stylesheet" href="/css/default2.css" />
  <link rel="stylesheet" href="/css/post.css" />
  <link rel="stylesheet" href="/css/misc.css" /> 
  
    <link rel="stylesheet" href="/css/pandoc-solarized.css" /> 
   
  
  <link href="https://fonts.googleapis.com/css?family=Raleway:400,600,200,800" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/css?family=Droid+Sans" rel="stylesheet" type="text/css">
  <script src="/libraries/jquery.min.js"></script>
  <script type="text/javascript" async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML"></script>
</head>

<body>
  <div class="container-fluid">
    <div class="row">
      <!-- Sidebar. -->
      <div class="sidebar col-sm-2">
        <div class="row">
          <div class="col-sm-12" style="float:right;clear:both;margin-right:50px;margin-top:50px;">
            <a href="https://www.r-bloggers.com/">
              <img src="/images/Rbloggers.png" alt="Rbloggers" width="100%" />
            </a>
            <br/>
            <a href="http://t-redactyl.io/">
              <span style="color:black;font-weight:bold;font-family:sans-serif;font-size:25px;">Standard error</span>
            </a>
            <a href="http://timelyportfolio.blogspot.be/">
              <span style="color:grey;font-weight:bold;font-family:sans-serif;font-size:24px;">Timely portfolio</span>
            </a>
            <br/>
            <a href="https://antoineguillot.wordpress.com/blog/">
              <span style="color:white;background-color:darkblue;font-weight:bold;font-family:sans-serif;font-size:21px;border:5px solid;border-color:darkblue">ENHANCE DATA</span>
            </a>
            <br/>
            <a href="https://fronkonstin.com/">
              <span style="color:black;background-color:gold;font-weight:bold;font-size:29px;border:3px solid;border-color:gold;">Fronkonstin</span>
            </a>
          </div>
        </div>
        <div id="logos">
          <div class="row">
            <div class="col-sm-4">
              <img src="/images/AsymptoteLogo.svg" style="width: 150%; transform: rotateZ(-35deg)"/>
            </div>
            <div class="col-sm-4">
              <img src="/images/Rlogo.svg" style="width: 110%;"/>
            </div>
            <div class="col-sm-4">
              <img src="/images/shiny-hex.png" style="width: 90%;"/>
            </div>
          </div>
          <div class="row">
            <div class="col-sm-4">
              <img src="/images/Povray_logo_sphere.png" style="width: 105%;"/>
            </div>
            <div class="col-sm-4">
              <img src="/images/javascript.svg" style="width: 90%;"/>
            </div>
            <div class="col-sm-4">
              <img src="/images/haskell.svg" style="width: 110%;"/>
            </div>
          </div>
        </div>
      </div>

      <div class="main col-sm-10">
        <div id="header">
          <div id="logo">
            <a href="/">
              <img src="/images/stla.jpg" alt="stla" width="100px" />
            </a>
          </div>
          <div id="navigation" style="margin-top:50px;">
            <a href="/">Home</a>
            <a href="/about.html">About</a>
            <a href="/contact.html">Contact</a>
            <a href="/archive.html">Archive</a>
          </div>
        </div>

        <div class="content">
          <h1>'gifski' as a bash command using R</h1> 
          <div class="info">
    Posted on January 28, 2022
    
        by Stéphane Laurent
    
</div>
<div class="info">
    
    Tags: <a title="All pages tagged &#39;R&#39;." href="/tags/R.html">R</a>, <a title="All pages tagged &#39;misc&#39;." href="/tags/misc.html">misc</a>
    
</div>

<p>The <a href="https://gif.ski/">gifski</a> command-line utility is a great tool to make a GIF animation from a series of <code>png</code> files. At my work I’m using a laptop with Windows 10 and I don’t have admin rights. I don’t know how to install <strong>gifski</strong> on this laptop.</p>
<p>But <strong>gifski</strong> is also the name of a R package which wraps the <strong>gifski</strong> command-line utility, and this package can be installed without difficulty. So I used this package and the <strong>optparse</strong> package to make my own bash command <strong>gifski</strong>, which is more convenient than the package.</p>
<p>Here is the script:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a><span class="kw">suppressPackageStartupMessages</span>(<span class="kw">library</span>(<span class="st">&quot;optparse&quot;</span>))</span>
<span id="cb1-2"><a href="#cb1-2"></a><span class="kw">suppressPackageStartupMessages</span>(<span class="kw">library</span>(<span class="st">&quot;gifski&quot;</span>))</span>
<span id="cb1-3"><a href="#cb1-3"></a></span>
<span id="cb1-4"><a href="#cb1-4"></a>option_list &lt;-<span class="st"> </span><span class="kw">list</span>( </span>
<span id="cb1-5"><a href="#cb1-5"></a>  <span class="kw">make_option</span>(</span>
<span id="cb1-6"><a href="#cb1-6"></a>    <span class="st">&quot;--frames&quot;</span>, <span class="dt">type =</span> <span class="st">&quot;character&quot;</span>, </span>
<span id="cb1-7"><a href="#cb1-7"></a>    <span class="dt">help =</span> <span class="st">&quot;png files given by a glob (e.g. pic*.png)&quot;</span></span>
<span id="cb1-8"><a href="#cb1-8"></a>  ),</span>
<span id="cb1-9"><a href="#cb1-9"></a>  <span class="kw">make_option</span>(</span>
<span id="cb1-10"><a href="#cb1-10"></a>    <span class="st">&quot;--fps&quot;</span>, <span class="dt">type =</span> <span class="st">&quot;integer&quot;</span>, <span class="dt">default =</span> 20L,</span>
<span id="cb1-11"><a href="#cb1-11"></a>    <span class="dt">help =</span> <span class="st">&quot;frames per second (default 20)&quot;</span></span>
<span id="cb1-12"><a href="#cb1-12"></a>  ),</span>
<span id="cb1-13"><a href="#cb1-13"></a>  <span class="kw">make_option</span>(</span>
<span id="cb1-14"><a href="#cb1-14"></a>    <span class="kw">c</span>(<span class="st">&quot;-l&quot;</span>, <span class="st">&quot;--loop&quot;</span>), <span class="dt">type =</span> <span class="st">&quot;integer&quot;</span>, <span class="dt">default =</span> 0L, </span>
<span id="cb1-15"><a href="#cb1-15"></a>    <span class="dt">help =</span> <span class="st">&quot;number of loops, 0 for infinite (the default)&quot;</span>,</span>
<span id="cb1-16"><a href="#cb1-16"></a>    <span class="dt">metavar =</span> <span class="st">&quot;number&quot;</span></span>
<span id="cb1-17"><a href="#cb1-17"></a>  ),</span>
<span id="cb1-18"><a href="#cb1-18"></a>  <span class="kw">make_option</span>(</span>
<span id="cb1-19"><a href="#cb1-19"></a>    <span class="kw">c</span>(<span class="st">&quot;-s&quot;</span>, <span class="st">&quot;--size&quot;</span>), <span class="dt">type =</span> <span class="st">&quot;character&quot;</span>, <span class="dt">default =</span> <span class="st">&quot;512x512&quot;</span>, </span>
<span id="cb1-20"><a href="#cb1-20"></a>    <span class="dt">help =</span> <span class="kw">paste0</span>(</span>
<span id="cb1-21"><a href="#cb1-21"></a>      <span class="st">&quot;size of the gif given in the form WxH where W is the width in pixels &quot;</span>, </span>
<span id="cb1-22"><a href="#cb1-22"></a>      <span class="st">&quot;and H is the height in pixels (default 512x512)&quot;</span></span>
<span id="cb1-23"><a href="#cb1-23"></a>    ),</span>
<span id="cb1-24"><a href="#cb1-24"></a>    <span class="dt">metavar =</span> <span class="st">&quot;WxH&quot;</span></span>
<span id="cb1-25"><a href="#cb1-25"></a>  ),</span>
<span id="cb1-26"><a href="#cb1-26"></a>  <span class="kw">make_option</span>(</span>
<span id="cb1-27"><a href="#cb1-27"></a>    <span class="kw">c</span>(<span class="st">&quot;-b&quot;</span>, <span class="st">&quot;--backward&quot;</span>), <span class="dt">action =</span> <span class="st">&quot;store_true&quot;</span>, <span class="dt">default =</span> <span class="ot">FALSE</span>, </span>
<span id="cb1-28"><a href="#cb1-28"></a>    <span class="dt">help =</span> <span class="st">&quot;loop forward and backward&quot;</span></span>
<span id="cb1-29"><a href="#cb1-29"></a>  ),</span>
<span id="cb1-30"><a href="#cb1-30"></a>  <span class="kw">make_option</span>(</span>
<span id="cb1-31"><a href="#cb1-31"></a>    <span class="kw">c</span>(<span class="st">&quot;-o&quot;</span>, <span class="st">&quot;--output&quot;</span>), <span class="dt">type =</span> <span class="st">&quot;character&quot;</span>, <span class="dt">default =</span> <span class="st">&quot;animation.gif&quot;</span>, </span>
<span id="cb1-32"><a href="#cb1-32"></a>    <span class="dt">help =</span> <span class="st">&quot;output gif file (default animation.gif)&quot;</span>, </span>
<span id="cb1-33"><a href="#cb1-33"></a>    <span class="dt">metavar =</span> <span class="st">&quot;output.gif&quot;</span></span>
<span id="cb1-34"><a href="#cb1-34"></a>  )</span>
<span id="cb1-35"><a href="#cb1-35"></a>)</span>
<span id="cb1-36"><a href="#cb1-36"></a></span>
<span id="cb1-37"><a href="#cb1-37"></a>opt &lt;-<span class="st"> </span><span class="kw">parse_args</span>(<span class="kw">OptionParser</span>(</span>
<span id="cb1-38"><a href="#cb1-38"></a>  <span class="dt">option_list =</span> option_list, <span class="dt">prog =</span> <span class="st">&quot;gifski&quot;</span></span>
<span id="cb1-39"><a href="#cb1-39"></a>))</span>
<span id="cb1-40"><a href="#cb1-40"></a></span>
<span id="cb1-41"><a href="#cb1-41"></a><span class="co"># check options are correct</span></span>
<span id="cb1-42"><a href="#cb1-42"></a>size_ok &lt;-<span class="st"> </span><span class="kw">grepl</span>(<span class="st">&quot;^</span><span class="ch">\\</span><span class="st">d.*x</span><span class="ch">\\</span><span class="st">d.*$&quot;</span>, opt<span class="op">$</span>size)</span>
<span id="cb1-43"><a href="#cb1-43"></a><span class="cf">if</span>(<span class="op">!</span>size_ok)</span>
<span id="cb1-44"><a href="#cb1-44"></a>  <span class="kw">stop</span>(<span class="st">&quot;Invalid &#39;size&#39; option.&quot;</span>)</span>
<span id="cb1-45"><a href="#cb1-45"></a><span class="cf">if</span>(opt<span class="op">$</span>fps <span class="op">&lt;=</span><span class="st"> </span><span class="dv">0</span>)</span>
<span id="cb1-46"><a href="#cb1-46"></a>  <span class="kw">stop</span>(<span class="st">&quot;Invalid &#39;fps&#39; option.&quot;</span>)</span>
<span id="cb1-47"><a href="#cb1-47"></a><span class="cf">if</span>(opt<span class="op">$</span>loop <span class="op">&lt;</span><span class="st"> </span><span class="dv">0</span>)</span>
<span id="cb1-48"><a href="#cb1-48"></a>  <span class="kw">stop</span>(<span class="st">&quot;Invalid &#39;loop&#39; option.&quot;</span>)</span>
<span id="cb1-49"><a href="#cb1-49"></a>png_files &lt;-<span class="st"> </span><span class="kw">Sys.glob</span>(opt<span class="op">$</span>frames)</span>
<span id="cb1-50"><a href="#cb1-50"></a><span class="cf">if</span>(<span class="kw">length</span>(png_files) <span class="op">==</span><span class="st"> </span>0L)</span>
<span id="cb1-51"><a href="#cb1-51"></a>  <span class="kw">stop</span>(<span class="st">&quot;Invalid &#39;frames&#39; option.&quot;</span>)</span>
<span id="cb1-52"><a href="#cb1-52"></a></span>
<span id="cb1-53"><a href="#cb1-53"></a><span class="co"># if the user chooses the &#39;backward&#39; option we duplicate the files </span></span>
<span id="cb1-54"><a href="#cb1-54"></a><span class="co">#   in a temporary directory</span></span>
<span id="cb1-55"><a href="#cb1-55"></a><span class="cf">if</span>(opt<span class="op">$</span>backward){</span>
<span id="cb1-56"><a href="#cb1-56"></a>  npngs &lt;-<span class="st"> </span>2L <span class="op">*</span><span class="st"> </span><span class="kw">length</span>(png_files)</span>
<span id="cb1-57"><a href="#cb1-57"></a>  fmt &lt;-<span class="st"> </span><span class="kw">paste0</span>(<span class="st">&quot;pic%0&quot;</span>, <span class="kw">floor</span>(<span class="kw">log10</span>(npngs) <span class="op">+</span><span class="st"> </span><span class="dv">1</span>), <span class="st">&quot;d.png&quot;</span>)</span>
<span id="cb1-58"><a href="#cb1-58"></a>  new_png_files &lt;-<span class="st"> </span><span class="kw">file.path</span>(<span class="kw">tempdir</span>(), <span class="kw">sprintf</span>(fmt, 1L<span class="op">:</span>npngs))</span>
<span id="cb1-59"><a href="#cb1-59"></a>  <span class="kw">file.copy</span>(<span class="kw">c</span>(png_files, <span class="kw">rev</span>(png_files)), new_png_files)</span>
<span id="cb1-60"><a href="#cb1-60"></a>  png_files &lt;-<span class="st"> </span>new_png_files</span>
<span id="cb1-61"><a href="#cb1-61"></a>}</span>
<span id="cb1-62"><a href="#cb1-62"></a></span>
<span id="cb1-63"><a href="#cb1-63"></a><span class="co"># get width and height</span></span>
<span id="cb1-64"><a href="#cb1-64"></a>wh &lt;-<span class="st"> </span><span class="kw">as.numeric</span>(<span class="kw">strsplit</span>(opt<span class="op">$</span>size, <span class="st">&quot;x&quot;</span>)[[1L]])</span>
<span id="cb1-65"><a href="#cb1-65"></a></span>
<span id="cb1-66"><a href="#cb1-66"></a><span class="co"># a function to avoid some printed messages</span></span>
<span id="cb1-67"><a href="#cb1-67"></a>quiet &lt;-<span class="st"> </span><span class="cf">function</span>(x) {</span>
<span id="cb1-68"><a href="#cb1-68"></a>  <span class="kw">sink</span>(<span class="kw">tempfile</span>())</span>
<span id="cb1-69"><a href="#cb1-69"></a>  <span class="kw">on.exit</span>(<span class="kw">sink</span>())</span>
<span id="cb1-70"><a href="#cb1-70"></a>  <span class="kw">invisible</span>(<span class="kw">force</span>(x))</span>
<span id="cb1-71"><a href="#cb1-71"></a>}</span>
<span id="cb1-72"><a href="#cb1-72"></a></span>
<span id="cb1-73"><a href="#cb1-73"></a><span class="co"># run gifski</span></span>
<span id="cb1-74"><a href="#cb1-74"></a><span class="kw">quiet</span>(<span class="kw">gifski</span>(</span>
<span id="cb1-75"><a href="#cb1-75"></a>  <span class="dt">png_files =</span> png_files,</span>
<span id="cb1-76"><a href="#cb1-76"></a>  <span class="dt">gif_file =</span> opt<span class="op">$</span>output,</span>
<span id="cb1-77"><a href="#cb1-77"></a>  <span class="dt">width =</span> wh[1L],</span>
<span id="cb1-78"><a href="#cb1-78"></a>  <span class="dt">height =</span> wh[2L],</span>
<span id="cb1-79"><a href="#cb1-79"></a>  <span class="dt">delay =</span> <span class="dv">1</span><span class="op">/</span>opt<span class="op">$</span>fps,</span>
<span id="cb1-80"><a href="#cb1-80"></a>  <span class="dt">loop =</span> <span class="kw">ifelse</span>(opt<span class="op">$</span>loop <span class="op">==</span><span class="st"> </span>0L, <span class="ot">TRUE</span>, opt<span class="op">$</span>loop)</span>
<span id="cb1-81"><a href="#cb1-81"></a>))</span>
<span id="cb1-82"><a href="#cb1-82"></a></span>
<span id="cb1-83"><a href="#cb1-83"></a><span class="kw">cat</span>(<span class="st">&quot;Output written to&quot;</span>, opt<span class="op">$</span>output)</span></code></pre></div>
<p>Save this script where you want, say under the name <strong>gifski.R</strong>.</p>
<p>Now we make a <code>bat</code> file, say <strong>gifski.bat</strong>, which will run this script:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true"></a><span class="ex">@echo</span> off</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true"></a><span class="ex">echo.</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true"></a><span class="ex">C</span>:\path\to\Rscript.exe C:\path\to\gifski.R %*</span></code></pre></div>
<p>That’s all. Put this <code>bat</code> file in a folder available in the PATH environment variable and you can use the bash command <strong>gifski</strong>. Here is the help which is displayed by the command <code>gifski --help</code>:</p>
<pre><code>Usage: gifski [options]


Options:
        --frames=FRAMES
                png files given by a glob (e.g. pic*.png)

        --fps=FPS
                frames per second (default 20)

        -l NUMBER, --loop=NUMBER
                number of loops, 0 for infinite (the default)

        -s WXH, --size=WXH
                size of the gif given in the form WxH where W is the width in pixels 
                and H is the height in pixels (default 512x512)

        -b, --backward
                loop forward and backward

        -o OUTPUT.GIF, --output=OUTPUT.GIF
                output gif file (default animation.gif)

        -h, --help
                Show this help message and exit</code></pre>
<p>Note that there is an additional feature as compared to the original <strong>gifski</strong> tool: the <code>--backward</code> option, which allows to loop forward and backward.</p>
<p><img src="https://github.com/stla/PyVistaMiscellanous/raw/main/C8surface_metamorphosis.gif" /></p>

        </div>


        <div id="footer">
          Site proudly generated by
          <a href="http://jaspervdj.be/hakyll">Hakyll</a>
        </div>

      </div>

    </div>

    <div class="row">
      <div class="col-sm-12">
        <div id="disqus_thread"></div>
        <div class="pagination">
          <ul>
            <li>
              <a href="http://laustep.github.io/stlahblog/">&#171; Back Home</a>
            </li>
          </ul>
        </div>
      </div>
    </div>
    
  </div>

</body>

<script src="/libraries/bootstrap/bootstrap.min.js"></script>
<script>
  var disqus_developer = 1;
  var disqus_shortname = 'stlapblog';
  // required: replace example with your forum shortname
  /* * * DON'T EDIT BELOW THIS LINE * * */
  (function () {
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = 'https://' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] ||
      document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>
<noscript>Please enable JavaScript to view the
  <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a>
</noscript>
<!-- MathJax: Fall back to local if CDN offline but local image fonts are not supported (saves >100MB) -->
<script type="text/x-mathjax-config" src="/libraries/mathjax/config/TeX-MML-AM_CHTML.js"></script>
<!-- <script>
  window.MathJax || document.write('<script type="text/x-mathjax-config">MathJax.Hub.Config({"HTML-CSS":{imageFont:null}});<\/script><script src="../libraries/mathjax/MathJax.js"><\/script>');
</script> -->


</html>]]></description>
    <pubDate>Fri, 28 Jan 2022 00:00:00 UT</pubDate>
    <guid>https://laustep.github.io/stlahblog/posts/gifskiBash.html</guid>
    <dc:creator>Stéphane Laurent</dc:creator>
    <category>R</category>
</item>





<item>
    <title>Funny 3D Voronoï diagrams</title>
    <link>https://laustep.github.io/stlahblog/posts/Voronoi_tessellation.html</link>
    <description><![CDATA[<!DOCTYPE HTML>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Saturn Elephant - Funny 3D Voronoï diagrams</title>
  <link href="/libraries/bootstrap/bootstrap-grid.min.css" rel="stylesheet">
  <link rel="stylesheet" href="/css/default2.css" />
  <link rel="stylesheet" href="/css/post.css" />
  <link rel="stylesheet" href="/css/misc.css" /> 
  
    <link rel="stylesheet" href="/css/pandoc-solarized.css" /> 
   
  
  <link href="https://fonts.googleapis.com/css?family=Raleway:400,600,200,800" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/css?family=Droid+Sans" rel="stylesheet" type="text/css">
  <script src="/libraries/jquery.min.js"></script>
  <script type="text/javascript" async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML"></script>
</head>

<body>
  <div class="container-fluid">
    <div class="row">
      <!-- Sidebar. -->
      <div class="sidebar col-sm-2">
        <div class="row">
          <div class="col-sm-12" style="float:right;clear:both;margin-right:50px;margin-top:50px;">
            <a href="https://www.r-bloggers.com/">
              <img src="/images/Rbloggers.png" alt="Rbloggers" width="100%" />
            </a>
            <br/>
            <a href="http://t-redactyl.io/">
              <span style="color:black;font-weight:bold;font-family:sans-serif;font-size:25px;">Standard error</span>
            </a>
            <a href="http://timelyportfolio.blogspot.be/">
              <span style="color:grey;font-weight:bold;font-family:sans-serif;font-size:24px;">Timely portfolio</span>
            </a>
            <br/>
            <a href="https://antoineguillot.wordpress.com/blog/">
              <span style="color:white;background-color:darkblue;font-weight:bold;font-family:sans-serif;font-size:21px;border:5px solid;border-color:darkblue">ENHANCE DATA</span>
            </a>
            <br/>
            <a href="https://fronkonstin.com/">
              <span style="color:black;background-color:gold;font-weight:bold;font-size:29px;border:3px solid;border-color:gold;">Fronkonstin</span>
            </a>
          </div>
        </div>
        <div id="logos">
          <div class="row">
            <div class="col-sm-4">
              <img src="/images/AsymptoteLogo.svg" style="width: 150%; transform: rotateZ(-35deg)"/>
            </div>
            <div class="col-sm-4">
              <img src="/images/Rlogo.svg" style="width: 110%;"/>
            </div>
            <div class="col-sm-4">
              <img src="/images/shiny-hex.png" style="width: 90%;"/>
            </div>
          </div>
          <div class="row">
            <div class="col-sm-4">
              <img src="/images/Povray_logo_sphere.png" style="width: 105%;"/>
            </div>
            <div class="col-sm-4">
              <img src="/images/javascript.svg" style="width: 90%;"/>
            </div>
            <div class="col-sm-4">
              <img src="/images/haskell.svg" style="width: 110%;"/>
            </div>
          </div>
        </div>
      </div>

      <div class="main col-sm-10">
        <div id="header">
          <div id="logo">
            <a href="/">
              <img src="/images/stla.jpg" alt="stla" width="100px" />
            </a>
          </div>
          <div id="navigation" style="margin-top:50px;">
            <a href="/">Home</a>
            <a href="/about.html">About</a>
            <a href="/contact.html">Contact</a>
            <a href="/archive.html">Archive</a>
          </div>
        </div>

        <div class="content">
          <h1>Funny 3D Voronoï diagrams</h1> 
          <div class="info">
    Posted on January 19, 2022
    
        by Stéphane Laurent
    
</div>
<div class="info">
    
    Tags: <a title="All pages tagged &#39;geometry&#39;." href="/tags/geometry.html">geometry</a>, <a title="All pages tagged &#39;R&#39;." href="/tags/R.html">R</a>, <a title="All pages tagged &#39;rgl&#39;." href="/tags/rgl.html">rgl</a>, <a title="All pages tagged &#39;graphics&#39;." href="/tags/graphics.html">graphics</a>, <a title="All pages tagged &#39;C&#39;." href="/tags/C.html">C</a>, <a title="All pages tagged &#39;haskell&#39;." href="/tags/haskell.html">haskell</a>
    
</div>

<p>Four years ago I wrapped the C library <strong>Qhull</strong> in a <a href="https://github.com/stla/qhull">Haskell package</a>. Thanks to <strong>Qhull</strong>, this package can do some convex hulls and some Delaunay tessellations. The <strong>Qhull</strong> library also allows to do some Voronoï tessellations, but I never understood how that works. So I programmed the Voronoï tessellation in Haskell, by deriving it from the Delaunay tessellation.</p>
<p>Recently, I released the R package <strong>tessellation</strong>. It uses the C code of my Haskell package to contruct Delaunay tessellations, and I programmed the Voronoï tessellation in R.</p>
<p>I discovered something interesting with my Haskell package: take a classical polyhedron (e.g. a tetrahedron, or a cube), enclose it with two or three circles (I mean with some points on the circles), and do the Voronoï diagram of all these points (the vertices of the polyhedron and the points on the circles). Then you get a funny Voronoï diagram. You can see some examples on <a href="https://stla.github.io/tessellation/">the website I made for the <strong>tessellation</strong> package</a> (thanks to the <strong>pkgdown</strong> package).</p>
<p>Let’s make another example here. This time, I take a cuboctahedron and I enclose it with three circles:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true"></a><span class="kw">library</span>(rgl) <span class="co"># provides `cuboctahedron3d()`</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true"></a>cuboctahedron_vertices &lt;-<span class="st"> </span><span class="kw">t</span>(<span class="kw">cuboctahedron3d</span>()<span class="op">$</span>vb[<span class="op">-</span>4L, ])</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true"></a>xi_ &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="dv">0</span>, <span class="dv">2</span><span class="op">*</span>pi, <span class="dt">length.out =</span> <span class="dv">91</span>)[<span class="op">-</span>1L]</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true"></a>R &lt;-<span class="st"> </span><span class="fl">1.5</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true"></a>circle1 &lt;-<span class="st"> </span><span class="kw">t</span>(<span class="kw">vapply</span>(xi_, <span class="cf">function</span>(xi) R<span class="op">*</span><span class="kw">c</span>(<span class="kw">cos</span>(xi), <span class="kw">sin</span>(xi), <span class="dv">0</span>), <span class="kw">numeric</span>(3L)))</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true"></a>circle2 &lt;-<span class="st"> </span><span class="kw">t</span>(<span class="kw">vapply</span>(xi_, <span class="cf">function</span>(xi) R<span class="op">*</span><span class="kw">c</span>(<span class="kw">cos</span>(xi), <span class="dv">0</span>, <span class="kw">sin</span>(xi)), <span class="kw">numeric</span>(3L)))</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true"></a>circle3 &lt;-<span class="st"> </span><span class="kw">t</span>(<span class="kw">vapply</span>(xi_, <span class="cf">function</span>(xi) R<span class="op">*</span><span class="kw">c</span>(<span class="dv">0</span>, <span class="kw">cos</span>(xi), <span class="kw">sin</span>(xi)), <span class="kw">numeric</span>(3L)))</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true"></a>enclosedCuboctahedron &lt;-<span class="st"> </span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true"></a><span class="st">  </span><span class="kw">rbind</span>(cuboctahedron_vertices, circle1, circle2, circle3)</span></code></pre></div>
<p>Here is the picture:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true"></a><span class="kw">open3d</span>(<span class="dt">windowRect =</span> <span class="kw">c</span>(<span class="dv">50</span>, <span class="dv">50</span>, <span class="dv">562</span>, <span class="dv">562</span>))</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true"></a><span class="kw">view3d</span>(<span class="dv">20</span>, <span class="dt">zoom =</span> <span class="fl">0.65</span>)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true"></a><span class="kw">shade3d</span>(<span class="kw">cuboctahedron3d</span>(), <span class="dt">color =</span> <span class="st">&quot;darkorange&quot;</span>, <span class="dt">shininess =</span> <span class="dv">10</span>)</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true"></a><span class="kw">wire3d</span>(<span class="kw">cuboctahedron3d</span>(), <span class="dt">color =</span> <span class="st">&quot;darkslategray4&quot;</span>, <span class="dt">lwd =</span> <span class="dv">4</span>)</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true"></a><span class="kw">spheres3d</span>(<span class="kw">rbind</span>(circle1, circle2, circle3), <span class="dt">radius =</span> <span class="fl">0.04</span>)</span></code></pre></div>
<p><img src="figures/enclosedCuboctahedron.png" /></p>
<p>Now let’s make the Voronoï diagram with the <strong>tessellation</strong> package:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true"></a><span class="kw">library</span>(tessellation)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true"></a>del &lt;-<span class="st"> </span><span class="kw">delaunay</span>(enclosedCuboctahedron, <span class="dt">degenerate =</span> <span class="ot">TRUE</span>)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true"></a>v &lt;-<span class="st"> </span><span class="kw">voronoi</span>(del)</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true"></a><span class="co">## Voronoï diagram with twelve bounded cells.</span></span></code></pre></div>
<p>I have not checked whether the option <code>degenerate = TRUE</code> is necessary, but it is often necessary in order to get a correct Voronoï diagram, and I never understood why. Now let’s plot the Voronoï diagram:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true"></a><span class="kw">library</span>(paletteer) <span class="co"># provides many color palettes</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true"></a><span class="kw">open3d</span>(<span class="dt">windowRect =</span> <span class="kw">c</span>(<span class="dv">50</span>, <span class="dv">50</span>, <span class="dv">562</span>, <span class="dv">562</span>))</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true"></a><span class="kw">bg3d</span>(<span class="st">&quot;palegoldenrod&quot;</span>)</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true"></a><span class="kw">plotVoronoiDiagram</span>(v, <span class="dt">colors =</span> <span class="kw">paletteer_c</span>(<span class="st">&quot;grDevices::Dark 3&quot;</span>, 12L))</span></code></pre></div>
<p>I animated it. Here is the result:</p>
<p><img src="figures/voronoi_enclosed_cuboctahedron.gif" /></p>
<p>This is not my favorite one (I prefer the one derived from the cube, that you can see on the <strong>tessellation</strong> website), but nevertheless it is nice.</p>

        </div>


        <div id="footer">
          Site proudly generated by
          <a href="http://jaspervdj.be/hakyll">Hakyll</a>
        </div>

      </div>

    </div>

    <div class="row">
      <div class="col-sm-12">
        <div id="disqus_thread"></div>
        <div class="pagination">
          <ul>
            <li>
              <a href="http://laustep.github.io/stlahblog/">&#171; Back Home</a>
            </li>
          </ul>
        </div>
      </div>
    </div>
    
  </div>

</body>

<script src="/libraries/bootstrap/bootstrap.min.js"></script>
<script>
  var disqus_developer = 1;
  var disqus_shortname = 'stlapblog';
  // required: replace example with your forum shortname
  /* * * DON'T EDIT BELOW THIS LINE * * */
  (function () {
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = 'https://' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] ||
      document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>
<noscript>Please enable JavaScript to view the
  <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a>
</noscript>
<!-- MathJax: Fall back to local if CDN offline but local image fonts are not supported (saves >100MB) -->
<script type="text/x-mathjax-config" src="/libraries/mathjax/config/TeX-MML-AM_CHTML.js"></script>
<!-- <script>
  window.MathJax || document.write('<script type="text/x-mathjax-config">MathJax.Hub.Config({"HTML-CSS":{imageFont:null}});<\/script><script src="../libraries/mathjax/MathJax.js"><\/script>');
</script> -->


</html>]]></description>
    <pubDate>Wed, 19 Jan 2022 00:00:00 UT</pubDate>
    <guid>https://laustep.github.io/stlahblog/posts/Voronoi_tessellation.html</guid>
    <dc:creator>Stéphane Laurent</dc:creator>
    <category>R</category>
</item>


<item>
    <title>Surface reconstruction with R(CGAL)</title>
    <link>https://laustep.github.io/stlahblog/posts/SurfaceReconstruction.html</link>
    <description><![CDATA[<!DOCTYPE HTML>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Saturn Elephant - Surface reconstruction with R(CGAL)</title>
  <link href="/libraries/bootstrap/bootstrap-grid.min.css" rel="stylesheet">
  <link rel="stylesheet" href="/css/default2.css" />
  <link rel="stylesheet" href="/css/post.css" />
  <link rel="stylesheet" href="/css/misc.css" /> 
  
    <link rel="stylesheet" href="/css/pandoc-solarized.css" /> 
   
  
  <link href="https://fonts.googleapis.com/css?family=Raleway:400,600,200,800" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/css?family=Droid+Sans" rel="stylesheet" type="text/css">
  <script src="/libraries/jquery.min.js"></script>
  <script type="text/javascript" async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML"></script>
</head>

<body>
  <div class="container-fluid">
    <div class="row">
      <!-- Sidebar. -->
      <div class="sidebar col-sm-2">
        <div class="row">
          <div class="col-sm-12" style="float:right;clear:both;margin-right:50px;margin-top:50px;">
            <a href="https://www.r-bloggers.com/">
              <img src="/images/Rbloggers.png" alt="Rbloggers" width="100%" />
            </a>
            <br/>
            <a href="http://t-redactyl.io/">
              <span style="color:black;font-weight:bold;font-family:sans-serif;font-size:25px;">Standard error</span>
            </a>
            <a href="http://timelyportfolio.blogspot.be/">
              <span style="color:grey;font-weight:bold;font-family:sans-serif;font-size:24px;">Timely portfolio</span>
            </a>
            <br/>
            <a href="https://antoineguillot.wordpress.com/blog/">
              <span style="color:white;background-color:darkblue;font-weight:bold;font-family:sans-serif;font-size:21px;border:5px solid;border-color:darkblue">ENHANCE DATA</span>
            </a>
            <br/>
            <a href="https://fronkonstin.com/">
              <span style="color:black;background-color:gold;font-weight:bold;font-size:29px;border:3px solid;border-color:gold;">Fronkonstin</span>
            </a>
          </div>
        </div>
        <div id="logos">
          <div class="row">
            <div class="col-sm-4">
              <img src="/images/AsymptoteLogo.svg" style="width: 150%; transform: rotateZ(-35deg)"/>
            </div>
            <div class="col-sm-4">
              <img src="/images/Rlogo.svg" style="width: 110%;"/>
            </div>
            <div class="col-sm-4">
              <img src="/images/shiny-hex.png" style="width: 90%;"/>
            </div>
          </div>
          <div class="row">
            <div class="col-sm-4">
              <img src="/images/Povray_logo_sphere.png" style="width: 105%;"/>
            </div>
            <div class="col-sm-4">
              <img src="/images/javascript.svg" style="width: 90%;"/>
            </div>
            <div class="col-sm-4">
              <img src="/images/haskell.svg" style="width: 110%;"/>
            </div>
          </div>
        </div>
      </div>

      <div class="main col-sm-10">
        <div id="header">
          <div id="logo">
            <a href="/">
              <img src="/images/stla.jpg" alt="stla" width="100px" />
            </a>
          </div>
          <div id="navigation" style="margin-top:50px;">
            <a href="/">Home</a>
            <a href="/about.html">About</a>
            <a href="/contact.html">Contact</a>
            <a href="/archive.html">Archive</a>
          </div>
        </div>

        <div class="content">
          <h1>Surface reconstruction with R(CGAL)</h1> 
          <div class="info">
    Posted on January 15, 2022
    
        by Stéphane Laurent
    
</div>
<div class="info">
    
    Tags: <a title="All pages tagged &#39;geometry&#39;." href="/tags/geometry.html">geometry</a>, <a title="All pages tagged &#39;R&#39;." href="/tags/R.html">R</a>, <a title="All pages tagged &#39;rgl&#39;." href="/tags/rgl.html">rgl</a>, <a title="All pages tagged &#39;graphics&#39;." href="/tags/graphics.html">graphics</a>, <a title="All pages tagged &#39;C++&#39;." href="/tags/C%2B%2B.html">C++</a>
    
</div>

<p>Eric Dunipace recently released a new package on CRAN: <strong>RcppCGAL</strong>. It allows to link to the C++ library <strong>CGAL</strong> in <strong>Rcpp</strong>. The <strong>CGAL</strong> library provides an extensive set of algorithms for computational geometry.</p>
<p>I made a package based on <strong>RcppCGAL</strong>, which I called <strong>RCGAL</strong>. Unfortunately, R CMD CHECK throws some warnings on Windows, so the package is not acceptable by CRAN, until this issue will be resolved. To install it:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true"></a>remotes<span class="op">::</span><span class="kw">install_github</span>(</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true"></a>  <span class="st">&quot;stla/RCGAL&quot;</span>, <span class="dt">dependencies =</span> <span class="ot">TRUE</span>, <span class="dt">build_opts =</span> <span class="st">&quot;--no-multiarch&quot;</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true"></a>)</span></code></pre></div>
<p>The compilation fails on Windows for R 32-bits, that is why I set the option <code>build_opts = "--no-multiarch"</code>. Fortunately, CRAN will soon abandon the 32-bits version of R.</p>
<p>The <strong>RCGAL</strong> package allows to do convex hulls and Delaunay tessellations in 2D or 3D, and provides two techniques of surface reconstruction: the <em>advanced front surface reconstruction</em> and the <em>Poisson surface reconstruction</em>. That is <strong>CGAL</strong> which does almost all the job, but the package also resorts to pure R programming.</p>
<p>Here we will have a look at the surface reconstruction methods.</p>
<h1 id="the-solid-möbius-strip-construction-sampling-reconstruction">The solid Möbius strip: construction, sampling, reconstruction</h1>
<p>The <em>solid Möbius strip</em> is an isosurface I found in <a href="http://data.imaginary-exhibition.com/IMAGINARY-Moebiusband-Stephan-Klaus.pdf">this paper</a>, and I like it.</p>
<p>Here is the code I use to construct a <strong>rgl</strong> mesh of the solid Möbius strip:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true"></a><span class="co"># solid Möbius strip: f(x,y,z)=0</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true"></a>f &lt;-<span class="st"> </span><span class="cf">function</span>(x, y, z, <span class="dt">a =</span> <span class="fl">0.4</span>, <span class="dt">b =</span> <span class="fl">0.1</span>){</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true"></a>  ((x<span class="op">*</span>x<span class="op">+</span>y<span class="op">*</span>y<span class="op">+</span><span class="dv">1</span>)<span class="op">*</span>(a<span class="op">*</span>x<span class="op">*</span>x<span class="op">+</span>b<span class="op">*</span>y<span class="op">*</span>y)<span class="op">+</span>z<span class="op">*</span>z<span class="op">*</span>(b<span class="op">*</span>x<span class="op">*</span>x<span class="op">+</span>a<span class="op">*</span>y<span class="op">*</span>y)<span class="op">-</span><span class="dv">2</span><span class="op">*</span>(a<span class="op">-</span>b)<span class="op">*</span>x<span class="op">*</span>y<span class="op">*</span>z<span class="op">-</span>a<span class="op">*</span>b<span class="op">*</span>(x<span class="op">*</span>x<span class="op">+</span>y<span class="op">*</span>y))<span class="op">^</span><span class="dv">2</span> <span class="op">-</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true"></a><span class="st">    </span><span class="dv">4</span><span class="op">*</span>(x<span class="op">*</span>x<span class="op">+</span>y<span class="op">*</span>y)<span class="op">*</span>(a<span class="op">*</span>x<span class="op">*</span>x<span class="op">+</span>b<span class="op">*</span>y<span class="op">*</span>y<span class="op">-</span>x<span class="op">*</span>y<span class="op">*</span>z<span class="op">*</span>(a<span class="op">-</span>b))<span class="op">^</span><span class="dv">2</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true"></a>}</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true"></a><span class="co"># run the marching cubes algorithm ####</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true"></a><span class="kw">library</span>(misc3d)</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true"></a>nx &lt;-<span class="st"> </span><span class="dv">120</span>; ny &lt;-<span class="st"> </span><span class="dv">120</span>; nz &lt;-<span class="st"> </span><span class="dv">120</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true"></a>x &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="op">-</span><span class="fl">1.4</span>, <span class="fl">1.4</span>, <span class="dt">length.out =</span> nx)</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true"></a>y &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="op">-</span><span class="fl">1.7</span>, <span class="fl">1.7</span>, <span class="dt">length.out =</span> ny)</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true"></a>z &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="op">-</span><span class="fl">0.7</span>, <span class="fl">0.7</span>, <span class="dt">length.out =</span> nz)</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true"></a>G &lt;-<span class="st"> </span><span class="kw">expand.grid</span>(<span class="dt">x =</span> x, <span class="dt">y =</span> y, <span class="dt">z =</span> z)</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true"></a>voxel &lt;-<span class="st"> </span><span class="kw">array</span>(<span class="kw">with</span>(G, <span class="kw">f</span>(x, y, z)), <span class="dt">dim =</span> <span class="kw">c</span>(nx, ny, nz))</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true"></a>surface &lt;-<span class="st"> </span><span class="kw">computeContour3d</span>(</span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true"></a>  voxel, <span class="dt">maxvol =</span> <span class="kw">max</span>(voxel), <span class="dt">level =</span> <span class="dv">0</span>, <span class="dt">x =</span> x, <span class="dt">y =</span> y, <span class="dt">z =</span> z</span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true"></a>)</span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true"></a><span class="co"># make rgl mesh</span></span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true"></a><span class="kw">library</span>(rgl)</span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true"></a>mesh0 &lt;-<span class="st"> </span>misc3d<span class="op">:::</span><span class="kw">t2ve</span>(<span class="kw">makeTriangles</span>(surface))</span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true"></a>mesh &lt;-<span class="st"> </span><span class="kw">addNormals</span>(<span class="kw">tmesh3d</span>(</span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true"></a>  <span class="dt">vertices =</span> mesh0[[<span class="st">&quot;vb&quot;</span>]],</span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true"></a>  <span class="dt">indices =</span> mesh0[[<span class="st">&quot;ib&quot;</span>]]</span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true"></a>))</span></code></pre></div>
<p><img src="figures/SolidMobiusStrip_original.gif" /></p>
<p>This mesh is quite smooth. It has <span class="math inline">\(73544\)</span> (non-duplicated) vertices:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true"></a>mesh</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true"></a><span class="co">##  mesh3d object with 73544 vertices, 147088 triangles.</span></span></code></pre></div>
<h2 id="sampling-the-solid-möbius-strip">Sampling the solid Möbius strip</h2>
<p>Here we sample a subset of the vertices of the solid Möbius strip mesh, and later we will reconstruct the surface from this sample. I could select some vertices at random, but I prefer to use the uniform sampling performed by the <code>vcgUniformRemesh</code> function of the <strong>Rvcg</strong> package:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true"></a><span class="kw">library</span>(Rvcg)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true"></a><span class="co">## </span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true"></a><span class="co">## Attaching package: &#39;Rvcg&#39;</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true"></a><span class="co">## The following object is masked _by_ &#39;.GlobalEnv&#39;:</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true"></a><span class="co">## </span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true"></a><span class="co">##     nverts</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true"></a>resample_mesh &lt;-<span class="st"> </span><span class="kw">vcgUniformRemesh</span>(mesh, <span class="dt">voxelSize =</span> <span class="fl">0.06</span>)</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true"></a><span class="co">##      Resampling mesh using a volume of 58 x 69 x 35</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true"></a><span class="co">##      VoxelSize is 0.060000, offset is 0.000000</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true"></a><span class="co">##      Mesh Box is 2.630913 3.263203 1.264488</span></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true"></a><span class="kw">str</span>(resample_mesh)</span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true"></a><span class="co">## List of 3</span></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true"></a><span class="co">##  $ vb     : num [1:4, 1:7948] -0.302 -1.59 -0.118 1 -0.322 ...</span></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true"></a><span class="co">##  $ it     : int [1:3, 1:15896] 1 2 3 3 2 4 1 5 6 3 ...</span></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true"></a><span class="co">##  $ normals: num [1:4, 1:7948] 0.207 0.951 0.23 1 0.271 ...</span></span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true"></a><span class="co">##  - attr(*, &quot;class&quot;)= chr &quot;mesh3d&quot;</span></span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true"></a>SolidMobiusStrip_cloud &lt;-<span class="st"> </span><span class="kw">t</span>(resample_mesh[[<span class="st">&quot;vb&quot;</span>]][<span class="op">-</span>4L, ])</span></code></pre></div>
<p>Here is our points cloud (I mean the sample):</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true"></a><span class="kw">open3d</span>(<span class="dt">windowRect =</span> <span class="kw">c</span>(<span class="dv">50</span>, <span class="dv">50</span>, <span class="dv">562</span>, <span class="dv">562</span>))</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true"></a><span class="kw">view3d</span>(<span class="dv">0</span>, <span class="dv">-50</span>, <span class="dt">zoom =</span> <span class="fl">0.75</span>)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true"></a><span class="kw">spheres3d</span>(SolidMobiusStrip_cloud, <span class="dt">radius =</span> <span class="fl">0.015</span>)</span></code></pre></div>
<p><img src="figures/SolidMobiusStrip_cloud.png" /></p>
<p>It has <span class="math inline">\(7948\)</span> points:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true"></a><span class="kw">nrow</span>(SolidMobiusStrip_cloud)</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true"></a><span class="co">## [1] 7948</span></span></code></pre></div>
<h2 id="advanced-front-surface-reconstruction">Advanced front surface reconstruction</h2>
<p>We run the first surface reconstruction algorithm, the <em>advanced front surface reconstruction</em>. Is is performed by the <code>AFSreconstruction</code> function of the <strong>RCGAL</strong> package, which has no parameters arguments; it only takes the points cloud as argument:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true"></a><span class="kw">library</span>(RCGAL)</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true"></a>afs_mesh &lt;-<span class="st"> </span><span class="kw">AFSreconstruction</span>(SolidMobiusStrip_cloud)</span></code></pre></div>
<p>Let’s plot this mesh (this is a triangular <strong>rgl</strong> mesh, of class <code>mesh3d</code>):</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true"></a><span class="kw">open3d</span>(<span class="dt">windowRect =</span> <span class="kw">c</span>(<span class="dv">50</span>, <span class="dv">50</span>, <span class="dv">562</span>, <span class="dv">562</span>))</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true"></a><span class="kw">view3d</span>(<span class="dv">0</span>, <span class="dv">-50</span>, <span class="dt">zoom =</span> <span class="fl">0.75</span>)</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true"></a><span class="kw">shade3d</span>(afs_mesh, <span class="dt">color =</span> <span class="st">&quot;darkred&quot;</span>)</span></code></pre></div>
<p><img src="figures/SolidMobiusStrip_AFS.png" /></p>
<p>Well it is not very smooth, but not too bad. Note that the advanced front surface reconstruction algorithm does not alter the vertices of the given points cloud, it doesn’t change them at all. So this mesh has <span class="math inline">\(7948\)</span> vertices:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true"></a>afs_mesh</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true"></a><span class="co">##  mesh3d object with 7948 vertices, 15896 triangles.</span></span></code></pre></div>
<p>Remember that the original mesh had <span class="math inline">\(73544\)</span> vertices.</p>
<p>Let’s compare with the <em>ball-pivoting</em> algorithm provided by the <strong>Rvcg</strong> package:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true"></a>bp_mesh &lt;-<span class="st"> </span><span class="kw">addNormals</span>(<span class="kw">vcgBallPivoting</span>(</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true"></a>  SolidMobiusStrip_cloud, <span class="dt">angle =</span> pi<span class="op">/</span><span class="dv">6</span>, <span class="dt">clustering =</span> <span class="fl">0.01</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true"></a>))</span></code></pre></div>
<p>The smoothness is similar but there is a couple of holes in the mesh:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true"></a><span class="kw">open3d</span>(<span class="dt">windowRect =</span> <span class="kw">c</span>(<span class="dv">50</span>, <span class="dv">50</span>, <span class="dv">562</span>, <span class="dv">562</span>))</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true"></a><span class="kw">view3d</span>(<span class="dv">0</span>, <span class="dv">-50</span>, <span class="dt">zoom =</span> <span class="fl">0.75</span>)</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true"></a><span class="kw">shade3d</span>(bp_mesh, <span class="dt">color =</span> <span class="st">&quot;firebrick&quot;</span>) </span></code></pre></div>
<p><img src="figures/SolidMobiusStrip_BP.png" /></p>
<p>We can get a smoother mesh and get rid of these holes by applying a mesh smoothing technique, such as the ones offered by the <code>vcgSmooth</code> function of the <strong>Rvcg</strong> package:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true"></a>smooth_bp_mesh &lt;-<span class="st"> </span><span class="kw">vcgSmooth</span>(bp_mesh, <span class="dt">iteration =</span> <span class="dv">50</span>)</span></code></pre></div>
<p>This is indeed better:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true"></a><span class="kw">open3d</span>(<span class="dt">windowRect =</span> <span class="kw">c</span>(<span class="dv">50</span>, <span class="dv">50</span>, <span class="dv">562</span>, <span class="dv">562</span>))</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true"></a><span class="kw">view3d</span>(<span class="dv">0</span>, <span class="dv">-50</span>, <span class="dt">zoom =</span> <span class="fl">0.75</span>)</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true"></a><span class="kw">shade3d</span>(smooth_bp_mesh, <span class="dt">color =</span> <span class="st">&quot;firebrick1&quot;</span>)</span></code></pre></div>
<p><img src="figures/SolidMobiusStrip_BP_smooth.png" /></p>
<p>The smooth mesh still has <span class="math inline">\(7948\)</span> vertices:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true"></a>smooth_bp_mesh</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true"></a><span class="co">##  mesh3d object with 7948 vertices, 15822 triangles.</span></span></code></pre></div>
<p>Of course we could apply <code>vcgSmooth</code> to our <code>afs_mesh</code> as well.</p>
<h2 id="poisson-reconstruction-of-the-solid-möbius-strip">Poisson reconstruction of the solid Möbius strip</h2>
<p>Now let’s try the <em>Poisson surface reconstruction</em>, available in <strong>RCGAL</strong>.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true"></a>psr_mesh &lt;-<span class="st"> </span><span class="kw">PoissonReconstruction</span>(SolidMobiusStrip_cloud)</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true"></a><span class="co">## Poisson reconstruction using average spacing: 0.04682.</span></span></code></pre></div>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true"></a><span class="kw">open3d</span>(<span class="dt">windowRect =</span> <span class="kw">c</span>(<span class="dv">50</span>, <span class="dv">50</span>, <span class="dv">562</span>, <span class="dv">562</span>))</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true"></a><span class="kw">view3d</span>(<span class="dv">0</span>, <span class="dv">-50</span>, <span class="dt">zoom =</span> <span class="fl">0.75</span>)</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true"></a><span class="kw">shade3d</span>(psr_mesh, <span class="dt">color =</span> <span class="st">&quot;orangered&quot;</span>)</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true"></a><span class="kw">wire3d</span>(psr_mesh)</span></code></pre></div>
<p><img src="figures/SolidMobiusStrip_Poisson_default.png" /></p>
<p>Clearly, that’s not smooth! But wait, there are only <span class="math inline">\(604\)</span> vertices in this mesh:</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true"></a>psr_mesh</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true"></a><span class="co">##  mesh3d object with 604 vertices, 1208 triangles.</span></span></code></pre></div>
<p>The Poisson reconstruction algorithm takes some parameters as input, and we can reduce the <code>spacing</code> parameter to get a more precise mesh, at the cost of a higher computation time:</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true"></a>psr_mesh &lt;-<span class="st"> </span><span class="kw">PoissonReconstruction</span>(SolidMobiusStrip_cloud, <span class="dt">spacing =</span> <span class="fl">0.005</span>)</span></code></pre></div>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true"></a><span class="kw">open3d</span>(<span class="dt">windowRect =</span> <span class="kw">c</span>(<span class="dv">50</span>, <span class="dv">50</span>, <span class="dv">562</span>, <span class="dv">562</span>))</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true"></a><span class="kw">view3d</span>(<span class="dv">0</span>, <span class="dv">-50</span>, <span class="dt">zoom =</span> <span class="fl">0.75</span>)</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true"></a><span class="kw">shade3d</span>(psr_mesh, <span class="dt">color =</span> <span class="st">&quot;orangered&quot;</span>)</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true"></a><span class="kw">wire3d</span>(psr_mesh)</span></code></pre></div>
<p><img src="figures/SolidMobiusStrip_Poisson_spacing005.png" /></p>
<p>On one hand, the mesh is better, but on the other hand it has some small defaults (not highly visible on this view, try to reproduce the mesh and rotate it, you’ll see). It has <span class="math inline">\(28726\)</span> vertices:</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true"></a>psr_mesh</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true"></a><span class="co">##  mesh3d object with 28726 vertices, 57556 triangles.</span></span></code></pre></div>
<p>It has some defaults because, I think, some triangles are too small. We can increase the trianges while keeping the <code>spacing</code> parameter by increasing the <code>sm_distance</code> parameter (whose defaut value is <span class="math inline">\(0.375\)</span>):</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true"></a>psr_mesh &lt;-<span class="st"> </span><span class="kw">PoissonReconstruction</span>(</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true"></a>  SolidMobiusStrip_cloud, <span class="dt">spacing =</span> <span class="fl">0.005</span>, <span class="dt">sm_distance =</span> <span class="fl">0.9</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true"></a>)</span></code></pre></div>
<p>This reduces the computation time. Here is the result:</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true"></a><span class="kw">open3d</span>(<span class="dt">windowRect =</span> <span class="kw">c</span>(<span class="dv">50</span>, <span class="dv">50</span>, <span class="dv">562</span>, <span class="dv">562</span>))</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true"></a><span class="kw">view3d</span>(<span class="dv">0</span>, <span class="dv">-50</span>, <span class="dt">zoom =</span> <span class="fl">0.75</span>)</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true"></a><span class="kw">shade3d</span>(psr_mesh, <span class="dt">color =</span> <span class="st">&quot;darkorange&quot;</span>)</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true"></a><span class="kw">wire3d</span>(psr_mesh)</span></code></pre></div>
<p><img src="figures/SolidMobiusStrip_Poisson_spacing005_smdistance09.png" /></p>
<p>Quite good! And the mesh has only <span class="math inline">\(3055\)</span> vertices:</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true"></a>psr_mesh</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true"></a><span class="co">##  mesh3d object with 3055 vertices, 6110 triangles.</span></span></code></pre></div>
<h1 id="the-stanford-bunny">The Stanford bunny</h1>
<p>Now let’s try these surface reconstruction techniques to another points cloud, a famous one: the <em>Stanford bunny</em> points cloud. It has <span class="math inline">\(35947\)</span> points:</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true"></a><span class="kw">data</span>(bunny, <span class="dt">package =</span> <span class="st">&quot;onion&quot;</span>)</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true"></a><span class="kw">nrow</span>(bunny)</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true"></a><span class="co">## [1] 35947</span></span></code></pre></div>
<p>This set of points is dense. Plotting it almost gives a totally black shape:</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true"></a><span class="kw">open3d</span>(<span class="dt">windowRect =</span> <span class="kw">c</span>(<span class="dv">50</span>, <span class="dv">50</span>, <span class="dv">562</span>, <span class="dv">562</span>))</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true"></a><span class="kw">view3d</span>(<span class="dt">zoom =</span> <span class="fl">0.75</span>)</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true"></a><span class="kw">points3d</span>(bunny)</span></code></pre></div>
<p><img src="figures/Bunny_cloud.png" /></p>
<p>Firstly, let’s try the advanced front surface reconstruction:</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true"></a>afs_mesh &lt;-<span class="st"> </span><span class="kw">AFSreconstruction</span>(bunny)</span></code></pre></div>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true"></a><span class="kw">open3d</span>(<span class="dt">windowRect =</span> <span class="kw">c</span>(<span class="dv">50</span>, <span class="dv">50</span>, <span class="dv">562</span>, <span class="dv">562</span>))</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true"></a><span class="kw">view3d</span>(<span class="dt">zoom =</span> <span class="fl">0.75</span>)</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true"></a><span class="kw">shade3d</span>(afs_mesh, <span class="dt">color =</span> <span class="st">&quot;violetred&quot;</span>)</span></code></pre></div>
<p><img src="figures/Bunny_AFS.png" /></p>
<p>Quite nice. Now here is a Poisson reconstruction, with some parameters chosen by myself (the mesh is not precise enough with the default values of the parameters):</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true"></a>psr_mesh &lt;-<span class="st"> </span><span class="kw">PoissonReconstruction</span>(bunny, <span class="dt">spacing =</span> <span class="fl">0.0001</span>, <span class="dt">sm_distance =</span> <span class="fl">0.9</span>)</span></code></pre></div>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true"></a><span class="kw">open3d</span>(<span class="dt">windowRect =</span> <span class="kw">c</span>(<span class="dv">50</span>, <span class="dv">50</span>, <span class="dv">562</span>, <span class="dv">562</span>))</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true"></a><span class="kw">view3d</span>(<span class="dt">zoom =</span> <span class="fl">0.75</span>)</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true"></a><span class="kw">shade3d</span>(psr_mesh, <span class="dt">color =</span> <span class="st">&quot;darkviolet&quot;</span>)</span></code></pre></div>
<p><img src="figures/Bunny_Poisson.png" /></p>
<p>The mesh has less details than the previous one but it has only <span class="math inline">\(20693\)</span> vertices:</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true"></a>psr_mesh</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true"></a><span class="co">##  mesh3d object with 20693 vertices, 41382 triangles.</span></span></code></pre></div>
<h1 id="the-stanford-dragon">The Stanford dragon</h1>
<p>Finally, let’s play with the <em>Stanford dragon</em>. I found a points cloud of it containing <span class="math inline">\(100250\)</span> points. It is so dense that its plot is a totally black shape:</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true"></a><span class="kw">open3d</span>(<span class="dt">windowRect =</span> <span class="kw">c</span>(<span class="dv">50</span>, <span class="dv">50</span>, <span class="dv">562</span>, <span class="dv">562</span>))</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true"></a><span class="kw">view3d</span>(<span class="dt">zoom =</span> <span class="fl">0.75</span>)</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true"></a><span class="kw">points3d</span>(StanfordDragon)</span></code></pre></div>
<p><img src="figures/StanfordDragon_cloud.png" /></p>
<p>Let’s start with the advanced front surface reconstruction (the <code>StanfordDragon</code> matrix is provided by <strong>RCGAL</strong>):</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true"></a>afs_mesh &lt;-<span class="st"> </span><span class="kw">AFSreconstruction</span>(StanfordDragon)</span></code></pre></div>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true"></a><span class="kw">open3d</span>(<span class="dt">windowRect =</span> <span class="kw">c</span>(<span class="dv">50</span>, <span class="dv">50</span>, <span class="dv">562</span>, <span class="dv">562</span>))</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true"></a><span class="kw">view3d</span>(<span class="op">-</span><span class="dv">20</span>, <span class="dt">zoom =</span> <span class="fl">0.8</span>)</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true"></a><span class="kw">shade3d</span>(afs_mesh, <span class="dt">color =</span> <span class="st">&quot;darkolivegreen4&quot;</span>)</span></code></pre></div>
<p><img src="figures/StanfordDragon_AFS.png" /></p>
<p>Very nice. And to finish, let’s try a Poisson reconstruction.</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true"></a>psr_mesh &lt;-<span class="st"> </span><span class="kw">PoissonReconstruction</span>(StanfordDragon, <span class="dt">spacing =</span> <span class="fl">0.0003</span>)</span></code></pre></div>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true"></a><span class="kw">open3d</span>(<span class="dt">windowRect =</span> <span class="kw">c</span>(<span class="dv">50</span>, <span class="dv">50</span>, <span class="dv">562</span>, <span class="dv">562</span>))</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true"></a><span class="kw">view3d</span>(<span class="op">-</span><span class="dv">20</span>, <span class="dt">zoom =</span> <span class="fl">0.8</span>)</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true"></a><span class="kw">shade3d</span>(psr_mesh, <span class="dt">color =</span> <span class="st">&quot;forestgreen&quot;</span>)</span></code></pre></div>
<p><img src="figures/StanfordDragon_Poisson.png" /></p>
<p>Less vertices, less details!</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true"></a>psr_mesh</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true"></a><span class="co">##  mesh3d object with 32064 vertices, 64152 triangles.</span></span></code></pre></div>
<h1 id="acknowledgments">Acknowledgments</h1>
<p>I am grateful to the <strong>CGAL</strong> members, especially <strong><span class="citation" data-cites="sloriot">@sloriot</span></strong> and <strong><span class="citation" data-cites="afabri">@afabri</span></strong>, for the help they provided to me and for the attention they pay to my questions.</p>

        </div>


        <div id="footer">
          Site proudly generated by
          <a href="http://jaspervdj.be/hakyll">Hakyll</a>
        </div>

      </div>

    </div>

    <div class="row">
      <div class="col-sm-12">
        <div id="disqus_thread"></div>
        <div class="pagination">
          <ul>
            <li>
              <a href="http://laustep.github.io/stlahblog/">&#171; Back Home</a>
            </li>
          </ul>
        </div>
      </div>
    </div>
    
  </div>

</body>

<script src="/libraries/bootstrap/bootstrap.min.js"></script>
<script>
  var disqus_developer = 1;
  var disqus_shortname = 'stlapblog';
  // required: replace example with your forum shortname
  /* * * DON'T EDIT BELOW THIS LINE * * */
  (function () {
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = 'https://' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] ||
      document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>
<noscript>Please enable JavaScript to view the
  <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a>
</noscript>
<!-- MathJax: Fall back to local if CDN offline but local image fonts are not supported (saves >100MB) -->
<script type="text/x-mathjax-config" src="/libraries/mathjax/config/TeX-MML-AM_CHTML.js"></script>
<!-- <script>
  window.MathJax || document.write('<script type="text/x-mathjax-config">MathJax.Hub.Config({"HTML-CSS":{imageFont:null}});<\/script><script src="../libraries/mathjax/MathJax.js"><\/script>');
</script> -->


</html>]]></description>
    <pubDate>Sat, 15 Jan 2022 00:00:00 UT</pubDate>
    <guid>https://laustep.github.io/stlahblog/posts/SurfaceReconstruction.html</guid>
    <dc:creator>Stéphane Laurent</dc:creator>
    <category>R</category>
</item>


<item>
    <title>Clipping an isosurface to a ball, and more</title>
    <link>https://laustep.github.io/stlahblog/posts/MeshClipping.html</link>
    <description><![CDATA[<!DOCTYPE HTML>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Saturn Elephant - Clipping an isosurface to a ball, and more</title>
  <link href="/libraries/bootstrap/bootstrap-grid.min.css" rel="stylesheet">
  <link rel="stylesheet" href="/css/default2.css" />
  <link rel="stylesheet" href="/css/post.css" />
  <link rel="stylesheet" href="/css/misc.css" /> 
  
    <link rel="stylesheet" href="/css/pandoc-solarized.css" /> 
   
  
  <link href="https://fonts.googleapis.com/css?family=Raleway:400,600,200,800" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/css?family=Droid+Sans" rel="stylesheet" type="text/css">
  <script src="/libraries/jquery.min.js"></script>
  <script type="text/javascript" async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML"></script>
</head>

<body>
  <div class="container-fluid">
    <div class="row">
      <!-- Sidebar. -->
      <div class="sidebar col-sm-2">
        <div class="row">
          <div class="col-sm-12" style="float:right;clear:both;margin-right:50px;margin-top:50px;">
            <a href="https://www.r-bloggers.com/">
              <img src="/images/Rbloggers.png" alt="Rbloggers" width="100%" />
            </a>
            <br/>
            <a href="http://t-redactyl.io/">
              <span style="color:black;font-weight:bold;font-family:sans-serif;font-size:25px;">Standard error</span>
            </a>
            <a href="http://timelyportfolio.blogspot.be/">
              <span style="color:grey;font-weight:bold;font-family:sans-serif;font-size:24px;">Timely portfolio</span>
            </a>
            <br/>
            <a href="https://antoineguillot.wordpress.com/blog/">
              <span style="color:white;background-color:darkblue;font-weight:bold;font-family:sans-serif;font-size:21px;border:5px solid;border-color:darkblue">ENHANCE DATA</span>
            </a>
            <br/>
            <a href="https://fronkonstin.com/">
              <span style="color:black;background-color:gold;font-weight:bold;font-size:29px;border:3px solid;border-color:gold;">Fronkonstin</span>
            </a>
          </div>
        </div>
        <div id="logos">
          <div class="row">
            <div class="col-sm-4">
              <img src="/images/AsymptoteLogo.svg" style="width: 150%; transform: rotateZ(-35deg)"/>
            </div>
            <div class="col-sm-4">
              <img src="/images/Rlogo.svg" style="width: 110%;"/>
            </div>
            <div class="col-sm-4">
              <img src="/images/shiny-hex.png" style="width: 90%;"/>
            </div>
          </div>
          <div class="row">
            <div class="col-sm-4">
              <img src="/images/Povray_logo_sphere.png" style="width: 105%;"/>
            </div>
            <div class="col-sm-4">
              <img src="/images/javascript.svg" style="width: 90%;"/>
            </div>
            <div class="col-sm-4">
              <img src="/images/haskell.svg" style="width: 110%;"/>
            </div>
          </div>
        </div>
      </div>

      <div class="main col-sm-10">
        <div id="header">
          <div id="logo">
            <a href="/">
              <img src="/images/stla.jpg" alt="stla" width="100px" />
            </a>
          </div>
          <div id="navigation" style="margin-top:50px;">
            <a href="/">Home</a>
            <a href="/about.html">About</a>
            <a href="/contact.html">Contact</a>
            <a href="/archive.html">Archive</a>
          </div>
        </div>

        <div class="content">
          <h1>Clipping an isosurface to a ball, and more</h1> 
          <div class="info">
    Posted on January 14, 2022
    
        by Stéphane Laurent
    
</div>
<div class="info">
    
    Tags: <a title="All pages tagged &#39;geometry&#39;." href="/tags/geometry.html">geometry</a>, <a title="All pages tagged &#39;R&#39;." href="/tags/R.html">R</a>, <a title="All pages tagged &#39;rgl&#39;." href="/tags/rgl.html">rgl</a>, <a title="All pages tagged &#39;misc3d&#39;." href="/tags/misc3d.html">misc3d</a>, <a title="All pages tagged &#39;graphics&#39;." href="/tags/graphics.html">graphics</a>, <a title="All pages tagged &#39;python&#39;." href="/tags/python.html">python</a>, <a title="All pages tagged &#39;pyvista&#39;." href="/tags/pyvista.html">pyvista</a>
    
</div>

<p>We will firstly show how to clip an isosurface to a ball with R, and then, more generally, how to clip a surface to an arbitrary region. In the last part we show how to achieve the same with Python.</p>
<h1 id="using-r">Using R</h1>
<h2 id="the-togliatti-isosurface-clipped-to-a-box">The Togliatti isosurface, clipped to a box</h2>
<p>The Togliatti surface is the isosurface <span class="math inline">\(f(x, y, z) = 0\)</span>, where the function <span class="math inline">\(f\)</span> is defined as follows in R:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true"></a>f &lt;-<span class="st"> </span><span class="cf">function</span>(x,y,z){</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true"></a>  <span class="dv">64</span><span class="op">*</span>(x<span class="dv">-1</span>)<span class="op">*</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true"></a><span class="st">    </span>(x<span class="op">^</span><span class="dv">4-4</span><span class="op">*</span>x<span class="op">^</span><span class="dv">3-10</span><span class="op">*</span>x<span class="op">^</span><span class="dv">2</span><span class="op">*</span>y<span class="op">^</span><span class="dv">2-4</span><span class="op">*</span>x<span class="op">^</span><span class="dv">2</span><span class="op">+</span><span class="dv">16</span><span class="op">*</span>x<span class="dv">-20</span><span class="op">*</span>x<span class="op">*</span>y<span class="op">^</span><span class="dv">2</span><span class="op">+</span><span class="dv">5</span><span class="op">*</span>y<span class="op">^</span><span class="dv">4</span><span class="op">+</span><span class="dv">16-20</span><span class="op">*</span>y<span class="op">^</span><span class="dv">2</span>) <span class="op">-</span><span class="st"> </span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true"></a><span class="st">    </span><span class="dv">5</span><span class="op">*</span><span class="kw">sqrt</span>(<span class="dv">5</span><span class="op">-</span><span class="kw">sqrt</span>(<span class="dv">5</span>))<span class="op">*</span>(<span class="dv">2</span><span class="op">*</span>z<span class="op">-</span><span class="kw">sqrt</span>(<span class="dv">5</span><span class="op">-</span><span class="kw">sqrt</span>(<span class="dv">5</span>)))<span class="op">*</span>(<span class="dv">4</span><span class="op">*</span>(x<span class="op">^</span><span class="dv">2</span><span class="op">+</span>y<span class="op">^</span><span class="dv">2</span><span class="op">-</span>z<span class="op">^</span><span class="dv">2</span>)<span class="op">+</span>(<span class="dv">1</span><span class="op">+</span><span class="dv">3</span><span class="op">*</span><span class="kw">sqrt</span>(<span class="dv">5</span>)))<span class="op">^</span><span class="dv">2</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true"></a>}</span></code></pre></div>
<p>To plot an isosurface in R, there is the <strong>misc3d</strong> package. Below we plot the Togliatti surface clipped to the box <span class="math inline">\([-5,5] \times [-5,5] \times [-4,4]\)</span>.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true"></a><span class="kw">library</span>(misc3d)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true"></a><span class="co"># make grid</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true"></a>nx &lt;-<span class="st"> </span>220L; ny &lt;-<span class="st"> </span>220L; nz &lt;-<span class="st"> </span>220L</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true"></a>x &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="op">-</span><span class="dv">5</span>, <span class="dv">5</span>, <span class="dt">length.out =</span> nx) </span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true"></a>y &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="op">-</span><span class="dv">5</span>, <span class="dv">5</span>, <span class="dt">length.out =</span> ny)</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true"></a>z &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="op">-</span><span class="dv">4</span>, <span class="dv">4</span>, <span class="dt">length.out =</span> nz) </span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true"></a>G &lt;-<span class="st"> </span><span class="kw">expand.grid</span>(<span class="dt">x =</span> x, <span class="dt">y =</span> y, <span class="dt">z =</span> z)</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true"></a><span class="co"># calculate voxel</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true"></a>voxel &lt;-<span class="st"> </span><span class="kw">array</span>(<span class="kw">with</span>(G, <span class="kw">f</span>(x, y, z)), <span class="dt">dim =</span> <span class="kw">c</span>(nx, ny, nz))</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true"></a><span class="co"># compute isosurface</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true"></a>surf1 &lt;-<span class="st"> </span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true"></a><span class="st">  </span><span class="kw">computeContour3d</span>(voxel, <span class="dt">maxvol =</span> <span class="kw">max</span>(voxel), <span class="dt">level =</span> <span class="dv">0</span>, <span class="dt">x =</span> x, <span class="dt">y =</span> y, <span class="dt">z =</span> z)</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true"></a><span class="co"># make triangles</span></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true"></a>triangles &lt;-<span class="st"> </span><span class="kw">makeTriangles</span>(surf1, <span class="dt">smooth =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true"></a><span class="kw">drawScene.rgl</span>(triangles, <span class="dt">color =</span> <span class="st">&quot;yellowgreen&quot;</span>)</span></code></pre></div>
<p><img src="figures/Togliatti_box.gif" /></p>
<p>It is fun, but you will see later that it is prettier when clipped to a ball. And it is desirable to get rid of the isolated components at the top.</p>
<p>The simplest way to clip the surface to a ball consists in using the <code>mask</code> argument of the function <code>computeContour3d</code>. We use <span class="math inline">\(4.8\)</span> as the radius.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true"></a>mask &lt;-<span class="st"> </span><span class="kw">array</span>(<span class="kw">with</span>(G, x<span class="op">^</span><span class="dv">2</span><span class="op">+</span>y<span class="op">^</span><span class="dv">2</span><span class="op">+</span>z<span class="op">^</span><span class="dv">2</span> <span class="op">&lt;</span><span class="st"> </span><span class="fl">4.8</span><span class="op">^</span><span class="dv">2</span>), <span class="dt">dim =</span> <span class="kw">c</span>(nx, ny, nz))</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true"></a>surf2 &lt;-<span class="st"> </span><span class="kw">computeContour3d</span>(</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true"></a>  voxel, <span class="dt">maxvol =</span> <span class="kw">max</span>(voxel), <span class="dt">level =</span> <span class="dv">0</span>, <span class="dt">mask =</span> mask, <span class="dt">x =</span> x, <span class="dt">y =</span> y, <span class="dt">z =</span> z</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true"></a>)</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true"></a>triangles &lt;-<span class="st"> </span><span class="kw">makeTriangles</span>(surf2, <span class="dt">smooth =</span> <span class="ot">TRUE</span>)</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true"></a><span class="kw">drawScene.rgl</span>(triangles, <span class="dt">color =</span> <span class="st">&quot;orange&quot;</span>)</span></code></pre></div>
<p><img src="figures/Togliatti_mask.gif" /></p>
<p>That’s not bad, but you see the problem: the borders are not smooth.</p>
<h2 id="resorting-to-spherical-coordinates">Resorting to spherical coordinates</h2>
<p>Using spherical coordinates will allow us to get the surface clipped to the ball with smooth borders. Here is the method:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true"></a><span class="co"># Togliatti surface equation with spherical coordinates</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true"></a>h &lt;-<span class="st"> </span><span class="cf">function</span>(ρ, θ, ϕ){</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true"></a>  x &lt;-<span class="st"> </span>ρ <span class="op">*</span><span class="st"> </span><span class="kw">cos</span>(θ) <span class="op">*</span><span class="st"> </span><span class="kw">sin</span>(ϕ)</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true"></a>  y &lt;-<span class="st"> </span>ρ <span class="op">*</span><span class="st"> </span><span class="kw">sin</span>(θ) <span class="op">*</span><span class="st"> </span><span class="kw">sin</span>(ϕ)</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true"></a>  z &lt;-<span class="st"> </span>ρ <span class="op">*</span><span class="st"> </span><span class="kw">cos</span>(ϕ)</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true"></a>  <span class="kw">f</span>(x, y, z)</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true"></a>}</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true"></a><span class="co"># make grid</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true"></a>nρ &lt;-<span class="st"> </span>300L; nθ &lt;-<span class="st"> </span>300L; nϕ &lt;-<span class="st"> </span>300L</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true"></a>ρ &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="dv">0</span>, <span class="fl">4.8</span>, <span class="dt">length.out =</span> nρ) <span class="co"># ρ runs from 0 to the desired radius</span></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true"></a>θ &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="dv">0</span>, <span class="dv">2</span><span class="op">*</span>pi, <span class="dt">length.out =</span> nθ)</span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true"></a>ϕ &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="dv">0</span>, pi, <span class="dt">length.out =</span> nϕ) </span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true"></a>G &lt;-<span class="st"> </span><span class="kw">expand.grid</span>(ρ=ρ, θ=θ, ϕ=ϕ)</span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true"></a><span class="co"># calculate voxel</span></span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true"></a>voxel &lt;-<span class="st"> </span><span class="kw">array</span>(<span class="kw">with</span>(G, <span class="kw">h</span>(ρ, θ, ϕ)), <span class="dt">dim =</span> <span class="kw">c</span>(nρ, nθ, nϕ))</span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true"></a><span class="co"># calculate isosurface</span></span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true"></a>surf3 &lt;-<span class="st"> </span></span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true"></a><span class="st">  </span><span class="kw">computeContour3d</span>(voxel, <span class="dt">maxvol =</span> <span class="kw">max</span>(voxel), <span class="dt">level =</span> <span class="dv">0</span>, <span class="dt">x =</span> ρ, <span class="dt">y =</span> θ, <span class="dt">z =</span> ϕ)</span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true"></a><span class="co"># transform to Cartesian coordinates</span></span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true"></a>surf3 &lt;-<span class="st"> </span><span class="kw">t</span>(<span class="kw">apply</span>(surf3, 1L, <span class="cf">function</span>(ρθϕ){</span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true"></a>  ρ &lt;-<span class="st"> </span>ρθϕ[1L]; θ &lt;-<span class="st"> </span>ρθϕ[2L]; ϕ &lt;-<span class="st"> </span>ρθϕ[3L] </span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true"></a>  <span class="kw">c</span>(</span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true"></a>    ρ <span class="op">*</span><span class="st"> </span><span class="kw">cos</span>(θ) <span class="op">*</span><span class="st"> </span><span class="kw">sin</span>(ϕ),</span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true"></a>    ρ <span class="op">*</span><span class="st"> </span><span class="kw">sin</span>(θ) <span class="op">*</span><span class="st"> </span><span class="kw">sin</span>(ϕ),</span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true"></a>    ρ <span class="op">*</span><span class="st"> </span><span class="kw">cos</span>(ϕ)</span>
<span id="cb5-26"><a href="#cb5-26" aria-hidden="true"></a>  )</span>
<span id="cb5-27"><a href="#cb5-27" aria-hidden="true"></a>}))</span>
<span id="cb5-28"><a href="#cb5-28" aria-hidden="true"></a><span class="co"># draw isosurface</span></span>
<span id="cb5-29"><a href="#cb5-29" aria-hidden="true"></a><span class="kw">drawScene.rgl</span>(<span class="kw">makeTriangles</span>(surf3, <span class="dt">smooth=</span><span class="ot">TRUE</span>), <span class="dt">color =</span> <span class="st">&quot;violetred&quot;</span>)</span></code></pre></div>
<p><img src="figures/Togliatti_spherical.gif" /></p>
<p>Now the surface is pretty nice. The borders are smooth.</p>
<h2 id="another-way-using-the-rgl-package">Another way: using the rgl package</h2>
<p>Nowadays, in the <strong>rgl</strong> package, there is the function <code>clipMesh3d</code> which allows to <em>clip a mesh to a general region</em>. In order to use it, we need a <code>mesh3d</code> object. There is an unexported function in <strong>misc3d</strong> which allows to easily get a <code>mesh3d</code> object; it is called <code>t2ve</code>.</p>
<p>We start with the isosurface clipped to the box:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true"></a>triangles &lt;-<span class="st"> </span><span class="kw">makeTriangles</span>(surf1)</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true"></a><span class="co"># convert to rgl `mesh3d`</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true"></a>mesh &lt;-<span class="st"> </span>misc3d<span class="op">:::</span><span class="kw">t2ve</span>(triangles)</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true"></a>rglmesh &lt;-<span class="st"> </span><span class="kw">tmesh3d</span>(mesh<span class="op">$</span>vb, mesh<span class="op">$</span>ib)</span></code></pre></div>
<p>To define the region to which we want to clip the mesh, one has to introduce a function and to give a bound for this function. Here the region is <span class="math inline">\(x^2 + y^2 + z^2 &lt; 4.8^2\)</span>, so we proceed as follows:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true"></a>fn &lt;-<span class="st"> </span><span class="cf">function</span>(x, y, z) x<span class="op">^</span><span class="dv">2</span> <span class="op">+</span><span class="st"> </span>y<span class="op">^</span><span class="dv">2</span> <span class="op">+</span><span class="st"> </span>z<span class="op">^</span><span class="dv">2</span> <span class="co"># or function(xyz) rowSums(xyz^2)</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true"></a>clippedmesh &lt;-<span class="st"> </span><span class="kw">addNormals</span>(<span class="kw">clipMesh3d</span>(</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true"></a>  rglmesh, fn, <span class="dt">bound =</span> <span class="fl">4.8</span><span class="op">^</span><span class="dv">2</span>, <span class="dt">greater =</span> <span class="ot">FALSE</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true"></a>))</span></code></pre></div>
<p>It is a bit slow. Probably the algorithm is not very easy. But we get our desired result:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true"></a><span class="kw">shade3d</span>(clippedmesh, <span class="dt">color =</span> <span class="st">&quot;magenta&quot;</span>)</span></code></pre></div>
<p><img src="figures/Togliatti_clipped.gif" /></p>
<h1 id="using-python">Using Python</h1>
<p>With the wonderful Python library <strong>PyVista</strong>, we proceed as follows to create the mesh of the Togliatti isosurface:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true"></a><span class="im">from</span> math <span class="im">import</span> sqrt</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true"></a><span class="im">import</span> pyvista <span class="im">as</span> pv</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true"></a></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true"></a><span class="kw">def</span> f(x, y, z):</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true"></a>    <span class="cf">return</span> (</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true"></a>        <span class="dv">64</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true"></a>        <span class="op">*</span> (x <span class="op">-</span> <span class="dv">1</span>)</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true"></a>        <span class="op">*</span> (</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true"></a>            x <span class="op">**</span> <span class="dv">4</span></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true"></a>            <span class="op">-</span> <span class="dv">4</span> <span class="op">*</span> x <span class="op">**</span> <span class="dv">3</span></span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true"></a>            <span class="op">-</span> <span class="dv">10</span> <span class="op">*</span> x <span class="op">**</span> <span class="dv">2</span> <span class="op">*</span> y <span class="op">**</span> <span class="dv">2</span></span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true"></a>            <span class="op">-</span> <span class="dv">4</span> <span class="op">*</span> x <span class="op">**</span> <span class="dv">2</span></span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true"></a>            <span class="op">+</span> <span class="dv">16</span> <span class="op">*</span> x</span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true"></a>            <span class="op">-</span> <span class="dv">20</span> <span class="op">*</span> x <span class="op">*</span> y <span class="op">**</span> <span class="dv">2</span></span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true"></a>            <span class="op">+</span> <span class="dv">5</span> <span class="op">*</span> y <span class="op">**</span> <span class="dv">4</span></span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true"></a>            <span class="op">+</span> <span class="dv">16</span></span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true"></a>            <span class="op">-</span> <span class="dv">20</span> <span class="op">*</span> y <span class="op">**</span> <span class="dv">2</span></span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true"></a>        )</span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true"></a>        <span class="op">-</span> <span class="dv">5</span></span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true"></a>        <span class="op">*</span> sqrt(<span class="dv">5</span> <span class="op">-</span> sqrt(<span class="dv">5</span>))</span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true"></a>        <span class="op">*</span> (<span class="dv">2</span> <span class="op">*</span> z <span class="op">-</span> sqrt(<span class="dv">5</span> <span class="op">-</span> sqrt(<span class="dv">5</span>)))</span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true"></a>        <span class="op">*</span> (<span class="dv">4</span> <span class="op">*</span> (x <span class="op">**</span> <span class="dv">2</span> <span class="op">+</span> y <span class="op">**</span> <span class="dv">2</span> <span class="op">-</span> z <span class="op">**</span> <span class="dv">2</span>) <span class="op">+</span> (<span class="dv">1</span> <span class="op">+</span> <span class="dv">3</span> <span class="op">*</span> sqrt(<span class="dv">5</span>))) <span class="op">**</span> <span class="dv">2</span></span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true"></a>    )</span>
<span id="cb9-25"><a href="#cb9-25" aria-hidden="true"></a></span>
<span id="cb9-26"><a href="#cb9-26" aria-hidden="true"></a><span class="co"># generate data grid for computing the values</span></span>
<span id="cb9-27"><a href="#cb9-27" aria-hidden="true"></a>X, Y, Z <span class="op">=</span> np.mgrid[(<span class="op">-</span><span class="dv">5</span>):<span class="dv">5</span>:<span class="ot">250j</span>, (<span class="op">-</span><span class="dv">5</span>):<span class="dv">5</span>:<span class="ot">250j</span>, (<span class="op">-</span><span class="dv">4</span>):<span class="dv">4</span>:<span class="ot">250j</span>]</span>
<span id="cb9-28"><a href="#cb9-28" aria-hidden="true"></a><span class="co"># create a structured grid</span></span>
<span id="cb9-29"><a href="#cb9-29" aria-hidden="true"></a>grid <span class="op">=</span> pv.StructuredGrid(X, Y, Z)</span>
<span id="cb9-30"><a href="#cb9-30" aria-hidden="true"></a><span class="co"># compute and assign the values</span></span>
<span id="cb9-31"><a href="#cb9-31" aria-hidden="true"></a>values <span class="op">=</span> f(X, Y, Z)</span>
<span id="cb9-32"><a href="#cb9-32" aria-hidden="true"></a>grid.point_data[<span class="st">&quot;values&quot;</span>] <span class="op">=</span> values.ravel(order<span class="op">=</span><span class="st">&quot;F&quot;</span>)</span>
<span id="cb9-33"><a href="#cb9-33" aria-hidden="true"></a><span class="co"># compute the isosurface f(x, y, z) = 0</span></span>
<span id="cb9-34"><a href="#cb9-34" aria-hidden="true"></a>isosurf <span class="op">=</span> grid.contour(isosurfaces<span class="op">=</span>[<span class="dv">0</span>])</span>
<span id="cb9-35"><a href="#cb9-35" aria-hidden="true"></a>mesh <span class="op">=</span> isosurf.extract_geometry()</span></code></pre></div>
<p>To plot the mesh clipped to the box:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true"></a><span class="co"># surface clipped to the box:</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true"></a>mesh.plot(smooth_shading<span class="op">=</span><span class="va">True</span>, color<span class="op">=</span><span class="st">&quot;yellowgreen&quot;</span>, specular<span class="op">=</span><span class="dv">15</span>)</span></code></pre></div>
<p>The <code>remove_points</code> method is similar to the <code>mask</code> approach with <strong>misc3d</strong> (it produces non-smooth borders):</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true"></a><span class="co"># surface clipped to the ball of radius 4.8, with the help of `remove_points`:</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true"></a>lengths <span class="op">=</span> np.linalg.norm(mesh.points, axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true"></a>toremove <span class="op">=</span> lengths <span class="op">&gt;=</span> <span class="fl">4.8</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true"></a>masked_mesh, idx <span class="op">=</span> mesh.remove_points(toremove)</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true"></a>masked_mesh.plot(smooth_shading<span class="op">=</span><span class="va">True</span>, color<span class="op">=</span><span class="st">&quot;orange&quot;</span>, specular<span class="op">=</span><span class="dv">15</span>)</span></code></pre></div>
<p>To get smooth borders, you have to use the <code>clip_scalar</code> method:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true"></a><span class="co"># surface clipped to the ball of radius 4.8, with the help of `clip_scalar`:</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true"></a>mesh[<span class="st">&quot;dist&quot;</span>] <span class="op">=</span> lengths</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true"></a>clipped_mesh <span class="op">=</span> mesh.clip_scalar(<span class="st">&quot;dist&quot;</span>, value<span class="op">=</span><span class="fl">4.8</span>)</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true"></a>clipped_mesh.plot(</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true"></a>    smooth_shading<span class="op">=</span><span class="va">True</span>, cmap<span class="op">=</span><span class="st">&quot;inferno&quot;</span>, window_size<span class="op">=</span>[<span class="dv">512</span>, <span class="dv">512</span>],</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true"></a>    show_scalar_bar<span class="op">=</span><span class="va">False</span>, specular<span class="op">=</span><span class="dv">15</span>, show_axes<span class="op">=</span><span class="va">False</span>, zoom<span class="op">=</span><span class="fl">1.2</span>,</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true"></a>    background<span class="op">=</span><span class="st">&quot;#363940&quot;</span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true"></a>)</span></code></pre></div>
<p><img src="figures/Togliatti_python.png" /></p>

        </div>


        <div id="footer">
          Site proudly generated by
          <a href="http://jaspervdj.be/hakyll">Hakyll</a>
        </div>

      </div>

    </div>

    <div class="row">
      <div class="col-sm-12">
        <div id="disqus_thread"></div>
        <div class="pagination">
          <ul>
            <li>
              <a href="http://laustep.github.io/stlahblog/">&#171; Back Home</a>
            </li>
          </ul>
        </div>
      </div>
    </div>
    
  </div>

</body>

<script src="/libraries/bootstrap/bootstrap.min.js"></script>
<script>
  var disqus_developer = 1;
  var disqus_shortname = 'stlapblog';
  // required: replace example with your forum shortname
  /* * * DON'T EDIT BELOW THIS LINE * * */
  (function () {
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = 'https://' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] ||
      document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>
<noscript>Please enable JavaScript to view the
  <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a>
</noscript>
<!-- MathJax: Fall back to local if CDN offline but local image fonts are not supported (saves >100MB) -->
<script type="text/x-mathjax-config" src="/libraries/mathjax/config/TeX-MML-AM_CHTML.js"></script>
<!-- <script>
  window.MathJax || document.write('<script type="text/x-mathjax-config">MathJax.Hub.Config({"HTML-CSS":{imageFont:null}});<\/script><script src="../libraries/mathjax/MathJax.js"><\/script>');
</script> -->


</html>]]></description>
    <pubDate>Fri, 14 Jan 2022 00:00:00 UT</pubDate>
    <guid>https://laustep.github.io/stlahblog/posts/MeshClipping.html</guid>
    <dc:creator>Stéphane Laurent</dc:creator>
    <category>R</category>
</item>



<item>
    <title>Bookmarking a Shiny app without Shiny bookmarking</title>
    <link>https://laustep.github.io/stlahblog/posts/shinyBookmarking.html</link>
    <description><![CDATA[<!DOCTYPE HTML>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Saturn Elephant - Bookmarking a Shiny app without Shiny bookmarking</title>
  <link href="/libraries/bootstrap/bootstrap-grid.min.css" rel="stylesheet">
  <link rel="stylesheet" href="/css/default2.css" />
  <link rel="stylesheet" href="/css/post.css" />
  <link rel="stylesheet" href="/css/misc.css" /> 
  
    <link rel="stylesheet" href="/css/pandoc-solarized.css" /> 
   
  
  <link href="https://fonts.googleapis.com/css?family=Raleway:400,600,200,800" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/css?family=Droid+Sans" rel="stylesheet" type="text/css">
  <script src="/libraries/jquery.min.js"></script>
  <script type="text/javascript" async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML"></script>
</head>

<body>
  <div class="container-fluid">
    <div class="row">
      <!-- Sidebar. -->
      <div class="sidebar col-sm-2">
        <div class="row">
          <div class="col-sm-12" style="float:right;clear:both;margin-right:50px;margin-top:50px;">
            <a href="https://www.r-bloggers.com/">
              <img src="/images/Rbloggers.png" alt="Rbloggers" width="100%" />
            </a>
            <br/>
            <a href="http://t-redactyl.io/">
              <span style="color:black;font-weight:bold;font-family:sans-serif;font-size:25px;">Standard error</span>
            </a>
            <a href="http://timelyportfolio.blogspot.be/">
              <span style="color:grey;font-weight:bold;font-family:sans-serif;font-size:24px;">Timely portfolio</span>
            </a>
            <br/>
            <a href="https://antoineguillot.wordpress.com/blog/">
              <span style="color:white;background-color:darkblue;font-weight:bold;font-family:sans-serif;font-size:21px;border:5px solid;border-color:darkblue">ENHANCE DATA</span>
            </a>
            <br/>
            <a href="https://fronkonstin.com/">
              <span style="color:black;background-color:gold;font-weight:bold;font-size:29px;border:3px solid;border-color:gold;">Fronkonstin</span>
            </a>
          </div>
        </div>
        <div id="logos">
          <div class="row">
            <div class="col-sm-4">
              <img src="/images/AsymptoteLogo.svg" style="width: 150%; transform: rotateZ(-35deg)"/>
            </div>
            <div class="col-sm-4">
              <img src="/images/Rlogo.svg" style="width: 110%;"/>
            </div>
            <div class="col-sm-4">
              <img src="/images/shiny-hex.png" style="width: 90%;"/>
            </div>
          </div>
          <div class="row">
            <div class="col-sm-4">
              <img src="/images/Povray_logo_sphere.png" style="width: 105%;"/>
            </div>
            <div class="col-sm-4">
              <img src="/images/javascript.svg" style="width: 90%;"/>
            </div>
            <div class="col-sm-4">
              <img src="/images/haskell.svg" style="width: 110%;"/>
            </div>
          </div>
        </div>
      </div>

      <div class="main col-sm-10">
        <div id="header">
          <div id="logo">
            <a href="/">
              <img src="/images/stla.jpg" alt="stla" width="100px" />
            </a>
          </div>
          <div id="navigation" style="margin-top:50px;">
            <a href="/">Home</a>
            <a href="/about.html">About</a>
            <a href="/contact.html">Contact</a>
            <a href="/archive.html">Archive</a>
          </div>
        </div>

        <div class="content">
          <h1>Bookmarking a Shiny app without Shiny bookmarking</h1> 
          <div class="info">
    Posted on December  9, 2020
    
        by Stéphane Laurent
    
</div>
<div class="info">
    
    Tags: <a title="All pages tagged &#39;R&#39;." href="/tags/R.html">R</a>, <a title="All pages tagged &#39;shiny&#39;." href="/tags/shiny.html">shiny</a>
    
</div>

<p>I do not well remember, but it seems to me I faced some difficulties when I tried to use Shiny bookmarking to save and restore the state of a Shiny app. These difficulties arose when there were some <code>renderUI</code> in the app or an input updated with an <code>updateXXXinput</code> function.</p>
<p>Then I’m using my own way for bookmarking the state of a Shiny app and restoring it. I’m saving the state of the app in a <strong>rds</strong> file and I restore the inputs delayed by a <code>renderUI</code> or an <code>updateXXXinput</code> function with the help of the <code>delay</code> function of the ‘shinyjs’ package. Below is an example</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a><span class="kw">library</span>(shiny)</span>
<span id="cb1-2"><a href="#cb1-2"></a><span class="kw">library</span>(shinyjs)</span>
<span id="cb1-3"><a href="#cb1-3"></a></span>
<span id="cb1-4"><a href="#cb1-4"></a>ui &lt;-<span class="st"> </span><span class="kw">fluidPage</span>(</span>
<span id="cb1-5"><a href="#cb1-5"></a>  </span>
<span id="cb1-6"><a href="#cb1-6"></a>  <span class="kw">useShinyjs</span>(),</span>
<span id="cb1-7"><a href="#cb1-7"></a>  </span>
<span id="cb1-8"><a href="#cb1-8"></a>  <span class="kw">br</span>(),</span>
<span id="cb1-9"><a href="#cb1-9"></a>  </span>
<span id="cb1-10"><a href="#cb1-10"></a>  <span class="kw">sidebarLayout</span>(</span>
<span id="cb1-11"><a href="#cb1-11"></a>    </span>
<span id="cb1-12"><a href="#cb1-12"></a>    <span class="kw">sidebarPanel</span>(</span>
<span id="cb1-13"><a href="#cb1-13"></a>      </span>
<span id="cb1-14"><a href="#cb1-14"></a>      <span class="kw">wellPanel</span>( <span class="co"># restore the bookmarked state</span></span>
<span id="cb1-15"><a href="#cb1-15"></a>        <span class="kw">fileInput</span>(</span>
<span id="cb1-16"><a href="#cb1-16"></a>          <span class="st">&quot;rds&quot;</span>,</span>
<span id="cb1-17"><a href="#cb1-17"></a>          <span class="st">&quot;Restore state&quot;</span>,</span>
<span id="cb1-18"><a href="#cb1-18"></a>          <span class="dt">accept =</span> <span class="st">&quot;.rds&quot;</span></span>
<span id="cb1-19"><a href="#cb1-19"></a>        )</span>
<span id="cb1-20"><a href="#cb1-20"></a>      ),</span>
<span id="cb1-21"><a href="#cb1-21"></a>      </span>
<span id="cb1-22"><a href="#cb1-22"></a>      <span class="kw">wellPanel</span>( <span class="co"># upload data from a CSV file</span></span>
<span id="cb1-23"><a href="#cb1-23"></a>        <span class="kw">fileInput</span>(</span>
<span id="cb1-24"><a href="#cb1-24"></a>          <span class="st">&quot;csv&quot;</span>, </span>
<span id="cb1-25"><a href="#cb1-25"></a>          <span class="st">&quot;Upload CSV&quot;</span>,</span>
<span id="cb1-26"><a href="#cb1-26"></a>          <span class="dt">accept =</span> <span class="st">&quot;.csv&quot;</span></span>
<span id="cb1-27"><a href="#cb1-27"></a>        )</span>
<span id="cb1-28"><a href="#cb1-28"></a>      ),</span>
<span id="cb1-29"><a href="#cb1-29"></a>      </span>
<span id="cb1-30"><a href="#cb1-30"></a>      <span class="kw">conditionalPanel</span>(</span>
<span id="cb1-31"><a href="#cb1-31"></a>        <span class="st">&quot;output.uploaded&quot;</span>,</span>
<span id="cb1-32"><a href="#cb1-32"></a>        <span class="kw">wellPanel</span>(</span>
<span id="cb1-33"><a href="#cb1-33"></a>          <span class="kw">uiOutput</span>(<span class="st">&quot;uiX&quot;</span>), <span class="co"># select the variable to be plotted</span></span>
<span id="cb1-34"><a href="#cb1-34"></a>          <span class="kw">checkboxInput</span>(   <span class="co"># whether to log-transform the variable</span></span>
<span id="cb1-35"><a href="#cb1-35"></a>            <span class="st">&quot;log10&quot;</span>,</span>
<span id="cb1-36"><a href="#cb1-36"></a>            <span class="st">&quot;Log-transform&quot;</span>,</span>
<span id="cb1-37"><a href="#cb1-37"></a>            <span class="dt">value =</span> <span class="ot">FALSE</span></span>
<span id="cb1-38"><a href="#cb1-38"></a>          )</span>
<span id="cb1-39"><a href="#cb1-39"></a>        ),</span>
<span id="cb1-40"><a href="#cb1-40"></a>        </span>
<span id="cb1-41"><a href="#cb1-41"></a>        <span class="kw">wellPanel</span>( <span class="co"># bookmarking</span></span>
<span id="cb1-42"><a href="#cb1-42"></a>          <span class="kw">downloadButton</span>(</span>
<span id="cb1-43"><a href="#cb1-43"></a>            <span class="st">&quot;saveState&quot;</span>, </span>
<span id="cb1-44"><a href="#cb1-44"></a>            <span class="st">&quot;Save state&quot;</span></span>
<span id="cb1-45"><a href="#cb1-45"></a>          )</span>
<span id="cb1-46"><a href="#cb1-46"></a>        )</span>
<span id="cb1-47"><a href="#cb1-47"></a>        </span>
<span id="cb1-48"><a href="#cb1-48"></a>      )</span>
<span id="cb1-49"><a href="#cb1-49"></a>      </span>
<span id="cb1-50"><a href="#cb1-50"></a>    ),</span>
<span id="cb1-51"><a href="#cb1-51"></a>    </span>
<span id="cb1-52"><a href="#cb1-52"></a>    <span class="kw">mainPanel</span>(</span>
<span id="cb1-53"><a href="#cb1-53"></a>      <span class="kw">plotOutput</span>(<span class="st">&quot;plot&quot;</span>, <span class="dt">width =</span> <span class="st">&quot;400px&quot;</span>)</span>
<span id="cb1-54"><a href="#cb1-54"></a>    )</span>
<span id="cb1-55"><a href="#cb1-55"></a>    </span>
<span id="cb1-56"><a href="#cb1-56"></a>  )</span>
<span id="cb1-57"><a href="#cb1-57"></a>)</span>
<span id="cb1-58"><a href="#cb1-58"></a></span>
<span id="cb1-59"><a href="#cb1-59"></a>server &lt;-<span class="st"> </span><span class="cf">function</span>(input, output, session){</span>
<span id="cb1-60"><a href="#cb1-60"></a>  </span>
<span id="cb1-61"><a href="#cb1-61"></a>  data &lt;-<span class="st"> </span><span class="kw">reactiveVal</span>() <span class="co"># to store the uploaded data</span></span>
<span id="cb1-62"><a href="#cb1-62"></a>  </span>
<span id="cb1-63"><a href="#cb1-63"></a>  <span class="kw">observeEvent</span>(input[[<span class="st">&quot;csv&quot;</span>]], { <span class="co"># read and store the uploaded data</span></span>
<span id="cb1-64"><a href="#cb1-64"></a>    csv &lt;-<span class="st"> </span>input[[<span class="st">&quot;csv&quot;</span>]][[<span class="st">&quot;datapath&quot;</span>]]</span>
<span id="cb1-65"><a href="#cb1-65"></a>    <span class="kw">data</span>(<span class="kw">read.csv</span>(csv))</span>
<span id="cb1-66"><a href="#cb1-66"></a>  })</span>
<span id="cb1-67"><a href="#cb1-67"></a>  </span>
<span id="cb1-68"><a href="#cb1-68"></a>  output[[<span class="st">&quot;uploaded&quot;</span>]] &lt;-<span class="st"> </span><span class="kw">reactive</span>({ <span class="co"># indicator data uploaded</span></span>
<span id="cb1-69"><a href="#cb1-69"></a>    <span class="op">!</span><span class="kw">is.null</span>(<span class="kw">data</span>())</span>
<span id="cb1-70"><a href="#cb1-70"></a>  })</span>
<span id="cb1-71"><a href="#cb1-71"></a>  <span class="kw">outputOptions</span>(output, <span class="st">&quot;uploaded&quot;</span>, <span class="dt">suspendWhenHidden =</span> <span class="ot">FALSE</span>)</span>
<span id="cb1-72"><a href="#cb1-72"></a>  </span>
<span id="cb1-73"><a href="#cb1-73"></a>  output[[<span class="st">&quot;uiX&quot;</span>]] &lt;-<span class="st"> </span><span class="kw">renderUI</span>({ <span class="co"># the widget for selecting a variable</span></span>
<span id="cb1-74"><a href="#cb1-74"></a>    <span class="kw">req</span>(<span class="kw">data</span>())</span>
<span id="cb1-75"><a href="#cb1-75"></a>    <span class="kw">selectInput</span>(</span>
<span id="cb1-76"><a href="#cb1-76"></a>      <span class="st">&quot;X&quot;</span>, </span>
<span id="cb1-77"><a href="#cb1-77"></a>      <span class="st">&quot;Select variable&quot;</span>,</span>
<span id="cb1-78"><a href="#cb1-78"></a>      <span class="dt">choices =</span> <span class="kw">colnames</span>(<span class="kw">data</span>())</span>
<span id="cb1-79"><a href="#cb1-79"></a>    )</span>
<span id="cb1-80"><a href="#cb1-80"></a>  })</span>
<span id="cb1-81"><a href="#cb1-81"></a>  </span>
<span id="cb1-82"><a href="#cb1-82"></a>  Xloggable &lt;-<span class="st"> </span><span class="kw">reactiveVal</span>(<span class="ot">FALSE</span>) <span class="co"># indicates whether log-transform is possible </span></span>
<span id="cb1-83"><a href="#cb1-83"></a>  <span class="kw">observeEvent</span>(input[[<span class="st">&quot;X&quot;</span>]], {    </span>
<span id="cb1-84"><a href="#cb1-84"></a>    loggable &lt;-<span class="st"> </span><span class="kw">all</span>(<span class="kw">data</span>()[[input[[<span class="st">&quot;X&quot;</span>]]]] <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)</span>
<span id="cb1-85"><a href="#cb1-85"></a>    <span class="kw">Xloggable</span>(loggable)</span>
<span id="cb1-86"><a href="#cb1-86"></a>  })</span>
<span id="cb1-87"><a href="#cb1-87"></a>  </span>
<span id="cb1-88"><a href="#cb1-88"></a>  logX &lt;-<span class="st"> </span><span class="kw">reactive</span>({ <span class="co"># indicates whether to log-transform the selected variable</span></span>
<span id="cb1-89"><a href="#cb1-89"></a>    <span class="kw">Xloggable</span>() <span class="op">&amp;&amp;</span><span class="st"> </span>input[[<span class="st">&quot;log10&quot;</span>]]</span>
<span id="cb1-90"><a href="#cb1-90"></a>  })</span>
<span id="cb1-91"><a href="#cb1-91"></a>  </span>
<span id="cb1-92"><a href="#cb1-92"></a>  <span class="kw">observeEvent</span>(<span class="kw">list</span>(input[[<span class="st">&quot;X&quot;</span>]], input[[<span class="st">&quot;log10&quot;</span>]]), { <span class="co"># prevents log-transform</span></span>
<span id="cb1-93"><a href="#cb1-93"></a>    <span class="kw">req</span>(input[[<span class="st">&quot;X&quot;</span>]])                                  <span class="co"># if not possible</span></span>
<span id="cb1-94"><a href="#cb1-94"></a>    <span class="cf">if</span>(input[[<span class="st">&quot;log10&quot;</span>]] <span class="op">&amp;&amp;</span><span class="st"> </span><span class="op">!</span><span class="kw">Xloggable</span>()){</span>
<span id="cb1-95"><a href="#cb1-95"></a>      <span class="kw">showNotification</span>(<span class="st">&quot;The selected variable cannot be log-transformed.&quot;</span>)</span>
<span id="cb1-96"><a href="#cb1-96"></a>      <span class="kw">updateCheckboxInput</span>(session, <span class="st">&quot;log10&quot;</span>, <span class="dt">value =</span> <span class="ot">FALSE</span>)</span>
<span id="cb1-97"><a href="#cb1-97"></a>    }</span>
<span id="cb1-98"><a href="#cb1-98"></a>  })</span>
<span id="cb1-99"><a href="#cb1-99"></a>  </span>
<span id="cb1-100"><a href="#cb1-100"></a>  output[[<span class="st">&quot;plot&quot;</span>]] &lt;-<span class="st"> </span><span class="kw">renderPlot</span>({ <span class="co"># the plot</span></span>
<span id="cb1-101"><a href="#cb1-101"></a>    <span class="kw">req</span>(input[[<span class="st">&quot;X&quot;</span>]])</span>
<span id="cb1-102"><a href="#cb1-102"></a>    x &lt;-<span class="st"> </span><span class="kw">data</span>()[[input[[<span class="st">&quot;X&quot;</span>]]]]</span>
<span id="cb1-103"><a href="#cb1-103"></a>    <span class="cf">if</span>(<span class="kw">logX</span>()){</span>
<span id="cb1-104"><a href="#cb1-104"></a>      <span class="kw">plot</span>(<span class="kw">log10</span>(x), <span class="dt">pch =</span> <span class="dv">19</span>)</span>
<span id="cb1-105"><a href="#cb1-105"></a>    }<span class="cf">else</span>{</span>
<span id="cb1-106"><a href="#cb1-106"></a>      <span class="kw">plot</span>(x, <span class="dt">pch =</span> <span class="dv">19</span>)</span>
<span id="cb1-107"><a href="#cb1-107"></a>    }</span>
<span id="cb1-108"><a href="#cb1-108"></a>  })</span>
<span id="cb1-109"><a href="#cb1-109"></a>  </span>
<span id="cb1-110"><a href="#cb1-110"></a>  output[[<span class="st">&quot;saveState&quot;</span>]] &lt;-<span class="st"> </span><span class="kw">downloadHandler</span>( <span class="co"># bookmarking</span></span>
<span id="cb1-111"><a href="#cb1-111"></a>    <span class="dt">filename =</span> <span class="st">&quot;state.rds&quot;</span>,</span>
<span id="cb1-112"><a href="#cb1-112"></a>    <span class="dt">content =</span> <span class="cf">function</span>(file){</span>
<span id="cb1-113"><a href="#cb1-113"></a>      state &lt;-<span class="st"> </span><span class="kw">list</span>(</span>
<span id="cb1-114"><a href="#cb1-114"></a>        <span class="dt">data  =</span> <span class="kw">data</span>(),</span>
<span id="cb1-115"><a href="#cb1-115"></a>        <span class="dt">X     =</span> input[[<span class="st">&quot;X&quot;</span>]],</span>
<span id="cb1-116"><a href="#cb1-116"></a>        <span class="dt">log10 =</span> input[[<span class="st">&quot;log10&quot;</span>]]</span>
<span id="cb1-117"><a href="#cb1-117"></a>      )</span>
<span id="cb1-118"><a href="#cb1-118"></a>      <span class="kw">saveRDS</span>(state, file)</span>
<span id="cb1-119"><a href="#cb1-119"></a>    }</span>
<span id="cb1-120"><a href="#cb1-120"></a>  )</span>
<span id="cb1-121"><a href="#cb1-121"></a>  </span>
<span id="cb1-122"><a href="#cb1-122"></a>  <span class="kw">observeEvent</span>(input[[<span class="st">&quot;rds&quot;</span>]], { <span class="co"># restore state</span></span>
<span id="cb1-123"><a href="#cb1-123"></a>    <span class="co"># read the saved state</span></span>
<span id="cb1-124"><a href="#cb1-124"></a>    state &lt;-<span class="st"> </span><span class="kw">readRDS</span>(input[[<span class="st">&quot;rds&quot;</span>]][[<span class="st">&quot;datapath&quot;</span>]])</span>
<span id="cb1-125"><a href="#cb1-125"></a>    <span class="co"># restore data</span></span>
<span id="cb1-126"><a href="#cb1-126"></a>    <span class="kw">data</span>(state[[<span class="st">&quot;data&quot;</span>]])</span>
<span id="cb1-127"><a href="#cb1-127"></a>    <span class="kw">delay</span>(<span class="dv">0</span>, {</span>
<span id="cb1-128"><a href="#cb1-128"></a>      <span class="kw">delay</span>(<span class="dv">0</span>, { <span class="co"># restore the selected variable</span></span>
<span id="cb1-129"><a href="#cb1-129"></a>        <span class="kw">updateSelectInput</span>(session, <span class="st">&quot;X&quot;</span>, <span class="dt">selected =</span> state[[<span class="st">&quot;X&quot;</span>]])</span>
<span id="cb1-130"><a href="#cb1-130"></a>        <span class="kw">delay</span>(<span class="dv">0</span>, { <span class="co"># restore the checkbox state (log-transform)</span></span>
<span id="cb1-131"><a href="#cb1-131"></a>          <span class="kw">updateCheckboxInput</span>(session, <span class="st">&quot;log10&quot;</span>, <span class="dt">value =</span> state[[<span class="st">&quot;log10&quot;</span>]])</span>
<span id="cb1-132"><a href="#cb1-132"></a>        })</span>
<span id="cb1-133"><a href="#cb1-133"></a>      })</span>
<span id="cb1-134"><a href="#cb1-134"></a>    })</span>
<span id="cb1-135"><a href="#cb1-135"></a>  })</span>
<span id="cb1-136"><a href="#cb1-136"></a>  </span>
<span id="cb1-137"><a href="#cb1-137"></a>}</span>
<span id="cb1-138"><a href="#cb1-138"></a></span>
<span id="cb1-139"><a href="#cb1-139"></a><span class="kw">shinyApp</span>(ui, server)</span></code></pre></div>
<p>I firstly tried to delay the <code>updateSelectInput</code> directly in the <code>delay</code> function, like this:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1"></a>    <span class="kw">delay</span>(<span class="dv">0</span>, { <span class="co"># restore the selected variable</span></span>
<span id="cb2-2"><a href="#cb2-2"></a>      <span class="kw">updateSelectInput</span>(session, <span class="st">&quot;X&quot;</span>, <span class="dt">selected =</span> state[[<span class="st">&quot;X&quot;</span>]])</span>
<span id="cb2-3"><a href="#cb2-3"></a>      <span class="kw">delay</span>(<span class="dv">0</span>, { <span class="co"># restore the checkbox state (log-transform)</span></span>
<span id="cb2-4"><a href="#cb2-4"></a>        <span class="kw">updateCheckboxInput</span>(session, <span class="st">&quot;log10&quot;</span>, <span class="dt">value =</span> state[[<span class="st">&quot;log10&quot;</span>]])</span>
<span id="cb2-5"><a href="#cb2-5"></a>      })</span>
<span id="cb2-6"><a href="#cb2-6"></a>    })</span></code></pre></div>
<p>Oddly, that worked in the RStudio browser, but not in Chrome. This is why I added a nested <code>delay</code> function.</p>
<p>Bookmarking:</p>
<p><img src="./figures/shinyBookmarking1.gif" /></p>
<p>And now, restoring:</p>
<p><img src="./figures/shinyBookmarking2.gif" /></p>

        </div>


        <div id="footer">
          Site proudly generated by
          <a href="http://jaspervdj.be/hakyll">Hakyll</a>
        </div>

      </div>

    </div>

    <div class="row">
      <div class="col-sm-12">
        <div id="disqus_thread"></div>
        <div class="pagination">
          <ul>
            <li>
              <a href="http://laustep.github.io/stlahblog/">&#171; Back Home</a>
            </li>
          </ul>
        </div>
      </div>
    </div>
    
  </div>

</body>

<script src="/libraries/bootstrap/bootstrap.min.js"></script>
<script>
  var disqus_developer = 1;
  var disqus_shortname = 'stlapblog';
  // required: replace example with your forum shortname
  /* * * DON'T EDIT BELOW THIS LINE * * */
  (function () {
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = 'https://' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] ||
      document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>
<noscript>Please enable JavaScript to view the
  <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a>
</noscript>
<!-- MathJax: Fall back to local if CDN offline but local image fonts are not supported (saves >100MB) -->
<script type="text/x-mathjax-config" src="/libraries/mathjax/config/TeX-MML-AM_CHTML.js"></script>
<!-- <script>
  window.MathJax || document.write('<script type="text/x-mathjax-config">MathJax.Hub.Config({"HTML-CSS":{imageFont:null}});<\/script><script src="../libraries/mathjax/MathJax.js"><\/script>');
</script> -->


</html>]]></description>
    <pubDate>Wed, 09 Dec 2020 00:00:00 UT</pubDate>
    <guid>https://laustep.github.io/stlahblog/posts/shinyBookmarking.html</guid>
    <dc:creator>Stéphane Laurent</dc:creator>
    <category>R</category>
</item>


<item>
    <title>Generalized fiducial inference on quantiles</title>
    <link>https://laustep.github.io/stlahblog/posts/gfiExtremes.html</link>
    <description><![CDATA[<!DOCTYPE HTML>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Saturn Elephant - Generalized fiducial inference on quantiles</title>
  <link href="/libraries/bootstrap/bootstrap-grid.min.css" rel="stylesheet">
  <link rel="stylesheet" href="/css/default2.css" />
  <link rel="stylesheet" href="/css/post.css" />
  <link rel="stylesheet" href="/css/misc.css" /> 
  
    <link rel="stylesheet" href="/css/pandoc-solarized.css" /> 
   
  
  <link href="https://fonts.googleapis.com/css?family=Raleway:400,600,200,800" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/css?family=Droid+Sans" rel="stylesheet" type="text/css">
  <script src="/libraries/jquery.min.js"></script>
  <script type="text/javascript" async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML"></script>
</head>

<body>
  <div class="container-fluid">
    <div class="row">
      <!-- Sidebar. -->
      <div class="sidebar col-sm-2">
        <div class="row">
          <div class="col-sm-12" style="float:right;clear:both;margin-right:50px;margin-top:50px;">
            <a href="https://www.r-bloggers.com/">
              <img src="/images/Rbloggers.png" alt="Rbloggers" width="100%" />
            </a>
            <br/>
            <a href="http://t-redactyl.io/">
              <span style="color:black;font-weight:bold;font-family:sans-serif;font-size:25px;">Standard error</span>
            </a>
            <a href="http://timelyportfolio.blogspot.be/">
              <span style="color:grey;font-weight:bold;font-family:sans-serif;font-size:24px;">Timely portfolio</span>
            </a>
            <br/>
            <a href="https://antoineguillot.wordpress.com/blog/">
              <span style="color:white;background-color:darkblue;font-weight:bold;font-family:sans-serif;font-size:21px;border:5px solid;border-color:darkblue">ENHANCE DATA</span>
            </a>
            <br/>
            <a href="https://fronkonstin.com/">
              <span style="color:black;background-color:gold;font-weight:bold;font-size:29px;border:3px solid;border-color:gold;">Fronkonstin</span>
            </a>
          </div>
        </div>
        <div id="logos">
          <div class="row">
            <div class="col-sm-4">
              <img src="/images/AsymptoteLogo.svg" style="width: 150%; transform: rotateZ(-35deg)"/>
            </div>
            <div class="col-sm-4">
              <img src="/images/Rlogo.svg" style="width: 110%;"/>
            </div>
            <div class="col-sm-4">
              <img src="/images/shiny-hex.png" style="width: 90%;"/>
            </div>
          </div>
          <div class="row">
            <div class="col-sm-4">
              <img src="/images/Povray_logo_sphere.png" style="width: 105%;"/>
            </div>
            <div class="col-sm-4">
              <img src="/images/javascript.svg" style="width: 90%;"/>
            </div>
            <div class="col-sm-4">
              <img src="/images/haskell.svg" style="width: 110%;"/>
            </div>
          </div>
        </div>
      </div>

      <div class="main col-sm-10">
        <div id="header">
          <div id="logo">
            <a href="/">
              <img src="/images/stla.jpg" alt="stla" width="100px" />
            </a>
          </div>
          <div id="navigation" style="margin-top:50px;">
            <a href="/">Home</a>
            <a href="/about.html">About</a>
            <a href="/contact.html">Contact</a>
            <a href="/archive.html">Archive</a>
          </div>
        </div>

        <div class="content">
          <h1>Generalized fiducial inference on quantiles</h1> 
          <div class="info">
    Posted on November 27, 2020
    
        by Stéphane Laurent
    
</div>
<div class="info">
    
    Tags: <a title="All pages tagged &#39;R&#39;." href="/tags/R.html">R</a>, <a title="All pages tagged &#39;statistics&#39;." href="/tags/statistics.html">statistics</a>
    
</div>

<p>My new package ‘gfiExtremes’ is on <a href="https://cran.r-project.org/web/packages/gfiExtremes/index.html">CRAN</a> now. So it is time to present it.</p>
<p>This package allows to get confidence intervals about the quantiles of any reasonable distribution (although the inference is based on a parametric model). The statistical inference is fiducial.</p>
<p>To give an illustration, I’m taking a sample of length 100 randomly generated from a Weibull distribution:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true"></a><span class="kw">set.seed</span>(1111111111L)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true"></a>X &lt;-<span class="st"> </span><span class="kw">rweibull</span>(100L, <span class="dt">shape =</span> <span class="fl">1.5</span>)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true"></a><span class="kw">plot</span>(X, <span class="dt">pch =</span> <span class="dv">19</span>, <span class="dt">main =</span> <span class="st">&quot;Data&quot;</span>)</span></code></pre></div>
<p><img src="./figures/gfiExtremes-weibullSample-1.png" /></p>
<p>The model used for the fiducial inference assumes a generalized Pareto distribution above a certain threshold. For an unknown value of this threshold, the function to use is <code>gfigpd2</code>. It runs a MCMC sampler, and one has to specify the length of the burnin phase, the desired length of the MCMC chains after the burnin, and the thin value (e.g. a thin of 2 means that one sampled value over two is dropped). One also has to specify the desired probability levels of the quantiles we are interested in.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true"></a><span class="kw">library</span>(gfiExtremes)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true"></a>chains &lt;-<span class="st"> </span><span class="kw">gfigpd2</span>(</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true"></a>  X,                                         <span class="co"># data</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true"></a>  <span class="dt">beta =</span> <span class="kw">c</span>(<span class="dv">99</span>, <span class="fl">99.5</span>, <span class="fl">99.9</span>)<span class="op">/</span><span class="dv">100</span>,              <span class="co"># probability levels</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true"></a>  <span class="dt">threshold.init =</span> <span class="fl">0.7</span>,                      <span class="co"># initial threshold value</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true"></a>  <span class="dt">burnin =</span> 20000L, <span class="dt">iter =</span> 20000L, <span class="dt">thin =</span> 10L <span class="co"># MCMC chains</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true"></a>)</span></code></pre></div>
<p>By default, <code>gfigpd2</code> runs four MCMC chains and they are generated in parallel.</p>
<p>The output of <code>gfigpd2</code> is a R object ready for analysis with the ‘coda’ package, which is loaded by ‘gfiExtremes’. In particular, it has a <code>summary</code> method:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true"></a><span class="kw">summary</span>(chains)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true"></a><span class="co">## </span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true"></a><span class="co">## Iterations = 20001:219991</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true"></a><span class="co">## Thinning interval = 10 </span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true"></a><span class="co">## Number of chains = 4 </span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true"></a><span class="co">## Sample size per chain = 20000 </span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true"></a><span class="co">## </span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true"></a><span class="co">## 1. Empirical mean and standard deviation for each variable,</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true"></a><span class="co">##    plus standard error of the mean:</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true"></a><span class="co">## </span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true"></a><span class="co">##        Mean     SD Naive SE Time-series SE</span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true"></a><span class="co">## beta1 3.297  1.172 0.004145        0.01229</span></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true"></a><span class="co">## beta2 3.892  3.539 0.012513        0.03705</span></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true"></a><span class="co">## beta3 6.789 80.903 0.286035        0.72901</span></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true"></a><span class="co">## </span></span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true"></a><span class="co">## 2. Quantiles for each variable:</span></span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true"></a><span class="co">## </span></span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true"></a><span class="co">##        2.5%   25%   50%   75%  97.5%</span></span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true"></a><span class="co">## beta1 2.512 2.858 3.096 3.444  5.240</span></span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true"></a><span class="co">## beta2 2.765 3.157 3.459 3.963  7.307</span></span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true"></a><span class="co">## beta3 3.250 3.740 4.268 5.362 17.127</span></span></code></pre></div>
<p>The ‘coda’ package provides the <code>HPDinterval</code> function which gives the shortest confidence intervals:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true"></a><span class="kw">HPDinterval</span>(<span class="kw">joinMCMCchains</span>(chains))</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true"></a><span class="co">##          lower     upper</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true"></a><span class="co">## beta1 2.371387  4.591365</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true"></a><span class="co">## beta2 2.524189  5.910930</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true"></a><span class="co">## beta3 2.893593 11.091305</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true"></a><span class="co">## attr(,&quot;Probability&quot;)</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true"></a><span class="co">## [1] 0.95</span></span></code></pre></div>
<p>Below are the true values of the Weibull quantiles; they are caught by the confidence intervals:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true"></a><span class="kw">qweibull</span>(<span class="kw">c</span>(<span class="dv">99</span>, <span class="fl">99.5</span>, <span class="fl">99.9</span>)<span class="op">/</span><span class="dv">100</span>, <span class="dt">shape =</span> <span class="fl">1.5</span>)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true"></a><span class="co">## [1] 2.767985 3.039196 3.627087</span></span></code></pre></div>
<h2 id="convergence-diagnostics">Convergence diagnostics</h2>
<p>Now one has to check that the MCMC chains have entered in their stationary phase. It is better to take the logarithm of the simulations of the fiducial distributions of the quantiles:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true"></a>logChains &lt;-<span class="st"> </span><span class="kw">as.mcmc.list</span>(<span class="kw">lapply</span>(chains, log))</span></code></pre></div>
<p>The ‘ggmcmc’ package is helpful here. Firstly, let’s have a look at the traces:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true"></a><span class="kw">library</span>(ggmcmc)</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true"></a>gglogChains &lt;-<span class="st"> </span><span class="kw">ggs</span>(logChains)</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true"></a><span class="kw">library</span>(ggthemes)</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true"></a><span class="kw">ggs_traceplot</span>(gglogChains) <span class="op">+</span><span class="st"> </span><span class="kw">theme_fivethirtyeight</span>()</span></code></pre></div>
<p><img src="./figures/gfiExtremes-traceplot-1.png" /></p>
<p>Visually, nothing indicates a departure from the convergence. Let’s look at the estimated densities now:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true"></a><span class="kw">ggs_density</span>(gglogChains) <span class="op">+</span><span class="st"> </span><span class="kw">theme_fivethirtyeight</span>()</span></code></pre></div>
<p><img src="./figures/gfiExtremes-densities-1.png" /></p>
<p>The running means quickly stabilize:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true"></a><span class="kw">ggs_running</span>(gglogChains) <span class="op">+</span><span class="st"> </span><span class="kw">theme_fivethirtyeight</span>()</span></code></pre></div>
<p><img src="./figures/gfiExtremes-runningMeans-1.png" /></p>
<p>Below are the densities of the whole chains compared with the densities of their last part:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true"></a><span class="kw">ggs_compare_partial</span>(gglogChains) <span class="op">+</span><span class="st"> </span><span class="kw">theme_fivethirtyeight</span>()</span></code></pre></div>
<p><img src="./figures/gfiExtremes-comparePartial-1.png" /></p>
<p>The autocorrelations nicely decrease:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true"></a><span class="kw">ggs_autocorrelation</span>(gglogChains) <span class="op">+</span><span class="st"> </span><span class="kw">theme_fivethirtyeight</span>()</span></code></pre></div>
<p><img src="./figures/gfiExtremes-autocorrelations-1.png" /></p>
<p>Let’s also have a look at the Gelman-Rubin diagnostic:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true"></a><span class="kw">gelman.diag</span>(logChains)</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true"></a><span class="co">## Potential scale reduction factors:</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true"></a><span class="co">## </span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true"></a><span class="co">##       Point est. Upper C.I.</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true"></a><span class="co">## beta1          1       1.00</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true"></a><span class="co">## beta2          1       1.01</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true"></a><span class="co">## beta3          1       1.01</span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true"></a><span class="co">## </span></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true"></a><span class="co">## Multivariate psrf</span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true"></a><span class="co">## </span></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true"></a><span class="co">## 1</span></span></code></pre></div>
<p>The upper <code>Rhat</code> are close to 1, thereby indicating a successful diagnostic.</p>
<p>Finally, let’s look at the Heidelberger &amp; Welch diagnostic:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true"></a><span class="kw">heidel.diag</span>(logChains)</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true"></a><span class="co">## [[1]]</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true"></a><span class="co">##                                     </span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true"></a><span class="co">##       Stationarity start     p-value</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true"></a><span class="co">##       test         iteration        </span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true"></a><span class="co">## beta1 passed       1         0.591  </span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true"></a><span class="co">## beta2 passed       1         0.356  </span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true"></a><span class="co">## beta3 passed       1         0.189  </span></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true"></a><span class="co">##                               </span></span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true"></a><span class="co">##       Halfwidth Mean Halfwidth</span></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true"></a><span class="co">##       test                    </span></span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true"></a><span class="co">## beta1 passed    1.17 0.00818  </span></span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true"></a><span class="co">## beta2 passed    1.31 0.01201  </span></span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true"></a><span class="co">## beta3 passed    1.60 0.03032  </span></span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true"></a><span class="co">## </span></span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true"></a><span class="co">## [[2]]</span></span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true"></a><span class="co">##                                     </span></span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true"></a><span class="co">##       Stationarity start     p-value</span></span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true"></a><span class="co">##       test         iteration        </span></span>
<span id="cb13-20"><a href="#cb13-20" aria-hidden="true"></a><span class="co">## beta1 passed       1         0.652  </span></span>
<span id="cb13-21"><a href="#cb13-21" aria-hidden="true"></a><span class="co">## beta2 passed       1         0.571  </span></span>
<span id="cb13-22"><a href="#cb13-22" aria-hidden="true"></a><span class="co">## beta3 passed       1         0.400  </span></span>
<span id="cb13-23"><a href="#cb13-23" aria-hidden="true"></a><span class="co">##                               </span></span>
<span id="cb13-24"><a href="#cb13-24" aria-hidden="true"></a><span class="co">##       Halfwidth Mean Halfwidth</span></span>
<span id="cb13-25"><a href="#cb13-25" aria-hidden="true"></a><span class="co">##       test                    </span></span>
<span id="cb13-26"><a href="#cb13-26" aria-hidden="true"></a><span class="co">## beta1 passed    1.17 0.00713  </span></span>
<span id="cb13-27"><a href="#cb13-27" aria-hidden="true"></a><span class="co">## beta2 passed    1.30 0.01047  </span></span>
<span id="cb13-28"><a href="#cb13-28" aria-hidden="true"></a><span class="co">## beta3 passed    1.58 0.02423  </span></span>
<span id="cb13-29"><a href="#cb13-29" aria-hidden="true"></a><span class="co">## </span></span>
<span id="cb13-30"><a href="#cb13-30" aria-hidden="true"></a><span class="co">## [[3]]</span></span>
<span id="cb13-31"><a href="#cb13-31" aria-hidden="true"></a><span class="co">##                                     </span></span>
<span id="cb13-32"><a href="#cb13-32" aria-hidden="true"></a><span class="co">##       Stationarity start     p-value</span></span>
<span id="cb13-33"><a href="#cb13-33" aria-hidden="true"></a><span class="co">##       test         iteration        </span></span>
<span id="cb13-34"><a href="#cb13-34" aria-hidden="true"></a><span class="co">## beta1 passed       1         0.0720 </span></span>
<span id="cb13-35"><a href="#cb13-35" aria-hidden="true"></a><span class="co">## beta2 passed       1         0.0687 </span></span>
<span id="cb13-36"><a href="#cb13-36" aria-hidden="true"></a><span class="co">## beta3 passed       1         0.0789 </span></span>
<span id="cb13-37"><a href="#cb13-37" aria-hidden="true"></a><span class="co">##                               </span></span>
<span id="cb13-38"><a href="#cb13-38" aria-hidden="true"></a><span class="co">##       Halfwidth Mean Halfwidth</span></span>
<span id="cb13-39"><a href="#cb13-39" aria-hidden="true"></a><span class="co">##       test                    </span></span>
<span id="cb13-40"><a href="#cb13-40" aria-hidden="true"></a><span class="co">## beta1 passed    1.17 0.00856  </span></span>
<span id="cb13-41"><a href="#cb13-41" aria-hidden="true"></a><span class="co">## beta2 passed    1.31 0.01278  </span></span>
<span id="cb13-42"><a href="#cb13-42" aria-hidden="true"></a><span class="co">## beta3 passed    1.59 0.03042  </span></span>
<span id="cb13-43"><a href="#cb13-43" aria-hidden="true"></a><span class="co">## </span></span>
<span id="cb13-44"><a href="#cb13-44" aria-hidden="true"></a><span class="co">## [[4]]</span></span>
<span id="cb13-45"><a href="#cb13-45" aria-hidden="true"></a><span class="co">##                                     </span></span>
<span id="cb13-46"><a href="#cb13-46" aria-hidden="true"></a><span class="co">##       Stationarity start     p-value</span></span>
<span id="cb13-47"><a href="#cb13-47" aria-hidden="true"></a><span class="co">##       test         iteration        </span></span>
<span id="cb13-48"><a href="#cb13-48" aria-hidden="true"></a><span class="co">## beta1 passed       1         0.444  </span></span>
<span id="cb13-49"><a href="#cb13-49" aria-hidden="true"></a><span class="co">## beta2 passed       1         0.276  </span></span>
<span id="cb13-50"><a href="#cb13-50" aria-hidden="true"></a><span class="co">## beta3 passed       1         0.164  </span></span>
<span id="cb13-51"><a href="#cb13-51" aria-hidden="true"></a><span class="co">##                               </span></span>
<span id="cb13-52"><a href="#cb13-52" aria-hidden="true"></a><span class="co">##       Halfwidth Mean Halfwidth</span></span>
<span id="cb13-53"><a href="#cb13-53" aria-hidden="true"></a><span class="co">##       test                    </span></span>
<span id="cb13-54"><a href="#cb13-54" aria-hidden="true"></a><span class="co">## beta1 passed    1.16 0.00709  </span></span>
<span id="cb13-55"><a href="#cb13-55" aria-hidden="true"></a><span class="co">## beta2 passed    1.30 0.01008  </span></span>
<span id="cb13-56"><a href="#cb13-56" aria-hidden="true"></a><span class="co">## beta3 passed    1.57 0.01926</span></span></code></pre></div>
<p>All tests passed.</p>

        </div>


        <div id="footer">
          Site proudly generated by
          <a href="http://jaspervdj.be/hakyll">Hakyll</a>
        </div>

      </div>

    </div>

    <div class="row">
      <div class="col-sm-12">
        <div id="disqus_thread"></div>
        <div class="pagination">
          <ul>
            <li>
              <a href="http://laustep.github.io/stlahblog/">&#171; Back Home</a>
            </li>
          </ul>
        </div>
      </div>
    </div>
    
  </div>

</body>

<script src="/libraries/bootstrap/bootstrap.min.js"></script>
<script>
  var disqus_developer = 1;
  var disqus_shortname = 'stlapblog';
  // required: replace example with your forum shortname
  /* * * DON'T EDIT BELOW THIS LINE * * */
  (function () {
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = 'https://' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] ||
      document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>
<noscript>Please enable JavaScript to view the
  <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a>
</noscript>
<!-- MathJax: Fall back to local if CDN offline but local image fonts are not supported (saves >100MB) -->
<script type="text/x-mathjax-config" src="/libraries/mathjax/config/TeX-MML-AM_CHTML.js"></script>
<!-- <script>
  window.MathJax || document.write('<script type="text/x-mathjax-config">MathJax.Hub.Config({"HTML-CSS":{imageFont:null}});<\/script><script src="../libraries/mathjax/MathJax.js"><\/script>');
</script> -->


</html>]]></description>
    <pubDate>Fri, 27 Nov 2020 00:00:00 UT</pubDate>
    <guid>https://laustep.github.io/stlahblog/posts/gfiExtremes.html</guid>
    <dc:creator>Stéphane Laurent</dc:creator>
    <category>R</category>
</item>


<item>
    <title>Why I like generalized fiducial inference</title>
    <link>https://laustep.github.io/stlahblog/posts/gfi_vs_rstanarm.html</link>
    <description><![CDATA[<!DOCTYPE HTML>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Saturn Elephant - Why I like generalized fiducial inference</title>
  <link href="/libraries/bootstrap/bootstrap-grid.min.css" rel="stylesheet">
  <link rel="stylesheet" href="/css/default2.css" />
  <link rel="stylesheet" href="/css/post.css" />
  <link rel="stylesheet" href="/css/misc.css" /> 
  
    <link rel="stylesheet" href="/css/pandoc-solarized.css" /> 
   
  
  <link href="https://fonts.googleapis.com/css?family=Raleway:400,600,200,800" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/css?family=Droid+Sans" rel="stylesheet" type="text/css">
  <script src="/libraries/jquery.min.js"></script>
  <script type="text/javascript" async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML"></script>
</head>

<body>
  <div class="container-fluid">
    <div class="row">
      <!-- Sidebar. -->
      <div class="sidebar col-sm-2">
        <div class="row">
          <div class="col-sm-12" style="float:right;clear:both;margin-right:50px;margin-top:50px;">
            <a href="https://www.r-bloggers.com/">
              <img src="/images/Rbloggers.png" alt="Rbloggers" width="100%" />
            </a>
            <br/>
            <a href="http://t-redactyl.io/">
              <span style="color:black;font-weight:bold;font-family:sans-serif;font-size:25px;">Standard error</span>
            </a>
            <a href="http://timelyportfolio.blogspot.be/">
              <span style="color:grey;font-weight:bold;font-family:sans-serif;font-size:24px;">Timely portfolio</span>
            </a>
            <br/>
            <a href="https://antoineguillot.wordpress.com/blog/">
              <span style="color:white;background-color:darkblue;font-weight:bold;font-family:sans-serif;font-size:21px;border:5px solid;border-color:darkblue">ENHANCE DATA</span>
            </a>
            <br/>
            <a href="https://fronkonstin.com/">
              <span style="color:black;background-color:gold;font-weight:bold;font-size:29px;border:3px solid;border-color:gold;">Fronkonstin</span>
            </a>
          </div>
        </div>
        <div id="logos">
          <div class="row">
            <div class="col-sm-4">
              <img src="/images/AsymptoteLogo.svg" style="width: 150%; transform: rotateZ(-35deg)"/>
            </div>
            <div class="col-sm-4">
              <img src="/images/Rlogo.svg" style="width: 110%;"/>
            </div>
            <div class="col-sm-4">
              <img src="/images/shiny-hex.png" style="width: 90%;"/>
            </div>
          </div>
          <div class="row">
            <div class="col-sm-4">
              <img src="/images/Povray_logo_sphere.png" style="width: 105%;"/>
            </div>
            <div class="col-sm-4">
              <img src="/images/javascript.svg" style="width: 90%;"/>
            </div>
            <div class="col-sm-4">
              <img src="/images/haskell.svg" style="width: 110%;"/>
            </div>
          </div>
        </div>
      </div>

      <div class="main col-sm-10">
        <div id="header">
          <div id="logo">
            <a href="/">
              <img src="/images/stla.jpg" alt="stla" width="100px" />
            </a>
          </div>
          <div id="navigation" style="margin-top:50px;">
            <a href="/">Home</a>
            <a href="/about.html">About</a>
            <a href="/contact.html">Contact</a>
            <a href="/archive.html">Archive</a>
          </div>
        </div>

        <div class="content">
          <h1>Why I like generalized fiducial inference</h1> 
          <div class="info">
    Posted on November  8, 2020
    
        by Stéphane Laurent
    
</div>
<div class="info">
    
    Tags: <a title="All pages tagged &#39;R&#39;." href="/tags/R.html">R</a>, <a title="All pages tagged &#39;maths&#39;." href="/tags/maths.html">maths</a>, <a title="All pages tagged &#39;statistics&#39;." href="/tags/statistics.html">statistics</a>
    
</div>

<p>Throughout this article, one considers the balanced one-way ANOVA model with a random factor (<code>group</code>). The between standard deviation and the within standard deviation are denoted by <span class="math inline">\(\sigma_{\mathrm{b}}\)</span> and <span class="math inline">\(\sigma_{\mathrm{w}}\)</span> respectively. The grand mean is denoted by <span class="math inline">\(\mu\)</span>. The number of levels of the <code>group</code> factor is denoted by <span class="math inline">\(I\)</span> and the number of individuals within each group is denoted by <span class="math inline">\(J\)</span>. Thus the model is: <span class="math display">\[
\mu_i \sim_{\text{iid}} \mathcal{N}(\mu, \sigma_{\mathrm{b}}^2), \, 
i = 1, \ldots, I \qquad 
(y_{i,j} \mid \mu_i) \sim_{\text{iid}} 
\mathcal{N}(\mu_i, \sigma_{\mathrm{w}}^2), \, j = 1, \ldots, J.
\]</span></p>
<h2 id="using-rstanarm-with-the-default-priors">Using ‘rstanarm’ with the default priors</h2>
<p>Below I fit the model with the ‘rstanarm’ package for fifteen simulated datasets with <span class="math inline">\(I = 10\)</span>, <span class="math inline">\(J = 5\)</span>, <span class="math inline">\(\mu = 10000\)</span>, <span class="math inline">\(\sigma_{\mathrm{b}} = 50\)</span>, <span class="math inline">\(\sigma_{\mathrm{w}} = 1\)</span>. I assign a “vague” half-Cauchy prior distribution to <span class="math inline">\(\sigma_{\mathrm{w}}\)</span> and the other prior distributions are the default prior distributions of <code>stan_lmer</code>.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a><span class="kw">library</span>(rstanarm)</span>
<span id="cb1-2"><a href="#cb1-2"></a><span class="kw">options</span>(<span class="dt">mc.cores =</span> parallel<span class="op">::</span><span class="kw">detectCores</span>())</span>
<span id="cb1-3"><a href="#cb1-3"></a></span>
<span id="cb1-4"><a href="#cb1-4"></a>mu           &lt;-<span class="st"> </span><span class="dv">10000</span> </span>
<span id="cb1-5"><a href="#cb1-5"></a>sigmaWithin  &lt;-<span class="st"> </span><span class="dv">1</span></span>
<span id="cb1-6"><a href="#cb1-6"></a>ratio        &lt;-<span class="st"> </span><span class="dv">50</span></span>
<span id="cb1-7"><a href="#cb1-7"></a>sigmaBetween &lt;-<span class="st"> </span>sigmaWithin <span class="op">*</span><span class="st"> </span>ratio</span>
<span id="cb1-8"><a href="#cb1-8"></a>I            &lt;-<span class="st"> </span>10L </span>
<span id="cb1-9"><a href="#cb1-9"></a>J            &lt;-<span class="st"> </span>5L </span>
<span id="cb1-10"><a href="#cb1-10"></a></span>
<span id="cb1-11"><a href="#cb1-11"></a>nsims &lt;-<span class="st"> </span>15L </span>
<span id="cb1-12"><a href="#cb1-12"></a></span>
<span id="cb1-13"><a href="#cb1-13"></a>stanIntervals &lt;-<span class="st"> </span><span class="kw">list</span>( <span class="co"># to store the confidence intervals</span></span>
<span id="cb1-14"><a href="#cb1-14"></a>  <span class="dt">within =</span> <span class="st">`</span><span class="dt">colnames&lt;-</span><span class="st">`</span>(<span class="kw">matrix</span>(<span class="ot">NA_real_</span>, <span class="dt">nrow =</span> nsims, <span class="dt">ncol =</span> <span class="dv">3</span>), </span>
<span id="cb1-15"><a href="#cb1-15"></a>                      <span class="kw">c</span>(<span class="st">&quot;estimate&quot;</span>, <span class="st">&quot;lwr&quot;</span>, <span class="st">&quot;upr&quot;</span>)),</span>
<span id="cb1-16"><a href="#cb1-16"></a>  <span class="dt">between =</span> <span class="st">`</span><span class="dt">colnames&lt;-</span><span class="st">`</span>(<span class="kw">matrix</span>(<span class="ot">NA_real_</span>, <span class="dt">nrow =</span> nsims, <span class="dt">ncol =</span> <span class="dv">3</span>), </span>
<span id="cb1-17"><a href="#cb1-17"></a>                      <span class="kw">c</span>(<span class="st">&quot;estimate&quot;</span>, <span class="st">&quot;lwr&quot;</span>, <span class="st">&quot;upr&quot;</span>))</span>
<span id="cb1-18"><a href="#cb1-18"></a>)</span>
<span id="cb1-19"><a href="#cb1-19"></a></span>
<span id="cb1-20"><a href="#cb1-20"></a><span class="kw">set.seed</span>(666L)</span>
<span id="cb1-21"><a href="#cb1-21"></a></span>
<span id="cb1-22"><a href="#cb1-22"></a><span class="cf">for</span>(i <span class="cf">in</span> 1L<span class="op">:</span>nsims){</span>
<span id="cb1-23"><a href="#cb1-23"></a>  groupMeans &lt;-<span class="st"> </span><span class="kw">rnorm</span>(I, mu, sigmaBetween)</span>
<span id="cb1-24"><a href="#cb1-24"></a>  y          &lt;-<span class="st"> </span><span class="kw">c</span>(</span>
<span id="cb1-25"><a href="#cb1-25"></a>    <span class="kw">vapply</span>(groupMeans, <span class="cf">function</span>(gmean) <span class="kw">rnorm</span>(J, gmean, sigmaWithin), <span class="kw">numeric</span>(J))</span>
<span id="cb1-26"><a href="#cb1-26"></a>  )</span>
<span id="cb1-27"><a href="#cb1-27"></a>  dat        &lt;-<span class="st"> </span><span class="kw">data.frame</span>(</span>
<span id="cb1-28"><a href="#cb1-28"></a>    <span class="dt">y =</span> y,</span>
<span id="cb1-29"><a href="#cb1-29"></a>    <span class="dt">group =</span> <span class="kw">gl</span>(I, J)</span>
<span id="cb1-30"><a href="#cb1-30"></a>  )</span>
<span id="cb1-31"><a href="#cb1-31"></a>  </span>
<span id="cb1-32"><a href="#cb1-32"></a>  rstanarm &lt;-<span class="st"> </span><span class="kw">stan_lmer</span>(</span>
<span id="cb1-33"><a href="#cb1-33"></a>    y <span class="op">~</span><span class="st"> </span>(<span class="dv">1</span><span class="op">|</span>group), <span class="dt">data =</span> dat, <span class="dt">iter =</span> 5000L,</span>
<span id="cb1-34"><a href="#cb1-34"></a>    <span class="dt">prior_aux =</span> <span class="kw">cauchy</span>(<span class="dv">0</span>, <span class="dv">5</span>)</span>
<span id="cb1-35"><a href="#cb1-35"></a>  )</span>
<span id="cb1-36"><a href="#cb1-36"></a>  </span>
<span id="cb1-37"><a href="#cb1-37"></a>  pstrr &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>( <span class="co"># extract posterior draws</span></span>
<span id="cb1-38"><a href="#cb1-38"></a>    stan,</span>
<span id="cb1-39"><a href="#cb1-39"></a>    <span class="dt">pars =</span> <span class="kw">c</span>(</span>
<span id="cb1-40"><a href="#cb1-40"></a>      <span class="st">&quot;(Intercept)&quot;</span>,</span>
<span id="cb1-41"><a href="#cb1-41"></a>      <span class="st">&quot;sigma&quot;</span>,</span>
<span id="cb1-42"><a href="#cb1-42"></a>      <span class="st">&quot;Sigma[group:(Intercept),(Intercept)]&quot;</span></span>
<span id="cb1-43"><a href="#cb1-43"></a>    )</span>
<span id="cb1-44"><a href="#cb1-44"></a>  )</span>
<span id="cb1-45"><a href="#cb1-45"></a>  <span class="kw">names</span>(pstrr)[2L<span class="op">:</span>3L] &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;sigma_error&quot;</span>, <span class="st">&quot;sigma_group&quot;</span>)</span>
<span id="cb1-46"><a href="#cb1-46"></a>  pstrr[[<span class="st">&quot;sigma_group&quot;</span>]] &lt;-<span class="st"> </span><span class="kw">sqrt</span>(pstrr[[<span class="st">&quot;sigma_group&quot;</span>]])</span>
<span id="cb1-47"><a href="#cb1-47"></a></span>
<span id="cb1-48"><a href="#cb1-48"></a>  x &lt;-<span class="st"> </span><span class="kw">t</span>(<span class="kw">vapply</span>(pstrr, quantile, <span class="kw">numeric</span>(3L), <span class="dt">probs =</span> <span class="kw">c</span>(<span class="dv">50</span>, <span class="fl">2.5</span>, <span class="fl">97.5</span>)<span class="op">/</span><span class="dv">100</span>))</span>
<span id="cb1-49"><a href="#cb1-49"></a>  stanIntervals<span class="op">$</span>within[i, ] &lt;-<span class="st"> </span>x[<span class="st">&quot;sigma_error&quot;</span>, ]</span>
<span id="cb1-50"><a href="#cb1-50"></a>  stanIntervals<span class="op">$</span>between[i, ] &lt;-<span class="st"> </span>x[<span class="st">&quot;sigma_group&quot;</span>, ]</span>
<span id="cb1-51"><a href="#cb1-51"></a>}</span></code></pre></div>
<p>Let’s plot the intervals now.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1"></a><span class="kw">library</span>(ggplot2)</span>
<span id="cb2-2"><a href="#cb2-2"></a>stanWithin &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(stanIntervals[[<span class="st">&quot;within&quot;</span>]])</span>
<span id="cb2-3"><a href="#cb2-3"></a>stanWithin[[<span class="st">&quot;simulation&quot;</span>]] &lt;-<span class="st"> </span><span class="kw">factor</span>(1L<span class="op">:</span>nsims)</span>
<span id="cb2-4"><a href="#cb2-4"></a><span class="kw">ggplot</span>(</span>
<span id="cb2-5"><a href="#cb2-5"></a>  stanWithin, </span>
<span id="cb2-6"><a href="#cb2-6"></a>  <span class="kw">aes</span>(</span>
<span id="cb2-7"><a href="#cb2-7"></a>    <span class="dt">x =</span> simulation, <span class="dt">y =</span> estimate, <span class="dt">ymin =</span> lwr, <span class="dt">ymax =</span> upr</span>
<span id="cb2-8"><a href="#cb2-8"></a>  )</span>
<span id="cb2-9"><a href="#cb2-9"></a>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb2-10"><a href="#cb2-10"></a><span class="st">  </span><span class="kw">geom_pointrange</span>() <span class="op">+</span><span class="st"> </span></span>
<span id="cb2-11"><a href="#cb2-11"></a><span class="st">  </span><span class="kw">ylab</span>(<span class="st">&quot;interval&quot;</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb2-12"><a href="#cb2-12"></a><span class="st">  </span><span class="kw">geom_hline</span>(<span class="dt">yintercept =</span> <span class="dv">1</span>, <span class="dt">linetype =</span> <span class="st">&quot;dashed&quot;</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb2-13"><a href="#cb2-13"></a><span class="st">  </span><span class="kw">ggtitle</span>(<span class="st">&quot;Confidence intervals about the within standard deviation&quot;</span>)</span></code></pre></div>
<p><img src="./figures/gfi_rstanarm-stanIntervalsWithin-1.png" /></p>
<p>The horizontal line shows the value of <span class="math inline">\(\sigma_{\mathrm{w}}\)</span>. As you can see, the confidence intervals dramatically fail to catch this value.</p>
<p>And this is also the case for <span class="math inline">\(\sigma_{\mathrm{b}}\)</span>:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a>stanBetween &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(stanIntervals[[<span class="st">&quot;between&quot;</span>]])</span>
<span id="cb3-2"><a href="#cb3-2"></a>stanBetween[[<span class="st">&quot;simulation&quot;</span>]] &lt;-<span class="st"> </span><span class="kw">factor</span>(1L<span class="op">:</span>nsims)</span>
<span id="cb3-3"><a href="#cb3-3"></a><span class="kw">ggplot</span>(</span>
<span id="cb3-4"><a href="#cb3-4"></a>  stanBetween, </span>
<span id="cb3-5"><a href="#cb3-5"></a>  <span class="kw">aes</span>(</span>
<span id="cb3-6"><a href="#cb3-6"></a>    <span class="dt">x =</span> simulation, <span class="dt">y =</span> estimate, <span class="dt">ymin =</span> lwr, <span class="dt">ymax =</span> upr</span>
<span id="cb3-7"><a href="#cb3-7"></a>  )</span>
<span id="cb3-8"><a href="#cb3-8"></a>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb3-9"><a href="#cb3-9"></a><span class="st">  </span><span class="kw">geom_pointrange</span>() <span class="op">+</span><span class="st"> </span></span>
<span id="cb3-10"><a href="#cb3-10"></a><span class="st">  </span><span class="kw">ylab</span>(<span class="st">&quot;interval&quot;</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb3-11"><a href="#cb3-11"></a><span class="st">  </span><span class="kw">geom_hline</span>(<span class="dt">yintercept =</span> <span class="dv">1</span>, <span class="dt">linetype =</span> <span class="st">&quot;dashed&quot;</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb3-12"><a href="#cb3-12"></a><span class="st">  </span><span class="kw">ggtitle</span>(<span class="st">&quot;Confidence intervals about the between standard deviation&quot;</span>)</span></code></pre></div>
<p><img src="./figures/gfi_rstanarm-stanIntervalsBetween-1.png" /></p>
<h2 id="resolving-the-issue">Resolving the issue</h2>
<p>Why? The explanation is simple: <code>stan_lmer</code> assigns a unit exponential prior distribution to the between standard deviation, which is equal to <span class="math inline">\(50\)</span>.</p>
<p>So we have to change this prior distribution, and <code>stan_lmer</code> allows to use a Gamma distribution as the prior distribution of the between standard deviation. Its parameters <code>shape</code> and <code>scale</code> are settable in the <code>decov</code> function which is passed on to the <code>prior_covariance</code> option:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1"></a>rstanarm &lt;-<span class="st"> </span><span class="kw">stan_lmer</span>(</span>
<span id="cb4-2"><a href="#cb4-2"></a>  y <span class="op">~</span><span class="st"> </span>(<span class="dv">1</span><span class="op">|</span>group), <span class="dt">data =</span> dat, <span class="dt">iter =</span> 5000L,</span>
<span id="cb4-3"><a href="#cb4-3"></a>  <span class="dt">prior_aux =</span> <span class="kw">cauchy</span>(<span class="dv">0</span>, <span class="dv">5</span>),</span>
<span id="cb4-4"><a href="#cb4-4"></a>  <span class="dt">prior_covariance =</span> <span class="kw">decov</span>(<span class="dt">shape =</span> <span class="dv">2</span>, <span class="dt">scale =</span> <span class="dv">30</span>)</span>
<span id="cb4-5"><a href="#cb4-5"></a>)</span></code></pre></div>
<p>I choose the <span class="math inline">\(\textrm{Gamma}(\textrm{shape}=2, \textrm{scale=30})\)</span> distribution because it has median <span class="math inline">\(\approx 50\)</span> and is “vague” enough: its equi-tailed <span class="math inline">\(95\%\)</span>-dispersion interval is <span class="math inline">\(\approx (7, 167)\)</span>.</p>
<p><span style="color:firebrick;font-size:1.25em">☛ <em>However it took me some time to pick up these parameters. I firstly tried a more dispersed Gamma distribution but <code>stan_lmer</code> returned a bunch of warnings and non-sensible results.</em></span></p>
<p>Below are the confidence intervals obtained with this Gamma prior distribution. I compare them with the frequentist intervals obtained with the ‘AOV1R’ package.</p>
<p><img src="./figures/gfi_rstanarm-stanIntervals2Within-1.png" /></p>
<p><img src="./figures/gfi_rstanarm-stanIntervals2Between-1.png" /></p>
<p>Quite good.</p>
<p><span style="color:firebrick;font-size:1.25em">☛ <em>I also noticed that the sampling was slower with this Gamma distribution.</em></span></p>
<h2 id="try-the-generalized-fiducial-inference.">Try the generalized fiducial inference.</h2>
<p>My new package ‘gfilmm’ allows to perform the <em>generalized fiducial inference</em> for any Gaussian linear mixed model with categorical random effects.</p>
<p>Fiducial inference and Bayesian inference have something in common: they are both based on a distribution representing the uncertainty about the parameters: the fiducial distribution and the posterior distribution, respectively.</p>
<p>A notable difference between these two methods of inference is that <em>there’s no prior distribution in fiducial statistics</em>.</p>
<p>Here is how to run the fiducial sampler:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1"></a><span class="kw">library</span>(gfilmm)</span>
<span id="cb5-2"><a href="#cb5-2"></a>fiducialSimulations &lt;-<span class="st"> </span><span class="kw">gfilmm</span>(</span>
<span id="cb5-3"><a href="#cb5-3"></a>  <span class="dt">y =</span> <span class="op">~</span><span class="st"> </span><span class="kw">cbind</span>(y <span class="op">-</span><span class="st"> </span><span class="fl">0.01</span>, y <span class="op">+</span><span class="st"> </span><span class="fl">0.01</span>), <span class="dt">fixed =</span> <span class="op">~</span><span class="st"> </span><span class="dv">1</span>, <span class="dt">random =</span> <span class="op">~</span><span class="st"> </span>group, </span>
<span id="cb5-4"><a href="#cb5-4"></a>  <span class="dt">data=</span> dat, <span class="dt">N =</span> 10000L</span>
<span id="cb5-5"><a href="#cb5-5"></a>)</span></code></pre></div>
<p>Note the form of the response variable: <code>~ cbind(y - 0.01, y + 0.01)</code>. That’s because the generalized fiducial inference applies to interval data.</p>
<p>Below are the fiducial confidence intervals for the same simulated datasets as before.</p>
<p><img src="./figures/gfi_rstanarm-fidIntervalsWithin-1.png" /></p>
<p><img src="./figures/gfi_rstanarm-fidIntervalsBetween-1.png" /></p>
<p>Quite good too. And let me insist on this point: <em>there is no prior distribution, there is nothing to set, except the number of simulations</em>. I implemented the algorithm (due to J. Cisewski and J. Hannig) in C++ and it takes less than 1000 lines of code.</p>
<p>Let’s increase the between standard deviation now.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1"></a>ratio &lt;-<span class="st"> </span><span class="dv">1000</span></span>
<span id="cb6-2"><a href="#cb6-2"></a>sigmaBetween &lt;-<span class="st"> </span>ratio <span class="op">*</span><span class="st"> </span>sigmaWithin</span>
<span id="cb6-3"><a href="#cb6-3"></a><span class="kw">set.seed</span>(31415926L)</span>
<span id="cb6-4"><a href="#cb6-4"></a>groupMeans &lt;-<span class="st"> </span><span class="kw">rnorm</span>(I, mu, sigmaBetween)</span>
<span id="cb6-5"><a href="#cb6-5"></a>y          &lt;-<span class="st"> </span><span class="kw">c</span>(</span>
<span id="cb6-6"><a href="#cb6-6"></a>  <span class="kw">vapply</span>(groupMeans, <span class="cf">function</span>(gmean) <span class="kw">rnorm</span>(J, gmean, sigmaWithin), <span class="kw">numeric</span>(J))</span>
<span id="cb6-7"><a href="#cb6-7"></a>)</span>
<span id="cb6-8"><a href="#cb6-8"></a>dat        &lt;-<span class="st"> </span><span class="kw">data.frame</span>(</span>
<span id="cb6-9"><a href="#cb6-9"></a>  <span class="dt">y =</span> y,</span>
<span id="cb6-10"><a href="#cb6-10"></a>  <span class="dt">group =</span> <span class="kw">gl</span>(I, J)</span>
<span id="cb6-11"><a href="#cb6-11"></a>)</span>
<span id="cb6-12"><a href="#cb6-12"></a><span class="kw">library</span>(AOV1R)</span>
<span id="cb6-13"><a href="#cb6-13"></a><span class="kw">library</span>(gfilmm)</span>
<span id="cb6-14"><a href="#cb6-14"></a>aovfit &lt;-<span class="st"> </span><span class="kw">aov1r</span>(y <span class="op">~</span><span class="st"> </span>group, <span class="dt">data =</span> dat)</span>
<span id="cb6-15"><a href="#cb6-15"></a>gf &lt;-<span class="st"> </span><span class="kw">gfilmm</span>(<span class="op">~</span><span class="st"> </span><span class="kw">cbind</span>(y<span class="fl">-0.01</span>, y<span class="fl">+0.01</span>), <span class="op">~</span><span class="st"> </span><span class="dv">1</span>, <span class="op">~</span><span class="st"> </span>group, <span class="dt">data =</span> dat, <span class="dt">N =</span> 5000L)</span>
<span id="cb6-16"><a href="#cb6-16"></a><span class="kw">confint</span>(aovfit)</span>
<span id="cb6-17"><a href="#cb6-17"></a><span class="co">##               estimate          lwr          upr</span></span>
<span id="cb6-18"><a href="#cb6-18"></a><span class="co">## grandMean 9783.4770335 9227.6673527 10339.286714</span></span>
<span id="cb6-19"><a href="#cb6-19"></a><span class="co">## within       0.9454425    0.7762205     1.209696</span></span>
<span id="cb6-20"><a href="#cb6-20"></a><span class="co">## between    776.9682432  534.4260219  1418.441282</span></span>
<span id="cb6-21"><a href="#cb6-21"></a><span class="co">## total      776.9688185  534.4268604  1418.441598</span></span>
<span id="cb6-22"><a href="#cb6-22"></a><span class="co">## </span></span>
<span id="cb6-23"><a href="#cb6-23"></a><span class="co">## attr(,&quot;confidence level&quot;)</span></span>
<span id="cb6-24"><a href="#cb6-24"></a><span class="co">## [1] 0.95</span></span>
<span id="cb6-25"><a href="#cb6-25"></a><span class="co">## attr(,&quot;standard deviations&quot;)</span></span>
<span id="cb6-26"><a href="#cb6-26"></a><span class="co">## [1] TRUE</span></span></code></pre></div>
<div class="sourceCode" id="cb7"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1"></a><span class="kw">gfiSummary</span>(gf)</span>
<span id="cb7-2"><a href="#cb7-2"></a><span class="co">##                    mean      median         lwr          upr Pr(=0)</span></span>
<span id="cb7-3"><a href="#cb7-3"></a><span class="co">## (Intercept) 9786.579629 9787.161625 9247.718851 10344.743737     NA</span></span>
<span id="cb7-4"><a href="#cb7-4"></a><span class="co">## sigma_group  854.314055  807.650667  528.463101  1485.287694      0</span></span>
<span id="cb7-5"><a href="#cb7-5"></a><span class="co">## sigma_error    1.557918    1.543563    1.273913     1.931306      0</span></span>
<span id="cb7-6"><a href="#cb7-6"></a><span class="co">## attr(,&quot;confidence level&quot;)</span></span>
<span id="cb7-7"><a href="#cb7-7"></a><span class="co">## [1] 0.95</span></span></code></pre></div>
<p>The fiducial confidence interval about the within standard deviation does not match the frequentist interval, and does not catch the true value. Nothing to tinker with, except the number of simulations:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1"></a>gf &lt;-<span class="st"> </span><span class="kw">gfilmm</span>(<span class="op">~</span><span class="st"> </span><span class="kw">cbind</span>(y<span class="fl">-0.01</span>, y<span class="fl">+0.01</span>), <span class="op">~</span><span class="st"> </span><span class="dv">1</span>, <span class="op">~</span><span class="st"> </span>group, <span class="dt">data =</span> dat, <span class="dt">N =</span> 30000L)</span>
<span id="cb8-2"><a href="#cb8-2"></a><span class="kw">gfiSummary</span>(gf)</span>
<span id="cb8-3"><a href="#cb8-3"></a><span class="co">##                     mean       median          lwr          upr Pr(=0)</span></span>
<span id="cb8-4"><a href="#cb8-4"></a><span class="co">## (Intercept) 9780.0741293 9779.1304187 9230.1017080 10333.801655     NA</span></span>
<span id="cb8-5"><a href="#cb8-5"></a><span class="co">## sigma_group  847.3551078  805.8588214  536.0212551  1401.862597      0</span></span>
<span id="cb8-6"><a href="#cb8-6"></a><span class="co">## sigma_error    0.9540852    0.9455375    0.7762872     1.185648      0</span></span>
<span id="cb8-7"><a href="#cb8-7"></a><span class="co">## attr(,&quot;confidence level&quot;)</span></span>
<span id="cb8-8"><a href="#cb8-8"></a><span class="co">## [1] 0.95</span></span></code></pre></div>
<p>Now the fiducial intervals match the frequentist ones.</p>
<h2 id="epilogue">Epilogue</h2>
<p>As you have seen, using the generalized fiducial inference is easy, easier than the Bayesian inference. The difficulty I mentioned regarding the Bayesian inference is not severe, but this is because the one-way ANOVA model with a random factor is the simplest Gaussian linear mixed model. Namely, it has only one between standard deviation. Things get more complicated for a mixed model with multiple random effects. With <code>rstanarm::stan_lmer</code>, one has to assign a Gamma prior distribution on each between standard deviation. I cheated for the above example: I did multiple attempts to select the parameters of the Gamma prior, until I found results close to the frequentist ones!</p>

        </div>


        <div id="footer">
          Site proudly generated by
          <a href="http://jaspervdj.be/hakyll">Hakyll</a>
        </div>

      </div>

    </div>

    <div class="row">
      <div class="col-sm-12">
        <div id="disqus_thread"></div>
        <div class="pagination">
          <ul>
            <li>
              <a href="http://laustep.github.io/stlahblog/">&#171; Back Home</a>
            </li>
          </ul>
        </div>
      </div>
    </div>
    
  </div>

</body>

<script src="/libraries/bootstrap/bootstrap.min.js"></script>
<script>
  var disqus_developer = 1;
  var disqus_shortname = 'stlapblog';
  // required: replace example with your forum shortname
  /* * * DON'T EDIT BELOW THIS LINE * * */
  (function () {
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = 'https://' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] ||
      document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>
<noscript>Please enable JavaScript to view the
  <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a>
</noscript>
<!-- MathJax: Fall back to local if CDN offline but local image fonts are not supported (saves >100MB) -->
<script type="text/x-mathjax-config" src="/libraries/mathjax/config/TeX-MML-AM_CHTML.js"></script>
<!-- <script>
  window.MathJax || document.write('<script type="text/x-mathjax-config">MathJax.Hub.Config({"HTML-CSS":{imageFont:null}});<\/script><script src="../libraries/mathjax/MathJax.js"><\/script>');
</script> -->


</html>]]></description>
    <pubDate>Sun, 08 Nov 2020 00:00:00 UT</pubDate>
    <guid>https://laustep.github.io/stlahblog/posts/gfi_vs_rstanarm.html</guid>
    <dc:creator>Stéphane Laurent</dc:creator>
    <category>R</category>
</item>


<item>
    <title>Haskell is fast</title>
    <link>https://laustep.github.io/stlahblog/posts/HaskellIsFast.html</link>
    <description><![CDATA[<!DOCTYPE HTML>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Saturn Elephant - Haskell is fast</title>
  <link href="/libraries/bootstrap/bootstrap-grid.min.css" rel="stylesheet">
  <link rel="stylesheet" href="/css/default2.css" />
  <link rel="stylesheet" href="/css/post.css" />
  <link rel="stylesheet" href="/css/misc.css" /> 
  
    <link rel="stylesheet" href="/css/pandoc-solarized.css" /> 
   
  
  <link href="https://fonts.googleapis.com/css?family=Raleway:400,600,200,800" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/css?family=Droid+Sans" rel="stylesheet" type="text/css">
  <script src="/libraries/jquery.min.js"></script>
  <script type="text/javascript" async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML"></script>
</head>

<body>
  <div class="container-fluid">
    <div class="row">
      <!-- Sidebar. -->
      <div class="sidebar col-sm-2">
        <div class="row">
          <div class="col-sm-12" style="float:right;clear:both;margin-right:50px;margin-top:50px;">
            <a href="https://www.r-bloggers.com/">
              <img src="/images/Rbloggers.png" alt="Rbloggers" width="100%" />
            </a>
            <br/>
            <a href="http://t-redactyl.io/">
              <span style="color:black;font-weight:bold;font-family:sans-serif;font-size:25px;">Standard error</span>
            </a>
            <a href="http://timelyportfolio.blogspot.be/">
              <span style="color:grey;font-weight:bold;font-family:sans-serif;font-size:24px;">Timely portfolio</span>
            </a>
            <br/>
            <a href="https://antoineguillot.wordpress.com/blog/">
              <span style="color:white;background-color:darkblue;font-weight:bold;font-family:sans-serif;font-size:21px;border:5px solid;border-color:darkblue">ENHANCE DATA</span>
            </a>
            <br/>
            <a href="https://fronkonstin.com/">
              <span style="color:black;background-color:gold;font-weight:bold;font-size:29px;border:3px solid;border-color:gold;">Fronkonstin</span>
            </a>
          </div>
        </div>
        <div id="logos">
          <div class="row">
            <div class="col-sm-4">
              <img src="/images/AsymptoteLogo.svg" style="width: 150%; transform: rotateZ(-35deg)"/>
            </div>
            <div class="col-sm-4">
              <img src="/images/Rlogo.svg" style="width: 110%;"/>
            </div>
            <div class="col-sm-4">
              <img src="/images/shiny-hex.png" style="width: 90%;"/>
            </div>
          </div>
          <div class="row">
            <div class="col-sm-4">
              <img src="/images/Povray_logo_sphere.png" style="width: 105%;"/>
            </div>
            <div class="col-sm-4">
              <img src="/images/javascript.svg" style="width: 90%;"/>
            </div>
            <div class="col-sm-4">
              <img src="/images/haskell.svg" style="width: 110%;"/>
            </div>
          </div>
        </div>
      </div>

      <div class="main col-sm-10">
        <div id="header">
          <div id="logo">
            <a href="/">
              <img src="/images/stla.jpg" alt="stla" width="100px" />
            </a>
          </div>
          <div id="navigation" style="margin-top:50px;">
            <a href="/">Home</a>
            <a href="/about.html">About</a>
            <a href="/contact.html">Contact</a>
            <a href="/archive.html">Archive</a>
          </div>
        </div>

        <div class="content">
          <h1>Haskell is fast</h1> 
          <div class="info">
    Posted on October 22, 2020
    
        by Stéphane Laurent
    
</div>
<div class="info">
    
    Tags: <a title="All pages tagged &#39;R&#39;." href="/tags/R.html">R</a>, <a title="All pages tagged &#39;haskell&#39;." href="/tags/haskell.html">haskell</a>, <a title="All pages tagged &#39;julia&#39;." href="/tags/julia.html">julia</a>, <a title="All pages tagged &#39;Rcpp&#39;." href="/tags/Rcpp.html">Rcpp</a>, <a title="All pages tagged &#39;C&#39;." href="/tags/C.html">C</a>, <a title="All pages tagged &#39;special-functions&#39;." href="/tags/special-functions.html">special-functions</a>, <a title="All pages tagged &#39;maths&#39;." href="/tags/maths.html">maths</a>
    
</div>

<p><em>Updated title:</em> <strong>Haskell is fast, but Julia is faster</strong> (see updates at the end).</p>
<p>My R package ‘HypergeoMat’ provides a Rcpp implementation of Koev &amp; Edelman’s algorithm for the evaluation of the hypergeometric function of a matrix argument.</p>
<p>I also implemented this algorithm in <a href="https://gist.github.com/stla/e85e2de1ad9aeeebc01583f1d0b8e1d0#file-hypergeompq9-jl">Julia</a> and in <a href="https://github.com/stla/hypergeomPFQ">Haskell</a>.</p>
<p>So let us benchmark now.</p>
<p>Here is the hypergeometric function of a matrix argument:</p>
<p><span class="math display">\[
{}_pF_q^{(\alpha)}
\left(\begin{matrix} a_1, \ldots, a_p \\ b_1, \ldots, b_q\end{matrix}; X\right) = 
\sum_{k=0}^\infty\sum_{\kappa \vdash k} 
\frac{{(a_1)}_\kappa^{(\alpha)} \cdots {(a_p)}_\kappa^{(\alpha)}}
{{(b_1)}_\kappa^{(\alpha)} \cdots {(b_q)}_\kappa^{(\alpha)}} 
\frac{C_\kappa^{(\alpha)}(X)}{k!}.
\]</span></p>
<p>Well, I will not explain this expression. But observe that this is a sum from <span class="math inline">\(k=0\)</span> to <span class="math inline">\(\infty\)</span>. The algorithm evaluates the partial sums of this series, that is, the sum from <span class="math inline">\(k=0\)</span> to an integer <span class="math inline">\(m\)</span>.</p>
<p>My Haskell library generates a shared library (a DLL) which can be called from R. And one can call Julia from R with the help of the ‘XRJulia’ package. So we will benchmark the three implementations from R.</p>
<p>Firstly, let’s check that they return the same value:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true"></a><span class="kw">library</span>(HypergeoMat)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true"></a><span class="kw">library</span>(XRJulia)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true"></a><span class="co"># source the Julia code</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true"></a><span class="kw">juliaSource</span>(<span class="st">&quot;HypergeomPQ09.jl&quot;</span>)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true"></a><span class="co"># load the Haskell DLL</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true"></a>dll &lt;-<span class="st"> &quot;libHypergeom.so&quot;</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true"></a><span class="kw">dyn.load</span>(dll)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true"></a><span class="kw">.C</span>(<span class="st">&quot;HsStart&quot;</span>)</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true"></a></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true"></a>a &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">8</span>, <span class="dv">7</span>, <span class="dv">3</span>)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true"></a>b &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">9</span>, <span class="dv">16</span>)</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true"></a>x &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="fl">0.1</span>, <span class="fl">0.2</span>, <span class="fl">0.3</span>)</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true"></a>alpha &lt;-<span class="st"> </span><span class="dv">2</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true"></a>m &lt;-<span class="st"> </span>5L <span class="co"># `m` is the truncation order</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true"></a></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true"></a><span class="kw">hypergeomPFQ</span>(m, a, b, x, alpha)</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true"></a><span class="co"># 2.116251</span></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true"></a><span class="kw">juliaEval</span>(<span class="st">&quot;hypergeom(5, [8.0, 7.0, 3.0], [9.0, 16.0], [0.1, 0.2, 0.3], 2.0)&quot;</span>)</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true"></a><span class="co"># 2.116251</span></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true"></a><span class="kw">.Call</span>(<span class="st">&quot;hypergeomR&quot;</span>, m, a, b, x, alpha)</span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true"></a><span class="co"># 2.116251</span></span></code></pre></div>
<p>Well, the same results. Now, let’s run a first series of benchmarks, for <span class="math inline">\(m=5\)</span>.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true"></a><span class="kw">library</span>(microbenchmark)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true"></a><span class="kw">microbenchmark</span>(</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true"></a>  <span class="dt">Rcpp =</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true"></a>    <span class="kw">hypergeomPFQ</span>(m, a, b, x, alpha),</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true"></a>  <span class="dt">Julia =</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true"></a>    <span class="kw">juliaEval</span>(<span class="st">&quot;hypergeom(5, [8.0, 7.0, 3.0], [9.0, 16.0], [0.1, 0.2, 0.3], 2.0)&quot;</span>),</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true"></a>  <span class="dt">Haskell =</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true"></a>    <span class="kw">.Call</span>(<span class="st">&quot;hypergeomR&quot;</span>, m, a, b, x, alpha),</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true"></a>  <span class="dt">times =</span> <span class="dv">10</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true"></a>)</span></code></pre></div>
<pre><code>Unit: microseconds
    expr      min        lq       mean    median        uq       max neval cld
    Rcpp  356.682   623.807   837.7237   827.402  1084.191  1382.500    10  a 
   Julia 4052.000 47767.565 44725.3895 48845.156 50597.779 51308.089    10   b
 Haskell  610.852  1136.963  1343.7442  1289.435  1504.323  2650.976    10  a </code></pre>
<p>Should we conclude that Rcpp is the winner, and that Julia is slow? That’s not sure. Observe that the unit of these durations is the microsecond. Perhaps the call to Julia via <code>juliaEval</code> is time-consuming, as well as the call to the Haskell DLL via <code>.Call</code>.</p>
<p>So let us try with <span class="math inline">\(m=40\)</span> now.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true"></a>m &lt;-<span class="st"> </span>40L</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true"></a><span class="kw">microbenchmark</span>(</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true"></a>  <span class="dt">Rcpp =</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true"></a>    <span class="kw">hypergeomPFQ</span>(m, a, b, x, alpha),</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true"></a>  <span class="dt">Julia =</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true"></a>    <span class="kw">juliaEval</span>(<span class="st">&quot;hypergeom(40, [8.0, 7.0, 3.0], [9.0, 16.0], [0.1, 0.2, 0.3], 2.0)&quot;</span>),</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true"></a>  <span class="dt">Haskell =</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true"></a>    <span class="kw">.Call</span>(<span class="st">&quot;hypergeomR&quot;</span>, m, a, b, x, alpha),</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true"></a>  <span class="dt">times =</span> <span class="dv">10</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true"></a>)</span></code></pre></div>
<pre><code>Unit: seconds
    expr       min        lq      mean    median        uq      max neval cld
    Rcpp 25.547556 25.924749 26.130888 26.185776 26.354177 26.47846    10   c
   Julia 18.959032 19.088749 19.191394 19.173662 19.291175 19.62415    10  b 
 Haskell  6.642601  6.653627  6.736082  6.735448  6.760926  6.94283    10 a </code></pre>
<p>This time, the unit is the second. Haskell is clearly the winner, followed by Julia.</p>
<p>I’m using Julia 1.2.0, and I have been told that there is a great improvement of performance in Julia 1.5.0, the latest version. I’ll try with Julia 1.5.0 and then I will update this post to show whether there is a gain of speed.</p>
<p>One should not conclude from this experiment that Haskell <em>always</em> beats C++. That depends on the algorithm we benchmark. This one intensively uses recursion, and perhaps Haskell is strong when dealing with recursion.</p>
<p>Don’t forget:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true"></a><span class="kw">dyn.unload</span>(dll)</span></code></pre></div>
<h1 id="update-julia-1.5-is-amazing">Update: Julia 1.5 is amazing</h1>
<p>Now I upgraded Julia to the latest version, 1.5.2. The results are amazing:</p>
<pre><code>Unit: seconds
    expr       min        lq      mean    median        uq       max neval cld
    Rcpp 23.464676 24.392115 24.860484 24.823062 25.013047 27.437176    10   c
   Julia  2.806364  2.852674  3.101521  2.973963  3.363618  3.897855    10 a
 Haskell  6.912441  7.459939  7.648012  7.674404  7.798719  8.322777    10  b</code></pre>
<p>19 seconds for Julia 1.2.0 and 3 seconds for Julia 1.5.2! It beats Haskell.</p>
<h1 id="update-even-better">Update: even better</h1>
<p>Thanks to some advice I got on <a href="https://discourse.julialang.org/">discourse.julialang.org</a>, I improved my <a href="https://gist.github.com/stla/e85e2de1ad9aeeebc01583f1d0b8e1d0#file-hypergeompq10-jl">Julia code</a>, and it is faster now:</p>
<pre><code>Unit: seconds
  expr      min       lq     mean   median       uq      max neval
 Julia 1.499753 1.549549 1.750907 1.658282 1.915167 2.428611    10</code></pre>

        </div>


        <div id="footer">
          Site proudly generated by
          <a href="http://jaspervdj.be/hakyll">Hakyll</a>
        </div>

      </div>

    </div>

    <div class="row">
      <div class="col-sm-12">
        <div id="disqus_thread"></div>
        <div class="pagination">
          <ul>
            <li>
              <a href="http://laustep.github.io/stlahblog/">&#171; Back Home</a>
            </li>
          </ul>
        </div>
      </div>
    </div>
    
  </div>

</body>

<script src="/libraries/bootstrap/bootstrap.min.js"></script>
<script>
  var disqus_developer = 1;
  var disqus_shortname = 'stlapblog';
  // required: replace example with your forum shortname
  /* * * DON'T EDIT BELOW THIS LINE * * */
  (function () {
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = 'https://' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] ||
      document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>
<noscript>Please enable JavaScript to view the
  <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a>
</noscript>
<!-- MathJax: Fall back to local if CDN offline but local image fonts are not supported (saves >100MB) -->
<script type="text/x-mathjax-config" src="/libraries/mathjax/config/TeX-MML-AM_CHTML.js"></script>
<!-- <script>
  window.MathJax || document.write('<script type="text/x-mathjax-config">MathJax.Hub.Config({"HTML-CSS":{imageFont:null}});<\/script><script src="../libraries/mathjax/MathJax.js"><\/script>');
</script> -->


</html>]]></description>
    <pubDate>Thu, 22 Oct 2020 00:00:00 UT</pubDate>
    <guid>https://laustep.github.io/stlahblog/posts/HaskellIsFast.html</guid>
    <dc:creator>Stéphane Laurent</dc:creator>
    <category>R</category>
</item>




<item>
    <title>The 'kde1d' package</title>
    <link>https://laustep.github.io/stlahblog/posts/kde1d.html</link>
    <description><![CDATA[<!DOCTYPE HTML>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Saturn Elephant - The 'kde1d' package</title>
  <link href="/libraries/bootstrap/bootstrap-grid.min.css" rel="stylesheet">
  <link rel="stylesheet" href="/css/default2.css" />
  <link rel="stylesheet" href="/css/post.css" />
  <link rel="stylesheet" href="/css/misc.css" /> 
  
    <link rel="stylesheet" href="/css/pandoc-solarized.css" /> 
   
  
  <link href="https://fonts.googleapis.com/css?family=Raleway:400,600,200,800" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/css?family=Droid+Sans" rel="stylesheet" type="text/css">
  <script src="/libraries/jquery.min.js"></script>
  <script type="text/javascript" async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML"></script>
</head>

<body>
  <div class="container-fluid">
    <div class="row">
      <!-- Sidebar. -->
      <div class="sidebar col-sm-2">
        <div class="row">
          <div class="col-sm-12" style="float:right;clear:both;margin-right:50px;margin-top:50px;">
            <a href="https://www.r-bloggers.com/">
              <img src="/images/Rbloggers.png" alt="Rbloggers" width="100%" />
            </a>
            <br/>
            <a href="http://t-redactyl.io/">
              <span style="color:black;font-weight:bold;font-family:sans-serif;font-size:25px;">Standard error</span>
            </a>
            <a href="http://timelyportfolio.blogspot.be/">
              <span style="color:grey;font-weight:bold;font-family:sans-serif;font-size:24px;">Timely portfolio</span>
            </a>
            <br/>
            <a href="https://antoineguillot.wordpress.com/blog/">
              <span style="color:white;background-color:darkblue;font-weight:bold;font-family:sans-serif;font-size:21px;border:5px solid;border-color:darkblue">ENHANCE DATA</span>
            </a>
            <br/>
            <a href="https://fronkonstin.com/">
              <span style="color:black;background-color:gold;font-weight:bold;font-size:29px;border:3px solid;border-color:gold;">Fronkonstin</span>
            </a>
          </div>
        </div>
        <div id="logos">
          <div class="row">
            <div class="col-sm-4">
              <img src="/images/AsymptoteLogo.svg" style="width: 150%; transform: rotateZ(-35deg)"/>
            </div>
            <div class="col-sm-4">
              <img src="/images/Rlogo.svg" style="width: 110%;"/>
            </div>
            <div class="col-sm-4">
              <img src="/images/shiny-hex.png" style="width: 90%;"/>
            </div>
          </div>
          <div class="row">
            <div class="col-sm-4">
              <img src="/images/Povray_logo_sphere.png" style="width: 105%;"/>
            </div>
            <div class="col-sm-4">
              <img src="/images/javascript.svg" style="width: 90%;"/>
            </div>
            <div class="col-sm-4">
              <img src="/images/haskell.svg" style="width: 110%;"/>
            </div>
          </div>
        </div>
      </div>

      <div class="main col-sm-10">
        <div id="header">
          <div id="logo">
            <a href="/">
              <img src="/images/stla.jpg" alt="stla" width="100px" />
            </a>
          </div>
          <div id="navigation" style="margin-top:50px;">
            <a href="/">Home</a>
            <a href="/about.html">About</a>
            <a href="/contact.html">Contact</a>
            <a href="/archive.html">Archive</a>
          </div>
        </div>

        <div class="content">
          <h1>The 'kde1d' package</h1> 
          <div class="info">
    Posted on October 15, 2020
    
        by Stéphane Laurent
    
</div>
<div class="info">
    
    Tags: <a title="All pages tagged &#39;R&#39;." href="/tags/R.html">R</a>, <a title="All pages tagged &#39;statistics&#39;." href="/tags/statistics.html">statistics</a>
    
</div>

<p>It seems to me that the <code>kde1d</code> package (One-Dimensional Kernel Density Estimation) is not very known. I’ve never heard of it on Stack Overflow, except in an answer of mine.</p>
<p>However this is a great package, IMHO. I’m going to show why I like it.</p>
<h3 id="the-dpqr-family">The <code>d/p/q/r</code> family</h3>
<p>Estimating a density with the <code>kde1d</code> function returns a <code>kde1d</code> object, and this makes available the density, the distribution function, the quantile function associated to the density estimate, as well as a sampler from the estimated distribution.</p>
<p>Let’s fit a density with <code>kde1d</code> to a simulated Gaussian sample:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true"></a><span class="kw">library</span>(kde1d)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true"></a><span class="kw">set.seed</span>(<span class="dv">666</span>)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true"></a>y &lt;-<span class="st"> </span><span class="kw">rnorm</span>(<span class="dv">100</span>)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true"></a>fit &lt;-<span class="st"> </span><span class="kw">kde1d</span>(y)</span></code></pre></div>
<p>Here is the density estimate, in green, along with the true density, in blue:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true"></a>opar &lt;-<span class="st"> </span><span class="kw">par</span>(<span class="dt">mar =</span> <span class="kw">c</span>(<span class="dv">3</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>))</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true"></a><span class="kw">plot</span>(<span class="ot">NULL</span>, <span class="dt">xlim =</span> <span class="kw">c</span>(<span class="op">-</span><span class="fl">3.5</span>, <span class="fl">3.5</span>), <span class="dt">ylim =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="fl">0.4</span>), <span class="dt">axes =</span> <span class="ot">FALSE</span>, <span class="dt">xlab =</span> <span class="ot">NA</span>)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true"></a><span class="kw">axis</span>(<span class="dv">1</span>, <span class="dt">at =</span> <span class="kw">seq</span>(<span class="op">-</span><span class="dv">3</span>, <span class="dv">3</span>, <span class="dt">by=</span><span class="dv">1</span>))</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true"></a><span class="kw">curve</span>(<span class="kw">dkde1d</span>(x, fit), <span class="dt">n =</span> <span class="dv">300</span>, <span class="dt">add =</span> <span class="ot">TRUE</span>, <span class="dt">col =</span> <span class="st">&quot;green&quot;</span>, <span class="dt">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true"></a><span class="kw">curve</span>(<span class="kw">dnorm</span>(x), <span class="dt">n =</span> <span class="dv">300</span>, <span class="dt">add =</span> <span class="ot">TRUE</span>, <span class="dt">col =</span> <span class="st">&quot;blue&quot;</span>, <span class="dt">lwd =</span> <span class="dv">2</span>)</span></code></pre></div>
<p><img src="./figures/kde1d-unnamed-chunk-2-1.png" /></p>
<p>The density can even be evaluated outside the range of the data:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true"></a><span class="kw">print</span>(<span class="kw">dkde1d</span>(<span class="kw">max</span>(y)<span class="op">+</span><span class="dv">1</span>, fit))</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true"></a><span class="co">## [1] 0.001684873</span></span></code></pre></div>
<p>The corresponding cumulative distribution function:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true"></a>opar &lt;-<span class="st"> </span><span class="kw">par</span>(<span class="dt">mar =</span> <span class="kw">c</span>(<span class="fl">4.5</span>, <span class="dv">5</span>, <span class="dv">1</span>, <span class="dv">1</span>))</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true"></a><span class="kw">plot</span>(<span class="ot">NULL</span>, <span class="dt">xlim =</span> <span class="kw">c</span>(<span class="op">-</span><span class="fl">3.5</span>, <span class="fl">3.5</span>), <span class="dt">ylim =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="dt">axes =</span> <span class="ot">FALSE</span>, </span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true"></a>     <span class="dt">xlab =</span> <span class="st">&quot;x&quot;</span>, <span class="dt">ylab =</span> <span class="kw">expression</span>(<span class="st">&quot;Pr(&quot;</span><span class="op">&lt;=</span><span class="st">&quot;x)&quot;</span>))</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true"></a><span class="kw">axis</span>(<span class="dv">1</span>, <span class="dt">at =</span> <span class="kw">seq</span>(<span class="op">-</span><span class="dv">3</span>, <span class="dv">3</span>, <span class="dt">by=</span><span class="dv">1</span>))</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true"></a><span class="kw">axis</span>(<span class="dv">2</span>, <span class="dt">at =</span> <span class="kw">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dt">by=</span><span class="fl">0.25</span>))</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true"></a><span class="kw">curve</span>(<span class="kw">pkde1d</span>(x, fit), <span class="dt">n =</span> <span class="dv">300</span>, <span class="dt">add =</span> <span class="ot">TRUE</span>, <span class="dt">col =</span> <span class="st">&quot;green&quot;</span>, <span class="dt">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true"></a><span class="kw">curve</span>(<span class="kw">pnorm</span>(x), <span class="dt">n =</span> <span class="dv">300</span>, <span class="dt">add =</span> <span class="ot">TRUE</span>, <span class="dt">col =</span> <span class="st">&quot;blue&quot;</span>, <span class="dt">lwd =</span> <span class="dv">2</span>)</span></code></pre></div>
<p><img src="./figures/kde1d-unnamed-chunk-4-1.png" /></p>
<p>The corresponding inverse cumulative distribution function is evaluated by <code>qkde1d</code>, and <code>rkde1d</code> simulates from the estimated distribution.</p>
<h3 id="bounded-data">Bounded data</h3>
<p>By default, the data supplied to the <code>kde1d</code> function is assumed to be unbounded. For bounded data, use the <code>xmin</code> and/or <code>xmax</code> options.</p>
<h3 id="estimating-monotonic-densities">Estimating monotonic densities</h3>
<p>Now, something I use to convince my folks that <code>kde1d</code> is great. Consider a distribution having a monotonic density. The base function <code>density</code> does not correctly estimate the density (at least, with the default settings):</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true"></a><span class="kw">set.seed</span>(<span class="dv">666</span>)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true"></a>y &lt;-<span class="st"> </span><span class="kw">rbeta</span>(<span class="dv">100</span>, <span class="dv">1</span>, <span class="dv">4</span>)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true"></a>opar &lt;-<span class="st"> </span><span class="kw">par</span>(<span class="dt">mar =</span> <span class="kw">c</span>(<span class="dv">3</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>))</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true"></a><span class="kw">plot</span>(<span class="ot">NULL</span>, <span class="dt">xlim =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="dt">ylim =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">4</span>), <span class="dt">axes =</span> <span class="ot">FALSE</span>, <span class="dt">xlab =</span> <span class="ot">NA</span>)</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true"></a><span class="kw">axis</span>(<span class="dv">1</span>, <span class="dt">at =</span> <span class="kw">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dt">by=</span><span class="fl">0.2</span>))</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true"></a><span class="kw">lines</span>(<span class="kw">density</span>(y, <span class="dt">from =</span> <span class="dv">0</span>, <span class="dt">to =</span> <span class="dv">1</span>), <span class="dt">col =</span> <span class="st">&quot;green&quot;</span>, <span class="dt">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true"></a><span class="kw">curve</span>(<span class="kw">dbeta</span>(x, <span class="dv">1</span>, <span class="dv">4</span>), <span class="dt">n =</span> <span class="dv">300</span>, <span class="dt">add =</span> <span class="ot">TRUE</span>, <span class="dt">col =</span> <span class="st">&quot;blue&quot;</span>, <span class="dt">lwd =</span> <span class="dv">2</span>)</span></code></pre></div>
<p><img src="./figures/kde1d-unnamed-chunk-5-1.png" /></p>
<p>The monotonic aspect of the density does not occur in the estimated density. With <code>kde1d</code>, it does:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true"></a>fit &lt;-<span class="st"> </span><span class="kw">kde1d</span>(y, <span class="dt">xmin =</span> <span class="dv">0</span>, <span class="dt">xmax =</span> <span class="dv">1</span>)</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true"></a>opar &lt;-<span class="st"> </span><span class="kw">par</span>(<span class="dt">mar =</span> <span class="kw">c</span>(<span class="dv">3</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>))</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true"></a><span class="kw">plot</span>(<span class="ot">NULL</span>, <span class="dt">xlim =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="dt">ylim =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">4</span>), <span class="dt">axes =</span> <span class="ot">FALSE</span>, <span class="dt">xlab =</span> <span class="ot">NA</span>)</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true"></a><span class="kw">axis</span>(<span class="dv">1</span>, <span class="dt">at =</span> <span class="kw">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dt">by=</span><span class="fl">0.2</span>))</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true"></a><span class="kw">curve</span>(<span class="kw">dkde1d</span>(x, fit), <span class="dt">n =</span> <span class="dv">300</span>, <span class="dt">add =</span> <span class="ot">TRUE</span>, <span class="dt">col =</span> <span class="st">&quot;green&quot;</span>, <span class="dt">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true"></a><span class="kw">curve</span>(<span class="kw">dbeta</span>(x, <span class="dv">1</span>, <span class="dv">4</span>), <span class="dt">n =</span> <span class="dv">300</span>, <span class="dt">add =</span> <span class="ot">TRUE</span>, <span class="dt">col =</span> <span class="st">&quot;blue&quot;</span>, <span class="dt">lwd =</span> <span class="dv">2</span>)</span></code></pre></div>
<p><img src="./figures/kde1d-unnamed-chunk-6-1.png" /></p>

        </div>


        <div id="footer">
          Site proudly generated by
          <a href="http://jaspervdj.be/hakyll">Hakyll</a>
        </div>

      </div>

    </div>

    <div class="row">
      <div class="col-sm-12">
        <div id="disqus_thread"></div>
        <div class="pagination">
          <ul>
            <li>
              <a href="http://laustep.github.io/stlahblog/">&#171; Back Home</a>
            </li>
          </ul>
        </div>
      </div>
    </div>
    
  </div>

</body>

<script src="/libraries/bootstrap/bootstrap.min.js"></script>
<script>
  var disqus_developer = 1;
  var disqus_shortname = 'stlapblog';
  // required: replace example with your forum shortname
  /* * * DON'T EDIT BELOW THIS LINE * * */
  (function () {
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = 'https://' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] ||
      document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>
<noscript>Please enable JavaScript to view the
  <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a>
</noscript>
<!-- MathJax: Fall back to local if CDN offline but local image fonts are not supported (saves >100MB) -->
<script type="text/x-mathjax-config" src="/libraries/mathjax/config/TeX-MML-AM_CHTML.js"></script>
<!-- <script>
  window.MathJax || document.write('<script type="text/x-mathjax-config">MathJax.Hub.Config({"HTML-CSS":{imageFont:null}});<\/script><script src="../libraries/mathjax/MathJax.js"><\/script>');
</script> -->


</html>]]></description>
    <pubDate>Thu, 15 Oct 2020 00:00:00 UT</pubDate>
    <guid>https://laustep.github.io/stlahblog/posts/kde1d.html</guid>
    <dc:creator>Stéphane Laurent</dc:creator>
    <category>R</category>
</item>



<item>
    <title>My RGL artworks</title>
    <link>https://laustep.github.io/stlahblog/posts/MyRGLartworks.html</link>
    <description><![CDATA[<!DOCTYPE HTML>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Saturn Elephant - My RGL artworks</title>
  <link href="/libraries/bootstrap/bootstrap-grid.min.css" rel="stylesheet">
  <link rel="stylesheet" href="/css/default2.css" />
  <link rel="stylesheet" href="/css/post.css" />
  <link rel="stylesheet" href="/css/misc.css" /> 
  
    <link rel="stylesheet" href="/css/pandoc-solarized.css" /> 
   
  
  <link href="https://fonts.googleapis.com/css?family=Raleway:400,600,200,800" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/css?family=Droid+Sans" rel="stylesheet" type="text/css">
  <script src="/libraries/jquery.min.js"></script>
  <script type="text/javascript" async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML"></script>
</head>

<body>
  <div class="container-fluid">
    <div class="row">
      <!-- Sidebar. -->
      <div class="sidebar col-sm-2">
        <div class="row">
          <div class="col-sm-12" style="float:right;clear:both;margin-right:50px;margin-top:50px;">
            <a href="https://www.r-bloggers.com/">
              <img src="/images/Rbloggers.png" alt="Rbloggers" width="100%" />
            </a>
            <br/>
            <a href="http://t-redactyl.io/">
              <span style="color:black;font-weight:bold;font-family:sans-serif;font-size:25px;">Standard error</span>
            </a>
            <a href="http://timelyportfolio.blogspot.be/">
              <span style="color:grey;font-weight:bold;font-family:sans-serif;font-size:24px;">Timely portfolio</span>
            </a>
            <br/>
            <a href="https://antoineguillot.wordpress.com/blog/">
              <span style="color:white;background-color:darkblue;font-weight:bold;font-family:sans-serif;font-size:21px;border:5px solid;border-color:darkblue">ENHANCE DATA</span>
            </a>
            <br/>
            <a href="https://fronkonstin.com/">
              <span style="color:black;background-color:gold;font-weight:bold;font-size:29px;border:3px solid;border-color:gold;">Fronkonstin</span>
            </a>
          </div>
        </div>
        <div id="logos">
          <div class="row">
            <div class="col-sm-4">
              <img src="/images/AsymptoteLogo.svg" style="width: 150%; transform: rotateZ(-35deg)"/>
            </div>
            <div class="col-sm-4">
              <img src="/images/Rlogo.svg" style="width: 110%;"/>
            </div>
            <div class="col-sm-4">
              <img src="/images/shiny-hex.png" style="width: 90%;"/>
            </div>
          </div>
          <div class="row">
            <div class="col-sm-4">
              <img src="/images/Povray_logo_sphere.png" style="width: 105%;"/>
            </div>
            <div class="col-sm-4">
              <img src="/images/javascript.svg" style="width: 90%;"/>
            </div>
            <div class="col-sm-4">
              <img src="/images/haskell.svg" style="width: 110%;"/>
            </div>
          </div>
        </div>
      </div>

      <div class="main col-sm-10">
        <div id="header">
          <div id="logo">
            <a href="/">
              <img src="/images/stla.jpg" alt="stla" width="100px" />
            </a>
          </div>
          <div id="navigation" style="margin-top:50px;">
            <a href="/">Home</a>
            <a href="/about.html">About</a>
            <a href="/contact.html">Contact</a>
            <a href="/archive.html">Archive</a>
          </div>
        </div>

        <div class="content">
          <h1>My RGL artworks</h1> 
          <div class="info">
    Posted on October  8, 2020
    
        by Stéphane Laurent
    
</div>
<div class="info">
    
    Tags: <a title="All pages tagged &#39;geometry&#39;." href="/tags/geometry.html">geometry</a>, <a title="All pages tagged &#39;graphics&#39;." href="/tags/graphics.html">graphics</a>, <a title="All pages tagged &#39;R&#39;." href="/tags/R.html">R</a>, <a title="All pages tagged &#39;rgl&#39;." href="/tags/rgl.html">rgl</a>
    
</div>

<p>These are some of my artworks realized with the R package <code>rgl</code>. Source code is available in <a href="https://gist.github.com/stla">my gists</a>.</p>
<p><img src="https://camo.githubusercontent.com/3a27a77e8d60a10ea347017bb4f78a85f28dce7f/68747470733a2f2f7468756d62732e6766796361742e636f6d2f45737465656d656453686f7779446f6c7068696e2d73697a655f726573747269637465642e676966" /></p>
<p><img src="https://camo.githubusercontent.com/62bb1cef024c3353381dbadfdb75d8839d5ed1e3/68747470733a2f2f7468756d62732e6766796361742e636f6d2f48656c7066756c506c6173746963416e74626561722d73697a655f726573747269637465642e676966" /></p>
<p><img src="https://camo.githubusercontent.com/5ea6d902f0f85b3fff29e87251e6977e28ba0c3c/68747470733a2f2f7468756d62732e6766796361742e636f6d2f506c756d70496d70617373696f6e65644265617665722d73697a655f726573747269637465642e676966" /></p>
<p><img src="https://camo.githubusercontent.com/978e0f0f42673e22685f350e3c6dd6b1c8fe6dff/68747470733a2f2f7468756d62732e6766796361742e636f6d2f4269746573697a6564457175616c476175722d73697a655f726573747269637465642e676966" /></p>
<p><img src="https://camo.githubusercontent.com/93c6b1b2f80818492f9714858d7fc0ffe66f3266/68747470733a2f2f7468756d62732e6766796361742e636f6d2f416d626974696f757354616d6541646461782d73697a655f726573747269637465642e676966" /></p>
<p><img src="https://camo.githubusercontent.com/d1e218228c4efdf6085e5ae80f5cc9feeea1e04d/68747470733a2f2f7468756d62732e6766796361742e636f6d2f4b696e64686561727465644f726e6572794865646765686f672d73697a655f726573747269637465642e676966" /></p>
<p><img src="https://camo.githubusercontent.com/dcd38ed43716c092ae0723d1075b32e082a6cd5b/68747470733a2f2f7468756d62732e6766796361742e636f6d2f466c6177656453656c6672656c69616e7443697272697065642d73697a655f726573747269637465642e676966" /></p>
<p><img src="https://camo.githubusercontent.com/5ed40dd4b6e85f75621a47d3dc4230e1ad46dc75/68747470733a2f2f7468756d62732e6766796361742e636f6d2f556e73746561647957656570794672696c6c6e65636b65646c697a6172642d73697a655f726573747269637465642e676966" /></p>
<p><img src="https://camo.githubusercontent.com/14d6b4ef37daab1a761c14cc4e237510958615ae/68747470733a2f2f7468756d62732e6766796361742e636f6d2f59656c6c6f77496465616c496e6368776f726d2d73697a655f726573747269637465642e676966" /></p>
<p><img src="https://camo.githubusercontent.com/9b47e1d657392cd29e9d684864b0d531d701cf18/68747470733a2f2f7468756d62732e6766796361742e636f6d2f426f6e794964656e746963616c426f696c77656576696c2d73697a655f726573747269637465642e676966" /></p>
<p><img src="https://camo.githubusercontent.com/59629ef36e30e73ebf584a45435a5e9fcd8ab1ae/68747470733a2f2f7468756d62732e6766796361742e636f6d2f4c696b656c794561726c7942656e67616c74696765722d73697a655f726573747269637465642e676966" /></p>
<p><img src="https://camo.githubusercontent.com/94af9461f70bf88fed1ce3eaa9fbf0374b5d0883/68747470733a2f2f7468756d62732e6766796361742e636f6d2f5765656b6c79517561727465726c794963746572696e65776172626c65722d73697a655f726573747269637465642e676966" /></p>
<p><img src="https://camo.githubusercontent.com/460582ebfe5d8ef2724fb11970e634385a3ecc4d/68747470733a2f2f7468756d62732e6766796361742e636f6d2f546f726e536e65616b794b6f616c61626561722d73697a655f726573747269637465642e676966" /></p>
<p><img src="https://camo.githubusercontent.com/9cb20d35d9ad95e96c76946e65c3165d91726006/68747470733a2f2f7468756d62732e6766796361742e636f6d2f556e666f7274756e617465436172656672656547726f756e64626565746c652d73697a655f726573747269637465642e676966" /></p>
<p><img src="https://camo.githubusercontent.com/ff1d85320bd032c9082b008b6dec2df37ea073b8/68747470733a2f2f7468756d62732e6766796361742e636f6d2f46616d6f75734c6176697368416e7469706f646573677265656e706172616b6565742d73697a655f726573747269637465642e676966" /></p>
<p><img src="https://camo.githubusercontent.com/6a397f4022cb0794053f7e3f980dbf50e119c10c/68747470733a2f2f7468756d62732e6766796361742e636f6d2f537069666679536d616c6c42757a7a6172642d73697a655f726573747269637465642e676966" /></p>
<p><img src="https://camo.githubusercontent.com/184b3b5000b26e83ea3fe399352105d07df746d5/68747470733a2f2f7468756d62732e6766796361742e636f6d2f43697263756c6172536d6172744861636b65652d73697a655f726573747269637465642e676966" /></p>
<p><img src="https://camo.githubusercontent.com/abacd39b34b5b57c6c9db5d9c11c1b07c59de371/68747470733a2f2f7468756d62732e6766796361742e636f6d2f536572696f7573446972656374426f6e6f626f2d73697a655f726573747269637465642e676966" /></p>

        </div>


        <div id="footer">
          Site proudly generated by
          <a href="http://jaspervdj.be/hakyll">Hakyll</a>
        </div>

      </div>

    </div>

    <div class="row">
      <div class="col-sm-12">
        <div id="disqus_thread"></div>
        <div class="pagination">
          <ul>
            <li>
              <a href="http://laustep.github.io/stlahblog/">&#171; Back Home</a>
            </li>
          </ul>
        </div>
      </div>
    </div>
    
  </div>

</body>

<script src="/libraries/bootstrap/bootstrap.min.js"></script>
<script>
  var disqus_developer = 1;
  var disqus_shortname = 'stlapblog';
  // required: replace example with your forum shortname
  /* * * DON'T EDIT BELOW THIS LINE * * */
  (function () {
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = 'https://' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] ||
      document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>
<noscript>Please enable JavaScript to view the
  <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a>
</noscript>
<!-- MathJax: Fall back to local if CDN offline but local image fonts are not supported (saves >100MB) -->
<script type="text/x-mathjax-config" src="/libraries/mathjax/config/TeX-MML-AM_CHTML.js"></script>
<!-- <script>
  window.MathJax || document.write('<script type="text/x-mathjax-config">MathJax.Hub.Config({"HTML-CSS":{imageFont:null}});<\/script><script src="../libraries/mathjax/MathJax.js"><\/script>');
</script> -->


</html>]]></description>
    <pubDate>Thu, 08 Oct 2020 00:00:00 UT</pubDate>
    <guid>https://laustep.github.io/stlahblog/posts/MyRGLartworks.html</guid>
    <dc:creator>Stéphane Laurent</dc:creator>
    <category>R</category>
</item>




<item>
    <title>Child tables with DT, editing, exporting</title>
    <link>https://laustep.github.io/stlahblog/posts/DT_childTables.html</link>
    <description><![CDATA[<!DOCTYPE HTML>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Saturn Elephant - Child tables with DT, editing, exporting</title>
  <link href="/libraries/bootstrap/bootstrap-grid.min.css" rel="stylesheet">
  <link rel="stylesheet" href="/css/default2.css" />
  <link rel="stylesheet" href="/css/post.css" />
  <link rel="stylesheet" href="/css/misc.css" /> 
  
    <link rel="stylesheet" href="/css/pandoc-solarized.css" /> 
   
  
  <link href="https://fonts.googleapis.com/css?family=Raleway:400,600,200,800" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/css?family=Droid+Sans" rel="stylesheet" type="text/css">
  <script src="/libraries/jquery.min.js"></script>
  <script type="text/javascript" async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML"></script>
</head>

<body>
  <div class="container-fluid">
    <div class="row">
      <!-- Sidebar. -->
      <div class="sidebar col-sm-2">
        <div class="row">
          <div class="col-sm-12" style="float:right;clear:both;margin-right:50px;margin-top:50px;">
            <a href="https://www.r-bloggers.com/">
              <img src="/images/Rbloggers.png" alt="Rbloggers" width="100%" />
            </a>
            <br/>
            <a href="http://t-redactyl.io/">
              <span style="color:black;font-weight:bold;font-family:sans-serif;font-size:25px;">Standard error</span>
            </a>
            <a href="http://timelyportfolio.blogspot.be/">
              <span style="color:grey;font-weight:bold;font-family:sans-serif;font-size:24px;">Timely portfolio</span>
            </a>
            <br/>
            <a href="https://antoineguillot.wordpress.com/blog/">
              <span style="color:white;background-color:darkblue;font-weight:bold;font-family:sans-serif;font-size:21px;border:5px solid;border-color:darkblue">ENHANCE DATA</span>
            </a>
            <br/>
            <a href="https://fronkonstin.com/">
              <span style="color:black;background-color:gold;font-weight:bold;font-size:29px;border:3px solid;border-color:gold;">Fronkonstin</span>
            </a>
          </div>
        </div>
        <div id="logos">
          <div class="row">
            <div class="col-sm-4">
              <img src="/images/AsymptoteLogo.svg" style="width: 150%; transform: rotateZ(-35deg)"/>
            </div>
            <div class="col-sm-4">
              <img src="/images/Rlogo.svg" style="width: 110%;"/>
            </div>
            <div class="col-sm-4">
              <img src="/images/shiny-hex.png" style="width: 90%;"/>
            </div>
          </div>
          <div class="row">
            <div class="col-sm-4">
              <img src="/images/Povray_logo_sphere.png" style="width: 105%;"/>
            </div>
            <div class="col-sm-4">
              <img src="/images/javascript.svg" style="width: 90%;"/>
            </div>
            <div class="col-sm-4">
              <img src="/images/haskell.svg" style="width: 110%;"/>
            </div>
          </div>
        </div>
      </div>

      <div class="main col-sm-10">
        <div id="header">
          <div id="logo">
            <a href="/">
              <img src="/images/stla.jpg" alt="stla" width="100px" />
            </a>
          </div>
          <div id="navigation" style="margin-top:50px;">
            <a href="/">Home</a>
            <a href="/about.html">About</a>
            <a href="/contact.html">Contact</a>
            <a href="/archive.html">Archive</a>
          </div>
        </div>

        <div class="content">
          <h1>Child tables with DT, editing, exporting</h1> 
          <div class="info">
    Posted on May  8, 2020
    
        by Stéphane Laurent
    
</div>
<div class="info">
    
    Tags: <a title="All pages tagged &#39;R&#39;." href="/tags/R.html">R</a>, <a title="All pages tagged &#39;datatables&#39;." href="/tags/datatables.html">datatables</a>, <a title="All pages tagged &#39;shiny&#39;." href="/tags/shiny.html">shiny</a>, <a title="All pages tagged &#39;javascript&#39;." href="/tags/javascript.html">javascript</a>
    
</div>

<p>I’m going to show how to use the <code>DT</code> package to do a table with child tables, and how to edit and export such a table.</p>
<p>In order to do a table with child tables, one adds a list column to the dataframe of the main table; each cell of this column contains the child table of the corresponding row, given as a list. This is done by the <code>NestedData</code> function below.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a>NestedData &lt;-<span class="st"> </span><span class="cf">function</span>(dat, children){</span>
<span id="cb1-2"><a href="#cb1-2"></a>  <span class="kw">stopifnot</span>(<span class="kw">length</span>(children) <span class="op">==</span><span class="st"> </span><span class="kw">nrow</span>(dat))</span>
<span id="cb1-3"><a href="#cb1-3"></a>  g &lt;-<span class="st"> </span><span class="cf">function</span>(d){</span>
<span id="cb1-4"><a href="#cb1-4"></a>    <span class="cf">if</span>(<span class="kw">is.data.frame</span>(d)){</span>
<span id="cb1-5"><a href="#cb1-5"></a>      purrr<span class="op">::</span><span class="kw">transpose</span>(d)</span>
<span id="cb1-6"><a href="#cb1-6"></a>    }<span class="cf">else</span>{</span>
<span id="cb1-7"><a href="#cb1-7"></a>      purrr<span class="op">::</span><span class="kw">transpose</span>(<span class="kw">NestedData</span>(d[[<span class="dv">1</span>]], <span class="dt">children =</span> d<span class="op">$</span>children))</span>
<span id="cb1-8"><a href="#cb1-8"></a>    }</span>
<span id="cb1-9"><a href="#cb1-9"></a>  }</span>
<span id="cb1-10"><a href="#cb1-10"></a>  subdats &lt;-<span class="st"> </span><span class="kw">lapply</span>(children, g)</span>
<span id="cb1-11"><a href="#cb1-11"></a>  oplus &lt;-<span class="st"> </span><span class="kw">ifelse</span>(<span class="kw">lengths</span>(subdats), <span class="st">&quot;&amp;oplus;&quot;</span>, <span class="st">&quot;&quot;</span>) </span>
<span id="cb1-12"><a href="#cb1-12"></a>  <span class="kw">cbind</span>(<span class="st">&quot; &quot;</span> =<span class="st"> </span>oplus, dat, <span class="st">&quot;_details&quot;</span> =<span class="st"> </span><span class="kw">I</span>(subdats), </span>
<span id="cb1-13"><a href="#cb1-13"></a>        <span class="dt">stringsAsFactors =</span> <span class="ot">FALSE</span>)</span>
<span id="cb1-14"><a href="#cb1-14"></a>}</span></code></pre></div>
<p>The usage of <code>NestedData</code> is easy to understand with an example:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1"></a>dat0   =<span class="st"> </span>iris[<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>,]        <span class="co"># main table, with three rows</span></span>
<span id="cb2-2"><a href="#cb2-2"></a>dat01  =<span class="st"> </span>airquality[<span class="dv">1</span><span class="op">:</span><span class="dv">4</span>,]  <span class="co"># |- child of first row</span></span>
<span id="cb2-3"><a href="#cb2-3"></a>dat02  =<span class="st"> </span>cars[<span class="dv">1</span><span class="op">:</span><span class="dv">2</span>,]        <span class="co"># |- child of second row, with two rows</span></span>
<span id="cb2-4"><a href="#cb2-4"></a>dat021 =<span class="st"> </span>mtcars[<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>,]      <span class="co"># |  |- child of first row of dat02</span></span>
<span id="cb2-5"><a href="#cb2-5"></a>dat022 =<span class="st"> </span>PlantGrowth[<span class="dv">1</span><span class="op">:</span><span class="dv">4</span>,] <span class="co"># |  |- child of second row of dat02</span></span>
<span id="cb2-6"><a href="#cb2-6"></a>dat03  =<span class="st"> </span><span class="kw">data.frame</span>(<span class="ot">NULL</span>)  <span class="co"># |- third row has no child</span></span>
<span id="cb2-7"><a href="#cb2-7"></a></span>
<span id="cb2-8"><a href="#cb2-8"></a>Dat &lt;-<span class="st"> </span><span class="kw">NestedData</span>(</span>
<span id="cb2-9"><a href="#cb2-9"></a>  <span class="dt">dat =</span> dat0, </span>
<span id="cb2-10"><a href="#cb2-10"></a>  <span class="dt">children =</span> <span class="kw">list</span>(</span>
<span id="cb2-11"><a href="#cb2-11"></a>    dat01, </span>
<span id="cb2-12"><a href="#cb2-12"></a>    <span class="kw">list</span>(  </span>
<span id="cb2-13"><a href="#cb2-13"></a>      dat02, </span>
<span id="cb2-14"><a href="#cb2-14"></a>      <span class="dt">children =</span> <span class="kw">list</span>(</span>
<span id="cb2-15"><a href="#cb2-15"></a>        dat021, </span>
<span id="cb2-16"><a href="#cb2-16"></a>        dat022</span>
<span id="cb2-17"><a href="#cb2-17"></a>      )</span>
<span id="cb2-18"><a href="#cb2-18"></a>    ), </span>
<span id="cb2-19"><a href="#cb2-19"></a>    dat03 </span>
<span id="cb2-20"><a href="#cb2-20"></a>  )</span>
<span id="cb2-21"><a href="#cb2-21"></a>)</span></code></pre></div>
<p>Now we define the JavaScript callback which will be used. The code depends on whether one wants to display the row names of the main table, so the user has to enter this information before.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a><span class="kw">library</span>(DT)</span>
<span id="cb3-2"><a href="#cb3-2"></a></span>
<span id="cb3-3"><a href="#cb3-3"></a><span class="co">## whether to show row names</span></span>
<span id="cb3-4"><a href="#cb3-4"></a>rowNames =<span class="st"> </span><span class="ot">FALSE</span></span>
<span id="cb3-5"><a href="#cb3-5"></a>colIdx &lt;-<span class="st"> </span><span class="kw">as.integer</span>(rowNames)</span>
<span id="cb3-6"><a href="#cb3-6"></a></span>
<span id="cb3-7"><a href="#cb3-7"></a><span class="co">## the callback</span></span>
<span id="cb3-8"><a href="#cb3-8"></a>parentRows &lt;-<span class="st"> </span><span class="kw">which</span>(Dat[,<span class="dv">1</span>] <span class="op">!=</span><span class="st"> &quot;&quot;</span>)</span>
<span id="cb3-9"><a href="#cb3-9"></a>callback &lt;-<span class="st"> </span><span class="kw">JS</span>(</span>
<span id="cb3-10"><a href="#cb3-10"></a>  <span class="kw">sprintf</span>(<span class="st">&quot;var parentRows = [%s];&quot;</span>, <span class="kw">toString</span>(parentRows<span class="dv">-1</span>)),</span>
<span id="cb3-11"><a href="#cb3-11"></a>  <span class="kw">sprintf</span>(<span class="st">&quot;var j0 = %d;&quot;</span>, colIdx),</span>
<span id="cb3-12"><a href="#cb3-12"></a>  <span class="st">&quot;var nrows = table.rows().count();&quot;</span>,</span>
<span id="cb3-13"><a href="#cb3-13"></a>  <span class="st">&quot;for(let i = 0; i &lt; nrows; ++i){&quot;</span>,</span>
<span id="cb3-14"><a href="#cb3-14"></a>  <span class="st">&quot;  var $cell = table.cell(i,j0).nodes().to$();&quot;</span>,</span>
<span id="cb3-15"><a href="#cb3-15"></a>  <span class="st">&quot;  if(parentRows.indexOf(i) &gt; -1){&quot;</span>,</span>
<span id="cb3-16"><a href="#cb3-16"></a>  <span class="st">&quot;    $cell.css({cursor: &#39;pointer&#39;});&quot;</span>,</span>
<span id="cb3-17"><a href="#cb3-17"></a>  <span class="st">&quot;  }else{&quot;</span>,</span>
<span id="cb3-18"><a href="#cb3-18"></a>  <span class="st">&quot;    $cell.removeClass(&#39;details-control&#39;);&quot;</span>,</span>
<span id="cb3-19"><a href="#cb3-19"></a>  <span class="st">&quot;  }&quot;</span>,</span>
<span id="cb3-20"><a href="#cb3-20"></a>  <span class="st">&quot;}&quot;</span>,</span>
<span id="cb3-21"><a href="#cb3-21"></a>  <span class="st">&quot;&quot;</span>,</span>
<span id="cb3-22"><a href="#cb3-22"></a>  <span class="st">&quot;// --- make the table header of the nested table --- //&quot;</span>,</span>
<span id="cb3-23"><a href="#cb3-23"></a>  <span class="st">&quot;var formatHeader = function(d, childId){&quot;</span>,</span>
<span id="cb3-24"><a href="#cb3-24"></a>  <span class="st">&quot;  if(d !== null){&quot;</span>,</span>
<span id="cb3-25"><a href="#cb3-25"></a>  <span class="st">&quot;    var html = &quot;</span>, </span>
<span id="cb3-26"><a href="#cb3-26"></a>  <span class="st">&quot;      &#39;&lt;table class=</span><span class="ch">\&quot;</span><span class="st">display compact hover</span><span class="ch">\&quot;</span><span class="st"> &#39; + &quot;</span>,</span>
<span id="cb3-27"><a href="#cb3-27"></a>  <span class="st">&quot;      &#39;style=</span><span class="ch">\&quot;</span><span class="st">padding-left: 30px;</span><span class="ch">\&quot;</span><span class="st"> id=</span><span class="ch">\&quot;</span><span class="st">&#39; + childId + &quot;</span>, </span>
<span id="cb3-28"><a href="#cb3-28"></a>  <span class="st">&quot;      &#39;</span><span class="ch">\&quot;</span><span class="st">&gt;&lt;thead&gt;&lt;tr&gt;&#39;;&quot;</span>,</span>
<span id="cb3-29"><a href="#cb3-29"></a>  <span class="st">&quot;    var data = d[d.length-1] || d._details;&quot;</span>,</span>
<span id="cb3-30"><a href="#cb3-30"></a>  <span class="st">&quot;    for(let key in data[0]){&quot;</span>,</span>
<span id="cb3-31"><a href="#cb3-31"></a>  <span class="st">&quot;      html += &#39;&lt;th&gt;&#39; + key + &#39;&lt;/th&gt;&#39;;&quot;</span>,</span>
<span id="cb3-32"><a href="#cb3-32"></a>  <span class="st">&quot;    }&quot;</span>,</span>
<span id="cb3-33"><a href="#cb3-33"></a>  <span class="st">&quot;    html += &#39;&lt;/tr&gt;&lt;/thead&gt;&lt;/table&gt;&#39;&quot;</span>,</span>
<span id="cb3-34"><a href="#cb3-34"></a>  <span class="st">&quot;    return html;&quot;</span>,</span>
<span id="cb3-35"><a href="#cb3-35"></a>  <span class="st">&quot;  } else {&quot;</span>,</span>
<span id="cb3-36"><a href="#cb3-36"></a>  <span class="st">&quot;    return &#39;&#39;;&quot;</span>,</span>
<span id="cb3-37"><a href="#cb3-37"></a>  <span class="st">&quot;  }&quot;</span>,</span>
<span id="cb3-38"><a href="#cb3-38"></a>  <span class="st">&quot;};&quot;</span>,</span>
<span id="cb3-39"><a href="#cb3-39"></a>  <span class="st">&quot;&quot;</span>,</span>
<span id="cb3-40"><a href="#cb3-40"></a>  <span class="st">&quot;// --- row callback to style rows of child tables --- //&quot;</span>,</span>
<span id="cb3-41"><a href="#cb3-41"></a>  <span class="st">&quot;var rowCallback = function(row, dat, displayNum, index){&quot;</span>,</span>
<span id="cb3-42"><a href="#cb3-42"></a>  <span class="st">&quot;  if($(row).hasClass(&#39;odd&#39;)){&quot;</span>,</span>
<span id="cb3-43"><a href="#cb3-43"></a>  <span class="st">&quot;    $(row).css(&#39;background-color&#39;, &#39;papayawhip&#39;);&quot;</span>,</span>
<span id="cb3-44"><a href="#cb3-44"></a>  <span class="st">&quot;    $(row).hover(function(){&quot;</span>,</span>
<span id="cb3-45"><a href="#cb3-45"></a>  <span class="st">&quot;      $(this).css(&#39;background-color&#39;, &#39;#E6FF99&#39;);&quot;</span>,</span>
<span id="cb3-46"><a href="#cb3-46"></a>  <span class="st">&quot;    }, function(){&quot;</span>,</span>
<span id="cb3-47"><a href="#cb3-47"></a>  <span class="st">&quot;      $(this).css(&#39;background-color&#39;, &#39;papayawhip&#39;);&quot;</span>,</span>
<span id="cb3-48"><a href="#cb3-48"></a>  <span class="st">&quot;    });&quot;</span>,</span>
<span id="cb3-49"><a href="#cb3-49"></a>  <span class="st">&quot;  } else {&quot;</span>,</span>
<span id="cb3-50"><a href="#cb3-50"></a>  <span class="st">&quot;    $(row).css(&#39;background-color&#39;, &#39;lemonchiffon&#39;);&quot;</span>,</span>
<span id="cb3-51"><a href="#cb3-51"></a>  <span class="st">&quot;    $(row).hover(function(){&quot;</span>,</span>
<span id="cb3-52"><a href="#cb3-52"></a>  <span class="st">&quot;      $(this).css(&#39;background-color&#39;, &#39;#DDFF75&#39;);&quot;</span>,</span>
<span id="cb3-53"><a href="#cb3-53"></a>  <span class="st">&quot;    }, function(){&quot;</span>,</span>
<span id="cb3-54"><a href="#cb3-54"></a>  <span class="st">&quot;      $(this).css(&#39;background-color&#39;, &#39;lemonchiffon&#39;);&quot;</span>,</span>
<span id="cb3-55"><a href="#cb3-55"></a>  <span class="st">&quot;    });&quot;</span>,</span>
<span id="cb3-56"><a href="#cb3-56"></a>  <span class="st">&quot;  }&quot;</span>,</span>
<span id="cb3-57"><a href="#cb3-57"></a>  <span class="st">&quot;};&quot;</span>,</span>
<span id="cb3-58"><a href="#cb3-58"></a>  <span class="st">&quot;&quot;</span>,</span>
<span id="cb3-59"><a href="#cb3-59"></a>  <span class="st">&quot;// --- header callback to style header of child tables --- //&quot;</span>,</span>
<span id="cb3-60"><a href="#cb3-60"></a>  <span class="st">&quot;var headerCallback = function(thead, data, start, end, display){&quot;</span>,</span>
<span id="cb3-61"><a href="#cb3-61"></a>  <span class="st">&quot;  $(&#39;th&#39;, thead).css({&quot;</span>,</span>
<span id="cb3-62"><a href="#cb3-62"></a>  <span class="st">&quot;    &#39;border-top&#39;: &#39;3px solid indigo&#39;,&quot;</span>, </span>
<span id="cb3-63"><a href="#cb3-63"></a>  <span class="st">&quot;    &#39;color&#39;: &#39;indigo&#39;,&quot;</span>,</span>
<span id="cb3-64"><a href="#cb3-64"></a>  <span class="st">&quot;    &#39;background-color&#39;: &#39;#fadadd&#39;&quot;</span>,</span>
<span id="cb3-65"><a href="#cb3-65"></a>  <span class="st">&quot;  });&quot;</span>,</span>
<span id="cb3-66"><a href="#cb3-66"></a>  <span class="st">&quot;};&quot;</span>,</span>
<span id="cb3-67"><a href="#cb3-67"></a>  <span class="st">&quot;&quot;</span>,</span>
<span id="cb3-68"><a href="#cb3-68"></a>  <span class="st">&quot;// --- make the datatable --- //&quot;</span>,</span>
<span id="cb3-69"><a href="#cb3-69"></a>  <span class="st">&quot;var formatDatatable = function(d, childId){&quot;</span>,</span>
<span id="cb3-70"><a href="#cb3-70"></a>  <span class="st">&quot;  var data = d[d.length-1] || d._details;&quot;</span>,</span>
<span id="cb3-71"><a href="#cb3-71"></a>  <span class="st">&quot;  var colNames = Object.keys(data[0]);&quot;</span>,</span>
<span id="cb3-72"><a href="#cb3-72"></a>  <span class="st">&quot;  var columns = colNames.map(function(x){&quot;</span>,</span>
<span id="cb3-73"><a href="#cb3-73"></a>  <span class="st">&quot;    return {data: x.replace(/</span><span class="ch">\\</span><span class="st">./g, &#39;</span><span class="ch">\\\\\\</span><span class="st">.&#39;), title: x};&quot;</span>,</span>
<span id="cb3-74"><a href="#cb3-74"></a>  <span class="st">&quot;  });&quot;</span>,</span>
<span id="cb3-75"><a href="#cb3-75"></a>  <span class="st">&quot;  var id = &#39;table#&#39; + childId;&quot;</span>,</span>
<span id="cb3-76"><a href="#cb3-76"></a>  <span class="st">&quot;  if(colNames.indexOf(&#39;_details&#39;) === -1){&quot;</span>,</span>
<span id="cb3-77"><a href="#cb3-77"></a>  <span class="st">&quot;    var subtable = $(id).DataTable({&quot;</span>,</span>
<span id="cb3-78"><a href="#cb3-78"></a>  <span class="st">&quot;      &#39;data&#39;: data,&quot;</span>,</span>
<span id="cb3-79"><a href="#cb3-79"></a>  <span class="st">&quot;      &#39;columns&#39;: columns,&quot;</span>,</span>
<span id="cb3-80"><a href="#cb3-80"></a>  <span class="st">&quot;      &#39;autoWidth&#39;: true,&quot;</span>,</span>
<span id="cb3-81"><a href="#cb3-81"></a>  <span class="st">&quot;      &#39;deferRender&#39;: true,&quot;</span>,</span>
<span id="cb3-82"><a href="#cb3-82"></a>  <span class="st">&quot;      &#39;info&#39;: false,&quot;</span>,</span>
<span id="cb3-83"><a href="#cb3-83"></a>  <span class="st">&quot;      &#39;lengthChange&#39;: false,&quot;</span>,</span>
<span id="cb3-84"><a href="#cb3-84"></a>  <span class="st">&quot;      &#39;ordering&#39;: data.length &gt; 1,&quot;</span>,</span>
<span id="cb3-85"><a href="#cb3-85"></a>  <span class="st">&quot;      &#39;order&#39;: [],&quot;</span>,</span>
<span id="cb3-86"><a href="#cb3-86"></a>  <span class="st">&quot;      &#39;paging&#39;: false,&quot;</span>,</span>
<span id="cb3-87"><a href="#cb3-87"></a>  <span class="st">&quot;      &#39;scrollX&#39;: false,&quot;</span>,</span>
<span id="cb3-88"><a href="#cb3-88"></a>  <span class="st">&quot;      &#39;scrollY&#39;: false,&quot;</span>,</span>
<span id="cb3-89"><a href="#cb3-89"></a>  <span class="st">&quot;      &#39;searching&#39;: false,&quot;</span>,</span>
<span id="cb3-90"><a href="#cb3-90"></a>  <span class="st">&quot;      &#39;sortClasses&#39;: false,&quot;</span>,</span>
<span id="cb3-91"><a href="#cb3-91"></a>  <span class="st">&quot;      &#39;rowCallback&#39;: rowCallback,&quot;</span>,</span>
<span id="cb3-92"><a href="#cb3-92"></a>  <span class="st">&quot;      &#39;headerCallback&#39;: headerCallback,&quot;</span>,</span>
<span id="cb3-93"><a href="#cb3-93"></a>  <span class="st">&quot;      &#39;columnDefs&#39;: [{targets: &#39;_all&#39;, className: &#39;dt-center&#39;}]&quot;</span>,</span>
<span id="cb3-94"><a href="#cb3-94"></a>  <span class="st">&quot;    });&quot;</span>,</span>
<span id="cb3-95"><a href="#cb3-95"></a>  <span class="st">&quot;  } else {&quot;</span>,</span>
<span id="cb3-96"><a href="#cb3-96"></a>  <span class="st">&quot;    var subtable = $(id).DataTable({&quot;</span>,</span>
<span id="cb3-97"><a href="#cb3-97"></a>  <span class="st">&quot;      &#39;data&#39;: data,&quot;</span>,</span>
<span id="cb3-98"><a href="#cb3-98"></a>  <span class="st">&quot;      &#39;columns&#39;: columns,&quot;</span>,</span>
<span id="cb3-99"><a href="#cb3-99"></a>  <span class="st">&quot;      &#39;autoWidth&#39;: true,&quot;</span>,</span>
<span id="cb3-100"><a href="#cb3-100"></a>  <span class="st">&quot;      &#39;deferRender&#39;: true,&quot;</span>,</span>
<span id="cb3-101"><a href="#cb3-101"></a>  <span class="st">&quot;      &#39;info&#39;: false,&quot;</span>,</span>
<span id="cb3-102"><a href="#cb3-102"></a>  <span class="st">&quot;      &#39;lengthChange&#39;: false,&quot;</span>,</span>
<span id="cb3-103"><a href="#cb3-103"></a>  <span class="st">&quot;      &#39;ordering&#39;: data.length &gt; 1,&quot;</span>,</span>
<span id="cb3-104"><a href="#cb3-104"></a>  <span class="st">&quot;      &#39;order&#39;: [],&quot;</span>,</span>
<span id="cb3-105"><a href="#cb3-105"></a>  <span class="st">&quot;      &#39;paging&#39;: false,&quot;</span>,</span>
<span id="cb3-106"><a href="#cb3-106"></a>  <span class="st">&quot;      &#39;scrollX&#39;: false,&quot;</span>,</span>
<span id="cb3-107"><a href="#cb3-107"></a>  <span class="st">&quot;      &#39;scrollY&#39;: false,&quot;</span>,</span>
<span id="cb3-108"><a href="#cb3-108"></a>  <span class="st">&quot;      &#39;searching&#39;: false,&quot;</span>,</span>
<span id="cb3-109"><a href="#cb3-109"></a>  <span class="st">&quot;      &#39;sortClasses&#39;: false,&quot;</span>,</span>
<span id="cb3-110"><a href="#cb3-110"></a>  <span class="st">&quot;      &#39;rowCallback&#39;: rowCallback,&quot;</span>,</span>
<span id="cb3-111"><a href="#cb3-111"></a>  <span class="st">&quot;      &#39;headerCallback&#39;: headerCallback,&quot;</span>,</span>
<span id="cb3-112"><a href="#cb3-112"></a>  <span class="st">&quot;      &#39;columnDefs&#39;: [&quot;</span>, </span>
<span id="cb3-113"><a href="#cb3-113"></a>  <span class="st">&quot;        {targets: -1, visible: false},&quot;</span>, </span>
<span id="cb3-114"><a href="#cb3-114"></a>  <span class="st">&quot;        {targets: 0, orderable: false, className: &#39;details-control&#39;},&quot;</span>, </span>
<span id="cb3-115"><a href="#cb3-115"></a>  <span class="st">&quot;        {targets: &#39;_all&#39;, className: &#39;dt-center&#39;}&quot;</span>,</span>
<span id="cb3-116"><a href="#cb3-116"></a>  <span class="st">&quot;      ]&quot;</span>,</span>
<span id="cb3-117"><a href="#cb3-117"></a>  <span class="st">&quot;    }).column(0).nodes().to$().css({cursor: &#39;pointer&#39;});&quot;</span>,</span>
<span id="cb3-118"><a href="#cb3-118"></a>  <span class="st">&quot;  }&quot;</span>,</span>
<span id="cb3-119"><a href="#cb3-119"></a>  <span class="st">&quot;};&quot;</span>,</span>
<span id="cb3-120"><a href="#cb3-120"></a>  <span class="st">&quot;&quot;</span>,</span>
<span id="cb3-121"><a href="#cb3-121"></a>  <span class="st">&quot;// --- display the child table on click --- //&quot;</span>,</span>
<span id="cb3-122"><a href="#cb3-122"></a>  <span class="st">&quot;// array to store id&#39;s of already created child tables&quot;</span>,</span>
<span id="cb3-123"><a href="#cb3-123"></a>  <span class="st">&quot;var children = [];&quot;</span>, </span>
<span id="cb3-124"><a href="#cb3-124"></a>  <span class="st">&quot;table.on(&#39;click&#39;, &#39;td.details-control&#39;, function(){&quot;</span>,</span>
<span id="cb3-125"><a href="#cb3-125"></a>  <span class="st">&quot;  var tbl = $(this).closest(&#39;table&#39;),&quot;</span>,</span>
<span id="cb3-126"><a href="#cb3-126"></a>  <span class="st">&quot;      tblId = tbl.attr(&#39;id&#39;),&quot;</span>,</span>
<span id="cb3-127"><a href="#cb3-127"></a>  <span class="st">&quot;      td = $(this),&quot;</span>,</span>
<span id="cb3-128"><a href="#cb3-128"></a>  <span class="st">&quot;      row = $(tbl).DataTable().row(td.closest(&#39;tr&#39;)),&quot;</span>,</span>
<span id="cb3-129"><a href="#cb3-129"></a>  <span class="st">&quot;      rowIdx = row.index();&quot;</span>,</span>
<span id="cb3-130"><a href="#cb3-130"></a>  <span class="st">&quot;  if(row.child.isShown()){&quot;</span>,</span>
<span id="cb3-131"><a href="#cb3-131"></a>  <span class="st">&quot;    row.child.hide();&quot;</span>,</span>
<span id="cb3-132"><a href="#cb3-132"></a>  <span class="st">&quot;    td.html(&#39;&amp;oplus;&#39;);&quot;</span>,</span>
<span id="cb3-133"><a href="#cb3-133"></a>  <span class="st">&quot;  } else {&quot;</span>,</span>
<span id="cb3-134"><a href="#cb3-134"></a>  <span class="st">&quot;    var childId = tblId + &#39;-child-&#39; + rowIdx;&quot;</span>,</span>
<span id="cb3-135"><a href="#cb3-135"></a>  <span class="st">&quot;    if(children.indexOf(childId) === -1){&quot;</span>, </span>
<span id="cb3-136"><a href="#cb3-136"></a>  <span class="st">&quot;      // this child has not been created yet&quot;</span>,</span>
<span id="cb3-137"><a href="#cb3-137"></a>  <span class="st">&quot;      children.push(childId);&quot;</span>,</span>
<span id="cb3-138"><a href="#cb3-138"></a>  <span class="st">&quot;      row.child(formatHeader(row.data(), childId)).show();&quot;</span>,</span>
<span id="cb3-139"><a href="#cb3-139"></a>  <span class="st">&quot;      td.html(&#39;&amp;CircleMinus;&#39;);&quot;</span>,</span>
<span id="cb3-140"><a href="#cb3-140"></a>  <span class="st">&quot;      formatDatatable(row.data(), childId, rowIdx);&quot;</span>,</span>
<span id="cb3-141"><a href="#cb3-141"></a>  <span class="st">&quot;    }else{&quot;</span>,</span>
<span id="cb3-142"><a href="#cb3-142"></a>  <span class="st">&quot;      // this child has already been created&quot;</span>,</span>
<span id="cb3-143"><a href="#cb3-143"></a>  <span class="st">&quot;      row.child(true);&quot;</span>,</span>
<span id="cb3-144"><a href="#cb3-144"></a>  <span class="st">&quot;      td.html(&#39;&amp;CircleMinus;&#39;);&quot;</span>,</span>
<span id="cb3-145"><a href="#cb3-145"></a>  <span class="st">&quot;    }&quot;</span>,</span>
<span id="cb3-146"><a href="#cb3-146"></a>  <span class="st">&quot;  }&quot;</span>,</span>
<span id="cb3-147"><a href="#cb3-147"></a>  <span class="st">&quot;});&quot;</span>)</span></code></pre></div>
<p>Now, here is the code which generates the table. The first column contains some HTML (⊕) so we have to not escape it. The last column contains the child data, it has to be hidden. Finally we assign the class <code>details-control</code> to the first column, this is used by the callback.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1"></a><span class="kw">datatable</span>(</span>
<span id="cb4-2"><a href="#cb4-2"></a>  Dat, </span>
<span id="cb4-3"><a href="#cb4-3"></a>  <span class="dt">callback =</span> callback, <span class="dt">rownames =</span> rowNames, <span class="dt">escape =</span> <span class="op">-</span>colIdx<span class="dv">-1</span>,</span>
<span id="cb4-4"><a href="#cb4-4"></a>  <span class="dt">options =</span> <span class="kw">list</span>(</span>
<span id="cb4-5"><a href="#cb4-5"></a>    <span class="dt">paging =</span> <span class="ot">FALSE</span>,</span>
<span id="cb4-6"><a href="#cb4-6"></a>    <span class="dt">searching =</span> <span class="ot">FALSE</span>,</span>
<span id="cb4-7"><a href="#cb4-7"></a>    <span class="dt">columnDefs =</span> <span class="kw">list</span>(</span>
<span id="cb4-8"><a href="#cb4-8"></a>      <span class="kw">list</span>(</span>
<span id="cb4-9"><a href="#cb4-9"></a>        <span class="dt">visible =</span> <span class="ot">FALSE</span>, </span>
<span id="cb4-10"><a href="#cb4-10"></a>        <span class="dt">targets =</span> <span class="kw">ncol</span>(Dat)<span class="op">-</span><span class="dv">1</span><span class="op">+</span>colIdx</span>
<span id="cb4-11"><a href="#cb4-11"></a>      ),</span>
<span id="cb4-12"><a href="#cb4-12"></a>      <span class="kw">list</span>(</span>
<span id="cb4-13"><a href="#cb4-13"></a>        <span class="dt">orderable =</span> <span class="ot">FALSE</span>, </span>
<span id="cb4-14"><a href="#cb4-14"></a>        <span class="dt">className =</span> <span class="st">&quot;details-control&quot;</span>, </span>
<span id="cb4-15"><a href="#cb4-15"></a>        <span class="dt">targets =</span> colIdx</span>
<span id="cb4-16"><a href="#cb4-16"></a>      ),</span>
<span id="cb4-17"><a href="#cb4-17"></a>      <span class="kw">list</span>(</span>
<span id="cb4-18"><a href="#cb4-18"></a>        <span class="dt">className =</span> <span class="st">&quot;dt-center&quot;</span>, </span>
<span id="cb4-19"><a href="#cb4-19"></a>        <span class="dt">targets =</span> <span class="st">&quot;_all&quot;</span></span>
<span id="cb4-20"><a href="#cb4-20"></a>      )</span>
<span id="cb4-21"><a href="#cb4-21"></a>    )</span>
<span id="cb4-22"><a href="#cb4-22"></a>  )</span>
<span id="cb4-23"><a href="#cb4-23"></a>)</span></code></pre></div>
<p><img src="figures/DTchildRows1.gif" /></p>
<h1 id="editing">Editing</h1>
<p>We use the JavaScript library <a href="https://github.com/ejbeaty/CellEdit">CellEdit</a> to allow cells, including the cells of the child tables, to be editable. Download the file <strong>dataTables.cellEdit.js</strong>.</p>
<p>Some CSS is required in order to make things pretty. Save the following CSS code in a file <strong>dataTables.cellEdit.css</strong>.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode css"><code class="sourceCode css"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true"></a><span class="fu">.my-input-class</span> {</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true"></a>  <span class="kw">padding</span>: <span class="dv">3</span><span class="dt">px</span> <span class="dv">6</span><span class="dt">px</span><span class="op">;</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true"></a>  <span class="kw">border</span>: <span class="dv">1</span><span class="dt">px</span> <span class="dv">solid</span> <span class="cn">#ccc</span><span class="op">;</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true"></a>  <span class="kw">border-radius</span>: <span class="dv">4</span><span class="dt">px</span><span class="op">;</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true"></a>  <span class="kw">width</span>: <span class="dv">60</span><span class="dt">px</span><span class="op">;</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true"></a>}</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true"></a></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true"></a><span class="fu">.my-confirm-class</span> {</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true"></a>  <span class="kw">padding</span>: <span class="dv">3</span><span class="dt">px</span> <span class="dv">6</span><span class="dt">px</span><span class="op">;</span></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true"></a>  <span class="kw">font-size</span>: <span class="dv">12</span><span class="dt">px</span><span class="op">;</span></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true"></a>  <span class="kw">color</span>: <span class="cn">white</span><span class="op">;</span></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true"></a>  <span class="kw">text-align</span>: <span class="dv">center</span><span class="op">;</span></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true"></a>  <span class="kw">vertical-align</span>: <span class="dv">middle</span><span class="op">;</span></span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true"></a>  <span class="kw">border-radius</span>: <span class="dv">4</span><span class="dt">px</span><span class="op">;</span></span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true"></a>  <span class="kw">background-color</span>: <span class="cn">#337ab7</span><span class="op">;</span></span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true"></a>  <span class="kw">text-decoration</span>: <span class="dv">none</span><span class="op">;</span></span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true"></a>}</span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true"></a></span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true"></a><span class="fu">.my-cancel-class</span> {</span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true"></a>  <span class="kw">padding</span>: <span class="dv">3</span><span class="dt">px</span> <span class="dv">6</span><span class="dt">px</span><span class="op">;</span></span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true"></a>  <span class="kw">font-size</span>: <span class="dv">12</span><span class="dt">px</span><span class="op">;</span></span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true"></a>  <span class="kw">color</span>: <span class="cn">white</span><span class="op">;</span></span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true"></a>  <span class="kw">text-align</span>: <span class="dv">center</span><span class="op">;</span></span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true"></a>  <span class="kw">vertical-align</span>: <span class="dv">middle</span><span class="op">;</span></span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true"></a>  <span class="kw">border-radius</span>: <span class="dv">4</span><span class="dt">px</span><span class="op">;</span></span>
<span id="cb5-26"><a href="#cb5-26" aria-hidden="true"></a>  <span class="kw">background-color</span>: <span class="cn">#a94442</span><span class="op">;</span></span>
<span id="cb5-27"><a href="#cb5-27" aria-hidden="true"></a>  <span class="kw">text-decoration</span>: <span class="dv">none</span><span class="op">;</span></span>
<span id="cb5-28"><a href="#cb5-28" aria-hidden="true"></a>}</span></code></pre></div>
<p>Now modify the callback as follows:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1"></a>callback &lt;-<span class="st"> </span><span class="kw">JS</span>(</span>
<span id="cb6-2"><a href="#cb6-2"></a>  <span class="st">&quot;function onUpdate(updatedCell, updatedRow, oldValue) {};&quot;</span>,</span>
<span id="cb6-3"><a href="#cb6-3"></a>  <span class="st">&quot;table.MakeCellsEditable({&quot;</span>,</span>
<span id="cb6-4"><a href="#cb6-4"></a>  <span class="st">&quot;  onUpdate: onUpdate,&quot;</span>,</span>
<span id="cb6-5"><a href="#cb6-5"></a>  <span class="st">&quot;  inputCss: &#39;my-input-class&#39;,&quot;</span>,</span>
<span id="cb6-6"><a href="#cb6-6"></a>  <span class="st">&quot;  confirmationButton: {&quot;</span>,</span>
<span id="cb6-7"><a href="#cb6-7"></a>  <span class="st">&quot;    confirmCss: &#39;my-confirm-class&#39;,&quot;</span>,</span>
<span id="cb6-8"><a href="#cb6-8"></a>  <span class="st">&quot;    cancelCss: &#39;my-cancel-class&#39;&quot;</span>,</span>
<span id="cb6-9"><a href="#cb6-9"></a>  <span class="st">&quot;  }&quot;</span>,</span>
<span id="cb6-10"><a href="#cb6-10"></a>  <span class="st">&quot;});&quot;</span>,</span>
<span id="cb6-11"><a href="#cb6-11"></a>  <span class="kw">sprintf</span>(<span class="st">&quot;var parentRows = [%s];&quot;</span>, <span class="kw">toString</span>(parentRows<span class="dv">-1</span>)),</span>
<span id="cb6-12"><a href="#cb6-12"></a>  </span>
<span id="cb6-13"><a href="#cb6-13"></a>  ......</span>
<span id="cb6-14"><a href="#cb6-14"></a>  </span>
<span id="cb6-15"><a href="#cb6-15"></a>  <span class="st">&quot;// --- make the datatable --- //&quot;</span>,</span>
<span id="cb6-16"><a href="#cb6-16"></a>  <span class="st">&quot;var formatDatatable = function(d, childId){&quot;</span>,</span>
<span id="cb6-17"><a href="#cb6-17"></a>  </span>
<span id="cb6-18"><a href="#cb6-18"></a>  ......</span>
<span id="cb6-19"><a href="#cb6-19"></a></span>
<span id="cb6-20"><a href="#cb6-20"></a>  <span class="st">&quot;    }).column(0).nodes().to$().css({cursor: &#39;pointer&#39;});&quot;</span>,</span>
<span id="cb6-21"><a href="#cb6-21"></a>  <span class="st">&quot;  }&quot;</span>,</span>
<span id="cb6-22"><a href="#cb6-22"></a>  <span class="st">&quot;  subtable.MakeCellsEditable({&quot;</span>,</span>
<span id="cb6-23"><a href="#cb6-23"></a>  <span class="st">&quot;    onUpdate: onUpdate,&quot;</span>,</span>
<span id="cb6-24"><a href="#cb6-24"></a>  <span class="st">&quot;    inputCss: &#39;my-input-class&#39;,&quot;</span>,</span>
<span id="cb6-25"><a href="#cb6-25"></a>  <span class="st">&quot;    confirmationButton: {&quot;</span>,</span>
<span id="cb6-26"><a href="#cb6-26"></a>  <span class="st">&quot;      confirmCss: &#39;my-confirm-class&#39;,&quot;</span>,</span>
<span id="cb6-27"><a href="#cb6-27"></a>  <span class="st">&quot;      cancelCss: &#39;my-cancel-class&#39;&quot;</span>,</span>
<span id="cb6-28"><a href="#cb6-28"></a>  <span class="st">&quot;    }&quot;</span>,</span>
<span id="cb6-29"><a href="#cb6-29"></a>  <span class="st">&quot;  });&quot;</span>,</span>
<span id="cb6-30"><a href="#cb6-30"></a>  <span class="st">&quot;};&quot;</span>,</span>
<span id="cb6-31"><a href="#cb6-31"></a>  <span class="st">&quot;&quot;</span>,</span>
<span id="cb6-32"><a href="#cb6-32"></a>  <span class="st">&quot;// --- display the child table on click --- //&quot;</span>,</span>
<span id="cb6-33"><a href="#cb6-33"></a></span>
<span id="cb6-34"><a href="#cb6-34"></a>  ......</span>
<span id="cb6-35"><a href="#cb6-35"></a>  </span>
<span id="cb6-36"><a href="#cb6-36"></a>  <span class="st">&quot;});&quot;</span>)</span></code></pre></div>
<p>Use the same code as before to generate the table but store the output:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1"></a>dtable &lt;-<span class="st"> </span><span class="kw">datatable</span>(</span>
<span id="cb7-2"><a href="#cb7-2"></a>  Dat, </span>
<span id="cb7-3"><a href="#cb7-3"></a>  <span class="dt">callback =</span> callback, <span class="dt">rownames =</span> rowNames, <span class="dt">escape =</span> <span class="op">-</span>colIdx<span class="dv">-1</span>,</span>
<span id="cb7-4"><a href="#cb7-4"></a>  <span class="dt">options =</span> <span class="kw">list</span>(</span>
<span id="cb7-5"><a href="#cb7-5"></a>    <span class="dt">paging =</span> <span class="ot">FALSE</span>,</span>
<span id="cb7-6"><a href="#cb7-6"></a>    <span class="dt">searching =</span> <span class="ot">FALSE</span>,</span>
<span id="cb7-7"><a href="#cb7-7"></a>    <span class="dt">columnDefs =</span> <span class="kw">list</span>(</span>
<span id="cb7-8"><a href="#cb7-8"></a>      <span class="kw">list</span>(</span>
<span id="cb7-9"><a href="#cb7-9"></a>        <span class="dt">visible =</span> <span class="ot">FALSE</span>, </span>
<span id="cb7-10"><a href="#cb7-10"></a>        <span class="dt">targets =</span> <span class="kw">ncol</span>(Dat)<span class="op">-</span><span class="dv">1</span><span class="op">+</span>colIdx</span>
<span id="cb7-11"><a href="#cb7-11"></a>      ),</span>
<span id="cb7-12"><a href="#cb7-12"></a>      <span class="kw">list</span>(</span>
<span id="cb7-13"><a href="#cb7-13"></a>        <span class="dt">orderable =</span> <span class="ot">FALSE</span>, </span>
<span id="cb7-14"><a href="#cb7-14"></a>        <span class="dt">className =</span> <span class="st">&quot;details-control&quot;</span>, </span>
<span id="cb7-15"><a href="#cb7-15"></a>        <span class="dt">targets =</span> colIdx</span>
<span id="cb7-16"><a href="#cb7-16"></a>      ),</span>
<span id="cb7-17"><a href="#cb7-17"></a>      <span class="kw">list</span>(</span>
<span id="cb7-18"><a href="#cb7-18"></a>        <span class="dt">className =</span> <span class="st">&quot;dt-center&quot;</span>, </span>
<span id="cb7-19"><a href="#cb7-19"></a>        <span class="dt">targets =</span> <span class="st">&quot;_all&quot;</span></span>
<span id="cb7-20"><a href="#cb7-20"></a>      )</span>
<span id="cb7-21"><a href="#cb7-21"></a>    )</span>
<span id="cb7-22"><a href="#cb7-22"></a>  )</span>
<span id="cb7-23"><a href="#cb7-23"></a>)</span></code></pre></div>
<p>Now we add the dependencies to the <code>datatable</code>:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1"></a>path &lt;-<span class="st"> &quot;path/to/cellEdit&quot;</span> <span class="co"># folder containing the files </span></span>
<span id="cb8-2"><a href="#cb8-2"></a>                           <span class="co"># dataTables.cellEdit.js and </span></span>
<span id="cb8-3"><a href="#cb8-3"></a>                           <span class="co"># dataTables.cellEdit.css</span></span>
<span id="cb8-4"><a href="#cb8-4"></a>dep &lt;-<span class="st"> </span>htmltools<span class="op">::</span><span class="kw">htmlDependency</span>(</span>
<span id="cb8-5"><a href="#cb8-5"></a>  <span class="st">&quot;CellEdit&quot;</span>, <span class="st">&quot;1.0.19&quot;</span>, path, </span>
<span id="cb8-6"><a href="#cb8-6"></a>  <span class="dt">script =</span> <span class="st">&quot;dataTables.cellEdit.js&quot;</span>, </span>
<span id="cb8-7"><a href="#cb8-7"></a>  <span class="dt">stylesheet =</span> <span class="st">&quot;dataTables.cellEdit.css&quot;</span>)</span>
<span id="cb8-8"><a href="#cb8-8"></a>dtable<span class="op">$</span>dependencies &lt;-<span class="st"> </span><span class="kw">c</span>(dtable<span class="op">$</span>dependencies, <span class="kw">list</span>(dep))</span>
<span id="cb8-9"><a href="#cb8-9"></a></span>
<span id="cb8-10"><a href="#cb8-10"></a>dtable</span></code></pre></div>
<p><img src="figures/DTchildRows2.gif" /></p>
<h1 id="exporting">Exporting</h1>
<p>Now we show how to export a table with its child tables to an Excel file, when there is only one level of child tables (<em>i.e.</em> when the child tables of the main table do not have child tables themselves). To do so, we use the <code>customize</code> callback of the Excel button provided by the <code>Buttons</code> extension. I found this code on the DataTables forum. In the first row of the callback, <code>mytable</code> is the id of the datatable:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true"></a><span class="kw">var</span> table <span class="op">=</span> <span class="fu">$</span>(<span class="st">&#39;#mytable&#39;</span>)<span class="op">.</span><span class="fu">find</span>(<span class="st">&#39;table&#39;</span>)<span class="op">.</span><span class="fu">DataTable</span>()<span class="op">;</span></span></code></pre></div>
<p>If you don’t use Shiny, you have to set this id in the <code>elementId</code> argument of the <code>datatable</code> function. If you use Shiny, this id is the key of the element of the <code>output</code> object in which you assign a <code>renderDT</code>:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true"></a>output[[<span class="st">&quot;mytable&quot;</span>]] &lt;-<span class="st"> </span><span class="kw">renderDT</span>({</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true"></a>  ......</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true"></a>})</span></code></pre></div>
<p>The JavaScript code depends on whether the user desires a title in the Excel file, so this information has to be provided first.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1"></a>excelTitle =<span class="st"> </span><span class="ot">NULL</span> <span class="co"># enter title or set to NULL if you don&#39;t want a title</span></span>
<span id="cb11-2"><a href="#cb11-2"></a>js_customXLSX &lt;-<span class="st"> </span><span class="kw">JS</span>(</span>
<span id="cb11-3"><a href="#cb11-3"></a>  <span class="st">&quot;function(xlsx){&quot;</span>,</span>
<span id="cb11-4"><a href="#cb11-4"></a>  <span class="st">&quot;  var table = $(&#39;#mytable&#39;).find(&#39;table&#39;).DataTable();&quot;</span>,</span>
<span id="cb11-5"><a href="#cb11-5"></a>  <span class="st">&quot;  // Number of columns.&quot;</span>,</span>
<span id="cb11-6"><a href="#cb11-6"></a>  <span class="kw">sprintf</span>(<span class="st">&quot;  var ncols = %d;&quot;</span>, <span class="kw">ncol</span>(Dat)),</span>
<span id="cb11-7"><a href="#cb11-7"></a>  <span class="st">&quot;  // Is there a title?&quot;</span>,</span>
<span id="cb11-8"><a href="#cb11-8"></a>  <span class="kw">sprintf</span>(<span class="st">&quot;  var title = %s;&quot;</span>, </span>
<span id="cb11-9"><a href="#cb11-9"></a>          <span class="kw">ifelse</span>(<span class="kw">is.null</span>(excelTitle), <span class="st">&quot;false&quot;</span>, <span class="st">&quot;true&quot;</span>)),</span>
<span id="cb11-10"><a href="#cb11-10"></a>  <span class="st">&quot;  // Integer to Excel column: 0 -&gt; A, 1 -&gt; B, ..., 25 -&gt; Z, 26 -&gt; AA, ...&quot;</span>,</span>
<span id="cb11-11"><a href="#cb11-11"></a>  <span class="st">&quot;  var XLcolumn = function(j){&quot;</span>, </span>
<span id="cb11-12"><a href="#cb11-12"></a>  <span class="st">&quot;    return j &lt; 0 ? &quot;</span>,</span>
<span id="cb11-13"><a href="#cb11-13"></a>  <span class="st">&quot;      &#39;&#39; : XLcolumn(j/26-1) + String.fromCharCode(j % 26 + 65);&quot;</span>,</span>
<span id="cb11-14"><a href="#cb11-14"></a>  <span class="st">&quot;  };&quot;</span>,</span>
<span id="cb11-15"><a href="#cb11-15"></a>  <span class="st">&quot;  // Get sheet.&quot;</span>,</span>
<span id="cb11-16"><a href="#cb11-16"></a>  <span class="st">&quot;  var sheet = xlsx.xl.worksheets[&#39;sheet1.xml&#39;];&quot;</span>,</span>
<span id="cb11-17"><a href="#cb11-17"></a>  <span class="st">&quot;  // Get a clone of the sheet data.        &quot;</span>,</span>
<span id="cb11-18"><a href="#cb11-18"></a>  <span class="st">&quot;  var sheetData = $(&#39;sheetData&#39;, sheet).clone();&quot;</span>,</span>
<span id="cb11-19"><a href="#cb11-19"></a>  <span class="st">&quot;  // Clear the current sheet data for appending rows.&quot;</span>,</span>
<span id="cb11-20"><a href="#cb11-20"></a>  <span class="st">&quot;  $(&#39;sheetData&#39;, sheet).empty();&quot;</span>,</span>
<span id="cb11-21"><a href="#cb11-21"></a>  <span class="st">&quot;  // Row count in Excel sheet.&quot;</span>,</span>
<span id="cb11-22"><a href="#cb11-22"></a>  <span class="st">&quot;  var rowCount = 1;&quot;</span>,</span>
<span id="cb11-23"><a href="#cb11-23"></a>  <span class="st">&quot;  // Iterate each row in the sheet data.&quot;</span>,</span>
<span id="cb11-24"><a href="#cb11-24"></a>  <span class="st">&quot;  $(sheetData).children().each(function (index) {&quot;</span>,</span>
<span id="cb11-25"><a href="#cb11-25"></a>  <span class="st">&quot;    // Used for DT row() API to get child data.&quot;</span>,</span>
<span id="cb11-26"><a href="#cb11-26"></a>  <span class="st">&quot;    var rowIndex = title ? index - 2 : index - 1;&quot;</span>, </span>
<span id="cb11-27"><a href="#cb11-27"></a>  <span class="st">&quot;    // Don&#39;t process row if it&#39;s the title row or the header row.&quot;</span>,</span>
<span id="cb11-28"><a href="#cb11-28"></a>  <span class="st">&quot;    var i0 = title ? 1 : 0;&quot;</span>,</span>
<span id="cb11-29"><a href="#cb11-29"></a>  <span class="st">&quot;    if (index &gt; i0) {&quot;</span>, </span>
<span id="cb11-30"><a href="#cb11-30"></a>  <span class="st">&quot;      // Get row&quot;</span>,</span>
<span id="cb11-31"><a href="#cb11-31"></a>  <span class="st">&quot;      var row = $(this.outerHTML);&quot;</span>,</span>
<span id="cb11-32"><a href="#cb11-32"></a>  <span class="st">&quot;      // Set the Excel row attr to the current Excel row count.&quot;</span>,</span>
<span id="cb11-33"><a href="#cb11-33"></a>  <span class="st">&quot;      row.attr(&#39;r&#39;, rowCount);&quot;</span>,</span>
<span id="cb11-34"><a href="#cb11-34"></a>  <span class="st">&quot;      // Iterate each cell in the row to change the row number.&quot;</span>,</span>
<span id="cb11-35"><a href="#cb11-35"></a>  <span class="st">&quot;      row.children().each(function (index) {&quot;</span>,</span>
<span id="cb11-36"><a href="#cb11-36"></a>  <span class="st">&quot;        var cell = $(this);&quot;</span>,</span>
<span id="cb11-37"><a href="#cb11-37"></a>  <span class="st">&quot;        // Set each cell&#39;s row value.&quot;</span>,</span>
<span id="cb11-38"><a href="#cb11-38"></a>  <span class="st">&quot;        var rc = cell.attr(&#39;r&#39;);&quot;</span>,</span>
<span id="cb11-39"><a href="#cb11-39"></a>  <span class="st">&quot;        rc = rc.replace(/</span><span class="ch">\\</span><span class="st">d+$/, </span><span class="ch">\&quot;\&quot;</span><span class="st">) + rowCount;&quot;</span>,</span>
<span id="cb11-40"><a href="#cb11-40"></a>  <span class="st">&quot;        cell.attr(&#39;r&#39;, rc);&quot;</span>,</span>
<span id="cb11-41"><a href="#cb11-41"></a>  <span class="st">&quot;      });&quot;</span>,</span>
<span id="cb11-42"><a href="#cb11-42"></a>  <span class="st">&quot;      // Get the row HTML and append to sheetData.&quot;</span>,</span>
<span id="cb11-43"><a href="#cb11-43"></a>  <span class="st">&quot;      row = row[0].outerHTML;&quot;</span>,</span>
<span id="cb11-44"><a href="#cb11-44"></a>  <span class="st">&quot;      $(&#39;sheetData&#39;, sheet).append(row);&quot;</span>,</span>
<span id="cb11-45"><a href="#cb11-45"></a>  <span class="st">&quot;      rowCount++;&quot;</span>,</span>
<span id="cb11-46"><a href="#cb11-46"></a>  <span class="st">&quot;      // Get the child data - could be any data attached to the row.&quot;</span>,</span>
<span id="cb11-47"><a href="#cb11-47"></a>  <span class="st">&quot;      var data = table.row(&#39;:eq(&#39; + rowIndex + &#39;)&#39;).data();&quot;</span>,</span>
<span id="cb11-48"><a href="#cb11-48"></a>  <span class="st">&quot;      var childData = data[ncols-1];&quot;</span>, </span>
<span id="cb11-49"><a href="#cb11-49"></a>  <span class="st">&quot;      if(childData.length &gt; 0){&quot;</span>,</span>
<span id="cb11-50"><a href="#cb11-50"></a>  <span class="st">&quot;        var colNames = Object.keys(childData[0]);&quot;</span>,</span>
<span id="cb11-51"><a href="#cb11-51"></a>  <span class="st">&quot;        // Prepare Excel formatted row&quot;</span>,</span>
<span id="cb11-52"><a href="#cb11-52"></a>  <span class="st">&quot;        var headerRow = &#39;&lt;row r=</span><span class="ch">\&quot;</span><span class="st">&#39; + rowCount +&quot;</span>,</span>
<span id="cb11-53"><a href="#cb11-53"></a>  <span class="st">&quot;          &#39;</span><span class="ch">\&quot;</span><span class="st">&gt;&lt;c t=</span><span class="ch">\&quot;</span><span class="st">inlineStr</span><span class="ch">\&quot;</span><span class="st"> r=</span><span class="ch">\&quot;</span><span class="st">A&#39; + rowCount +&quot;</span>,</span>
<span id="cb11-54"><a href="#cb11-54"></a>  <span class="st">&quot;          &#39;</span><span class="ch">\&quot;</span><span class="st">&gt;&lt;is&gt;&lt;t&gt;&lt;/t&gt;&lt;/is&gt;&lt;/c&gt;&#39;;&quot;</span>,</span>
<span id="cb11-55"><a href="#cb11-55"></a>  <span class="st">&quot;        for(let i = 0; i &lt; colNames.length; i++){&quot;</span>,</span>
<span id="cb11-56"><a href="#cb11-56"></a>  <span class="st">&quot;          headerRow = headerRow +&quot;</span>,</span>
<span id="cb11-57"><a href="#cb11-57"></a>  <span class="st">&quot;            &#39;&lt;c t=</span><span class="ch">\&quot;</span><span class="st">inlineStr</span><span class="ch">\&quot;</span><span class="st"> r=</span><span class="ch">\&quot;</span><span class="st">&#39; + XLcolumn(i+1) + rowCount +&quot;</span>,</span>
<span id="cb11-58"><a href="#cb11-58"></a>  <span class="st">&quot;            &#39;</span><span class="ch">\&quot;</span><span class="st"> s=</span><span class="ch">\&quot;</span><span class="st">7</span><span class="ch">\&quot;</span><span class="st">&gt;&lt;is&gt;&lt;t&gt;&#39; + colNames[i] +&quot;</span>, </span>
<span id="cb11-59"><a href="#cb11-59"></a>  <span class="st">&quot;            &#39;&lt;/t&gt;&lt;/is&gt;&lt;/c&gt;&#39;;&quot;</span>,</span>
<span id="cb11-60"><a href="#cb11-60"></a>  <span class="st">&quot;        }&quot;</span>,</span>
<span id="cb11-61"><a href="#cb11-61"></a>  <span class="st">&quot;        headerRow = headerRow + &#39;&lt;/row&gt;&#39;;&quot;</span>,</span>
<span id="cb11-62"><a href="#cb11-62"></a>  <span class="st">&quot;        // Append header row to sheetData.&quot;</span>,</span>
<span id="cb11-63"><a href="#cb11-63"></a>  <span class="st">&quot;        $(&#39;sheetData&#39;, sheet).append(headerRow);&quot;</span>,</span>
<span id="cb11-64"><a href="#cb11-64"></a>  <span class="st">&quot;        rowCount++; // Increment excel row counter.&quot;</span>,</span>
<span id="cb11-65"><a href="#cb11-65"></a>  <span class="st">&quot;      }&quot;</span>,</span>
<span id="cb11-66"><a href="#cb11-66"></a>  <span class="st">&quot;      // The child data is an array of rows&quot;</span>,</span>
<span id="cb11-67"><a href="#cb11-67"></a>  <span class="st">&quot;      for(let c = 0; c &lt; childData.length; c++){&quot;</span>,</span>
<span id="cb11-68"><a href="#cb11-68"></a>  <span class="st">&quot;        // Get row data.&quot;</span>,</span>
<span id="cb11-69"><a href="#cb11-69"></a>  <span class="st">&quot;        var child = childData[c];&quot;</span>,</span>
<span id="cb11-70"><a href="#cb11-70"></a>  <span class="st">&quot;        // Prepare Excel formatted row&quot;</span>,</span>
<span id="cb11-71"><a href="#cb11-71"></a>  <span class="st">&quot;        var childRow = &#39;&lt;row r=</span><span class="ch">\&quot;</span><span class="st">&#39; + rowCount +&quot;</span>,</span>
<span id="cb11-72"><a href="#cb11-72"></a>  <span class="st">&quot;          &#39;</span><span class="ch">\&quot;</span><span class="st">&gt;&lt;c t=</span><span class="ch">\&quot;</span><span class="st">inlineStr</span><span class="ch">\&quot;</span><span class="st"> r=</span><span class="ch">\&quot;</span><span class="st">A&#39; + rowCount +&quot;</span>,</span>
<span id="cb11-73"><a href="#cb11-73"></a>  <span class="st">&quot;          &#39;</span><span class="ch">\&quot;</span><span class="st">&gt;&lt;is&gt;&lt;t&gt;&lt;/t&gt;&lt;/is&gt;&lt;/c&gt;&#39;;&quot;</span>,</span>
<span id="cb11-74"><a href="#cb11-74"></a>  <span class="st">&quot;        for(let i = 0; i &lt; colNames.length; i++){&quot;</span>,</span>
<span id="cb11-75"><a href="#cb11-75"></a>  <span class="st">&quot;          childRow = childRow +&quot;</span>,</span>
<span id="cb11-76"><a href="#cb11-76"></a>  <span class="st">&quot;            &#39;&lt;c t=</span><span class="ch">\&quot;</span><span class="st">inlineStr</span><span class="ch">\&quot;</span><span class="st"> r=</span><span class="ch">\&quot;</span><span class="st">&#39; + XLcolumn(i+1) + rowCount +&quot;</span>,</span>
<span id="cb11-77"><a href="#cb11-77"></a>  <span class="st">&quot;            &#39;</span><span class="ch">\&quot;</span><span class="st"> s=</span><span class="ch">\&quot;</span><span class="st">5</span><span class="ch">\&quot;</span><span class="st">&gt;&lt;is&gt;&lt;t&gt;&#39; + child[colNames[i]] +&quot;</span>, </span>
<span id="cb11-78"><a href="#cb11-78"></a>  <span class="st">&quot;            &#39;&lt;/t&gt;&lt;/is&gt;&lt;/c&gt;&#39;;&quot;</span>,</span>
<span id="cb11-79"><a href="#cb11-79"></a>  <span class="st">&quot;        }&quot;</span>,</span>
<span id="cb11-80"><a href="#cb11-80"></a>  <span class="st">&quot;        childRow = childRow + &#39;&lt;/row&gt;&#39;;&quot;</span>,</span>
<span id="cb11-81"><a href="#cb11-81"></a>  <span class="st">&quot;        // Append row to sheetData.&quot;</span>,</span>
<span id="cb11-82"><a href="#cb11-82"></a>  <span class="st">&quot;        $(&#39;sheetData&#39;, sheet).append(childRow);&quot;</span>,</span>
<span id="cb11-83"><a href="#cb11-83"></a>  <span class="st">&quot;        rowCount++; // Increment excel row counter.&quot;</span>,</span>
<span id="cb11-84"><a href="#cb11-84"></a>  <span class="st">&quot;      }&quot;</span>,</span>
<span id="cb11-85"><a href="#cb11-85"></a>  <span class="st">&quot;      // Just append the header row and increment excel row counter.&quot;</span>,</span>
<span id="cb11-86"><a href="#cb11-86"></a>  <span class="st">&quot;    } else {&quot;</span>,</span>
<span id="cb11-87"><a href="#cb11-87"></a>  <span class="st">&quot;      $(&#39;sheetData&#39;, sheet).append(this.outerHTML);&quot;</span>,</span>
<span id="cb11-88"><a href="#cb11-88"></a>  <span class="st">&quot;      rowCount++;&quot;</span>,</span>
<span id="cb11-89"><a href="#cb11-89"></a>  <span class="st">&quot;    }&quot;</span>,</span>
<span id="cb11-90"><a href="#cb11-90"></a>  <span class="st">&quot;  });&quot;</span>,</span>
<span id="cb11-91"><a href="#cb11-91"></a>  <span class="st">&quot;}&quot;</span></span>
<span id="cb11-92"><a href="#cb11-92"></a>)</span></code></pre></div>
<p>Let’s see an example.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1"></a>dat0  =<span class="st"> </span>iris[<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>,]         <span class="co"># main table, with three rows</span></span>
<span id="cb12-2"><a href="#cb12-2"></a>dat01 =<span class="st"> </span>airquality[<span class="dv">1</span><span class="op">:</span><span class="dv">4</span>,]   <span class="co"># |- child of first row</span></span>
<span id="cb12-3"><a href="#cb12-3"></a>dat02 =<span class="st"> </span>cars[<span class="dv">1</span><span class="op">:</span><span class="dv">2</span>,]         <span class="co"># |- child of second row</span></span>
<span id="cb12-4"><a href="#cb12-4"></a>dat03 =<span class="st"> </span>PlantGrowth[<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>,]  <span class="co"># |- child of third row</span></span>
<span id="cb12-5"><a href="#cb12-5"></a>Dat &lt;-<span class="st"> </span><span class="kw">NestedData</span>(</span>
<span id="cb12-6"><a href="#cb12-6"></a>  <span class="dt">dat =</span> dat0, </span>
<span id="cb12-7"><a href="#cb12-7"></a>  <span class="dt">children =</span> <span class="kw">list</span>(dat01, dat02, dat03)</span>
<span id="cb12-8"><a href="#cb12-8"></a>)</span></code></pre></div>
<p>Below is the code generating the table with a button for the exporting. Remember, if you use Shiny, do not set <code>elementId</code>.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1"></a>dtable &lt;-<span class="st"> </span><span class="kw">datatable</span>(</span>
<span id="cb13-2"><a href="#cb13-2"></a>  Dat, </span>
<span id="cb13-3"><a href="#cb13-3"></a>  <span class="dt">callback =</span> callback, <span class="dt">rownames =</span> rowNames, <span class="dt">escape =</span> <span class="op">-</span>colIdx<span class="dv">-1</span>,</span>
<span id="cb13-4"><a href="#cb13-4"></a>  <span class="dt">extensions =</span> <span class="st">&quot;Buttons&quot;</span>, <span class="dt">elementId =</span> <span class="st">&quot;mytable&quot;</span>,</span>
<span id="cb13-5"><a href="#cb13-5"></a>  <span class="dt">options =</span> <span class="kw">list</span>(</span>
<span id="cb13-6"><a href="#cb13-6"></a>    <span class="dt">paging =</span> <span class="ot">FALSE</span>,</span>
<span id="cb13-7"><a href="#cb13-7"></a>    <span class="dt">searching =</span> <span class="ot">FALSE</span>,</span>
<span id="cb13-8"><a href="#cb13-8"></a>    <span class="dt">dom =</span> <span class="st">&quot;Bfrtip&quot;</span>,</span>
<span id="cb13-9"><a href="#cb13-9"></a>    <span class="dt">columnDefs =</span> <span class="kw">list</span>(</span>
<span id="cb13-10"><a href="#cb13-10"></a>      <span class="kw">list</span>(</span>
<span id="cb13-11"><a href="#cb13-11"></a>        <span class="dt">visible =</span> <span class="ot">FALSE</span>, </span>
<span id="cb13-12"><a href="#cb13-12"></a>        <span class="dt">targets =</span> <span class="kw">ncol</span>(Dat)<span class="op">-</span><span class="dv">1</span><span class="op">+</span>colIdx</span>
<span id="cb13-13"><a href="#cb13-13"></a>      ),</span>
<span id="cb13-14"><a href="#cb13-14"></a>      <span class="kw">list</span>(</span>
<span id="cb13-15"><a href="#cb13-15"></a>        <span class="dt">orderable =</span> <span class="ot">FALSE</span>, </span>
<span id="cb13-16"><a href="#cb13-16"></a>        <span class="dt">className =</span> <span class="st">&quot;details-control&quot;</span>, </span>
<span id="cb13-17"><a href="#cb13-17"></a>        <span class="dt">targets =</span> colIdx</span>
<span id="cb13-18"><a href="#cb13-18"></a>      ),</span>
<span id="cb13-19"><a href="#cb13-19"></a>      <span class="kw">list</span>(</span>
<span id="cb13-20"><a href="#cb13-20"></a>        <span class="dt">className =</span> <span class="st">&quot;dt-center&quot;</span>, </span>
<span id="cb13-21"><a href="#cb13-21"></a>        <span class="dt">targets =</span> <span class="st">&quot;_all&quot;</span></span>
<span id="cb13-22"><a href="#cb13-22"></a>      )</span>
<span id="cb13-23"><a href="#cb13-23"></a>    ),</span>
<span id="cb13-24"><a href="#cb13-24"></a>    <span class="dt">buttons =</span> <span class="kw">list</span>(</span>
<span id="cb13-25"><a href="#cb13-25"></a>      <span class="kw">list</span>(</span>
<span id="cb13-26"><a href="#cb13-26"></a>        <span class="dt">extend =</span> <span class="st">&quot;excel&quot;</span>,</span>
<span id="cb13-27"><a href="#cb13-27"></a>        <span class="dt">exportOptions =</span> <span class="kw">list</span>(</span>
<span id="cb13-28"><a href="#cb13-28"></a>          <span class="dt">orthogonal =</span> <span class="st">&quot;export&quot;</span>, </span>
<span id="cb13-29"><a href="#cb13-29"></a>          <span class="dt">columns =</span> <span class="dv">0</span><span class="op">:</span>(<span class="kw">ncol</span>(Dat)<span class="op">-</span><span class="dv">2</span>)</span>
<span id="cb13-30"><a href="#cb13-30"></a>        ),</span>
<span id="cb13-31"><a href="#cb13-31"></a>        <span class="dt">title =</span> excelTitle,</span>
<span id="cb13-32"><a href="#cb13-32"></a>        <span class="dt">orientation =</span> <span class="st">&quot;landscape&quot;</span>,</span>
<span id="cb13-33"><a href="#cb13-33"></a>        <span class="dt">customize =</span> js_customXLSX</span>
<span id="cb13-34"><a href="#cb13-34"></a>      )</span>
<span id="cb13-35"><a href="#cb13-35"></a>    )</span>
<span id="cb13-36"><a href="#cb13-36"></a>  )</span>
<span id="cb13-37"><a href="#cb13-37"></a>)</span></code></pre></div>
<p>Here is the Excel file one gets:</p>
<p><img src="figures/DTchildRows3.png" /></p>

        </div>


        <div id="footer">
          Site proudly generated by
          <a href="http://jaspervdj.be/hakyll">Hakyll</a>
        </div>

      </div>

    </div>

    <div class="row">
      <div class="col-sm-12">
        <div id="disqus_thread"></div>
        <div class="pagination">
          <ul>
            <li>
              <a href="http://laustep.github.io/stlahblog/">&#171; Back Home</a>
            </li>
          </ul>
        </div>
      </div>
    </div>
    
  </div>

</body>

<script src="/libraries/bootstrap/bootstrap.min.js"></script>
<script>
  var disqus_developer = 1;
  var disqus_shortname = 'stlapblog';
  // required: replace example with your forum shortname
  /* * * DON'T EDIT BELOW THIS LINE * * */
  (function () {
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = 'https://' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] ||
      document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>
<noscript>Please enable JavaScript to view the
  <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a>
</noscript>
<!-- MathJax: Fall back to local if CDN offline but local image fonts are not supported (saves >100MB) -->
<script type="text/x-mathjax-config" src="/libraries/mathjax/config/TeX-MML-AM_CHTML.js"></script>
<!-- <script>
  window.MathJax || document.write('<script type="text/x-mathjax-config">MathJax.Hub.Config({"HTML-CSS":{imageFont:null}});<\/script><script src="../libraries/mathjax/MathJax.js"><\/script>');
</script> -->


</html>]]></description>
    <pubDate>Fri, 08 May 2020 00:00:00 UT</pubDate>
    <guid>https://laustep.github.io/stlahblog/posts/DT_childTables.html</guid>
    <dc:creator>Stéphane Laurent</dc:creator>
    <category>R</category>
</item>


<item>
    <title>Focal quadrics and their lines of curvature</title>
    <link>https://laustep.github.io/stlahblog/posts/focalQuadrics.html</link>
    <description><![CDATA[<!DOCTYPE HTML>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Saturn Elephant - Focal quadrics and their lines of curvature</title>
  <link href="/libraries/bootstrap/bootstrap-grid.min.css" rel="stylesheet">
  <link rel="stylesheet" href="/css/default2.css" />
  <link rel="stylesheet" href="/css/post.css" />
  <link rel="stylesheet" href="/css/misc.css" /> 
  
    <link rel="stylesheet" href="/css/pandoc-solarized.css" /> 
   
  
  <link href="https://fonts.googleapis.com/css?family=Raleway:400,600,200,800" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/css?family=Droid+Sans" rel="stylesheet" type="text/css">
  <script src="/libraries/jquery.min.js"></script>
  <script type="text/javascript" async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML"></script>
</head>

<body>
  <div class="container-fluid">
    <div class="row">
      <!-- Sidebar. -->
      <div class="sidebar col-sm-2">
        <div class="row">
          <div class="col-sm-12" style="float:right;clear:both;margin-right:50px;margin-top:50px;">
            <a href="https://www.r-bloggers.com/">
              <img src="/images/Rbloggers.png" alt="Rbloggers" width="100%" />
            </a>
            <br/>
            <a href="http://t-redactyl.io/">
              <span style="color:black;font-weight:bold;font-family:sans-serif;font-size:25px;">Standard error</span>
            </a>
            <a href="http://timelyportfolio.blogspot.be/">
              <span style="color:grey;font-weight:bold;font-family:sans-serif;font-size:24px;">Timely portfolio</span>
            </a>
            <br/>
            <a href="https://antoineguillot.wordpress.com/blog/">
              <span style="color:white;background-color:darkblue;font-weight:bold;font-family:sans-serif;font-size:21px;border:5px solid;border-color:darkblue">ENHANCE DATA</span>
            </a>
            <br/>
            <a href="https://fronkonstin.com/">
              <span style="color:black;background-color:gold;font-weight:bold;font-size:29px;border:3px solid;border-color:gold;">Fronkonstin</span>
            </a>
          </div>
        </div>
        <div id="logos">
          <div class="row">
            <div class="col-sm-4">
              <img src="/images/AsymptoteLogo.svg" style="width: 150%; transform: rotateZ(-35deg)"/>
            </div>
            <div class="col-sm-4">
              <img src="/images/Rlogo.svg" style="width: 110%;"/>
            </div>
            <div class="col-sm-4">
              <img src="/images/shiny-hex.png" style="width: 90%;"/>
            </div>
          </div>
          <div class="row">
            <div class="col-sm-4">
              <img src="/images/Povray_logo_sphere.png" style="width: 105%;"/>
            </div>
            <div class="col-sm-4">
              <img src="/images/javascript.svg" style="width: 90%;"/>
            </div>
            <div class="col-sm-4">
              <img src="/images/haskell.svg" style="width: 110%;"/>
            </div>
          </div>
        </div>
      </div>

      <div class="main col-sm-10">
        <div id="header">
          <div id="logo">
            <a href="/">
              <img src="/images/stla.jpg" alt="stla" width="100px" />
            </a>
          </div>
          <div id="navigation" style="margin-top:50px;">
            <a href="/">Home</a>
            <a href="/about.html">About</a>
            <a href="/contact.html">Contact</a>
            <a href="/archive.html">Archive</a>
          </div>
        </div>

        <div class="content">
          <h1>Focal quadrics and their lines of curvature</h1> 
          <div class="info">
    Posted on May  3, 2020
    
        by Stéphane Laurent
    
</div>
<div class="info">
    
    Tags: <a title="All pages tagged &#39;R&#39;." href="/tags/R.html">R</a>, <a title="All pages tagged &#39;graphics&#39;." href="/tags/graphics.html">graphics</a>, <a title="All pages tagged &#39;rgl&#39;." href="/tags/rgl.html">rgl</a>, <a title="All pages tagged &#39;geometry&#39;." href="/tags/geometry.html">geometry</a>, <a title="All pages tagged &#39;maths&#39;." href="/tags/maths.html">maths</a>
    
</div>

<p>This blog post provides some R code for drawing focal quadrics and their curvatures lines with the <code>rgl</code> package.</p>
<h1 id="ellipsoid">Ellipsoid</h1>
<p>The <code>ellipsoidMesh</code> function below generates a mesh of the ellipsoid of equation <span class="math display">\[
\frac{x^2}{a^2} + \frac{y^2}{b^2} + \frac{z^2}{c^2} = 1.
\]</span></p>
<div class="sourceCode" id="cb1"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a><span class="kw">library</span>(rgl)</span>
<span id="cb1-2"><a href="#cb1-2"></a>ellipsoidMesh &lt;-<span class="st"> </span><span class="cf">function</span>(a, b, c, <span class="dt">smoothness =</span> <span class="dv">5</span>){</span>
<span id="cb1-3"><a href="#cb1-3"></a>  <span class="kw">stopifnot</span>(a <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>, b <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>, c <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>)</span>
<span id="cb1-4"><a href="#cb1-4"></a>  sphere &lt;-<span class="st"> </span><span class="kw">subdivision3d</span>(<span class="kw">icosahedron3d</span>(), <span class="dt">depth =</span> smoothness)</span>
<span id="cb1-5"><a href="#cb1-5"></a>  sphere<span class="op">$</span>vb[4L,] &lt;-<span class="st"> </span></span>
<span id="cb1-6"><a href="#cb1-6"></a><span class="st">    </span><span class="kw">apply</span>(sphere<span class="op">$</span>vb[1L<span class="op">:</span>3L,], 2L, <span class="cf">function</span>(x) <span class="kw">sqrt</span>(<span class="kw">sum</span>(x<span class="op">*</span>x)))</span>
<span id="cb1-7"><a href="#cb1-7"></a>  sphere<span class="op">$</span>normals &lt;-<span class="st"> </span>sphere<span class="op">$</span>vb</span>
<span id="cb1-8"><a href="#cb1-8"></a>  <span class="kw">scale3d</span>(sphere, a, b, c)</span>
<span id="cb1-9"><a href="#cb1-9"></a>}</span></code></pre></div>
<p>The curvature lines of this ellipsoid are generated by the function <code>curvatureLinesE</code> given below. There are two families of curvature lines. The arguments <code>nu</code> and <code>nv</code> control the numbers of curvature lines in these two families. When the ellipsoid is tri-axial, <em>i.e.</em> when <span class="math inline">\(a\)</span>, <span class="math inline">\(b\)</span>, <span class="math inline">\(c\)</span> are distinct, the arguments <code>du</code> and <code>dv</code> must be positive and they control the size of the smallest curvature lines (if they were <span class="math inline">\(0\)</span>, the smallest curvature lines would degenerate to segments). When the ellipsoid is an ellipsoid of revolution, <em>i.e.</em> when two values of <span class="math inline">\(a\)</span>, <span class="math inline">\(b\)</span>, <span class="math inline">\(c\)</span> are equal, the curvature lines are the meridians and the parallels; in this case, <code>du</code> is ignored, and <code>dv</code>, which must be positive and strictly smaller than <span class="math inline">\(\frac{\pi}{2}\)</span>, control the size of the smallest parallel.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1"></a>curvatureLinesE &lt;-<span class="st"> </span><span class="cf">function</span>(a, b, c, nu, nv, du, dv, <span class="dt">npoints =</span> <span class="dv">100</span>){</span>
<span id="cb2-2"><a href="#cb2-2"></a>  <span class="kw">stopifnot</span>(a <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>, b <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>, c <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>)</span>
<span id="cb2-3"><a href="#cb2-3"></a>  <span class="cf">if</span>((a <span class="op">!=</span><span class="st"> </span>b <span class="op">&amp;&amp;</span><span class="st"> </span>b <span class="op">!=</span><span class="st"> </span>c) <span class="op">&amp;&amp;</span><span class="st"> </span>(a <span class="op">&lt;</span><span class="st"> </span>b <span class="op">||</span><span class="st"> </span>b <span class="op">&lt;</span><span class="st"> </span>c)){</span>
<span id="cb2-4"><a href="#cb2-4"></a>    perm &lt;-<span class="st"> </span><span class="kw">order</span>(<span class="kw">c</span>(a,b,c), <span class="dt">decreasing =</span> <span class="ot">TRUE</span>)</span>
<span id="cb2-5"><a href="#cb2-5"></a>    abc &lt;-<span class="st"> </span><span class="kw">c</span>(a,b,c)[perm]</span>
<span id="cb2-6"><a href="#cb2-6"></a>    clines &lt;-<span class="st"> </span></span>
<span id="cb2-7"><a href="#cb2-7"></a><span class="st">      </span><span class="kw">curvatureLinesE</span>(abc[1L], abc[2L], abc[3L], nu, nv, du, dv, npoints)</span>
<span id="cb2-8"><a href="#cb2-8"></a>    <span class="kw">return</span>(<span class="kw">lapply</span>(clines, <span class="cf">function</span>(l) l[, perm]))</span>
<span id="cb2-9"><a href="#cb2-9"></a>  }</span>
<span id="cb2-10"><a href="#cb2-10"></a>  <span class="cf">if</span>(a <span class="op">!=</span><span class="st"> </span>b <span class="op">&amp;&amp;</span><span class="st"> </span>b <span class="op">!=</span><span class="st"> </span>c){</span>
<span id="cb2-11"><a href="#cb2-11"></a>    <span class="kw">stopifnot</span>(du <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>, dv <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>)</span>
<span id="cb2-12"><a href="#cb2-12"></a>    a2 &lt;-<span class="st"> </span>a<span class="op">^</span><span class="dv">2</span>; b2 &lt;-<span class="st"> </span>b<span class="op">^</span><span class="dv">2</span>; c2 &lt;-<span class="st"> </span>c<span class="op">^</span><span class="dv">2</span></span>
<span id="cb2-13"><a href="#cb2-13"></a>    h2ab &lt;-<span class="st"> </span>a2 <span class="op">-</span><span class="st"> </span>b2; h2ac &lt;-<span class="st"> </span>a2 <span class="op">-</span><span class="st"> </span>c2; h2bc &lt;-<span class="st"> </span>b2 <span class="op">-</span><span class="st"> </span>c2</span>
<span id="cb2-14"><a href="#cb2-14"></a>    <span class="cf">if</span>(du <span class="op">&gt;=</span><span class="st"> </span>h2ab) <span class="kw">stop</span>(<span class="st">&quot;`du` is too large.&quot;</span>)</span>
<span id="cb2-15"><a href="#cb2-15"></a>    <span class="cf">if</span>(dv <span class="op">&gt;=</span><span class="st"> </span>h2bc) <span class="kw">stop</span>(<span class="st">&quot;`dv` is too large.&quot;</span>)</span>
<span id="cb2-16"><a href="#cb2-16"></a>    out &lt;-<span class="st"> </span><span class="kw">vector</span>(<span class="st">&quot;list&quot;</span>, <span class="dv">2</span><span class="op">*</span>nv<span class="dv">-1</span> <span class="op">+</span><span class="st"> </span><span class="dv">2</span><span class="op">*</span>nu<span class="dv">-1</span>)</span>
<span id="cb2-17"><a href="#cb2-17"></a>    u_ &lt;-<span class="st"> </span><span class="kw">seq</span>(b2<span class="op">+</span>du, a2, <span class="dt">length.out =</span> nu)</span>
<span id="cb2-18"><a href="#cb2-18"></a>    s_ &lt;-<span class="st"> </span><span class="kw">seq</span>(b2, a2, <span class="dt">length.out =</span> npoints)</span>
<span id="cb2-19"><a href="#cb2-19"></a>    v_ &lt;-<span class="st"> </span><span class="kw">seq</span>(c2, b2<span class="op">-</span>dv, <span class="dt">length.out =</span> nv) </span>
<span id="cb2-20"><a href="#cb2-20"></a>    t_ &lt;-<span class="st"> </span><span class="kw">seq</span>(c2, b2, <span class="dt">length.out =</span> npoints)</span>
<span id="cb2-21"><a href="#cb2-21"></a>    mx &lt;-<span class="st"> </span>a <span class="op">/</span><span class="st"> </span><span class="kw">sqrt</span>(h2ac<span class="op">*</span>h2ab)</span>
<span id="cb2-22"><a href="#cb2-22"></a>    my &lt;-<span class="st"> </span>b <span class="op">/</span><span class="st"> </span><span class="kw">sqrt</span>(h2bc<span class="op">*</span>h2ab)</span>
<span id="cb2-23"><a href="#cb2-23"></a>    mz &lt;-<span class="st"> </span>c <span class="op">/</span><span class="st"> </span><span class="kw">sqrt</span>(h2bc<span class="op">*</span>h2ac)</span>
<span id="cb2-24"><a href="#cb2-24"></a>    <span class="cf">for</span>(j <span class="cf">in</span> 1L<span class="op">:</span>nv){</span>
<span id="cb2-25"><a href="#cb2-25"></a>      x &lt;-<span class="st"> </span>mx <span class="op">*</span><span class="st"> </span><span class="kw">sqrt</span>((a2<span class="op">-</span>s_)<span class="op">*</span>(a2<span class="op">-</span>v_[j]))</span>
<span id="cb2-26"><a href="#cb2-26"></a>      y &lt;-<span class="st"> </span>my <span class="op">*</span><span class="st"> </span><span class="kw">sqrt</span>((s_<span class="op">-</span>b2)<span class="op">*</span>(b2<span class="op">-</span>v_[j]))</span>
<span id="cb2-27"><a href="#cb2-27"></a>      z &lt;-<span class="st"> </span>mz <span class="op">*</span><span class="st"> </span><span class="kw">sqrt</span>((s_<span class="op">-</span>c2)<span class="op">*</span>(v_[j]<span class="op">-</span>c2))</span>
<span id="cb2-28"><a href="#cb2-28"></a>      M &lt;-<span class="st"> </span><span class="kw">rbind</span>(<span class="kw">cbind</span>(x, y, z), <span class="kw">cbind</span>(<span class="op">-</span>x, y, z)[(npoints<span class="dv">-1</span>)<span class="op">:</span>1L,])</span>
<span id="cb2-29"><a href="#cb2-29"></a>      M &lt;-<span class="st"> </span><span class="kw">rbind</span>(M, <span class="kw">cbind</span>(M[,1L], <span class="op">-</span>M[,2L], M[,3L])[(<span class="dv">2</span><span class="op">*</span>npoints<span class="dv">-2</span>)<span class="op">:</span>1L,])</span>
<span id="cb2-30"><a href="#cb2-30"></a>      out[[j]] &lt;-<span class="st"> </span>M</span>
<span id="cb2-31"><a href="#cb2-31"></a>      <span class="cf">if</span>(j <span class="op">&gt;</span><span class="st"> </span>1L){</span>
<span id="cb2-32"><a href="#cb2-32"></a>        out[[nv<span class="op">+</span>j<span class="dv">-1</span>]] &lt;-<span class="st"> </span><span class="kw">cbind</span>(M[,<span class="kw">c</span>(1L,2L)], <span class="op">-</span>M[,3L])</span>
<span id="cb2-33"><a href="#cb2-33"></a>      }</span>
<span id="cb2-34"><a href="#cb2-34"></a>    }</span>
<span id="cb2-35"><a href="#cb2-35"></a>    <span class="cf">for</span>(i <span class="cf">in</span> 1L<span class="op">:</span>nu){</span>
<span id="cb2-36"><a href="#cb2-36"></a>      x &lt;-<span class="st"> </span>mx <span class="op">*</span><span class="st"> </span><span class="kw">sqrt</span>((a2<span class="op">-</span>u_[i])<span class="op">*</span>(a2<span class="op">-</span>t_))</span>
<span id="cb2-37"><a href="#cb2-37"></a>      y &lt;-<span class="st"> </span>my <span class="op">*</span><span class="st"> </span><span class="kw">sqrt</span>((u_[i]<span class="op">-</span>b2)<span class="op">*</span>(b2<span class="op">-</span>t_))</span>
<span id="cb2-38"><a href="#cb2-38"></a>      z &lt;-<span class="st"> </span>mz <span class="op">*</span><span class="st"> </span><span class="kw">sqrt</span>((u_[i]<span class="op">-</span>c2)<span class="op">*</span>(t_<span class="op">-</span>c2))</span>
<span id="cb2-39"><a href="#cb2-39"></a>      M &lt;-<span class="st"> </span><span class="kw">rbind</span>(<span class="kw">cbind</span>(x, y, z), <span class="kw">cbind</span>(x, <span class="op">-</span>y, z)[(npoints<span class="dv">-1</span>)<span class="op">:</span>1L,])</span>
<span id="cb2-40"><a href="#cb2-40"></a>      M &lt;-<span class="st"> </span><span class="kw">rbind</span>(M, <span class="kw">cbind</span>(M[,<span class="kw">c</span>(1L,2L)], <span class="op">-</span>M[,3L])[(<span class="dv">2</span><span class="op">*</span>npoints<span class="dv">-2</span>)<span class="op">:</span>1L,])</span>
<span id="cb2-41"><a href="#cb2-41"></a>      out[[<span class="dv">2</span><span class="op">*</span>nv<span class="dv">-1</span><span class="op">+</span>i]] &lt;-<span class="st"> </span>M</span>
<span id="cb2-42"><a href="#cb2-42"></a>      <span class="cf">if</span>(i <span class="op">&lt;</span><span class="st"> </span>nu){</span>
<span id="cb2-43"><a href="#cb2-43"></a>        out[[<span class="dv">2</span><span class="op">*</span>nv<span class="dv">-1</span><span class="op">+</span>nu<span class="op">+</span>i]] &lt;-<span class="st"> </span><span class="kw">cbind</span>(<span class="op">-</span>M[,1L], M[,<span class="kw">c</span>(2L,3L)])</span>
<span id="cb2-44"><a href="#cb2-44"></a>      }</span>
<span id="cb2-45"><a href="#cb2-45"></a>    }</span>
<span id="cb2-46"><a href="#cb2-46"></a>  }<span class="cf">else</span>{ <span class="co"># a == b || b == c </span></span>
<span id="cb2-47"><a href="#cb2-47"></a>    <span class="co"># surface of revolution =&gt; curvature lines are meridians and parallels</span></span>
<span id="cb2-48"><a href="#cb2-48"></a>    <span class="kw">stopifnot</span>(dv <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>, dv <span class="op">&lt;</span><span class="st"> </span>pi<span class="op">/</span><span class="dv">2</span>)</span>
<span id="cb2-49"><a href="#cb2-49"></a>    out &lt;-<span class="st"> </span><span class="kw">vector</span>(<span class="st">&quot;list&quot;</span>, nu <span class="op">+</span><span class="st"> </span>nv)</span>
<span id="cb2-50"><a href="#cb2-50"></a>    u_ &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="dv">0</span>, <span class="dv">2</span><span class="op">*</span>pi, <span class="dt">length.out =</span> nu<span class="op">+</span><span class="dv">1</span>)[<span class="op">-</span>1L]</span>
<span id="cb2-51"><a href="#cb2-51"></a>    s_ &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="dv">0</span>, <span class="dv">2</span><span class="op">*</span>pi, <span class="dt">length.out =</span> npoints)</span>
<span id="cb2-52"><a href="#cb2-52"></a>    v_ &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="op">-</span>pi<span class="op">/</span><span class="dv">2</span><span class="op">+</span>dv, pi<span class="op">/</span><span class="dv">2</span><span class="op">-</span>dv, <span class="dt">length.out =</span> nv) </span>
<span id="cb2-53"><a href="#cb2-53"></a>    t_ &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="op">-</span>pi, pi, <span class="dt">length.out =</span> npoints)</span>
<span id="cb2-54"><a href="#cb2-54"></a>    coss_ &lt;-<span class="st"> </span><span class="kw">cos</span>(s_); sins_ &lt;-<span class="st"> </span><span class="kw">sin</span>(s_)</span>
<span id="cb2-55"><a href="#cb2-55"></a>    cost_ &lt;-<span class="st"> </span><span class="kw">cos</span>(t_); sint_ &lt;-<span class="st"> </span><span class="kw">sin</span>(t_)</span>
<span id="cb2-56"><a href="#cb2-56"></a>    <span class="cf">for</span>(j <span class="cf">in</span> 1L<span class="op">:</span>nv){</span>
<span id="cb2-57"><a href="#cb2-57"></a>      x &lt;-<span class="st"> </span>a <span class="op">*</span><span class="st"> </span>coss_ <span class="op">*</span><span class="st"> </span><span class="kw">cos</span>(v_[j])</span>
<span id="cb2-58"><a href="#cb2-58"></a>      y &lt;-<span class="st"> </span>b <span class="op">*</span><span class="st"> </span>sins_ <span class="op">*</span><span class="st"> </span><span class="kw">cos</span>(v_[j])</span>
<span id="cb2-59"><a href="#cb2-59"></a>      z &lt;-<span class="st"> </span>c <span class="op">*</span><span class="st"> </span><span class="kw">sin</span>(v_[j])</span>
<span id="cb2-60"><a href="#cb2-60"></a>      out[[j]] &lt;-<span class="st"> </span><span class="kw">cbind</span>(x, y, z)</span>
<span id="cb2-61"><a href="#cb2-61"></a>    }</span>
<span id="cb2-62"><a href="#cb2-62"></a>    <span class="cf">for</span>(i <span class="cf">in</span> 1L<span class="op">:</span>nu){</span>
<span id="cb2-63"><a href="#cb2-63"></a>      x &lt;-<span class="st"> </span>a <span class="op">*</span><span class="st"> </span><span class="kw">cos</span>(u_[i]) <span class="op">*</span><span class="st"> </span>cost_</span>
<span id="cb2-64"><a href="#cb2-64"></a>      y &lt;-<span class="st"> </span>b <span class="op">*</span><span class="st"> </span><span class="kw">sin</span>(u_[i]) <span class="op">*</span><span class="st"> </span>cost_</span>
<span id="cb2-65"><a href="#cb2-65"></a>      z &lt;-<span class="st"> </span>c <span class="op">*</span><span class="st"> </span>sint_</span>
<span id="cb2-66"><a href="#cb2-66"></a>      out[[nv<span class="op">+</span>i]] &lt;-<span class="st"> </span><span class="kw">cbind</span>(x, y, z)</span>
<span id="cb2-67"><a href="#cb2-67"></a>    }</span>
<span id="cb2-68"><a href="#cb2-68"></a>  }</span>
<span id="cb2-69"><a href="#cb2-69"></a>  out</span>
<span id="cb2-70"><a href="#cb2-70"></a>}</span></code></pre></div>
<p>Here is an example:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a>a =<span class="st"> </span><span class="dv">7</span>; b =<span class="st"> </span><span class="dv">5</span>; c =<span class="st"> </span><span class="dv">3</span></span>
<span id="cb3-2"><a href="#cb3-2"></a>mesh &lt;-<span class="st"> </span><span class="kw">ellipsoidMesh</span>(a, b, c)</span>
<span id="cb3-3"><a href="#cb3-3"></a>clines &lt;-<span class="st"> </span><span class="kw">curvatureLinesE</span>(a, b, c, <span class="dt">nu =</span> <span class="dv">5</span>, <span class="dt">nv =</span> <span class="dv">5</span>, <span class="dt">du =</span> <span class="fl">0.4</span>, <span class="dt">dv =</span> <span class="dv">1</span>, </span>
<span id="cb3-4"><a href="#cb3-4"></a>                          <span class="dt">npoints =</span> <span class="dv">300</span>)</span>
<span id="cb3-5"><a href="#cb3-5"></a><span class="kw">shade3d</span>(mesh, <span class="dt">col =</span> <span class="st">&quot;springgreen&quot;</span>)</span>
<span id="cb3-6"><a href="#cb3-6"></a><span class="kw">invisible</span>(<span class="kw">lapply</span>(clines, <span class="cf">function</span>(l){</span>
<span id="cb3-7"><a href="#cb3-7"></a>  <span class="kw">shade3d</span>(<span class="kw">cylinder3d</span>(l, <span class="dt">radius =</span> <span class="fl">0.08</span>, <span class="dt">sides =</span> <span class="dv">30</span>))</span>
<span id="cb3-8"><a href="#cb3-8"></a>}))</span></code></pre></div>
<p><img src="figures/quadrics_E.png" /></p>
<h1 id="one-sheeted-hyperboloid">One-sheeted hyperboloid</h1>
<p>There are three types of one-sheeted hyperboloids, corresponding to these equations: <span class="math display">\[
\frac{x^2}{a^2} + \frac{y^2}{b^2} - \frac{z^2}{c^2} = 1 \\
\frac{x^2}{a^2} - \frac{y^2}{b^2} + \frac{z^2}{c^2} = 1 \\
-\frac{x^2}{a^2} + \frac{y^2}{b^2} + \frac{z^2}{c^2} = 1.
\]</span> The <code>hyperboloidMesh</code> function below generates a mesh of the one-sheeted hyperboloid; the <code>signature</code> argument corresponds to one of the above equations, it must be <code>"++-"</code>, <code>"+-+"</code> or <code>"-++"</code>. The mesh is made of quadrilaterals and their number is controlled by the arguments <code>nu</code> and <code>nv</code>. The hyperboloid is infinite along the direction corresponding to the minus sign, and the argument <code>vmin</code> controls the truncation of the hyperboloid in this direction.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1"></a>hyperboloidMesh &lt;-<span class="st"> </span><span class="cf">function</span>(a, b, c, signature, nu, nv, vmin){</span>
<span id="cb4-2"><a href="#cb4-2"></a>  <span class="kw">stopifnot</span>(signature <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;++-&quot;</span>, <span class="st">&quot;+-+&quot;</span>, <span class="st">&quot;-++&quot;</span>))</span>
<span id="cb4-3"><a href="#cb4-3"></a>  <span class="kw">stopifnot</span>(vmin <span class="op">&lt;</span><span class="st"> </span><span class="dv">1</span>, a <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>, b <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>, c <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>)</span>
<span id="cb4-4"><a href="#cb4-4"></a>  <span class="cf">if</span>(signature <span class="op">==</span><span class="st"> &quot;+-+&quot;</span>){</span>
<span id="cb4-5"><a href="#cb4-5"></a>    mesh &lt;-<span class="st"> </span><span class="kw">hyperboloidMesh</span>(a, c, b, <span class="st">&quot;++-&quot;</span>, nu, nv, vmin)</span>
<span id="cb4-6"><a href="#cb4-6"></a>    mesh<span class="op">$</span>vb &lt;-<span class="st"> </span>mesh<span class="op">$</span>vb[<span class="kw">c</span>(1L,3L,2L,4L),]</span>
<span id="cb4-7"><a href="#cb4-7"></a>    mesh<span class="op">$</span>normals &lt;-<span class="st"> </span>mesh<span class="op">$</span>normals[<span class="kw">c</span>(1L,3L,2L),]</span>
<span id="cb4-8"><a href="#cb4-8"></a>    mesh<span class="op">$</span>ib &lt;-<span class="st"> </span>mesh<span class="op">$</span>ib[4L<span class="op">:</span>1L,]</span>
<span id="cb4-9"><a href="#cb4-9"></a>    <span class="kw">return</span>(mesh)</span>
<span id="cb4-10"><a href="#cb4-10"></a>  }<span class="cf">else</span> <span class="cf">if</span>(signature <span class="op">==</span><span class="st"> &quot;-++&quot;</span>){</span>
<span id="cb4-11"><a href="#cb4-11"></a>    mesh &lt;-<span class="st"> </span><span class="kw">hyperboloidMesh</span>(c, b, a, <span class="st">&quot;++-&quot;</span>, nu, nv, vmin)</span>
<span id="cb4-12"><a href="#cb4-12"></a>    mesh<span class="op">$</span>vb &lt;-<span class="st"> </span>mesh<span class="op">$</span>vb[<span class="kw">c</span>(3L,2L,1L,4L),]</span>
<span id="cb4-13"><a href="#cb4-13"></a>    mesh<span class="op">$</span>normals &lt;-<span class="st"> </span>mesh<span class="op">$</span>normals[<span class="kw">c</span>(3L,2L,1L),]</span>
<span id="cb4-14"><a href="#cb4-14"></a>    mesh<span class="op">$</span>ib &lt;-<span class="st"> </span>mesh<span class="op">$</span>ib[4L<span class="op">:</span>1L,]</span>
<span id="cb4-15"><a href="#cb4-15"></a>    <span class="kw">return</span>(mesh)</span>
<span id="cb4-16"><a href="#cb4-16"></a>  }</span>
<span id="cb4-17"><a href="#cb4-17"></a>  c0 &lt;-<span class="st"> </span>c</span>
<span id="cb4-18"><a href="#cb4-18"></a>  <span class="cf">if</span>(b <span class="op">&gt;</span><span class="st"> </span>a){</span>
<span id="cb4-19"><a href="#cb4-19"></a>    exchange &lt;-<span class="st"> </span><span class="ot">TRUE</span></span>
<span id="cb4-20"><a href="#cb4-20"></a>    a0 &lt;-<span class="st"> </span>b; b0 &lt;-<span class="st"> </span>a</span>
<span id="cb4-21"><a href="#cb4-21"></a>  }<span class="cf">else</span>{</span>
<span id="cb4-22"><a href="#cb4-22"></a>    exchange &lt;-<span class="st"> </span><span class="ot">FALSE</span></span>
<span id="cb4-23"><a href="#cb4-23"></a>    a0 &lt;-<span class="st"> </span>a; b0 &lt;-<span class="st"> </span>b</span>
<span id="cb4-24"><a href="#cb4-24"></a>  }</span>
<span id="cb4-25"><a href="#cb4-25"></a>  Mu2 &lt;-<span class="st"> </span>a0<span class="op">^</span><span class="dv">2</span></span>
<span id="cb4-26"><a href="#cb4-26"></a>  h2ab &lt;-<span class="st"> </span>Mu2 <span class="op">-</span><span class="st"> </span>b0<span class="op">^</span><span class="dv">2</span>; h2ac &lt;-<span class="st"> </span>c0<span class="op">^</span><span class="dv">2</span> <span class="op">+</span><span class="st"> </span>Mu2</span>
<span id="cb4-27"><a href="#cb4-27"></a>  c2 &lt;-<span class="st"> </span><span class="dv">1</span>; a2 &lt;-<span class="st"> </span>c2 <span class="op">+</span><span class="st"> </span>h2ac; b2 &lt;-<span class="st"> </span>a2 <span class="op">-</span><span class="st"> </span>h2ab</span>
<span id="cb4-28"><a href="#cb4-28"></a>  h2bc &lt;-<span class="st"> </span>b2 <span class="op">-</span><span class="st"> </span>c2</span>
<span id="cb4-29"><a href="#cb4-29"></a>  <span class="co">#</span></span>
<span id="cb4-30"><a href="#cb4-30"></a>  vertices &lt;-<span class="st"> </span>Normals &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="ot">NA_real_</span>, <span class="dt">nrow =</span> 3L, <span class="dt">ncol =</span> nu<span class="op">*</span>nv)</span>
<span id="cb4-31"><a href="#cb4-31"></a>  indices &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="ot">NA_integer_</span>, <span class="dt">nrow =</span> 4L, <span class="dt">ncol =</span> (nu<span class="dv">-1</span>)<span class="op">*</span>(nv<span class="dv">-1</span>))</span>
<span id="cb4-32"><a href="#cb4-32"></a>  v_ &lt;-<span class="st"> </span><span class="kw">seq</span>(vmin, c2, <span class="dt">length.out =</span> nv)</span>
<span id="cb4-33"><a href="#cb4-33"></a>  <span class="co">#</span></span>
<span id="cb4-34"><a href="#cb4-34"></a>  <span class="cf">if</span>(a0 <span class="op">!=</span><span class="st"> </span>b0){</span>
<span id="cb4-35"><a href="#cb4-35"></a>    u_ &lt;-<span class="st"> </span><span class="kw">seq</span>(b2, a2, <span class="dt">length.out =</span> nu)</span>
<span id="cb4-36"><a href="#cb4-36"></a>    x &lt;-<span class="st"> </span>a0 <span class="op">/</span><span class="st"> </span><span class="kw">sqrt</span>(h2ac<span class="op">*</span>h2ab) <span class="op">*</span><span class="st"> </span><span class="kw">sqrt</span>(a2<span class="op">-</span>u_)</span>
<span id="cb4-37"><a href="#cb4-37"></a>    y &lt;-<span class="st"> </span>b0 <span class="op">/</span><span class="st"> </span><span class="kw">sqrt</span>(h2bc<span class="op">*</span>h2ab) <span class="op">*</span><span class="st"> </span><span class="kw">sqrt</span>(u_<span class="op">-</span>b2)</span>
<span id="cb4-38"><a href="#cb4-38"></a>    z &lt;-<span class="st"> </span>c0 <span class="op">/</span><span class="st"> </span><span class="kw">sqrt</span>(h2bc<span class="op">*</span>h2ac) <span class="op">*</span><span class="st"> </span><span class="kw">sqrt</span>(u_<span class="op">-</span>c2)</span>
<span id="cb4-39"><a href="#cb4-39"></a>  }<span class="cf">else</span>{</span>
<span id="cb4-40"><a href="#cb4-40"></a>    u_ &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="dv">0</span>, <span class="dv">2</span><span class="op">*</span>pi, <span class="dt">length.out =</span> nu<span class="op">+</span><span class="dv">1</span>)[<span class="op">-</span>1L]</span>
<span id="cb4-41"><a href="#cb4-41"></a>    z &lt;-<span class="st"> </span><span class="kw">rep</span>(c0<span class="op">/</span><span class="kw">sqrt</span>(h2ac), nu)</span>
<span id="cb4-42"><a href="#cb4-42"></a>    mxy &lt;-<span class="st"> </span>a0 <span class="op">/</span><span class="st"> </span><span class="kw">sqrt</span>(h2ac)</span>
<span id="cb4-43"><a href="#cb4-43"></a>    x &lt;-<span class="st"> </span>mxy <span class="op">*</span><span class="st"> </span><span class="kw">cos</span>(u_)</span>
<span id="cb4-44"><a href="#cb4-44"></a>    y &lt;-<span class="st"> </span>mxy <span class="op">*</span><span class="st"> </span><span class="kw">sin</span>(u_)</span>
<span id="cb4-45"><a href="#cb4-45"></a>  }</span>
<span id="cb4-46"><a href="#cb4-46"></a>  <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>nu){</span>
<span id="cb4-47"><a href="#cb4-47"></a>    <span class="cf">for</span>(j <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>nv){</span>
<span id="cb4-48"><a href="#cb4-48"></a>      P &lt;-<span class="st"> </span>vertices[, (i<span class="dv">-1</span>)<span class="op">*</span>nv<span class="op">+</span>j] &lt;-<span class="st"> </span><span class="kw">c</span>(</span>
<span id="cb4-49"><a href="#cb4-49"></a>        x[i] <span class="op">*</span><span class="st"> </span><span class="kw">sqrt</span>(a2<span class="op">-</span>v_[j]),</span>
<span id="cb4-50"><a href="#cb4-50"></a>        y[i] <span class="op">*</span><span class="st"> </span><span class="kw">sqrt</span>(b2<span class="op">-</span>v_[j]),</span>
<span id="cb4-51"><a href="#cb4-51"></a>        z[i] <span class="op">*</span><span class="st"> </span><span class="kw">sqrt</span>(c2<span class="op">-</span>v_[j])</span>
<span id="cb4-52"><a href="#cb4-52"></a>      )</span>
<span id="cb4-53"><a href="#cb4-53"></a>      Normals[, (i<span class="dv">-1</span>)<span class="op">*</span>nv<span class="op">+</span>j] &lt;-<span class="st"> </span><span class="kw">c</span>(P[1L]<span class="op">/</span>a0<span class="op">^</span><span class="dv">2</span>, P[2L]<span class="op">/</span>b0<span class="op">^</span><span class="dv">2</span>, <span class="op">-</span>P[3L]<span class="op">/</span>c0<span class="op">^</span><span class="dv">2</span>)</span>
<span id="cb4-54"><a href="#cb4-54"></a>    }</span>
<span id="cb4-55"><a href="#cb4-55"></a>  }</span>
<span id="cb4-56"><a href="#cb4-56"></a>  <span class="co"># quads</span></span>
<span id="cb4-57"><a href="#cb4-57"></a>  <span class="cf">for</span>(i <span class="cf">in</span> 1L<span class="op">:</span>(nu<span class="dv">-1</span>)){</span>
<span id="cb4-58"><a href="#cb4-58"></a>    im1 &lt;-<span class="st"> </span>i<span class="op">-</span>1L</span>
<span id="cb4-59"><a href="#cb4-59"></a>    <span class="cf">for</span>(j <span class="cf">in</span> 1L<span class="op">:</span>(nv<span class="dv">-1</span>)){</span>
<span id="cb4-60"><a href="#cb4-60"></a>      jp1 &lt;-<span class="st"> </span>j<span class="op">+</span>1L</span>
<span id="cb4-61"><a href="#cb4-61"></a>      quad &lt;-<span class="st"> </span><span class="kw">c</span>(im1<span class="op">*</span>nv<span class="op">+</span>j, im1<span class="op">*</span>nv<span class="op">+</span>jp1, i<span class="op">*</span>nv<span class="op">+</span>jp1, i<span class="op">*</span>nv<span class="op">+</span>j)</span>
<span id="cb4-62"><a href="#cb4-62"></a>      indices[, im1<span class="op">*</span>(nv<span class="dv">-1</span>)<span class="op">+</span>j] &lt;-<span class="st"> </span><span class="cf">if</span>(exchange) <span class="kw">rev</span>(quad) <span class="cf">else</span> quad</span>
<span id="cb4-63"><a href="#cb4-63"></a>    }</span>
<span id="cb4-64"><a href="#cb4-64"></a>  }</span>
<span id="cb4-65"><a href="#cb4-65"></a>  vertices &lt;-<span class="st"> </span><span class="kw">cbind</span>(vertices, <span class="kw">c</span>(<span class="op">-</span><span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>) <span class="op">*</span><span class="st"> </span>vertices)</span>
<span id="cb4-66"><a href="#cb4-66"></a>  indices &lt;-<span class="st"> </span><span class="kw">cbind</span>(indices, indices[4L<span class="op">:</span>1L,] <span class="op">+</span><span class="st"> </span>nu<span class="op">*</span>nv)</span>
<span id="cb4-67"><a href="#cb4-67"></a>  Normals &lt;-<span class="st"> </span><span class="kw">cbind</span>(Normals, <span class="kw">c</span>(<span class="op">-</span><span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>) <span class="op">*</span><span class="st"> </span>Normals)</span>
<span id="cb4-68"><a href="#cb4-68"></a>  vertices &lt;-<span class="st"> </span><span class="kw">cbind</span>(vertices, <span class="kw">c</span>(<span class="dv">1</span>,<span class="op">-</span><span class="dv">1</span>,<span class="dv">1</span>) <span class="op">*</span><span class="st"> </span>vertices)</span>
<span id="cb4-69"><a href="#cb4-69"></a>  indices &lt;-<span class="st"> </span><span class="kw">cbind</span>(indices, indices[4L<span class="op">:</span>1L,] <span class="op">+</span><span class="st"> </span><span class="dv">2</span><span class="op">*</span>nu<span class="op">*</span>nv)</span>
<span id="cb4-70"><a href="#cb4-70"></a>  Normals &lt;-<span class="st"> </span><span class="kw">cbind</span>(Normals, <span class="kw">c</span>(<span class="dv">1</span>,<span class="op">-</span><span class="dv">1</span>,<span class="dv">1</span>) <span class="op">*</span><span class="st"> </span>Normals)</span>
<span id="cb4-71"><a href="#cb4-71"></a>  vertices &lt;-<span class="st"> </span><span class="kw">cbind</span>(vertices, <span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">1</span>,<span class="op">-</span><span class="dv">1</span>) <span class="op">*</span><span class="st"> </span>vertices)</span>
<span id="cb4-72"><a href="#cb4-72"></a>  indices &lt;-<span class="st"> </span><span class="kw">cbind</span>(indices, indices[4L<span class="op">:</span>1L,] <span class="op">+</span><span class="st"> </span><span class="dv">4</span><span class="op">*</span>nu<span class="op">*</span>nv)</span>
<span id="cb4-73"><a href="#cb4-73"></a>  Normals &lt;-<span class="st"> </span><span class="kw">cbind</span>(Normals, <span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">1</span>,<span class="op">-</span><span class="dv">1</span>) <span class="op">*</span><span class="st"> </span>Normals)</span>
<span id="cb4-74"><a href="#cb4-74"></a>  mesh &lt;-<span class="st"> </span><span class="kw">qmesh3d</span>(</span>
<span id="cb4-75"><a href="#cb4-75"></a>    <span class="dt">vertices =</span> <span class="cf">if</span>(exchange) vertices[<span class="kw">c</span>(2L,1L,3L),] <span class="cf">else</span> vertices,</span>
<span id="cb4-76"><a href="#cb4-76"></a>    <span class="dt">indices =</span> indices,</span>
<span id="cb4-77"><a href="#cb4-77"></a>    <span class="dt">homogeneous =</span> <span class="ot">FALSE</span>,</span>
<span id="cb4-78"><a href="#cb4-78"></a>    <span class="dt">normals =</span> <span class="kw">t</span>(<span class="cf">if</span>(exchange) Normals[<span class="kw">c</span>(2L,1L,3L),] <span class="cf">else</span> Normals)</span>
<span id="cb4-79"><a href="#cb4-79"></a>  )</span>
<span id="cb4-80"><a href="#cb4-80"></a>  mesh</span>
<span id="cb4-81"><a href="#cb4-81"></a>}</span></code></pre></div>
<p>The <code>curvatureLinesH1</code> function below generates some curvature lines of the one-sheeted hyperboloid. There are two families of curvature lines and the desired numbers of lines in them are controlled by the arguments <code>nu</code> and <code>nv</code>.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1"></a>curvatureLinesH1 &lt;-<span class="st"> </span><span class="cf">function</span>(a, b, c, <span class="dt">signature =</span> <span class="st">&quot;++-&quot;</span>, nu, nv, vmin,  </span>
<span id="cb5-2"><a href="#cb5-2"></a>                             <span class="dt">npoints =</span> <span class="dv">100</span>){</span>
<span id="cb5-3"><a href="#cb5-3"></a>  <span class="kw">stopifnot</span>(signature <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;++-&quot;</span>, <span class="st">&quot;+-+&quot;</span>, <span class="st">&quot;-++&quot;</span>))</span>
<span id="cb5-4"><a href="#cb5-4"></a>  <span class="kw">stopifnot</span>(vmin <span class="op">&lt;</span><span class="st"> </span><span class="dv">1</span>, a <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>, b <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>, c <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>)</span>
<span id="cb5-5"><a href="#cb5-5"></a>  <span class="cf">if</span>(signature <span class="op">==</span><span class="st"> &quot;+-+&quot;</span>){</span>
<span id="cb5-6"><a href="#cb5-6"></a>    clines &lt;-<span class="st"> </span><span class="kw">curvatureLinesH1</span>(a, c, b, <span class="st">&quot;++-&quot;</span>, nu, nv, vmin, npoints)</span>
<span id="cb5-7"><a href="#cb5-7"></a>    <span class="kw">return</span>(<span class="kw">lapply</span>(clines, <span class="cf">function</span>(l) l[,<span class="kw">c</span>(1L,3L,2L)]))</span>
<span id="cb5-8"><a href="#cb5-8"></a>  }<span class="cf">else</span> <span class="cf">if</span>(signature <span class="op">==</span><span class="st"> &quot;-++&quot;</span>){</span>
<span id="cb5-9"><a href="#cb5-9"></a>    clines &lt;-<span class="st"> </span><span class="kw">curvatureLinesH1</span>(c, b, a, <span class="st">&quot;++-&quot;</span>, nu, nv, vmin, npoints)</span>
<span id="cb5-10"><a href="#cb5-10"></a>    <span class="kw">return</span>(<span class="kw">lapply</span>(clines, <span class="cf">function</span>(l) l[,<span class="kw">c</span>(3L,2L,1L)]))</span>
<span id="cb5-11"><a href="#cb5-11"></a>  }</span>
<span id="cb5-12"><a href="#cb5-12"></a>  c0 &lt;-<span class="st"> </span>c</span>
<span id="cb5-13"><a href="#cb5-13"></a>  <span class="cf">if</span>(b <span class="op">&gt;</span><span class="st"> </span>a){</span>
<span id="cb5-14"><a href="#cb5-14"></a>    exchange &lt;-<span class="st"> </span><span class="ot">TRUE</span></span>
<span id="cb5-15"><a href="#cb5-15"></a>    a0 &lt;-<span class="st"> </span>b; b0 &lt;-<span class="st"> </span>a</span>
<span id="cb5-16"><a href="#cb5-16"></a>  }<span class="cf">else</span>{</span>
<span id="cb5-17"><a href="#cb5-17"></a>    exchange &lt;-<span class="st"> </span><span class="ot">FALSE</span></span>
<span id="cb5-18"><a href="#cb5-18"></a>    a0 &lt;-<span class="st"> </span>a; b0 &lt;-<span class="st"> </span>b</span>
<span id="cb5-19"><a href="#cb5-19"></a>  }</span>
<span id="cb5-20"><a href="#cb5-20"></a>  Mu2 &lt;-<span class="st"> </span>a0<span class="op">^</span><span class="dv">2</span></span>
<span id="cb5-21"><a href="#cb5-21"></a>  h2ab &lt;-<span class="st"> </span>Mu2 <span class="op">-</span><span class="st"> </span>b0<span class="op">^</span><span class="dv">2</span>; h2ac &lt;-<span class="st"> </span>c0<span class="op">^</span><span class="dv">2</span> <span class="op">+</span><span class="st"> </span>Mu2</span>
<span id="cb5-22"><a href="#cb5-22"></a>  c2 &lt;-<span class="st"> </span><span class="dv">1</span>; a2 &lt;-<span class="st"> </span>c2 <span class="op">+</span><span class="st"> </span>h2ac; b2 &lt;-<span class="st"> </span>a2 <span class="op">-</span><span class="st"> </span>h2ab</span>
<span id="cb5-23"><a href="#cb5-23"></a>  h2bc &lt;-<span class="st"> </span>b2 <span class="op">-</span><span class="st"> </span>c2</span>
<span id="cb5-24"><a href="#cb5-24"></a>  <span class="co">#  </span></span>
<span id="cb5-25"><a href="#cb5-25"></a>  v_ &lt;-<span class="st"> </span><span class="kw">seq</span>(vmin, c2, <span class="dt">length.out =</span> nv)</span>
<span id="cb5-26"><a href="#cb5-26"></a>  t_ &lt;-<span class="st"> </span><span class="kw">seq</span>(vmin, c2, <span class="dt">length.out =</span> npoints)</span>
<span id="cb5-27"><a href="#cb5-27"></a>  <span class="co">#</span></span>
<span id="cb5-28"><a href="#cb5-28"></a>  <span class="cf">if</span>(a0 <span class="op">!=</span><span class="st"> </span>b0){</span>
<span id="cb5-29"><a href="#cb5-29"></a>    u_ &lt;-<span class="st"> </span><span class="kw">seq</span>(b2, a2, <span class="dt">length.out =</span> nu)</span>
<span id="cb5-30"><a href="#cb5-30"></a>    s_ &lt;-<span class="st"> </span><span class="kw">seq</span>(b2, a2, <span class="dt">length.out =</span> npoints)</span>
<span id="cb5-31"><a href="#cb5-31"></a>    mx &lt;-<span class="st"> </span>a0 <span class="op">/</span><span class="st"> </span><span class="kw">sqrt</span>(h2ac<span class="op">*</span>h2ab)</span>
<span id="cb5-32"><a href="#cb5-32"></a>    my &lt;-<span class="st"> </span>b0 <span class="op">/</span><span class="st"> </span><span class="kw">sqrt</span>(h2bc<span class="op">*</span>h2ab)</span>
<span id="cb5-33"><a href="#cb5-33"></a>    mz &lt;-<span class="st"> </span>c0 <span class="op">/</span><span class="st"> </span><span class="kw">sqrt</span>(h2bc<span class="op">*</span>h2ac)</span>
<span id="cb5-34"><a href="#cb5-34"></a>    out &lt;-<span class="st"> </span><span class="kw">vector</span>(<span class="st">&quot;list&quot;</span>, <span class="dv">2</span><span class="op">*</span>nv <span class="op">+</span><span class="st"> </span><span class="dv">4</span><span class="op">*</span>nu <span class="op">-</span><span class="st"> </span><span class="dv">5</span>)</span>
<span id="cb5-35"><a href="#cb5-35"></a>    <span class="cf">for</span>(j <span class="cf">in</span> 1L<span class="op">:</span>nv){</span>
<span id="cb5-36"><a href="#cb5-36"></a>      x &lt;-<span class="st"> </span>mx <span class="op">*</span><span class="st"> </span><span class="kw">sqrt</span>((a2<span class="op">-</span>s_)<span class="op">*</span>(a2<span class="op">-</span>v_[j]))</span>
<span id="cb5-37"><a href="#cb5-37"></a>      y &lt;-<span class="st"> </span>my <span class="op">*</span><span class="st"> </span><span class="kw">sqrt</span>((s_<span class="op">-</span>b2)<span class="op">*</span>(b2<span class="op">-</span>v_[j]))</span>
<span id="cb5-38"><a href="#cb5-38"></a>      z &lt;-<span class="st"> </span>mz <span class="op">*</span><span class="st"> </span><span class="kw">sqrt</span>((s_<span class="op">-</span>c2)<span class="op">*</span>(c2<span class="op">-</span>v_[j]))</span>
<span id="cb5-39"><a href="#cb5-39"></a>      M &lt;-<span class="st"> </span><span class="kw">rbind</span>(<span class="kw">cbind</span>(x, y, z), <span class="kw">cbind</span>(<span class="op">-</span>x, y, z)[(npoints<span class="dv">-1</span>)<span class="op">:</span>1L,])</span>
<span id="cb5-40"><a href="#cb5-40"></a>      M &lt;-<span class="st"> </span><span class="kw">rbind</span>(M, <span class="kw">cbind</span>(M[,1L], <span class="op">-</span>M[,2L], M[,3L])[(<span class="dv">2</span><span class="op">*</span>npoints<span class="dv">-2</span>)<span class="op">:</span>1L,])</span>
<span id="cb5-41"><a href="#cb5-41"></a>      out[[j]] &lt;-<span class="st"> </span>M</span>
<span id="cb5-42"><a href="#cb5-42"></a>      <span class="cf">if</span>(j <span class="op">&lt;</span><span class="st"> </span>nv){</span>
<span id="cb5-43"><a href="#cb5-43"></a>        out[[nv<span class="op">+</span>j]] &lt;-<span class="st"> </span><span class="kw">cbind</span>(M[,<span class="kw">c</span>(1L,2L)], <span class="op">-</span>M[,3L])</span>
<span id="cb5-44"><a href="#cb5-44"></a>      }</span>
<span id="cb5-45"><a href="#cb5-45"></a>    }</span>
<span id="cb5-46"><a href="#cb5-46"></a>    <span class="cf">for</span>(i <span class="cf">in</span> 1L<span class="op">:</span>nu){</span>
<span id="cb5-47"><a href="#cb5-47"></a>      x &lt;-<span class="st"> </span>mx <span class="op">*</span><span class="st"> </span><span class="kw">sqrt</span>((a2<span class="op">-</span>u_[i])<span class="op">*</span>(a2<span class="op">-</span>t_))</span>
<span id="cb5-48"><a href="#cb5-48"></a>      y &lt;-<span class="st"> </span>my <span class="op">*</span><span class="st"> </span><span class="kw">sqrt</span>((u_[i]<span class="op">-</span>b2)<span class="op">*</span>(b2<span class="op">-</span>t_))</span>
<span id="cb5-49"><a href="#cb5-49"></a>      z &lt;-<span class="st"> </span>mz <span class="op">*</span><span class="st"> </span><span class="kw">sqrt</span>((u_[i]<span class="op">-</span>c2)<span class="op">*</span>(c2<span class="op">-</span>t_))</span>
<span id="cb5-50"><a href="#cb5-50"></a>      M &lt;-<span class="st"> </span><span class="kw">rbind</span>(<span class="kw">cbind</span>(x, y, z), <span class="kw">cbind</span>(x, y, <span class="op">-</span>z)[(npoints<span class="dv">-1</span>)<span class="op">:</span>1L,])</span>
<span id="cb5-51"><a href="#cb5-51"></a>      out[[<span class="dv">2</span><span class="op">*</span>nv<span class="dv">-1</span><span class="op">+</span>i]] &lt;-<span class="st"> </span>M</span>
<span id="cb5-52"><a href="#cb5-52"></a>      <span class="cf">if</span>(i <span class="op">&lt;</span><span class="st"> </span>nu){</span>
<span id="cb5-53"><a href="#cb5-53"></a>        out[[<span class="dv">2</span><span class="op">*</span>nv<span class="dv">-1</span><span class="op">+</span>nu<span class="op">+</span>i]] &lt;-<span class="st"> </span><span class="kw">cbind</span>(<span class="op">-</span>M[,1L], M[,<span class="kw">c</span>(2L,3L)])</span>
<span id="cb5-54"><a href="#cb5-54"></a>        <span class="cf">if</span>(i<span class="op">&gt;</span>1L) out[[<span class="dv">2</span><span class="op">*</span>nv<span class="op">+</span><span class="dv">3</span><span class="op">*</span>nu<span class="op">+</span>i<span class="dv">-4</span>]] &lt;-<span class="st"> </span><span class="kw">cbind</span>(<span class="op">-</span>M[,<span class="kw">c</span>(1L,2L)], M[,3L])</span>
<span id="cb5-55"><a href="#cb5-55"></a>      }</span>
<span id="cb5-56"><a href="#cb5-56"></a>      <span class="cf">if</span>(i <span class="op">&gt;</span><span class="st"> </span>1L){</span>
<span id="cb5-57"><a href="#cb5-57"></a>        out[[<span class="dv">2</span><span class="op">*</span>nv<span class="op">+</span><span class="dv">2</span><span class="op">*</span>nu<span class="op">+</span>i<span class="dv">-3</span>]] &lt;-<span class="st"> </span><span class="kw">cbind</span>(M[,1L], <span class="op">-</span>M[,2L], M[,3L])</span>
<span id="cb5-58"><a href="#cb5-58"></a>      }</span>
<span id="cb5-59"><a href="#cb5-59"></a>    }</span>
<span id="cb5-60"><a href="#cb5-60"></a>  }<span class="cf">else</span>{ <span class="co"># a0 = b0</span></span>
<span id="cb5-61"><a href="#cb5-61"></a>    u_ &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="dv">0</span>, <span class="dv">2</span><span class="op">*</span>pi, <span class="dt">length.out =</span> nu<span class="op">+</span><span class="dv">1</span>)[<span class="op">-</span>1L]</span>
<span id="cb5-62"><a href="#cb5-62"></a>    s_ &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="dv">0</span>, <span class="dv">2</span><span class="op">*</span>pi, <span class="dt">length.out =</span> npoints)</span>
<span id="cb5-63"><a href="#cb5-63"></a>    coss_ &lt;-<span class="st"> </span><span class="kw">cos</span>(s_); sins_ &lt;-<span class="st"> </span><span class="kw">sin</span>(s_)</span>
<span id="cb5-64"><a href="#cb5-64"></a>    mxy &lt;-<span class="st"> </span>a0 <span class="op">/</span><span class="st"> </span><span class="kw">sqrt</span>(h2ac)</span>
<span id="cb5-65"><a href="#cb5-65"></a>    mz &lt;-<span class="st"> </span>c0 <span class="op">/</span><span class="st"> </span><span class="kw">sqrt</span>(h2bc)</span>
<span id="cb5-66"><a href="#cb5-66"></a>    out &lt;-<span class="st"> </span><span class="kw">vector</span>(<span class="st">&quot;list&quot;</span>, <span class="dv">2</span><span class="op">*</span>nv <span class="op">+</span><span class="st"> </span><span class="dv">4</span><span class="op">*</span>nu <span class="op">-</span><span class="st"> </span><span class="dv">5</span>)</span>
<span id="cb5-67"><a href="#cb5-67"></a>    <span class="cf">for</span>(j <span class="cf">in</span> 1L<span class="op">:</span>nv){</span>
<span id="cb5-68"><a href="#cb5-68"></a>      x &lt;-<span class="st"> </span>mxy <span class="op">*</span><span class="st"> </span><span class="kw">sqrt</span>(a2<span class="op">-</span>v_[j]) <span class="op">*</span><span class="st"> </span>coss_</span>
<span id="cb5-69"><a href="#cb5-69"></a>      y &lt;-<span class="st"> </span>mxy <span class="op">*</span><span class="st"> </span><span class="kw">sqrt</span>(b2<span class="op">-</span>v_[j]) <span class="op">*</span><span class="st"> </span>sins_</span>
<span id="cb5-70"><a href="#cb5-70"></a>      z &lt;-<span class="st"> </span>mz <span class="op">*</span><span class="st"> </span><span class="kw">sqrt</span>(c2<span class="op">-</span>v_[j]) </span>
<span id="cb5-71"><a href="#cb5-71"></a>      M &lt;-<span class="st"> </span><span class="kw">cbind</span>(x, y, z)</span>
<span id="cb5-72"><a href="#cb5-72"></a>      out[[j]] &lt;-<span class="st"> </span>M</span>
<span id="cb5-73"><a href="#cb5-73"></a>      <span class="cf">if</span>(j <span class="op">&lt;</span><span class="st"> </span>nv){</span>
<span id="cb5-74"><a href="#cb5-74"></a>        out[[nv<span class="op">+</span>j]] &lt;-<span class="st"> </span><span class="kw">cbind</span>(M[,<span class="kw">c</span>(1L,2L)], <span class="op">-</span>M[,3L])</span>
<span id="cb5-75"><a href="#cb5-75"></a>      }</span>
<span id="cb5-76"><a href="#cb5-76"></a>    }</span>
<span id="cb5-77"><a href="#cb5-77"></a>    r &lt;-<span class="st"> </span>mxy <span class="op">*</span><span class="st"> </span><span class="kw">sqrt</span>(a2<span class="op">-</span>t_)</span>
<span id="cb5-78"><a href="#cb5-78"></a>    z &lt;-<span class="st"> </span>mz <span class="op">*</span><span class="st"> </span><span class="kw">sqrt</span>(c2<span class="op">-</span>t_)</span>
<span id="cb5-79"><a href="#cb5-79"></a>    <span class="cf">for</span>(i <span class="cf">in</span> 1L<span class="op">:</span>nu){</span>
<span id="cb5-80"><a href="#cb5-80"></a>      x &lt;-<span class="st"> </span>r <span class="op">*</span><span class="st"> </span><span class="kw">cos</span>(u_[i])</span>
<span id="cb5-81"><a href="#cb5-81"></a>      y &lt;-<span class="st"> </span>r <span class="op">*</span><span class="st"> </span><span class="kw">sin</span>(u_[i])</span>
<span id="cb5-82"><a href="#cb5-82"></a>      M &lt;-<span class="st"> </span><span class="kw">rbind</span>(<span class="kw">cbind</span>(x, y, z), <span class="kw">cbind</span>(x, y, <span class="op">-</span>z)[(npoints<span class="dv">-1</span>)<span class="op">:</span>1L,])</span>
<span id="cb5-83"><a href="#cb5-83"></a>      out[[<span class="dv">2</span><span class="op">*</span>nv<span class="dv">-1</span><span class="op">+</span>i]] &lt;-<span class="st"> </span>M</span>
<span id="cb5-84"><a href="#cb5-84"></a>      <span class="cf">if</span>(i <span class="op">&lt;</span><span class="st"> </span>nu){</span>
<span id="cb5-85"><a href="#cb5-85"></a>        out[[<span class="dv">2</span><span class="op">*</span>nv<span class="dv">-1</span><span class="op">+</span>nu<span class="op">+</span>i]] &lt;-<span class="st"> </span><span class="kw">cbind</span>(<span class="op">-</span>M[,1L], M[,<span class="kw">c</span>(2L,3L)])</span>
<span id="cb5-86"><a href="#cb5-86"></a>        <span class="cf">if</span>(i<span class="op">&gt;</span>1L) out[[<span class="dv">2</span><span class="op">*</span>nv<span class="op">+</span><span class="dv">3</span><span class="op">*</span>nu<span class="op">+</span>i<span class="dv">-4</span>]] &lt;-<span class="st"> </span><span class="kw">cbind</span>(<span class="op">-</span>M[,<span class="kw">c</span>(1L,2L)], M[,3L])</span>
<span id="cb5-87"><a href="#cb5-87"></a>      }</span>
<span id="cb5-88"><a href="#cb5-88"></a>      <span class="cf">if</span>(i <span class="op">&gt;</span><span class="st"> </span>1L){</span>
<span id="cb5-89"><a href="#cb5-89"></a>        out[[<span class="dv">2</span><span class="op">*</span>nv<span class="op">+</span><span class="dv">2</span><span class="op">*</span>nu<span class="op">+</span>i<span class="dv">-3</span>]] &lt;-<span class="st"> </span><span class="kw">cbind</span>(M[,1L], <span class="op">-</span>M[,2L], M[,3L])</span>
<span id="cb5-90"><a href="#cb5-90"></a>      }</span>
<span id="cb5-91"><a href="#cb5-91"></a>    }</span>
<span id="cb5-92"><a href="#cb5-92"></a>  }</span>
<span id="cb5-93"><a href="#cb5-93"></a>  <span class="cf">if</span>(exchange){</span>
<span id="cb5-94"><a href="#cb5-94"></a>    out &lt;-<span class="st"> </span><span class="kw">lapply</span>(out, <span class="cf">function</span>(M){</span>
<span id="cb5-95"><a href="#cb5-95"></a>      M[, <span class="kw">c</span>(2L,1L,3L)]</span>
<span id="cb5-96"><a href="#cb5-96"></a>    })</span>
<span id="cb5-97"><a href="#cb5-97"></a>  }</span>
<span id="cb5-98"><a href="#cb5-98"></a>  out</span>
<span id="cb5-99"><a href="#cb5-99"></a>}</span></code></pre></div>
<p>Here is an example:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1"></a>sgntr =<span class="st"> &quot;++-&quot;</span></span>
<span id="cb6-2"><a href="#cb6-2"></a>a =<span class="st"> </span><span class="dv">4</span>; b =<span class="st"> </span><span class="dv">6</span>; c =<span class="st"> </span><span class="dv">5</span></span>
<span id="cb6-3"><a href="#cb6-3"></a>mesh &lt;-<span class="st"> </span><span class="kw">hyperboloidMesh</span>(a, b, c, sgntr, <span class="dt">nu =</span> <span class="dv">100</span>, <span class="dt">nv =</span> <span class="dv">100</span>, <span class="dt">vmin =</span> <span class="dv">-150</span>)</span>
<span id="cb6-4"><a href="#cb6-4"></a>clines &lt;-<span class="st"> </span><span class="kw">curvatureLinesH1</span>(a, b, c, sgntr, <span class="dt">nu =</span> <span class="dv">5</span>, <span class="dt">nv =</span> <span class="dv">5</span>, <span class="dt">vmin =</span> <span class="dv">-150</span>)</span>
<span id="cb6-5"><a href="#cb6-5"></a><span class="kw">shade3d</span>(mesh, <span class="dt">color =</span> <span class="st">&quot;chartreuse4&quot;</span>, <span class="dt">back =</span> <span class="st">&quot;culled&quot;</span>) </span>
<span id="cb6-6"><a href="#cb6-6"></a><span class="kw">shade3d</span>(mesh, <span class="dt">color =</span> <span class="st">&quot;yellow&quot;</span>, <span class="dt">front =</span> <span class="st">&quot;culled&quot;</span>) </span>
<span id="cb6-7"><a href="#cb6-7"></a><span class="kw">invisible</span>(<span class="kw">lapply</span>(clines, <span class="cf">function</span>(l){</span>
<span id="cb6-8"><a href="#cb6-8"></a>  <span class="kw">shade3d</span>(<span class="kw">cylinder3d</span>(l, <span class="dt">radius =</span> <span class="fl">0.1</span>, <span class="dt">sides =</span> <span class="dv">30</span>))</span>
<span id="cb6-9"><a href="#cb6-9"></a>}))</span></code></pre></div>
<p><img src="figures/quadrics_H1.png" /></p>
<h1 id="two-sheeted-hyperboloid">Two-sheeted hyperboloid</h1>
<p>There are three types of two-sheeted hyperboloids, corresponding to these equations: <span class="math display">\[
\frac{x^2}{a^2} - \frac{y^2}{b^2} - \frac{z^2}{c^2} = 1 \\
-\frac{x^2}{a^2} - \frac{y^2}{b^2} + \frac{z^2}{c^2} = 1 \\
-\frac{x^2}{a^2} + \frac{y^2}{b^2} - \frac{z^2}{c^2} = 1.
\]</span> The <code>twoSheetsHyperboloidMesh</code> function below generates a mesh of the two-sheeted hyperboloid; the <code>signature</code> argument corresponds to one of the above equations, it must be <code>"+--"</code>, <code>"--+"</code> or <code>"-+-"</code>. The mesh is made of quadrilaterals and their number is controlled by the arguments <code>nu</code> and <code>nv</code>. The two-sheeted hyperboloid is infinite and the argument <code>vmin</code> is here to control its truncation.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1"></a>twoSheetsHyperboloidMesh &lt;-<span class="st"> </span><span class="cf">function</span>(a, b, c, signature, nu, nv, vmin){</span>
<span id="cb7-2"><a href="#cb7-2"></a>  <span class="kw">stopifnot</span>(signature <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;+--&quot;</span>, <span class="st">&quot;--+&quot;</span>, <span class="st">&quot;-+-&quot;</span>))</span>
<span id="cb7-3"><a href="#cb7-3"></a>  <span class="kw">stopifnot</span>(vmin <span class="op">&lt;</span><span class="st"> </span><span class="dv">1</span>)</span>
<span id="cb7-4"><a href="#cb7-4"></a>  <span class="cf">if</span>(signature <span class="op">==</span><span class="st"> &quot;--+&quot;</span>){</span>
<span id="cb7-5"><a href="#cb7-5"></a>    mesh &lt;-<span class="st"> </span><span class="kw">twoSheetsHyperboloidMesh</span>(c, b, a, <span class="st">&quot;+--&quot;</span>, nu, nv, vmin)</span>
<span id="cb7-6"><a href="#cb7-6"></a>    mesh<span class="op">$</span>vb &lt;-<span class="st"> </span>mesh<span class="op">$</span>vb[<span class="kw">c</span>(3L,2L,1L,4L),]</span>
<span id="cb7-7"><a href="#cb7-7"></a>    mesh<span class="op">$</span>normals &lt;-<span class="st"> </span>mesh<span class="op">$</span>normals[<span class="kw">c</span>(3L,2L,1L),]</span>
<span id="cb7-8"><a href="#cb7-8"></a>    mesh<span class="op">$</span>ib &lt;-<span class="st"> </span>mesh<span class="op">$</span>ib[4L<span class="op">:</span>1L,]</span>
<span id="cb7-9"><a href="#cb7-9"></a>    <span class="kw">return</span>(mesh)</span>
<span id="cb7-10"><a href="#cb7-10"></a>  }<span class="cf">else</span> <span class="cf">if</span>(signature <span class="op">==</span><span class="st"> &quot;-+-&quot;</span>){</span>
<span id="cb7-11"><a href="#cb7-11"></a>    mesh &lt;-<span class="st"> </span><span class="kw">twoSheetsHyperboloidMesh</span>(b, a, c, <span class="st">&quot;+--&quot;</span>, nu, nv, vmin)</span>
<span id="cb7-12"><a href="#cb7-12"></a>    mesh<span class="op">$</span>vb &lt;-<span class="st"> </span>mesh<span class="op">$</span>vb[<span class="kw">c</span>(2L,1L,3L,4L),]</span>
<span id="cb7-13"><a href="#cb7-13"></a>    mesh<span class="op">$</span>normals &lt;-<span class="st"> </span>mesh<span class="op">$</span>normals[<span class="kw">c</span>(2L,1L,3L),]</span>
<span id="cb7-14"><a href="#cb7-14"></a>    mesh<span class="op">$</span>ib &lt;-<span class="st"> </span>mesh<span class="op">$</span>ib[4L<span class="op">:</span>1L,]</span>
<span id="cb7-15"><a href="#cb7-15"></a>    <span class="kw">return</span>(mesh)</span>
<span id="cb7-16"><a href="#cb7-16"></a>  }</span>
<span id="cb7-17"><a href="#cb7-17"></a>  a0 &lt;-<span class="st"> </span>a</span>
<span id="cb7-18"><a href="#cb7-18"></a>  <span class="cf">if</span>(b <span class="op">&gt;</span><span class="st"> </span>c){</span>
<span id="cb7-19"><a href="#cb7-19"></a>    exchange &lt;-<span class="st"> </span><span class="ot">TRUE</span></span>
<span id="cb7-20"><a href="#cb7-20"></a>    b0 &lt;-<span class="st"> </span>c; c0 &lt;-<span class="st"> </span>b</span>
<span id="cb7-21"><a href="#cb7-21"></a>  }<span class="cf">else</span>{</span>
<span id="cb7-22"><a href="#cb7-22"></a>    exchange &lt;-<span class="st"> </span><span class="ot">FALSE</span></span>
<span id="cb7-23"><a href="#cb7-23"></a>    b0 &lt;-<span class="st"> </span>b; c0 &lt;-<span class="st"> </span>c</span>
<span id="cb7-24"><a href="#cb7-24"></a>  }</span>
<span id="cb7-25"><a href="#cb7-25"></a>  Nu2 &lt;-<span class="st"> </span>a0<span class="op">^</span><span class="dv">2</span></span>
<span id="cb7-26"><a href="#cb7-26"></a>  h2ab &lt;-<span class="st"> </span>b0<span class="op">^</span><span class="dv">2</span> <span class="op">+</span><span class="st"> </span>Nu2; h2ac &lt;-<span class="st"> </span>c0<span class="op">^</span><span class="dv">2</span> <span class="op">+</span><span class="st"> </span>Nu2</span>
<span id="cb7-27"><a href="#cb7-27"></a>  c2 &lt;-<span class="st"> </span><span class="dv">1</span>; a2 &lt;-<span class="st"> </span>c2 <span class="op">+</span><span class="st"> </span>h2ac; b2 &lt;-<span class="st"> </span>a2 <span class="op">-</span><span class="st"> </span>h2ab</span>
<span id="cb7-28"><a href="#cb7-28"></a>  h2bc &lt;-<span class="st"> </span>b2 <span class="op">-</span><span class="st"> </span>c2</span>
<span id="cb7-29"><a href="#cb7-29"></a>  <span class="co">#</span></span>
<span id="cb7-30"><a href="#cb7-30"></a>  vertices &lt;-<span class="st"> </span>Normals &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="ot">NA_real_</span>, <span class="dt">nrow =</span> 3L, <span class="dt">ncol =</span> nu<span class="op">*</span>nv)</span>
<span id="cb7-31"><a href="#cb7-31"></a>  indices &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="ot">NA_integer_</span>, <span class="dt">nrow =</span> 4L, <span class="dt">ncol =</span> (nu<span class="dv">-1</span>)<span class="op">*</span>(nv<span class="dv">-1</span>))</span>
<span id="cb7-32"><a href="#cb7-32"></a>  v_ &lt;-<span class="st"> </span><span class="kw">seq</span>(vmin, c2, <span class="dt">length.out =</span> nv)</span>
<span id="cb7-33"><a href="#cb7-33"></a>  <span class="co">#</span></span>
<span id="cb7-34"><a href="#cb7-34"></a>  <span class="cf">if</span>(b0 <span class="op">!=</span><span class="st"> </span>c0){</span>
<span id="cb7-35"><a href="#cb7-35"></a>    u_ &lt;-<span class="st"> </span><span class="kw">seq</span>(c2, b2, <span class="dt">length.out =</span> nu)</span>
<span id="cb7-36"><a href="#cb7-36"></a>    x &lt;-<span class="st"> </span>a0 <span class="op">/</span><span class="st"> </span><span class="kw">sqrt</span>(h2ac<span class="op">*</span>h2ab) <span class="op">*</span><span class="st"> </span><span class="kw">sqrt</span>(a2<span class="op">-</span>u_)</span>
<span id="cb7-37"><a href="#cb7-37"></a>    y &lt;-<span class="st"> </span>b0 <span class="op">/</span><span class="st"> </span><span class="kw">sqrt</span>(h2bc<span class="op">*</span>h2ab) <span class="op">*</span><span class="st"> </span><span class="kw">sqrt</span>(b2<span class="op">-</span>u_)</span>
<span id="cb7-38"><a href="#cb7-38"></a>    z &lt;-<span class="st"> </span>c0 <span class="op">/</span><span class="st"> </span><span class="kw">sqrt</span>(h2bc<span class="op">*</span>h2ac) <span class="op">*</span><span class="st"> </span><span class="kw">sqrt</span>(u_<span class="op">-</span>c2)</span>
<span id="cb7-39"><a href="#cb7-39"></a>  }<span class="cf">else</span>{</span>
<span id="cb7-40"><a href="#cb7-40"></a>    u_ &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="dv">0</span>, <span class="dv">2</span><span class="op">*</span>pi, <span class="dt">length.out =</span> nu<span class="op">+</span><span class="dv">1</span>)[<span class="op">-</span>1L]</span>
<span id="cb7-41"><a href="#cb7-41"></a>    x &lt;-<span class="st"> </span><span class="kw">rep</span>(a0<span class="op">/</span><span class="kw">sqrt</span>(h2ac), nu)</span>
<span id="cb7-42"><a href="#cb7-42"></a>    myz &lt;-<span class="st"> </span>b0 <span class="op">/</span><span class="st"> </span><span class="kw">sqrt</span>(h2ab)</span>
<span id="cb7-43"><a href="#cb7-43"></a>    y &lt;-<span class="st"> </span>myz <span class="op">*</span><span class="st"> </span><span class="kw">cos</span>(u_)</span>
<span id="cb7-44"><a href="#cb7-44"></a>    z &lt;-<span class="st"> </span>myz <span class="op">*</span><span class="st"> </span><span class="kw">sin</span>(u_)</span>
<span id="cb7-45"><a href="#cb7-45"></a>  }</span>
<span id="cb7-46"><a href="#cb7-46"></a>  <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>nu){</span>
<span id="cb7-47"><a href="#cb7-47"></a>    <span class="cf">for</span>(j <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>nv){</span>
<span id="cb7-48"><a href="#cb7-48"></a>      P &lt;-<span class="st"> </span>vertices[, (i<span class="dv">-1</span>)<span class="op">*</span>nv<span class="op">+</span>j] &lt;-<span class="st"> </span><span class="kw">c</span>(</span>
<span id="cb7-49"><a href="#cb7-49"></a>        x[i] <span class="op">*</span><span class="st"> </span><span class="kw">sqrt</span>(a2<span class="op">-</span>v_[j]),</span>
<span id="cb7-50"><a href="#cb7-50"></a>        y[i] <span class="op">*</span><span class="st"> </span><span class="kw">sqrt</span>(b2<span class="op">-</span>v_[j]),</span>
<span id="cb7-51"><a href="#cb7-51"></a>        z[i] <span class="op">*</span><span class="st"> </span><span class="kw">sqrt</span>(c2<span class="op">-</span>v_[j])</span>
<span id="cb7-52"><a href="#cb7-52"></a>      )</span>
<span id="cb7-53"><a href="#cb7-53"></a>      Normals[, (i<span class="dv">-1</span>)<span class="op">*</span>nv<span class="op">+</span>j] &lt;-<span class="st"> </span><span class="kw">c</span>(P[1L]<span class="op">/</span>a0<span class="op">^</span><span class="dv">2</span>, <span class="op">-</span>P[2L]<span class="op">/</span>b0<span class="op">^</span><span class="dv">2</span>, <span class="op">-</span>P[3L]<span class="op">/</span>c0<span class="op">^</span><span class="dv">2</span>)</span>
<span id="cb7-54"><a href="#cb7-54"></a>    }</span>
<span id="cb7-55"><a href="#cb7-55"></a>  }</span>
<span id="cb7-56"><a href="#cb7-56"></a>  <span class="co"># quads</span></span>
<span id="cb7-57"><a href="#cb7-57"></a>  <span class="cf">for</span>(i <span class="cf">in</span> 1L<span class="op">:</span>(nu<span class="dv">-1</span>)){</span>
<span id="cb7-58"><a href="#cb7-58"></a>    im1 &lt;-<span class="st"> </span>i<span class="op">-</span>1L</span>
<span id="cb7-59"><a href="#cb7-59"></a>    <span class="cf">for</span>(j <span class="cf">in</span> 1L<span class="op">:</span>(nv<span class="dv">-1</span>)){</span>
<span id="cb7-60"><a href="#cb7-60"></a>      jp1 &lt;-<span class="st"> </span>j<span class="op">+</span>1L</span>
<span id="cb7-61"><a href="#cb7-61"></a>      quad &lt;-<span class="st"> </span><span class="kw">c</span>(im1<span class="op">*</span>nv<span class="op">+</span>j, im1<span class="op">*</span>nv<span class="op">+</span>jp1, i<span class="op">*</span>nv<span class="op">+</span>jp1, i<span class="op">*</span>nv<span class="op">+</span>j)</span>
<span id="cb7-62"><a href="#cb7-62"></a>      indices[, im1<span class="op">*</span>(nv<span class="dv">-1</span>)<span class="op">+</span>j] &lt;-<span class="st"> </span><span class="cf">if</span>(exchange) <span class="kw">rev</span>(quad) <span class="cf">else</span> quad</span>
<span id="cb7-63"><a href="#cb7-63"></a>    }</span>
<span id="cb7-64"><a href="#cb7-64"></a>  }</span>
<span id="cb7-65"><a href="#cb7-65"></a>  vertices &lt;-<span class="st"> </span><span class="kw">cbind</span>(vertices, <span class="kw">c</span>(<span class="op">-</span><span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>) <span class="op">*</span><span class="st"> </span>vertices)</span>
<span id="cb7-66"><a href="#cb7-66"></a>  indices &lt;-<span class="st"> </span><span class="kw">cbind</span>(indices, indices[4L<span class="op">:</span>1L,] <span class="op">+</span><span class="st"> </span>nu<span class="op">*</span>nv)</span>
<span id="cb7-67"><a href="#cb7-67"></a>  Normals &lt;-<span class="st"> </span><span class="kw">cbind</span>(Normals, <span class="kw">c</span>(<span class="op">-</span><span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>) <span class="op">*</span><span class="st"> </span>Normals)</span>
<span id="cb7-68"><a href="#cb7-68"></a>  vertices &lt;-<span class="st"> </span><span class="kw">cbind</span>(vertices, <span class="kw">c</span>(<span class="dv">1</span>,<span class="op">-</span><span class="dv">1</span>,<span class="dv">1</span>) <span class="op">*</span><span class="st"> </span>vertices)</span>
<span id="cb7-69"><a href="#cb7-69"></a>  indices &lt;-<span class="st"> </span><span class="kw">cbind</span>(indices, indices[4L<span class="op">:</span>1L,] <span class="op">+</span><span class="st"> </span><span class="dv">2</span><span class="op">*</span>nu<span class="op">*</span>nv)</span>
<span id="cb7-70"><a href="#cb7-70"></a>  Normals &lt;-<span class="st"> </span><span class="kw">cbind</span>(Normals, <span class="kw">c</span>(<span class="dv">1</span>,<span class="op">-</span><span class="dv">1</span>,<span class="dv">1</span>) <span class="op">*</span><span class="st"> </span>Normals)</span>
<span id="cb7-71"><a href="#cb7-71"></a>  vertices &lt;-<span class="st"> </span><span class="kw">cbind</span>(vertices, <span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">1</span>,<span class="op">-</span><span class="dv">1</span>) <span class="op">*</span><span class="st"> </span>vertices)</span>
<span id="cb7-72"><a href="#cb7-72"></a>  indices &lt;-<span class="st"> </span><span class="kw">cbind</span>(indices, indices[4L<span class="op">:</span>1L,] <span class="op">+</span><span class="st"> </span><span class="dv">4</span><span class="op">*</span>nu<span class="op">*</span>nv)</span>
<span id="cb7-73"><a href="#cb7-73"></a>  Normals &lt;-<span class="st"> </span><span class="kw">cbind</span>(Normals, <span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">1</span>,<span class="op">-</span><span class="dv">1</span>) <span class="op">*</span><span class="st"> </span>Normals)</span>
<span id="cb7-74"><a href="#cb7-74"></a>  mesh &lt;-<span class="st"> </span><span class="kw">qmesh3d</span>(</span>
<span id="cb7-75"><a href="#cb7-75"></a>    <span class="dt">vertices =</span> <span class="cf">if</span>(exchange) vertices[<span class="kw">c</span>(1L,3L,2L),] <span class="cf">else</span> vertices,</span>
<span id="cb7-76"><a href="#cb7-76"></a>    <span class="dt">indices =</span> indices,</span>
<span id="cb7-77"><a href="#cb7-77"></a>    <span class="dt">homogeneous =</span> <span class="ot">FALSE</span>,</span>
<span id="cb7-78"><a href="#cb7-78"></a>    <span class="dt">normals =</span> <span class="op">-</span><span class="kw">t</span>(<span class="cf">if</span>(exchange) Normals[<span class="kw">c</span>(1L,3L,2L),] <span class="cf">else</span> Normals)</span>
<span id="cb7-79"><a href="#cb7-79"></a>  )</span>
<span id="cb7-80"><a href="#cb7-80"></a>  mesh</span>
<span id="cb7-81"><a href="#cb7-81"></a>}</span></code></pre></div>
<p>The <code>curvatureLinesH2</code> function below generates some curvature lines of the two-sheeted hyperboloid. The role of the arguments <code>du</code> and <code>dv</code> is similar to the role of the arguments <code>du</code> and <code>dv</code> in <code>curvatureLinesE</code>.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1"></a>curvatureLinesH2 &lt;-<span class="st"> </span><span class="cf">function</span>(a, b, c, signature, nu, nv, vmin, du, dv, </span>
<span id="cb8-2"><a href="#cb8-2"></a>                             <span class="dt">npoints =</span> <span class="dv">100</span>){</span>
<span id="cb8-3"><a href="#cb8-3"></a>  <span class="kw">stopifnot</span>(signature <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;+--&quot;</span>, <span class="st">&quot;--+&quot;</span>, <span class="st">&quot;-+-&quot;</span>))</span>
<span id="cb8-4"><a href="#cb8-4"></a>  <span class="kw">stopifnot</span>(du <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>, dv <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>, vmin <span class="op">&lt;</span><span class="st"> </span><span class="dv">1</span>)</span>
<span id="cb8-5"><a href="#cb8-5"></a>  <span class="cf">if</span>(signature <span class="op">==</span><span class="st"> &quot;--+&quot;</span>){</span>
<span id="cb8-6"><a href="#cb8-6"></a>    clines &lt;-<span class="st"> </span></span>
<span id="cb8-7"><a href="#cb8-7"></a><span class="st">      </span><span class="kw">curvatureLinesH2</span>(c, b, a, <span class="st">&quot;+--&quot;</span>, nu, nv, vmin, du, dv, npoints)</span>
<span id="cb8-8"><a href="#cb8-8"></a>    <span class="kw">return</span>(<span class="kw">lapply</span>(clines, <span class="cf">function</span>(l) l[, <span class="kw">c</span>(3L,2L,1L)]))</span>
<span id="cb8-9"><a href="#cb8-9"></a>  }<span class="cf">else</span> <span class="cf">if</span>(signature <span class="op">==</span><span class="st"> &quot;-+-&quot;</span>){</span>
<span id="cb8-10"><a href="#cb8-10"></a>    clines &lt;-<span class="st"> </span></span>
<span id="cb8-11"><a href="#cb8-11"></a><span class="st">      </span><span class="kw">curvatureLinesH2</span>(b, a, c, <span class="st">&quot;+--&quot;</span>, nu, nv, vmin, du, dv, npoints)</span>
<span id="cb8-12"><a href="#cb8-12"></a>    <span class="kw">return</span>(<span class="kw">lapply</span>(clines, <span class="cf">function</span>(l) l[, <span class="kw">c</span>(2L,1L,3L)]))</span>
<span id="cb8-13"><a href="#cb8-13"></a>  }</span>
<span id="cb8-14"><a href="#cb8-14"></a>  a0 &lt;-<span class="st"> </span>a</span>
<span id="cb8-15"><a href="#cb8-15"></a>  <span class="cf">if</span>(b <span class="op">&gt;</span><span class="st"> </span>c){</span>
<span id="cb8-16"><a href="#cb8-16"></a>    exchange &lt;-<span class="st"> </span><span class="ot">TRUE</span></span>
<span id="cb8-17"><a href="#cb8-17"></a>    b0 &lt;-<span class="st"> </span>c; c0 &lt;-<span class="st"> </span>b</span>
<span id="cb8-18"><a href="#cb8-18"></a>  }<span class="cf">else</span>{</span>
<span id="cb8-19"><a href="#cb8-19"></a>    exchange &lt;-<span class="st"> </span><span class="ot">FALSE</span></span>
<span id="cb8-20"><a href="#cb8-20"></a>    b0 &lt;-<span class="st"> </span>b; c0 &lt;-<span class="st"> </span>c</span>
<span id="cb8-21"><a href="#cb8-21"></a>  }</span>
<span id="cb8-22"><a href="#cb8-22"></a>  Nu2 &lt;-<span class="st"> </span>a0<span class="op">^</span><span class="dv">2</span></span>
<span id="cb8-23"><a href="#cb8-23"></a>  h2ab &lt;-<span class="st"> </span>b0<span class="op">^</span><span class="dv">2</span> <span class="op">+</span><span class="st"> </span>Nu2; h2ac &lt;-<span class="st"> </span>c0<span class="op">^</span><span class="dv">2</span> <span class="op">+</span><span class="st"> </span>Nu2</span>
<span id="cb8-24"><a href="#cb8-24"></a>  c2 &lt;-<span class="st"> </span><span class="dv">1</span>; a2 &lt;-<span class="st"> </span>c2 <span class="op">+</span><span class="st"> </span>h2ac; b2 &lt;-<span class="st"> </span>a2 <span class="op">-</span><span class="st"> </span>h2ab</span>
<span id="cb8-25"><a href="#cb8-25"></a>  h2bc &lt;-<span class="st"> </span>b2 <span class="op">-</span><span class="st"> </span>c2</span>
<span id="cb8-26"><a href="#cb8-26"></a>  <span class="co">#</span></span>
<span id="cb8-27"><a href="#cb8-27"></a>  <span class="cf">if</span>(b0 <span class="op">!=</span><span class="st"> </span>c0 <span class="op">&amp;&amp;</span><span class="st"> </span>c2<span class="op">+</span>du <span class="op">&gt;=</span><span class="st"> </span>b2){</span>
<span id="cb8-28"><a href="#cb8-28"></a>    <span class="kw">stop</span>(<span class="st">&quot;`du` is too large.&quot;</span>)</span>
<span id="cb8-29"><a href="#cb8-29"></a>  }</span>
<span id="cb8-30"><a href="#cb8-30"></a>  <span class="cf">if</span>(vmin <span class="op">&gt;=</span><span class="st"> </span>c2<span class="op">-</span>dv){</span>
<span id="cb8-31"><a href="#cb8-31"></a>    <span class="kw">stop</span>(<span class="st">&quot;`dv` is too large&quot;</span>)</span>
<span id="cb8-32"><a href="#cb8-32"></a>  }</span>
<span id="cb8-33"><a href="#cb8-33"></a>  v_ &lt;-<span class="st"> </span><span class="kw">seq</span>(vmin, c2<span class="op">-</span>dv, <span class="dt">length.out =</span> nv)</span>
<span id="cb8-34"><a href="#cb8-34"></a>  t_ &lt;-<span class="st"> </span><span class="kw">seq</span>(vmin, c2, <span class="dt">length.out =</span> npoints)</span>
<span id="cb8-35"><a href="#cb8-35"></a>  out &lt;-<span class="st"> </span><span class="kw">vector</span>(<span class="st">&quot;list&quot;</span>, <span class="dv">2</span><span class="op">*</span>nv <span class="op">+</span><span class="st"> </span><span class="dv">4</span><span class="op">*</span>nu <span class="op">-</span><span class="st"> </span><span class="dv">2</span>)</span>
<span id="cb8-36"><a href="#cb8-36"></a>  <span class="co">#</span></span>
<span id="cb8-37"><a href="#cb8-37"></a>  <span class="cf">if</span>(b0 <span class="op">!=</span><span class="st"> </span>c0){</span>
<span id="cb8-38"><a href="#cb8-38"></a>    u_ &lt;-<span class="st"> </span><span class="kw">seq</span>(c2<span class="op">+</span>du, b2, <span class="dt">length.out =</span> nu)</span>
<span id="cb8-39"><a href="#cb8-39"></a>    s_ &lt;-<span class="st"> </span><span class="kw">seq</span>(c2, b2, <span class="dt">length.out =</span> npoints)</span>
<span id="cb8-40"><a href="#cb8-40"></a>    mx &lt;-<span class="st"> </span>a0 <span class="op">/</span><span class="st"> </span><span class="kw">sqrt</span>(h2ac<span class="op">*</span>h2ab)</span>
<span id="cb8-41"><a href="#cb8-41"></a>    my &lt;-<span class="st"> </span>b0 <span class="op">/</span><span class="st"> </span><span class="kw">sqrt</span>(h2bc<span class="op">*</span>h2ab)</span>
<span id="cb8-42"><a href="#cb8-42"></a>    mz &lt;-<span class="st"> </span>c0 <span class="op">/</span><span class="st"> </span><span class="kw">sqrt</span>(h2bc<span class="op">*</span>h2ac)</span>
<span id="cb8-43"><a href="#cb8-43"></a>    <span class="cf">for</span>(j <span class="cf">in</span> 1L<span class="op">:</span>nv){</span>
<span id="cb8-44"><a href="#cb8-44"></a>      x &lt;-<span class="st"> </span>mx <span class="op">*</span><span class="st"> </span><span class="kw">sqrt</span>((a2<span class="op">-</span>s_)<span class="op">*</span>(a2<span class="op">-</span>v_[j]))</span>
<span id="cb8-45"><a href="#cb8-45"></a>      y &lt;-<span class="st"> </span>my <span class="op">*</span><span class="st"> </span><span class="kw">sqrt</span>((b2<span class="op">-</span>s_)<span class="op">*</span>(b2<span class="op">-</span>v_[j]))</span>
<span id="cb8-46"><a href="#cb8-46"></a>      z &lt;-<span class="st"> </span>mz <span class="op">*</span><span class="st"> </span><span class="kw">sqrt</span>((s_<span class="op">-</span>c2)<span class="op">*</span>(c2<span class="op">-</span>v_[j]))</span>
<span id="cb8-47"><a href="#cb8-47"></a>      M1 &lt;-<span class="st"> </span><span class="kw">rbind</span>(<span class="kw">cbind</span>(x, y, z), <span class="kw">cbind</span>(x, <span class="op">-</span>y, z)[(npoints<span class="dv">-1</span>)<span class="op">:</span>1L,])</span>
<span id="cb8-48"><a href="#cb8-48"></a>      M2 &lt;-<span class="st"> </span><span class="kw">cbind</span>(M1[,<span class="kw">c</span>(1L,2L)], <span class="op">-</span>M1[,3L])</span>
<span id="cb8-49"><a href="#cb8-49"></a>      M &lt;-<span class="st"> </span><span class="kw">rbind</span>(M1, M2[(<span class="dv">2</span><span class="op">*</span>npoints<span class="dv">-2</span>)<span class="op">:</span>1L,])</span>
<span id="cb8-50"><a href="#cb8-50"></a>      out[[j]] &lt;-<span class="st"> </span><span class="cf">if</span>(exchange) M[,<span class="kw">c</span>(1L,3L,2L)] <span class="cf">else</span> M</span>
<span id="cb8-51"><a href="#cb8-51"></a>      out[[nv<span class="op">+</span>j]] &lt;-<span class="st"> </span></span>
<span id="cb8-52"><a href="#cb8-52"></a><span class="st">        </span><span class="kw">cbind</span>(<span class="op">-</span>M[,1L], <span class="cf">if</span>(exchange) M[,<span class="kw">c</span>(3L,2L)] <span class="cf">else</span> M[,<span class="kw">c</span>(2L,3L)])</span>
<span id="cb8-53"><a href="#cb8-53"></a>    }</span>
<span id="cb8-54"><a href="#cb8-54"></a>    <span class="cf">for</span>(i <span class="cf">in</span> 1L<span class="op">:</span>nu){</span>
<span id="cb8-55"><a href="#cb8-55"></a>      x &lt;-<span class="st"> </span>mx <span class="op">*</span><span class="st"> </span><span class="kw">sqrt</span>((a2<span class="op">-</span>u_[i])<span class="op">*</span>(a2<span class="op">-</span>t_))</span>
<span id="cb8-56"><a href="#cb8-56"></a>      y &lt;-<span class="st"> </span>my <span class="op">*</span><span class="st"> </span><span class="kw">sqrt</span>((b2<span class="op">-</span>u_[i])<span class="op">*</span>(b2<span class="op">-</span>t_))</span>
<span id="cb8-57"><a href="#cb8-57"></a>      z &lt;-<span class="st"> </span>mz <span class="op">*</span><span class="st"> </span><span class="kw">sqrt</span>((u_[i]<span class="op">-</span>c2)<span class="op">*</span>(c2<span class="op">-</span>t_))</span>
<span id="cb8-58"><a href="#cb8-58"></a>      M &lt;-<span class="st"> </span><span class="kw">rbind</span>(<span class="kw">cbind</span>(x, y, z), <span class="kw">cbind</span>(x, y, <span class="op">-</span>z)[(npoints<span class="dv">-1</span>)<span class="op">:</span>1L,])</span>
<span id="cb8-59"><a href="#cb8-59"></a>      out[[<span class="dv">2</span><span class="op">*</span>nv<span class="op">+</span>i]] &lt;-<span class="st"> </span><span class="cf">if</span>(exchange) M[,<span class="kw">c</span>(1L,3L,2L)] <span class="cf">else</span> M</span>
<span id="cb8-60"><a href="#cb8-60"></a>      <span class="cf">if</span>(i <span class="op">&lt;</span><span class="st"> </span>nu){</span>
<span id="cb8-61"><a href="#cb8-61"></a>        out[[<span class="dv">2</span><span class="op">*</span>nv<span class="op">+</span>nu<span class="op">+</span>i]] &lt;-<span class="st"> </span><span class="cf">if</span>(exchange) </span>
<span id="cb8-62"><a href="#cb8-62"></a>          <span class="kw">cbind</span>(M[,<span class="kw">c</span>(1L,3L)], <span class="op">-</span>M[,2L]) </span>
<span id="cb8-63"><a href="#cb8-63"></a>        <span class="cf">else</span> </span>
<span id="cb8-64"><a href="#cb8-64"></a>          <span class="kw">cbind</span>(M[,1L], <span class="op">-</span>M[,2L], M[,3L])</span>
<span id="cb8-65"><a href="#cb8-65"></a>      }</span>
<span id="cb8-66"><a href="#cb8-66"></a>    }</span>
<span id="cb8-67"><a href="#cb8-67"></a>  }<span class="cf">else</span>{ <span class="co"># b0 = c0</span></span>
<span id="cb8-68"><a href="#cb8-68"></a>    u_ &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="dv">0</span>, <span class="dv">2</span><span class="op">*</span>pi, <span class="dt">length.out =</span> nu<span class="op">+</span><span class="dv">1</span>)[<span class="op">-</span>1L] </span>
<span id="cb8-69"><a href="#cb8-69"></a>    s_ &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="dv">0</span>, <span class="dv">2</span><span class="op">*</span>pi, <span class="dt">length.out =</span> npoints)</span>
<span id="cb8-70"><a href="#cb8-70"></a>    mx &lt;-<span class="st"> </span>a0 <span class="op">/</span><span class="st"> </span><span class="kw">sqrt</span>(h2ac)</span>
<span id="cb8-71"><a href="#cb8-71"></a>    myz &lt;-<span class="st"> </span>b0 <span class="op">/</span><span class="st"> </span><span class="kw">sqrt</span>(h2ab)</span>
<span id="cb8-72"><a href="#cb8-72"></a>    <span class="cf">for</span>(j <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>nv){</span>
<span id="cb8-73"><a href="#cb8-73"></a>      x &lt;-<span class="st"> </span>mx <span class="op">*</span><span class="st"> </span><span class="kw">sqrt</span>(a2<span class="op">-</span>v_[j])</span>
<span id="cb8-74"><a href="#cb8-74"></a>      y &lt;-<span class="st"> </span>myz <span class="op">*</span><span class="st"> </span><span class="kw">sqrt</span>(b2<span class="op">-</span>v_[j]) <span class="op">*</span><span class="st"> </span><span class="kw">cos</span>(s_)</span>
<span id="cb8-75"><a href="#cb8-75"></a>      z &lt;-<span class="st"> </span>myz <span class="op">*</span><span class="st"> </span><span class="kw">sqrt</span>(c2<span class="op">-</span>v_[j]) <span class="op">*</span><span class="st"> </span><span class="kw">sin</span>(s_)</span>
<span id="cb8-76"><a href="#cb8-76"></a>      M &lt;-<span class="st"> </span><span class="kw">cbind</span>(x, y, z)</span>
<span id="cb8-77"><a href="#cb8-77"></a>      out[[j]] &lt;-<span class="st"> </span><span class="cf">if</span>(exchange) M[,<span class="kw">c</span>(1L,3L,2L)] <span class="cf">else</span> M</span>
<span id="cb8-78"><a href="#cb8-78"></a>      out[[nv<span class="op">+</span>j]] &lt;-<span class="st"> </span></span>
<span id="cb8-79"><a href="#cb8-79"></a><span class="st">        </span><span class="kw">cbind</span>(<span class="op">-</span>M[,1L], <span class="cf">if</span>(exchange) M[,<span class="kw">c</span>(3L,2L)] <span class="cf">else</span> M[,<span class="kw">c</span>(2L,3L)])</span>
<span id="cb8-80"><a href="#cb8-80"></a>    }</span>
<span id="cb8-81"><a href="#cb8-81"></a>    <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>nu){</span>
<span id="cb8-82"><a href="#cb8-82"></a>      x &lt;-<span class="st"> </span>mx <span class="op">*</span><span class="st"> </span><span class="kw">sqrt</span>(a2<span class="op">-</span>t_)</span>
<span id="cb8-83"><a href="#cb8-83"></a>      y &lt;-<span class="st"> </span>myz <span class="op">*</span><span class="st"> </span><span class="kw">sqrt</span>(b2<span class="op">-</span>t_) <span class="op">*</span><span class="st"> </span><span class="kw">cos</span>(u_[i])</span>
<span id="cb8-84"><a href="#cb8-84"></a>      z &lt;-<span class="st"> </span>myz <span class="op">*</span><span class="st"> </span><span class="kw">sqrt</span>(c2<span class="op">-</span>t_) <span class="op">*</span><span class="st"> </span><span class="kw">sin</span>(u_[i])</span>
<span id="cb8-85"><a href="#cb8-85"></a>      M &lt;-<span class="st"> </span><span class="kw">rbind</span>(<span class="kw">cbind</span>(x, y, z), <span class="kw">cbind</span>(x, <span class="op">-</span>y, <span class="op">-</span>z)[(npoints<span class="dv">-1</span>)<span class="op">:</span>1L,])</span>
<span id="cb8-86"><a href="#cb8-86"></a>      out[[<span class="dv">2</span><span class="op">*</span>nv<span class="op">+</span>i]] &lt;-<span class="st"> </span><span class="cf">if</span>(exchange) M[,<span class="kw">c</span>(1L,3L,2L)] <span class="cf">else</span> M</span>
<span id="cb8-87"><a href="#cb8-87"></a>      <span class="cf">if</span>(i <span class="op">&lt;</span><span class="st"> </span>nu){</span>
<span id="cb8-88"><a href="#cb8-88"></a>        out[[<span class="dv">2</span><span class="op">*</span>nv<span class="op">+</span>nu<span class="op">+</span>i]] &lt;-<span class="st"> </span><span class="cf">if</span>(exchange) </span>
<span id="cb8-89"><a href="#cb8-89"></a>          <span class="kw">cbind</span>(M[,<span class="kw">c</span>(1L,3L)], <span class="op">-</span>M[,2L]) </span>
<span id="cb8-90"><a href="#cb8-90"></a>        <span class="cf">else</span> </span>
<span id="cb8-91"><a href="#cb8-91"></a>          <span class="kw">cbind</span>(M[,1L], <span class="op">-</span>M[,2L], M[,3L])</span>
<span id="cb8-92"><a href="#cb8-92"></a>      }</span>
<span id="cb8-93"><a href="#cb8-93"></a>    }</span>
<span id="cb8-94"><a href="#cb8-94"></a>  }</span>
<span id="cb8-95"><a href="#cb8-95"></a>  <span class="co">#</span></span>
<span id="cb8-96"><a href="#cb8-96"></a>  out[(<span class="dv">2</span><span class="op">*</span>nv<span class="op">+</span><span class="dv">2</span><span class="op">*</span>nu)<span class="op">:</span>(<span class="dv">2</span><span class="op">*</span>nv<span class="op">+</span><span class="dv">4</span><span class="op">*</span>nu<span class="dv">-2</span>)] &lt;-<span class="st"> </span></span>
<span id="cb8-97"><a href="#cb8-97"></a><span class="st">    </span><span class="kw">lapply</span>(out[(<span class="dv">2</span><span class="op">*</span>nv<span class="op">+</span><span class="dv">1</span>)<span class="op">:</span>(<span class="dv">2</span><span class="op">*</span>nv<span class="op">+</span><span class="dv">2</span><span class="op">*</span>nu<span class="dv">-1</span>)], <span class="cf">function</span>(M){</span>
<span id="cb8-98"><a href="#cb8-98"></a>      <span class="kw">cbind</span>(<span class="op">-</span>M[,1L], M[,<span class="kw">c</span>(2L,3L)])</span>
<span id="cb8-99"><a href="#cb8-99"></a>    })</span>
<span id="cb8-100"><a href="#cb8-100"></a>  out</span>
<span id="cb8-101"><a href="#cb8-101"></a>}</span></code></pre></div>
<p>An example:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1"></a>a =<span class="st"> </span><span class="dv">6</span>; b =<span class="st"> </span><span class="dv">5</span>; c =<span class="st"> </span><span class="dv">3</span></span>
<span id="cb9-2"><a href="#cb9-2"></a>sgntr =<span class="st"> &quot;-+-&quot;</span></span>
<span id="cb9-3"><a href="#cb9-3"></a>mesh &lt;-<span class="st"> </span><span class="kw">twoSheetsHyperboloidMesh</span>(a, b, c, sgntr, <span class="dv">100</span>, <span class="dv">100</span>, <span class="dt">vmin =</span> <span class="dv">-500</span>)</span>
<span id="cb9-4"><a href="#cb9-4"></a>clines &lt;-<span class="st"> </span><span class="kw">curvatureLinesH2</span>(a, b, c, sgntr, <span class="dt">nu =</span> <span class="dv">5</span>, <span class="dt">nv =</span> <span class="dv">5</span>, <span class="dt">vmin =</span> <span class="dv">-500</span>, </span>
<span id="cb9-5"><a href="#cb9-5"></a>                           <span class="dt">du =</span> <span class="dv">1</span>, <span class="dt">dv =</span> <span class="dv">20</span>, <span class="dt">npoints =</span> <span class="dv">300</span>)</span>
<span id="cb9-6"><a href="#cb9-6"></a><span class="kw">shade3d</span>(mesh, <span class="dt">color =</span> <span class="st">&quot;navyblue&quot;</span>, <span class="dt">back =</span> <span class="st">&quot;culled&quot;</span>) </span>
<span id="cb9-7"><a href="#cb9-7"></a><span class="kw">shade3d</span>(mesh, <span class="dt">color =</span> <span class="st">&quot;goldenrod&quot;</span>, <span class="dt">front =</span> <span class="st">&quot;culled&quot;</span>)</span>
<span id="cb9-8"><a href="#cb9-8"></a><span class="kw">invisible</span>(<span class="kw">lapply</span>(clines, <span class="cf">function</span>(l){</span>
<span id="cb9-9"><a href="#cb9-9"></a>  <span class="kw">shade3d</span>(<span class="kw">cylinder3d</span>(l, <span class="dt">radius =</span> <span class="fl">0.2</span>, <span class="dt">sides =</span> <span class="dv">30</span>))</span>
<span id="cb9-10"><a href="#cb9-10"></a>}))</span></code></pre></div>
<p><img src="figures/quadrics_H2.png" /></p>
<h1 id="general-quadric">General quadric</h1>
<p>A general quadric in <span class="math inline">\(\mathbb{R}^3\)</span> has equation <span class="math display">\[
(x \quad y \quad z)\, A 
\begin{pmatrix} x \\ y \\ z \end{pmatrix} 
+ J&#39; \begin{pmatrix} x \\ y \\ z \end{pmatrix}
+ K = 0,
\]</span> where <span class="math inline">\(A\)</span> is a symmetric <span class="math inline">\((3\times 3)\)</span>-matrix, <span class="math inline">\(J \in \mathbb{R}^3\)</span>, and <span class="math inline">\(K \in \mathbb{R}\)</span>. Let’s treat an example. We follow the strategy given at page 45 of Brannan &amp; al’s book <em>Geometry</em> (<a href="http://math.haifa.ac.il/ROVENSKI/B2.pdf">pdf</a>).</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1"></a>A =<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">c</span>(</span>
<span id="cb10-2"><a href="#cb10-2"></a>   <span class="dv">5</span>, <span class="dv">-1</span>, <span class="dv">-1</span>, </span>
<span id="cb10-3"><a href="#cb10-3"></a>  <span class="dv">-1</span>,  <span class="dv">3</span>,  <span class="dv">1</span>,</span>
<span id="cb10-4"><a href="#cb10-4"></a>  <span class="dv">-1</span>,  <span class="dv">1</span>, <span class="dv">-3</span></span>
<span id="cb10-5"><a href="#cb10-5"></a>  ), <span class="dt">nrow =</span> 3L, <span class="dt">ncol =</span> 3L)</span>
<span id="cb10-6"><a href="#cb10-6"></a>J =<span class="st"> </span><span class="kw">c</span>(<span class="dv">4</span>, <span class="dv">6</span>, <span class="dv">8</span>)</span>
<span id="cb10-7"><a href="#cb10-7"></a>K =<span class="st"> </span><span class="dv">-10</span></span>
<span id="cb10-8"><a href="#cb10-8"></a><span class="co"># computes spectral decomposition of A</span></span>
<span id="cb10-9"><a href="#cb10-9"></a>eig &lt;-<span class="st"> </span><span class="kw">eigen</span>(A)</span>
<span id="cb10-10"><a href="#cb10-10"></a>P &lt;-<span class="st"> </span>eig<span class="op">$</span>vectors</span>
<span id="cb10-11"><a href="#cb10-11"></a>( evalues &lt;-<span class="st"> </span>eig<span class="op">$</span>values )</span>
<span id="cb10-12"><a href="#cb10-12"></a><span class="co">## [1]  5.614627  2.632676 -3.247303</span></span></code></pre></div>
<p>There is no eigenvalue equal to <span class="math inline">\(0\)</span>; this is the first necessary condition in order for the solution of the equation to be a focal quadric.</p>
<p>Now we write the equation in the form <span class="math display">\[
\lambda_1 {(x&#39;&#39;)}^2 + \lambda_2 {(y&#39;&#39;)}^2 + \lambda_3 {(z&#39;&#39;)}^2 = 
\mathrm{rhs}
\]</span> where <span class="math inline">\(\lambda_1\)</span>, <span class="math inline">\(\lambda_2\)</span>, <span class="math inline">\(\lambda_3\)</span> are the eigenvalues of <span class="math inline">\(A\)</span>, and <span class="math inline">\((x&#39;&#39;,y&#39;&#39;,z&#39;&#39;)\)</span> is a new coordinate system.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1"></a>center &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="kw">t</span>(J) <span class="op">%*%</span><span class="st"> </span>P) <span class="op">/</span><span class="st"> </span>evalues <span class="op">/</span><span class="st"> </span><span class="dv">2</span></span>
<span id="cb11-2"><a href="#cb11-2"></a>( rhs &lt;-<span class="st"> </span><span class="kw">sum</span>(evalues <span class="op">*</span><span class="st"> </span>center<span class="op">^</span><span class="dv">2</span>) <span class="op">-</span><span class="st"> </span>K )</span>
<span id="cb11-3"><a href="#cb11-3"></a><span class="co">## [1] 11.5</span></span></code></pre></div>
<div class="sourceCode" id="cb12"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1"></a>( sgntr &lt;-<span class="st"> </span><span class="kw">paste0</span>(<span class="kw">ifelse</span>(rhs<span class="op">*</span>evalues <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>, <span class="st">&quot;+&quot;</span>, <span class="st">&quot;-&quot;</span>), <span class="dt">collapse =</span> <span class="st">&quot;&quot;</span>) )</span>
<span id="cb12-2"><a href="#cb12-2"></a><span class="co">## [1] &quot;++-&quot;</span></span></code></pre></div>
<p>We find <span class="math inline">\(\mathrm{rhs} \neq 0\)</span>, so the solution of the equation is a focal quadric. If <span class="math inline">\(\mathrm{rhs} = 0\)</span>, the solution is a cone.</p>
<p>The signature is <span class="math inline">\(++-\)</span>, so the solution of the equation is a one-sheeted hyperboloid. By dividing both members of the previous equality by <span class="math inline">\(\mathrm{rhs}\)</span>, we get its equation in standard form.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1"></a>abc &lt;-<span class="st"> </span><span class="kw">sqrt</span>(<span class="kw">abs</span>(rhs<span class="op">/</span>evalues))</span>
<span id="cb13-2"><a href="#cb13-2"></a>a &lt;-<span class="st"> </span>abc[<span class="dv">1</span>]; b &lt;-<span class="st"> </span>abc[<span class="dv">2</span>]; c &lt;-<span class="st"> </span>abc[<span class="dv">3</span>]</span>
<span id="cb13-3"><a href="#cb13-3"></a>mesh0 &lt;-<span class="st"> </span><span class="kw">hyperboloidMesh</span>(a, b, c, sgntr, <span class="dv">100</span>, <span class="dv">100</span>, <span class="dv">-5</span>)</span>
<span id="cb13-4"><a href="#cb13-4"></a><span class="co"># final quadric mesh:</span></span>
<span id="cb13-5"><a href="#cb13-5"></a>mesh &lt;-<span class="st"> </span><span class="kw">rotate3d</span>(</span>
<span id="cb13-6"><a href="#cb13-6"></a>  <span class="kw">translate3d</span>(mesh0, <span class="op">-</span>center[<span class="dv">1</span>], <span class="op">-</span>center[<span class="dv">2</span>], <span class="op">-</span>center[<span class="dv">3</span>]), </span>
<span id="cb13-7"><a href="#cb13-7"></a>  <span class="dt">matrix =</span> <span class="kw">t</span>(P)</span>
<span id="cb13-8"><a href="#cb13-8"></a>)</span></code></pre></div>
<p>We can check that the equation is fulfilled for some vertices of the final mesh:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1"></a><span class="kw">apply</span>(mesh<span class="op">$</span>vb[<span class="op">-</span><span class="dv">4</span>, <span class="dv">1</span><span class="op">:</span><span class="dv">5</span>], 2L, <span class="cf">function</span>(x){</span>
<span id="cb14-2"><a href="#cb14-2"></a>  <span class="kw">c</span>(<span class="kw">t</span>(x) <span class="op">%*%</span><span class="st"> </span>A <span class="op">%*%</span><span class="st"> </span>x <span class="op">+</span><span class="st"> </span><span class="kw">t</span>(J) <span class="op">%*%</span><span class="st"> </span>x) <span class="op">+</span><span class="st"> </span>K</span>
<span id="cb14-3"><a href="#cb14-3"></a>})</span>
<span id="cb14-4"><a href="#cb14-4"></a><span class="co">## [1] 5.684342e-14 7.105427e-14 4.973799e-14 4.973799e-14 4.263256e-14</span></span></code></pre></div>
<p>Up to small numerical errors, we indeed get <span class="math inline">\(0\)</span> for each of the five vertices.</p>

        </div>


        <div id="footer">
          Site proudly generated by
          <a href="http://jaspervdj.be/hakyll">Hakyll</a>
        </div>

      </div>

    </div>

    <div class="row">
      <div class="col-sm-12">
        <div id="disqus_thread"></div>
        <div class="pagination">
          <ul>
            <li>
              <a href="http://laustep.github.io/stlahblog/">&#171; Back Home</a>
            </li>
          </ul>
        </div>
      </div>
    </div>
    
  </div>

</body>

<script src="/libraries/bootstrap/bootstrap.min.js"></script>
<script>
  var disqus_developer = 1;
  var disqus_shortname = 'stlapblog';
  // required: replace example with your forum shortname
  /* * * DON'T EDIT BELOW THIS LINE * * */
  (function () {
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = 'https://' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] ||
      document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>
<noscript>Please enable JavaScript to view the
  <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a>
</noscript>
<!-- MathJax: Fall back to local if CDN offline but local image fonts are not supported (saves >100MB) -->
<script type="text/x-mathjax-config" src="/libraries/mathjax/config/TeX-MML-AM_CHTML.js"></script>
<!-- <script>
  window.MathJax || document.write('<script type="text/x-mathjax-config">MathJax.Hub.Config({"HTML-CSS":{imageFont:null}});<\/script><script src="../libraries/mathjax/MathJax.js"><\/script>');
</script> -->


</html>]]></description>
    <pubDate>Sun, 03 May 2020 00:00:00 UT</pubDate>
    <guid>https://laustep.github.io/stlahblog/posts/focalQuadrics.html</guid>
    <dc:creator>Stéphane Laurent</dc:creator>
    <category>R</category>
</item>


<item>
    <title>Drawing slices of a hypersurface with R</title>
    <link>https://laustep.github.io/stlahblog/posts/slicedHypersurface.html</link>
    <description><![CDATA[<!DOCTYPE HTML>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Saturn Elephant - Drawing slices of a hypersurface with R</title>
  <link href="/libraries/bootstrap/bootstrap-grid.min.css" rel="stylesheet">
  <link rel="stylesheet" href="/css/default2.css" />
  <link rel="stylesheet" href="/css/post.css" />
  <link rel="stylesheet" href="/css/misc.css" /> 
  
    <link rel="stylesheet" href="/css/pandoc-solarized.css" /> 
   
  
  <link href="https://fonts.googleapis.com/css?family=Raleway:400,600,200,800" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/css?family=Droid+Sans" rel="stylesheet" type="text/css">
  <script src="/libraries/jquery.min.js"></script>
  <script type="text/javascript" async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML"></script>
</head>

<body>
  <div class="container-fluid">
    <div class="row">
      <!-- Sidebar. -->
      <div class="sidebar col-sm-2">
        <div class="row">
          <div class="col-sm-12" style="float:right;clear:both;margin-right:50px;margin-top:50px;">
            <a href="https://www.r-bloggers.com/">
              <img src="/images/Rbloggers.png" alt="Rbloggers" width="100%" />
            </a>
            <br/>
            <a href="http://t-redactyl.io/">
              <span style="color:black;font-weight:bold;font-family:sans-serif;font-size:25px;">Standard error</span>
            </a>
            <a href="http://timelyportfolio.blogspot.be/">
              <span style="color:grey;font-weight:bold;font-family:sans-serif;font-size:24px;">Timely portfolio</span>
            </a>
            <br/>
            <a href="https://antoineguillot.wordpress.com/blog/">
              <span style="color:white;background-color:darkblue;font-weight:bold;font-family:sans-serif;font-size:21px;border:5px solid;border-color:darkblue">ENHANCE DATA</span>
            </a>
            <br/>
            <a href="https://fronkonstin.com/">
              <span style="color:black;background-color:gold;font-weight:bold;font-size:29px;border:3px solid;border-color:gold;">Fronkonstin</span>
            </a>
          </div>
        </div>
        <div id="logos">
          <div class="row">
            <div class="col-sm-4">
              <img src="/images/AsymptoteLogo.svg" style="width: 150%; transform: rotateZ(-35deg)"/>
            </div>
            <div class="col-sm-4">
              <img src="/images/Rlogo.svg" style="width: 110%;"/>
            </div>
            <div class="col-sm-4">
              <img src="/images/shiny-hex.png" style="width: 90%;"/>
            </div>
          </div>
          <div class="row">
            <div class="col-sm-4">
              <img src="/images/Povray_logo_sphere.png" style="width: 105%;"/>
            </div>
            <div class="col-sm-4">
              <img src="/images/javascript.svg" style="width: 90%;"/>
            </div>
            <div class="col-sm-4">
              <img src="/images/haskell.svg" style="width: 110%;"/>
            </div>
          </div>
        </div>
      </div>

      <div class="main col-sm-10">
        <div id="header">
          <div id="logo">
            <a href="/">
              <img src="/images/stla.jpg" alt="stla" width="100px" />
            </a>
          </div>
          <div id="navigation" style="margin-top:50px;">
            <a href="/">Home</a>
            <a href="/about.html">About</a>
            <a href="/contact.html">Contact</a>
            <a href="/archive.html">Archive</a>
          </div>
        </div>

        <div class="content">
          <h1>Drawing slices of a hypersurface with R</h1> 
          <div class="info">
    Posted on May  1, 2020
    
        by Stéphane Laurent
    
</div>
<div class="info">
    
    Tags: <a title="All pages tagged &#39;R&#39;." href="/tags/R.html">R</a>, <a title="All pages tagged &#39;graphics&#39;." href="/tags/graphics.html">graphics</a>, <a title="All pages tagged &#39;rgl&#39;." href="/tags/rgl.html">rgl</a>, <a title="All pages tagged &#39;geometry&#39;." href="/tags/geometry.html">geometry</a>, <a title="All pages tagged &#39;maths&#39;." href="/tags/maths.html">maths</a>
    
</div>

<p>Let <span class="math inline">\(s \colon I \times J \times K \to \mathbb{R}^4\)</span> be a parameterization of a hypersurface <span class="math inline">\(\mathcal{S}\)</span>, where <span class="math inline">\(I,J,K \subset \mathbb{R}\)</span> are some intervals. I’m going to show how to draw the cross-section of <span class="math inline">\(\mathcal{S}\)</span> by a hyperplane with R.</p>
<p>For the illustration, we consider the <a href="http://hi.gher.space/wiki/Tiger"><em>tiger</em></a>:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a>R1 =<span class="st"> </span><span class="dv">2</span>; R2 =<span class="st"> </span><span class="dv">2</span>; r =<span class="st"> </span><span class="fl">0.5</span></span>
<span id="cb1-2"><a href="#cb1-2"></a>s &lt;-<span class="st"> </span><span class="cf">function</span>(u, v, w){</span>
<span id="cb1-3"><a href="#cb1-3"></a>  <span class="kw">rbind</span>(</span>
<span id="cb1-4"><a href="#cb1-4"></a>    <span class="kw">cos</span>(u) <span class="op">*</span><span class="st"> </span>(R1 <span class="op">+</span><span class="st"> </span>r<span class="op">*</span><span class="kw">cos</span>(w)),</span>
<span id="cb1-5"><a href="#cb1-5"></a>    <span class="kw">sin</span>(u) <span class="op">*</span><span class="st"> </span>(R1 <span class="op">+</span><span class="st"> </span>r<span class="op">*</span><span class="kw">cos</span>(w)),</span>
<span id="cb1-6"><a href="#cb1-6"></a>    <span class="kw">cos</span>(v) <span class="op">*</span><span class="st"> </span>(R2 <span class="op">+</span><span class="st"> </span>r<span class="op">*</span><span class="kw">sin</span>(w)),</span>
<span id="cb1-7"><a href="#cb1-7"></a>    <span class="kw">sin</span>(v) <span class="op">*</span><span class="st"> </span>(R2 <span class="op">+</span><span class="st"> </span>r<span class="op">*</span><span class="kw">sin</span>(w))</span>
<span id="cb1-8"><a href="#cb1-8"></a>  )</span>
<span id="cb1-9"><a href="#cb1-9"></a>}</span></code></pre></div>
<p>Take a hyperplane: <span class="math display">\[
\mathcal{P}\colon \quad \langle \mathbf{a}, \mathbf{x} \rangle = b,
\]</span> let <span class="math inline">\(\vec{\mathbf{n}} = \frac{\mathbf{a}}{\Vert\mathbf{a}\Vert}\)</span> be a unit normal vector of <span class="math inline">\(\mathcal{P}\)</span>, and <span class="math inline">\(\mathbf{x}_0\)</span> be an arbitrary point in <span class="math inline">\(\mathcal{P}\)</span>.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1"></a>a =<span class="st"> </span><span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>); b =<span class="st"> </span><span class="dv">2</span>        <span class="co"># plane x+y+z+w = 2</span></span>
<span id="cb2-2"><a href="#cb2-2"></a>x0 =<span class="st"> </span><span class="kw">c</span>(b, b, b, b)<span class="op">/</span><span class="dv">4</span>            <span class="co"># a point in this plane</span></span>
<span id="cb2-3"><a href="#cb2-3"></a>nrml &lt;-<span class="st"> </span>a<span class="op">/</span><span class="kw">sqrt</span>(<span class="kw">c</span>(<span class="kw">crossprod</span>(a))) <span class="co"># unit normal</span></span></code></pre></div>
<p>Compute a mesh <span class="math inline">\(\mathcal{M}_0\)</span> of the isosurface <span class="math display">\[
\bigl(s(u,v,w) - \mathbf{x}_0\bigr) \cdot \vec{\mathbf{n}} = 0.
\]</span></p>
<div class="sourceCode" id="cb3"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a><span class="kw">library</span>(misc3d)</span>
<span id="cb3-2"><a href="#cb3-2"></a>f &lt;-<span class="st"> </span><span class="cf">function</span>(u, v, w){</span>
<span id="cb3-3"><a href="#cb3-3"></a>  <span class="kw">c</span>(<span class="kw">crossprod</span>(<span class="kw">s</span>(u, v, w), nrml))</span>
<span id="cb3-4"><a href="#cb3-4"></a>}</span>
<span id="cb3-5"><a href="#cb3-5"></a>u_ &lt;-<span class="st"> </span>v_ &lt;-<span class="st"> </span>w_ &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="dv">0</span>, <span class="dv">2</span><span class="op">*</span>pi, <span class="dt">length.out =</span> 100L)</span>
<span id="cb3-6"><a href="#cb3-6"></a>g &lt;-<span class="st"> </span><span class="kw">expand.grid</span>(<span class="dt">u =</span> u_, <span class="dt">v =</span> v_, <span class="dt">w =</span> w_)</span>
<span id="cb3-7"><a href="#cb3-7"></a>voxel &lt;-<span class="st"> </span><span class="kw">array</span>(<span class="kw">with</span>(g, <span class="kw">f</span>(u,v,w)), <span class="dt">dim =</span> <span class="kw">c</span>(100L,100L,100L))</span>
<span id="cb3-8"><a href="#cb3-8"></a>surf &lt;-<span class="st"> </span><span class="kw">computeContour3d</span>(voxel, <span class="dt">level =</span> <span class="kw">sum</span>(x0<span class="op">*</span>nrml), </span>
<span id="cb3-9"><a href="#cb3-9"></a>                         <span class="dt">x =</span> u_, <span class="dt">y =</span> v_, <span class="dt">z =</span> w_)</span>
<span id="cb3-10"><a href="#cb3-10"></a>trgls &lt;-<span class="st"> </span><span class="kw">makeTriangles</span>(surf)</span>
<span id="cb3-11"><a href="#cb3-11"></a>mesh0 &lt;-<span class="st"> </span>misc3d<span class="op">:::</span><span class="kw">t2ve</span>(trgls)</span></code></pre></div>
<p>Denote by <span class="math inline">\(\mathcal{V}\mathcal{S}_0 \subset I \times J \times K\)</span> the set of vertices of <span class="math inline">\(\mathcal{M}_0\)</span>, and set <span class="math inline">\(\mathcal{V}\mathcal{S} = s(\mathcal{V}\mathcal{S}_0) \subset \mathbb{R}^4\)</span>.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1"></a>VS0 &lt;-<span class="st"> </span>mesh0<span class="op">$</span>vb</span>
<span id="cb4-2"><a href="#cb4-2"></a>VS &lt;-<span class="st"> </span><span class="kw">s</span>(VS0[1L,], VS0[2L,], VS0[3L,]) </span></code></pre></div>
<p>Let <span class="math inline">\(R\)</span> be a rotation in <span class="math inline">\(\mathbb{R}^4\)</span> which sends <span class="math inline">\(\vec{\mathbf{n}} =: \vec{\mathbf{v}}_1\)</span> to the vector <span class="math inline">\((0,0,0,1) =: \vec{\mathbf{v}}_2\)</span>. One can take <span class="math inline">\(R\)</span> corresponding to the matrix <span class="math display">\[
\frac{2}{{(\vec{\mathbf{v}}_1+\vec{\mathbf{v}}_2)}&#39;
(\vec{\mathbf{v}}_1+\vec{\mathbf{v}}_2)}
(\vec{\mathbf{v}}_1+\vec{\mathbf{v}}_2)
{(\vec{\mathbf{v}}_1+\vec{\mathbf{v}}_2)}&#39; - I_4.
\]</span></p>
<div class="sourceCode" id="cb5"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1"></a>rotationMatrix4D &lt;-<span class="st"> </span><span class="cf">function</span>(v1, v2){</span>
<span id="cb5-2"><a href="#cb5-2"></a>  v1 &lt;-<span class="st"> </span>v1 <span class="op">/</span><span class="st"> </span><span class="kw">sqrt</span>(<span class="kw">c</span>(<span class="kw">crossprod</span>(v1)))</span>
<span id="cb5-3"><a href="#cb5-3"></a>  v2 &lt;-<span class="st"> </span>v2 <span class="op">/</span><span class="st"> </span><span class="kw">sqrt</span>(<span class="kw">c</span>(<span class="kw">crossprod</span>(v2)))</span>
<span id="cb5-4"><a href="#cb5-4"></a>  <span class="dv">2</span><span class="op">*</span><span class="kw">tcrossprod</span>(v1<span class="op">+</span>v2)<span class="op">/</span><span class="kw">c</span>(<span class="kw">crossprod</span>(v1<span class="op">+</span>v2)) <span class="op">-</span><span class="st"> </span><span class="kw">diag</span>(4L)</span>
<span id="cb5-5"><a href="#cb5-5"></a>}</span>
<span id="cb5-6"><a href="#cb5-6"></a>Rot &lt;-<span class="st"> </span><span class="kw">rotationMatrix4D</span>(nrml, <span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">1</span>))</span></code></pre></div>
<p>Now define <span class="math inline">\(\mathcal{V}\mathcal{S}&#39; = R(\mathcal{V}\mathcal{S}) \subset \mathbb{R}^4\)</span>. Then all points in <span class="math inline">\(\mathcal{V}\mathcal{S}&#39;\)</span> are equal on their fourth coordinate (up to numerical errors in R):</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1"></a>VSprime &lt;-<span class="st"> </span>Rot <span class="op">%*%</span><span class="st"> </span>VS</span>
<span id="cb6-2"><a href="#cb6-2"></a><span class="kw">head</span>(<span class="kw">t</span>(VSprime))</span>
<span id="cb6-3"><a href="#cb6-3"></a><span class="co">##           [,1]      [,2]      [,3]      [,4]</span></span>
<span id="cb6-4"><a href="#cb6-4"></a><span class="co">## [1,]  2.203740 -1.329658 -1.620365 0.9999785</span></span>
<span id="cb6-5"><a href="#cb6-5"></a><span class="co">## [2,] -1.324840  2.206491 -1.657871 1.0002417</span></span>
<span id="cb6-6"><a href="#cb6-6"></a><span class="co">## [3,] -1.320131  2.212244 -1.636339 0.9999972</span></span>
<span id="cb6-7"><a href="#cb6-7"></a><span class="co">## [4,] -1.417790  2.116178 -1.698381 0.9999926</span></span>
<span id="cb6-8"><a href="#cb6-8"></a><span class="co">## [5,]  2.219859 -1.310784 -1.651340 0.9999841</span></span>
<span id="cb6-9"><a href="#cb6-9"></a><span class="co">## [6,]  2.253515 -1.275147 -1.633245 1.0005005</span></span></code></pre></div>
<p>Finally, define <span class="math inline">\(\mathcal{V}\mathcal{S}&#39;&#39; \subset \mathbb{R}^3\)</span> as the set obtained by removing the fourth coordinates of the elements of <span class="math inline">\(\mathcal{V}\mathcal{S}&#39;\)</span>, and define the mesh <span class="math inline">\(\mathcal{M}\)</span> whose set of vertices is <span class="math inline">\(\mathcal{V}\mathcal{S}&#39;&#39;\)</span> and with the same edges as <span class="math inline">\(\mathcal{M}_0\)</span>:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1"></a><span class="kw">library</span>(rgl)</span>
<span id="cb7-2"><a href="#cb7-2"></a>mesh &lt;-<span class="st"> </span><span class="kw">tmesh3d</span>(</span>
<span id="cb7-3"><a href="#cb7-3"></a>  <span class="dt">vertices =</span> VSprime[<span class="op">-</span>4L,],</span>
<span id="cb7-4"><a href="#cb7-4"></a>  <span class="dt">indices =</span> mesh0<span class="op">$</span>ib,</span>
<span id="cb7-5"><a href="#cb7-5"></a>  <span class="dt">homogeneous =</span> <span class="ot">FALSE</span>,</span>
<span id="cb7-6"><a href="#cb7-6"></a>  <span class="dt">normals =</span> ?</span>
<span id="cb7-7"><a href="#cb7-7"></a>)</span></code></pre></div>
<p>What about the normals? If you have an implicit equation defining <span class="math inline">\(\mathcal{S}\)</span>, that is, <span class="math inline">\(\mathcal{S} = \iota^{-1}(0)\)</span> with <span class="math inline">\(\iota\colon \mathbb{R}^4 \to \mathbb{R}\)</span>, then a normal to <span class="math inline">\(\mathcal{S}\)</span> at a point <span class="math inline">\(\mathbf{x} \in \mathbb{R}^4\)</span> is given by the gradient of <span class="math inline">\(\iota\)</span> at <span class="math inline">\(\mathbf{x}\)</span>. For the tiger, we know an implicit equation, and it is not difficult to get the gradient:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1"></a>sNormal &lt;-<span class="st"> </span><span class="cf">function</span>(XYZT){</span>
<span id="cb8-2"><a href="#cb8-2"></a>  x &lt;-<span class="st"> </span>XYZT[1L,]; y &lt;-<span class="st"> </span>XYZT[2L,]; z &lt;-<span class="st"> </span>XYZT[3L,]; t &lt;-<span class="st"> </span>XYZT[4L,]</span>
<span id="cb8-3"><a href="#cb8-3"></a>  <span class="kw">rbind</span>(</span>
<span id="cb8-4"><a href="#cb8-4"></a>    x <span class="op">*</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">-</span><span class="st"> </span>R1<span class="op">/</span><span class="kw">sqrt</span>(x<span class="op">^</span><span class="dv">2</span><span class="op">+</span>y<span class="op">^</span><span class="dv">2</span>)),</span>
<span id="cb8-5"><a href="#cb8-5"></a>    y <span class="op">*</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">-</span><span class="st"> </span>R1<span class="op">/</span><span class="kw">sqrt</span>(x<span class="op">^</span><span class="dv">2</span><span class="op">+</span>y<span class="op">^</span><span class="dv">2</span>)),</span>
<span id="cb8-6"><a href="#cb8-6"></a>    z <span class="op">*</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">-</span><span class="st"> </span>R2<span class="op">/</span><span class="kw">sqrt</span>(z<span class="op">^</span><span class="dv">2</span><span class="op">+</span>t<span class="op">^</span><span class="dv">2</span>)),</span>
<span id="cb8-7"><a href="#cb8-7"></a>    t <span class="op">*</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">-</span><span class="st"> </span>R2<span class="op">/</span><span class="kw">sqrt</span>(z<span class="op">^</span><span class="dv">2</span><span class="op">+</span>t<span class="op">^</span><span class="dv">2</span>))</span>
<span id="cb8-8"><a href="#cb8-8"></a>  )</span>
<span id="cb8-9"><a href="#cb8-9"></a>}</span>
<span id="cb8-10"><a href="#cb8-10"></a>Normals &lt;-<span class="st"> </span><span class="kw">sNormal</span>(VS)</span></code></pre></div>
<p>Once you get the normals:</p>
<ul>
<li><p>project them to the hyperplane <span class="math inline">\(\mathcal{P}\)</span>;</p></li>
<li><p>apply the rotation <span class="math inline">\(R\)</span> to the projected normals;</p></li>
<li><p>remove the fourth coordinates (all equal);</p></li>
<li><p>if necessary, negate the normals.</p></li>
</ul>
<p>The projection of <span class="math inline">\(\mathbf{x} \in \mathbb{R}^4\)</span> to the hyperplane <span class="math inline">\(\mathcal{P}\)</span> is given by <span class="math display">\[
\mathbf{x} - 
\frac{\langle \mathbf{a}, \mathbf{x} \rangle - b}{\Vert \mathbf{a} \Vert^2} 
\mathbf{a}.
\]</span></p>
<div class="sourceCode" id="cb9"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1"></a><span class="co"># projection onto hyperplane &lt;a,x&gt; = b</span></span>
<span id="cb9-2"><a href="#cb9-2"></a>projection &lt;-<span class="st"> </span><span class="cf">function</span>(a, b, X){</span>
<span id="cb9-3"><a href="#cb9-3"></a>  X <span class="op">-</span><span class="st"> </span><span class="kw">tcrossprod</span>(a<span class="op">/</span><span class="kw">c</span>(<span class="kw">crossprod</span>(a)), <span class="kw">colSums</span>(a<span class="op">*</span>X)<span class="op">-</span>b)</span>
<span id="cb9-4"><a href="#cb9-4"></a>}</span>
<span id="cb9-5"><a href="#cb9-5"></a>mesh &lt;-<span class="st"> </span><span class="kw">tmesh3d</span>(</span>
<span id="cb9-6"><a href="#cb9-6"></a>  <span class="dt">vertices =</span> VSprime[<span class="op">-</span>4L,], </span>
<span id="cb9-7"><a href="#cb9-7"></a>  <span class="dt">indices =</span> mesh0<span class="op">$</span>ib, </span>
<span id="cb9-8"><a href="#cb9-8"></a>  <span class="dt">homogeneous =</span> <span class="ot">FALSE</span>,</span>
<span id="cb9-9"><a href="#cb9-9"></a>  <span class="dt">normals =</span> <span class="op">-</span><span class="kw">t</span>((Rot <span class="op">%*%</span><span class="st"> </span><span class="kw">projection</span>(a, b, Normals))[<span class="op">-</span>4L,])</span>
<span id="cb9-10"><a href="#cb9-10"></a>)</span></code></pre></div>
<p>This works:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true"></a><span class="kw">shade3d</span>(mesh, <span class="dt">color =</span> <span class="st">&quot;darkmagenta&quot;</span>)</span></code></pre></div>
<p><img src="figures/tiger1.png" /></p>
<p>Here is another way to get the normals. The normal at the point <span class="math inline">\(s(u,v,w)\)</span> is <span class="math display">\[
\frac{\partial s}{\partial u}(u,v,w) \times
\frac{\partial s}{\partial v}(u,v,w) \times
\frac{\partial s}{\partial w}(u,v,w) 
\]</span> where <span class="math inline">\(\cdot \times \cdot \times \cdot\)</span> is the <em>ternary cross-product</em> in <span class="math inline">\(\mathbb{R}^4\)</span>, defined by <span class="math display">\[
\vec v_1 \times \vec v_2 \times \vec v_3 = 
\left\vert\begin{matrix}
\vec i &amp; \vec j &amp; \vec k &amp; \vec l \\ 
v_{1x} &amp; v_{1y} &amp; v_{1z} &amp; v_{1t} \\ 
v_{2x} &amp; v_{2y} &amp; v_{2z} &amp; v_{2t} \\ 
v_{3x} &amp; v_{3y} &amp; v_{3z} &amp; v_{3t} 
\end{matrix}\right\vert.
\]</span></p>
<div class="sourceCode" id="cb11"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1"></a>crossProd4D &lt;-<span class="st"> </span><span class="cf">function</span>(v1, v2, v3){</span>
<span id="cb11-2"><a href="#cb11-2"></a>  M &lt;-<span class="st"> </span><span class="kw">rbind</span>(v1, v2, v3)</span>
<span id="cb11-3"><a href="#cb11-3"></a>  <span class="kw">c</span>(<span class="kw">det</span>(M[,<span class="op">-</span>1L]), <span class="op">-</span><span class="kw">det</span>(M[,<span class="op">-</span>2L]), <span class="kw">det</span>(M[,<span class="op">-</span>3L]), <span class="op">-</span><span class="kw">det</span>(M[,<span class="op">-</span>4L]))</span>
<span id="cb11-4"><a href="#cb11-4"></a>}</span>
<span id="cb11-5"><a href="#cb11-5"></a>sNormal &lt;-<span class="st"> </span><span class="cf">function</span>(uvw){</span>
<span id="cb11-6"><a href="#cb11-6"></a>  u &lt;-<span class="st"> </span>uvw[1L]; v &lt;-<span class="st"> </span>uvw[2L]; w &lt;-<span class="st"> </span>uvw[3L]</span>
<span id="cb11-7"><a href="#cb11-7"></a>  Du &lt;-<span class="st"> </span><span class="kw">c</span>((R1 <span class="op">+</span><span class="st"> </span>r<span class="op">*</span><span class="kw">cos</span>(w))<span class="op">*</span><span class="kw">c</span>(<span class="op">-</span><span class="kw">sin</span>(u),<span class="kw">cos</span>(u)), <span class="dv">0</span>, <span class="dv">0</span>)</span>
<span id="cb11-8"><a href="#cb11-8"></a>  Dv &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, (R2 <span class="op">+</span><span class="st"> </span>r<span class="op">*</span><span class="kw">sin</span>(w))<span class="op">*</span><span class="kw">c</span>(<span class="op">-</span><span class="kw">sin</span>(v),<span class="kw">cos</span>(v)))</span>
<span id="cb11-9"><a href="#cb11-9"></a>  Dw &lt;-<span class="st"> </span>r <span class="op">*</span><span class="st"> </span><span class="kw">c</span>(<span class="op">-</span><span class="kw">sin</span>(w)<span class="op">*</span><span class="kw">c</span>(<span class="kw">cos</span>(u),<span class="kw">sin</span>(u)), <span class="kw">cos</span>(w)<span class="op">*</span><span class="kw">c</span>(<span class="kw">cos</span>(v),<span class="kw">sin</span>(v)))</span>
<span id="cb11-10"><a href="#cb11-10"></a>  <span class="kw">crossProd4D</span>(Du, Dv, Dw)</span>
<span id="cb11-11"><a href="#cb11-11"></a>}</span>
<span id="cb11-12"><a href="#cb11-12"></a>Normals &lt;-<span class="st"> </span><span class="kw">apply</span>(VS0, 2L, sNormal)</span></code></pre></div>
<p>Then you can calculate the normals in this way and proceed as before:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1"></a>mesh &lt;-<span class="st"> </span><span class="kw">tmesh3d</span>(</span>
<span id="cb12-2"><a href="#cb12-2"></a>  <span class="dt">vertices =</span> VSprime[<span class="op">-</span>4L,], </span>
<span id="cb12-3"><a href="#cb12-3"></a>  <span class="dt">indices =</span> mesh0<span class="op">$</span>ib, </span>
<span id="cb12-4"><a href="#cb12-4"></a>  <span class="dt">homogeneous =</span> <span class="ot">FALSE</span>,</span>
<span id="cb12-5"><a href="#cb12-5"></a>  <span class="dt">normals =</span> <span class="kw">t</span>((Rot <span class="op">%*%</span><span class="st"> </span><span class="kw">projection</span>(a, b, Normals))[<span class="op">-</span>4L,])</span>
<span id="cb12-6"><a href="#cb12-6"></a>)</span></code></pre></div>
<p>Here is how to do an animation:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1"></a>b_ &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="op">-</span><span class="fl">11.5</span>, <span class="fl">11.5</span>, <span class="dt">length.out =</span> 60L)</span>
<span id="cb13-2"><a href="#cb13-2"></a><span class="kw">open3d</span>(<span class="dt">windowRect =</span> <span class="kw">c</span>(<span class="dv">100</span>, <span class="dv">100</span>, <span class="dv">612</span>, <span class="dv">612</span>), <span class="dt">zoom =</span> <span class="fl">0.8</span>)</span>
<span id="cb13-3"><a href="#cb13-3"></a><span class="kw">bg3d</span>(<span class="kw">rgb</span>(<span class="dv">54</span>, <span class="dv">57</span>, <span class="dv">64</span>, <span class="dt">maxColorValue =</span> <span class="dv">255</span>))</span>
<span id="cb13-4"><a href="#cb13-4"></a><span class="kw">view3d</span>(<span class="dv">45</span>, <span class="dv">40</span>)</span>
<span id="cb13-5"><a href="#cb13-5"></a><span class="cf">for</span>(i <span class="cf">in</span> 1L<span class="op">:</span><span class="kw">length</span>(b_)){</span>
<span id="cb13-6"><a href="#cb13-6"></a>  x0 &lt;-<span class="st"> </span><span class="kw">rep</span>(b_[i]<span class="op">/</span><span class="dv">4</span>, 4L) </span>
<span id="cb13-7"><a href="#cb13-7"></a>  surf &lt;-<span class="st"> </span><span class="kw">computeContour3d</span>(voxel, <span class="dt">level =</span> <span class="kw">sum</span>(x0<span class="op">*</span>nrml), </span>
<span id="cb13-8"><a href="#cb13-8"></a>                           <span class="dt">x =</span> u_, <span class="dt">y =</span> v_, <span class="dt">z =</span> w_)</span>
<span id="cb13-9"><a href="#cb13-9"></a>  trgls &lt;-<span class="st"> </span><span class="kw">makeTriangles</span>(surf)</span>
<span id="cb13-10"><a href="#cb13-10"></a>  mesh0 &lt;-<span class="st"> </span>misc3d<span class="op">:::</span><span class="kw">t2ve</span>(trgls)</span>
<span id="cb13-11"><a href="#cb13-11"></a>  VS0 &lt;-<span class="st"> </span>mesh0<span class="op">$</span>vb</span>
<span id="cb13-12"><a href="#cb13-12"></a>  VS &lt;-<span class="st"> </span><span class="kw">s</span>(VS0[1L,], VS0[2L,], VS0[3L,])</span>
<span id="cb13-13"><a href="#cb13-13"></a>  Normals &lt;-<span class="st"> </span><span class="kw">sNormal</span>(VS)</span>
<span id="cb13-14"><a href="#cb13-14"></a>  mesh &lt;-<span class="st"> </span><span class="kw">tmesh3d</span>(</span>
<span id="cb13-15"><a href="#cb13-15"></a>    <span class="dt">vertices =</span> (Rot <span class="op">%*%</span><span class="st"> </span>VS)[<span class="op">-</span>4L,], </span>
<span id="cb13-16"><a href="#cb13-16"></a>    <span class="dt">indices =</span> mesh0<span class="op">$</span>ib, </span>
<span id="cb13-17"><a href="#cb13-17"></a>    <span class="dt">homogeneous =</span> <span class="ot">FALSE</span>,</span>
<span id="cb13-18"><a href="#cb13-18"></a>    <span class="dt">normals =</span> <span class="op">-</span><span class="kw">t</span>((Rot <span class="op">%*%</span><span class="st"> </span><span class="kw">projection</span>(a, b_[i], Normals))[<span class="op">-</span>4L,])</span>
<span id="cb13-19"><a href="#cb13-19"></a>  )</span>
<span id="cb13-20"><a href="#cb13-20"></a>  <span class="kw">shade3d</span>(mesh, <span class="dt">color =</span> <span class="st">&quot;firebrick3&quot;</span>)</span>
<span id="cb13-21"><a href="#cb13-21"></a>  <span class="kw">snapshot3d</span>(<span class="kw">sprintf</span>(<span class="st">&quot;pic%03d.png&quot;</span>, i))</span>
<span id="cb13-22"><a href="#cb13-22"></a>  <span class="kw">clear3d</span>()</span>
<span id="cb13-23"><a href="#cb13-23"></a>}</span>
<span id="cb13-24"><a href="#cb13-24"></a><span class="cf">for</span>(i <span class="cf">in</span> 1L<span class="op">:</span>59L){</span>
<span id="cb13-25"><a href="#cb13-25"></a>  <span class="kw">file.copy</span>(<span class="kw">sprintf</span>(<span class="st">&quot;pic%03d.png&quot;</span>, <span class="dv">60</span><span class="op">-</span>i), <span class="kw">sprintf</span>(<span class="st">&quot;pic%03d.png&quot;</span>, <span class="dv">60</span><span class="op">+</span>i))</span>
<span id="cb13-26"><a href="#cb13-26"></a>}</span>
<span id="cb13-27"><a href="#cb13-27"></a><span class="co"># run gifski</span></span>
<span id="cb13-28"><a href="#cb13-28"></a>command &lt;-<span class="st"> &quot;gifski --fps 12 pic*.png -o slicedTiger.gif&quot;</span></span>
<span id="cb13-29"><a href="#cb13-29"></a><span class="kw">system</span>(command)</span>
<span id="cb13-30"><a href="#cb13-30"></a><span class="co"># cleaning</span></span>
<span id="cb13-31"><a href="#cb13-31"></a>pngfiles &lt;-<span class="st"> </span><span class="kw">list.files</span>(<span class="dt">pattern =</span> <span class="st">&quot;^pic.*png$&quot;</span>)</span>
<span id="cb13-32"><a href="#cb13-32"></a><span class="kw">file.remove</span>(pngfiles)</span></code></pre></div>
<p><img src="figures/tiger2.gif" /></p>
<h2 id="toroidal-hyperboloid">Toroidal hyperboloid</h2>
<p>Let’s give another example, a <em>toroidal hyperboloid</em>. This is a quadric with implicit equation <span class="math display">\[
\frac{x^2}{a^2} + \frac{y^2}{b^2} - \frac{z^2}{c^2} - \frac{t^2}{d^2} = 1,
\]</span> and a parameterization of this quadric is <span class="math display">\[
\begin{array}{ccc}
s \colon &amp; (0,2\pi) \times (0,2\pi) \times (0, +\infty[ &amp; 
\longrightarrow &amp; \mathbb{R}^4 \\
 &amp; (u,v,w) &amp; \longmapsto &amp; 
\begin{pmatrix}
a \cos u \cosh w \\ 
b \sin u \cosh w \\
c \cos v \sinh w \\
d \sin v \sinh w 
\end{pmatrix}
\end{array}.
\]</span></p>
<p><img src="figures/toroidalHyperboloid.gif" /></p>

        </div>


        <div id="footer">
          Site proudly generated by
          <a href="http://jaspervdj.be/hakyll">Hakyll</a>
        </div>

      </div>

    </div>

    <div class="row">
      <div class="col-sm-12">
        <div id="disqus_thread"></div>
        <div class="pagination">
          <ul>
            <li>
              <a href="http://laustep.github.io/stlahblog/">&#171; Back Home</a>
            </li>
          </ul>
        </div>
      </div>
    </div>
    
  </div>

</body>

<script src="/libraries/bootstrap/bootstrap.min.js"></script>
<script>
  var disqus_developer = 1;
  var disqus_shortname = 'stlapblog';
  // required: replace example with your forum shortname
  /* * * DON'T EDIT BELOW THIS LINE * * */
  (function () {
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = 'https://' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] ||
      document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>
<noscript>Please enable JavaScript to view the
  <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a>
</noscript>
<!-- MathJax: Fall back to local if CDN offline but local image fonts are not supported (saves >100MB) -->
<script type="text/x-mathjax-config" src="/libraries/mathjax/config/TeX-MML-AM_CHTML.js"></script>
<!-- <script>
  window.MathJax || document.write('<script type="text/x-mathjax-config">MathJax.Hub.Config({"HTML-CSS":{imageFont:null}});<\/script><script src="../libraries/mathjax/MathJax.js"><\/script>');
</script> -->


</html>]]></description>
    <pubDate>Fri, 01 May 2020 00:00:00 UT</pubDate>
    <guid>https://laustep.github.io/stlahblog/posts/slicedHypersurface.html</guid>
    <dc:creator>Stéphane Laurent</dc:creator>
    <category>R</category>
</item>


<item>
    <title>Back to the parametric Hopf torus</title>
    <link>https://laustep.github.io/stlahblog/posts/HopfTorus2.html</link>
    <description><![CDATA[<!DOCTYPE HTML>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Saturn Elephant - Back to the parametric Hopf torus</title>
  <link href="/libraries/bootstrap/bootstrap-grid.min.css" rel="stylesheet">
  <link rel="stylesheet" href="/css/default2.css" />
  <link rel="stylesheet" href="/css/post.css" />
  <link rel="stylesheet" href="/css/misc.css" /> 
  
    <link rel="stylesheet" href="/css/pandoc-solarized.css" /> 
   
  
  <link href="https://fonts.googleapis.com/css?family=Raleway:400,600,200,800" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/css?family=Droid+Sans" rel="stylesheet" type="text/css">
  <script src="/libraries/jquery.min.js"></script>
  <script type="text/javascript" async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML"></script>
</head>

<body>
  <div class="container-fluid">
    <div class="row">
      <!-- Sidebar. -->
      <div class="sidebar col-sm-2">
        <div class="row">
          <div class="col-sm-12" style="float:right;clear:both;margin-right:50px;margin-top:50px;">
            <a href="https://www.r-bloggers.com/">
              <img src="/images/Rbloggers.png" alt="Rbloggers" width="100%" />
            </a>
            <br/>
            <a href="http://t-redactyl.io/">
              <span style="color:black;font-weight:bold;font-family:sans-serif;font-size:25px;">Standard error</span>
            </a>
            <a href="http://timelyportfolio.blogspot.be/">
              <span style="color:grey;font-weight:bold;font-family:sans-serif;font-size:24px;">Timely portfolio</span>
            </a>
            <br/>
            <a href="https://antoineguillot.wordpress.com/blog/">
              <span style="color:white;background-color:darkblue;font-weight:bold;font-family:sans-serif;font-size:21px;border:5px solid;border-color:darkblue">ENHANCE DATA</span>
            </a>
            <br/>
            <a href="https://fronkonstin.com/">
              <span style="color:black;background-color:gold;font-weight:bold;font-size:29px;border:3px solid;border-color:gold;">Fronkonstin</span>
            </a>
          </div>
        </div>
        <div id="logos">
          <div class="row">
            <div class="col-sm-4">
              <img src="/images/AsymptoteLogo.svg" style="width: 150%; transform: rotateZ(-35deg)"/>
            </div>
            <div class="col-sm-4">
              <img src="/images/Rlogo.svg" style="width: 110%;"/>
            </div>
            <div class="col-sm-4">
              <img src="/images/shiny-hex.png" style="width: 90%;"/>
            </div>
          </div>
          <div class="row">
            <div class="col-sm-4">
              <img src="/images/Povray_logo_sphere.png" style="width: 105%;"/>
            </div>
            <div class="col-sm-4">
              <img src="/images/javascript.svg" style="width: 90%;"/>
            </div>
            <div class="col-sm-4">
              <img src="/images/haskell.svg" style="width: 110%;"/>
            </div>
          </div>
        </div>
      </div>

      <div class="main col-sm-10">
        <div id="header">
          <div id="logo">
            <a href="/">
              <img src="/images/stla.jpg" alt="stla" width="100px" />
            </a>
          </div>
          <div id="navigation" style="margin-top:50px;">
            <a href="/">Home</a>
            <a href="/about.html">About</a>
            <a href="/contact.html">Contact</a>
            <a href="/archive.html">Archive</a>
          </div>
        </div>

        <div class="content">
          <h1>Back to the parametric Hopf torus</h1> 
          <div class="info">
    Posted on April 12, 2020
    
        by Stéphane Laurent
    
</div>
<div class="info">
    
    Tags: <a title="All pages tagged &#39;R&#39;." href="/tags/R.html">R</a>, <a title="All pages tagged &#39;graphics&#39;." href="/tags/graphics.html">graphics</a>, <a title="All pages tagged &#39;rgl&#39;." href="/tags/rgl.html">rgl</a>, <a title="All pages tagged &#39;geometry&#39;." href="/tags/geometry.html">geometry</a>, <a title="All pages tagged &#39;maths&#39;." href="/tags/maths.html">maths</a>
    
</div>

<p>In a <a href="./HopfTorusParametric.html">previous post</a>, I explained how to get a parameterization of a Hopf cylinder or torus. There is a clearer way, which I present here.</p>
<p>For the Hopf map, the preimage of a point <span class="math inline">\(p=(p_x,p_y,p_z)\)</span> on the unit sphere <span class="math inline">\(S^2\)</span> is the circle on <span class="math inline">\(S^3\)</span> with parametrization: <span class="math display">\[
\begin{array}{ccc}
\mathcal{C}_p \colon &amp; (0,2\pi[ &amp; \longrightarrow &amp; S^3 \\
 &amp; \phi &amp; \longmapsto &amp; \mathcal{C}_p(\phi) 
\end{array}
\]</span> where <span class="math display">\[
\mathcal{C}_p(\phi) = 
\frac{1}{\sqrt{2(1+p_z)}}
\begin{pmatrix}
(1+p_z) \cos(\phi) \\
p_x \sin(\phi) - p_y \cos(\phi) \\
p_x \cos(\phi) + p_y \sin(\phi) \\
(1+p_z) \sin(\phi)
\end{pmatrix}.
\]</span></p>
<p>Now consider a spherical curve. That is, let <span class="math inline">\(\Gamma\)</span> be a function mapping an interval <span class="math inline">\(I \subset \mathbb{R}\)</span> to the unit sphere <span class="math inline">\(S^2\)</span>. Then the Hopf cylinder corresponding to <span class="math inline">\(\Gamma\)</span> has parameterization <span class="math display">\[
\begin{array}{ccc}
H_\Gamma \colon &amp; I \times (0,2\pi[ &amp; \longrightarrow &amp; S^3 \\
 &amp; (t, \phi) &amp; \longmapsto &amp; \mathcal{C}_{\Gamma(t)}(\phi) 
\end{array}.
\]</span> Recall the <a href="./HopfTorusTennisBall.html">tennis ball curve</a> example, given for a real constant <span class="math inline">\(A\)</span> and an integer constant <span class="math inline">\(n\)</span> by: <span class="math display">\[
\Gamma(t) = 
\begin{pmatrix}
\sin\bigl(\pi/2 - (\pi/2 - A) \cos(nt)\bigr) 
\cos\bigl(t + A \sin(2nt)\bigr) \\ 
\sin\bigl(\pi/2 - (\pi/2 - A) \cos(nt)\bigr) 
\sin\bigl(t + A \sin(2nt)\bigr) \\ 
\cos\bigl(\pi/2 - (\pi/2 - A) \cos(nt)\bigr)
\end{pmatrix}, \quad t \in (0,2\pi[.
\]</span></p>
<div class="sourceCode" id="cb1"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a>A &lt;-<span class="st"> </span><span class="fl">0.44</span></span>
<span id="cb1-2"><a href="#cb1-2"></a>n &lt;-<span class="st"> </span><span class="dv">3</span></span>
<span id="cb1-3"><a href="#cb1-3"></a>Gamma &lt;-<span class="st"> </span><span class="cf">function</span>(t){</span>
<span id="cb1-4"><a href="#cb1-4"></a>  alpha &lt;-<span class="st"> </span>pi<span class="op">/</span><span class="dv">2</span> <span class="op">-</span><span class="st"> </span>(pi<span class="op">/</span><span class="dv">2</span><span class="op">-</span>A)<span class="op">*</span><span class="kw">cos</span>(n<span class="op">*</span>t)</span>
<span id="cb1-5"><a href="#cb1-5"></a>  beta &lt;-<span class="st"> </span>t <span class="op">+</span><span class="st"> </span>A<span class="op">*</span><span class="kw">sin</span>(<span class="dv">2</span><span class="op">*</span>n<span class="op">*</span>t)</span>
<span id="cb1-6"><a href="#cb1-6"></a>  <span class="kw">c</span>(</span>
<span id="cb1-7"><a href="#cb1-7"></a>    <span class="kw">sin</span>(alpha) <span class="op">*</span><span class="st"> </span><span class="kw">cos</span>(beta),</span>
<span id="cb1-8"><a href="#cb1-8"></a>    <span class="kw">sin</span>(alpha) <span class="op">*</span><span class="st"> </span><span class="kw">sin</span>(beta),</span>
<span id="cb1-9"><a href="#cb1-9"></a>    <span class="kw">cos</span>(alpha)</span>
<span id="cb1-10"><a href="#cb1-10"></a>  )</span>
<span id="cb1-11"><a href="#cb1-11"></a>}</span>
<span id="cb1-12"><a href="#cb1-12"></a>HopfInverse &lt;-<span class="st"> </span><span class="cf">function</span>(p, phi){</span>
<span id="cb1-13"><a href="#cb1-13"></a>  <span class="kw">c</span>(</span>
<span id="cb1-14"><a href="#cb1-14"></a>    (<span class="dv">1</span><span class="op">+</span>p[<span class="dv">3</span>])<span class="op">*</span><span class="kw">cos</span>(phi),</span>
<span id="cb1-15"><a href="#cb1-15"></a>    p[<span class="dv">1</span>]<span class="op">*</span><span class="kw">sin</span>(phi) <span class="op">-</span><span class="st"> </span>p[<span class="dv">2</span>]<span class="op">*</span><span class="kw">cos</span>(phi), </span>
<span id="cb1-16"><a href="#cb1-16"></a>    p[<span class="dv">1</span>]<span class="op">*</span><span class="kw">cos</span>(phi) <span class="op">+</span><span class="st"> </span>p[<span class="dv">2</span>]<span class="op">*</span><span class="kw">sin</span>(phi),</span>
<span id="cb1-17"><a href="#cb1-17"></a>    (<span class="dv">1</span><span class="op">+</span>p[<span class="dv">3</span>])<span class="op">*</span><span class="kw">sin</span>(phi)</span>
<span id="cb1-18"><a href="#cb1-18"></a>  ) <span class="op">/</span><span class="st"> </span><span class="kw">sqrt</span>(<span class="dv">2</span><span class="op">*</span>(<span class="dv">1</span><span class="op">+</span>p[<span class="dv">3</span>])) </span>
<span id="cb1-19"><a href="#cb1-19"></a>}</span>
<span id="cb1-20"><a href="#cb1-20"></a>Stereo &lt;-<span class="st"> </span><span class="cf">function</span>(q){</span>
<span id="cb1-21"><a href="#cb1-21"></a>  <span class="dv">2</span><span class="op">*</span>q[<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>] <span class="op">/</span><span class="st"> </span>(<span class="dv">1</span><span class="op">-</span>q[<span class="dv">4</span>])</span>
<span id="cb1-22"><a href="#cb1-22"></a>}</span>
<span id="cb1-23"><a href="#cb1-23"></a>F &lt;-<span class="st"> </span><span class="cf">function</span>(t, phi){</span>
<span id="cb1-24"><a href="#cb1-24"></a>  <span class="kw">Stereo</span>(<span class="kw">HopfInverse</span>(<span class="kw">Gamma</span>(t), phi))</span>
<span id="cb1-25"><a href="#cb1-25"></a>}</span></code></pre></div>
<p>Now we’re ready to plot the stereographic projection of the Hopf torus with <code>misc3d</code>:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1"></a>fx &lt;-<span class="st"> </span><span class="kw">Vectorize</span>(<span class="cf">function</span>(u,v) <span class="kw">F</span>(u,v)[<span class="dv">1</span>])</span>
<span id="cb2-2"><a href="#cb2-2"></a>fy &lt;-<span class="st"> </span><span class="kw">Vectorize</span>(<span class="cf">function</span>(u,v) <span class="kw">F</span>(u,v)[<span class="dv">2</span>])</span>
<span id="cb2-3"><a href="#cb2-3"></a>fz &lt;-<span class="st"> </span><span class="kw">Vectorize</span>(<span class="cf">function</span>(u,v) <span class="kw">F</span>(u,v)[<span class="dv">3</span>])</span>
<span id="cb2-4"><a href="#cb2-4"></a><span class="kw">library</span>(misc3d)</span>
<span id="cb2-5"><a href="#cb2-5"></a><span class="kw">parametric3d</span>(fx, fy, fz, <span class="dt">umin =</span> <span class="dv">0</span>, <span class="dt">umax =</span> <span class="dv">2</span><span class="op">*</span>pi, <span class="dt">vmin =</span> <span class="dv">0</span>, <span class="dt">vmax =</span> <span class="dv">2</span><span class="op">*</span>pi, </span>
<span id="cb2-6"><a href="#cb2-6"></a>             <span class="dt">n =</span> <span class="dv">300</span>, <span class="dt">smooth =</span> <span class="ot">TRUE</span>, <span class="dt">color =</span> <span class="st">&quot;#363940&quot;</span>)</span>
<span id="cb2-7"><a href="#cb2-7"></a>rgl<span class="op">::</span><span class="kw">view3d</span>(<span class="dv">90</span>, <span class="dv">0</span>, <span class="dt">zoom =</span> <span class="fl">0.65</span>)</span></code></pre></div>
<p><img src="./figures/HopfTorus_grey.png" /></p>
<p>A ring cyclide is a Hopf torus. It corresponds to the case when <span class="math inline">\(\Gamma\)</span> describes a circle on the unit sphere <span class="math inline">\(S^2\)</span>. Below is a R function to compute such a circle.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a><span class="co"># helper function: plane passing by points p1, p2, p3 </span></span>
<span id="cb3-2"><a href="#cb3-2"></a>plane3pts &lt;-<span class="st"> </span><span class="cf">function</span>(p1,p2,p3){ </span>
<span id="cb3-3"><a href="#cb3-3"></a>    xcoef &lt;-<span class="st"> </span>(p1[<span class="dv">2</span>]<span class="op">-</span>p2[<span class="dv">2</span>])<span class="op">*</span>(p2[<span class="dv">3</span>]<span class="op">-</span>p3[<span class="dv">3</span>])<span class="op">-</span>(p1[<span class="dv">3</span>]<span class="op">-</span>p2[<span class="dv">3</span>])<span class="op">*</span>(p2[<span class="dv">2</span>]<span class="op">-</span>p3[<span class="dv">2</span>])</span>
<span id="cb3-4"><a href="#cb3-4"></a>    ycoef &lt;-<span class="st"> </span>(p1[<span class="dv">3</span>]<span class="op">-</span>p2[<span class="dv">3</span>])<span class="op">*</span>(p2[<span class="dv">1</span>]<span class="op">-</span>p3[<span class="dv">1</span>])<span class="op">-</span>(p1[<span class="dv">1</span>]<span class="op">-</span>p2[<span class="dv">1</span>])<span class="op">*</span>(p2[<span class="dv">3</span>]<span class="op">-</span>p3[<span class="dv">3</span>])</span>
<span id="cb3-5"><a href="#cb3-5"></a>    zcoef &lt;-<span class="st"> </span>(p1[<span class="dv">1</span>]<span class="op">-</span>p2[<span class="dv">1</span>])<span class="op">*</span>(p2[<span class="dv">2</span>]<span class="op">-</span>p3[<span class="dv">2</span>])<span class="op">-</span>(p1[<span class="dv">2</span>]<span class="op">-</span>p2[<span class="dv">2</span>])<span class="op">*</span>(p2[<span class="dv">1</span>]<span class="op">-</span>p3[<span class="dv">1</span>])</span>
<span id="cb3-6"><a href="#cb3-6"></a>    offset &lt;-<span class="st"> </span>p1[<span class="dv">1</span>]<span class="op">*</span>xcoef <span class="op">+</span><span class="st"> </span>p1[<span class="dv">2</span>]<span class="op">*</span>ycoef <span class="op">+</span><span class="st"> </span>p1[<span class="dv">3</span>]<span class="op">*</span>zcoef</span>
<span id="cb3-7"><a href="#cb3-7"></a>    <span class="kw">c</span>(xcoef, ycoef, zcoef, offset)</span>
<span id="cb3-8"><a href="#cb3-8"></a>}</span>
<span id="cb3-9"><a href="#cb3-9"></a></span>
<span id="cb3-10"><a href="#cb3-10"></a><span class="co"># helper function: cross product </span></span>
<span id="cb3-11"><a href="#cb3-11"></a>cross &lt;-<span class="st"> </span><span class="cf">function</span>(v, w){ </span>
<span id="cb3-12"><a href="#cb3-12"></a>  <span class="kw">c</span>(</span>
<span id="cb3-13"><a href="#cb3-13"></a>    v[<span class="dv">2</span>] <span class="op">*</span><span class="st"> </span>w[<span class="dv">3</span>] <span class="op">-</span><span class="st"> </span>v[<span class="dv">3</span>] <span class="op">*</span><span class="st"> </span>w[<span class="dv">2</span>], </span>
<span id="cb3-14"><a href="#cb3-14"></a>    v[<span class="dv">3</span>] <span class="op">*</span><span class="st"> </span>w[<span class="dv">1</span>] <span class="op">-</span><span class="st"> </span>v[<span class="dv">1</span>] <span class="op">*</span><span class="st"> </span>w[<span class="dv">3</span>], </span>
<span id="cb3-15"><a href="#cb3-15"></a>    v[<span class="dv">1</span>] <span class="op">*</span><span class="st"> </span>w[<span class="dv">2</span>] <span class="op">-</span><span class="st"> </span>v[<span class="dv">2</span>] <span class="op">*</span><span class="st"> </span>w[<span class="dv">1</span>]</span>
<span id="cb3-16"><a href="#cb3-16"></a>  )</span>
<span id="cb3-17"><a href="#cb3-17"></a>}</span>
<span id="cb3-18"><a href="#cb3-18"></a></span>
<span id="cb3-19"><a href="#cb3-19"></a><span class="co"># circle passing by points three points p1, p2, p3 </span></span>
<span id="cb3-20"><a href="#cb3-20"></a><span class="co"># given in Cartesian coordinates</span></span>
<span id="cb3-21"><a href="#cb3-21"></a>circle3pts &lt;-<span class="st"> </span><span class="cf">function</span>(p1, p2, p3){</span>
<span id="cb3-22"><a href="#cb3-22"></a>  p12 &lt;-<span class="st"> </span>(p1<span class="op">+</span>p2)<span class="op">/</span><span class="dv">2</span></span>
<span id="cb3-23"><a href="#cb3-23"></a>  p23 &lt;-<span class="st"> </span>(p2<span class="op">+</span>p3)<span class="op">/</span><span class="dv">2</span></span>
<span id="cb3-24"><a href="#cb3-24"></a>  v12 &lt;-<span class="st"> </span>p2<span class="op">-</span>p1</span>
<span id="cb3-25"><a href="#cb3-25"></a>  v23 &lt;-<span class="st"> </span>p3<span class="op">-</span>p2</span>
<span id="cb3-26"><a href="#cb3-26"></a>  plane &lt;-<span class="st"> </span><span class="kw">plane3pts</span>(p1, p2, p3)</span>
<span id="cb3-27"><a href="#cb3-27"></a>  A &lt;-<span class="st"> </span><span class="kw">rbind</span>(plane[<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>], v12, v23)</span>
<span id="cb3-28"><a href="#cb3-28"></a>  b &lt;-<span class="st"> </span><span class="kw">c</span>(plane[<span class="dv">4</span>], <span class="kw">sum</span>(p12<span class="op">*</span>v12), <span class="kw">sum</span>(p23<span class="op">*</span>v23))</span>
<span id="cb3-29"><a href="#cb3-29"></a>  center &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="kw">solve</span>(A) <span class="op">%*%</span><span class="st"> </span>b)</span>
<span id="cb3-30"><a href="#cb3-30"></a>  r &lt;-<span class="st"> </span><span class="kw">sqrt</span>(<span class="kw">c</span>(<span class="kw">crossprod</span>(p1<span class="op">-</span>center)))</span>
<span id="cb3-31"><a href="#cb3-31"></a>  i &lt;-<span class="st"> </span>(p1<span class="op">-</span>center) <span class="op">/</span><span class="st"> </span>r</span>
<span id="cb3-32"><a href="#cb3-32"></a>  normal &lt;-<span class="st"> </span>plane[<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>] <span class="op">/</span><span class="st"> </span><span class="kw">sqrt</span>(<span class="kw">c</span>(<span class="kw">crossprod</span>(plane[<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>])))</span>
<span id="cb3-33"><a href="#cb3-33"></a>  <span class="kw">list</span>(<span class="dt">center =</span> center, <span class="dt">radius =</span> r, <span class="dt">i =</span> i, <span class="dt">j =</span> <span class="kw">cross</span>(i,normal))</span>
<span id="cb3-34"><a href="#cb3-34"></a>} <span class="co"># circle parameterization: center + radius*(cos(t)*i + sin(t)*j)</span></span>
<span id="cb3-35"><a href="#cb3-35"></a></span>
<span id="cb3-36"><a href="#cb3-36"></a><span class="co"># circle on unit sphere passing by three points </span></span>
<span id="cb3-37"><a href="#cb3-37"></a><span class="co"># given in spherical coordinates </span></span>
<span id="cb3-38"><a href="#cb3-38"></a>circleOnUnitSphere &lt;-<span class="st"> </span><span class="cf">function</span>(thph1, thph2, thph3){</span>
<span id="cb3-39"><a href="#cb3-39"></a>  theta1 &lt;-<span class="st"> </span>thph1[<span class="dv">1</span>]; phi1 &lt;-<span class="st"> </span>thph1[<span class="dv">2</span>]</span>
<span id="cb3-40"><a href="#cb3-40"></a>  theta2 &lt;-<span class="st"> </span>thph2[<span class="dv">1</span>]; phi2 &lt;-<span class="st"> </span>thph2[<span class="dv">2</span>]</span>
<span id="cb3-41"><a href="#cb3-41"></a>  theta3 &lt;-<span class="st"> </span>thph3[<span class="dv">1</span>]; phi3 &lt;-<span class="st"> </span>thph3[<span class="dv">2</span>]</span>
<span id="cb3-42"><a href="#cb3-42"></a>  p1 &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="kw">sin</span>(theta1)<span class="op">*</span><span class="kw">cos</span>(phi1), <span class="kw">sin</span>(theta1)<span class="op">*</span><span class="kw">sin</span>(phi1), <span class="kw">cos</span>(theta1))</span>
<span id="cb3-43"><a href="#cb3-43"></a>  p2 &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="kw">sin</span>(theta2)<span class="op">*</span><span class="kw">cos</span>(phi2), <span class="kw">sin</span>(theta2)<span class="op">*</span><span class="kw">sin</span>(phi2), <span class="kw">cos</span>(theta2))</span>
<span id="cb3-44"><a href="#cb3-44"></a>  p3 &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="kw">sin</span>(theta3)<span class="op">*</span><span class="kw">cos</span>(phi3), <span class="kw">sin</span>(theta3)<span class="op">*</span><span class="kw">sin</span>(phi3), <span class="kw">cos</span>(theta3))</span>
<span id="cb3-45"><a href="#cb3-45"></a>  <span class="kw">circle3pts</span>(p1, p2, p3)</span>
<span id="cb3-46"><a href="#cb3-46"></a>}</span></code></pre></div>
<p>The function returns a list with four elements: a point <code>center</code>, a number <code>radius</code>, and two vectors <code>i</code> and <code>j</code>. The parameterization of the spherical circle is then <code>center + radius*(cos(t)*i + sin(t)*j)</code> for <code>t</code> <span class="math inline">\(\in (0, 2\pi[\)</span>.</p>
<p>Let’s try. We enter three pairs of spherical coordinates and we apply the <code>circleOnUnitSphere</code> function:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1"></a>thph1 =<span class="st"> </span><span class="kw">c</span>(<span class="fl">1.3</span>, <span class="fl">1.5</span>)</span>
<span id="cb4-2"><a href="#cb4-2"></a>thph2 =<span class="st"> </span><span class="kw">c</span>(<span class="fl">1.9</span>, <span class="fl">2.8</span>)</span>
<span id="cb4-3"><a href="#cb4-3"></a>thph3 =<span class="st"> </span><span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span>)</span>
<span id="cb4-4"><a href="#cb4-4"></a>circ &lt;-<span class="st"> </span><span class="kw">circleOnUnitSphere</span>(thph1, thph2, thph3)</span></code></pre></div>
<p>Then we define the parametrization of the stereographically projected Hopf torus:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1"></a>F &lt;-<span class="st"> </span><span class="cf">function</span>(t, phi){</span>
<span id="cb5-2"><a href="#cb5-2"></a>  p &lt;-<span class="st"> </span><span class="kw">with</span>(circ, center <span class="op">+</span><span class="st"> </span>radius<span class="op">*</span>(<span class="kw">cos</span>(t)<span class="op">*</span>i <span class="op">+</span><span class="st"> </span><span class="kw">sin</span>(t)<span class="op">*</span>j))</span>
<span id="cb5-3"><a href="#cb5-3"></a>  <span class="kw">Stereo</span>(<span class="kw">HopfInverse</span>(p, phi))</span>
<span id="cb5-4"><a href="#cb5-4"></a>}</span></code></pre></div>
<p>And we plot:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1"></a><span class="kw">parametric3d</span>(fx, fy, fz, <span class="dt">umin =</span> <span class="dv">0</span>, <span class="dt">umax =</span> <span class="dv">2</span><span class="op">*</span>pi, <span class="dt">vmin =</span> <span class="dv">0</span>, <span class="dt">vmax =</span> <span class="dv">2</span><span class="op">*</span>pi, </span>
<span id="cb6-2"><a href="#cb6-2"></a>             <span class="dt">n =</span> <span class="dv">250</span>, <span class="dt">smooth =</span> <span class="ot">TRUE</span>, <span class="dt">color =</span> <span class="st">&quot;#363940&quot;</span>)</span>
<span id="cb6-3"><a href="#cb6-3"></a>rgl<span class="op">::</span><span class="kw">view3d</span>(<span class="dv">90</span>, <span class="dv">0</span>, <span class="dt">zoom =</span> <span class="fl">0.65</span>)</span></code></pre></div>
<p><img src="./figures/cyclide_grey.png" /></p>
<p>By rotating our spherical circle about the <span class="math inline">\(z\)</span>-axis, we can obtain the <a href="./linkedCyclidesParametric.html">linked cyclides</a>. Below is a R function to perform a rotation in spherical coordinates. See <a href="http://stla.github.io/stlapblog/posts/RotationSphericalCoordinates.html">this post</a> on my former blog for some explanations.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1"></a><span class="co"># helper functions: basic rotations ####</span></span>
<span id="cb7-2"><a href="#cb7-2"></a>Rx &lt;-<span class="st"> </span><span class="cf">function</span>(alpha){</span>
<span id="cb7-3"><a href="#cb7-3"></a>  <span class="kw">rbind</span>(<span class="kw">c</span>(<span class="kw">cos</span>(alpha<span class="op">/</span><span class="dv">2</span>), <span class="op">-</span>1i<span class="op">*</span><span class="kw">sin</span>(alpha<span class="op">/</span><span class="dv">2</span>)),</span>
<span id="cb7-4"><a href="#cb7-4"></a>        <span class="kw">c</span>(<span class="op">-</span>1i<span class="op">*</span><span class="kw">sin</span>(alpha<span class="op">/</span><span class="dv">2</span>), <span class="kw">cos</span>(alpha<span class="op">/</span><span class="dv">2</span>)))</span>
<span id="cb7-5"><a href="#cb7-5"></a>}</span>
<span id="cb7-6"><a href="#cb7-6"></a>Ry &lt;-<span class="st"> </span><span class="cf">function</span>(alpha){</span>
<span id="cb7-7"><a href="#cb7-7"></a>  <span class="kw">rbind</span>(<span class="kw">c</span>(<span class="kw">cos</span>(alpha<span class="op">/</span><span class="dv">2</span>), <span class="op">-</span><span class="kw">sin</span>(alpha<span class="op">/</span><span class="dv">2</span>)),</span>
<span id="cb7-8"><a href="#cb7-8"></a>        <span class="kw">c</span>(<span class="kw">sin</span>(alpha<span class="op">/</span><span class="dv">2</span>), <span class="kw">cos</span>(alpha<span class="op">/</span><span class="dv">2</span>)))</span>
<span id="cb7-9"><a href="#cb7-9"></a>}</span>
<span id="cb7-10"><a href="#cb7-10"></a>Rz &lt;-<span class="st"> </span><span class="cf">function</span>(alpha){</span>
<span id="cb7-11"><a href="#cb7-11"></a>  <span class="kw">rbind</span>(<span class="kw">c</span>(<span class="kw">exp</span>(<span class="op">-</span>1i<span class="op">*</span>alpha<span class="op">/</span><span class="dv">2</span>), <span class="dv">0</span>),</span>
<span id="cb7-12"><a href="#cb7-12"></a>        <span class="kw">c</span>(<span class="dv">0</span>, <span class="kw">exp</span>(1i<span class="op">*</span>alpha<span class="op">/</span><span class="dv">2</span>)))</span>
<span id="cb7-13"><a href="#cb7-13"></a>}</span>
<span id="cb7-14"><a href="#cb7-14"></a></span>
<span id="cb7-15"><a href="#cb7-15"></a><span class="co"># 3D rotation in spherical coordinates ####</span></span>
<span id="cb7-16"><a href="#cb7-16"></a><span class="co">#&#39; @description Rotation of a vector given in spherical coordinates.</span></span>
<span id="cb7-17"><a href="#cb7-17"></a><span class="co">#&#39; @param theta_phi spherical coordinates, a vector containing the </span></span>
<span id="cb7-18"><a href="#cb7-18"></a><span class="co">#&#39; colatitude (or polar angle), between 0 and pi, and the longitude </span></span>
<span id="cb7-19"><a href="#cb7-19"></a><span class="co">#&#39; (or azimuthal angle), between 0 and 2pi</span></span>
<span id="cb7-20"><a href="#cb7-20"></a><span class="co">#&#39; @param axis either a letter &#39;x&#39;, &#39;y&#39; or &#39;z&#39;, a numeric vector of </span></span>
<span id="cb7-21"><a href="#cb7-21"></a><span class="co">#&#39; length 2 (the spherical coordinates of the axis), or a numeric </span></span>
<span id="cb7-22"><a href="#cb7-22"></a><span class="co">#&#39; vector of length 3 (the Cartesian coordinates of the axis)</span></span>
<span id="cb7-23"><a href="#cb7-23"></a><span class="co">#&#39; @param alpha angle of rotation</span></span>
<span id="cb7-24"><a href="#cb7-24"></a><span class="co">#&#39; @return The spherical coordinates of the transformed vector.</span></span>
<span id="cb7-25"><a href="#cb7-25"></a>rotation &lt;-<span class="st"> </span><span class="cf">function</span>(theta_phi, <span class="dt">axis=</span><span class="st">&quot;x&quot;</span>, alpha){</span>
<span id="cb7-26"><a href="#cb7-26"></a>  <span class="cf">if</span>(<span class="kw">is.character</span>(axis)){</span>
<span id="cb7-27"><a href="#cb7-27"></a>    axis &lt;-<span class="st"> </span><span class="kw">match.arg</span>(axis, <span class="kw">c</span>(<span class="st">&quot;x&quot;</span>,<span class="st">&quot;y&quot;</span>,<span class="st">&quot;z&quot;</span>))</span>
<span id="cb7-28"><a href="#cb7-28"></a>    R &lt;-<span class="st"> </span><span class="cf">switch</span>(axis, </span>
<span id="cb7-29"><a href="#cb7-29"></a>                <span class="st">&quot;x&quot;</span> =<span class="st"> </span><span class="kw">Rx</span>(alpha),</span>
<span id="cb7-30"><a href="#cb7-30"></a>                <span class="st">&quot;y&quot;</span> =<span class="st"> </span><span class="kw">Ry</span>(alpha),</span>
<span id="cb7-31"><a href="#cb7-31"></a>                <span class="st">&quot;z&quot;</span> =<span class="st"> </span><span class="kw">Rz</span>(alpha))</span>
<span id="cb7-32"><a href="#cb7-32"></a>  }<span class="cf">else</span> <span class="cf">if</span>(<span class="kw">length</span>(axis) <span class="op">==</span><span class="st"> </span><span class="dv">2</span>){</span>
<span id="cb7-33"><a href="#cb7-33"></a>    Theta &lt;-<span class="st"> </span>axis[<span class="dv">1</span>]; Phi &lt;-<span class="st"> </span>axis[<span class="dv">2</span>]</span>
<span id="cb7-34"><a href="#cb7-34"></a>    R &lt;-<span class="st"> </span><span class="kw">Rz</span>(Phi) <span class="op">%*%</span><span class="st"> </span><span class="kw">Ry</span>(Theta) <span class="op">%*%</span><span class="st"> </span><span class="kw">Rz</span>(alpha) <span class="op">%*%</span><span class="st"> </span></span>
<span id="cb7-35"><a href="#cb7-35"></a><span class="st">           </span><span class="kw">t</span>(<span class="kw">Ry</span>(Theta)) <span class="op">%*%</span><span class="st"> </span><span class="kw">t</span>(<span class="kw">Conj</span>(<span class="kw">Rz</span>(Phi)))</span>
<span id="cb7-36"><a href="#cb7-36"></a>  }<span class="cf">else</span> <span class="cf">if</span>(<span class="kw">length</span>(axis) <span class="op">==</span><span class="st"> </span><span class="dv">3</span>){</span>
<span id="cb7-37"><a href="#cb7-37"></a>    axis &lt;-<span class="st"> </span>axis <span class="op">/</span><span class="st"> </span><span class="kw">sqrt</span>(<span class="kw">c</span>(<span class="kw">crossprod</span>(axis)))</span>
<span id="cb7-38"><a href="#cb7-38"></a>    X &lt;-<span class="st"> </span><span class="kw">rbind</span>(<span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">1</span>), <span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">0</span>))</span>
<span id="cb7-39"><a href="#cb7-39"></a>    Y &lt;-<span class="st"> </span><span class="kw">rbind</span>(<span class="kw">c</span>(<span class="dv">0</span>,<span class="op">-</span>1i), <span class="kw">c</span>(1i,<span class="dv">0</span>)) </span>
<span id="cb7-40"><a href="#cb7-40"></a>    Z &lt;-<span class="st"> </span><span class="kw">rbind</span>(<span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">0</span>), <span class="kw">c</span>(<span class="dv">0</span>,<span class="op">-</span><span class="dv">1</span>))</span>
<span id="cb7-41"><a href="#cb7-41"></a>    R &lt;-<span class="st"> </span><span class="kw">cos</span>(alpha<span class="op">/</span><span class="dv">2</span>)<span class="op">*</span><span class="kw">diag</span>(<span class="dv">2</span>) <span class="op">-</span><span class="st"> </span>1i<span class="op">*</span><span class="kw">sin</span>(alpha<span class="op">/</span><span class="dv">2</span>) <span class="op">*</span><span class="st"> </span></span>
<span id="cb7-42"><a href="#cb7-42"></a><span class="st">           </span>(axis[<span class="dv">1</span>]<span class="op">*</span>X <span class="op">+</span><span class="st"> </span>axis[<span class="dv">2</span>]<span class="op">*</span>Y <span class="op">+</span><span class="st"> </span>axis[<span class="dv">3</span>]<span class="op">*</span>Z)</span>
<span id="cb7-43"><a href="#cb7-43"></a>  }<span class="cf">else</span>{</span>
<span id="cb7-44"><a href="#cb7-44"></a>    <span class="kw">stop</span>(<span class="st">&quot;`axis` must be either:</span></span>
<span id="cb7-45"><a href="#cb7-45"></a><span class="st">         - a letter (&#39;x&#39;, &#39;y&#39; or &#39;z&#39;)</span></span>
<span id="cb7-46"><a href="#cb7-46"></a><span class="st">         - a numeric vector of length two (spherical coordinates)</span></span>
<span id="cb7-47"><a href="#cb7-47"></a><span class="st">         - a numeric vector of length three (Cartesian coordinates)&quot;</span>)</span>
<span id="cb7-48"><a href="#cb7-48"></a>  }</span>
<span id="cb7-49"><a href="#cb7-49"></a>  theta &lt;-<span class="st"> </span>theta_phi[<span class="dv">1</span>]; phi &lt;-<span class="st"> </span>theta_phi[<span class="dv">2</span>]</span>
<span id="cb7-50"><a href="#cb7-50"></a>  qubit &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="kw">cos</span>(theta<span class="op">/</span><span class="dv">2</span>), <span class="kw">exp</span>(1i<span class="op">*</span>phi)<span class="op">*</span><span class="kw">sin</span>(theta<span class="op">/</span><span class="dv">2</span>))</span>
<span id="cb7-51"><a href="#cb7-51"></a>  newqubit &lt;-<span class="st"> </span>R <span class="op">%*%</span><span class="st"> </span>qubit</span>
<span id="cb7-52"><a href="#cb7-52"></a>  z0 &lt;-<span class="st"> </span>newqubit[<span class="dv">1</span>,<span class="dv">1</span>]; z1 &lt;-<span class="st"> </span>newqubit[<span class="dv">2</span>,<span class="dv">1</span>]</span>
<span id="cb7-53"><a href="#cb7-53"></a>  <span class="kw">c</span>(<span class="dv">2</span><span class="op">*</span><span class="kw">atan</span>(<span class="kw">Mod</span>(z1)<span class="op">/</span><span class="kw">Mod</span>(z0)), <span class="kw">Arg</span>(z1)<span class="op">-</span><span class="kw">Arg</span>(z0))</span>
<span id="cb7-54"><a href="#cb7-54"></a>}</span></code></pre></div>
<p>Now, let’s rotate our spherical circle and plot:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1"></a>thph1 &lt;-<span class="st"> </span><span class="kw">rotation</span>(thph1, <span class="st">&quot;z&quot;</span>, <span class="dv">2</span><span class="op">*</span>pi<span class="op">/</span><span class="dv">3</span>)</span>
<span id="cb8-2"><a href="#cb8-2"></a>thph2 &lt;-<span class="st"> </span><span class="kw">rotation</span>(thph2, <span class="st">&quot;z&quot;</span>, <span class="dv">2</span><span class="op">*</span>pi<span class="op">/</span><span class="dv">3</span>)</span>
<span id="cb8-3"><a href="#cb8-3"></a>thph3 &lt;-<span class="st"> </span><span class="kw">rotation</span>(thph3, <span class="st">&quot;z&quot;</span>, <span class="dv">2</span><span class="op">*</span>pi<span class="op">/</span><span class="dv">3</span>)</span>
<span id="cb8-4"><a href="#cb8-4"></a>circ &lt;-<span class="st"> </span><span class="kw">circleOnUnitSphere</span>(thph1, thph2, thph3)</span>
<span id="cb8-5"><a href="#cb8-5"></a><span class="kw">parametric3d</span>(fx, fy, fz, <span class="dt">umin =</span> <span class="dv">0</span>, <span class="dt">umax =</span> <span class="dv">2</span><span class="op">*</span>pi, <span class="dt">vmin =</span> <span class="dv">0</span>, <span class="dt">vmax =</span> <span class="dv">2</span><span class="op">*</span>pi, </span>
<span id="cb8-6"><a href="#cb8-6"></a>             <span class="dt">n =</span> <span class="dv">250</span>, <span class="dt">smooth =</span> <span class="ot">TRUE</span>, <span class="dt">color =</span> <span class="st">&quot;#363940&quot;</span>, <span class="dt">add =</span> <span class="ot">TRUE</span>)</span>
<span id="cb8-7"><a href="#cb8-7"></a>thph1 &lt;-<span class="st"> </span><span class="kw">rotation</span>(thph1, <span class="st">&quot;z&quot;</span>, <span class="dv">2</span><span class="op">*</span>pi<span class="op">/</span><span class="dv">3</span>)</span>
<span id="cb8-8"><a href="#cb8-8"></a>thph2 &lt;-<span class="st"> </span><span class="kw">rotation</span>(thph2, <span class="st">&quot;z&quot;</span>, <span class="dv">2</span><span class="op">*</span>pi<span class="op">/</span><span class="dv">3</span>)</span>
<span id="cb8-9"><a href="#cb8-9"></a>thph3 &lt;-<span class="st"> </span><span class="kw">rotation</span>(thph3, <span class="st">&quot;z&quot;</span>, <span class="dv">2</span><span class="op">*</span>pi<span class="op">/</span><span class="dv">3</span>)</span>
<span id="cb8-10"><a href="#cb8-10"></a>circ &lt;-<span class="st"> </span><span class="kw">circleOnUnitSphere</span>(thph1, thph2, thph3)</span>
<span id="cb8-11"><a href="#cb8-11"></a><span class="kw">parametric3d</span>(fx, fy, fz, <span class="dt">umin =</span> <span class="dv">0</span>, <span class="dt">umax =</span> <span class="dv">2</span><span class="op">*</span>pi, <span class="dt">vmin =</span> <span class="dv">0</span>, <span class="dt">vmax =</span> <span class="dv">2</span><span class="op">*</span>pi, </span>
<span id="cb8-12"><a href="#cb8-12"></a>             <span class="dt">n =</span> <span class="dv">250</span>, <span class="dt">smooth =</span> <span class="ot">TRUE</span>, <span class="dt">color =</span> <span class="st">&quot;#363940&quot;</span>, <span class="dt">add =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<p><img src="./figures/linkedCyclides_grey.png" /></p>

        </div>


        <div id="footer">
          Site proudly generated by
          <a href="http://jaspervdj.be/hakyll">Hakyll</a>
        </div>

      </div>

    </div>

    <div class="row">
      <div class="col-sm-12">
        <div id="disqus_thread"></div>
        <div class="pagination">
          <ul>
            <li>
              <a href="http://laustep.github.io/stlahblog/">&#171; Back Home</a>
            </li>
          </ul>
        </div>
      </div>
    </div>
    
  </div>

</body>

<script src="/libraries/bootstrap/bootstrap.min.js"></script>
<script>
  var disqus_developer = 1;
  var disqus_shortname = 'stlapblog';
  // required: replace example with your forum shortname
  /* * * DON'T EDIT BELOW THIS LINE * * */
  (function () {
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = 'https://' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] ||
      document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>
<noscript>Please enable JavaScript to view the
  <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a>
</noscript>
<!-- MathJax: Fall back to local if CDN offline but local image fonts are not supported (saves >100MB) -->
<script type="text/x-mathjax-config" src="/libraries/mathjax/config/TeX-MML-AM_CHTML.js"></script>
<!-- <script>
  window.MathJax || document.write('<script type="text/x-mathjax-config">MathJax.Hub.Config({"HTML-CSS":{imageFont:null}});<\/script><script src="../libraries/mathjax/MathJax.js"><\/script>');
</script> -->


</html>]]></description>
    <pubDate>Sun, 12 Apr 2020 00:00:00 UT</pubDate>
    <guid>https://laustep.github.io/stlahblog/posts/HopfTorus2.html</guid>
    <dc:creator>Stéphane Laurent</dc:creator>
    <category>R</category>
</item>


<item>
    <title>An orbit of the modular tessellation</title>
    <link>https://laustep.github.io/stlahblog/posts/ModularTessellationOrbit.html</link>
    <description><![CDATA[<!DOCTYPE HTML>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Saturn Elephant - An orbit of the modular tessellation</title>
  <link href="/libraries/bootstrap/bootstrap-grid.min.css" rel="stylesheet">
  <link rel="stylesheet" href="/css/default2.css" />
  <link rel="stylesheet" href="/css/post.css" />
  <link rel="stylesheet" href="/css/misc.css" /> 
  
    <link rel="stylesheet" href="/css/pandoc-solarized.css" /> 
   
  
  <link href="https://fonts.googleapis.com/css?family=Raleway:400,600,200,800" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/css?family=Droid+Sans" rel="stylesheet" type="text/css">
  <script src="/libraries/jquery.min.js"></script>
  <script type="text/javascript" async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML"></script>
</head>

<body>
  <div class="container-fluid">
    <div class="row">
      <!-- Sidebar. -->
      <div class="sidebar col-sm-2">
        <div class="row">
          <div class="col-sm-12" style="float:right;clear:both;margin-right:50px;margin-top:50px;">
            <a href="https://www.r-bloggers.com/">
              <img src="/images/Rbloggers.png" alt="Rbloggers" width="100%" />
            </a>
            <br/>
            <a href="http://t-redactyl.io/">
              <span style="color:black;font-weight:bold;font-family:sans-serif;font-size:25px;">Standard error</span>
            </a>
            <a href="http://timelyportfolio.blogspot.be/">
              <span style="color:grey;font-weight:bold;font-family:sans-serif;font-size:24px;">Timely portfolio</span>
            </a>
            <br/>
            <a href="https://antoineguillot.wordpress.com/blog/">
              <span style="color:white;background-color:darkblue;font-weight:bold;font-family:sans-serif;font-size:21px;border:5px solid;border-color:darkblue">ENHANCE DATA</span>
            </a>
            <br/>
            <a href="https://fronkonstin.com/">
              <span style="color:black;background-color:gold;font-weight:bold;font-size:29px;border:3px solid;border-color:gold;">Fronkonstin</span>
            </a>
          </div>
        </div>
        <div id="logos">
          <div class="row">
            <div class="col-sm-4">
              <img src="/images/AsymptoteLogo.svg" style="width: 150%; transform: rotateZ(-35deg)"/>
            </div>
            <div class="col-sm-4">
              <img src="/images/Rlogo.svg" style="width: 110%;"/>
            </div>
            <div class="col-sm-4">
              <img src="/images/shiny-hex.png" style="width: 90%;"/>
            </div>
          </div>
          <div class="row">
            <div class="col-sm-4">
              <img src="/images/Povray_logo_sphere.png" style="width: 105%;"/>
            </div>
            <div class="col-sm-4">
              <img src="/images/javascript.svg" style="width: 90%;"/>
            </div>
            <div class="col-sm-4">
              <img src="/images/haskell.svg" style="width: 110%;"/>
            </div>
          </div>
        </div>
      </div>

      <div class="main col-sm-10">
        <div id="header">
          <div id="logo">
            <a href="/">
              <img src="/images/stla.jpg" alt="stla" width="100px" />
            </a>
          </div>
          <div id="navigation" style="margin-top:50px;">
            <a href="/">Home</a>
            <a href="/about.html">About</a>
            <a href="/contact.html">Contact</a>
            <a href="/archive.html">Archive</a>
          </div>
        </div>

        <div class="content">
          <h1>An orbit of the modular tessellation</h1> 
          <div class="info">
    Posted on February 19, 2020
    
        by Stéphane Laurent
    
</div>
<div class="info">
    
    Tags: <a title="All pages tagged &#39;R&#39;." href="/tags/R.html">R</a>, <a title="All pages tagged &#39;maths&#39;." href="/tags/maths.html">maths</a>, <a title="All pages tagged &#39;geometry&#39;." href="/tags/geometry.html">geometry</a>
    
</div>

<p>I came across this <a href="https://www3.risc.jku.at/publications/download/risc_5011/DiplomaThesisPonweiser.pdf">interesting paper</a> entitled <em>Complex Variables Visualized</em> and written by Thomas Ponweiser.</p>
<p>In particular, I was intrigued by the <em>generalized powers</em> of a Möbius transformation (of a matrix, actually), and their actions on the modular tessellation.</p>
<p>So I firstly implemented the generalized powers in my package <code>PlaneGeometry</code>. Then I wrote the script below to visualize the orbit of the modular tessellation under the action of <span class="math inline">\(R^t\)</span>, <span class="math inline">\(0 \leqslant t &lt; 3\)</span>, with the notations of the paper. The command <code>fplot(u)</code> generates the modular tessellation under the action of <span class="math inline">\(R^t\)</span> when <code>u</code> is the value of <span class="math inline">\(t\)</span>. Then I use the <code>gifski</code> package to create the animation.</p>
<p>To get the modular transformations <span class="math inline">\(z \mapsto \frac{az+b}{cz+d}\)</span>, I use the <code>unimodular</code> function of the <code>elliptic</code> package. It generates the quadruples <span class="math inline">\((a,b,c,d)\)</span> of <em>positive</em> integers such that <span class="math inline">\(ad-bc=1\)</span>. Then we can get all such quadruples <span class="math inline">\((a,b,c,d) \in \mathbb{Z}^4\)</span> by inverting these modular transformations, swapping <span class="math inline">\(a\)</span> and <span class="math inline">\(d\)</span> and changing their signs.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a><span class="kw">library</span>(PlaneGeometry)</span>
<span id="cb1-2"><a href="#cb1-2"></a><span class="kw">library</span>(elliptic) <span class="co"># for the &#39;unimodular&#39; function</span></span>
<span id="cb1-3"><a href="#cb1-3"></a></span>
<span id="cb1-4"><a href="#cb1-4"></a><span class="co"># Möbius transformations</span></span>
<span id="cb1-5"><a href="#cb1-5"></a>T &lt;-<span class="st"> </span>Mobius<span class="op">$</span><span class="kw">new</span>(<span class="kw">rbind</span>(<span class="kw">c</span>(<span class="dv">0</span>,<span class="op">-</span><span class="dv">1</span>), <span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">0</span>)))</span>
<span id="cb1-6"><a href="#cb1-6"></a>U &lt;-<span class="st"> </span>Mobius<span class="op">$</span><span class="kw">new</span>(<span class="kw">rbind</span>(<span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">1</span>), <span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">1</span>)))</span>
<span id="cb1-7"><a href="#cb1-7"></a>R &lt;-<span class="st"> </span>U<span class="op">$</span><span class="kw">compose</span>(T)</span>
<span id="cb1-8"><a href="#cb1-8"></a><span class="co"># R^t, generalized power</span></span>
<span id="cb1-9"><a href="#cb1-9"></a>Rt &lt;-<span class="st"> </span><span class="cf">function</span>(t) R<span class="op">$</span><span class="kw">gpower</span>(t)</span>
<span id="cb1-10"><a href="#cb1-10"></a></span>
<span id="cb1-11"><a href="#cb1-11"></a><span class="co"># starting circles</span></span>
<span id="cb1-12"><a href="#cb1-12"></a>I &lt;-<span class="st"> </span>Circle<span class="op">$</span><span class="kw">new</span>(<span class="kw">c</span>(<span class="dv">0</span>,<span class="fl">1.5</span>), <span class="fl">0.5</span>)</span>
<span id="cb1-13"><a href="#cb1-13"></a>TI &lt;-<span class="st"> </span>T<span class="op">$</span><span class="kw">transformCircle</span>(I)</span>
<span id="cb1-14"><a href="#cb1-14"></a></span>
<span id="cb1-15"><a href="#cb1-15"></a><span class="co"># modified Cayley transformation</span></span>
<span id="cb1-16"><a href="#cb1-16"></a>Phi &lt;-<span class="st"> </span>Mobius<span class="op">$</span><span class="kw">new</span>(<span class="kw">rbind</span>(<span class="kw">c</span>(1i,<span class="dv">1</span>), <span class="kw">c</span>(<span class="dv">1</span>,1i)))</span>
<span id="cb1-17"><a href="#cb1-17"></a></span>
<span id="cb1-18"><a href="#cb1-18"></a><span class="co"># plotting function ####</span></span>
<span id="cb1-19"><a href="#cb1-19"></a>n &lt;-<span class="st"> </span>8L</span>
<span id="cb1-20"><a href="#cb1-20"></a>transfos &lt;-<span class="st"> </span><span class="kw">unimodular</span>(n)</span>
<span id="cb1-21"><a href="#cb1-21"></a>fplot &lt;-<span class="st"> </span><span class="cf">function</span>(u){</span>
<span id="cb1-22"><a href="#cb1-22"></a>  opar &lt;-<span class="st"> </span><span class="kw">par</span>(<span class="dt">mar =</span> <span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>), <span class="dt">bg =</span> <span class="st">&quot;black&quot;</span>)</span>
<span id="cb1-23"><a href="#cb1-23"></a>  <span class="kw">plot</span>(<span class="ot">NULL</span>, <span class="dt">asp =</span> <span class="dv">1</span>, <span class="dt">xlim =</span> <span class="kw">c</span>(<span class="op">-</span><span class="fl">1.1</span>,<span class="fl">1.1</span>), <span class="dt">ylim =</span> <span class="kw">c</span>(<span class="op">-</span><span class="fl">1.1</span>,<span class="fl">1.1</span>),</span>
<span id="cb1-24"><a href="#cb1-24"></a>       <span class="dt">xlab =</span> <span class="ot">NA</span>, <span class="dt">ylab =</span> <span class="ot">NA</span>, <span class="dt">axes =</span> <span class="ot">FALSE</span>)</span>
<span id="cb1-25"><a href="#cb1-25"></a>  <span class="kw">draw</span>(unitCircle, <span class="dt">col =</span> <span class="st">&quot;black&quot;</span>)</span>
<span id="cb1-26"><a href="#cb1-26"></a>  <span class="cf">for</span>(i <span class="cf">in</span> 1L<span class="op">:</span><span class="kw">dim</span>(transfos)[3L]){</span>
<span id="cb1-27"><a href="#cb1-27"></a>    transfo &lt;-<span class="st"> </span>transfos[,,i]</span>
<span id="cb1-28"><a href="#cb1-28"></a>    <span class="co">#</span></span>
<span id="cb1-29"><a href="#cb1-29"></a>    M &lt;-<span class="st"> </span>Mobius<span class="op">$</span><span class="kw">new</span>(transfo)</span>
<span id="cb1-30"><a href="#cb1-30"></a>    <span class="kw">draw</span>(M<span class="op">$</span><span class="kw">compose</span>(<span class="kw">Rt</span>(u))<span class="op">$</span><span class="kw">compose</span>(Phi)<span class="op">$</span><span class="kw">transformCircle</span>(I),</span>
<span id="cb1-31"><a href="#cb1-31"></a>         <span class="dt">border =</span> <span class="st">&quot;black&quot;</span>, <span class="dt">col =</span> <span class="st">&quot;magenta&quot;</span>)</span>
<span id="cb1-32"><a href="#cb1-32"></a>    <span class="kw">draw</span>(M<span class="op">$</span><span class="kw">compose</span>(<span class="kw">Rt</span>(u))<span class="op">$</span><span class="kw">compose</span>(Phi)<span class="op">$</span><span class="kw">transformCircle</span>(TI),</span>
<span id="cb1-33"><a href="#cb1-33"></a>         <span class="dt">border =</span> <span class="st">&quot;black&quot;</span>, <span class="dt">col =</span> <span class="st">&quot;magenta&quot;</span>)</span>
<span id="cb1-34"><a href="#cb1-34"></a>    M &lt;-<span class="st"> </span>M<span class="op">$</span><span class="kw">inverse</span>()</span>
<span id="cb1-35"><a href="#cb1-35"></a>    <span class="kw">draw</span>(M<span class="op">$</span><span class="kw">compose</span>(<span class="kw">Rt</span>(u))<span class="op">$</span><span class="kw">compose</span>(Phi)<span class="op">$</span><span class="kw">transformCircle</span>(I),</span>
<span id="cb1-36"><a href="#cb1-36"></a>         <span class="dt">border =</span> <span class="st">&quot;black&quot;</span>, <span class="dt">col =</span> <span class="st">&quot;magenta&quot;</span>)</span>
<span id="cb1-37"><a href="#cb1-37"></a>    <span class="kw">draw</span>(M<span class="op">$</span><span class="kw">compose</span>(<span class="kw">Rt</span>(u))<span class="op">$</span><span class="kw">compose</span>(Phi)<span class="op">$</span><span class="kw">transformCircle</span>(TI),</span>
<span id="cb1-38"><a href="#cb1-38"></a>         <span class="dt">border =</span> <span class="st">&quot;black&quot;</span>, <span class="dt">col =</span> <span class="st">&quot;magenta&quot;</span>)</span>
<span id="cb1-39"><a href="#cb1-39"></a>    <span class="co">#</span></span>
<span id="cb1-40"><a href="#cb1-40"></a>    <span class="kw">diag</span>(transfo) &lt;-<span class="st"> </span><span class="op">-</span><span class="kw">diag</span>(transfo)</span>
<span id="cb1-41"><a href="#cb1-41"></a>    M &lt;-<span class="st"> </span>Mobius<span class="op">$</span><span class="kw">new</span>(transfo)</span>
<span id="cb1-42"><a href="#cb1-42"></a>    <span class="kw">draw</span>(M<span class="op">$</span><span class="kw">compose</span>(<span class="kw">Rt</span>(u))<span class="op">$</span><span class="kw">compose</span>(Phi)<span class="op">$</span><span class="kw">transformCircle</span>(I),</span>
<span id="cb1-43"><a href="#cb1-43"></a>         <span class="dt">border =</span> <span class="st">&quot;black&quot;</span>, <span class="dt">col =</span> <span class="st">&quot;magenta&quot;</span>)</span>
<span id="cb1-44"><a href="#cb1-44"></a>    <span class="kw">draw</span>(M<span class="op">$</span><span class="kw">compose</span>(<span class="kw">Rt</span>(u))<span class="op">$</span><span class="kw">compose</span>(Phi)<span class="op">$</span><span class="kw">transformCircle</span>(TI),</span>
<span id="cb1-45"><a href="#cb1-45"></a>         <span class="dt">border =</span> <span class="st">&quot;black&quot;</span>, <span class="dt">col =</span> <span class="st">&quot;magenta&quot;</span>)</span>
<span id="cb1-46"><a href="#cb1-46"></a>    M &lt;-<span class="st"> </span>M<span class="op">$</span><span class="kw">inverse</span>()</span>
<span id="cb1-47"><a href="#cb1-47"></a>    <span class="kw">draw</span>(M<span class="op">$</span><span class="kw">compose</span>(<span class="kw">Rt</span>(u))<span class="op">$</span><span class="kw">compose</span>(Phi)<span class="op">$</span><span class="kw">transformCircle</span>(I),</span>
<span id="cb1-48"><a href="#cb1-48"></a>         <span class="dt">border =</span> <span class="st">&quot;black&quot;</span>, <span class="dt">col =</span> <span class="st">&quot;magenta&quot;</span>)</span>
<span id="cb1-49"><a href="#cb1-49"></a>    <span class="kw">draw</span>(M<span class="op">$</span><span class="kw">compose</span>(<span class="kw">Rt</span>(u))<span class="op">$</span><span class="kw">compose</span>(Phi)<span class="op">$</span><span class="kw">transformCircle</span>(TI),</span>
<span id="cb1-50"><a href="#cb1-50"></a>         <span class="dt">border =</span> <span class="st">&quot;black&quot;</span>, <span class="dt">col =</span> <span class="st">&quot;magenta&quot;</span>)</span>
<span id="cb1-51"><a href="#cb1-51"></a>    <span class="co">#</span></span>
<span id="cb1-52"><a href="#cb1-52"></a>    d &lt;-<span class="st"> </span><span class="kw">diag</span>(transfo)</span>
<span id="cb1-53"><a href="#cb1-53"></a>    <span class="cf">if</span>(d[1L] <span class="op">!=</span><span class="st"> </span>d[2L]){</span>
<span id="cb1-54"><a href="#cb1-54"></a>      <span class="kw">diag</span>(transfo) &lt;-<span class="st"> </span><span class="kw">rev</span>(d)</span>
<span id="cb1-55"><a href="#cb1-55"></a>      M &lt;-<span class="st"> </span>Mobius<span class="op">$</span><span class="kw">new</span>(transfo)</span>
<span id="cb1-56"><a href="#cb1-56"></a>      <span class="kw">draw</span>(M<span class="op">$</span><span class="kw">compose</span>(<span class="kw">Rt</span>(u))<span class="op">$</span><span class="kw">compose</span>(Phi)<span class="op">$</span><span class="kw">transformCircle</span>(I),</span>
<span id="cb1-57"><a href="#cb1-57"></a>           <span class="dt">border =</span> <span class="st">&quot;black&quot;</span>, <span class="dt">col =</span> <span class="st">&quot;magenta&quot;</span>)</span>
<span id="cb1-58"><a href="#cb1-58"></a>      <span class="kw">draw</span>(M<span class="op">$</span><span class="kw">compose</span>(<span class="kw">Rt</span>(u))<span class="op">$</span><span class="kw">compose</span>(Phi)<span class="op">$</span><span class="kw">transformCircle</span>(TI),</span>
<span id="cb1-59"><a href="#cb1-59"></a>           <span class="dt">border =</span> <span class="st">&quot;black&quot;</span>, <span class="dt">col =</span> <span class="st">&quot;magenta&quot;</span>)</span>
<span id="cb1-60"><a href="#cb1-60"></a>      M &lt;-<span class="st"> </span>M<span class="op">$</span><span class="kw">inverse</span>()</span>
<span id="cb1-61"><a href="#cb1-61"></a>      <span class="kw">draw</span>(M<span class="op">$</span><span class="kw">compose</span>(<span class="kw">Rt</span>(u))<span class="op">$</span><span class="kw">compose</span>(Phi)<span class="op">$</span><span class="kw">transformCircle</span>(I),</span>
<span id="cb1-62"><a href="#cb1-62"></a>           <span class="dt">border =</span> <span class="st">&quot;black&quot;</span>, <span class="dt">col =</span> <span class="st">&quot;magenta&quot;</span>)</span>
<span id="cb1-63"><a href="#cb1-63"></a>      <span class="kw">draw</span>(M<span class="op">$</span><span class="kw">compose</span>(<span class="kw">Rt</span>(u))<span class="op">$</span><span class="kw">compose</span>(Phi)<span class="op">$</span><span class="kw">transformCircle</span>(TI),</span>
<span id="cb1-64"><a href="#cb1-64"></a>           <span class="dt">border =</span> <span class="st">&quot;black&quot;</span>, <span class="dt">col =</span> <span class="st">&quot;magenta&quot;</span>)</span>
<span id="cb1-65"><a href="#cb1-65"></a>    }</span>
<span id="cb1-66"><a href="#cb1-66"></a>  }</span>
<span id="cb1-67"><a href="#cb1-67"></a>  <span class="cf">for</span>(i <span class="cf">in</span> 1L<span class="op">:</span><span class="kw">dim</span>(transfos)[3L]){</span>
<span id="cb1-68"><a href="#cb1-68"></a>    transfo &lt;-<span class="st"> </span>transfos[,,i]</span>
<span id="cb1-69"><a href="#cb1-69"></a>    <span class="co">#</span></span>
<span id="cb1-70"><a href="#cb1-70"></a>    M &lt;-<span class="st"> </span>Mobius<span class="op">$</span><span class="kw">new</span>(transfo)<span class="op">$</span><span class="kw">compose</span>(T)</span>
<span id="cb1-71"><a href="#cb1-71"></a>    <span class="kw">draw</span>(M<span class="op">$</span><span class="kw">compose</span>(<span class="kw">Rt</span>(u))<span class="op">$</span><span class="kw">compose</span>(Phi)<span class="op">$</span><span class="kw">transformCircle</span>(I),</span>
<span id="cb1-72"><a href="#cb1-72"></a>         <span class="dt">border =</span> <span class="st">&quot;black&quot;</span>, <span class="dt">col =</span> <span class="st">&quot;magenta&quot;</span>)</span>
<span id="cb1-73"><a href="#cb1-73"></a>    <span class="kw">draw</span>(M<span class="op">$</span><span class="kw">compose</span>(<span class="kw">Rt</span>(u))<span class="op">$</span><span class="kw">compose</span>(Phi)<span class="op">$</span><span class="kw">transformCircle</span>(TI),</span>
<span id="cb1-74"><a href="#cb1-74"></a>         <span class="dt">border =</span> <span class="st">&quot;black&quot;</span>, <span class="dt">col =</span> <span class="st">&quot;magenta&quot;</span>)</span>
<span id="cb1-75"><a href="#cb1-75"></a>    M &lt;-<span class="st"> </span>M<span class="op">$</span><span class="kw">inverse</span>()</span>
<span id="cb1-76"><a href="#cb1-76"></a>    <span class="kw">draw</span>(M<span class="op">$</span><span class="kw">compose</span>(<span class="kw">Rt</span>(u))<span class="op">$</span><span class="kw">compose</span>(Phi)<span class="op">$</span><span class="kw">transformCircle</span>(I),</span>
<span id="cb1-77"><a href="#cb1-77"></a>         <span class="dt">border =</span> <span class="st">&quot;black&quot;</span>, <span class="dt">col =</span> <span class="st">&quot;magenta&quot;</span>)</span>
<span id="cb1-78"><a href="#cb1-78"></a>    <span class="kw">draw</span>(M<span class="op">$</span><span class="kw">compose</span>(<span class="kw">Rt</span>(u))<span class="op">$</span><span class="kw">compose</span>(Phi)<span class="op">$</span><span class="kw">transformCircle</span>(TI),</span>
<span id="cb1-79"><a href="#cb1-79"></a>         <span class="dt">border =</span> <span class="st">&quot;black&quot;</span>, <span class="dt">col =</span> <span class="st">&quot;magenta&quot;</span>)</span>
<span id="cb1-80"><a href="#cb1-80"></a>    <span class="co">#</span></span>
<span id="cb1-81"><a href="#cb1-81"></a>    <span class="kw">diag</span>(transfo) &lt;-<span class="st"> </span><span class="op">-</span><span class="kw">diag</span>(transfo)</span>
<span id="cb1-82"><a href="#cb1-82"></a>    M &lt;-<span class="st"> </span>Mobius<span class="op">$</span><span class="kw">new</span>(transfo)<span class="op">$</span><span class="kw">compose</span>(T)</span>
<span id="cb1-83"><a href="#cb1-83"></a>    <span class="kw">draw</span>(M<span class="op">$</span><span class="kw">compose</span>(<span class="kw">Rt</span>(u))<span class="op">$</span><span class="kw">compose</span>(Phi)<span class="op">$</span><span class="kw">transformCircle</span>(I),</span>
<span id="cb1-84"><a href="#cb1-84"></a>         <span class="dt">border =</span> <span class="st">&quot;black&quot;</span>, <span class="dt">col =</span> <span class="st">&quot;magenta&quot;</span>)</span>
<span id="cb1-85"><a href="#cb1-85"></a>    <span class="kw">draw</span>(M<span class="op">$</span><span class="kw">compose</span>(<span class="kw">Rt</span>(u))<span class="op">$</span><span class="kw">compose</span>(Phi)<span class="op">$</span><span class="kw">transformCircle</span>(TI),</span>
<span id="cb1-86"><a href="#cb1-86"></a>         <span class="dt">border =</span> <span class="st">&quot;black&quot;</span>, <span class="dt">col =</span> <span class="st">&quot;magenta&quot;</span>)</span>
<span id="cb1-87"><a href="#cb1-87"></a>    M &lt;-<span class="st"> </span>M<span class="op">$</span><span class="kw">inverse</span>()</span>
<span id="cb1-88"><a href="#cb1-88"></a>    <span class="kw">draw</span>(M<span class="op">$</span><span class="kw">compose</span>(<span class="kw">Rt</span>(u))<span class="op">$</span><span class="kw">compose</span>(Phi)<span class="op">$</span><span class="kw">transformCircle</span>(I),</span>
<span id="cb1-89"><a href="#cb1-89"></a>         <span class="dt">border =</span> <span class="st">&quot;black&quot;</span>, <span class="dt">col =</span> <span class="st">&quot;magenta&quot;</span>)</span>
<span id="cb1-90"><a href="#cb1-90"></a>    <span class="kw">draw</span>(M<span class="op">$</span><span class="kw">compose</span>(<span class="kw">Rt</span>(u))<span class="op">$</span><span class="kw">compose</span>(Phi)<span class="op">$</span><span class="kw">transformCircle</span>(TI),</span>
<span id="cb1-91"><a href="#cb1-91"></a>         <span class="dt">border =</span> <span class="st">&quot;black&quot;</span>, <span class="dt">col =</span> <span class="st">&quot;magenta&quot;</span>)</span>
<span id="cb1-92"><a href="#cb1-92"></a>    <span class="co">#</span></span>
<span id="cb1-93"><a href="#cb1-93"></a>    d &lt;-<span class="st"> </span><span class="kw">diag</span>(transfo)</span>
<span id="cb1-94"><a href="#cb1-94"></a>    <span class="cf">if</span>(d[1L] <span class="op">!=</span><span class="st"> </span>d[2L]){</span>
<span id="cb1-95"><a href="#cb1-95"></a>      <span class="kw">diag</span>(transfo) &lt;-<span class="st"> </span><span class="kw">rev</span>(d)</span>
<span id="cb1-96"><a href="#cb1-96"></a>      M &lt;-<span class="st"> </span>Mobius<span class="op">$</span><span class="kw">new</span>(transfo)<span class="op">$</span><span class="kw">compose</span>(T)</span>
<span id="cb1-97"><a href="#cb1-97"></a>      <span class="kw">draw</span>(M<span class="op">$</span><span class="kw">compose</span>(<span class="kw">Rt</span>(u))<span class="op">$</span><span class="kw">compose</span>(Phi)<span class="op">$</span><span class="kw">transformCircle</span>(I),</span>
<span id="cb1-98"><a href="#cb1-98"></a>           <span class="dt">border =</span> <span class="st">&quot;black&quot;</span>, <span class="dt">col =</span> <span class="st">&quot;magenta&quot;</span>)</span>
<span id="cb1-99"><a href="#cb1-99"></a>      <span class="kw">draw</span>(M<span class="op">$</span><span class="kw">compose</span>(<span class="kw">Rt</span>(u))<span class="op">$</span><span class="kw">compose</span>(Phi)<span class="op">$</span><span class="kw">transformCircle</span>(TI),</span>
<span id="cb1-100"><a href="#cb1-100"></a>           <span class="dt">border =</span> <span class="st">&quot;black&quot;</span>, <span class="dt">col =</span> <span class="st">&quot;magenta&quot;</span>)</span>
<span id="cb1-101"><a href="#cb1-101"></a>      M &lt;-<span class="st"> </span>M<span class="op">$</span><span class="kw">inverse</span>()</span>
<span id="cb1-102"><a href="#cb1-102"></a>      <span class="kw">draw</span>(M<span class="op">$</span><span class="kw">compose</span>(<span class="kw">Rt</span>(u))<span class="op">$</span><span class="kw">compose</span>(Phi)<span class="op">$</span><span class="kw">transformCircle</span>(I),</span>
<span id="cb1-103"><a href="#cb1-103"></a>           <span class="dt">border =</span> <span class="st">&quot;black&quot;</span>, <span class="dt">col =</span> <span class="st">&quot;magenta&quot;</span>)</span>
<span id="cb1-104"><a href="#cb1-104"></a>      <span class="kw">draw</span>(M<span class="op">$</span><span class="kw">compose</span>(<span class="kw">Rt</span>(u))<span class="op">$</span><span class="kw">compose</span>(Phi)<span class="op">$</span><span class="kw">transformCircle</span>(TI),</span>
<span id="cb1-105"><a href="#cb1-105"></a>           <span class="dt">border =</span> <span class="st">&quot;black&quot;</span>, <span class="dt">col =</span> <span class="st">&quot;magenta&quot;</span>)</span>
<span id="cb1-106"><a href="#cb1-106"></a>    }</span>
<span id="cb1-107"><a href="#cb1-107"></a>  }</span>
<span id="cb1-108"><a href="#cb1-108"></a>}</span>
<span id="cb1-109"><a href="#cb1-109"></a></span>
<span id="cb1-110"><a href="#cb1-110"></a><span class="co"># animation ####</span></span>
<span id="cb1-111"><a href="#cb1-111"></a><span class="kw">library</span>(gifski)</span>
<span id="cb1-112"><a href="#cb1-112"></a>u_ &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="dv">0</span>, <span class="dv">3</span>, <span class="dt">length.out =</span> 181L)[<span class="op">-</span>1L]</span>
<span id="cb1-113"><a href="#cb1-113"></a><span class="kw">save_gif</span>({</span>
<span id="cb1-114"><a href="#cb1-114"></a>  <span class="cf">for</span>(u <span class="cf">in</span> u_){</span>
<span id="cb1-115"><a href="#cb1-115"></a>    <span class="kw">fplot</span>(u)</span>
<span id="cb1-116"><a href="#cb1-116"></a>  }</span>
<span id="cb1-117"><a href="#cb1-117"></a>}, <span class="st">&quot;ModularTessellation.gif&quot;</span>, <span class="dv">512</span>, <span class="dv">512</span>, <span class="dt">delay =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">12</span>, <span class="dt">res =</span> <span class="dv">144</span>)</span></code></pre></div>
<p><img src="./figures/ModularTessellationOrbit.gif" /></p>

        </div>


        <div id="footer">
          Site proudly generated by
          <a href="http://jaspervdj.be/hakyll">Hakyll</a>
        </div>

      </div>

    </div>

    <div class="row">
      <div class="col-sm-12">
        <div id="disqus_thread"></div>
        <div class="pagination">
          <ul>
            <li>
              <a href="http://laustep.github.io/stlahblog/">&#171; Back Home</a>
            </li>
          </ul>
        </div>
      </div>
    </div>
    
  </div>

</body>

<script src="/libraries/bootstrap/bootstrap.min.js"></script>
<script>
  var disqus_developer = 1;
  var disqus_shortname = 'stlapblog';
  // required: replace example with your forum shortname
  /* * * DON'T EDIT BELOW THIS LINE * * */
  (function () {
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = 'https://' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] ||
      document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>
<noscript>Please enable JavaScript to view the
  <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a>
</noscript>
<!-- MathJax: Fall back to local if CDN offline but local image fonts are not supported (saves >100MB) -->
<script type="text/x-mathjax-config" src="/libraries/mathjax/config/TeX-MML-AM_CHTML.js"></script>
<!-- <script>
  window.MathJax || document.write('<script type="text/x-mathjax-config">MathJax.Hub.Config({"HTML-CSS":{imageFont:null}});<\/script><script src="../libraries/mathjax/MathJax.js"><\/script>');
</script> -->


</html>]]></description>
    <pubDate>Wed, 19 Feb 2020 00:00:00 UT</pubDate>
    <guid>https://laustep.github.io/stlahblog/posts/ModularTessellationOrbit.html</guid>
    <dc:creator>Stéphane Laurent</dc:creator>
    <category>R</category>
</item>


<item>
    <title>Tooltips for the headers of a datatable in Shiny</title>
    <link>https://laustep.github.io/stlahblog/posts/DTqTips.html</link>
    <description><![CDATA[<!DOCTYPE HTML>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Saturn Elephant - Tooltips for the headers of a datatable in Shiny</title>
  <link href="/libraries/bootstrap/bootstrap-grid.min.css" rel="stylesheet">
  <link rel="stylesheet" href="/css/default2.css" />
  <link rel="stylesheet" href="/css/post.css" />
  <link rel="stylesheet" href="/css/misc.css" /> 
  
    <link rel="stylesheet" href="/css/pandoc-solarized.css" /> 
   
  
  <link href="https://fonts.googleapis.com/css?family=Raleway:400,600,200,800" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/css?family=Droid+Sans" rel="stylesheet" type="text/css">
  <script src="/libraries/jquery.min.js"></script>
  <script type="text/javascript" async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML"></script>
</head>

<body>
  <div class="container-fluid">
    <div class="row">
      <!-- Sidebar. -->
      <div class="sidebar col-sm-2">
        <div class="row">
          <div class="col-sm-12" style="float:right;clear:both;margin-right:50px;margin-top:50px;">
            <a href="https://www.r-bloggers.com/">
              <img src="/images/Rbloggers.png" alt="Rbloggers" width="100%" />
            </a>
            <br/>
            <a href="http://t-redactyl.io/">
              <span style="color:black;font-weight:bold;font-family:sans-serif;font-size:25px;">Standard error</span>
            </a>
            <a href="http://timelyportfolio.blogspot.be/">
              <span style="color:grey;font-weight:bold;font-family:sans-serif;font-size:24px;">Timely portfolio</span>
            </a>
            <br/>
            <a href="https://antoineguillot.wordpress.com/blog/">
              <span style="color:white;background-color:darkblue;font-weight:bold;font-family:sans-serif;font-size:21px;border:5px solid;border-color:darkblue">ENHANCE DATA</span>
            </a>
            <br/>
            <a href="https://fronkonstin.com/">
              <span style="color:black;background-color:gold;font-weight:bold;font-size:29px;border:3px solid;border-color:gold;">Fronkonstin</span>
            </a>
          </div>
        </div>
        <div id="logos">
          <div class="row">
            <div class="col-sm-4">
              <img src="/images/AsymptoteLogo.svg" style="width: 150%; transform: rotateZ(-35deg)"/>
            </div>
            <div class="col-sm-4">
              <img src="/images/Rlogo.svg" style="width: 110%;"/>
            </div>
            <div class="col-sm-4">
              <img src="/images/shiny-hex.png" style="width: 90%;"/>
            </div>
          </div>
          <div class="row">
            <div class="col-sm-4">
              <img src="/images/Povray_logo_sphere.png" style="width: 105%;"/>
            </div>
            <div class="col-sm-4">
              <img src="/images/javascript.svg" style="width: 90%;"/>
            </div>
            <div class="col-sm-4">
              <img src="/images/haskell.svg" style="width: 110%;"/>
            </div>
          </div>
        </div>
      </div>

      <div class="main col-sm-10">
        <div id="header">
          <div id="logo">
            <a href="/">
              <img src="/images/stla.jpg" alt="stla" width="100px" />
            </a>
          </div>
          <div id="navigation" style="margin-top:50px;">
            <a href="/">Home</a>
            <a href="/about.html">About</a>
            <a href="/contact.html">Contact</a>
            <a href="/archive.html">Archive</a>
          </div>
        </div>

        <div class="content">
          <h1>Tooltips for the headers of a datatable in Shiny</h1> 
          <div class="info">
    Posted on February 16, 2020
    
        by Stéphane Laurent
    
</div>
<div class="info">
    
    Tags: <a title="All pages tagged &#39;R&#39;." href="/tags/R.html">R</a>, <a title="All pages tagged &#39;datatables&#39;." href="/tags/datatables.html">datatables</a>, <a title="All pages tagged &#39;javascript&#39;." href="/tags/javascript.html">javascript</a>, <a title="All pages tagged &#39;shiny&#39;." href="/tags/shiny.html">shiny</a>
    
</div>

<p>In this post, I show how to use the <a href="http://qtip2.com/">qTip2</a> JavaScript library to create some tooltips on the headers of a <code>DT</code> datatable in Shiny, displaying some information about the columns, such as summary statistics.</p>
<p>Firstly, we write a function returning some JavaScript code that creates some hidden <code>div</code> elements which will contain the contents of the tooltips. This function takes two arguments: <code>n</code>, the number of <code>div</code> elements to create (this will be the number of columns of the table), and <code>prefixID</code>; the i-th <code>div</code> will have the identifier <code>{prefixID}-{i}</code>. We also set a class to each <code>div</code>, namely <code>qtip-big</code>.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a>createDiv &lt;-<span class="st"> </span><span class="cf">function</span>(n, prefixID){</span>
<span id="cb1-2"><a href="#cb1-2"></a>  <span class="kw">sprintf</span>(<span class="kw">paste</span>(</span>
<span id="cb1-3"><a href="#cb1-3"></a>    <span class="st">&quot;for(var i = 1; i &lt;= %d; i++){&quot;</span>,</span>
<span id="cb1-4"><a href="#cb1-4"></a>    <span class="st">&quot;  var div;&quot;</span>,</span>
<span id="cb1-5"><a href="#cb1-5"></a>    <span class="kw">sprintf</span>(<span class="st">&quot;  var id = &#39;%s-&#39; + i.toString();&quot;</span>, prefixID),</span>
<span id="cb1-6"><a href="#cb1-6"></a>    <span class="st">&quot;  if(document.getElementById(id) === null){&quot;</span>,</span>
<span id="cb1-7"><a href="#cb1-7"></a>    <span class="st">&quot;    div = document.createElement(&#39;div&#39;);&quot;</span>,</span>
<span id="cb1-8"><a href="#cb1-8"></a>    <span class="st">&quot;    div.setAttribute(&#39;id&#39;, id);&quot;</span>,</span>
<span id="cb1-9"><a href="#cb1-9"></a>    <span class="st">&quot;    div.setAttribute(&#39;class&#39;, &#39;qtip-big&#39;);&quot;</span>,</span>
<span id="cb1-10"><a href="#cb1-10"></a>    <span class="st">&quot;    div.style.display = &#39;none&#39;;&quot;</span>,</span>
<span id="cb1-11"><a href="#cb1-11"></a>    <span class="st">&quot;    document.body.appendChild(div);&quot;</span>,</span>
<span id="cb1-12"><a href="#cb1-12"></a>    <span class="st">&quot;  }&quot;</span>,</span>
<span id="cb1-13"><a href="#cb1-13"></a>    <span class="st">&quot;}&quot;</span>,</span>
<span id="cb1-14"><a href="#cb1-14"></a>    <span class="dt">sep =</span> <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span></span>
<span id="cb1-15"><a href="#cb1-15"></a>  ), n)</span>
<span id="cb1-16"><a href="#cb1-16"></a>}</span></code></pre></div>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true"></a><span class="kw">cat</span>(<span class="kw">createDiv</span>(<span class="dv">3</span>, <span class="st">&quot;TOOLTIP&quot;</span>))</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true"></a><span class="co">## for(var i = 1; i &lt;= 3; i++){</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true"></a><span class="co">##   var div;</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true"></a><span class="co">##   var id = &#39;TOOLTIP-&#39; + i.toString();</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true"></a><span class="co">##   if(document.getElementById(id) === null){</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true"></a><span class="co">##     div = document.createElement(&#39;div&#39;);</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true"></a><span class="co">##     div.setAttribute(&#39;id&#39;, id);</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true"></a><span class="co">##     div.setAttribute(&#39;class&#39;, &#39;qtip-big&#39;);</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true"></a><span class="co">##     div.style.display = &#39;none&#39;;</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true"></a><span class="co">##     document.body.appendChild(div);</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true"></a><span class="co">##   }</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true"></a><span class="co">## }</span></span></code></pre></div>
<p>Now we write a function returning some JavaScript code that writes the contents of the <code>div</code> elements. It takes as arguments <code>dat</code>, the dataframe for the table, <code>i</code>, the index of a column of <code>dat</code>, and <code>prefixID</code> as in the function <code>createDiv</code>. If the <code>i</code>-th column is numeric, we fill the <code>div</code> element with some summary statistics of this column, otherwise the information we provide in the <code>div</code> element is the number of levels of the contents of the column, an enumeration of the levels (at most three), and the number of missing values.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a>fillDiv &lt;-<span class="st"> </span><span class="cf">function</span>(dat, i, prefixID){</span>
<span id="cb3-2"><a href="#cb3-2"></a>  x &lt;-<span class="st"> </span>dat[[i]]</span>
<span id="cb3-3"><a href="#cb3-3"></a>  <span class="cf">if</span>(<span class="kw">is.numeric</span>(x)){</span>
<span id="cb3-4"><a href="#cb3-4"></a>    <span class="kw">sprintf</span>(<span class="kw">paste</span>(</span>
<span id="cb3-5"><a href="#cb3-5"></a>      <span class="st">&quot;var div = document.getElementById(&#39;%s-%d&#39;);&quot;</span>,</span>
<span id="cb3-6"><a href="#cb3-6"></a>      <span class="st">&quot;var html = &#39;&lt;b&gt; Min: &lt;/b&gt; %s&lt;/br&gt;&#39;;&quot;</span>,</span>
<span id="cb3-7"><a href="#cb3-7"></a>      <span class="st">&quot;html = html + &#39;&lt;b&gt; Max: &lt;/b&gt; %s&lt;/br&gt;&#39;;&quot;</span>,</span>
<span id="cb3-8"><a href="#cb3-8"></a>      <span class="st">&quot;html = html + &#39;&lt;b&gt; Mean: &lt;/b&gt; %s&lt;/br&gt;&#39;;&quot;</span>,</span>
<span id="cb3-9"><a href="#cb3-9"></a>      <span class="st">&quot;html = html + &#39;&lt;b&gt; Std. dev.: &lt;/b&gt; %s&lt;/br&gt;&#39;;&quot;</span>,</span>
<span id="cb3-10"><a href="#cb3-10"></a>      <span class="st">&quot;html = html + &#39;&lt;b&gt; Missing values: &lt;/b&gt; %d&#39;;&quot;</span>,</span>
<span id="cb3-11"><a href="#cb3-11"></a>      <span class="st">&quot;div.innerHTML = html;&quot;</span>,</span>
<span id="cb3-12"><a href="#cb3-12"></a>      <span class="dt">sep =</span> <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span></span>
<span id="cb3-13"><a href="#cb3-13"></a>    ), </span>
<span id="cb3-14"><a href="#cb3-14"></a>    prefixID,</span>
<span id="cb3-15"><a href="#cb3-15"></a>    i, </span>
<span id="cb3-16"><a href="#cb3-16"></a>    <span class="kw">formatC</span>(<span class="kw">min</span>(x, <span class="dt">na.rm=</span><span class="ot">TRUE</span>)),</span>
<span id="cb3-17"><a href="#cb3-17"></a>    <span class="kw">formatC</span>(<span class="kw">max</span>(x, <span class="dt">na.rm=</span><span class="ot">TRUE</span>)),</span>
<span id="cb3-18"><a href="#cb3-18"></a>    <span class="kw">formatC</span>(<span class="kw">mean</span>(x, <span class="dt">na.rm=</span><span class="ot">TRUE</span>)),</span>
<span id="cb3-19"><a href="#cb3-19"></a>    <span class="kw">formatC</span>(<span class="kw">sd</span>(x, <span class="dt">na.rm=</span><span class="ot">TRUE</span>)),</span>
<span id="cb3-20"><a href="#cb3-20"></a>    <span class="kw">sum</span>(<span class="kw">is.na</span>(x)))</span>
<span id="cb3-21"><a href="#cb3-21"></a>  }<span class="cf">else</span>{</span>
<span id="cb3-22"><a href="#cb3-22"></a>    <span class="cf">if</span>(<span class="kw">is.factor</span>(x)) x &lt;-<span class="st"> </span><span class="kw">as.character</span>(x)</span>
<span id="cb3-23"><a href="#cb3-23"></a>    levels0 &lt;-<span class="st"> </span><span class="kw">sort</span>(<span class="kw">unique</span>(<span class="kw">na.omit</span>(x)))</span>
<span id="cb3-24"><a href="#cb3-24"></a>    nlevels &lt;-<span class="st"> </span><span class="kw">length</span>(levels0)</span>
<span id="cb3-25"><a href="#cb3-25"></a>    levels &lt;-<span class="st"> </span></span>
<span id="cb3-26"><a href="#cb3-26"></a><span class="st">      </span><span class="cf">if</span>(nlevels<span class="op">&gt;</span><span class="dv">3</span>) <span class="kw">c</span>(levels0[<span class="dv">1</span><span class="op">:</span><span class="dv">2</span>], levels0[nlevels]) <span class="cf">else</span> levels0</span>
<span id="cb3-27"><a href="#cb3-27"></a>    ncharMax &lt;-<span class="st"> </span><span class="dv">25</span></span>
<span id="cb3-28"><a href="#cb3-28"></a>    nchars &lt;-<span class="st"> </span><span class="kw">nchar</span>(levels)</span>
<span id="cb3-29"><a href="#cb3-29"></a>    <span class="cf">if</span>(<span class="dv">7</span><span class="op">+</span><span class="kw">sum</span>(nchars) <span class="op">&gt;</span><span class="st"> </span>ncharMax){</span>
<span id="cb3-30"><a href="#cb3-30"></a>      levels[<span class="dv">1</span>] &lt;-<span class="st"> </span><span class="kw">paste0</span>(<span class="st">&quot;&lt;br/&gt;&quot;</span>, levels[<span class="dv">1</span>])</span>
<span id="cb3-31"><a href="#cb3-31"></a>      <span class="cf">if</span>(nlevels <span class="op">&gt;=</span><span class="st"> </span><span class="dv">2</span> <span class="op">&amp;&amp;</span><span class="st"> </span><span class="kw">sum</span>(nchars) <span class="op">&gt;</span><span class="st"> </span>ncharMax){</span>
<span id="cb3-32"><a href="#cb3-32"></a>        levels[<span class="dv">2</span>] &lt;-<span class="st"> </span><span class="kw">paste0</span>(<span class="st">&quot;&lt;br/&gt;&quot;</span>, levels[<span class="dv">2</span>])</span>
<span id="cb3-33"><a href="#cb3-33"></a>        <span class="cf">if</span>(nlevels <span class="op">&gt;=</span><span class="st"> </span><span class="dv">3</span> <span class="op">&amp;&amp;</span><span class="st"> </span><span class="kw">sum</span>(nchars[<span class="dv">2</span><span class="op">:</span><span class="dv">3</span>]) <span class="op">&gt;</span><span class="st"> </span>ncharMax){</span>
<span id="cb3-34"><a href="#cb3-34"></a>          levels[<span class="dv">3</span>] &lt;-<span class="st"> </span><span class="kw">paste0</span>(<span class="st">&quot;&lt;br/&gt;&quot;</span>, levels[<span class="dv">3</span>])</span>
<span id="cb3-35"><a href="#cb3-35"></a>        }</span>
<span id="cb3-36"><a href="#cb3-36"></a>      }</span>
<span id="cb3-37"><a href="#cb3-37"></a>    }</span>
<span id="cb3-38"><a href="#cb3-38"></a>    levelsSummary &lt;-<span class="st"> </span><span class="kw">ifelse</span>(nlevels <span class="op">&gt;</span><span class="st"> </span><span class="dv">3</span>,</span>
<span id="cb3-39"><a href="#cb3-39"></a>                            <span class="kw">paste0</span>(<span class="kw">c</span>(levels[<span class="dv">1</span>],</span>
<span id="cb3-40"><a href="#cb3-40"></a>                                     <span class="kw">paste0</span>(levels[<span class="dv">2</span>], <span class="st">&quot;, ...&quot;</span>),</span>
<span id="cb3-41"><a href="#cb3-41"></a>                                     levels[<span class="dv">3</span>]),</span>
<span id="cb3-42"><a href="#cb3-42"></a>                                   <span class="dt">collapse =</span> <span class="st">&quot;, &quot;</span>),</span>
<span id="cb3-43"><a href="#cb3-43"></a>                            <span class="kw">paste0</span>(levels, <span class="dt">collapse =</span> <span class="st">&quot;, &quot;</span>))</span>
<span id="cb3-44"><a href="#cb3-44"></a>    <span class="kw">sprintf</span>(<span class="kw">paste</span>(</span>
<span id="cb3-45"><a href="#cb3-45"></a>      <span class="st">&quot;var div = document.getElementById(&#39;%s-%d&#39;);&quot;</span>,</span>
<span id="cb3-46"><a href="#cb3-46"></a>      <span class="st">&quot;var html = &#39;&lt;b&gt; Number of levels: &lt;/b&gt; %d&lt;/br&gt;&#39;;&quot;</span>,</span>
<span id="cb3-47"><a href="#cb3-47"></a>      <span class="kw">sprintf</span>(<span class="st">&quot;html = html + &#39;&lt;b&gt; Level%s: &lt;/b&gt; %%s&lt;/br&gt;&#39;&quot;</span>, </span>
<span id="cb3-48"><a href="#cb3-48"></a>              <span class="kw">ifelse</span>(nlevels<span class="op">==</span><span class="dv">1</span>, <span class="st">&quot;&quot;</span>, <span class="st">&quot;s&quot;</span>)),</span>
<span id="cb3-49"><a href="#cb3-49"></a>      <span class="st">&quot;html = html + &#39;&lt;b&gt; Missing values: &lt;/b&gt; %d&#39;&quot;</span>,</span>
<span id="cb3-50"><a href="#cb3-50"></a>      <span class="st">&quot;div.innerHTML = html;&quot;</span>,</span>
<span id="cb3-51"><a href="#cb3-51"></a>      <span class="dt">sep =</span> <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span></span>
<span id="cb3-52"><a href="#cb3-52"></a>    ),</span>
<span id="cb3-53"><a href="#cb3-53"></a>    prefixID,</span>
<span id="cb3-54"><a href="#cb3-54"></a>    i, </span>
<span id="cb3-55"><a href="#cb3-55"></a>    nlevels,</span>
<span id="cb3-56"><a href="#cb3-56"></a>    levelsSummary,</span>
<span id="cb3-57"><a href="#cb3-57"></a>    <span class="kw">sum</span>(<span class="kw">is.na</span>(x)))</span>
<span id="cb3-58"><a href="#cb3-58"></a>  }</span>
<span id="cb3-59"><a href="#cb3-59"></a>}</span></code></pre></div>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true"></a><span class="kw">cat</span>(<span class="kw">fillDiv</span>(iris, <span class="dv">1</span>, <span class="st">&quot;TOOLTIP&quot;</span>))</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true"></a><span class="co">## var div = document.getElementById(&#39;TOOLTIP-1&#39;);</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true"></a><span class="co">## var html = &#39;&lt;b&gt; Min: &lt;/b&gt; 4.3&lt;/br&gt;&#39;;</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true"></a><span class="co">## html = html + &#39;&lt;b&gt; Max: &lt;/b&gt; 7.9&lt;/br&gt;&#39;;</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true"></a><span class="co">## html = html + &#39;&lt;b&gt; Mean: &lt;/b&gt; 5.843&lt;/br&gt;&#39;;</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true"></a><span class="co">## html = html + &#39;&lt;b&gt; Std. dev.: &lt;/b&gt; 0.8281&lt;/br&gt;&#39;;</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true"></a><span class="co">## html = html + &#39;&lt;b&gt; Missing values: &lt;/b&gt; 0&#39;;</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true"></a><span class="co">## div.innerHTML = html;</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true"></a><span class="kw">cat</span>(<span class="kw">fillDiv</span>(iris, <span class="dv">5</span>, <span class="st">&quot;TOOLTIP&quot;</span>))</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true"></a><span class="co">## var div = document.getElementById(&#39;TOOLTIP-5&#39;);</span></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true"></a><span class="co">## var html = &#39;&lt;b&gt; Number of levels: &lt;/b&gt; 3&lt;/br&gt;&#39;;</span></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true"></a><span class="co">## html = html + &#39;&lt;b&gt; Levels: &lt;/b&gt; &lt;br/&gt;setosa, versicolor, virginica&lt;/br&gt;&#39;</span></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true"></a><span class="co">## html = html + &#39;&lt;b&gt; Missing values: &lt;/b&gt; 0&#39;</span></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true"></a><span class="co">## div.innerHTML = html;</span></span></code></pre></div>
<p>Finally we write a function returning the JavaScript code of the <code>qTip</code> tooltips. Its arguments are <code>n</code>, the number of columns of the table, and <code>prefixID</code> as before.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1"></a>tooltips &lt;-<span class="st"> </span><span class="cf">function</span>(n, prefixID){</span>
<span id="cb5-2"><a href="#cb5-2"></a>  settings &lt;-<span class="st"> </span><span class="kw">sprintf</span>(<span class="kw">paste</span>(</span>
<span id="cb5-3"><a href="#cb5-3"></a>    <span class="st">&quot;{&quot;</span>,</span>
<span id="cb5-4"><a href="#cb5-4"></a>    <span class="st">&quot;  overwrite: true,&quot;</span>,</span>
<span id="cb5-5"><a href="#cb5-5"></a>    <span class="st">&quot;  content: {&quot;</span>,</span>
<span id="cb5-6"><a href="#cb5-6"></a>    <span class="kw">sprintf</span>(<span class="st">&quot;    text: $(&#39;#%s-%%s&#39;).clone()&quot;</span>, prefixID),</span>
<span id="cb5-7"><a href="#cb5-7"></a>    <span class="st">&quot;  },&quot;</span>,</span>
<span id="cb5-8"><a href="#cb5-8"></a>    <span class="st">&quot;  show: {&quot;</span>,</span>
<span id="cb5-9"><a href="#cb5-9"></a>    <span class="st">&quot;    ready: false&quot;</span>,</span>
<span id="cb5-10"><a href="#cb5-10"></a>    <span class="st">&quot;  },&quot;</span>,</span>
<span id="cb5-11"><a href="#cb5-11"></a>    <span class="st">&quot;  position: {&quot;</span>,</span>
<span id="cb5-12"><a href="#cb5-12"></a>    <span class="st">&quot;    my: &#39;bottom %%s&#39;,&quot;</span>,</span>
<span id="cb5-13"><a href="#cb5-13"></a>    <span class="st">&quot;    at: &#39;top center&#39;&quot;</span>,</span>
<span id="cb5-14"><a href="#cb5-14"></a>    <span class="st">&quot;  },&quot;</span>,</span>
<span id="cb5-15"><a href="#cb5-15"></a>    <span class="st">&quot;  style: {&quot;</span>,</span>
<span id="cb5-16"><a href="#cb5-16"></a>    <span class="st">&quot;    classes: &#39;qtip-youtube&#39;&quot;</span>,</span>
<span id="cb5-17"><a href="#cb5-17"></a>    <span class="st">&quot;  }&quot;</span>,</span>
<span id="cb5-18"><a href="#cb5-18"></a>    <span class="st">&quot;}&quot;</span>,</span>
<span id="cb5-19"><a href="#cb5-19"></a>    <span class="dt">sep =</span> <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span></span>
<span id="cb5-20"><a href="#cb5-20"></a>  ), <span class="dv">1</span><span class="op">:</span>n)</span>
<span id="cb5-21"><a href="#cb5-21"></a>  settings &lt;-<span class="st"> </span><span class="kw">sprintf</span>(settings, <span class="kw">ifelse</span>(<span class="dv">1</span><span class="op">:</span>n <span class="op">&gt;</span><span class="st"> </span>n<span class="op">/</span><span class="dv">2</span>, <span class="st">&quot;right&quot;</span>, <span class="st">&quot;left&quot;</span>))</span>
<span id="cb5-22"><a href="#cb5-22"></a>  <span class="kw">sprintf</span>(<span class="st">&quot;var tooltips = [%s];&quot;</span>, <span class="kw">paste0</span>(settings, <span class="dt">collapse=</span><span class="st">&quot;,&quot;</span>))</span>
<span id="cb5-23"><a href="#cb5-23"></a>}</span></code></pre></div>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true"></a><span class="kw">cat</span>(<span class="kw">tooltips</span>(<span class="dv">2</span>, <span class="st">&quot;TOOLTIP&quot;</span>))</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true"></a><span class="co">## var tooltips = [{</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true"></a><span class="co">##   overwrite: true,</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true"></a><span class="co">##   content: {</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true"></a><span class="co">##     text: $(&#39;#TOOLTIP-1&#39;).clone()</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true"></a><span class="co">##   },</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true"></a><span class="co">##   show: {</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true"></a><span class="co">##     ready: false</span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true"></a><span class="co">##   },</span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true"></a><span class="co">##   position: {</span></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true"></a><span class="co">##     my: &#39;bottom left&#39;,</span></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true"></a><span class="co">##     at: &#39;top center&#39;</span></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true"></a><span class="co">##   },</span></span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true"></a><span class="co">##   style: {</span></span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true"></a><span class="co">##     classes: &#39;qtip-youtube&#39;</span></span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true"></a><span class="co">##   }</span></span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true"></a><span class="co">## },{</span></span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true"></a><span class="co">##   overwrite: true,</span></span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true"></a><span class="co">##   content: {</span></span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true"></a><span class="co">##     text: $(&#39;#TOOLTIP-2&#39;).clone()</span></span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true"></a><span class="co">##   },</span></span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true"></a><span class="co">##   show: {</span></span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true"></a><span class="co">##     ready: false</span></span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true"></a><span class="co">##   },</span></span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true"></a><span class="co">##   position: {</span></span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true"></a><span class="co">##     my: &#39;bottom right&#39;,</span></span>
<span id="cb6-27"><a href="#cb6-27" aria-hidden="true"></a><span class="co">##     at: &#39;top center&#39;</span></span>
<span id="cb6-28"><a href="#cb6-28" aria-hidden="true"></a><span class="co">##   },</span></span>
<span id="cb6-29"><a href="#cb6-29" aria-hidden="true"></a><span class="co">##   style: {</span></span>
<span id="cb6-30"><a href="#cb6-30" aria-hidden="true"></a><span class="co">##     classes: &#39;qtip-youtube&#39;</span></span>
<span id="cb6-31"><a href="#cb6-31" aria-hidden="true"></a><span class="co">##   }</span></span>
<span id="cb6-32"><a href="#cb6-32" aria-hidden="true"></a><span class="co">## }];</span></span></code></pre></div>
<p>Now we are ready to write the Shiny app. Put the files <strong>jquery.qtip.min.css</strong> and <strong>jquery.qtip.min.js</strong> in the <strong>www</strong> subfolder. We use the <code>shinyjs</code> package to run the JavaScript code with the function <code>runjs</code>.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1"></a><span class="kw">library</span>(shiny)</span>
<span id="cb7-2"><a href="#cb7-2"></a><span class="kw">library</span>(shinyjs)</span>
<span id="cb7-3"><a href="#cb7-3"></a><span class="kw">library</span>(DT)</span>
<span id="cb7-4"><a href="#cb7-4"></a></span>
<span id="cb7-5"><a href="#cb7-5"></a>CSS &lt;-<span class="st"> &quot;</span></span>
<span id="cb7-6"><a href="#cb7-6"></a><span class="st">.qtip-big { </span></span>
<span id="cb7-7"><a href="#cb7-7"></a><span class="st">  font-size: 15px;</span></span>
<span id="cb7-8"><a href="#cb7-8"></a><span class="st">  line-height: 18px;</span></span>
<span id="cb7-9"><a href="#cb7-9"></a><span class="st">  white-space: nowrap;</span></span>
<span id="cb7-10"><a href="#cb7-10"></a><span class="st">  word-spacing: 1px;</span></span>
<span id="cb7-11"><a href="#cb7-11"></a><span class="st">}</span></span>
<span id="cb7-12"><a href="#cb7-12"></a><span class="st">&quot;</span></span>
<span id="cb7-13"><a href="#cb7-13"></a></span>
<span id="cb7-14"><a href="#cb7-14"></a>ui &lt;-<span class="st"> </span><span class="kw">fluidPage</span>(</span>
<span id="cb7-15"><a href="#cb7-15"></a>  tags<span class="op">$</span><span class="kw">head</span>(</span>
<span id="cb7-16"><a href="#cb7-16"></a>    tags<span class="op">$</span><span class="kw">link</span>(<span class="dt">rel =</span> <span class="st">&quot;stylesheet&quot;</span>, <span class="dt">href =</span> <span class="st">&quot;jquery.qtip.min.css&quot;</span>),</span>
<span id="cb7-17"><a href="#cb7-17"></a>    tags<span class="op">$</span><span class="kw">script</span>(<span class="dt">src =</span> <span class="st">&quot;jquery.qtip.min.js&quot;</span>),</span>
<span id="cb7-18"><a href="#cb7-18"></a>    tags<span class="op">$</span><span class="kw">style</span>(CSS)</span>
<span id="cb7-19"><a href="#cb7-19"></a>  ),</span>
<span id="cb7-20"><a href="#cb7-20"></a>  <span class="kw">useShinyjs</span>(),</span>
<span id="cb7-21"><a href="#cb7-21"></a>  <span class="kw">br</span>(), <span class="kw">br</span>(), <span class="kw">br</span>(), <span class="kw">br</span>(), <span class="kw">br</span>(), </span>
<span id="cb7-22"><a href="#cb7-22"></a>  <span class="kw">DTOutput</span>(<span class="st">&quot;dtable&quot;</span>)</span>
<span id="cb7-23"><a href="#cb7-23"></a>)</span>
<span id="cb7-24"><a href="#cb7-24"></a></span>
<span id="cb7-25"><a href="#cb7-25"></a>server &lt;-<span class="st"> </span><span class="cf">function</span>(input, output, session){</span>
<span id="cb7-26"><a href="#cb7-26"></a>  </span>
<span id="cb7-27"><a href="#cb7-27"></a>  output[[<span class="st">&quot;dtable&quot;</span>]] &lt;-<span class="st"> </span><span class="kw">renderDT</span>({</span>
<span id="cb7-28"><a href="#cb7-28"></a>    </span>
<span id="cb7-29"><a href="#cb7-29"></a>    dat &lt;-<span class="st"> </span>iris</span>
<span id="cb7-30"><a href="#cb7-30"></a>    </span>
<span id="cb7-31"><a href="#cb7-31"></a>    <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="kw">ncol</span>(dat)){</span>
<span id="cb7-32"><a href="#cb7-32"></a>      <span class="kw">runjs</span>(<span class="kw">createDiv</span>(i, <span class="st">&quot;TOOLTIP&quot;</span>))</span>
<span id="cb7-33"><a href="#cb7-33"></a>      <span class="kw">runjs</span>(<span class="kw">fillDiv</span>(dat, i, <span class="st">&quot;TOOLTIP&quot;</span>))</span>
<span id="cb7-34"><a href="#cb7-34"></a>    }</span>
<span id="cb7-35"><a href="#cb7-35"></a>    </span>
<span id="cb7-36"><a href="#cb7-36"></a>    headerCallback &lt;-<span class="st"> </span><span class="kw">c</span>(</span>
<span id="cb7-37"><a href="#cb7-37"></a>      <span class="st">&quot;function(thead, data, start, end, display){&quot;</span>,</span>
<span id="cb7-38"><a href="#cb7-38"></a>      <span class="st">&quot;  var ncols = data[0].length;&quot;</span>,</span>
<span id="cb7-39"><a href="#cb7-39"></a>      <span class="kw">tooltips</span>(<span class="kw">ncol</span>(dat), <span class="st">&quot;TOOLTIP&quot;</span>),</span>
<span id="cb7-40"><a href="#cb7-40"></a>      <span class="st">&quot;  for(var i = 1; i &lt; ncols; i++){&quot;</span>,</span>
<span id="cb7-41"><a href="#cb7-41"></a>      <span class="st">&quot;    $(&#39;th:eq(&#39; + i + &#39;)&#39;, thead).qtip(tooltips[i-1]);&quot;</span>, </span>
<span id="cb7-42"><a href="#cb7-42"></a>      <span class="st">&quot;  }&quot;</span>,</span>
<span id="cb7-43"><a href="#cb7-43"></a>      <span class="st">&quot;}&quot;</span></span>
<span id="cb7-44"><a href="#cb7-44"></a>    )</span>
<span id="cb7-45"><a href="#cb7-45"></a>    </span>
<span id="cb7-46"><a href="#cb7-46"></a>    <span class="kw">datatable</span>(</span>
<span id="cb7-47"><a href="#cb7-47"></a>      dat, </span>
<span id="cb7-48"><a href="#cb7-48"></a>      <span class="dt">options =</span> <span class="kw">list</span>(</span>
<span id="cb7-49"><a href="#cb7-49"></a>        <span class="dt">headerCallback =</span> <span class="kw">JS</span>(headerCallback),</span>
<span id="cb7-50"><a href="#cb7-50"></a>        <span class="dt">columnDefs =</span> <span class="kw">list</span>(</span>
<span id="cb7-51"><a href="#cb7-51"></a>          <span class="kw">list</span>(<span class="dt">className =</span> <span class="st">&quot;dt-center&quot;</span>, <span class="dt">targets =</span> <span class="st">&quot;_all&quot;</span>)</span>
<span id="cb7-52"><a href="#cb7-52"></a>        )</span>
<span id="cb7-53"><a href="#cb7-53"></a>      )</span>
<span id="cb7-54"><a href="#cb7-54"></a>    )</span>
<span id="cb7-55"><a href="#cb7-55"></a>  })</span>
<span id="cb7-56"><a href="#cb7-56"></a>  </span>
<span id="cb7-57"><a href="#cb7-57"></a>}</span>
<span id="cb7-58"><a href="#cb7-58"></a></span>
<span id="cb7-59"><a href="#cb7-59"></a><span class="kw">shinyApp</span>(ui, server)</span></code></pre></div>
<p><img src="./figures/DTqTip.gif" /></p>

        </div>


        <div id="footer">
          Site proudly generated by
          <a href="http://jaspervdj.be/hakyll">Hakyll</a>
        </div>

      </div>

    </div>

    <div class="row">
      <div class="col-sm-12">
        <div id="disqus_thread"></div>
        <div class="pagination">
          <ul>
            <li>
              <a href="http://laustep.github.io/stlahblog/">&#171; Back Home</a>
            </li>
          </ul>
        </div>
      </div>
    </div>
    
  </div>

</body>

<script src="/libraries/bootstrap/bootstrap.min.js"></script>
<script>
  var disqus_developer = 1;
  var disqus_shortname = 'stlapblog';
  // required: replace example with your forum shortname
  /* * * DON'T EDIT BELOW THIS LINE * * */
  (function () {
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = 'https://' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] ||
      document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>
<noscript>Please enable JavaScript to view the
  <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a>
</noscript>
<!-- MathJax: Fall back to local if CDN offline but local image fonts are not supported (saves >100MB) -->
<script type="text/x-mathjax-config" src="/libraries/mathjax/config/TeX-MML-AM_CHTML.js"></script>
<!-- <script>
  window.MathJax || document.write('<script type="text/x-mathjax-config">MathJax.Hub.Config({"HTML-CSS":{imageFont:null}});<\/script><script src="../libraries/mathjax/MathJax.js"><\/script>');
</script> -->


</html>]]></description>
    <pubDate>Sun, 16 Feb 2020 00:00:00 UT</pubDate>
    <guid>https://laustep.github.io/stlahblog/posts/DTqTips.html</guid>
    <dc:creator>Stéphane Laurent</dc:creator>
    <category>R</category>
</item>


<item>
    <title>Drawing a stereographic duoprism</title>
    <link>https://laustep.github.io/stlahblog/posts/DuoprismStereo.html</link>
    <description><![CDATA[<!DOCTYPE HTML>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Saturn Elephant - Drawing a stereographic duoprism</title>
  <link href="/libraries/bootstrap/bootstrap-grid.min.css" rel="stylesheet">
  <link rel="stylesheet" href="/css/default2.css" />
  <link rel="stylesheet" href="/css/post.css" />
  <link rel="stylesheet" href="/css/misc.css" /> 
  
    <link rel="stylesheet" href="/css/pandoc-solarized.css" /> 
   
  
  <link href="https://fonts.googleapis.com/css?family=Raleway:400,600,200,800" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/css?family=Droid+Sans" rel="stylesheet" type="text/css">
  <script src="/libraries/jquery.min.js"></script>
  <script type="text/javascript" async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML"></script>
</head>

<body>
  <div class="container-fluid">
    <div class="row">
      <!-- Sidebar. -->
      <div class="sidebar col-sm-2">
        <div class="row">
          <div class="col-sm-12" style="float:right;clear:both;margin-right:50px;margin-top:50px;">
            <a href="https://www.r-bloggers.com/">
              <img src="/images/Rbloggers.png" alt="Rbloggers" width="100%" />
            </a>
            <br/>
            <a href="http://t-redactyl.io/">
              <span style="color:black;font-weight:bold;font-family:sans-serif;font-size:25px;">Standard error</span>
            </a>
            <a href="http://timelyportfolio.blogspot.be/">
              <span style="color:grey;font-weight:bold;font-family:sans-serif;font-size:24px;">Timely portfolio</span>
            </a>
            <br/>
            <a href="https://antoineguillot.wordpress.com/blog/">
              <span style="color:white;background-color:darkblue;font-weight:bold;font-family:sans-serif;font-size:21px;border:5px solid;border-color:darkblue">ENHANCE DATA</span>
            </a>
            <br/>
            <a href="https://fronkonstin.com/">
              <span style="color:black;background-color:gold;font-weight:bold;font-size:29px;border:3px solid;border-color:gold;">Fronkonstin</span>
            </a>
          </div>
        </div>
        <div id="logos">
          <div class="row">
            <div class="col-sm-4">
              <img src="/images/AsymptoteLogo.svg" style="width: 150%; transform: rotateZ(-35deg)"/>
            </div>
            <div class="col-sm-4">
              <img src="/images/Rlogo.svg" style="width: 110%;"/>
            </div>
            <div class="col-sm-4">
              <img src="/images/shiny-hex.png" style="width: 90%;"/>
            </div>
          </div>
          <div class="row">
            <div class="col-sm-4">
              <img src="/images/Povray_logo_sphere.png" style="width: 105%;"/>
            </div>
            <div class="col-sm-4">
              <img src="/images/javascript.svg" style="width: 90%;"/>
            </div>
            <div class="col-sm-4">
              <img src="/images/haskell.svg" style="width: 110%;"/>
            </div>
          </div>
        </div>
      </div>

      <div class="main col-sm-10">
        <div id="header">
          <div id="logo">
            <a href="/">
              <img src="/images/stla.jpg" alt="stla" width="100px" />
            </a>
          </div>
          <div id="navigation" style="margin-top:50px;">
            <a href="/">Home</a>
            <a href="/about.html">About</a>
            <a href="/contact.html">Contact</a>
            <a href="/archive.html">Archive</a>
          </div>
        </div>

        <div class="content">
          <h1>Drawing a stereographic duoprism</h1> 
          <div class="info">
    Posted on February 11, 2020
    
        by Stéphane Laurent
    
</div>
<div class="info">
    
    Tags: <a title="All pages tagged &#39;R&#39;." href="/tags/R.html">R</a>, <a title="All pages tagged &#39;maths&#39;." href="/tags/maths.html">maths</a>, <a title="All pages tagged &#39;geometry&#39;." href="/tags/geometry.html">geometry</a>, <a title="All pages tagged &#39;graphics&#39;." href="/tags/graphics.html">graphics</a>, <a title="All pages tagged &#39;rgl&#39;." href="/tags/rgl.html">rgl</a>, <a title="All pages tagged &#39;asymptote&#39;." href="/tags/asymptote.html">asymptote</a>, <a title="All pages tagged &#39;povray&#39;." href="/tags/povray.html">povray</a>
    
</div>

<p>In this post, I’ll show how to draw a stereographic <a href="./Duoprism.html">duoprism</a> using R, Asymptote and POV-Ray.</p>
<h1 id="with-r">With R</h1>
<div class="sourceCode" id="cb1"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a><span class="kw">library</span>(rgl)</span>
<span id="cb1-2"><a href="#cb1-2"></a></span>
<span id="cb1-3"><a href="#cb1-3"></a>A &lt;-<span class="st"> </span>8L <span class="co"># number of sides of the first polygon</span></span>
<span id="cb1-4"><a href="#cb1-4"></a>B &lt;-<span class="st"> </span>4L <span class="co"># number of sides of the second polygon</span></span>
<span id="cb1-5"><a href="#cb1-5"></a></span>
<span id="cb1-6"><a href="#cb1-6"></a><span class="co"># construction of the vertices</span></span>
<span id="cb1-7"><a href="#cb1-7"></a>vertices &lt;-<span class="st"> </span><span class="kw">array</span>(<span class="ot">NA_real_</span>, <span class="dt">dim =</span> <span class="kw">c</span>(A,B,4L))</span>
<span id="cb1-8"><a href="#cb1-8"></a><span class="cf">for</span>(i <span class="cf">in</span> 1L<span class="op">:</span>A){</span>
<span id="cb1-9"><a href="#cb1-9"></a>  v1 &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="kw">cos</span>(i<span class="op">/</span>A<span class="op">*</span><span class="dv">2</span><span class="op">*</span>pi), <span class="kw">sin</span>(i<span class="op">/</span>A<span class="op">*</span><span class="dv">2</span><span class="op">*</span>pi))</span>
<span id="cb1-10"><a href="#cb1-10"></a>  <span class="cf">for</span>(j <span class="cf">in</span> 1L<span class="op">:</span>B){</span>
<span id="cb1-11"><a href="#cb1-11"></a>    v2 &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="kw">cos</span>(j<span class="op">/</span>B<span class="op">*</span><span class="dv">2</span><span class="op">*</span>pi), <span class="kw">sin</span>(j<span class="op">/</span>B<span class="op">*</span><span class="dv">2</span><span class="op">*</span>pi))</span>
<span id="cb1-12"><a href="#cb1-12"></a>    vertices[i,j,] &lt;-<span class="st"> </span><span class="kw">c</span>(v1,v2)</span>
<span id="cb1-13"><a href="#cb1-13"></a>  }</span>
<span id="cb1-14"><a href="#cb1-14"></a>}</span>
<span id="cb1-15"><a href="#cb1-15"></a></span>
<span id="cb1-16"><a href="#cb1-16"></a><span class="co"># construction of the edges</span></span>
<span id="cb1-17"><a href="#cb1-17"></a>edges &lt;-<span class="st"> </span><span class="kw">array</span>(<span class="ot">NA_integer_</span>, <span class="dt">dim =</span> <span class="kw">c</span>(2L,2L,2L<span class="op">*</span>A<span class="op">*</span>B))</span>
<span id="cb1-18"><a href="#cb1-18"></a>dominates &lt;-<span class="st"> </span><span class="cf">function</span>(c1, c2){</span>
<span id="cb1-19"><a href="#cb1-19"></a>  c2[1L]<span class="op">&gt;</span>c1[1L] <span class="op">||</span><span class="st"> </span>(c2[1L]<span class="op">==</span>c1[1L] <span class="op">&amp;&amp;</span><span class="st"> </span>c2[2L]<span class="op">&gt;</span>c1[2L])</span>
<span id="cb1-20"><a href="#cb1-20"></a>}</span>
<span id="cb1-21"><a href="#cb1-21"></a>counter &lt;-<span class="st"> </span>1L</span>
<span id="cb1-22"><a href="#cb1-22"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="kw">seq_len</span>(A)<span class="op">-</span>1L){</span>
<span id="cb1-23"><a href="#cb1-23"></a>  <span class="cf">for</span>(j <span class="cf">in</span> <span class="kw">seq_len</span>(B)<span class="op">-</span>1L){</span>
<span id="cb1-24"><a href="#cb1-24"></a>    c1 &lt;-<span class="st"> </span><span class="kw">c</span>(i,j)</span>
<span id="cb1-25"><a href="#cb1-25"></a>    candidate &lt;-<span class="st"> </span><span class="kw">c</span>(i, (j<span class="op">-</span>1L)<span class="op">%%</span>B)</span>
<span id="cb1-26"><a href="#cb1-26"></a>    <span class="cf">if</span>(<span class="kw">dominates</span>(c1, candidate)){</span>
<span id="cb1-27"><a href="#cb1-27"></a>      edges[,,counter] &lt;-<span class="st"> </span><span class="kw">cbind</span>(c1, candidate) <span class="op">+</span><span class="st"> </span>1L</span>
<span id="cb1-28"><a href="#cb1-28"></a>      counter &lt;-<span class="st"> </span>counter <span class="op">+</span><span class="st"> </span>1L</span>
<span id="cb1-29"><a href="#cb1-29"></a>    }</span>
<span id="cb1-30"><a href="#cb1-30"></a>    candidate &lt;-<span class="st"> </span><span class="kw">c</span>(i, (j<span class="op">+</span>1L)<span class="op">%%</span>B)</span>
<span id="cb1-31"><a href="#cb1-31"></a>    <span class="cf">if</span>(<span class="kw">dominates</span>(c1, candidate)){</span>
<span id="cb1-32"><a href="#cb1-32"></a>      edges[,,counter] &lt;-<span class="st"> </span><span class="kw">cbind</span>(c1, candidate) <span class="op">+</span><span class="st"> </span>1L</span>
<span id="cb1-33"><a href="#cb1-33"></a>      counter &lt;-<span class="st"> </span>counter <span class="op">+</span><span class="st"> </span>1L</span>
<span id="cb1-34"><a href="#cb1-34"></a>    }</span>
<span id="cb1-35"><a href="#cb1-35"></a>    candidate &lt;-<span class="st"> </span><span class="kw">c</span>((i<span class="op">-</span>1L)<span class="op">%%</span>A, j)</span>
<span id="cb1-36"><a href="#cb1-36"></a>    <span class="cf">if</span>(<span class="kw">dominates</span>(c1, candidate)){</span>
<span id="cb1-37"><a href="#cb1-37"></a>      edges[,,counter] &lt;-<span class="st"> </span><span class="kw">cbind</span>(c1, candidate) <span class="op">+</span><span class="st"> </span>1L</span>
<span id="cb1-38"><a href="#cb1-38"></a>      counter &lt;-<span class="st"> </span>counter <span class="op">+</span><span class="st"> </span>1L</span>
<span id="cb1-39"><a href="#cb1-39"></a>    }</span>
<span id="cb1-40"><a href="#cb1-40"></a>    candidate &lt;-<span class="st"> </span><span class="kw">c</span>((i<span class="op">+</span>1L)<span class="op">%%</span>A, j)</span>
<span id="cb1-41"><a href="#cb1-41"></a>    <span class="cf">if</span>(<span class="kw">dominates</span>(c1, candidate)){</span>
<span id="cb1-42"><a href="#cb1-42"></a>      edges[,,counter] &lt;-<span class="st"> </span><span class="kw">cbind</span>(c1, candidate) <span class="op">+</span><span class="st"> </span>1L</span>
<span id="cb1-43"><a href="#cb1-43"></a>      counter &lt;-<span class="st"> </span>counter <span class="op">+</span><span class="st"> </span>1L</span>
<span id="cb1-44"><a href="#cb1-44"></a>    }</span>
<span id="cb1-45"><a href="#cb1-45"></a>  }</span>
<span id="cb1-46"><a href="#cb1-46"></a>}</span>
<span id="cb1-47"><a href="#cb1-47"></a></span>
<span id="cb1-48"><a href="#cb1-48"></a><span class="co"># stereographic projection</span></span>
<span id="cb1-49"><a href="#cb1-49"></a>stereog &lt;-<span class="st"> </span><span class="cf">function</span>(v){</span>
<span id="cb1-50"><a href="#cb1-50"></a>  v[1L<span class="op">:</span>3L] <span class="op">/</span><span class="st"> </span>(<span class="kw">sqrt</span>(<span class="dv">2</span>) <span class="op">-</span><span class="st"> </span>v[4L])</span>
<span id="cb1-51"><a href="#cb1-51"></a>}</span>
<span id="cb1-52"><a href="#cb1-52"></a></span>
<span id="cb1-53"><a href="#cb1-53"></a><span class="co"># spherical segment</span></span>
<span id="cb1-54"><a href="#cb1-54"></a>sphericalSegment &lt;-<span class="st"> </span><span class="cf">function</span>(P, Q, n){</span>
<span id="cb1-55"><a href="#cb1-55"></a>  out &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="ot">NA_real_</span>, <span class="dt">nrow =</span> n<span class="op">+</span>1L, <span class="dt">ncol =</span> 4L)</span>
<span id="cb1-56"><a href="#cb1-56"></a>  <span class="cf">for</span>(i <span class="cf">in</span> 0L<span class="op">:</span>n){</span>
<span id="cb1-57"><a href="#cb1-57"></a>    pt &lt;-<span class="st"> </span>P <span class="op">+</span><span class="st"> </span>(i<span class="op">/</span>n)<span class="op">*</span>(Q<span class="op">-</span>P)</span>
<span id="cb1-58"><a href="#cb1-58"></a>    out[i<span class="op">+</span>1L, ] &lt;-<span class="st"> </span><span class="kw">sqrt</span>(<span class="dv">2</span><span class="op">/</span><span class="kw">c</span>(<span class="kw">crossprod</span>(pt))) <span class="op">*</span><span class="st"> </span>pt</span>
<span id="cb1-59"><a href="#cb1-59"></a>  }</span>
<span id="cb1-60"><a href="#cb1-60"></a>  out</span>
<span id="cb1-61"><a href="#cb1-61"></a>}</span>
<span id="cb1-62"><a href="#cb1-62"></a></span>
<span id="cb1-63"><a href="#cb1-63"></a><span class="co"># stereographic edge</span></span>
<span id="cb1-64"><a href="#cb1-64"></a>stereoEdge &lt;-<span class="st"> </span><span class="cf">function</span>(verts, v1, v2){</span>
<span id="cb1-65"><a href="#cb1-65"></a>  P &lt;-<span class="st"> </span>verts[v1[1L], v1[2L], ]</span>
<span id="cb1-66"><a href="#cb1-66"></a>  Q &lt;-<span class="st"> </span>verts[v2[1L], v2[2L], ]</span>
<span id="cb1-67"><a href="#cb1-67"></a>  PQ &lt;-<span class="st"> </span><span class="kw">sphericalSegment</span>(P, Q, 100L)</span>
<span id="cb1-68"><a href="#cb1-68"></a>  pq &lt;-<span class="st"> </span><span class="kw">t</span>(<span class="kw">apply</span>(PQ, 1L, stereog))</span>
<span id="cb1-69"><a href="#cb1-69"></a>  dists &lt;-<span class="st"> </span><span class="kw">sqrt</span>(<span class="kw">apply</span>(pq, 1L, crossprod))</span>
<span id="cb1-70"><a href="#cb1-70"></a>  <span class="kw">cylinder3d</span>(pq, <span class="dt">radius =</span> dists<span class="op">/</span><span class="dv">15</span>, <span class="dt">sides =</span> <span class="dv">60</span>)</span>
<span id="cb1-71"><a href="#cb1-71"></a>}</span>
<span id="cb1-72"><a href="#cb1-72"></a></span>
<span id="cb1-73"><a href="#cb1-73"></a><span class="co"># projected vertices</span></span>
<span id="cb1-74"><a href="#cb1-74"></a>vs &lt;-<span class="st"> </span><span class="kw">apply</span>(vertices, <span class="kw">c</span>(1L,2L), stereog)</span>
<span id="cb1-75"><a href="#cb1-75"></a></span>
<span id="cb1-76"><a href="#cb1-76"></a><span class="co">####~~~~ plot ~~~~####</span></span>
<span id="cb1-77"><a href="#cb1-77"></a><span class="kw">open3d</span>(<span class="dt">windowRect =</span> <span class="kw">c</span>(<span class="dv">50</span>, <span class="dv">50</span>, <span class="dv">562</span>, <span class="dv">562</span>), <span class="dt">zoom =</span> <span class="fl">0.9</span>)</span>
<span id="cb1-78"><a href="#cb1-78"></a><span class="kw">bg3d</span>(<span class="kw">rgb</span>(<span class="dv">54</span>, <span class="dv">57</span>, <span class="dv">64</span>, <span class="dt">maxColorValue =</span> <span class="dv">255</span>))</span>
<span id="cb1-79"><a href="#cb1-79"></a><span class="co">## plot the edges</span></span>
<span id="cb1-80"><a href="#cb1-80"></a><span class="cf">for</span>(k <span class="cf">in</span> 1L<span class="op">:</span>(2L<span class="op">*</span>A<span class="op">*</span>B)){</span>
<span id="cb1-81"><a href="#cb1-81"></a>  v1 &lt;-<span class="st"> </span>edges[, 1L, k]</span>
<span id="cb1-82"><a href="#cb1-82"></a>  v2 &lt;-<span class="st"> </span>edges[, 2L, k]</span>
<span id="cb1-83"><a href="#cb1-83"></a>  edge &lt;-<span class="st"> </span><span class="kw">stereoEdge</span>(vertices, v1, v2)</span>
<span id="cb1-84"><a href="#cb1-84"></a>  <span class="kw">shade3d</span>(edge, <span class="dt">color =</span> <span class="st">&quot;gold&quot;</span>)</span>
<span id="cb1-85"><a href="#cb1-85"></a>}</span>
<span id="cb1-86"><a href="#cb1-86"></a><span class="co">## plot the vertices</span></span>
<span id="cb1-87"><a href="#cb1-87"></a><span class="cf">for</span>(i <span class="cf">in</span> 1L<span class="op">:</span>A){</span>
<span id="cb1-88"><a href="#cb1-88"></a>  <span class="cf">for</span>(j <span class="cf">in</span> 1L<span class="op">:</span>B){</span>
<span id="cb1-89"><a href="#cb1-89"></a>    v &lt;-<span class="st"> </span>vs[,i,j]</span>
<span id="cb1-90"><a href="#cb1-90"></a>    <span class="kw">spheres3d</span>(v, <span class="dt">radius =</span> <span class="kw">sqrt</span>(<span class="kw">c</span>(<span class="kw">crossprod</span>(v)))<span class="op">/</span><span class="dv">10</span> , <span class="dt">color =</span> <span class="st">&quot;gold2&quot;</span>)</span>
<span id="cb1-91"><a href="#cb1-91"></a>  }</span>
<span id="cb1-92"><a href="#cb1-92"></a>}</span></code></pre></div>
<p><img src="./figures/DuoprismStereo_R.png" /></p>
<h1 id="with-asymptote">With Asymptote</h1>
<div class="sourceCode" id="cb2"><pre class="sourceCode numberSource cpp numberLines"><code class="sourceCode cpp"><span id="cb2-1"><a href="#cb2-1"></a>settings.render = <span class="dv">4</span>;</span>
<span id="cb2-2"><a href="#cb2-2"></a>settings.outformat = <span class="st">&quot;eps&quot;</span>;</span>
<span id="cb2-3"><a href="#cb2-3"></a><span class="kw">import</span> tube;</span>
<span id="cb2-4"><a href="#cb2-4"></a>size(<span class="dv">200</span>,<span class="dv">0</span>);</span>
<span id="cb2-5"><a href="#cb2-5"></a></span>
<span id="cb2-6"><a href="#cb2-6"></a>currentprojection = orthographic(<span class="dv">4</span>,<span class="dv">4</span>,<span class="dv">4</span>);</span>
<span id="cb2-7"><a href="#cb2-7"></a>currentlight = light(gray(<span class="fl">0.85</span>), ambient=black, specularfactor=<span class="dv">3</span>,</span>
<span id="cb2-8"><a href="#cb2-8"></a>                     (<span class="dv">100</span>,<span class="dv">100</span>,<span class="dv">100</span>), specular=gray(<span class="fl">0.9</span>), viewport=<span class="kw">false</span>);</span>
<span id="cb2-9"><a href="#cb2-9"></a>currentlight.background = rgb(<span class="st">&quot;363940ff&quot;</span>);</span>
<span id="cb2-10"><a href="#cb2-10"></a></span>
<span id="cb2-11"><a href="#cb2-11"></a><span class="co">// files to be saved -----------------------------------------------------------</span></span>
<span id="cb2-12"><a href="#cb2-12"></a>string[] files = {</span>
<span id="cb2-13"><a href="#cb2-13"></a>    <span class="st">&quot;DP000&quot;</span>, <span class="st">&quot;DP001&quot;</span>, <span class="st">&quot;DP002&quot;</span>, <span class="st">&quot;DP003&quot;</span>, <span class="st">&quot;DP004&quot;</span>, <span class="st">&quot;DP005&quot;</span>,</span>
<span id="cb2-14"><a href="#cb2-14"></a>    <span class="st">&quot;DP006&quot;</span>, <span class="st">&quot;DP007&quot;</span>, <span class="st">&quot;DP008&quot;</span>, <span class="st">&quot;DP009&quot;</span>, <span class="st">&quot;DP010&quot;</span>, <span class="st">&quot;DP011&quot;</span>,</span>
<span id="cb2-15"><a href="#cb2-15"></a>    <span class="st">&quot;DP012&quot;</span>, <span class="st">&quot;DP013&quot;</span>, <span class="st">&quot;DP014&quot;</span>, <span class="st">&quot;DP015&quot;</span>, <span class="st">&quot;DP016&quot;</span>, <span class="st">&quot;DP017&quot;</span>,</span>
<span id="cb2-16"><a href="#cb2-16"></a>    <span class="st">&quot;DP018&quot;</span>, <span class="st">&quot;DP019&quot;</span>, <span class="st">&quot;DP020&quot;</span>, <span class="st">&quot;DP021&quot;</span>, <span class="st">&quot;DP022&quot;</span>, <span class="st">&quot;DP023&quot;</span>,</span>
<span id="cb2-17"><a href="#cb2-17"></a>    <span class="st">&quot;DP024&quot;</span>, <span class="st">&quot;DP025&quot;</span>, <span class="st">&quot;DP026&quot;</span>, <span class="st">&quot;DP027&quot;</span>, <span class="st">&quot;DP028&quot;</span>, <span class="st">&quot;DP029&quot;</span>,</span>
<span id="cb2-18"><a href="#cb2-18"></a>    <span class="st">&quot;DP030&quot;</span>, <span class="st">&quot;DP031&quot;</span>, <span class="st">&quot;DP032&quot;</span>, <span class="st">&quot;DP033&quot;</span>, <span class="st">&quot;DP034&quot;</span>, <span class="st">&quot;DP035&quot;</span>,</span>
<span id="cb2-19"><a href="#cb2-19"></a>    <span class="st">&quot;DP036&quot;</span>, <span class="st">&quot;DP037&quot;</span>, <span class="st">&quot;DP038&quot;</span>, <span class="st">&quot;DP039&quot;</span>, <span class="st">&quot;DP040&quot;</span>, <span class="st">&quot;DP041&quot;</span>,</span>
<span id="cb2-20"><a href="#cb2-20"></a>    <span class="st">&quot;DP042&quot;</span>, <span class="st">&quot;DP043&quot;</span>, <span class="st">&quot;DP044&quot;</span>, <span class="st">&quot;DP045&quot;</span>, <span class="st">&quot;DP046&quot;</span>, <span class="st">&quot;DP047&quot;</span>,</span>
<span id="cb2-21"><a href="#cb2-21"></a>    <span class="st">&quot;DP048&quot;</span>, <span class="st">&quot;DP049&quot;</span>, <span class="st">&quot;DP050&quot;</span>, <span class="st">&quot;DP051&quot;</span>, <span class="st">&quot;DP052&quot;</span>, <span class="st">&quot;DP053&quot;</span>,</span>
<span id="cb2-22"><a href="#cb2-22"></a>    <span class="st">&quot;DP054&quot;</span>, <span class="st">&quot;DP055&quot;</span>, <span class="st">&quot;DP056&quot;</span>, <span class="st">&quot;DP057&quot;</span>, <span class="st">&quot;DP058&quot;</span>, <span class="st">&quot;DP059&quot;</span>,</span>
<span id="cb2-23"><a href="#cb2-23"></a>    <span class="st">&quot;DP060&quot;</span>, <span class="st">&quot;DP061&quot;</span>, <span class="st">&quot;DP062&quot;</span>, <span class="st">&quot;DP063&quot;</span>, <span class="st">&quot;DP064&quot;</span>, <span class="st">&quot;DP065&quot;</span>,</span>
<span id="cb2-24"><a href="#cb2-24"></a>    <span class="st">&quot;DP066&quot;</span>, <span class="st">&quot;DP067&quot;</span>, <span class="st">&quot;DP068&quot;</span>, <span class="st">&quot;DP069&quot;</span>, <span class="st">&quot;DP070&quot;</span>, <span class="st">&quot;DP071&quot;</span>,</span>
<span id="cb2-25"><a href="#cb2-25"></a>    <span class="st">&quot;DP072&quot;</span>, <span class="st">&quot;DP073&quot;</span>, <span class="st">&quot;DP074&quot;</span>, <span class="st">&quot;DP075&quot;</span>, <span class="st">&quot;DP076&quot;</span>, <span class="st">&quot;DP077&quot;</span>,</span>
<span id="cb2-26"><a href="#cb2-26"></a>    <span class="st">&quot;DP078&quot;</span>, <span class="st">&quot;DP079&quot;</span>, <span class="st">&quot;DP080&quot;</span>, <span class="st">&quot;DP081&quot;</span>, <span class="st">&quot;DP082&quot;</span>, <span class="st">&quot;DP083&quot;</span>,</span>
<span id="cb2-27"><a href="#cb2-27"></a>    <span class="st">&quot;DP084&quot;</span>, <span class="st">&quot;DP085&quot;</span>, <span class="st">&quot;DP086&quot;</span>, <span class="st">&quot;DP087&quot;</span>, <span class="st">&quot;DP088&quot;</span>, <span class="st">&quot;DP089&quot;</span>,</span>
<span id="cb2-28"><a href="#cb2-28"></a>    <span class="st">&quot;DP090&quot;</span>, <span class="st">&quot;DP091&quot;</span>, <span class="st">&quot;DP092&quot;</span>, <span class="st">&quot;DP093&quot;</span>, <span class="st">&quot;DP094&quot;</span>, <span class="st">&quot;DP095&quot;</span>,</span>
<span id="cb2-29"><a href="#cb2-29"></a>    <span class="st">&quot;DP096&quot;</span>, <span class="st">&quot;DP097&quot;</span>, <span class="st">&quot;DP098&quot;</span>, <span class="st">&quot;DP099&quot;</span>, <span class="st">&quot;DP100&quot;</span>, <span class="st">&quot;DP101&quot;</span>,</span>
<span id="cb2-30"><a href="#cb2-30"></a>    <span class="st">&quot;DP102&quot;</span>, <span class="st">&quot;DP103&quot;</span>, <span class="st">&quot;DP104&quot;</span>, <span class="st">&quot;DP105&quot;</span>, <span class="st">&quot;DP106&quot;</span>, <span class="st">&quot;DP107&quot;</span>,</span>
<span id="cb2-31"><a href="#cb2-31"></a>    <span class="st">&quot;DP108&quot;</span>, <span class="st">&quot;DP109&quot;</span>, <span class="st">&quot;DP110&quot;</span>, <span class="st">&quot;DP111&quot;</span>, <span class="st">&quot;DP112&quot;</span>, <span class="st">&quot;DP113&quot;</span>,</span>
<span id="cb2-32"><a href="#cb2-32"></a>    <span class="st">&quot;DP114&quot;</span>, <span class="st">&quot;DP115&quot;</span>, <span class="st">&quot;DP116&quot;</span>, <span class="st">&quot;DP117&quot;</span>, <span class="st">&quot;DP118&quot;</span>, <span class="st">&quot;DP119&quot;</span>,</span>
<span id="cb2-33"><a href="#cb2-33"></a>    <span class="st">&quot;DP120&quot;</span>, <span class="st">&quot;DP121&quot;</span>, <span class="st">&quot;DP122&quot;</span>, <span class="st">&quot;DP123&quot;</span>, <span class="st">&quot;DP124&quot;</span>, <span class="st">&quot;DP125&quot;</span>,</span>
<span id="cb2-34"><a href="#cb2-34"></a>    <span class="st">&quot;DP126&quot;</span>, <span class="st">&quot;DP127&quot;</span>, <span class="st">&quot;DP128&quot;</span>, <span class="st">&quot;DP129&quot;</span>, <span class="st">&quot;DP130&quot;</span>, <span class="st">&quot;DP131&quot;</span>,</span>
<span id="cb2-35"><a href="#cb2-35"></a>    <span class="st">&quot;DP132&quot;</span>, <span class="st">&quot;DP133&quot;</span>, <span class="st">&quot;DP134&quot;</span>, <span class="st">&quot;DP135&quot;</span>, <span class="st">&quot;DP136&quot;</span>, <span class="st">&quot;DP137&quot;</span>,</span>
<span id="cb2-36"><a href="#cb2-36"></a>    <span class="st">&quot;DP138&quot;</span>, <span class="st">&quot;DP139&quot;</span>, <span class="st">&quot;DP140&quot;</span>, <span class="st">&quot;DP141&quot;</span>, <span class="st">&quot;DP142&quot;</span>, <span class="st">&quot;DP143&quot;</span>,</span>
<span id="cb2-37"><a href="#cb2-37"></a>    <span class="st">&quot;DP144&quot;</span>, <span class="st">&quot;DP145&quot;</span>, <span class="st">&quot;DP146&quot;</span>, <span class="st">&quot;DP147&quot;</span>, <span class="st">&quot;DP148&quot;</span>, <span class="st">&quot;DP149&quot;</span>,</span>
<span id="cb2-38"><a href="#cb2-38"></a>    <span class="st">&quot;DP150&quot;</span>, <span class="st">&quot;DP151&quot;</span>, <span class="st">&quot;DP152&quot;</span>, <span class="st">&quot;DP153&quot;</span>, <span class="st">&quot;DP154&quot;</span>, <span class="st">&quot;DP155&quot;</span>,</span>
<span id="cb2-39"><a href="#cb2-39"></a>    <span class="st">&quot;DP156&quot;</span>, <span class="st">&quot;DP157&quot;</span>, <span class="st">&quot;DP158&quot;</span>, <span class="st">&quot;DP159&quot;</span>, <span class="st">&quot;DP160&quot;</span>, <span class="st">&quot;DP161&quot;</span>,</span>
<span id="cb2-40"><a href="#cb2-40"></a>    <span class="st">&quot;DP162&quot;</span>, <span class="st">&quot;DP163&quot;</span>, <span class="st">&quot;DP164&quot;</span>, <span class="st">&quot;DP165&quot;</span>, <span class="st">&quot;DP166&quot;</span>, <span class="st">&quot;DP167&quot;</span>,</span>
<span id="cb2-41"><a href="#cb2-41"></a>    <span class="st">&quot;DP168&quot;</span>, <span class="st">&quot;DP169&quot;</span>, <span class="st">&quot;DP170&quot;</span>, <span class="st">&quot;DP171&quot;</span>, <span class="st">&quot;DP172&quot;</span>, <span class="st">&quot;DP173&quot;</span>,</span>
<span id="cb2-42"><a href="#cb2-42"></a>    <span class="st">&quot;DP174&quot;</span>, <span class="st">&quot;DP175&quot;</span>, <span class="st">&quot;DP176&quot;</span>, <span class="st">&quot;DP177&quot;</span>, <span class="st">&quot;DP178&quot;</span>, <span class="st">&quot;DP179&quot;</span>};</span>
<span id="cb2-43"><a href="#cb2-43"></a></span>
<span id="cb2-44"><a href="#cb2-44"></a><span class="co">// lexicographic order ---------------------------------------------------------</span></span>
<span id="cb2-45"><a href="#cb2-45"></a><span class="dt">bool</span> dominates(<span class="dt">int</span>[] e1, <span class="dt">int</span>[] e2){</span>
<span id="cb2-46"><a href="#cb2-46"></a>    <span class="cf">return</span> e2[<span class="dv">0</span>]&gt;e1[<span class="dv">0</span>] || (e2[<span class="dv">0</span>]==e1[<span class="dv">0</span>] &amp;&amp; e2[<span class="dv">1</span>]&gt;e1[<span class="dv">1</span>]);</span>
<span id="cb2-47"><a href="#cb2-47"></a>}</span>
<span id="cb2-48"><a href="#cb2-48"></a></span>
<span id="cb2-49"><a href="#cb2-49"></a><span class="co">// vertices --------------------------------------------------------------------</span></span>
<span id="cb2-50"><a href="#cb2-50"></a><span class="dt">int</span> A = <span class="dv">8</span>;</span>
<span id="cb2-51"><a href="#cb2-51"></a><span class="dt">int</span> B = <span class="dv">4</span>;</span>
<span id="cb2-52"><a href="#cb2-52"></a></span>
<span id="cb2-53"><a href="#cb2-53"></a><span class="kw">struct</span> quadruple {</span>
<span id="cb2-54"><a href="#cb2-54"></a>    real x;</span>
<span id="cb2-55"><a href="#cb2-55"></a>    real y;</span>
<span id="cb2-56"><a href="#cb2-56"></a>    real z;</span>
<span id="cb2-57"><a href="#cb2-57"></a>    real t;</span>
<span id="cb2-58"><a href="#cb2-58"></a>}</span>
<span id="cb2-59"><a href="#cb2-59"></a></span>
<span id="cb2-60"><a href="#cb2-60"></a>real[][] poly1 = <span class="kw">new</span> real[A][<span class="dv">2</span>];</span>
<span id="cb2-61"><a href="#cb2-61"></a><span class="cf">for</span>(<span class="dt">int</span> i = <span class="dv">0</span>; i &lt; A; ++i){</span>
<span id="cb2-62"><a href="#cb2-62"></a>    poly1[i][<span class="dv">0</span>] = cos(i/A*<span class="dv">2</span><span class="er">pi</span>);</span>
<span id="cb2-63"><a href="#cb2-63"></a>    poly1[i][<span class="dv">1</span>] = sin(i/A*<span class="dv">2</span><span class="er">pi</span>);</span>
<span id="cb2-64"><a href="#cb2-64"></a>}</span>
<span id="cb2-65"><a href="#cb2-65"></a>real[][] poly2 = <span class="kw">new</span> real[B][<span class="dv">2</span>];</span>
<span id="cb2-66"><a href="#cb2-66"></a><span class="cf">for</span>(<span class="dt">int</span> i = <span class="dv">0</span>; i &lt; B; ++i){</span>
<span id="cb2-67"><a href="#cb2-67"></a>    poly2[i][<span class="dv">0</span>] = cos(pi/B+i/B*<span class="dv">2</span><span class="er">pi</span>);</span>
<span id="cb2-68"><a href="#cb2-68"></a>    poly2[i][<span class="dv">1</span>] = sin(pi/B+i/B*<span class="dv">2</span><span class="er">pi</span>);</span>
<span id="cb2-69"><a href="#cb2-69"></a>}</span>
<span id="cb2-70"><a href="#cb2-70"></a>quadruple[][] vertices = <span class="kw">new</span> quadruple[A][B];</span>
<span id="cb2-71"><a href="#cb2-71"></a><span class="cf">for</span>(<span class="dt">int</span> i = <span class="dv">0</span>; i &lt; A; ++i){</span>
<span id="cb2-72"><a href="#cb2-72"></a>    <span class="cf">for</span>(<span class="dt">int</span> j = <span class="dv">0</span>; j &lt; B; ++j){</span>
<span id="cb2-73"><a href="#cb2-73"></a>        quadruple v;</span>
<span id="cb2-74"><a href="#cb2-74"></a>        v.x = poly1[i][<span class="dv">0</span>]; v.y = poly1[i][<span class="dv">1</span>]; </span>
<span id="cb2-75"><a href="#cb2-75"></a>        v.z = poly2[j][<span class="dv">0</span>]; v.t = poly2[j][<span class="dv">1</span>];</span>
<span id="cb2-76"><a href="#cb2-76"></a>        vertices[i][j] = v;</span>
<span id="cb2-77"><a href="#cb2-77"></a>    }</span>
<span id="cb2-78"><a href="#cb2-78"></a>}</span>
<span id="cb2-79"><a href="#cb2-79"></a></span>
<span id="cb2-80"><a href="#cb2-80"></a><span class="co">// edges -----------------------------------------------------------------------</span></span>
<span id="cb2-81"><a href="#cb2-81"></a><span class="dt">int</span>[][][] edges;</span>
<span id="cb2-82"><a href="#cb2-82"></a><span class="cf">for</span>(<span class="dt">int</span> i = <span class="dv">0</span>; i &lt; A; ++i){</span>
<span id="cb2-83"><a href="#cb2-83"></a>    <span class="cf">for</span>(<span class="dt">int</span> j = <span class="dv">0</span>; j &lt; B; ++j){</span>
<span id="cb2-84"><a href="#cb2-84"></a>        <span class="dt">int</span>[] e = {i,j};</span>
<span id="cb2-85"><a href="#cb2-85"></a>        <span class="dt">int</span>[] candidate = {i,(j-<span class="dv">1</span>)%B};</span>
<span id="cb2-86"><a href="#cb2-86"></a>        <span class="cf">if</span>(dominates(e,candidate)){</span>
<span id="cb2-87"><a href="#cb2-87"></a>            <span class="dt">int</span>[][] edge = {e,candidate}; </span>
<span id="cb2-88"><a href="#cb2-88"></a>            edges.push(edge);</span>
<span id="cb2-89"><a href="#cb2-89"></a>        }</span>
<span id="cb2-90"><a href="#cb2-90"></a>        <span class="dt">int</span>[] candidate = {i,(j+<span class="dv">1</span>)%B};</span>
<span id="cb2-91"><a href="#cb2-91"></a>        <span class="cf">if</span>(dominates(e,candidate)){</span>
<span id="cb2-92"><a href="#cb2-92"></a>            <span class="dt">int</span>[][] edge = {e,candidate}; </span>
<span id="cb2-93"><a href="#cb2-93"></a>            edges.push(edge);</span>
<span id="cb2-94"><a href="#cb2-94"></a>        }</span>
<span id="cb2-95"><a href="#cb2-95"></a>        <span class="dt">int</span>[] candidate = {(i-<span class="dv">1</span>)%A,j};</span>
<span id="cb2-96"><a href="#cb2-96"></a>        <span class="cf">if</span>(dominates(e,candidate)){</span>
<span id="cb2-97"><a href="#cb2-97"></a>            <span class="dt">int</span>[][] edge = {e,candidate}; </span>
<span id="cb2-98"><a href="#cb2-98"></a>            edges.push(edge);</span>
<span id="cb2-99"><a href="#cb2-99"></a>        }</span>
<span id="cb2-100"><a href="#cb2-100"></a>        <span class="dt">int</span>[] candidate = {(i+<span class="dv">1</span>)%A,j};</span>
<span id="cb2-101"><a href="#cb2-101"></a>        <span class="cf">if</span>(dominates(e,candidate)){</span>
<span id="cb2-102"><a href="#cb2-102"></a>            <span class="dt">int</span>[][] edge = {e,candidate}; </span>
<span id="cb2-103"><a href="#cb2-103"></a>            edges.push(edge);</span>
<span id="cb2-104"><a href="#cb2-104"></a>        }</span>
<span id="cb2-105"><a href="#cb2-105"></a>    }</span>
<span id="cb2-106"><a href="#cb2-106"></a>}</span>
<span id="cb2-107"><a href="#cb2-107"></a></span>
<span id="cb2-108"><a href="#cb2-108"></a><span class="co">// rotation in 4D space (right-isoclinic) --------------------------------------</span></span>
<span id="cb2-109"><a href="#cb2-109"></a>quadruple rotate4d(real alpha, real beta, real xi, quadruple vec){</span>
<span id="cb2-110"><a href="#cb2-110"></a>    real a = cos(xi);</span>
<span id="cb2-111"><a href="#cb2-111"></a>    real b = sin(alpha)*cos(beta)*sin(xi);</span>
<span id="cb2-112"><a href="#cb2-112"></a>    real c = sin(alpha)*sin(beta)*sin(xi);</span>
<span id="cb2-113"><a href="#cb2-113"></a>    real d = cos(alpha)*sin(xi);</span>
<span id="cb2-114"><a href="#cb2-114"></a>    real p = vec.x;</span>
<span id="cb2-115"><a href="#cb2-115"></a>    real q = vec.y;</span>
<span id="cb2-116"><a href="#cb2-116"></a>    real r = vec.z;</span>
<span id="cb2-117"><a href="#cb2-117"></a>    real s = vec.t;</span>
<span id="cb2-118"><a href="#cb2-118"></a>    quadruple out;</span>
<span id="cb2-119"><a href="#cb2-119"></a>    out.x = a*p - b*q - c*r - d*s;</span>
<span id="cb2-120"><a href="#cb2-120"></a>    out.y = a*q + b*p + c*s - d*r;</span>
<span id="cb2-121"><a href="#cb2-121"></a>    out.z = a*r - b*s + c*p + d*q;</span>
<span id="cb2-122"><a href="#cb2-122"></a>    out.t = a*s + b*r - c*q + d*p;</span>
<span id="cb2-123"><a href="#cb2-123"></a>    <span class="cf">return</span> out;</span>
<span id="cb2-124"><a href="#cb2-124"></a>}</span>
<span id="cb2-125"><a href="#cb2-125"></a></span>
<span id="cb2-126"><a href="#cb2-126"></a><span class="co">// stereographic projection ----------------------------------------------------</span></span>
<span id="cb2-127"><a href="#cb2-127"></a>triple stereog(quadruple A, real r){</span>
<span id="cb2-128"><a href="#cb2-128"></a>    <span class="cf">return</span> (A.x, A.y, A.z) / (r - A.t);</span>
<span id="cb2-129"><a href="#cb2-129"></a>}</span>
<span id="cb2-130"><a href="#cb2-130"></a></span>
<span id="cb2-131"><a href="#cb2-131"></a><span class="co">// stereographic path ----------------------------------------------------------</span></span>
<span id="cb2-132"><a href="#cb2-132"></a>path3 stereoPath(quadruple A, quadruple B, real r, <span class="dt">int</span> n){</span>
<span id="cb2-133"><a href="#cb2-133"></a>    path3 out;</span>
<span id="cb2-134"><a href="#cb2-134"></a>    <span class="cf">for</span>(<span class="dt">int</span> i = <span class="dv">0</span>; i &lt;= n; ++i){</span>
<span id="cb2-135"><a href="#cb2-135"></a>        real t = i/n;</span>
<span id="cb2-136"><a href="#cb2-136"></a>        quadruple M;</span>
<span id="cb2-137"><a href="#cb2-137"></a>        real x = (<span class="dv">1</span>-t)*A.x + t*B.x;</span>
<span id="cb2-138"><a href="#cb2-138"></a>        real y = (<span class="dv">1</span>-t)*A.y + t*B.y;</span>
<span id="cb2-139"><a href="#cb2-139"></a>        real z = (<span class="dv">1</span>-t)*A.z + t*B.z;</span>
<span id="cb2-140"><a href="#cb2-140"></a>        real t = (<span class="dv">1</span>-t)*A.t + t*B.t;</span>
<span id="cb2-141"><a href="#cb2-141"></a>        real lg = sqrt(x*x + y*y + z*z + t*t) / r;</span>
<span id="cb2-142"><a href="#cb2-142"></a>        M.x = x / lg; M.y = y / lg; M.z = z / lg; M.t = t / lg;</span>
<span id="cb2-143"><a href="#cb2-143"></a>        out = out .. stereog(M, r);</span>
<span id="cb2-144"><a href="#cb2-144"></a>    }</span>
<span id="cb2-145"><a href="#cb2-145"></a>    <span class="cf">return</span> out;</span>
<span id="cb2-146"><a href="#cb2-146"></a>}</span>
<span id="cb2-147"><a href="#cb2-147"></a></span>
<span id="cb2-148"><a href="#cb2-148"></a><span class="co">// section transformation ------------------------------------------------------</span></span>
<span id="cb2-149"><a href="#cb2-149"></a>transform T(path3 p3, real t, <span class="dt">int</span> n){</span>
<span id="cb2-150"><a href="#cb2-150"></a>    triple M = relpoint(p3, t/(n/<span class="dv">4</span>));</span>
<span id="cb2-151"><a href="#cb2-151"></a>    <span class="cf">return</span> scale(length(M)/<span class="dv">15</span>); </span>
<span id="cb2-152"><a href="#cb2-152"></a>}</span>
<span id="cb2-153"><a href="#cb2-153"></a></span>
<span id="cb2-154"><a href="#cb2-154"></a><span class="co">// bounding box ----------------------------------------------------------------</span></span>
<span id="cb2-155"><a href="#cb2-155"></a>real f=<span class="dv">3</span>, h = <span class="fl">4.5</span>, g = <span class="fl">1.5</span>;</span>
<span id="cb2-156"><a href="#cb2-156"></a>path3 boundingbox = (-h,<span class="dv">0</span>,-f)--(-h,<span class="dv">0</span>,g)--(h,<span class="dv">0</span>,f)--(h,<span class="dv">0</span>,-g)--cycle;</span>
<span id="cb2-157"><a href="#cb2-157"></a></span>
<span id="cb2-158"><a href="#cb2-158"></a><span class="co">// draw the duoprism -----------------------------------------------------------</span></span>
<span id="cb2-159"><a href="#cb2-159"></a><span class="dt">int</span> n = <span class="dv">100</span>;</span>
<span id="cb2-160"><a href="#cb2-160"></a>real r = sqrt(<span class="dv">2</span>);</span>
<span id="cb2-161"><a href="#cb2-161"></a>real alpha = pi/<span class="dv">2</span>, beta = <span class="dv">0</span>;</span>
<span id="cb2-162"><a href="#cb2-162"></a></span>
<span id="cb2-163"><a href="#cb2-163"></a><span class="cf">for</span>(<span class="dt">int</span> file = <span class="dv">0</span>; file &lt; <span class="dv">180</span>; ++file){</span>
<span id="cb2-164"><a href="#cb2-164"></a>    real xi = <span class="dv">2</span>*file*pi/<span class="dv">180</span>;</span>
<span id="cb2-165"><a href="#cb2-165"></a>    picture pic;</span>
<span id="cb2-166"><a href="#cb2-166"></a>    <span class="co">// draw bounding box</span></span>
<span id="cb2-167"><a href="#cb2-167"></a>    draw(pic, boundingbox, rgb(<span class="st">&quot;363940ff&quot;</span>)+opacity(<span class="dv">0</span>));</span>
<span id="cb2-168"><a href="#cb2-168"></a>    <span class="co">// draw edges</span></span>
<span id="cb2-169"><a href="#cb2-169"></a>    <span class="cf">for</span>(<span class="dt">int</span> k = <span class="dv">0</span>; k &lt; <span class="dv">2</span>*A*B; ++k){</span>
<span id="cb2-170"><a href="#cb2-170"></a>        quadruple A = vertices[edges[k][<span class="dv">0</span>][<span class="dv">0</span>]][edges[k][<span class="dv">0</span>][<span class="dv">1</span>]];</span>
<span id="cb2-171"><a href="#cb2-171"></a>        quadruple B = vertices[edges[k][<span class="dv">1</span>][<span class="dv">0</span>]][edges[k][<span class="dv">1</span>][<span class="dv">1</span>]];</span>
<span id="cb2-172"><a href="#cb2-172"></a>        path3 p3 = </span>
<span id="cb2-173"><a href="#cb2-173"></a>            stereoPath(rotate4d(alpha, beta, xi, A), </span>
<span id="cb2-174"><a href="#cb2-174"></a>                       rotate4d(alpha, beta, xi, B), r, n);</span>
<span id="cb2-175"><a href="#cb2-175"></a>        transform S(real t){</span>
<span id="cb2-176"><a href="#cb2-176"></a>            <span class="cf">return</span> T(p3, t, n);</span>
<span id="cb2-177"><a href="#cb2-177"></a>        }</span>
<span id="cb2-178"><a href="#cb2-178"></a>        draw(pic, tube(p3, unitcircle, S), rgb(<span class="dv">139</span>,<span class="dv">0</span>,<span class="dv">139</span>), </span>
<span id="cb2-179"><a href="#cb2-179"></a>                                render(compression=Low, merge=<span class="kw">true</span>));</span>
<span id="cb2-180"><a href="#cb2-180"></a>    }</span>
<span id="cb2-181"><a href="#cb2-181"></a>    <span class="co">// draw vertices</span></span>
<span id="cb2-182"><a href="#cb2-182"></a>    <span class="cf">for</span>(<span class="dt">int</span> i = <span class="dv">0</span>; i &lt; A; ++i){</span>
<span id="cb2-183"><a href="#cb2-183"></a>        <span class="cf">for</span>(<span class="dt">int</span> j = <span class="dv">0</span>; j &lt; B; ++j){</span>
<span id="cb2-184"><a href="#cb2-184"></a>            triple Asg = </span>
<span id="cb2-185"><a href="#cb2-185"></a>                stereog(rotate4d(alpha, beta, xi, vertices[i][j]), r);</span>
<span id="cb2-186"><a href="#cb2-186"></a>            draw(pic, shift(Asg)*scale3(length(Asg)/<span class="dv">10</span>)*unitsphere, purple);</span>
<span id="cb2-187"><a href="#cb2-187"></a>        }</span>
<span id="cb2-188"><a href="#cb2-188"></a>    }</span>
<span id="cb2-189"><a href="#cb2-189"></a>    <span class="co">// add and save picture</span></span>
<span id="cb2-190"><a href="#cb2-190"></a>    add(pic);</span>
<span id="cb2-191"><a href="#cb2-191"></a>    shipout(files[file], bbox(rgb(<span class="st">&quot;363940ff&quot;</span>), FillDraw(rgb(<span class="st">&quot;363940ff&quot;</span>))));</span>
<span id="cb2-192"><a href="#cb2-192"></a>    erase();</span>
<span id="cb2-193"><a href="#cb2-193"></a>}</span>
<span id="cb2-194"><a href="#cb2-194"></a></span>
<span id="cb2-195"><a href="#cb2-195"></a><span class="co">/* to do the animation</span></span>
<span id="cb2-196"><a href="#cb2-196"></a><span class="co">gs -dSAFER -dBATCH -dNOPAUSE -dEPSCrop -sDEVICE=png16m -r600 -sOutputFile=zpic%03d.png DP*.eps</span></span>
<span id="cb2-197"><a href="#cb2-197"></a><span class="co">mogrify -resize 512x zpic*.png</span></span>
<span id="cb2-198"><a href="#cb2-198"></a><span class="co">gifski --fps 12 zpic*.png -o DuoprismStereo.gif</span></span>
<span id="cb2-199"><a href="#cb2-199"></a><span class="co">*/</span></span></code></pre></div>
<p><img src="./figures/DuoprismStereo_Asy.gif" /></p>
<h1 id="with-pov-ray">With POV-Ray</h1>
<div class="sourceCode" id="cb3"><pre class="sourceCode numberSource povray numberLines"><code class="sourceCode povray"><span id="cb3-1"><a href="#cb3-1"></a><span class="ot">#version</span> <span class="fl">3.7</span>;</span>
<span id="cb3-2"><a href="#cb3-2"></a><span class="kw">global_settings</span> { <span class="kw">assumed_gamma</span> <span class="fl">1</span> }</span>
<span id="cb3-3"><a href="#cb3-3"></a><span class="ot">#include</span> <span class="st">&quot;colors.inc&quot;</span></span>
<span id="cb3-4"><a href="#cb3-4"></a><span class="ot">#include</span> <span class="st">&quot;textures.inc&quot;</span></span>
<span id="cb3-5"><a href="#cb3-5"></a></span>
<span id="cb3-6"><a href="#cb3-6"></a><span class="co">/* camera */</span></span>
<span id="cb3-7"><a href="#cb3-7"></a><span class="kw">camera</span> {</span>
<span id="cb3-8"><a href="#cb3-8"></a>  <span class="kw">location</span> &lt;-<span class="fl">11</span>, <span class="fl">7</span>, <span class="fl">-32</span>&gt;</span>
<span id="cb3-9"><a href="#cb3-9"></a>  <span class="kw">look_at</span> <span class="fl">0</span></span>
<span id="cb3-10"><a href="#cb3-10"></a>  <span class="kw">angle</span> <span class="fl">45</span></span>
<span id="cb3-11"><a href="#cb3-11"></a>  <span class="kw">right</span> <span class="kw">x</span>*<span class="kw">image_width</span>/<span class="kw">image_height</span></span>
<span id="cb3-12"><a href="#cb3-12"></a>}</span>
<span id="cb3-13"><a href="#cb3-13"></a></span>
<span id="cb3-14"><a href="#cb3-14"></a><span class="co">// sun -------------------------------------------------------------------------</span></span>
<span id="cb3-15"><a href="#cb3-15"></a><span class="kw">light_source</span> {&lt; <span class="fl">4000</span>,<span class="fl">6000</span>,-<span class="fl">6000</span>&gt; <span class="kw">color</span> <span class="kw">rgb</span>&lt;<span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span>&gt;*<span class="fl">0.9</span>}           <span class="co">// sun </span></span>
<span id="cb3-16"><a href="#cb3-16"></a><span class="kw">light_source</span> {&lt;-<span class="fl">11</span>, <span class="fl">7</span>,-<span class="fl">32</span>&gt;  <span class="kw">color</span> <span class="kw">rgb</span>&lt;<span class="fl">0.9</span>,<span class="fl">0.9</span>,<span class="fl">1</span>&gt;*<span class="fl">0.1</span> <span class="kw">shadowless</span>} <span class="co">// flash</span></span>
<span id="cb3-17"><a href="#cb3-17"></a></span>
<span id="cb3-18"><a href="#cb3-18"></a><span class="co">// sky -------------------------------------------------------------------------</span></span>
<span id="cb3-19"><a href="#cb3-19"></a><span class="kw">plane</span> {</span>
<span id="cb3-20"><a href="#cb3-20"></a>  &lt;<span class="fl">0</span>,<span class="fl">1</span>,<span class="fl">0</span>&gt;, <span class="fl">1</span> <span class="kw">hollow</span>  </span>
<span id="cb3-21"><a href="#cb3-21"></a>  <span class="kw">texture</span> {</span>
<span id="cb3-22"><a href="#cb3-22"></a>    <span class="kw">pigment</span> { </span>
<span id="cb3-23"><a href="#cb3-23"></a>      <span class="kw">bozo</span> <span class="kw">turbulence</span> <span class="fl">1.3</span></span>
<span id="cb3-24"><a href="#cb3-24"></a>      <span class="kw">color_map</span> {</span>
<span id="cb3-25"><a href="#cb3-25"></a>        [<span class="fl">0.00</span> <span class="kw">rgb</span> &lt;<span class="fl">0.24</span>, <span class="fl">0.32</span>, <span class="fl">1.0</span>&gt;*<span class="fl">0.6</span>]</span>
<span id="cb3-26"><a href="#cb3-26"></a>        [<span class="fl">0.75</span> <span class="kw">rgb</span> &lt;<span class="fl">0.24</span>, <span class="fl">0.32</span>, <span class="fl">1.0</span>&gt;*<span class="fl">0.6</span>]</span>
<span id="cb3-27"><a href="#cb3-27"></a>        [<span class="fl">0.83</span> <span class="kw">rgb</span> &lt;<span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span>&gt;]</span>
<span id="cb3-28"><a href="#cb3-28"></a>        [<span class="fl">0.95</span> <span class="kw">rgb</span> &lt;<span class="fl">0.25</span>,<span class="fl">0.25</span>,<span class="fl">0.25</span>&gt;]</span>
<span id="cb3-29"><a href="#cb3-29"></a>        [<span class="fl">1.0</span> <span class="kw">rgb</span> &lt;<span class="fl">0.5</span>,<span class="fl">0.5</span>,<span class="fl">0.5</span>&gt;]</span>
<span id="cb3-30"><a href="#cb3-30"></a>      }</span>
<span id="cb3-31"><a href="#cb3-31"></a>      <span class="kw">scale</span>&lt;<span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span>&gt;*<span class="fl">2.5</span>  <span class="kw">translate</span>&lt; <span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">3</span>&gt;</span>
<span id="cb3-32"><a href="#cb3-32"></a>    }</span>
<span id="cb3-33"><a href="#cb3-33"></a>    <span class="kw">finish</span> {</span>
<span id="cb3-34"><a href="#cb3-34"></a>      <span class="kw">ambient</span> <span class="fl">1</span> </span>
<span id="cb3-35"><a href="#cb3-35"></a>      <span class="kw">diffuse</span> <span class="fl">0</span></span>
<span id="cb3-36"><a href="#cb3-36"></a>    } </span>
<span id="cb3-37"><a href="#cb3-37"></a>  }      </span>
<span id="cb3-38"><a href="#cb3-38"></a>  <span class="kw">scale</span> <span class="fl">10000</span></span>
<span id="cb3-39"><a href="#cb3-39"></a>}</span>
<span id="cb3-40"><a href="#cb3-40"></a></span>
<span id="cb3-41"><a href="#cb3-41"></a><span class="co">// fog on the ground -----------------------------------------------------------</span></span>
<span id="cb3-42"><a href="#cb3-42"></a><span class="kw">fog</span> {</span>
<span id="cb3-43"><a href="#cb3-43"></a>  <span class="kw">fog_type</span>   <span class="fl">2</span></span>
<span id="cb3-44"><a href="#cb3-44"></a>  <span class="kw">distance</span>   <span class="fl">50</span></span>
<span id="cb3-45"><a href="#cb3-45"></a>  <span class="kw">color</span>      Gray10  </span>
<span id="cb3-46"><a href="#cb3-46"></a>  <span class="kw">fog_offset</span> <span class="fl">0.1</span></span>
<span id="cb3-47"><a href="#cb3-47"></a>  <span class="kw">fog_alt</span>    <span class="fl">1.5</span></span>
<span id="cb3-48"><a href="#cb3-48"></a>  <span class="kw">turbulence</span> <span class="fl">1.8</span></span>
<span id="cb3-49"><a href="#cb3-49"></a>}</span>
<span id="cb3-50"><a href="#cb3-50"></a></span>
<span id="cb3-51"><a href="#cb3-51"></a><span class="co">// ground ----------------------------------------------------------------------</span></span>
<span id="cb3-52"><a href="#cb3-52"></a><span class="kw">plane</span> {</span>
<span id="cb3-53"><a href="#cb3-53"></a>  &lt;<span class="fl">0</span>,<span class="fl">1</span>,<span class="fl">0</span>&gt;, <span class="fl">0</span> </span>
<span id="cb3-54"><a href="#cb3-54"></a>  <span class="kw">texture</span> {</span>
<span id="cb3-55"><a href="#cb3-55"></a>    <span class="kw">pigment</span> { <span class="kw">color</span> <span class="kw">rgb</span> &lt;<span class="fl">0.95</span>,<span class="fl">0.9</span>,<span class="fl">0.73</span>&gt;*<span class="fl">0.35</span> }</span>
<span id="cb3-56"><a href="#cb3-56"></a>    <span class="kw">normal</span> { <span class="kw">bumps</span> <span class="fl">2</span> <span class="kw">scale</span> &lt;<span class="fl">0.25</span>,<span class="fl">0.25</span>,<span class="fl">0.25</span>&gt;*<span class="fl">0.5</span> <span class="kw">turbulence</span> <span class="fl">0.5</span> } </span>
<span id="cb3-57"><a href="#cb3-57"></a>    <span class="kw">finish</span> { <span class="kw">phong</span> <span class="fl">0.1</span> }</span>
<span id="cb3-58"><a href="#cb3-58"></a>  } </span>
<span id="cb3-59"><a href="#cb3-59"></a>} </span>
<span id="cb3-60"><a href="#cb3-60"></a></span>
<span id="cb3-61"><a href="#cb3-61"></a></span>
<span id="cb3-62"><a href="#cb3-62"></a><span class="co">/* ----- vertices ----- */</span></span>
<span id="cb3-63"><a href="#cb3-63"></a><span class="kw">#declare A </span>= <span class="fl">4</span>;</span>
<span id="cb3-64"><a href="#cb3-64"></a><span class="kw">#declare B </span>= <span class="fl">30</span>;</span>
<span id="cb3-65"><a href="#cb3-65"></a></span>
<span id="cb3-66"><a href="#cb3-66"></a><span class="kw">#declare poly1 </span>= <span class="kw">array</span>[A];</span>
<span id="cb3-67"><a href="#cb3-67"></a>#for(i,<span class="fl">0</span>,A<span class="fl">-1</span>)</span>
<span id="cb3-68"><a href="#cb3-68"></a>  <span class="kw">#declare poly1</span>[i] = <span class="kw">array</span>[<span class="fl">2</span>] {<span class="kw">cos</span>(i/A*<span class="fl">2</span>*<span class="fl">pi</span>), <span class="kw">sin</span>(i/A*<span class="fl">2</span>*<span class="fl">pi</span>)};</span>
<span id="cb3-69"><a href="#cb3-69"></a><span class="ot">#end</span></span>
<span id="cb3-70"><a href="#cb3-70"></a><span class="kw">#declare poly2 </span>= <span class="kw">array</span>[B];</span>
<span id="cb3-71"><a href="#cb3-71"></a>#for(i,<span class="fl">0</span>,B<span class="fl">-1</span>)</span>
<span id="cb3-72"><a href="#cb3-72"></a>  <span class="kw">#declare poly2</span>[i] = <span class="kw">array</span>[<span class="fl">2</span>] {<span class="kw">cos</span>(i/B*<span class="fl">2</span>*<span class="fl">pi</span>), <span class="kw">sin</span>(i/B*<span class="fl">2</span>*<span class="fl">pi</span>)};</span>
<span id="cb3-73"><a href="#cb3-73"></a><span class="ot">#end</span></span>
<span id="cb3-74"><a href="#cb3-74"></a><span class="kw">#declare vertices </span>= <span class="kw">array</span>[A][B];</span>
<span id="cb3-75"><a href="#cb3-75"></a>#for(i,<span class="fl">0</span>,A<span class="fl">-1</span>)</span>
<span id="cb3-76"><a href="#cb3-76"></a>  #for(j,<span class="fl">0</span>,B<span class="fl">-1</span>)</span>
<span id="cb3-77"><a href="#cb3-77"></a>    <span class="kw">#declare vertices</span>[i][j] = </span>
<span id="cb3-78"><a href="#cb3-78"></a>      &lt; poly1[i][<span class="fl">0</span>], poly1[i][<span class="fl">1</span>], poly2[j][<span class="fl">0</span>], poly2[j][<span class="fl">1</span>] &gt;;</span>
<span id="cb3-79"><a href="#cb3-79"></a>  <span class="ot">#end</span></span>
<span id="cb3-80"><a href="#cb3-80"></a><span class="ot">#end</span></span>
<span id="cb3-81"><a href="#cb3-81"></a></span>
<span id="cb3-82"><a href="#cb3-82"></a><span class="co">/* ----- edges ----- */</span></span>
<span id="cb3-83"><a href="#cb3-83"></a><span class="kw">#macro dominates</span>(e1,e2)</span>
<span id="cb3-84"><a href="#cb3-84"></a>  (e2[<span class="fl">0</span>]&gt;e1[<span class="fl">0</span>]) | ((e2[<span class="fl">0</span>]=e1[<span class="fl">0</span>]) &amp; (e2[<span class="fl">1</span>]&gt;e1[<span class="fl">1</span>]))</span>
<span id="cb3-85"><a href="#cb3-85"></a><span class="ot">#end</span></span>
<span id="cb3-86"><a href="#cb3-86"></a><span class="kw">#declare nedges </span>= <span class="fl">2</span>*A*B;</span>
<span id="cb3-87"><a href="#cb3-87"></a><span class="kw">#declare edges </span>= <span class="kw">array</span>[nedges];</span>
<span id="cb3-88"><a href="#cb3-88"></a><span class="kw">#declare k</span>=<span class="fl">0</span>;</span>
<span id="cb3-89"><a href="#cb3-89"></a>#for(i,<span class="fl">0</span>,A<span class="fl">-1</span>)</span>
<span id="cb3-90"><a href="#cb3-90"></a>  #for(j,<span class="fl">0</span>,B<span class="fl">-1</span>)</span>
<span id="cb3-91"><a href="#cb3-91"></a>    <span class="kw">#local e </span>= <span class="kw">array</span>[<span class="fl">2</span>] {i,j};</span>
<span id="cb3-92"><a href="#cb3-92"></a>    <span class="kw">#local candidate </span>= <span class="kw">array</span>[<span class="fl">2</span>] {i,<span class="kw">mod</span>(<span class="kw">mod</span>(j<span class="fl">-1</span>,B)+B,B)};</span>
<span id="cb3-93"><a href="#cb3-93"></a>    <span class="ot">#if</span>(dominates(e,candidate))</span>
<span id="cb3-94"><a href="#cb3-94"></a>      <span class="kw">#local edge </span>= <span class="kw">array</span>[<span class="fl">2</span>] {e,candidate};</span>
<span id="cb3-95"><a href="#cb3-95"></a>      <span class="kw">#declare edges</span>[k] = edge;</span>
<span id="cb3-96"><a href="#cb3-96"></a>      <span class="kw">#declare k </span>= k+<span class="fl">1</span>;</span>
<span id="cb3-97"><a href="#cb3-97"></a>    <span class="ot">#end</span></span>
<span id="cb3-98"><a href="#cb3-98"></a>    <span class="kw">#local candidate </span>= <span class="kw">array</span>[<span class="fl">2</span>] {i,<span class="kw">mod</span>(<span class="kw">mod</span>(j+<span class="fl">1</span>,B)+B,B)};</span>
<span id="cb3-99"><a href="#cb3-99"></a>    <span class="ot">#if</span>(dominates(e,candidate))</span>
<span id="cb3-100"><a href="#cb3-100"></a>      <span class="kw">#local edge </span>= <span class="kw">array</span>[<span class="fl">2</span>] {e,candidate};</span>
<span id="cb3-101"><a href="#cb3-101"></a>      <span class="kw">#declare edges</span>[k] = edge;</span>
<span id="cb3-102"><a href="#cb3-102"></a>      <span class="kw">#declare k </span>= k+<span class="fl">1</span>;</span>
<span id="cb3-103"><a href="#cb3-103"></a>    <span class="ot">#end</span></span>
<span id="cb3-104"><a href="#cb3-104"></a>    <span class="kw">#local candidate </span>= <span class="kw">array</span>[<span class="fl">2</span>] {<span class="kw">mod</span>(<span class="kw">mod</span>(i<span class="fl">-1</span>,A)+A,A),j};</span>
<span id="cb3-105"><a href="#cb3-105"></a>    <span class="ot">#if</span>(dominates(e,candidate))</span>
<span id="cb3-106"><a href="#cb3-106"></a>      <span class="kw">#local edge </span>= <span class="kw">array</span>[<span class="fl">2</span>] {e,candidate};</span>
<span id="cb3-107"><a href="#cb3-107"></a>      <span class="kw">#declare edges</span>[k] = edge;</span>
<span id="cb3-108"><a href="#cb3-108"></a>      <span class="kw">#declare k </span>= k+<span class="fl">1</span>;</span>
<span id="cb3-109"><a href="#cb3-109"></a>    <span class="ot">#end</span></span>
<span id="cb3-110"><a href="#cb3-110"></a>    <span class="kw">#local candidate </span>= <span class="kw">array</span>[<span class="fl">2</span>] {<span class="kw">mod</span>(<span class="kw">mod</span>(i+<span class="fl">1</span>,A)+A,A),j};</span>
<span id="cb3-111"><a href="#cb3-111"></a>    <span class="ot">#if</span>(dominates(e,candidate))</span>
<span id="cb3-112"><a href="#cb3-112"></a>      <span class="kw">#local edge </span>= <span class="kw">array</span>[<span class="fl">2</span>] {e,candidate};</span>
<span id="cb3-113"><a href="#cb3-113"></a>      <span class="kw">#declare edges</span>[k] = edge;</span>
<span id="cb3-114"><a href="#cb3-114"></a>      <span class="kw">#declare k </span>= k+<span class="fl">1</span>;</span>
<span id="cb3-115"><a href="#cb3-115"></a>    <span class="ot">#end</span></span>
<span id="cb3-116"><a href="#cb3-116"></a>  <span class="ot">#end</span></span>
<span id="cb3-117"><a href="#cb3-117"></a><span class="ot">#end</span></span>
<span id="cb3-118"><a href="#cb3-118"></a></span>
<span id="cb3-119"><a href="#cb3-119"></a><span class="co">/* rotation in 4D space */</span></span>
<span id="cb3-120"><a href="#cb3-120"></a><span class="kw">#macro rotate4d</span>(theta,phi,xi,vec)</span>
<span id="cb3-121"><a href="#cb3-121"></a>  <span class="kw">#local a </span>= <span class="kw">cos</span>(xi);</span>
<span id="cb3-122"><a href="#cb3-122"></a>  <span class="kw">#local b </span>= <span class="kw">sin</span>(theta)*<span class="kw">cos</span>(phi)*<span class="kw">sin</span>(xi);</span>
<span id="cb3-123"><a href="#cb3-123"></a>  <span class="kw">#local c </span>= <span class="kw">sin</span>(theta)*<span class="kw">sin</span>(phi)*<span class="kw">sin</span>(xi);</span>
<span id="cb3-124"><a href="#cb3-124"></a>  <span class="kw">#local d </span>= <span class="kw">cos</span>(theta)*<span class="kw">sin</span>(xi);</span>
<span id="cb3-125"><a href="#cb3-125"></a>  <span class="kw">#local p </span>= vec.<span class="kw">x</span>;</span>
<span id="cb3-126"><a href="#cb3-126"></a>  <span class="kw">#local q </span>= vec.<span class="kw">y</span>;</span>
<span id="cb3-127"><a href="#cb3-127"></a>  <span class="kw">#local r </span>= vec.<span class="kw">z</span>;</span>
<span id="cb3-128"><a href="#cb3-128"></a>  <span class="kw">#local s </span>= vec.<span class="kw">t</span>;</span>
<span id="cb3-129"><a href="#cb3-129"></a>  &lt; a*p - b*q - c*r - d*s</span>
<span id="cb3-130"><a href="#cb3-130"></a>  , a*q + b*p + c*s - d*r</span>
<span id="cb3-131"><a href="#cb3-131"></a>  , a*r - b*s + c*p + d*q</span>
<span id="cb3-132"><a href="#cb3-132"></a>  , a*s + b*r - c*q + d*p &gt;</span>
<span id="cb3-133"><a href="#cb3-133"></a><span class="ot">#end</span></span>
<span id="cb3-134"><a href="#cb3-134"></a></span>
<span id="cb3-135"><a href="#cb3-135"></a><span class="co">/* stereographic projection */</span></span>
<span id="cb3-136"><a href="#cb3-136"></a><span class="kw">#macro StereographicProjection</span>(q)</span>
<span id="cb3-137"><a href="#cb3-137"></a>  &lt;q.<span class="kw">x</span>,q.<span class="kw">y</span>,q.<span class="kw">z</span>&gt; / (<span class="kw">sqrt</span>(<span class="fl">2</span>)-q.<span class="kw">t</span>)</span>
<span id="cb3-138"><a href="#cb3-138"></a><span class="ot">#end</span></span>
<span id="cb3-139"><a href="#cb3-139"></a></span>
<span id="cb3-140"><a href="#cb3-140"></a><span class="co">/* rotated and projected vertices */</span></span>
<span id="cb3-141"><a href="#cb3-141"></a><span class="kw">#macro ProjectedVertices</span>(theta,phi,xi)</span>
<span id="cb3-142"><a href="#cb3-142"></a>  <span class="kw">#local out </span>= <span class="kw">array</span>[A][B];</span>
<span id="cb3-143"><a href="#cb3-143"></a>  #for(i,<span class="fl">0</span>,A<span class="fl">-1</span>)</span>
<span id="cb3-144"><a href="#cb3-144"></a>    #for(j,<span class="fl">0</span>,B<span class="fl">-1</span>)</span>
<span id="cb3-145"><a href="#cb3-145"></a>      <span class="kw">#local out</span>[i][j] = StereographicProjection(</span>
<span id="cb3-146"><a href="#cb3-146"></a>                            rotate4d(theta,phi,xi,vertices[i][j])</span>
<span id="cb3-147"><a href="#cb3-147"></a>                          );</span>
<span id="cb3-148"><a href="#cb3-148"></a>    <span class="ot">#end</span></span>
<span id="cb3-149"><a href="#cb3-149"></a>  <span class="ot">#end</span></span>
<span id="cb3-150"><a href="#cb3-150"></a>  out</span>
<span id="cb3-151"><a href="#cb3-151"></a><span class="ot">#end</span></span>
<span id="cb3-152"><a href="#cb3-152"></a></span>
<span id="cb3-153"><a href="#cb3-153"></a><span class="co">/* macro spherical segment */</span></span>
<span id="cb3-154"><a href="#cb3-154"></a><span class="kw">#macro vlength4</span>(P)</span>
<span id="cb3-155"><a href="#cb3-155"></a>  <span class="kw">sqrt</span>(P.<span class="kw">x</span>*P.<span class="kw">x</span> + P.<span class="kw">y</span>*P.<span class="kw">y</span> + P.<span class="kw">z</span>*P.<span class="kw">z</span> + P.<span class="kw">t</span>*P.<span class="kw">t</span>)</span>
<span id="cb3-156"><a href="#cb3-156"></a><span class="ot">#end</span></span>
<span id="cb3-157"><a href="#cb3-157"></a></span>
<span id="cb3-158"><a href="#cb3-158"></a><span class="kw">#macro sphericalSegment</span>(P, Q, n)</span>
<span id="cb3-159"><a href="#cb3-159"></a>  <span class="kw">#local out </span>= <span class="kw">array</span>[n+<span class="fl">1</span>];</span>
<span id="cb3-160"><a href="#cb3-160"></a>  #for(i, <span class="fl">0</span>, n)</span>
<span id="cb3-161"><a href="#cb3-161"></a>    <span class="kw">#local pt </span>= P + (i/n)*(Q-P);</span>
<span id="cb3-162"><a href="#cb3-162"></a>    <span class="kw">#local out</span>[i] = <span class="kw">sqrt</span>(<span class="fl">2</span>)/vlength4(pt) * pt;</span>
<span id="cb3-163"><a href="#cb3-163"></a>  <span class="ot">#end</span></span>
<span id="cb3-164"><a href="#cb3-164"></a>  out</span>
<span id="cb3-165"><a href="#cb3-165"></a><span class="ot">#end</span></span>
<span id="cb3-166"><a href="#cb3-166"></a></span>
<span id="cb3-167"><a href="#cb3-167"></a><span class="co">/* macro to draw an edge */</span></span>
<span id="cb3-168"><a href="#cb3-168"></a><span class="kw">#macro Edge</span>(verts, v1, v2, theta, phi, xi, Tex)</span>
<span id="cb3-169"><a href="#cb3-169"></a>  <span class="kw">#local P </span>= verts[v1[<span class="fl">0</span>]][v1[<span class="fl">1</span>]];</span>
<span id="cb3-170"><a href="#cb3-170"></a>  <span class="kw">#local Q </span>= verts[v2[<span class="fl">0</span>]][v2[<span class="fl">1</span>]];</span>
<span id="cb3-171"><a href="#cb3-171"></a>  <span class="kw">#local PQ </span>= sphericalSegment(P, Q, <span class="fl">100</span>);</span>
<span id="cb3-172"><a href="#cb3-172"></a>  <span class="kw">sphere_sweep</span> {</span>
<span id="cb3-173"><a href="#cb3-173"></a>    <span class="kw">b_spline</span> <span class="fl">101</span></span>
<span id="cb3-174"><a href="#cb3-174"></a>    #for(k,<span class="fl">0</span>,<span class="fl">100</span>)</span>
<span id="cb3-175"><a href="#cb3-175"></a>      <span class="kw">#local O </span>= </span>
<span id="cb3-176"><a href="#cb3-176"></a>        StereographicProjection(rotate4d(theta,phi,xi,PQ[k]));</span>
<span id="cb3-177"><a href="#cb3-177"></a>      O <span class="kw">vlength</span>(O)/<span class="fl">15</span></span>
<span id="cb3-178"><a href="#cb3-178"></a>    <span class="ot">#end</span></span>
<span id="cb3-179"><a href="#cb3-179"></a>    <span class="kw">texture</span> { Tex }</span>
<span id="cb3-180"><a href="#cb3-180"></a>  }</span>
<span id="cb3-181"><a href="#cb3-181"></a><span class="ot">#end</span></span>
<span id="cb3-182"><a href="#cb3-182"></a></span>
<span id="cb3-183"><a href="#cb3-183"></a><span class="co">/*-----------------------------------------*/</span></span>
<span id="cb3-184"><a href="#cb3-184"></a><span class="co">/*-----      draw the duoprism       ------*/</span></span>
<span id="cb3-185"><a href="#cb3-185"></a><span class="co">/*-----------------------------------------*/</span></span>
<span id="cb3-186"><a href="#cb3-186"></a><span class="kw">#declare theta </span>= <span class="fl">pi</span>/<span class="fl">2</span>;</span>
<span id="cb3-187"><a href="#cb3-187"></a><span class="kw">#declare phi </span>= <span class="fl">0</span>;</span>
<span id="cb3-188"><a href="#cb3-188"></a><span class="kw">#declare xi </span>= <span class="fl">2</span>*<span class="kw">frame_number</span>*<span class="fl">pi</span>/<span class="fl">180</span>; </span>
<span id="cb3-189"><a href="#cb3-189"></a></span>
<span id="cb3-190"><a href="#cb3-190"></a><span class="kw">#declare vs </span>= ProjectedVertices(theta, phi, xi);</span>
<span id="cb3-191"><a href="#cb3-191"></a></span>
<span id="cb3-192"><a href="#cb3-192"></a><span class="kw">#declare edgeTexture </span>= <span class="kw">texture</span> {</span>
<span id="cb3-193"><a href="#cb3-193"></a>  <span class="kw">pigment</span> { <span class="kw">color</span> Red }</span>
<span id="cb3-194"><a href="#cb3-194"></a>  <span class="kw">finish</span> {</span>
<span id="cb3-195"><a href="#cb3-195"></a>    <span class="kw">ambient</span> <span class="fl">.1</span></span>
<span id="cb3-196"><a href="#cb3-196"></a>    <span class="kw">diffuse</span> <span class="fl">.9</span></span>
<span id="cb3-197"><a href="#cb3-197"></a>    <span class="kw">reflection</span> <span class="fl">0</span></span>
<span id="cb3-198"><a href="#cb3-198"></a>    <span class="kw">specular</span> <span class="fl">1</span></span>
<span id="cb3-199"><a href="#cb3-199"></a>    <span class="kw">metallic</span></span>
<span id="cb3-200"><a href="#cb3-200"></a>  }</span>
<span id="cb3-201"><a href="#cb3-201"></a>};</span>
<span id="cb3-202"><a href="#cb3-202"></a></span>
<span id="cb3-203"><a href="#cb3-203"></a><span class="kw">object</span> {</span>
<span id="cb3-204"><a href="#cb3-204"></a>  <span class="kw">union</span> {</span>
<span id="cb3-205"><a href="#cb3-205"></a>    <span class="co">/* draw edges */</span></span>
<span id="cb3-206"><a href="#cb3-206"></a>    #for(i, <span class="fl">0</span>, <span class="fl">2</span>*A*B<span class="fl">-1</span>)</span>
<span id="cb3-207"><a href="#cb3-207"></a>      Edge(vertices, edges[i][<span class="fl">0</span>], edges[i][<span class="fl">1</span>], </span>
<span id="cb3-208"><a href="#cb3-208"></a>                    theta, phi, xi, edgeTexture)</span>
<span id="cb3-209"><a href="#cb3-209"></a>    <span class="ot">#end</span></span>
<span id="cb3-210"><a href="#cb3-210"></a>    <span class="co">/* draw vertices */</span></span>
<span id="cb3-211"><a href="#cb3-211"></a>    #for(i,<span class="fl">0</span>,A<span class="fl">-1</span>)</span>
<span id="cb3-212"><a href="#cb3-212"></a>      #for(j,<span class="fl">0</span>,B<span class="fl">-1</span>)</span>
<span id="cb3-213"><a href="#cb3-213"></a>        <span class="kw">sphere</span> {</span>
<span id="cb3-214"><a href="#cb3-214"></a>          vs[i][j], <span class="kw">vlength</span>(vs[i][j])/<span class="fl">10</span></span>
<span id="cb3-215"><a href="#cb3-215"></a>          <span class="kw">texture</span> { edgeTexture }</span>
<span id="cb3-216"><a href="#cb3-216"></a>        }</span>
<span id="cb3-217"><a href="#cb3-217"></a>      <span class="ot">#end</span></span>
<span id="cb3-218"><a href="#cb3-218"></a>    <span class="ot">#end</span>  </span>
<span id="cb3-219"><a href="#cb3-219"></a>  }</span>
<span id="cb3-220"><a href="#cb3-220"></a>  <span class="kw">translate</span> &lt;-<span class="fl">3</span>, <span class="fl">6</span>, <span class="fl">-15</span>&gt;</span>
<span id="cb3-221"><a href="#cb3-221"></a>  <span class="kw">scale</span> <span class="fl">0.8</span></span>
<span id="cb3-222"><a href="#cb3-222"></a>}</span>
<span id="cb3-223"><a href="#cb3-223"></a></span>
<span id="cb3-224"><a href="#cb3-224"></a><span class="co">/* ini file </span></span>
<span id="cb3-225"><a href="#cb3-225"></a><span class="co">Width = 512</span></span>
<span id="cb3-226"><a href="#cb3-226"></a><span class="co">Height = 512</span></span>
<span id="cb3-227"><a href="#cb3-227"></a><span class="co">Antialias = On</span></span>
<span id="cb3-228"><a href="#cb3-228"></a><span class="co">Antialias_Threshold = 0.3</span></span>
<span id="cb3-229"><a href="#cb3-229"></a><span class="co">Input_File_Name = DuoprismStereographic.pov</span></span>
<span id="cb3-230"><a href="#cb3-230"></a><span class="co">Initial_Clock = 0</span></span>
<span id="cb3-231"><a href="#cb3-231"></a><span class="co">Final_Clock = 1</span></span>
<span id="cb3-232"><a href="#cb3-232"></a><span class="co">Initial_Frame = 0</span></span>
<span id="cb3-233"><a href="#cb3-233"></a><span class="co">Final_Frame = 179</span></span>
<span id="cb3-234"><a href="#cb3-234"></a><span class="co">Subset_Start_Frame = 0</span></span>
<span id="cb3-235"><a href="#cb3-235"></a><span class="co">Cyclic_Animation = on</span></span>
<span id="cb3-236"><a href="#cb3-236"></a><span class="co">*/</span></span></code></pre></div>
<p><img src="./figures/DuoprismStereo_POVRAY.gif" /></p>
<p><br/></p>
<p>Here is another one. This is a hexagonal duoprism with a cell colored in red.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode povray"><code class="sourceCode povray"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true"></a><span class="ot">#version</span> <span class="fl">3.7</span>;</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true"></a><span class="kw">global_settings</span> { <span class="kw">assumed_gamma</span> <span class="fl">1</span> } </span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true"></a><span class="ot">#include</span> <span class="st">&quot;colors.inc&quot;</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true"></a><span class="ot">#include</span> <span class="st">&quot;textures.inc&quot;</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true"></a></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true"></a><span class="co">// camera ----------------------------------------------------------------------</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true"></a><span class="kw">camera</span> {</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true"></a>  <span class="kw">location</span> &lt;<span class="fl">0</span>, <span class="fl">0</span>,-<span class="fl">10</span>&gt;</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true"></a>  <span class="kw">look_at</span> <span class="fl">0</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true"></a>  <span class="kw">angle</span> <span class="fl">45</span></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true"></a>  <span class="kw">right</span> <span class="kw">x</span>*<span class="kw">image_width</span>/<span class="kw">image_height</span></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true"></a>}</span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true"></a></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true"></a><span class="co">// light sources ---------------------------------------------------------------</span></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true"></a><span class="kw">light_source</span> { &lt;<span class="fl">0</span>,<span class="fl">0</span>,-<span class="fl">100</span>&gt; White <span class="kw">shadowless</span> } </span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true"></a><span class="kw">light_source</span> { &lt;<span class="fl">100</span>,<span class="fl">0</span>,-<span class="fl">100</span>&gt; White <span class="kw">shadowless</span> } </span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true"></a></span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true"></a><span class="co">// moon ------------------------------------------------------------------------</span></span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true"></a><span class="kw">light_source</span> { </span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true"></a>  &lt;-<span class="fl">1000</span>, <span class="fl">800</span>, <span class="fl">3000</span>&gt; </span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true"></a>  <span class="kw">color</span> White</span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true"></a>  <span class="kw">shadowless</span></span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true"></a>  <span class="kw">looks_like</span> { </span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true"></a>    <span class="kw">sphere</span> { </span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true"></a>      &lt;<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span>&gt;, <span class="fl">300</span> </span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true"></a>      <span class="kw">texture</span> { </span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true"></a>        <span class="kw">pigment</span> { </span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true"></a>          <span class="kw">color</span> Yellow</span>
<span id="cb4-29"><a href="#cb4-29" aria-hidden="true"></a>        }</span>
<span id="cb4-30"><a href="#cb4-30" aria-hidden="true"></a>        <span class="kw">normal</span> { </span>
<span id="cb4-31"><a href="#cb4-31" aria-hidden="true"></a>          <span class="kw">bumps</span> <span class="fl">0.5</span></span>
<span id="cb4-32"><a href="#cb4-32" aria-hidden="true"></a>          <span class="kw">scale</span> <span class="fl">50</span></span>
<span id="cb4-33"><a href="#cb4-33" aria-hidden="true"></a>        }</span>
<span id="cb4-34"><a href="#cb4-34" aria-hidden="true"></a>        <span class="kw">finish</span> { </span>
<span id="cb4-35"><a href="#cb4-35" aria-hidden="true"></a>          <span class="kw">emission</span> <span class="fl">0.8</span>   </span>
<span id="cb4-36"><a href="#cb4-36" aria-hidden="true"></a>          <span class="kw">diffuse</span> <span class="fl">0.2</span></span>
<span id="cb4-37"><a href="#cb4-37" aria-hidden="true"></a>          <span class="kw">phong</span> <span class="fl">1</span></span>
<span id="cb4-38"><a href="#cb4-38" aria-hidden="true"></a>        }                                        </span>
<span id="cb4-39"><a href="#cb4-39" aria-hidden="true"></a>      } </span>
<span id="cb4-40"><a href="#cb4-40" aria-hidden="true"></a>    } </span>
<span id="cb4-41"><a href="#cb4-41" aria-hidden="true"></a>  } </span>
<span id="cb4-42"><a href="#cb4-42" aria-hidden="true"></a>} </span>
<span id="cb4-43"><a href="#cb4-43" aria-hidden="true"></a></span>
<span id="cb4-44"><a href="#cb4-44" aria-hidden="true"></a><span class="co">// sky -------------------------------------------------------------------------</span></span>
<span id="cb4-45"><a href="#cb4-45" aria-hidden="true"></a><span class="kw">plane</span> { </span>
<span id="cb4-46"><a href="#cb4-46" aria-hidden="true"></a>  &lt;<span class="fl">0</span>,<span class="fl">1</span>,<span class="fl">0</span>&gt;, <span class="fl">1</span> <span class="kw">hollow</span>  </span>
<span id="cb4-47"><a href="#cb4-47" aria-hidden="true"></a>  <span class="kw">texture</span> { </span>
<span id="cb4-48"><a href="#cb4-48" aria-hidden="true"></a>    <span class="kw">pigment</span> { </span>
<span id="cb4-49"><a href="#cb4-49" aria-hidden="true"></a>      <span class="kw">color</span> <span class="kw">rgb</span> &lt;<span class="fl">0.01</span>, <span class="fl">0.01</span>, <span class="fl">0.2</span>&gt; </span>
<span id="cb4-50"><a href="#cb4-50" aria-hidden="true"></a>    }</span>
<span id="cb4-51"><a href="#cb4-51" aria-hidden="true"></a>    <span class="kw">finish</span> { </span>
<span id="cb4-52"><a href="#cb4-52" aria-hidden="true"></a>      <span class="kw">emission</span> <span class="fl">0.5</span> </span>
<span id="cb4-53"><a href="#cb4-53" aria-hidden="true"></a>      <span class="kw">diffuse</span> <span class="fl">0.5</span> </span>
<span id="cb4-54"><a href="#cb4-54" aria-hidden="true"></a>    } </span>
<span id="cb4-55"><a href="#cb4-55" aria-hidden="true"></a>  }  </span>
<span id="cb4-56"><a href="#cb4-56" aria-hidden="true"></a>  <span class="kw">scale</span> <span class="fl">10000</span></span>
<span id="cb4-57"><a href="#cb4-57" aria-hidden="true"></a>}</span>
<span id="cb4-58"><a href="#cb4-58" aria-hidden="true"></a></span>
<span id="cb4-59"><a href="#cb4-59" aria-hidden="true"></a><span class="co">// the clouds ------------------------------------------------------------------</span></span>
<span id="cb4-60"><a href="#cb4-60" aria-hidden="true"></a><span class="kw">plane</span> { </span>
<span id="cb4-61"><a href="#cb4-61" aria-hidden="true"></a>  &lt;<span class="fl">0</span>,<span class="fl">1</span>,<span class="fl">0</span>&gt;,<span class="fl">1</span> <span class="kw">hollow</span>  </span>
<span id="cb4-62"><a href="#cb4-62" aria-hidden="true"></a>  <span class="kw">texture</span> { </span>
<span id="cb4-63"><a href="#cb4-63" aria-hidden="true"></a>    <span class="kw">pigment</span> { </span>
<span id="cb4-64"><a href="#cb4-64" aria-hidden="true"></a>      <span class="kw">bozo</span> <span class="kw">turbulence</span> <span class="fl">1.3</span></span>
<span id="cb4-65"><a href="#cb4-65" aria-hidden="true"></a>      <span class="kw">color_map</span> { </span>
<span id="cb4-66"><a href="#cb4-66" aria-hidden="true"></a>        [<span class="fl">0.00</span> <span class="kw">rgb</span> &lt;<span class="fl">0.24</span>, <span class="fl">0.32</span>, <span class="fl">1.0</span>&gt;*<span class="fl">0.6</span>]</span>
<span id="cb4-67"><a href="#cb4-67" aria-hidden="true"></a>        [<span class="fl">0.75</span> <span class="kw">rgb</span> &lt;<span class="fl">0.24</span>, <span class="fl">0.32</span>, <span class="fl">1.0</span>&gt;*<span class="fl">0.6</span>]</span>
<span id="cb4-68"><a href="#cb4-68" aria-hidden="true"></a>        [<span class="fl">0.83</span> <span class="kw">rgb</span> &lt;<span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span>&gt;              ]</span>
<span id="cb4-69"><a href="#cb4-69" aria-hidden="true"></a>        [<span class="fl">0.95</span> <span class="kw">rgb</span> &lt;<span class="fl">0.25</span>,<span class="fl">0.25</span>,<span class="fl">0.25</span>&gt;     ]</span>
<span id="cb4-70"><a href="#cb4-70" aria-hidden="true"></a>        [<span class="fl">1.00</span> <span class="kw">rgb</span> &lt;<span class="fl">0.5</span>,<span class="fl">0.5</span>,<span class="fl">0.5</span>&gt;        ]</span>
<span id="cb4-71"><a href="#cb4-71" aria-hidden="true"></a>      }</span>
<span id="cb4-72"><a href="#cb4-72" aria-hidden="true"></a>      <span class="kw">scale</span> <span class="fl">2.5</span></span>
<span id="cb4-73"><a href="#cb4-73" aria-hidden="true"></a>      <span class="kw">translate</span> &lt;<span class="fl">0</span>,<span class="fl">1</span>,<span class="fl">0</span>&gt;</span>
<span id="cb4-74"><a href="#cb4-74" aria-hidden="true"></a>    }</span>
<span id="cb4-75"><a href="#cb4-75" aria-hidden="true"></a>    <span class="kw">finish</span> { </span>
<span id="cb4-76"><a href="#cb4-76" aria-hidden="true"></a>      <span class="kw">emission</span> <span class="fl">0.25</span> </span>
<span id="cb4-77"><a href="#cb4-77" aria-hidden="true"></a>      <span class="kw">diffuse</span> <span class="fl">0</span></span>
<span id="cb4-78"><a href="#cb4-78" aria-hidden="true"></a>    } </span>
<span id="cb4-79"><a href="#cb4-79" aria-hidden="true"></a>  }      </span>
<span id="cb4-80"><a href="#cb4-80" aria-hidden="true"></a>  <span class="kw">scale</span> <span class="fl">5000</span></span>
<span id="cb4-81"><a href="#cb4-81" aria-hidden="true"></a>}</span>
<span id="cb4-82"><a href="#cb4-82" aria-hidden="true"></a></span>
<span id="cb4-83"><a href="#cb4-83" aria-hidden="true"></a><span class="co">// fog on the ground -----------------------------------------------------------</span></span>
<span id="cb4-84"><a href="#cb4-84" aria-hidden="true"></a><span class="kw">fog</span> { </span>
<span id="cb4-85"><a href="#cb4-85" aria-hidden="true"></a>  <span class="kw">fog_type</span>   <span class="fl">2</span></span>
<span id="cb4-86"><a href="#cb4-86" aria-hidden="true"></a>  <span class="kw">distance</span>   <span class="fl">50</span></span>
<span id="cb4-87"><a href="#cb4-87" aria-hidden="true"></a>  <span class="kw">color</span>      Gray50  </span>
<span id="cb4-88"><a href="#cb4-88" aria-hidden="true"></a>  <span class="kw">fog_offset</span> <span class="fl">0.1</span></span>
<span id="cb4-89"><a href="#cb4-89" aria-hidden="true"></a>  <span class="kw">fog_alt</span>    <span class="fl">1.5</span></span>
<span id="cb4-90"><a href="#cb4-90" aria-hidden="true"></a>  <span class="kw">turbulence</span> <span class="fl">1.8</span></span>
<span id="cb4-91"><a href="#cb4-91" aria-hidden="true"></a>}</span>
<span id="cb4-92"><a href="#cb4-92" aria-hidden="true"></a></span>
<span id="cb4-93"><a href="#cb4-93" aria-hidden="true"></a><span class="co">// sea -------------------------------------------------------------------------</span></span>
<span id="cb4-94"><a href="#cb4-94" aria-hidden="true"></a><span class="kw">plane</span> { </span>
<span id="cb4-95"><a href="#cb4-95" aria-hidden="true"></a>  &lt;<span class="fl">0</span>,<span class="fl">1</span>,<span class="fl">0</span>&gt;, <span class="fl">-1</span> <span class="kw">hollow</span></span>
<span id="cb4-96"><a href="#cb4-96" aria-hidden="true"></a>  <span class="kw">texture</span>{</span>
<span id="cb4-97"><a href="#cb4-97" aria-hidden="true"></a>    <span class="kw">pigment</span>{</span>
<span id="cb4-98"><a href="#cb4-98" aria-hidden="true"></a>      <span class="kw">rgb</span> &lt;.<span class="fl">098</span>,.<span class="fl">098</span>,.<span class="fl">439</span>&gt;</span>
<span id="cb4-99"><a href="#cb4-99" aria-hidden="true"></a>    }</span>
<span id="cb4-100"><a href="#cb4-100" aria-hidden="true"></a>    <span class="kw">finish</span> {</span>
<span id="cb4-101"><a href="#cb4-101" aria-hidden="true"></a>      <span class="kw">ambient</span> <span class="fl">0.15</span></span>
<span id="cb4-102"><a href="#cb4-102" aria-hidden="true"></a>      <span class="kw">diffuse</span> <span class="fl">0.55</span></span>
<span id="cb4-103"><a href="#cb4-103" aria-hidden="true"></a>      <span class="kw">brilliance</span> <span class="fl">6.0</span></span>
<span id="cb4-104"><a href="#cb4-104" aria-hidden="true"></a>      <span class="kw">phong</span> <span class="fl">0.8</span></span>
<span id="cb4-105"><a href="#cb4-105" aria-hidden="true"></a>      <span class="kw">phong_size</span> <span class="fl">120</span></span>
<span id="cb4-106"><a href="#cb4-106" aria-hidden="true"></a>      <span class="kw">reflection</span> <span class="fl">0.2</span></span>
<span id="cb4-107"><a href="#cb4-107" aria-hidden="true"></a>    }</span>
<span id="cb4-108"><a href="#cb4-108" aria-hidden="true"></a>    <span class="kw">normal</span> { </span>
<span id="cb4-109"><a href="#cb4-109" aria-hidden="true"></a>      <span class="kw">bumps</span> <span class="fl">0.95</span></span>
<span id="cb4-110"><a href="#cb4-110" aria-hidden="true"></a>      <span class="kw">turbulence</span> <span class="fl">.05</span> </span>
<span id="cb4-111"><a href="#cb4-111" aria-hidden="true"></a>      <span class="kw">scale</span> &lt;<span class="fl">1</span>,<span class="fl">0.25</span>,<span class="fl">1</span>&gt; </span>
<span id="cb4-112"><a href="#cb4-112" aria-hidden="true"></a>    }</span>
<span id="cb4-113"><a href="#cb4-113" aria-hidden="true"></a>  }</span>
<span id="cb4-114"><a href="#cb4-114" aria-hidden="true"></a>}</span>
<span id="cb4-115"><a href="#cb4-115" aria-hidden="true"></a></span>
<span id="cb4-116"><a href="#cb4-116" aria-hidden="true"></a><span class="co">// vertices --------------------------------------------------------------------</span></span>
<span id="cb4-117"><a href="#cb4-117" aria-hidden="true"></a><span class="kw">#declare a </span>= <span class="kw">sqrt</span>(<span class="fl">3</span>) / <span class="fl">2</span>;</span>
<span id="cb4-118"><a href="#cb4-118" aria-hidden="true"></a><span class="kw">#declare vertices </span>= <span class="kw">array</span>[<span class="fl">36</span>]</span>
<span id="cb4-119"><a href="#cb4-119" aria-hidden="true"></a>  {</span>
<span id="cb4-120"><a href="#cb4-120" aria-hidden="true"></a>    &lt;a, <span class="fl">0.5</span>, a, <span class="fl">0.5</span>&gt;,</span>
<span id="cb4-121"><a href="#cb4-121" aria-hidden="true"></a>    &lt;a, <span class="fl">0.5</span>, <span class="fl">0.0</span>, <span class="fl">1.0</span>&gt;,</span>
<span id="cb4-122"><a href="#cb4-122" aria-hidden="true"></a>    &lt;a, <span class="fl">0.5</span>, -a, <span class="fl">0.5</span>&gt;,</span>
<span id="cb4-123"><a href="#cb4-123" aria-hidden="true"></a>    &lt;a, <span class="fl">0.5</span>, -a, <span class="fl">-0.5</span>&gt;,</span>
<span id="cb4-124"><a href="#cb4-124" aria-hidden="true"></a>    &lt;a, <span class="fl">0.5</span>, <span class="fl">0.0</span>, <span class="fl">-1.0</span>&gt;,</span>
<span id="cb4-125"><a href="#cb4-125" aria-hidden="true"></a>    &lt;a, <span class="fl">0.5</span>, a, <span class="fl">-0.5</span>&gt;,</span>
<span id="cb4-126"><a href="#cb4-126" aria-hidden="true"></a>    &lt;<span class="fl">0.0</span>, <span class="fl">1.0</span>, a, <span class="fl">0.5</span>&gt;,</span>
<span id="cb4-127"><a href="#cb4-127" aria-hidden="true"></a>    &lt;<span class="fl">0.0</span>, <span class="fl">1.0</span>, <span class="fl">0.0</span>, <span class="fl">1.0</span>&gt;,</span>
<span id="cb4-128"><a href="#cb4-128" aria-hidden="true"></a>    &lt;<span class="fl">0.0</span>, <span class="fl">1.0</span>, -a, <span class="fl">0.5</span>&gt;,</span>
<span id="cb4-129"><a href="#cb4-129" aria-hidden="true"></a>    &lt;<span class="fl">0.0</span>, <span class="fl">1.0</span>, -a, <span class="fl">-0.5</span>&gt;,</span>
<span id="cb4-130"><a href="#cb4-130" aria-hidden="true"></a>    &lt;<span class="fl">0.0</span>, <span class="fl">1.0</span>, <span class="fl">0.0</span>, <span class="fl">-1.0</span>&gt;,</span>
<span id="cb4-131"><a href="#cb4-131" aria-hidden="true"></a>    &lt;<span class="fl">0.0</span>, <span class="fl">1.0</span>, a, <span class="fl">-0.5</span>&gt;,</span>
<span id="cb4-132"><a href="#cb4-132" aria-hidden="true"></a>    &lt;-a, <span class="fl">0.5</span>, a, <span class="fl">0.5</span>&gt;,</span>
<span id="cb4-133"><a href="#cb4-133" aria-hidden="true"></a>    &lt;-a, <span class="fl">0.5</span>, <span class="fl">0.0</span>, <span class="fl">1.0</span>&gt;,</span>
<span id="cb4-134"><a href="#cb4-134" aria-hidden="true"></a>    &lt;-a, <span class="fl">0.5</span>, -a, <span class="fl">0.5</span>&gt;,</span>
<span id="cb4-135"><a href="#cb4-135" aria-hidden="true"></a>    &lt;-a, <span class="fl">0.5</span>, -a, <span class="fl">-0.5</span>&gt;,</span>
<span id="cb4-136"><a href="#cb4-136" aria-hidden="true"></a>    &lt;-a, <span class="fl">0.5</span>, <span class="fl">0.0</span>, <span class="fl">-1.0</span>&gt;,</span>
<span id="cb4-137"><a href="#cb4-137" aria-hidden="true"></a>    &lt;-a, <span class="fl">0.5</span>, a, <span class="fl">-0.5</span>&gt;,</span>
<span id="cb4-138"><a href="#cb4-138" aria-hidden="true"></a>    &lt;-a, <span class="fl">-0.5</span>, a, <span class="fl">0.5</span>&gt;,</span>
<span id="cb4-139"><a href="#cb4-139" aria-hidden="true"></a>    &lt;-a, <span class="fl">-0.5</span>, <span class="fl">0.0</span>, <span class="fl">1.0</span>&gt;,</span>
<span id="cb4-140"><a href="#cb4-140" aria-hidden="true"></a>    &lt;-a, <span class="fl">-0.5</span>, -a, <span class="fl">0.5</span>&gt;,</span>
<span id="cb4-141"><a href="#cb4-141" aria-hidden="true"></a>    &lt;-a, <span class="fl">-0.5</span>, -a, <span class="fl">-0.5</span>&gt;,</span>
<span id="cb4-142"><a href="#cb4-142" aria-hidden="true"></a>    &lt;-a, <span class="fl">-0.5</span>, <span class="fl">0.0</span>, <span class="fl">-1.0</span>&gt;,</span>
<span id="cb4-143"><a href="#cb4-143" aria-hidden="true"></a>    &lt;-a, <span class="fl">-0.5</span>, a, <span class="fl">-0.5</span>&gt;,</span>
<span id="cb4-144"><a href="#cb4-144" aria-hidden="true"></a>    &lt;<span class="fl">0.0</span>, <span class="fl">-1.0</span>, a, <span class="fl">0.5</span>&gt;,</span>
<span id="cb4-145"><a href="#cb4-145" aria-hidden="true"></a>    &lt;<span class="fl">0.0</span>, <span class="fl">-1.0</span>, <span class="fl">0.0</span>, <span class="fl">1.0</span>&gt;,</span>
<span id="cb4-146"><a href="#cb4-146" aria-hidden="true"></a>    &lt;<span class="fl">0.0</span>, <span class="fl">-1.0</span>, -a, <span class="fl">0.5</span>&gt;,</span>
<span id="cb4-147"><a href="#cb4-147" aria-hidden="true"></a>    &lt;<span class="fl">0.0</span>, <span class="fl">-1.0</span>, -a, <span class="fl">-0.5</span>&gt;,</span>
<span id="cb4-148"><a href="#cb4-148" aria-hidden="true"></a>    &lt;<span class="fl">0.0</span>, <span class="fl">-1.0</span>, <span class="fl">0.0</span>, <span class="fl">-1.0</span>&gt;,</span>
<span id="cb4-149"><a href="#cb4-149" aria-hidden="true"></a>    &lt;<span class="fl">0.0</span>, <span class="fl">-1.0</span>, a, <span class="fl">-0.5</span>&gt;,</span>
<span id="cb4-150"><a href="#cb4-150" aria-hidden="true"></a>    &lt;a, <span class="fl">-0.5</span>, a, <span class="fl">0.5</span>&gt;,</span>
<span id="cb4-151"><a href="#cb4-151" aria-hidden="true"></a>    &lt;a, <span class="fl">-0.5</span>, <span class="fl">0.0</span>, <span class="fl">1.0</span>&gt;,</span>
<span id="cb4-152"><a href="#cb4-152" aria-hidden="true"></a>    &lt;a, <span class="fl">-0.5</span>, -a, <span class="fl">0.5</span>&gt;,</span>
<span id="cb4-153"><a href="#cb4-153" aria-hidden="true"></a>    &lt;a, <span class="fl">-0.5</span>, -a, <span class="fl">-0.5</span>&gt;,</span>
<span id="cb4-154"><a href="#cb4-154" aria-hidden="true"></a>    &lt;a, <span class="fl">-0.5</span>, <span class="fl">0.0</span>, <span class="fl">-1.0</span>&gt;,</span>
<span id="cb4-155"><a href="#cb4-155" aria-hidden="true"></a>    &lt;a, <span class="fl">-0.5</span>, a, <span class="fl">-0.5</span>&gt;</span>
<span id="cb4-156"><a href="#cb4-156" aria-hidden="true"></a>  };</span>
<span id="cb4-157"><a href="#cb4-157" aria-hidden="true"></a><span class="kw">#declare facetVertices </span>= <span class="kw">array</span>[<span class="fl">12</span>] {<span class="fl">0</span>,<span class="fl">5</span>,<span class="fl">6</span>,<span class="fl">30</span>,<span class="fl">11</span>,<span class="fl">35</span>,<span class="fl">12</span>,<span class="fl">17</span>,<span class="fl">18</span>,<span class="fl">23</span>,<span class="fl">24</span>,<span class="fl">29</span>};</span>
<span id="cb4-158"><a href="#cb4-158" aria-hidden="true"></a><span class="kw">#declare otherVertices </span>= <span class="kw">array</span>[<span class="fl">24</span>] </span>
<span id="cb4-159"><a href="#cb4-159" aria-hidden="true"></a>  {<span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">3</span>,<span class="fl">4</span>,<span class="fl">7</span>,<span class="fl">8</span>,</span>
<span id="cb4-160"><a href="#cb4-160" aria-hidden="true"></a>  <span class="fl">9</span>,<span class="fl">10</span>,<span class="fl">13</span>,<span class="fl">14</span>,<span class="fl">15</span>,<span class="fl">16</span>,</span>
<span id="cb4-161"><a href="#cb4-161" aria-hidden="true"></a>  <span class="fl">19</span>,<span class="fl">20</span>,<span class="fl">21</span>,<span class="fl">22</span>,<span class="fl">25</span>,<span class="fl">26</span>,</span>
<span id="cb4-162"><a href="#cb4-162" aria-hidden="true"></a>  <span class="fl">27</span>,<span class="fl">28</span>,<span class="fl">31</span>,<span class="fl">32</span>,<span class="fl">33</span>,<span class="fl">34</span>};</span>
<span id="cb4-163"><a href="#cb4-163" aria-hidden="true"></a></span>
<span id="cb4-164"><a href="#cb4-164" aria-hidden="true"></a><span class="co">// edges -------------------------------------------------------------------</span></span>
<span id="cb4-165"><a href="#cb4-165" aria-hidden="true"></a><span class="kw">#declare facetEdges </span>= <span class="kw">array</span>[<span class="fl">18</span>][<span class="fl">2</span>]</span>
<span id="cb4-166"><a href="#cb4-166" aria-hidden="true"></a>  {</span>
<span id="cb4-167"><a href="#cb4-167" aria-hidden="true"></a>    {<span class="fl">0</span>, <span class="fl">5</span>},</span>
<span id="cb4-168"><a href="#cb4-168" aria-hidden="true"></a>    {<span class="fl">0</span>, <span class="fl">6</span>},</span>
<span id="cb4-169"><a href="#cb4-169" aria-hidden="true"></a>    {<span class="fl">0</span>, <span class="fl">30</span>},</span>
<span id="cb4-170"><a href="#cb4-170" aria-hidden="true"></a>    {<span class="fl">5</span>, <span class="fl">11</span>},</span>
<span id="cb4-171"><a href="#cb4-171" aria-hidden="true"></a>    {<span class="fl">5</span>, <span class="fl">35</span>},</span>
<span id="cb4-172"><a href="#cb4-172" aria-hidden="true"></a>    {<span class="fl">6</span>, <span class="fl">11</span>},</span>
<span id="cb4-173"><a href="#cb4-173" aria-hidden="true"></a>    {<span class="fl">6</span>, <span class="fl">12</span>},</span>
<span id="cb4-174"><a href="#cb4-174" aria-hidden="true"></a>    {<span class="fl">11</span>, <span class="fl">17</span>},</span>
<span id="cb4-175"><a href="#cb4-175" aria-hidden="true"></a>    {<span class="fl">12</span>, <span class="fl">17</span>},</span>
<span id="cb4-176"><a href="#cb4-176" aria-hidden="true"></a>    {<span class="fl">12</span>, <span class="fl">18</span>},</span>
<span id="cb4-177"><a href="#cb4-177" aria-hidden="true"></a>    {<span class="fl">17</span>, <span class="fl">23</span>},</span>
<span id="cb4-178"><a href="#cb4-178" aria-hidden="true"></a>    {<span class="fl">18</span>, <span class="fl">23</span>},</span>
<span id="cb4-179"><a href="#cb4-179" aria-hidden="true"></a>    {<span class="fl">18</span>, <span class="fl">24</span>},</span>
<span id="cb4-180"><a href="#cb4-180" aria-hidden="true"></a>    {<span class="fl">23</span>, <span class="fl">29</span>},</span>
<span id="cb4-181"><a href="#cb4-181" aria-hidden="true"></a>    {<span class="fl">24</span>, <span class="fl">29</span>},</span>
<span id="cb4-182"><a href="#cb4-182" aria-hidden="true"></a>    {<span class="fl">24</span>, <span class="fl">30</span>},</span>
<span id="cb4-183"><a href="#cb4-183" aria-hidden="true"></a>    {<span class="fl">29</span>, <span class="fl">35</span>},</span>
<span id="cb4-184"><a href="#cb4-184" aria-hidden="true"></a>    {<span class="fl">30</span>, <span class="fl">35</span>}</span>
<span id="cb4-185"><a href="#cb4-185" aria-hidden="true"></a>  };</span>
<span id="cb4-186"><a href="#cb4-186" aria-hidden="true"></a><span class="kw">#declare otherEdges </span>= <span class="kw">array</span>[<span class="fl">54</span>][<span class="fl">2</span>]</span>
<span id="cb4-187"><a href="#cb4-187" aria-hidden="true"></a>  {</span>
<span id="cb4-188"><a href="#cb4-188" aria-hidden="true"></a>    {<span class="fl">0</span>, <span class="fl">1</span>},</span>
<span id="cb4-189"><a href="#cb4-189" aria-hidden="true"></a>    {<span class="fl">1</span>, <span class="fl">2</span>},</span>
<span id="cb4-190"><a href="#cb4-190" aria-hidden="true"></a>    {<span class="fl">1</span>, <span class="fl">7</span>},</span>
<span id="cb4-191"><a href="#cb4-191" aria-hidden="true"></a>    {<span class="fl">1</span>, <span class="fl">31</span>},</span>
<span id="cb4-192"><a href="#cb4-192" aria-hidden="true"></a>    {<span class="fl">2</span>, <span class="fl">3</span>},</span>
<span id="cb4-193"><a href="#cb4-193" aria-hidden="true"></a>    {<span class="fl">2</span>, <span class="fl">8</span>},</span>
<span id="cb4-194"><a href="#cb4-194" aria-hidden="true"></a>    {<span class="fl">2</span>, <span class="fl">32</span>},</span>
<span id="cb4-195"><a href="#cb4-195" aria-hidden="true"></a>    {<span class="fl">3</span>, <span class="fl">4</span>},</span>
<span id="cb4-196"><a href="#cb4-196" aria-hidden="true"></a>    {<span class="fl">3</span>, <span class="fl">9</span>},</span>
<span id="cb4-197"><a href="#cb4-197" aria-hidden="true"></a>    {<span class="fl">3</span>, <span class="fl">33</span>},</span>
<span id="cb4-198"><a href="#cb4-198" aria-hidden="true"></a>    {<span class="fl">4</span>, <span class="fl">5</span>},</span>
<span id="cb4-199"><a href="#cb4-199" aria-hidden="true"></a>    {<span class="fl">4</span>, <span class="fl">10</span>},</span>
<span id="cb4-200"><a href="#cb4-200" aria-hidden="true"></a>    {<span class="fl">4</span>, <span class="fl">34</span>},</span>
<span id="cb4-201"><a href="#cb4-201" aria-hidden="true"></a>    {<span class="fl">6</span>, <span class="fl">7</span>},</span>
<span id="cb4-202"><a href="#cb4-202" aria-hidden="true"></a>    {<span class="fl">7</span>, <span class="fl">8</span>},</span>
<span id="cb4-203"><a href="#cb4-203" aria-hidden="true"></a>    {<span class="fl">7</span>, <span class="fl">13</span>},</span>
<span id="cb4-204"><a href="#cb4-204" aria-hidden="true"></a>    {<span class="fl">8</span>, <span class="fl">9</span>},</span>
<span id="cb4-205"><a href="#cb4-205" aria-hidden="true"></a>    {<span class="fl">8</span>, <span class="fl">14</span>},</span>
<span id="cb4-206"><a href="#cb4-206" aria-hidden="true"></a>    {<span class="fl">9</span>, <span class="fl">10</span>},</span>
<span id="cb4-207"><a href="#cb4-207" aria-hidden="true"></a>    {<span class="fl">9</span>, <span class="fl">15</span>},</span>
<span id="cb4-208"><a href="#cb4-208" aria-hidden="true"></a>    {<span class="fl">10</span>, <span class="fl">11</span>},</span>
<span id="cb4-209"><a href="#cb4-209" aria-hidden="true"></a>    {<span class="fl">10</span>, <span class="fl">16</span>},</span>
<span id="cb4-210"><a href="#cb4-210" aria-hidden="true"></a>    {<span class="fl">12</span>, <span class="fl">13</span>},</span>
<span id="cb4-211"><a href="#cb4-211" aria-hidden="true"></a>    {<span class="fl">13</span>, <span class="fl">14</span>},</span>
<span id="cb4-212"><a href="#cb4-212" aria-hidden="true"></a>    {<span class="fl">13</span>, <span class="fl">19</span>},</span>
<span id="cb4-213"><a href="#cb4-213" aria-hidden="true"></a>    {<span class="fl">14</span>, <span class="fl">15</span>},</span>
<span id="cb4-214"><a href="#cb4-214" aria-hidden="true"></a>    {<span class="fl">14</span>, <span class="fl">20</span>},</span>
<span id="cb4-215"><a href="#cb4-215" aria-hidden="true"></a>    {<span class="fl">15</span>, <span class="fl">16</span>},</span>
<span id="cb4-216"><a href="#cb4-216" aria-hidden="true"></a>    {<span class="fl">15</span>, <span class="fl">21</span>},</span>
<span id="cb4-217"><a href="#cb4-217" aria-hidden="true"></a>    {<span class="fl">16</span>, <span class="fl">17</span>},</span>
<span id="cb4-218"><a href="#cb4-218" aria-hidden="true"></a>    {<span class="fl">16</span>, <span class="fl">22</span>},</span>
<span id="cb4-219"><a href="#cb4-219" aria-hidden="true"></a>    {<span class="fl">18</span>, <span class="fl">19</span>},</span>
<span id="cb4-220"><a href="#cb4-220" aria-hidden="true"></a>    {<span class="fl">19</span>, <span class="fl">20</span>},</span>
<span id="cb4-221"><a href="#cb4-221" aria-hidden="true"></a>    {<span class="fl">19</span>, <span class="fl">25</span>},</span>
<span id="cb4-222"><a href="#cb4-222" aria-hidden="true"></a>    {<span class="fl">20</span>, <span class="fl">21</span>},</span>
<span id="cb4-223"><a href="#cb4-223" aria-hidden="true"></a>    {<span class="fl">20</span>, <span class="fl">26</span>},</span>
<span id="cb4-224"><a href="#cb4-224" aria-hidden="true"></a>    {<span class="fl">21</span>, <span class="fl">22</span>},</span>
<span id="cb4-225"><a href="#cb4-225" aria-hidden="true"></a>    {<span class="fl">21</span>, <span class="fl">27</span>},</span>
<span id="cb4-226"><a href="#cb4-226" aria-hidden="true"></a>    {<span class="fl">22</span>, <span class="fl">23</span>},</span>
<span id="cb4-227"><a href="#cb4-227" aria-hidden="true"></a>    {<span class="fl">22</span>, <span class="fl">28</span>},</span>
<span id="cb4-228"><a href="#cb4-228" aria-hidden="true"></a>    {<span class="fl">24</span>, <span class="fl">25</span>},</span>
<span id="cb4-229"><a href="#cb4-229" aria-hidden="true"></a>    {<span class="fl">25</span>, <span class="fl">26</span>},</span>
<span id="cb4-230"><a href="#cb4-230" aria-hidden="true"></a>    {<span class="fl">25</span>, <span class="fl">31</span>},</span>
<span id="cb4-231"><a href="#cb4-231" aria-hidden="true"></a>    {<span class="fl">26</span>, <span class="fl">27</span>},</span>
<span id="cb4-232"><a href="#cb4-232" aria-hidden="true"></a>    {<span class="fl">26</span>, <span class="fl">32</span>},</span>
<span id="cb4-233"><a href="#cb4-233" aria-hidden="true"></a>    {<span class="fl">27</span>, <span class="fl">28</span>},</span>
<span id="cb4-234"><a href="#cb4-234" aria-hidden="true"></a>    {<span class="fl">27</span>, <span class="fl">33</span>},</span>
<span id="cb4-235"><a href="#cb4-235" aria-hidden="true"></a>    {<span class="fl">28</span>, <span class="fl">29</span>},</span>
<span id="cb4-236"><a href="#cb4-236" aria-hidden="true"></a>    {<span class="fl">28</span>, <span class="fl">34</span>},</span>
<span id="cb4-237"><a href="#cb4-237" aria-hidden="true"></a>    {<span class="fl">30</span>, <span class="fl">31</span>},</span>
<span id="cb4-238"><a href="#cb4-238" aria-hidden="true"></a>    {<span class="fl">31</span>, <span class="fl">32</span>},</span>
<span id="cb4-239"><a href="#cb4-239" aria-hidden="true"></a>    {<span class="fl">32</span>, <span class="fl">33</span>},</span>
<span id="cb4-240"><a href="#cb4-240" aria-hidden="true"></a>    {<span class="fl">33</span>, <span class="fl">34</span>},</span>
<span id="cb4-241"><a href="#cb4-241" aria-hidden="true"></a>    {<span class="fl">34</span>, <span class="fl">35</span>}</span>
<span id="cb4-242"><a href="#cb4-242" aria-hidden="true"></a>  };</span>
<span id="cb4-243"><a href="#cb4-243" aria-hidden="true"></a></span>
<span id="cb4-244"><a href="#cb4-244" aria-hidden="true"></a><span class="co">// macros ----------------------------------------------------------------------</span></span>
<span id="cb4-245"><a href="#cb4-245" aria-hidden="true"></a><span class="kw">#macro vlength4</span>(P)</span>
<span id="cb4-246"><a href="#cb4-246" aria-hidden="true"></a>  <span class="kw">sqrt</span>(P.<span class="kw">x</span>*P.<span class="kw">x</span> + P.<span class="kw">y</span>*P.<span class="kw">y</span> + P.<span class="kw">z</span>*P.<span class="kw">z</span> + P.<span class="kw">t</span>*P.<span class="kw">t</span>)</span>
<span id="cb4-247"><a href="#cb4-247" aria-hidden="true"></a><span class="ot">#end</span></span>
<span id="cb4-248"><a href="#cb4-248" aria-hidden="true"></a></span>
<span id="cb4-249"><a href="#cb4-249" aria-hidden="true"></a><span class="kw">#macro sphericalSegment</span>(P, Q, n)</span>
<span id="cb4-250"><a href="#cb4-250" aria-hidden="true"></a>  <span class="kw">#local out </span>= <span class="kw">array</span>[n+<span class="fl">1</span>];</span>
<span id="cb4-251"><a href="#cb4-251" aria-hidden="true"></a>  #for(i, <span class="fl">0</span>, n)</span>
<span id="cb4-252"><a href="#cb4-252" aria-hidden="true"></a>    <span class="kw">#local pt </span>= P + (i/n)*(Q-P);</span>
<span id="cb4-253"><a href="#cb4-253" aria-hidden="true"></a>    <span class="kw">#local out</span>[i] = <span class="kw">sqrt</span>(<span class="fl">2</span>)/vlength4(pt) * pt;</span>
<span id="cb4-254"><a href="#cb4-254" aria-hidden="true"></a>  <span class="ot">#end</span></span>
<span id="cb4-255"><a href="#cb4-255" aria-hidden="true"></a>  out</span>
<span id="cb4-256"><a href="#cb4-256" aria-hidden="true"></a><span class="ot">#end</span></span>
<span id="cb4-257"><a href="#cb4-257" aria-hidden="true"></a></span>
<span id="cb4-258"><a href="#cb4-258" aria-hidden="true"></a><span class="kw">#macro rotate4d</span>(theta,phi,xi,vec)</span>
<span id="cb4-259"><a href="#cb4-259" aria-hidden="true"></a>  <span class="kw">#local a </span>= <span class="kw">cos</span>(xi);</span>
<span id="cb4-260"><a href="#cb4-260" aria-hidden="true"></a>  <span class="kw">#local b </span>= <span class="kw">sin</span>(theta)*<span class="kw">cos</span>(phi)*<span class="kw">sin</span>(xi);</span>
<span id="cb4-261"><a href="#cb4-261" aria-hidden="true"></a>  <span class="kw">#local c </span>= <span class="kw">sin</span>(theta)*<span class="kw">sin</span>(phi)*<span class="kw">sin</span>(xi);</span>
<span id="cb4-262"><a href="#cb4-262" aria-hidden="true"></a>  <span class="kw">#local d </span>= <span class="kw">cos</span>(theta)*<span class="kw">sin</span>(xi);</span>
<span id="cb4-263"><a href="#cb4-263" aria-hidden="true"></a>  <span class="kw">#local p </span>= vec.<span class="kw">x</span>;</span>
<span id="cb4-264"><a href="#cb4-264" aria-hidden="true"></a>  <span class="kw">#local q </span>= vec.<span class="kw">y</span>;</span>
<span id="cb4-265"><a href="#cb4-265" aria-hidden="true"></a>  <span class="kw">#local r </span>= vec.<span class="kw">z</span>;</span>
<span id="cb4-266"><a href="#cb4-266" aria-hidden="true"></a>  <span class="kw">#local s </span>= vec.<span class="kw">t</span>;</span>
<span id="cb4-267"><a href="#cb4-267" aria-hidden="true"></a>  &lt; a*p - b*q - c*r - d*s</span>
<span id="cb4-268"><a href="#cb4-268" aria-hidden="true"></a>  , a*q + b*p + c*s - d*r</span>
<span id="cb4-269"><a href="#cb4-269" aria-hidden="true"></a>  , a*r - b*s + c*p + d*q</span>
<span id="cb4-270"><a href="#cb4-270" aria-hidden="true"></a>  , a*s + b*r - c*q + d*p &gt;</span>
<span id="cb4-271"><a href="#cb4-271" aria-hidden="true"></a><span class="ot">#end</span></span>
<span id="cb4-272"><a href="#cb4-272" aria-hidden="true"></a></span>
<span id="cb4-273"><a href="#cb4-273" aria-hidden="true"></a><span class="kw">#macro StereographicProjection</span>(q) </span>
<span id="cb4-274"><a href="#cb4-274" aria-hidden="true"></a>  <span class="kw">acos</span>(q.<span class="kw">t</span>/<span class="kw">sqrt</span>(<span class="fl">2</span>))/<span class="kw">sqrt</span>(<span class="fl">2</span>-q.<span class="kw">t</span>*q.<span class="kw">t</span>) * &lt;q.<span class="kw">x</span>,q.<span class="kw">y</span>,q.<span class="kw">z</span>&gt;</span>
<span id="cb4-275"><a href="#cb4-275" aria-hidden="true"></a><span class="ot">#end</span></span>
<span id="cb4-276"><a href="#cb4-276" aria-hidden="true"></a></span>
<span id="cb4-277"><a href="#cb4-277" aria-hidden="true"></a><span class="kw">#macro ProjectedFacetVertices</span>(theta, phi, xi)</span>
<span id="cb4-278"><a href="#cb4-278" aria-hidden="true"></a>  <span class="kw">#local out </span>= <span class="kw">array</span>[<span class="fl">12</span>];</span>
<span id="cb4-279"><a href="#cb4-279" aria-hidden="true"></a>  #for(i, <span class="fl">0</span>, <span class="fl">11</span>)</span>
<span id="cb4-280"><a href="#cb4-280" aria-hidden="true"></a>    <span class="kw">#local out</span>[i] = </span>
<span id="cb4-281"><a href="#cb4-281" aria-hidden="true"></a>      StereographicProjection(</span>
<span id="cb4-282"><a href="#cb4-282" aria-hidden="true"></a>        rotate4d(theta, phi, xi, vertices[facetVertices[i]])</span>
<span id="cb4-283"><a href="#cb4-283" aria-hidden="true"></a>      );</span>
<span id="cb4-284"><a href="#cb4-284" aria-hidden="true"></a>  <span class="ot">#end</span></span>
<span id="cb4-285"><a href="#cb4-285" aria-hidden="true"></a>  out</span>
<span id="cb4-286"><a href="#cb4-286" aria-hidden="true"></a><span class="ot">#end</span></span>
<span id="cb4-287"><a href="#cb4-287" aria-hidden="true"></a></span>
<span id="cb4-288"><a href="#cb4-288" aria-hidden="true"></a><span class="kw">#macro ProjectedOtherVertices</span>(theta, phi, xi)</span>
<span id="cb4-289"><a href="#cb4-289" aria-hidden="true"></a>  <span class="kw">#local out </span>= <span class="kw">array</span>[<span class="fl">24</span>];</span>
<span id="cb4-290"><a href="#cb4-290" aria-hidden="true"></a>  #for(i, <span class="fl">0</span>, <span class="fl">23</span>)</span>
<span id="cb4-291"><a href="#cb4-291" aria-hidden="true"></a>    <span class="kw">#local out</span>[i] = </span>
<span id="cb4-292"><a href="#cb4-292" aria-hidden="true"></a>      StereographicProjection(</span>
<span id="cb4-293"><a href="#cb4-293" aria-hidden="true"></a>        rotate4d(theta, phi, xi, vertices[otherVertices[i]])</span>
<span id="cb4-294"><a href="#cb4-294" aria-hidden="true"></a>      );</span>
<span id="cb4-295"><a href="#cb4-295" aria-hidden="true"></a>  <span class="ot">#end</span></span>
<span id="cb4-296"><a href="#cb4-296" aria-hidden="true"></a>  out</span>
<span id="cb4-297"><a href="#cb4-297" aria-hidden="true"></a><span class="ot">#end</span></span>
<span id="cb4-298"><a href="#cb4-298" aria-hidden="true"></a></span>
<span id="cb4-299"><a href="#cb4-299" aria-hidden="true"></a><span class="co">// texture ---------------------------------------------------------------------</span></span>
<span id="cb4-300"><a href="#cb4-300" aria-hidden="true"></a><span class="kw">#declare edgeTexture1 </span>= </span>
<span id="cb4-301"><a href="#cb4-301" aria-hidden="true"></a>  <span class="kw">texture</span> {</span>
<span id="cb4-302"><a href="#cb4-302" aria-hidden="true"></a>    New_Penny</span>
<span id="cb4-303"><a href="#cb4-303" aria-hidden="true"></a>    <span class="kw">finish</span> {</span>
<span id="cb4-304"><a href="#cb4-304" aria-hidden="true"></a>      <span class="kw">ambient</span> <span class="fl">0.01</span></span>
<span id="cb4-305"><a href="#cb4-305" aria-hidden="true"></a>      <span class="kw">diffuse</span> <span class="fl">2</span></span>
<span id="cb4-306"><a href="#cb4-306" aria-hidden="true"></a>      <span class="kw">reflection</span> <span class="fl">0</span></span>
<span id="cb4-307"><a href="#cb4-307" aria-hidden="true"></a>      <span class="kw">brilliance</span> <span class="fl">8</span></span>
<span id="cb4-308"><a href="#cb4-308" aria-hidden="true"></a>      <span class="kw">specular</span> <span class="fl">0.1</span></span>
<span id="cb4-309"><a href="#cb4-309" aria-hidden="true"></a>      <span class="kw">roughness</span> <span class="fl">0.1</span></span>
<span id="cb4-310"><a href="#cb4-310" aria-hidden="true"></a>    }</span>
<span id="cb4-311"><a href="#cb4-311" aria-hidden="true"></a>  };</span>
<span id="cb4-312"><a href="#cb4-312" aria-hidden="true"></a></span>
<span id="cb4-313"><a href="#cb4-313" aria-hidden="true"></a><span class="kw">#declare edgeTexture2 </span>= </span>
<span id="cb4-314"><a href="#cb4-314" aria-hidden="true"></a>  <span class="kw">texture</span> {</span>
<span id="cb4-315"><a href="#cb4-315" aria-hidden="true"></a>    <span class="kw">pigment</span> { Red }</span>
<span id="cb4-316"><a href="#cb4-316" aria-hidden="true"></a>    <span class="kw">finish</span> {</span>
<span id="cb4-317"><a href="#cb4-317" aria-hidden="true"></a>      <span class="kw">ambient</span> <span class="fl">0.01</span></span>
<span id="cb4-318"><a href="#cb4-318" aria-hidden="true"></a>      <span class="kw">diffuse</span> <span class="fl">2</span></span>
<span id="cb4-319"><a href="#cb4-319" aria-hidden="true"></a>      <span class="kw">reflection</span> <span class="fl">0</span></span>
<span id="cb4-320"><a href="#cb4-320" aria-hidden="true"></a>      <span class="kw">brilliance</span> <span class="fl">8</span></span>
<span id="cb4-321"><a href="#cb4-321" aria-hidden="true"></a>      <span class="kw">specular</span> <span class="fl">0.1</span></span>
<span id="cb4-322"><a href="#cb4-322" aria-hidden="true"></a>      <span class="kw">roughness</span> <span class="fl">0.1</span></span>
<span id="cb4-323"><a href="#cb4-323" aria-hidden="true"></a>    }</span>
<span id="cb4-324"><a href="#cb4-324" aria-hidden="true"></a>  };</span>
<span id="cb4-325"><a href="#cb4-325" aria-hidden="true"></a></span>
<span id="cb4-326"><a href="#cb4-326" aria-hidden="true"></a><span class="co">// draw an edge ----------------------------------------------------------------</span></span>
<span id="cb4-327"><a href="#cb4-327" aria-hidden="true"></a><span class="kw">#macro Edge</span>(verts, v1, v2, theta, phi, xi, Tex)</span>
<span id="cb4-328"><a href="#cb4-328" aria-hidden="true"></a>  <span class="kw">#local P </span>= verts[v1];</span>
<span id="cb4-329"><a href="#cb4-329" aria-hidden="true"></a>  <span class="kw">#local Q </span>= verts[v2];</span>
<span id="cb4-330"><a href="#cb4-330" aria-hidden="true"></a>  <span class="kw">#local PQ </span>= sphericalSegment(P, Q, <span class="fl">100</span>);</span>
<span id="cb4-331"><a href="#cb4-331" aria-hidden="true"></a>  <span class="kw">sphere_sweep</span> {</span>
<span id="cb4-332"><a href="#cb4-332" aria-hidden="true"></a>    <span class="kw">b_spline</span> <span class="fl">101</span></span>
<span id="cb4-333"><a href="#cb4-333" aria-hidden="true"></a>    #for(k,<span class="fl">0</span>,<span class="fl">100</span>)</span>
<span id="cb4-334"><a href="#cb4-334" aria-hidden="true"></a>      <span class="kw">#local O </span>= StereographicProjection(rotate4d(theta,phi,xi,PQ[k]));</span>
<span id="cb4-335"><a href="#cb4-335" aria-hidden="true"></a>      O <span class="kw">vlength</span>(O)/<span class="fl">20</span></span>
<span id="cb4-336"><a href="#cb4-336" aria-hidden="true"></a>    <span class="ot">#end</span></span>
<span id="cb4-337"><a href="#cb4-337" aria-hidden="true"></a>    <span class="kw">texture</span> { </span>
<span id="cb4-338"><a href="#cb4-338" aria-hidden="true"></a>        Tex</span>
<span id="cb4-339"><a href="#cb4-339" aria-hidden="true"></a>    }</span>
<span id="cb4-340"><a href="#cb4-340" aria-hidden="true"></a>  }</span>
<span id="cb4-341"><a href="#cb4-341" aria-hidden="true"></a><span class="ot">#end</span></span>
<span id="cb4-342"><a href="#cb4-342" aria-hidden="true"></a></span>
<span id="cb4-343"><a href="#cb4-343" aria-hidden="true"></a><span class="co">// draw ------------------------------------------------------------------------</span></span>
<span id="cb4-344"><a href="#cb4-344" aria-hidden="true"></a><span class="kw">#declare theta </span>= <span class="fl">pi</span>/<span class="fl">2</span>;</span>
<span id="cb4-345"><a href="#cb4-345" aria-hidden="true"></a><span class="kw">#declare phi </span>= <span class="fl">0</span>;</span>
<span id="cb4-346"><a href="#cb4-346" aria-hidden="true"></a><span class="kw">#declare xi </span>= <span class="fl">2</span>*<span class="kw">frame_number</span>*<span class="fl">pi</span>/<span class="fl">180</span>;</span>
<span id="cb4-347"><a href="#cb4-347" aria-hidden="true"></a><span class="kw">#declare vsFacet </span>= ProjectedFacetVertices(theta, phi, xi);</span>
<span id="cb4-348"><a href="#cb4-348" aria-hidden="true"></a><span class="kw">#declare vsOther </span>= ProjectedOtherVertices(theta, phi, xi);</span>
<span id="cb4-349"><a href="#cb4-349" aria-hidden="true"></a><span class="kw">object</span> {</span>
<span id="cb4-350"><a href="#cb4-350" aria-hidden="true"></a>  <span class="kw">union</span> {</span>
<span id="cb4-351"><a href="#cb4-351" aria-hidden="true"></a>    #for(i, <span class="fl">0</span>, <span class="fl">53</span>)</span>
<span id="cb4-352"><a href="#cb4-352" aria-hidden="true"></a>      Edge(vertices, otherEdges[i][<span class="fl">0</span>], otherEdges[i][<span class="fl">1</span>], </span>
<span id="cb4-353"><a href="#cb4-353" aria-hidden="true"></a>                            theta, phi, xi, edgeTexture1)</span>
<span id="cb4-354"><a href="#cb4-354" aria-hidden="true"></a>    <span class="ot">#end</span></span>
<span id="cb4-355"><a href="#cb4-355" aria-hidden="true"></a>    #for(i, <span class="fl">0</span>, <span class="fl">17</span>)</span>
<span id="cb4-356"><a href="#cb4-356" aria-hidden="true"></a>      Edge(vertices, facetEdges[i][<span class="fl">0</span>], facetEdges[i][<span class="fl">1</span>], </span>
<span id="cb4-357"><a href="#cb4-357" aria-hidden="true"></a>                            theta, phi, xi, edgeTexture2)</span>
<span id="cb4-358"><a href="#cb4-358" aria-hidden="true"></a>    <span class="ot">#end</span></span>
<span id="cb4-359"><a href="#cb4-359" aria-hidden="true"></a>    #for(i, <span class="fl">0</span>, <span class="fl">23</span>)</span>
<span id="cb4-360"><a href="#cb4-360" aria-hidden="true"></a>      <span class="kw">sphere</span> {</span>
<span id="cb4-361"><a href="#cb4-361" aria-hidden="true"></a>        vsOther[i], <span class="kw">vlength</span>(vsOther[i])/<span class="fl">10</span></span>
<span id="cb4-362"><a href="#cb4-362" aria-hidden="true"></a>        <span class="kw">texture</span> { edgeTexture1 }</span>
<span id="cb4-363"><a href="#cb4-363" aria-hidden="true"></a>      }</span>
<span id="cb4-364"><a href="#cb4-364" aria-hidden="true"></a>    <span class="ot">#end</span>  </span>
<span id="cb4-365"><a href="#cb4-365" aria-hidden="true"></a>    #for(i, <span class="fl">0</span>, <span class="fl">11</span>)</span>
<span id="cb4-366"><a href="#cb4-366" aria-hidden="true"></a>      <span class="kw">sphere</span> {</span>
<span id="cb4-367"><a href="#cb4-367" aria-hidden="true"></a>        vsFacet[i], <span class="kw">vlength</span>(vsFacet[i])/<span class="fl">10</span></span>
<span id="cb4-368"><a href="#cb4-368" aria-hidden="true"></a>        <span class="kw">texture</span> { edgeTexture2 }</span>
<span id="cb4-369"><a href="#cb4-369" aria-hidden="true"></a>      }</span>
<span id="cb4-370"><a href="#cb4-370" aria-hidden="true"></a>    <span class="ot">#end</span>  </span>
<span id="cb4-371"><a href="#cb4-371" aria-hidden="true"></a>  }</span>
<span id="cb4-372"><a href="#cb4-372" aria-hidden="true"></a>  <span class="kw">scale</span> <span class="fl">0.5</span></span>
<span id="cb4-373"><a href="#cb4-373" aria-hidden="true"></a>  <span class="kw">rotate</span> &lt;<span class="fl">60</span>, <span class="fl">0</span>, <span class="fl">0</span>&gt;</span>
<span id="cb4-374"><a href="#cb4-374" aria-hidden="true"></a>  <span class="kw">translate</span> &lt;<span class="fl">0</span>, <span class="fl">0.5</span>, <span class="fl">-2</span>&gt;</span>
<span id="cb4-375"><a href="#cb4-375" aria-hidden="true"></a>}</span></code></pre></div>
<p><img src="./figures/DuoprismStereo_POVRAY2.gif" /></p>

        </div>


        <div id="footer">
          Site proudly generated by
          <a href="http://jaspervdj.be/hakyll">Hakyll</a>
        </div>

      </div>

    </div>

    <div class="row">
      <div class="col-sm-12">
        <div id="disqus_thread"></div>
        <div class="pagination">
          <ul>
            <li>
              <a href="http://laustep.github.io/stlahblog/">&#171; Back Home</a>
            </li>
          </ul>
        </div>
      </div>
    </div>
    
  </div>

</body>

<script src="/libraries/bootstrap/bootstrap.min.js"></script>
<script>
  var disqus_developer = 1;
  var disqus_shortname = 'stlapblog';
  // required: replace example with your forum shortname
  /* * * DON'T EDIT BELOW THIS LINE * * */
  (function () {
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = 'https://' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] ||
      document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>
<noscript>Please enable JavaScript to view the
  <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a>
</noscript>
<!-- MathJax: Fall back to local if CDN offline but local image fonts are not supported (saves >100MB) -->
<script type="text/x-mathjax-config" src="/libraries/mathjax/config/TeX-MML-AM_CHTML.js"></script>
<!-- <script>
  window.MathJax || document.write('<script type="text/x-mathjax-config">MathJax.Hub.Config({"HTML-CSS":{imageFont:null}});<\/script><script src="../libraries/mathjax/MathJax.js"><\/script>');
</script> -->


</html>]]></description>
    <pubDate>Tue, 11 Feb 2020 00:00:00 UT</pubDate>
    <guid>https://laustep.github.io/stlahblog/posts/DuoprismStereo.html</guid>
    <dc:creator>Stéphane Laurent</dc:creator>
    <category>R</category>
</item>






<item>
    <title>Stereographic truncated tesseract</title>
    <link>https://laustep.github.io/stlahblog/posts/StereoTruncatedTesseract.html</link>
    <description><![CDATA[<!DOCTYPE HTML>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Saturn Elephant - Stereographic truncated tesseract</title>
  <link href="/libraries/bootstrap/bootstrap-grid.min.css" rel="stylesheet">
  <link rel="stylesheet" href="/css/default2.css" />
  <link rel="stylesheet" href="/css/post.css" />
  <link rel="stylesheet" href="/css/misc.css" /> 
  
    <link rel="stylesheet" href="/css/pandoc-solarized.css" /> 
   
  
  <link href="https://fonts.googleapis.com/css?family=Raleway:400,600,200,800" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/css?family=Droid+Sans" rel="stylesheet" type="text/css">
  <script src="/libraries/jquery.min.js"></script>
  <script type="text/javascript" async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML"></script>
</head>

<body>
  <div class="container-fluid">
    <div class="row">
      <!-- Sidebar. -->
      <div class="sidebar col-sm-2">
        <div class="row">
          <div class="col-sm-12" style="float:right;clear:both;margin-right:50px;margin-top:50px;">
            <a href="https://www.r-bloggers.com/">
              <img src="/images/Rbloggers.png" alt="Rbloggers" width="100%" />
            </a>
            <br/>
            <a href="http://t-redactyl.io/">
              <span style="color:black;font-weight:bold;font-family:sans-serif;font-size:25px;">Standard error</span>
            </a>
            <a href="http://timelyportfolio.blogspot.be/">
              <span style="color:grey;font-weight:bold;font-family:sans-serif;font-size:24px;">Timely portfolio</span>
            </a>
            <br/>
            <a href="https://antoineguillot.wordpress.com/blog/">
              <span style="color:white;background-color:darkblue;font-weight:bold;font-family:sans-serif;font-size:21px;border:5px solid;border-color:darkblue">ENHANCE DATA</span>
            </a>
            <br/>
            <a href="https://fronkonstin.com/">
              <span style="color:black;background-color:gold;font-weight:bold;font-size:29px;border:3px solid;border-color:gold;">Fronkonstin</span>
            </a>
          </div>
        </div>
        <div id="logos">
          <div class="row">
            <div class="col-sm-4">
              <img src="/images/AsymptoteLogo.svg" style="width: 150%; transform: rotateZ(-35deg)"/>
            </div>
            <div class="col-sm-4">
              <img src="/images/Rlogo.svg" style="width: 110%;"/>
            </div>
            <div class="col-sm-4">
              <img src="/images/shiny-hex.png" style="width: 90%;"/>
            </div>
          </div>
          <div class="row">
            <div class="col-sm-4">
              <img src="/images/Povray_logo_sphere.png" style="width: 105%;"/>
            </div>
            <div class="col-sm-4">
              <img src="/images/javascript.svg" style="width: 90%;"/>
            </div>
            <div class="col-sm-4">
              <img src="/images/haskell.svg" style="width: 110%;"/>
            </div>
          </div>
        </div>
      </div>

      <div class="main col-sm-10">
        <div id="header">
          <div id="logo">
            <a href="/">
              <img src="/images/stla.jpg" alt="stla" width="100px" />
            </a>
          </div>
          <div id="navigation" style="margin-top:50px;">
            <a href="/">Home</a>
            <a href="/about.html">About</a>
            <a href="/contact.html">Contact</a>
            <a href="/archive.html">Archive</a>
          </div>
        </div>

        <div class="content">
          <h1>Stereographic truncated tesseract</h1> 
          <div class="info">
    Posted on December 16, 2019
    
        by Stéphane Laurent
    
</div>
<div class="info">
    
    Tags: <a title="All pages tagged &#39;R&#39;." href="/tags/R.html">R</a>, <a title="All pages tagged &#39;asymptote&#39;." href="/tags/asymptote.html">asymptote</a>, <a title="All pages tagged &#39;povray&#39;." href="/tags/povray.html">povray</a>, <a title="All pages tagged &#39;rgl&#39;." href="/tags/rgl.html">rgl</a>, <a title="All pages tagged &#39;graphics&#39;." href="/tags/graphics.html">graphics</a>, <a title="All pages tagged &#39;geometry&#39;." href="/tags/geometry.html">geometry</a>
    
</div>

<ul>
<li><a href="#the-stereographic-truncated-tesseract">The stereographic truncated tesseract</a></li>
<li><a href="#drawing-with-rgl-r">Drawing with rgl (R)</a></li>
<li><a href="#drawing-with-asymptote">Drawing with Asymptote</a></li>
<li><a href="#drawing-with-pov-ray">Drawing with POV-Ray</a></li>
</ul>
<h1 id="the-stereographic-truncated-tesseract">The stereographic truncated tesseract</h1>
<p>We show how to draw a stereographic truncated tesseract with rgl (R), Asymptote, and POV-Ray.</p>
<p>The truncated tesseract is a uniform polychoron. Among its cells, there are sixteen tetrahedra, and we fill the faces of these tetrahedra.</p>
<p>Using Asymptote and POV-Ray, we include a 4D rotation to animate the figure.</p>
<p>We call it <em>stereographic</em> because we map each edge to the 3-sphere before applying the stereographic projection.</p>
<h1 id="drawing-with-rgl-r">Drawing with rgl (R)</h1>
<div class="sourceCode" id="cb1"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a><span class="kw">library</span>(rgl)</span>
<span id="cb1-2"><a href="#cb1-2"></a><span class="kw">library</span>(cxhull)</span>
<span id="cb1-3"><a href="#cb1-3"></a><span class="kw">library</span>(abind)</span>
<span id="cb1-4"><a href="#cb1-4"></a></span>
<span id="cb1-5"><a href="#cb1-5"></a><span class="co"># vertices #####################################################################</span></span>
<span id="cb1-6"><a href="#cb1-6"></a>sqr2p1 &lt;-<span class="st"> </span><span class="kw">sqrt</span>(<span class="dv">2</span>) <span class="op">+</span><span class="st"> </span><span class="dv">1</span></span>
<span id="cb1-7"><a href="#cb1-7"></a>vertices &lt;-<span class="st"> </span><span class="kw">rbind</span>(</span>
<span id="cb1-8"><a href="#cb1-8"></a>  <span class="kw">c</span>(<span class="op">-</span><span class="dv">1</span>, <span class="op">-</span>sqr2p1, <span class="op">-</span>sqr2p1, <span class="op">-</span>sqr2p1),</span>
<span id="cb1-9"><a href="#cb1-9"></a>  <span class="kw">c</span>(<span class="op">-</span><span class="dv">1</span>, <span class="op">-</span>sqr2p1, <span class="op">-</span>sqr2p1, sqr2p1),</span>
<span id="cb1-10"><a href="#cb1-10"></a>  <span class="kw">c</span>(<span class="op">-</span><span class="dv">1</span>, <span class="op">-</span>sqr2p1, sqr2p1, <span class="op">-</span>sqr2p1),</span>
<span id="cb1-11"><a href="#cb1-11"></a>  <span class="kw">c</span>(<span class="op">-</span><span class="dv">1</span>, <span class="op">-</span>sqr2p1, sqr2p1, sqr2p1),</span>
<span id="cb1-12"><a href="#cb1-12"></a>  <span class="kw">c</span>(<span class="op">-</span><span class="dv">1</span>, sqr2p1, <span class="op">-</span>sqr2p1, <span class="op">-</span>sqr2p1),</span>
<span id="cb1-13"><a href="#cb1-13"></a>  <span class="kw">c</span>(<span class="op">-</span><span class="dv">1</span>, sqr2p1, <span class="op">-</span>sqr2p1, sqr2p1),</span>
<span id="cb1-14"><a href="#cb1-14"></a>  <span class="kw">c</span>(<span class="op">-</span><span class="dv">1</span>, sqr2p1, sqr2p1, <span class="op">-</span>sqr2p1),</span>
<span id="cb1-15"><a href="#cb1-15"></a>  <span class="kw">c</span>(<span class="op">-</span><span class="dv">1</span>, sqr2p1, sqr2p1, sqr2p1),</span>
<span id="cb1-16"><a href="#cb1-16"></a>  <span class="kw">c</span>(<span class="dv">1</span>, <span class="op">-</span>sqr2p1, <span class="op">-</span>sqr2p1, <span class="op">-</span>sqr2p1),</span>
<span id="cb1-17"><a href="#cb1-17"></a>  <span class="kw">c</span>(<span class="dv">1</span>, <span class="op">-</span>sqr2p1, <span class="op">-</span>sqr2p1, sqr2p1),</span>
<span id="cb1-18"><a href="#cb1-18"></a>  <span class="kw">c</span>(<span class="dv">1</span>, <span class="op">-</span>sqr2p1, sqr2p1, <span class="op">-</span>sqr2p1),</span>
<span id="cb1-19"><a href="#cb1-19"></a>  <span class="kw">c</span>(<span class="dv">1</span>, <span class="op">-</span>sqr2p1, sqr2p1, sqr2p1),</span>
<span id="cb1-20"><a href="#cb1-20"></a>  <span class="kw">c</span>(<span class="dv">1</span>, sqr2p1, <span class="op">-</span>sqr2p1, <span class="op">-</span>sqr2p1),</span>
<span id="cb1-21"><a href="#cb1-21"></a>  <span class="kw">c</span>(<span class="dv">1</span>, sqr2p1, <span class="op">-</span>sqr2p1, sqr2p1),</span>
<span id="cb1-22"><a href="#cb1-22"></a>  <span class="kw">c</span>(<span class="dv">1</span>, sqr2p1, sqr2p1, <span class="op">-</span>sqr2p1),</span>
<span id="cb1-23"><a href="#cb1-23"></a>  <span class="kw">c</span>(<span class="dv">1</span>, sqr2p1, sqr2p1, sqr2p1),</span>
<span id="cb1-24"><a href="#cb1-24"></a>  <span class="kw">c</span>(<span class="op">-</span>sqr2p1, <span class="dv">-1</span>, <span class="op">-</span>sqr2p1, <span class="op">-</span>sqr2p1),</span>
<span id="cb1-25"><a href="#cb1-25"></a>  <span class="kw">c</span>(<span class="op">-</span>sqr2p1, <span class="dv">-1</span>, <span class="op">-</span>sqr2p1, sqr2p1),</span>
<span id="cb1-26"><a href="#cb1-26"></a>  <span class="kw">c</span>(<span class="op">-</span>sqr2p1, <span class="dv">-1</span>, sqr2p1, <span class="op">-</span>sqr2p1),</span>
<span id="cb1-27"><a href="#cb1-27"></a>  <span class="kw">c</span>(<span class="op">-</span>sqr2p1, <span class="dv">-1</span>, sqr2p1, sqr2p1),</span>
<span id="cb1-28"><a href="#cb1-28"></a>  <span class="kw">c</span>(<span class="op">-</span>sqr2p1, <span class="dv">1</span>, <span class="op">-</span>sqr2p1, <span class="op">-</span>sqr2p1),</span>
<span id="cb1-29"><a href="#cb1-29"></a>  <span class="kw">c</span>(<span class="op">-</span>sqr2p1, <span class="dv">1</span>, <span class="op">-</span>sqr2p1, sqr2p1),</span>
<span id="cb1-30"><a href="#cb1-30"></a>  <span class="kw">c</span>(<span class="op">-</span>sqr2p1, <span class="dv">1</span>, sqr2p1, <span class="op">-</span>sqr2p1),</span>
<span id="cb1-31"><a href="#cb1-31"></a>  <span class="kw">c</span>(<span class="op">-</span>sqr2p1, <span class="dv">1</span>, sqr2p1, sqr2p1),</span>
<span id="cb1-32"><a href="#cb1-32"></a>  <span class="kw">c</span>(sqr2p1, <span class="dv">-1</span>, <span class="op">-</span>sqr2p1, <span class="op">-</span>sqr2p1),</span>
<span id="cb1-33"><a href="#cb1-33"></a>  <span class="kw">c</span>(sqr2p1, <span class="dv">-1</span>, <span class="op">-</span>sqr2p1, sqr2p1),</span>
<span id="cb1-34"><a href="#cb1-34"></a>  <span class="kw">c</span>(sqr2p1, <span class="dv">-1</span>, sqr2p1, <span class="op">-</span>sqr2p1),</span>
<span id="cb1-35"><a href="#cb1-35"></a>  <span class="kw">c</span>(sqr2p1, <span class="dv">-1</span>, sqr2p1, sqr2p1),</span>
<span id="cb1-36"><a href="#cb1-36"></a>  <span class="kw">c</span>(sqr2p1, <span class="dv">1</span>, <span class="op">-</span>sqr2p1, <span class="op">-</span>sqr2p1),</span>
<span id="cb1-37"><a href="#cb1-37"></a>  <span class="kw">c</span>(sqr2p1, <span class="dv">1</span>, <span class="op">-</span>sqr2p1, sqr2p1),</span>
<span id="cb1-38"><a href="#cb1-38"></a>  <span class="kw">c</span>(sqr2p1, <span class="dv">1</span>, sqr2p1, <span class="op">-</span>sqr2p1),</span>
<span id="cb1-39"><a href="#cb1-39"></a>  <span class="kw">c</span>(sqr2p1, <span class="dv">1</span>, sqr2p1, sqr2p1),</span>
<span id="cb1-40"><a href="#cb1-40"></a>  <span class="kw">c</span>(<span class="op">-</span>sqr2p1, <span class="op">-</span>sqr2p1, <span class="dv">-1</span>, <span class="op">-</span>sqr2p1),</span>
<span id="cb1-41"><a href="#cb1-41"></a>  <span class="kw">c</span>(<span class="op">-</span>sqr2p1, <span class="op">-</span>sqr2p1, <span class="dv">-1</span>, sqr2p1),</span>
<span id="cb1-42"><a href="#cb1-42"></a>  <span class="kw">c</span>(<span class="op">-</span>sqr2p1, <span class="op">-</span>sqr2p1, <span class="dv">1</span>, <span class="op">-</span>sqr2p1),</span>
<span id="cb1-43"><a href="#cb1-43"></a>  <span class="kw">c</span>(<span class="op">-</span>sqr2p1, <span class="op">-</span>sqr2p1, <span class="dv">1</span>, sqr2p1),</span>
<span id="cb1-44"><a href="#cb1-44"></a>  <span class="kw">c</span>(<span class="op">-</span>sqr2p1, sqr2p1, <span class="dv">-1</span>, <span class="op">-</span>sqr2p1),</span>
<span id="cb1-45"><a href="#cb1-45"></a>  <span class="kw">c</span>(<span class="op">-</span>sqr2p1, sqr2p1, <span class="dv">-1</span>, sqr2p1),</span>
<span id="cb1-46"><a href="#cb1-46"></a>  <span class="kw">c</span>(<span class="op">-</span>sqr2p1, sqr2p1, <span class="dv">1</span>, <span class="op">-</span>sqr2p1),</span>
<span id="cb1-47"><a href="#cb1-47"></a>  <span class="kw">c</span>(<span class="op">-</span>sqr2p1, sqr2p1, <span class="dv">1</span>, sqr2p1),</span>
<span id="cb1-48"><a href="#cb1-48"></a>  <span class="kw">c</span>(sqr2p1, <span class="op">-</span>sqr2p1, <span class="dv">-1</span>, <span class="op">-</span>sqr2p1),</span>
<span id="cb1-49"><a href="#cb1-49"></a>  <span class="kw">c</span>(sqr2p1, <span class="op">-</span>sqr2p1, <span class="dv">-1</span>, sqr2p1),</span>
<span id="cb1-50"><a href="#cb1-50"></a>  <span class="kw">c</span>(sqr2p1, <span class="op">-</span>sqr2p1, <span class="dv">1</span>, <span class="op">-</span>sqr2p1),</span>
<span id="cb1-51"><a href="#cb1-51"></a>  <span class="kw">c</span>(sqr2p1, <span class="op">-</span>sqr2p1, <span class="dv">1</span>, sqr2p1),</span>
<span id="cb1-52"><a href="#cb1-52"></a>  <span class="kw">c</span>(sqr2p1, sqr2p1, <span class="dv">-1</span>, <span class="op">-</span>sqr2p1),</span>
<span id="cb1-53"><a href="#cb1-53"></a>  <span class="kw">c</span>(sqr2p1, sqr2p1, <span class="dv">-1</span>, sqr2p1),</span>
<span id="cb1-54"><a href="#cb1-54"></a>  <span class="kw">c</span>(sqr2p1, sqr2p1, <span class="dv">1</span>, <span class="op">-</span>sqr2p1),</span>
<span id="cb1-55"><a href="#cb1-55"></a>  <span class="kw">c</span>(sqr2p1, sqr2p1, <span class="dv">1</span>, sqr2p1),</span>
<span id="cb1-56"><a href="#cb1-56"></a>  <span class="kw">c</span>(<span class="op">-</span>sqr2p1, <span class="op">-</span>sqr2p1, <span class="op">-</span>sqr2p1, <span class="dv">-1</span>),</span>
<span id="cb1-57"><a href="#cb1-57"></a>  <span class="kw">c</span>(<span class="op">-</span>sqr2p1, <span class="op">-</span>sqr2p1, <span class="op">-</span>sqr2p1, <span class="dv">1</span>),</span>
<span id="cb1-58"><a href="#cb1-58"></a>  <span class="kw">c</span>(<span class="op">-</span>sqr2p1, <span class="op">-</span>sqr2p1, sqr2p1, <span class="dv">-1</span>),</span>
<span id="cb1-59"><a href="#cb1-59"></a>  <span class="kw">c</span>(<span class="op">-</span>sqr2p1, <span class="op">-</span>sqr2p1, sqr2p1, <span class="dv">1</span>),</span>
<span id="cb1-60"><a href="#cb1-60"></a>  <span class="kw">c</span>(<span class="op">-</span>sqr2p1, sqr2p1, <span class="op">-</span>sqr2p1, <span class="dv">-1</span>),</span>
<span id="cb1-61"><a href="#cb1-61"></a>  <span class="kw">c</span>(<span class="op">-</span>sqr2p1, sqr2p1, <span class="op">-</span>sqr2p1, <span class="dv">1</span>),</span>
<span id="cb1-62"><a href="#cb1-62"></a>  <span class="kw">c</span>(<span class="op">-</span>sqr2p1, sqr2p1, sqr2p1, <span class="dv">-1</span>),</span>
<span id="cb1-63"><a href="#cb1-63"></a>  <span class="kw">c</span>(<span class="op">-</span>sqr2p1, sqr2p1, sqr2p1, <span class="dv">1</span>),</span>
<span id="cb1-64"><a href="#cb1-64"></a>  <span class="kw">c</span>(sqr2p1, <span class="op">-</span>sqr2p1, <span class="op">-</span>sqr2p1, <span class="dv">-1</span>),</span>
<span id="cb1-65"><a href="#cb1-65"></a>  <span class="kw">c</span>(sqr2p1, <span class="op">-</span>sqr2p1, <span class="op">-</span>sqr2p1, <span class="dv">1</span>),</span>
<span id="cb1-66"><a href="#cb1-66"></a>  <span class="kw">c</span>(sqr2p1, <span class="op">-</span>sqr2p1, sqr2p1, <span class="dv">-1</span>),</span>
<span id="cb1-67"><a href="#cb1-67"></a>  <span class="kw">c</span>(sqr2p1, <span class="op">-</span>sqr2p1, sqr2p1, <span class="dv">1</span>),</span>
<span id="cb1-68"><a href="#cb1-68"></a>  <span class="kw">c</span>(sqr2p1, sqr2p1, <span class="op">-</span>sqr2p1, <span class="dv">-1</span>),</span>
<span id="cb1-69"><a href="#cb1-69"></a>  <span class="kw">c</span>(sqr2p1, sqr2p1, <span class="op">-</span>sqr2p1, <span class="dv">1</span>),</span>
<span id="cb1-70"><a href="#cb1-70"></a>  <span class="kw">c</span>(sqr2p1, sqr2p1, sqr2p1, <span class="dv">-1</span>),</span>
<span id="cb1-71"><a href="#cb1-71"></a>  <span class="kw">c</span>(sqr2p1, sqr2p1, sqr2p1, <span class="dv">1</span>)</span>
<span id="cb1-72"><a href="#cb1-72"></a>)</span>
<span id="cb1-73"><a href="#cb1-73"></a></span>
<span id="cb1-74"><a href="#cb1-74"></a><span class="co"># convex hull is the polytope itself, since it is convex #######################</span></span>
<span id="cb1-75"><a href="#cb1-75"></a>hull &lt;-<span class="st"> </span><span class="kw">cxhull</span>(vertices)</span>
<span id="cb1-76"><a href="#cb1-76"></a></span>
<span id="cb1-77"><a href="#cb1-77"></a><span class="co"># edges ########################################################################</span></span>
<span id="cb1-78"><a href="#cb1-78"></a>edges &lt;-<span class="st"> </span>hull<span class="op">$</span>edges</span>
<span id="cb1-79"><a href="#cb1-79"></a></span>
<span id="cb1-80"><a href="#cb1-80"></a><span class="co"># (triangular) faces of the tetrahedra ######################################### </span></span>
<span id="cb1-81"><a href="#cb1-81"></a>ridgeSizes &lt;-<span class="st"> </span><span class="kw">sapply</span>(hull<span class="op">$</span>ridges, <span class="cf">function</span>(ridge) <span class="kw">length</span>(ridge<span class="op">$</span>vertices))</span>
<span id="cb1-82"><a href="#cb1-82"></a>triangles &lt;-<span class="st"> </span><span class="kw">t</span>(<span class="kw">sapply</span>(hull<span class="op">$</span>ridges[<span class="kw">which</span>(ridgeSizes<span class="op">==</span><span class="dv">3</span>)], </span>
<span id="cb1-83"><a href="#cb1-83"></a>                      <span class="cf">function</span>(ridge) ridge<span class="op">$</span>vertices))</span>
<span id="cb1-84"><a href="#cb1-84"></a></span>
<span id="cb1-85"><a href="#cb1-85"></a><span class="co"># stereographic projection #####################################################</span></span>
<span id="cb1-86"><a href="#cb1-86"></a>sproj &lt;-<span class="st"> </span><span class="cf">function</span>(p, r){</span>
<span id="cb1-87"><a href="#cb1-87"></a>  <span class="kw">c</span>(p[<span class="dv">1</span>], p[<span class="dv">2</span>], p[<span class="dv">3</span>])<span class="op">/</span>(r<span class="op">-</span>p[<span class="dv">4</span>])</span>
<span id="cb1-88"><a href="#cb1-88"></a>}</span>
<span id="cb1-89"><a href="#cb1-89"></a></span>
<span id="cb1-90"><a href="#cb1-90"></a><span class="co"># spherical segment ############################################################</span></span>
<span id="cb1-91"><a href="#cb1-91"></a>sphericalSegment &lt;-<span class="st"> </span><span class="cf">function</span>(P, Q, r, n){</span>
<span id="cb1-92"><a href="#cb1-92"></a>  out &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="ot">NA_real_</span>, <span class="dt">nrow =</span> n<span class="op">+</span><span class="dv">1</span>, <span class="dt">ncol =</span> <span class="dv">4</span>)</span>
<span id="cb1-93"><a href="#cb1-93"></a>  <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">0</span><span class="op">:</span>n){</span>
<span id="cb1-94"><a href="#cb1-94"></a>    pt &lt;-<span class="st"> </span>P <span class="op">+</span><span class="st"> </span>(i<span class="op">/</span>n)<span class="op">*</span>(Q<span class="op">-</span>P)</span>
<span id="cb1-95"><a href="#cb1-95"></a>    out[i<span class="op">+</span>1L, ] &lt;-<span class="st"> </span>r<span class="op">/</span><span class="kw">sqrt</span>(<span class="kw">c</span>(<span class="kw">crossprod</span>(pt))) <span class="op">*</span><span class="st"> </span>pt</span>
<span id="cb1-96"><a href="#cb1-96"></a>  }</span>
<span id="cb1-97"><a href="#cb1-97"></a>  out</span>
<span id="cb1-98"><a href="#cb1-98"></a>}</span>
<span id="cb1-99"><a href="#cb1-99"></a></span>
<span id="cb1-100"><a href="#cb1-100"></a><span class="co"># stereographic edge ###########################################################</span></span>
<span id="cb1-101"><a href="#cb1-101"></a>stereoEdge &lt;-<span class="st"> </span><span class="cf">function</span>(verts, edge, r, n){</span>
<span id="cb1-102"><a href="#cb1-102"></a>  P &lt;-<span class="st"> </span>verts[edge[<span class="dv">1</span>], ]</span>
<span id="cb1-103"><a href="#cb1-103"></a>  Q &lt;-<span class="st"> </span>verts[edge[<span class="dv">2</span>], ]</span>
<span id="cb1-104"><a href="#cb1-104"></a>  PQ &lt;-<span class="st"> </span><span class="kw">sphericalSegment</span>(P, Q, r, n)</span>
<span id="cb1-105"><a href="#cb1-105"></a>  pq &lt;-<span class="st"> </span><span class="kw">t</span>(<span class="kw">apply</span>(PQ, <span class="dv">1</span>, <span class="cf">function</span>(M){<span class="kw">sproj</span>(M, r)}))</span>
<span id="cb1-106"><a href="#cb1-106"></a>  dists &lt;-<span class="st"> </span><span class="kw">sqrt</span>(<span class="kw">apply</span>(pq, <span class="dv">1</span>, crossprod))</span>
<span id="cb1-107"><a href="#cb1-107"></a>  <span class="kw">cylinder3d</span>(pq, <span class="dt">radius =</span> <span class="kw">log1p</span>(dists<span class="op">/</span><span class="dv">4</span>)<span class="op">/</span><span class="dv">4</span>, <span class="dt">sides =</span> <span class="dv">60</span>)</span>
<span id="cb1-108"><a href="#cb1-108"></a>}</span>
<span id="cb1-109"><a href="#cb1-109"></a></span>
<span id="cb1-110"><a href="#cb1-110"></a><span class="co"># stereographic subdivision (to fill the triangles) ############################</span></span>
<span id="cb1-111"><a href="#cb1-111"></a>midpoint4 &lt;-<span class="st"> </span><span class="cf">function</span>(A, B, r){</span>
<span id="cb1-112"><a href="#cb1-112"></a>  M &lt;-<span class="st"> </span>(A <span class="op">+</span><span class="st"> </span>B) <span class="op">/</span><span class="st"> </span><span class="dv">2</span></span>
<span id="cb1-113"><a href="#cb1-113"></a>  lg &lt;-<span class="st"> </span><span class="kw">sqrt</span>(<span class="kw">c</span>(<span class="kw">crossprod</span>(M))) <span class="op">/</span><span class="st"> </span>r</span>
<span id="cb1-114"><a href="#cb1-114"></a>  M <span class="op">/</span><span class="st"> </span>lg</span>
<span id="cb1-115"><a href="#cb1-115"></a>} </span>
<span id="cb1-116"><a href="#cb1-116"></a></span>
<span id="cb1-117"><a href="#cb1-117"></a>subdiv0 &lt;-<span class="st"> </span><span class="cf">function</span>(A, B, C, r){</span>
<span id="cb1-118"><a href="#cb1-118"></a>  mAB &lt;-<span class="st"> </span><span class="kw">midpoint4</span>(A, B, r)</span>
<span id="cb1-119"><a href="#cb1-119"></a>  mAC &lt;-<span class="st"> </span><span class="kw">midpoint4</span>(A, C, r)</span>
<span id="cb1-120"><a href="#cb1-120"></a>  mBC &lt;-<span class="st"> </span><span class="kw">midpoint4</span>(B, C, r)</span>
<span id="cb1-121"><a href="#cb1-121"></a>  out &lt;-<span class="st"> </span><span class="kw">array</span>(<span class="ot">NA_real_</span>, <span class="dt">dim =</span> <span class="kw">c</span>(4L, 3L, 4L))</span>
<span id="cb1-122"><a href="#cb1-122"></a>  out[<span class="dv">1</span>,,] &lt;-<span class="st"> </span><span class="kw">rbind</span>(A, mAB, mAC)</span>
<span id="cb1-123"><a href="#cb1-123"></a>  out[<span class="dv">2</span>,,] &lt;-<span class="st"> </span><span class="kw">rbind</span>(B, mBC, mAB)</span>
<span id="cb1-124"><a href="#cb1-124"></a>  out[<span class="dv">3</span>,,] &lt;-<span class="st"> </span><span class="kw">rbind</span>(C, mAC, mBC)</span>
<span id="cb1-125"><a href="#cb1-125"></a>  out[<span class="dv">4</span>,,] &lt;-<span class="st"> </span><span class="kw">rbind</span>(mAB, mBC, mAC)</span>
<span id="cb1-126"><a href="#cb1-126"></a>  out</span>
<span id="cb1-127"><a href="#cb1-127"></a>}</span>
<span id="cb1-128"><a href="#cb1-128"></a></span>
<span id="cb1-129"><a href="#cb1-129"></a>subdiv &lt;-<span class="st"> </span><span class="cf">function</span>(n, A, B, C, r){</span>
<span id="cb1-130"><a href="#cb1-130"></a>  <span class="cf">if</span>(n <span class="op">==</span><span class="st"> </span><span class="dv">1</span>){</span>
<span id="cb1-131"><a href="#cb1-131"></a>    <span class="kw">return</span>(<span class="kw">subdiv0</span>(A, B, C, r))</span>
<span id="cb1-132"><a href="#cb1-132"></a>  }</span>
<span id="cb1-133"><a href="#cb1-133"></a>  triangles &lt;-<span class="st"> </span><span class="kw">subdiv</span>(n<span class="dv">-1</span>, A, B, C, r)</span>
<span id="cb1-134"><a href="#cb1-134"></a>  out &lt;-<span class="st"> </span><span class="kw">array</span>(<span class="ot">NA_real_</span>, <span class="dt">dim =</span> <span class="kw">c</span>(0L, 3L, 4L))</span>
<span id="cb1-135"><a href="#cb1-135"></a>  <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>(<span class="dv">4</span><span class="op">^</span>(n<span class="dv">-1</span>))){</span>
<span id="cb1-136"><a href="#cb1-136"></a>    trgl &lt;-<span class="st"> </span>triangles[i,,]</span>
<span id="cb1-137"><a href="#cb1-137"></a>    out &lt;-<span class="st"> </span><span class="kw">abind</span>(out, <span class="kw">subdiv0</span>(trgl[1L,], trgl[2L,], trgl[3L,], r), <span class="dt">along =</span> 1L)</span>
<span id="cb1-138"><a href="#cb1-138"></a>  }</span>
<span id="cb1-139"><a href="#cb1-139"></a>  out</span>
<span id="cb1-140"><a href="#cb1-140"></a>}</span>
<span id="cb1-141"><a href="#cb1-141"></a></span>
<span id="cb1-142"><a href="#cb1-142"></a><span class="co"># mesh maker ###################################################################</span></span>
<span id="cb1-143"><a href="#cb1-143"></a>stereoTriangle &lt;-<span class="st"> </span><span class="cf">function</span>(n, A, B, C, r){</span>
<span id="cb1-144"><a href="#cb1-144"></a>  triangles &lt;-<span class="st"> </span><span class="kw">subdiv</span>(n, A, B, C, r)</span>
<span id="cb1-145"><a href="#cb1-145"></a>  ntriangles &lt;-<span class="st"> </span><span class="kw">dim</span>(triangles)[1L]</span>
<span id="cb1-146"><a href="#cb1-146"></a>  indices &lt;-<span class="st"> </span><span class="kw">matrix</span>(1L<span class="op">:</span>(3L<span class="op">*</span>ntriangles), <span class="dt">nrow =</span> 3L, <span class="dt">ncol =</span> ntriangles)</span>
<span id="cb1-147"><a href="#cb1-147"></a>  vertices &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="ot">NA_real_</span>, <span class="dt">nrow =</span> 3L, <span class="dt">ncol =</span> 3L<span class="op">*</span>ntriangles)</span>
<span id="cb1-148"><a href="#cb1-148"></a>  <span class="cf">for</span>(i <span class="cf">in</span> 1L<span class="op">:</span>ntriangles){</span>
<span id="cb1-149"><a href="#cb1-149"></a>    trgl &lt;-<span class="st"> </span>triangles[i,,]</span>
<span id="cb1-150"><a href="#cb1-150"></a>    vertices[, 3L<span class="op">*</span>(i<span class="op">-</span>1L)<span class="op">+</span>1L] &lt;-<span class="st"> </span><span class="kw">sproj</span>(trgl[1L,], r)</span>
<span id="cb1-151"><a href="#cb1-151"></a>    vertices[, 3L<span class="op">*</span>(i<span class="op">-</span>1L)<span class="op">+</span>2L] &lt;-<span class="st"> </span><span class="kw">sproj</span>(trgl[2L,], r)</span>
<span id="cb1-152"><a href="#cb1-152"></a>    vertices[, 3L<span class="op">*</span>(i<span class="op">-</span>1L)<span class="op">+</span>3L] &lt;-<span class="st"> </span><span class="kw">sproj</span>(trgl[3L,], r)</span>
<span id="cb1-153"><a href="#cb1-153"></a>  }</span>
<span id="cb1-154"><a href="#cb1-154"></a>  mesh &lt;-<span class="st"> </span><span class="kw">tmesh3d</span>(vertices, indices, <span class="dt">homogeneous =</span> <span class="ot">FALSE</span>)</span>
<span id="cb1-155"><a href="#cb1-155"></a>  Rvcg<span class="op">::</span><span class="kw">vcgClean</span>(mesh, <span class="dt">sel =</span> <span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">7</span>), <span class="dt">silent =</span> <span class="ot">TRUE</span>)</span>
<span id="cb1-156"><a href="#cb1-156"></a>}</span>
<span id="cb1-157"><a href="#cb1-157"></a></span>
<span id="cb1-158"><a href="#cb1-158"></a><span class="co"># projected vertices ###########################################################</span></span>
<span id="cb1-159"><a href="#cb1-159"></a>r &lt;-<span class="st"> </span><span class="kw">sqrt</span>(<span class="dv">1</span><span class="op">+</span><span class="dv">3</span><span class="op">*</span>sqr2p1<span class="op">^</span><span class="dv">2</span>)</span>
<span id="cb1-160"><a href="#cb1-160"></a>vs &lt;-<span class="st"> </span><span class="kw">t</span>(<span class="kw">apply</span>(vertices, 1L, <span class="cf">function</span>(M){<span class="kw">sproj</span>(M, r)}))</span>
<span id="cb1-161"><a href="#cb1-161"></a></span>
<span id="cb1-162"><a href="#cb1-162"></a><span class="co">####~~~~ plot ~~~~##############################################################</span></span>
<span id="cb1-163"><a href="#cb1-163"></a><span class="kw">open3d</span>(<span class="dt">windowRect =</span> <span class="kw">c</span>(<span class="dv">50</span>, <span class="dv">50</span>, <span class="dv">562</span>, <span class="dv">562</span>), <span class="dt">zoom =</span> <span class="fl">0.9</span>)</span>
<span id="cb1-164"><a href="#cb1-164"></a><span class="kw">bg3d</span>(<span class="kw">rgb</span>(<span class="dv">54</span>, <span class="dv">57</span>, <span class="dv">64</span>, <span class="dt">maxColorValue =</span> <span class="dv">255</span>))</span>
<span id="cb1-165"><a href="#cb1-165"></a><span class="co">## plot the edges</span></span>
<span id="cb1-166"><a href="#cb1-166"></a><span class="cf">for</span>(k <span class="cf">in</span> 1L<span class="op">:</span><span class="kw">nrow</span>(edges)){</span>
<span id="cb1-167"><a href="#cb1-167"></a>  edge &lt;-<span class="st"> </span><span class="kw">stereoEdge</span>(vertices, edges[k,], r, <span class="dt">n =</span> <span class="dv">100</span>)</span>
<span id="cb1-168"><a href="#cb1-168"></a>  <span class="kw">shade3d</span>(edge, <span class="dt">color =</span> <span class="st">&quot;gold&quot;</span>)</span>
<span id="cb1-169"><a href="#cb1-169"></a>}</span>
<span id="cb1-170"><a href="#cb1-170"></a><span class="co">## plot the vertices</span></span>
<span id="cb1-171"><a href="#cb1-171"></a><span class="cf">for</span>(i <span class="cf">in</span> 1L<span class="op">:</span><span class="kw">nrow</span>(vs)){</span>
<span id="cb1-172"><a href="#cb1-172"></a>  v &lt;-<span class="st"> </span>vs[i,]</span>
<span id="cb1-173"><a href="#cb1-173"></a>  <span class="kw">spheres3d</span>(v, <span class="dt">radius =</span> <span class="kw">log1p</span>(<span class="kw">sqrt</span>(<span class="kw">c</span>(<span class="kw">crossprod</span>(v)))<span class="op">/</span><span class="dv">4</span>)<span class="op">/</span><span class="dv">3</span>, <span class="dt">color =</span> <span class="st">&quot;gold2&quot;</span>)</span>
<span id="cb1-174"><a href="#cb1-174"></a>}</span>
<span id="cb1-175"><a href="#cb1-175"></a><span class="co">## plot the filled triangles</span></span>
<span id="cb1-176"><a href="#cb1-176"></a><span class="cf">for</span>(i <span class="cf">in</span> 1L<span class="op">:</span><span class="kw">nrow</span>(triangles)){</span>
<span id="cb1-177"><a href="#cb1-177"></a>  trgl &lt;-<span class="st"> </span>triangles[i,]</span>
<span id="cb1-178"><a href="#cb1-178"></a>  A &lt;-<span class="st"> </span>vertices[trgl[1L], ]</span>
<span id="cb1-179"><a href="#cb1-179"></a>  B &lt;-<span class="st"> </span>vertices[trgl[2L], ]</span>
<span id="cb1-180"><a href="#cb1-180"></a>  C &lt;-<span class="st"> </span>vertices[trgl[3L], ]</span>
<span id="cb1-181"><a href="#cb1-181"></a>  mesh &lt;-<span class="st"> </span><span class="kw">stereoTriangle</span>(<span class="dv">6</span>, A, B, C, r)</span>
<span id="cb1-182"><a href="#cb1-182"></a>  <span class="kw">shade3d</span>(mesh, <span class="dt">color =</span> <span class="st">&quot;red&quot;</span>)</span>
<span id="cb1-183"><a href="#cb1-183"></a>}</span></code></pre></div>
<p><img src="figures/truncatedTesseract_stereographic_rgl.gif" /></p>
<h1 id="drawing-with-asymptote">Drawing with Asymptote</h1>
<div class="sourceCode" id="cb2"><pre class="sourceCode numberSource cpp numberLines"><code class="sourceCode cpp"><span id="cb2-1"><a href="#cb2-1"></a>settings.render = <span class="dv">4</span>;</span>
<span id="cb2-2"><a href="#cb2-2"></a>settings.outformat = <span class="st">&quot;eps&quot;</span>;</span>
<span id="cb2-3"><a href="#cb2-3"></a><span class="kw">import</span> tube;</span>
<span id="cb2-4"><a href="#cb2-4"></a>size(<span class="dv">200</span>,<span class="dv">0</span>);</span>
<span id="cb2-5"><a href="#cb2-5"></a></span>
<span id="cb2-6"><a href="#cb2-6"></a>currentprojection = orthographic(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">4</span>);</span>
<span id="cb2-7"><a href="#cb2-7"></a>currentlight = light(gray(<span class="fl">0.85</span>), ambient=black, specularfactor=<span class="dv">3</span>,</span>
<span id="cb2-8"><a href="#cb2-8"></a>                     (<span class="dv">100</span>,<span class="dv">100</span>,<span class="dv">100</span>), specular=gray(<span class="fl">0.9</span>), viewport=<span class="kw">false</span>);</span>
<span id="cb2-9"><a href="#cb2-9"></a>currentlight.background = rgb(<span class="st">&quot;363940ff&quot;</span>);</span>
<span id="cb2-10"><a href="#cb2-10"></a></span>
<span id="cb2-11"><a href="#cb2-11"></a><span class="co">// files to be saved -----------------------------------------------------------</span></span>
<span id="cb2-12"><a href="#cb2-12"></a>string[] files = {</span>
<span id="cb2-13"><a href="#cb2-13"></a>    <span class="st">&quot;TT000&quot;</span>, <span class="st">&quot;TT001&quot;</span>, <span class="st">&quot;TT002&quot;</span>, <span class="st">&quot;TT003&quot;</span>, <span class="st">&quot;TT004&quot;</span>, <span class="st">&quot;TT005&quot;</span>,</span>
<span id="cb2-14"><a href="#cb2-14"></a>    <span class="st">&quot;TT006&quot;</span>, <span class="st">&quot;TT007&quot;</span>, <span class="st">&quot;TT008&quot;</span>, <span class="st">&quot;TT009&quot;</span>, <span class="st">&quot;TT010&quot;</span>, <span class="st">&quot;TT011&quot;</span>,</span>
<span id="cb2-15"><a href="#cb2-15"></a>    <span class="st">&quot;TT012&quot;</span>, <span class="st">&quot;TT013&quot;</span>, <span class="st">&quot;TT014&quot;</span>, <span class="st">&quot;TT015&quot;</span>, <span class="st">&quot;TT016&quot;</span>, <span class="st">&quot;TT017&quot;</span>,</span>
<span id="cb2-16"><a href="#cb2-16"></a>    <span class="st">&quot;TT018&quot;</span>, <span class="st">&quot;TT019&quot;</span>, <span class="st">&quot;TT020&quot;</span>, <span class="st">&quot;TT021&quot;</span>, <span class="st">&quot;TT022&quot;</span>, <span class="st">&quot;TT023&quot;</span>,</span>
<span id="cb2-17"><a href="#cb2-17"></a>    <span class="st">&quot;TT024&quot;</span>, <span class="st">&quot;TT025&quot;</span>, <span class="st">&quot;TT026&quot;</span>, <span class="st">&quot;TT027&quot;</span>, <span class="st">&quot;TT028&quot;</span>, <span class="st">&quot;TT029&quot;</span>,</span>
<span id="cb2-18"><a href="#cb2-18"></a>    <span class="st">&quot;TT030&quot;</span>, <span class="st">&quot;TT031&quot;</span>, <span class="st">&quot;TT032&quot;</span>, <span class="st">&quot;TT033&quot;</span>, <span class="st">&quot;TT034&quot;</span>, <span class="st">&quot;TT035&quot;</span>,</span>
<span id="cb2-19"><a href="#cb2-19"></a>    <span class="st">&quot;TT036&quot;</span>, <span class="st">&quot;TT037&quot;</span>, <span class="st">&quot;TT038&quot;</span>, <span class="st">&quot;TT039&quot;</span>, <span class="st">&quot;TT040&quot;</span>, <span class="st">&quot;TT041&quot;</span>,</span>
<span id="cb2-20"><a href="#cb2-20"></a>    <span class="st">&quot;TT042&quot;</span>, <span class="st">&quot;TT043&quot;</span>, <span class="st">&quot;TT044&quot;</span>, <span class="st">&quot;TT045&quot;</span>, <span class="st">&quot;TT046&quot;</span>, <span class="st">&quot;TT047&quot;</span>,</span>
<span id="cb2-21"><a href="#cb2-21"></a>    <span class="st">&quot;TT048&quot;</span>, <span class="st">&quot;TT049&quot;</span>, <span class="st">&quot;TT050&quot;</span>, <span class="st">&quot;TT051&quot;</span>, <span class="st">&quot;TT052&quot;</span>, <span class="st">&quot;TT053&quot;</span>,</span>
<span id="cb2-22"><a href="#cb2-22"></a>    <span class="st">&quot;TT054&quot;</span>, <span class="st">&quot;TT055&quot;</span>, <span class="st">&quot;TT056&quot;</span>, <span class="st">&quot;TT057&quot;</span>, <span class="st">&quot;TT058&quot;</span>, <span class="st">&quot;TT059&quot;</span>,</span>
<span id="cb2-23"><a href="#cb2-23"></a>    <span class="st">&quot;TT060&quot;</span>, <span class="st">&quot;TT061&quot;</span>, <span class="st">&quot;TT062&quot;</span>, <span class="st">&quot;TT063&quot;</span>, <span class="st">&quot;TT064&quot;</span>, <span class="st">&quot;TT065&quot;</span>,</span>
<span id="cb2-24"><a href="#cb2-24"></a>    <span class="st">&quot;TT066&quot;</span>, <span class="st">&quot;TT067&quot;</span>, <span class="st">&quot;TT068&quot;</span>, <span class="st">&quot;TT069&quot;</span>, <span class="st">&quot;TT070&quot;</span>, <span class="st">&quot;TT071&quot;</span>,</span>
<span id="cb2-25"><a href="#cb2-25"></a>    <span class="st">&quot;TT072&quot;</span>, <span class="st">&quot;TT073&quot;</span>, <span class="st">&quot;TT074&quot;</span>, <span class="st">&quot;TT075&quot;</span>, <span class="st">&quot;TT076&quot;</span>, <span class="st">&quot;TT077&quot;</span>,</span>
<span id="cb2-26"><a href="#cb2-26"></a>    <span class="st">&quot;TT078&quot;</span>, <span class="st">&quot;TT079&quot;</span>, <span class="st">&quot;TT080&quot;</span>, <span class="st">&quot;TT081&quot;</span>, <span class="st">&quot;TT082&quot;</span>, <span class="st">&quot;TT083&quot;</span>,</span>
<span id="cb2-27"><a href="#cb2-27"></a>    <span class="st">&quot;TT084&quot;</span>, <span class="st">&quot;TT085&quot;</span>, <span class="st">&quot;TT086&quot;</span>, <span class="st">&quot;TT087&quot;</span>, <span class="st">&quot;TT088&quot;</span>, <span class="st">&quot;TT089&quot;</span>,</span>
<span id="cb2-28"><a href="#cb2-28"></a>    <span class="st">&quot;TT090&quot;</span>, <span class="st">&quot;TT091&quot;</span>, <span class="st">&quot;TT092&quot;</span>, <span class="st">&quot;TT093&quot;</span>, <span class="st">&quot;TT094&quot;</span>, <span class="st">&quot;TT095&quot;</span>,</span>
<span id="cb2-29"><a href="#cb2-29"></a>    <span class="st">&quot;TT096&quot;</span>, <span class="st">&quot;TT097&quot;</span>, <span class="st">&quot;TT098&quot;</span>, <span class="st">&quot;TT099&quot;</span>, <span class="st">&quot;TT100&quot;</span>, <span class="st">&quot;TT101&quot;</span>,</span>
<span id="cb2-30"><a href="#cb2-30"></a>    <span class="st">&quot;TT102&quot;</span>, <span class="st">&quot;TT103&quot;</span>, <span class="st">&quot;TT104&quot;</span>, <span class="st">&quot;TT105&quot;</span>, <span class="st">&quot;TT106&quot;</span>, <span class="st">&quot;TT107&quot;</span>,</span>
<span id="cb2-31"><a href="#cb2-31"></a>    <span class="st">&quot;TT108&quot;</span>, <span class="st">&quot;TT109&quot;</span>, <span class="st">&quot;TT110&quot;</span>, <span class="st">&quot;TT111&quot;</span>, <span class="st">&quot;TT112&quot;</span>, <span class="st">&quot;TT113&quot;</span>,</span>
<span id="cb2-32"><a href="#cb2-32"></a>    <span class="st">&quot;TT114&quot;</span>, <span class="st">&quot;TT115&quot;</span>, <span class="st">&quot;TT116&quot;</span>, <span class="st">&quot;TT117&quot;</span>, <span class="st">&quot;TT118&quot;</span>, <span class="st">&quot;TT119&quot;</span>,</span>
<span id="cb2-33"><a href="#cb2-33"></a>    <span class="st">&quot;TT120&quot;</span>, <span class="st">&quot;TT121&quot;</span>, <span class="st">&quot;TT122&quot;</span>, <span class="st">&quot;TT123&quot;</span>, <span class="st">&quot;TT124&quot;</span>, <span class="st">&quot;TT125&quot;</span>,</span>
<span id="cb2-34"><a href="#cb2-34"></a>    <span class="st">&quot;TT126&quot;</span>, <span class="st">&quot;TT127&quot;</span>, <span class="st">&quot;TT128&quot;</span>, <span class="st">&quot;TT129&quot;</span>, <span class="st">&quot;TT130&quot;</span>, <span class="st">&quot;TT131&quot;</span>,</span>
<span id="cb2-35"><a href="#cb2-35"></a>    <span class="st">&quot;TT132&quot;</span>, <span class="st">&quot;TT133&quot;</span>, <span class="st">&quot;TT134&quot;</span>, <span class="st">&quot;TT135&quot;</span>, <span class="st">&quot;TT136&quot;</span>, <span class="st">&quot;TT137&quot;</span>,</span>
<span id="cb2-36"><a href="#cb2-36"></a>    <span class="st">&quot;TT138&quot;</span>, <span class="st">&quot;TT139&quot;</span>, <span class="st">&quot;TT140&quot;</span>, <span class="st">&quot;TT141&quot;</span>, <span class="st">&quot;TT142&quot;</span>, <span class="st">&quot;TT143&quot;</span>,</span>
<span id="cb2-37"><a href="#cb2-37"></a>    <span class="st">&quot;TT144&quot;</span>, <span class="st">&quot;TT145&quot;</span>, <span class="st">&quot;TT146&quot;</span>, <span class="st">&quot;TT147&quot;</span>, <span class="st">&quot;TT148&quot;</span>, <span class="st">&quot;TT149&quot;</span>,</span>
<span id="cb2-38"><a href="#cb2-38"></a>    <span class="st">&quot;TT150&quot;</span>, <span class="st">&quot;TT151&quot;</span>, <span class="st">&quot;TT152&quot;</span>, <span class="st">&quot;TT153&quot;</span>, <span class="st">&quot;TT154&quot;</span>, <span class="st">&quot;TT155&quot;</span>,</span>
<span id="cb2-39"><a href="#cb2-39"></a>    <span class="st">&quot;TT156&quot;</span>, <span class="st">&quot;TT157&quot;</span>, <span class="st">&quot;TT158&quot;</span>, <span class="st">&quot;TT159&quot;</span>, <span class="st">&quot;TT160&quot;</span>, <span class="st">&quot;TT161&quot;</span>,</span>
<span id="cb2-40"><a href="#cb2-40"></a>    <span class="st">&quot;TT162&quot;</span>, <span class="st">&quot;TT163&quot;</span>, <span class="st">&quot;TT164&quot;</span>, <span class="st">&quot;TT165&quot;</span>, <span class="st">&quot;TT166&quot;</span>, <span class="st">&quot;TT167&quot;</span>,</span>
<span id="cb2-41"><a href="#cb2-41"></a>    <span class="st">&quot;TT168&quot;</span>, <span class="st">&quot;TT169&quot;</span>, <span class="st">&quot;TT170&quot;</span>, <span class="st">&quot;TT171&quot;</span>, <span class="st">&quot;TT172&quot;</span>, <span class="st">&quot;TT173&quot;</span>,</span>
<span id="cb2-42"><a href="#cb2-42"></a>    <span class="st">&quot;TT174&quot;</span>, <span class="st">&quot;TT175&quot;</span>, <span class="st">&quot;TT176&quot;</span>, <span class="st">&quot;TT177&quot;</span>, <span class="st">&quot;TT178&quot;</span>, <span class="st">&quot;TT179&quot;</span>};</span>
<span id="cb2-43"><a href="#cb2-43"></a></span>
<span id="cb2-44"><a href="#cb2-44"></a><span class="co">// vertices --------------------------------------------------------------------</span></span>
<span id="cb2-45"><a href="#cb2-45"></a><span class="kw">struct</span> quadruple {</span>
<span id="cb2-46"><a href="#cb2-46"></a>    real x;</span>
<span id="cb2-47"><a href="#cb2-47"></a>    real y;</span>
<span id="cb2-48"><a href="#cb2-48"></a>    real z;</span>
<span id="cb2-49"><a href="#cb2-49"></a>    real t;</span>
<span id="cb2-50"><a href="#cb2-50"></a>}</span>
<span id="cb2-51"><a href="#cb2-51"></a></span>
<span id="cb2-52"><a href="#cb2-52"></a>quadruple array2quadruple(real[] v){</span>
<span id="cb2-53"><a href="#cb2-53"></a>    quadruple q;</span>
<span id="cb2-54"><a href="#cb2-54"></a>    q.x = v[<span class="dv">0</span>]; q.y = v[<span class="dv">1</span>]; q.z = v[<span class="dv">2</span>]; q.t = v[<span class="dv">3</span>];</span>
<span id="cb2-55"><a href="#cb2-55"></a>    <span class="cf">return</span> q;</span>
<span id="cb2-56"><a href="#cb2-56"></a>}</span>
<span id="cb2-57"><a href="#cb2-57"></a></span>
<span id="cb2-58"><a href="#cb2-58"></a>real x = <span class="dv">1</span> + sqrt(<span class="dv">2</span>);</span>
<span id="cb2-59"><a href="#cb2-59"></a>real r = sqrt(<span class="dv">1</span> + <span class="dv">3</span> * x * x);</span>
<span id="cb2-60"><a href="#cb2-60"></a>real[][] vertices0 = {</span>
<span id="cb2-61"><a href="#cb2-61"></a>    {-<span class="fl">1.0</span>, -x, -x, -x},</span>
<span id="cb2-62"><a href="#cb2-62"></a>    {-<span class="fl">1.0</span>, -x, -x, x},</span>
<span id="cb2-63"><a href="#cb2-63"></a>    {-<span class="fl">1.0</span>, -x, x, -x},</span>
<span id="cb2-64"><a href="#cb2-64"></a>    {-<span class="fl">1.0</span>, -x, x, x},</span>
<span id="cb2-65"><a href="#cb2-65"></a>    {-<span class="fl">1.0</span>, x, -x, -x},</span>
<span id="cb2-66"><a href="#cb2-66"></a>    {-<span class="fl">1.0</span>, x, -x, x},</span>
<span id="cb2-67"><a href="#cb2-67"></a>    {-<span class="fl">1.0</span>, x, x, -x},</span>
<span id="cb2-68"><a href="#cb2-68"></a>    {-<span class="fl">1.0</span>, x, x, x},</span>
<span id="cb2-69"><a href="#cb2-69"></a>    {<span class="fl">1.0</span>, -x, -x, -x},</span>
<span id="cb2-70"><a href="#cb2-70"></a>    {<span class="fl">1.0</span>, -x, -x, x},</span>
<span id="cb2-71"><a href="#cb2-71"></a>    {<span class="fl">1.0</span>, -x, x, -x},</span>
<span id="cb2-72"><a href="#cb2-72"></a>    {<span class="fl">1.0</span>, -x, x, x},</span>
<span id="cb2-73"><a href="#cb2-73"></a>    {<span class="fl">1.0</span>, x, -x, -x},</span>
<span id="cb2-74"><a href="#cb2-74"></a>    {<span class="fl">1.0</span>, x, -x, x},</span>
<span id="cb2-75"><a href="#cb2-75"></a>    {<span class="fl">1.0</span>, x, x, -x},</span>
<span id="cb2-76"><a href="#cb2-76"></a>    {<span class="fl">1.0</span>, x, x, x},</span>
<span id="cb2-77"><a href="#cb2-77"></a>    {-x, -<span class="fl">1.0</span>, -x, -x},</span>
<span id="cb2-78"><a href="#cb2-78"></a>    {-x, -<span class="fl">1.0</span>, -x, x},</span>
<span id="cb2-79"><a href="#cb2-79"></a>    {-x, -<span class="fl">1.0</span>, x, -x},</span>
<span id="cb2-80"><a href="#cb2-80"></a>    {-x, -<span class="fl">1.0</span>, x, x},</span>
<span id="cb2-81"><a href="#cb2-81"></a>    {-x, <span class="fl">1.0</span>, -x, -x},</span>
<span id="cb2-82"><a href="#cb2-82"></a>    {-x, <span class="fl">1.0</span>, -x, x},</span>
<span id="cb2-83"><a href="#cb2-83"></a>    {-x, <span class="fl">1.0</span>, x, -x},</span>
<span id="cb2-84"><a href="#cb2-84"></a>    {-x, <span class="fl">1.0</span>, x, x},</span>
<span id="cb2-85"><a href="#cb2-85"></a>    {x, -<span class="fl">1.0</span>, -x, -x},</span>
<span id="cb2-86"><a href="#cb2-86"></a>    {x, -<span class="fl">1.0</span>, -x, x},</span>
<span id="cb2-87"><a href="#cb2-87"></a>    {x, -<span class="fl">1.0</span>, x, -x},</span>
<span id="cb2-88"><a href="#cb2-88"></a>    {x, -<span class="fl">1.0</span>, x, x},</span>
<span id="cb2-89"><a href="#cb2-89"></a>    {x, <span class="fl">1.0</span>, -x, -x},</span>
<span id="cb2-90"><a href="#cb2-90"></a>    {x, <span class="fl">1.0</span>, -x, x},</span>
<span id="cb2-91"><a href="#cb2-91"></a>    {x, <span class="fl">1.0</span>, x, -x},</span>
<span id="cb2-92"><a href="#cb2-92"></a>    {x, <span class="fl">1.0</span>, x, x},</span>
<span id="cb2-93"><a href="#cb2-93"></a>    {-x, -x, -<span class="fl">1.0</span>, -x},</span>
<span id="cb2-94"><a href="#cb2-94"></a>    {-x, -x, -<span class="fl">1.0</span>, x},</span>
<span id="cb2-95"><a href="#cb2-95"></a>    {-x, -x, <span class="fl">1.0</span>, -x},</span>
<span id="cb2-96"><a href="#cb2-96"></a>    {-x, -x, <span class="fl">1.0</span>, x},</span>
<span id="cb2-97"><a href="#cb2-97"></a>    {-x, x, -<span class="fl">1.0</span>, -x},</span>
<span id="cb2-98"><a href="#cb2-98"></a>    {-x, x, -<span class="fl">1.0</span>, x},</span>
<span id="cb2-99"><a href="#cb2-99"></a>    {-x, x, <span class="fl">1.0</span>, -x},</span>
<span id="cb2-100"><a href="#cb2-100"></a>    {-x, x, <span class="fl">1.0</span>, x},</span>
<span id="cb2-101"><a href="#cb2-101"></a>    {x, -x, -<span class="fl">1.0</span>, -x},</span>
<span id="cb2-102"><a href="#cb2-102"></a>    {x, -x, -<span class="fl">1.0</span>, x},</span>
<span id="cb2-103"><a href="#cb2-103"></a>    {x, -x, <span class="fl">1.0</span>, -x},</span>
<span id="cb2-104"><a href="#cb2-104"></a>    {x, -x, <span class="fl">1.0</span>, x},</span>
<span id="cb2-105"><a href="#cb2-105"></a>    {x, x, -<span class="fl">1.0</span>, -x},</span>
<span id="cb2-106"><a href="#cb2-106"></a>    {x, x, -<span class="fl">1.0</span>, x},</span>
<span id="cb2-107"><a href="#cb2-107"></a>    {x, x, <span class="fl">1.0</span>, -x},</span>
<span id="cb2-108"><a href="#cb2-108"></a>    {x, x, <span class="fl">1.0</span>, x},</span>
<span id="cb2-109"><a href="#cb2-109"></a>    {-x, -x, -x, -<span class="fl">1.0</span>},</span>
<span id="cb2-110"><a href="#cb2-110"></a>    {-x, -x, -x, <span class="fl">1.0</span>},</span>
<span id="cb2-111"><a href="#cb2-111"></a>    {-x, -x, x, -<span class="fl">1.0</span>},</span>
<span id="cb2-112"><a href="#cb2-112"></a>    {-x, -x, x, <span class="fl">1.0</span>},</span>
<span id="cb2-113"><a href="#cb2-113"></a>    {-x, x, -x, -<span class="fl">1.0</span>},</span>
<span id="cb2-114"><a href="#cb2-114"></a>    {-x, x, -x, <span class="fl">1.0</span>},</span>
<span id="cb2-115"><a href="#cb2-115"></a>    {-x, x, x, -<span class="fl">1.0</span>},</span>
<span id="cb2-116"><a href="#cb2-116"></a>    {-x, x, x, <span class="fl">1.0</span>},</span>
<span id="cb2-117"><a href="#cb2-117"></a>    {x, -x, -x, -<span class="fl">1.0</span>},</span>
<span id="cb2-118"><a href="#cb2-118"></a>    {x, -x, -x, <span class="fl">1.0</span>},</span>
<span id="cb2-119"><a href="#cb2-119"></a>    {x, -x, x, -<span class="fl">1.0</span>},</span>
<span id="cb2-120"><a href="#cb2-120"></a>    {x, -x, x, <span class="fl">1.0</span>},</span>
<span id="cb2-121"><a href="#cb2-121"></a>    {x, x, -x, -<span class="fl">1.0</span>},</span>
<span id="cb2-122"><a href="#cb2-122"></a>    {x, x, -x, <span class="fl">1.0</span>},</span>
<span id="cb2-123"><a href="#cb2-123"></a>    {x, x, x, -<span class="fl">1.0</span>},</span>
<span id="cb2-124"><a href="#cb2-124"></a>    {x, x, x, <span class="fl">1.0</span>} };</span>
<span id="cb2-125"><a href="#cb2-125"></a>    </span>
<span id="cb2-126"><a href="#cb2-126"></a>quadruple[] vertices = <span class="kw">new</span> quadruple[vertices0.length];</span>
<span id="cb2-127"><a href="#cb2-127"></a><span class="cf">for</span>(<span class="dt">int</span> i = <span class="dv">0</span>; i &lt; vertices0.length; ++i){</span>
<span id="cb2-128"><a href="#cb2-128"></a>    vertices[i] = array2quadruple(vertices0[i]);</span>
<span id="cb2-129"><a href="#cb2-129"></a>}</span>
<span id="cb2-130"><a href="#cb2-130"></a></span>
<span id="cb2-131"><a href="#cb2-131"></a><span class="co">// edges -----------------------------------------------------------------------</span></span>
<span id="cb2-132"><a href="#cb2-132"></a><span class="dt">int</span>[][] edges = {</span>
<span id="cb2-133"><a href="#cb2-133"></a>    {<span class="dv">0</span>, <span class="dv">8</span>},</span>
<span id="cb2-134"><a href="#cb2-134"></a>    {<span class="dv">0</span>, <span class="dv">16</span>},</span>
<span id="cb2-135"><a href="#cb2-135"></a>    {<span class="dv">0</span>, <span class="dv">32</span>},</span>
<span id="cb2-136"><a href="#cb2-136"></a>    {<span class="dv">0</span>, <span class="dv">48</span>},</span>
<span id="cb2-137"><a href="#cb2-137"></a>    {<span class="dv">1</span>, <span class="dv">9</span>},</span>
<span id="cb2-138"><a href="#cb2-138"></a>    {<span class="dv">1</span>, <span class="dv">17</span>},</span>
<span id="cb2-139"><a href="#cb2-139"></a>    {<span class="dv">1</span>, <span class="dv">33</span>},</span>
<span id="cb2-140"><a href="#cb2-140"></a>    {<span class="dv">1</span>, <span class="dv">49</span>},</span>
<span id="cb2-141"><a href="#cb2-141"></a>    {<span class="dv">2</span>, <span class="dv">10</span>},</span>
<span id="cb2-142"><a href="#cb2-142"></a>    {<span class="dv">2</span>, <span class="dv">18</span>},</span>
<span id="cb2-143"><a href="#cb2-143"></a>    {<span class="dv">2</span>, <span class="dv">34</span>},</span>
<span id="cb2-144"><a href="#cb2-144"></a>    {<span class="dv">2</span>, <span class="dv">50</span>},</span>
<span id="cb2-145"><a href="#cb2-145"></a>    {<span class="dv">3</span>, <span class="dv">11</span>},</span>
<span id="cb2-146"><a href="#cb2-146"></a>    {<span class="dv">3</span>, <span class="dv">19</span>},</span>
<span id="cb2-147"><a href="#cb2-147"></a>    {<span class="dv">3</span>, <span class="dv">35</span>},</span>
<span id="cb2-148"><a href="#cb2-148"></a>    {<span class="dv">3</span>, <span class="dv">51</span>},</span>
<span id="cb2-149"><a href="#cb2-149"></a>    {<span class="dv">4</span>, <span class="dv">12</span>},</span>
<span id="cb2-150"><a href="#cb2-150"></a>    {<span class="dv">4</span>, <span class="dv">20</span>},</span>
<span id="cb2-151"><a href="#cb2-151"></a>    {<span class="dv">4</span>, <span class="dv">36</span>},</span>
<span id="cb2-152"><a href="#cb2-152"></a>    {<span class="dv">4</span>, <span class="dv">52</span>},</span>
<span id="cb2-153"><a href="#cb2-153"></a>    {<span class="dv">5</span>, <span class="dv">13</span>},</span>
<span id="cb2-154"><a href="#cb2-154"></a>    {<span class="dv">5</span>, <span class="dv">21</span>},</span>
<span id="cb2-155"><a href="#cb2-155"></a>    {<span class="dv">5</span>, <span class="dv">37</span>},</span>
<span id="cb2-156"><a href="#cb2-156"></a>    {<span class="dv">5</span>, <span class="dv">53</span>},</span>
<span id="cb2-157"><a href="#cb2-157"></a>    {<span class="dv">6</span>, <span class="dv">14</span>},</span>
<span id="cb2-158"><a href="#cb2-158"></a>    {<span class="dv">6</span>, <span class="dv">22</span>},</span>
<span id="cb2-159"><a href="#cb2-159"></a>    {<span class="dv">6</span>, <span class="dv">38</span>},</span>
<span id="cb2-160"><a href="#cb2-160"></a>    {<span class="dv">6</span>, <span class="dv">54</span>},</span>
<span id="cb2-161"><a href="#cb2-161"></a>    {<span class="dv">7</span>, <span class="dv">15</span>},</span>
<span id="cb2-162"><a href="#cb2-162"></a>    {<span class="dv">7</span>, <span class="dv">23</span>},</span>
<span id="cb2-163"><a href="#cb2-163"></a>    {<span class="dv">7</span>, <span class="dv">39</span>},</span>
<span id="cb2-164"><a href="#cb2-164"></a>    {<span class="dv">7</span>, <span class="dv">55</span>},</span>
<span id="cb2-165"><a href="#cb2-165"></a>    {<span class="dv">8</span>, <span class="dv">24</span>},</span>
<span id="cb2-166"><a href="#cb2-166"></a>    {<span class="dv">8</span>, <span class="dv">40</span>},</span>
<span id="cb2-167"><a href="#cb2-167"></a>    {<span class="dv">8</span>, <span class="dv">56</span>},</span>
<span id="cb2-168"><a href="#cb2-168"></a>    {<span class="dv">9</span>, <span class="dv">25</span>},</span>
<span id="cb2-169"><a href="#cb2-169"></a>    {<span class="dv">9</span>, <span class="dv">41</span>},</span>
<span id="cb2-170"><a href="#cb2-170"></a>    {<span class="dv">9</span>, <span class="dv">57</span>},</span>
<span id="cb2-171"><a href="#cb2-171"></a>    {<span class="dv">10</span>, <span class="dv">26</span>},</span>
<span id="cb2-172"><a href="#cb2-172"></a>    {<span class="dv">10</span>, <span class="dv">42</span>},</span>
<span id="cb2-173"><a href="#cb2-173"></a>    {<span class="dv">10</span>, <span class="dv">58</span>},</span>
<span id="cb2-174"><a href="#cb2-174"></a>    {<span class="dv">11</span>, <span class="dv">27</span>},</span>
<span id="cb2-175"><a href="#cb2-175"></a>    {<span class="dv">11</span>, <span class="dv">43</span>},</span>
<span id="cb2-176"><a href="#cb2-176"></a>    {<span class="dv">11</span>, <span class="dv">59</span>},</span>
<span id="cb2-177"><a href="#cb2-177"></a>    {<span class="dv">12</span>, <span class="dv">28</span>},</span>
<span id="cb2-178"><a href="#cb2-178"></a>    {<span class="dv">12</span>, <span class="dv">44</span>},</span>
<span id="cb2-179"><a href="#cb2-179"></a>    {<span class="dv">12</span>, <span class="dv">60</span>},</span>
<span id="cb2-180"><a href="#cb2-180"></a>    {<span class="dv">13</span>, <span class="dv">29</span>},</span>
<span id="cb2-181"><a href="#cb2-181"></a>    {<span class="dv">13</span>, <span class="dv">45</span>},</span>
<span id="cb2-182"><a href="#cb2-182"></a>    {<span class="dv">13</span>, <span class="dv">61</span>},</span>
<span id="cb2-183"><a href="#cb2-183"></a>    {<span class="dv">14</span>, <span class="dv">30</span>},</span>
<span id="cb2-184"><a href="#cb2-184"></a>    {<span class="dv">14</span>, <span class="dv">46</span>},</span>
<span id="cb2-185"><a href="#cb2-185"></a>    {<span class="dv">14</span>, <span class="dv">62</span>},</span>
<span id="cb2-186"><a href="#cb2-186"></a>    {<span class="dv">15</span>, <span class="dv">31</span>},</span>
<span id="cb2-187"><a href="#cb2-187"></a>    {<span class="dv">15</span>, <span class="dv">47</span>},</span>
<span id="cb2-188"><a href="#cb2-188"></a>    {<span class="dv">15</span>, <span class="dv">63</span>},</span>
<span id="cb2-189"><a href="#cb2-189"></a>    {<span class="dv">16</span>, <span class="dv">20</span>},</span>
<span id="cb2-190"><a href="#cb2-190"></a>    {<span class="dv">16</span>, <span class="dv">32</span>},</span>
<span id="cb2-191"><a href="#cb2-191"></a>    {<span class="dv">16</span>, <span class="dv">48</span>},</span>
<span id="cb2-192"><a href="#cb2-192"></a>    {<span class="dv">17</span>, <span class="dv">21</span>},</span>
<span id="cb2-193"><a href="#cb2-193"></a>    {<span class="dv">17</span>, <span class="dv">33</span>},</span>
<span id="cb2-194"><a href="#cb2-194"></a>    {<span class="dv">17</span>, <span class="dv">49</span>},</span>
<span id="cb2-195"><a href="#cb2-195"></a>    {<span class="dv">18</span>, <span class="dv">22</span>},</span>
<span id="cb2-196"><a href="#cb2-196"></a>    {<span class="dv">18</span>, <span class="dv">34</span>},</span>
<span id="cb2-197"><a href="#cb2-197"></a>    {<span class="dv">18</span>, <span class="dv">50</span>},</span>
<span id="cb2-198"><a href="#cb2-198"></a>    {<span class="dv">19</span>, <span class="dv">23</span>},</span>
<span id="cb2-199"><a href="#cb2-199"></a>    {<span class="dv">19</span>, <span class="dv">35</span>},</span>
<span id="cb2-200"><a href="#cb2-200"></a>    {<span class="dv">19</span>, <span class="dv">51</span>},</span>
<span id="cb2-201"><a href="#cb2-201"></a>    {<span class="dv">20</span>, <span class="dv">36</span>},</span>
<span id="cb2-202"><a href="#cb2-202"></a>    {<span class="dv">20</span>, <span class="dv">52</span>},</span>
<span id="cb2-203"><a href="#cb2-203"></a>    {<span class="dv">21</span>, <span class="dv">37</span>},</span>
<span id="cb2-204"><a href="#cb2-204"></a>    {<span class="dv">21</span>, <span class="dv">53</span>},</span>
<span id="cb2-205"><a href="#cb2-205"></a>    {<span class="dv">22</span>, <span class="dv">38</span>},</span>
<span id="cb2-206"><a href="#cb2-206"></a>    {<span class="dv">22</span>, <span class="dv">54</span>},</span>
<span id="cb2-207"><a href="#cb2-207"></a>    {<span class="dv">23</span>, <span class="dv">39</span>},</span>
<span id="cb2-208"><a href="#cb2-208"></a>    {<span class="dv">23</span>, <span class="dv">55</span>},</span>
<span id="cb2-209"><a href="#cb2-209"></a>    {<span class="dv">24</span>, <span class="dv">28</span>},</span>
<span id="cb2-210"><a href="#cb2-210"></a>    {<span class="dv">24</span>, <span class="dv">40</span>},</span>
<span id="cb2-211"><a href="#cb2-211"></a>    {<span class="dv">24</span>, <span class="dv">56</span>},</span>
<span id="cb2-212"><a href="#cb2-212"></a>    {<span class="dv">25</span>, <span class="dv">29</span>},</span>
<span id="cb2-213"><a href="#cb2-213"></a>    {<span class="dv">25</span>, <span class="dv">41</span>},</span>
<span id="cb2-214"><a href="#cb2-214"></a>    {<span class="dv">25</span>, <span class="dv">57</span>},</span>
<span id="cb2-215"><a href="#cb2-215"></a>    {<span class="dv">26</span>, <span class="dv">30</span>},</span>
<span id="cb2-216"><a href="#cb2-216"></a>    {<span class="dv">26</span>, <span class="dv">42</span>},</span>
<span id="cb2-217"><a href="#cb2-217"></a>    {<span class="dv">26</span>, <span class="dv">58</span>},</span>
<span id="cb2-218"><a href="#cb2-218"></a>    {<span class="dv">27</span>, <span class="dv">31</span>},</span>
<span id="cb2-219"><a href="#cb2-219"></a>    {<span class="dv">27</span>, <span class="dv">43</span>},</span>
<span id="cb2-220"><a href="#cb2-220"></a>    {<span class="dv">27</span>, <span class="dv">59</span>},</span>
<span id="cb2-221"><a href="#cb2-221"></a>    {<span class="dv">28</span>, <span class="dv">44</span>},</span>
<span id="cb2-222"><a href="#cb2-222"></a>    {<span class="dv">28</span>, <span class="dv">60</span>},</span>
<span id="cb2-223"><a href="#cb2-223"></a>    {<span class="dv">29</span>, <span class="dv">45</span>},</span>
<span id="cb2-224"><a href="#cb2-224"></a>    {<span class="dv">29</span>, <span class="dv">61</span>},</span>
<span id="cb2-225"><a href="#cb2-225"></a>    {<span class="dv">30</span>, <span class="dv">46</span>},</span>
<span id="cb2-226"><a href="#cb2-226"></a>    {<span class="dv">30</span>, <span class="dv">62</span>},</span>
<span id="cb2-227"><a href="#cb2-227"></a>    {<span class="dv">31</span>, <span class="dv">47</span>},</span>
<span id="cb2-228"><a href="#cb2-228"></a>    {<span class="dv">31</span>, <span class="dv">63</span>},</span>
<span id="cb2-229"><a href="#cb2-229"></a>    {<span class="dv">32</span>, <span class="dv">34</span>},</span>
<span id="cb2-230"><a href="#cb2-230"></a>    {<span class="dv">32</span>, <span class="dv">48</span>},</span>
<span id="cb2-231"><a href="#cb2-231"></a>    {<span class="dv">33</span>, <span class="dv">35</span>},</span>
<span id="cb2-232"><a href="#cb2-232"></a>    {<span class="dv">33</span>, <span class="dv">49</span>},</span>
<span id="cb2-233"><a href="#cb2-233"></a>    {<span class="dv">34</span>, <span class="dv">50</span>},</span>
<span id="cb2-234"><a href="#cb2-234"></a>    {<span class="dv">35</span>, <span class="dv">51</span>},</span>
<span id="cb2-235"><a href="#cb2-235"></a>    {<span class="dv">36</span>, <span class="dv">38</span>},</span>
<span id="cb2-236"><a href="#cb2-236"></a>    {<span class="dv">36</span>, <span class="dv">52</span>},</span>
<span id="cb2-237"><a href="#cb2-237"></a>    {<span class="dv">37</span>, <span class="dv">39</span>},</span>
<span id="cb2-238"><a href="#cb2-238"></a>    {<span class="dv">37</span>, <span class="dv">53</span>},</span>
<span id="cb2-239"><a href="#cb2-239"></a>    {<span class="dv">38</span>, <span class="dv">54</span>},</span>
<span id="cb2-240"><a href="#cb2-240"></a>    {<span class="dv">39</span>, <span class="dv">55</span>},</span>
<span id="cb2-241"><a href="#cb2-241"></a>    {<span class="dv">40</span>, <span class="dv">42</span>},</span>
<span id="cb2-242"><a href="#cb2-242"></a>    {<span class="dv">40</span>, <span class="dv">56</span>},</span>
<span id="cb2-243"><a href="#cb2-243"></a>    {<span class="dv">41</span>, <span class="dv">43</span>},</span>
<span id="cb2-244"><a href="#cb2-244"></a>    {<span class="dv">41</span>, <span class="dv">57</span>},</span>
<span id="cb2-245"><a href="#cb2-245"></a>    {<span class="dv">42</span>, <span class="dv">58</span>},</span>
<span id="cb2-246"><a href="#cb2-246"></a>    {<span class="dv">43</span>, <span class="dv">59</span>},</span>
<span id="cb2-247"><a href="#cb2-247"></a>    {<span class="dv">44</span>, <span class="dv">46</span>},</span>
<span id="cb2-248"><a href="#cb2-248"></a>    {<span class="dv">44</span>, <span class="dv">60</span>},</span>
<span id="cb2-249"><a href="#cb2-249"></a>    {<span class="dv">45</span>, <span class="dv">47</span>},</span>
<span id="cb2-250"><a href="#cb2-250"></a>    {<span class="dv">45</span>, <span class="dv">61</span>},</span>
<span id="cb2-251"><a href="#cb2-251"></a>    {<span class="dv">46</span>, <span class="dv">62</span>},</span>
<span id="cb2-252"><a href="#cb2-252"></a>    {<span class="dv">47</span>, <span class="dv">63</span>},</span>
<span id="cb2-253"><a href="#cb2-253"></a>    {<span class="dv">48</span>, <span class="dv">49</span>},</span>
<span id="cb2-254"><a href="#cb2-254"></a>    {<span class="dv">50</span>, <span class="dv">51</span>},</span>
<span id="cb2-255"><a href="#cb2-255"></a>    {<span class="dv">52</span>, <span class="dv">53</span>},</span>
<span id="cb2-256"><a href="#cb2-256"></a>    {<span class="dv">54</span>, <span class="dv">55</span>},</span>
<span id="cb2-257"><a href="#cb2-257"></a>    {<span class="dv">56</span>, <span class="dv">57</span>},</span>
<span id="cb2-258"><a href="#cb2-258"></a>    {<span class="dv">58</span>, <span class="dv">59</span>},</span>
<span id="cb2-259"><a href="#cb2-259"></a>    {<span class="dv">60</span>, <span class="dv">61</span>},</span>
<span id="cb2-260"><a href="#cb2-260"></a>    {<span class="dv">62</span>, <span class="dv">63</span>} };</span>
<span id="cb2-261"><a href="#cb2-261"></a></span>
<span id="cb2-262"><a href="#cb2-262"></a><span class="co">// tetrahedra ------------------------------------------------------------------</span></span>
<span id="cb2-263"><a href="#cb2-263"></a><span class="dt">int</span>[][] tetrahedra = {</span>
<span id="cb2-264"><a href="#cb2-264"></a>    {<span class="dv">0</span>, <span class="dv">16</span>, <span class="dv">32</span>, <span class="dv">48</span>},</span>
<span id="cb2-265"><a href="#cb2-265"></a>    {<span class="dv">11</span>, <span class="dv">27</span>, <span class="dv">43</span>, <span class="dv">59</span>},</span>
<span id="cb2-266"><a href="#cb2-266"></a>    {<span class="dv">12</span>, <span class="dv">28</span>, <span class="dv">44</span>, <span class="dv">60</span>},</span>
<span id="cb2-267"><a href="#cb2-267"></a>    {<span class="dv">8</span>, <span class="dv">24</span>, <span class="dv">40</span>, <span class="dv">56</span>},</span>
<span id="cb2-268"><a href="#cb2-268"></a>    {<span class="dv">9</span>, <span class="dv">25</span>, <span class="dv">41</span>, <span class="dv">57</span>},</span>
<span id="cb2-269"><a href="#cb2-269"></a>    {<span class="dv">15</span>, <span class="dv">31</span>, <span class="dv">47</span>, <span class="dv">63</span>},</span>
<span id="cb2-270"><a href="#cb2-270"></a>    {<span class="dv">13</span>, <span class="dv">29</span>, <span class="dv">45</span>, <span class="dv">61</span>},</span>
<span id="cb2-271"><a href="#cb2-271"></a>    {<span class="dv">14</span>, <span class="dv">30</span>, <span class="dv">46</span>, <span class="dv">62</span>},</span>
<span id="cb2-272"><a href="#cb2-272"></a>    {<span class="dv">10</span>, <span class="dv">26</span>, <span class="dv">42</span>, <span class="dv">58</span>},</span>
<span id="cb2-273"><a href="#cb2-273"></a>    {<span class="dv">3</span>, <span class="dv">19</span>, <span class="dv">35</span>, <span class="dv">51</span>},</span>
<span id="cb2-274"><a href="#cb2-274"></a>    {<span class="dv">2</span>, <span class="dv">18</span>, <span class="dv">34</span>, <span class="dv">50</span>},</span>
<span id="cb2-275"><a href="#cb2-275"></a>    {<span class="dv">1</span>, <span class="dv">17</span>, <span class="dv">33</span>, <span class="dv">49</span>},</span>
<span id="cb2-276"><a href="#cb2-276"></a>    {<span class="dv">4</span>, <span class="dv">20</span>, <span class="dv">36</span>, <span class="dv">52</span>},</span>
<span id="cb2-277"><a href="#cb2-277"></a>    {<span class="dv">5</span>, <span class="dv">21</span>, <span class="dv">37</span>, <span class="dv">53</span>},</span>
<span id="cb2-278"><a href="#cb2-278"></a>    {<span class="dv">6</span>, <span class="dv">22</span>, <span class="dv">38</span>, <span class="dv">54</span>},</span>
<span id="cb2-279"><a href="#cb2-279"></a>    {<span class="dv">7</span>, <span class="dv">23</span>, <span class="dv">39</span>, <span class="dv">55</span>} };</span>
<span id="cb2-280"><a href="#cb2-280"></a></span>
<span id="cb2-281"><a href="#cb2-281"></a><span class="co">// rotation in 4D space (right-isoclinic) --------------------------------------</span></span>
<span id="cb2-282"><a href="#cb2-282"></a>quadruple rotate4d(real alpha, real beta, real xi, quadruple vec){</span>
<span id="cb2-283"><a href="#cb2-283"></a>    real a = cos(xi);</span>
<span id="cb2-284"><a href="#cb2-284"></a>    real b = sin(alpha)*cos(beta)*sin(xi);</span>
<span id="cb2-285"><a href="#cb2-285"></a>    real c = sin(alpha)*sin(beta)*sin(xi);</span>
<span id="cb2-286"><a href="#cb2-286"></a>    real d = cos(alpha)*sin(xi);</span>
<span id="cb2-287"><a href="#cb2-287"></a>    real p = vec.x;</span>
<span id="cb2-288"><a href="#cb2-288"></a>    real q = vec.y;</span>
<span id="cb2-289"><a href="#cb2-289"></a>    real r = vec.z;</span>
<span id="cb2-290"><a href="#cb2-290"></a>    real s = vec.t;</span>
<span id="cb2-291"><a href="#cb2-291"></a>    quadruple out;</span>
<span id="cb2-292"><a href="#cb2-292"></a>    out.x = a*p - b*q - c*r - d*s;</span>
<span id="cb2-293"><a href="#cb2-293"></a>    out.y = a*q + b*p + c*s - d*r;</span>
<span id="cb2-294"><a href="#cb2-294"></a>    out.z = a*r - b*s + c*p + d*q;</span>
<span id="cb2-295"><a href="#cb2-295"></a>    out.t = a*s + b*r - c*q + d*p;</span>
<span id="cb2-296"><a href="#cb2-296"></a>    <span class="cf">return</span> out;</span>
<span id="cb2-297"><a href="#cb2-297"></a>}</span>
<span id="cb2-298"><a href="#cb2-298"></a></span>
<span id="cb2-299"><a href="#cb2-299"></a></span>
<span id="cb2-300"><a href="#cb2-300"></a><span class="co">// stereographic projection ----------------------------------------------------</span></span>
<span id="cb2-301"><a href="#cb2-301"></a>triple stereog(quadruple A, real r){</span>
<span id="cb2-302"><a href="#cb2-302"></a>    <span class="cf">return</span> (A.x, A.y, A.z) / (r - A.t);</span>
<span id="cb2-303"><a href="#cb2-303"></a>}</span>
<span id="cb2-304"><a href="#cb2-304"></a></span>
<span id="cb2-305"><a href="#cb2-305"></a><span class="co">// stereographic path ----------------------------------------------------------</span></span>
<span id="cb2-306"><a href="#cb2-306"></a>path3 stereoPath(quadruple A, quadruple B, real r, <span class="dt">int</span> n){</span>
<span id="cb2-307"><a href="#cb2-307"></a>    path3 out;</span>
<span id="cb2-308"><a href="#cb2-308"></a>    <span class="cf">for</span>(<span class="dt">int</span> i = <span class="dv">0</span>; i &lt;= n; ++i){</span>
<span id="cb2-309"><a href="#cb2-309"></a>        real t = i/n;</span>
<span id="cb2-310"><a href="#cb2-310"></a>        quadruple M;</span>
<span id="cb2-311"><a href="#cb2-311"></a>        real x = (<span class="dv">1</span>-t)*A.x + t*B.x;</span>
<span id="cb2-312"><a href="#cb2-312"></a>        real y = (<span class="dv">1</span>-t)*A.y + t*B.y;</span>
<span id="cb2-313"><a href="#cb2-313"></a>        real z = (<span class="dv">1</span>-t)*A.z + t*B.z;</span>
<span id="cb2-314"><a href="#cb2-314"></a>        real t = (<span class="dv">1</span>-t)*A.t + t*B.t;</span>
<span id="cb2-315"><a href="#cb2-315"></a>        real lg = sqrt(x*x + y*y + z*z + t*t) / r;</span>
<span id="cb2-316"><a href="#cb2-316"></a>        M.x = x / lg; M.y = y / lg; M.z = z / lg; M.t = t / lg;</span>
<span id="cb2-317"><a href="#cb2-317"></a>        out = out .. stereog(M, r);</span>
<span id="cb2-318"><a href="#cb2-318"></a>    }</span>
<span id="cb2-319"><a href="#cb2-319"></a>    <span class="cf">return</span> out;</span>
<span id="cb2-320"><a href="#cb2-320"></a>}</span>
<span id="cb2-321"><a href="#cb2-321"></a></span>
<span id="cb2-322"><a href="#cb2-322"></a><span class="co">// section transformation ------------------------------------------------------</span></span>
<span id="cb2-323"><a href="#cb2-323"></a>transform T(path3 p3, real t, <span class="dt">int</span> n){</span>
<span id="cb2-324"><a href="#cb2-324"></a>    triple M = relpoint(p3, t/(n/<span class="dv">4</span>));</span>
<span id="cb2-325"><a href="#cb2-325"></a>    <span class="cf">return</span> scale(length(M)/<span class="dv">15</span>); </span>
<span id="cb2-326"><a href="#cb2-326"></a>}</span>
<span id="cb2-327"><a href="#cb2-327"></a></span>
<span id="cb2-328"><a href="#cb2-328"></a><span class="co">// stereographic subdivision (to fill the tetrahedra) --------------------------</span></span>
<span id="cb2-329"><a href="#cb2-329"></a>quadruple midpoint4(quadruple A, quadruple B, real r){</span>
<span id="cb2-330"><a href="#cb2-330"></a>    quadruple M;</span>
<span id="cb2-331"><a href="#cb2-331"></a>    real x = (A.x + B.x)/<span class="dv">2</span>;</span>
<span id="cb2-332"><a href="#cb2-332"></a>    real y = (A.y + B.y)/<span class="dv">2</span>;</span>
<span id="cb2-333"><a href="#cb2-333"></a>    real z = (A.z + B.z)/<span class="dv">2</span>;</span>
<span id="cb2-334"><a href="#cb2-334"></a>    real t = (A.t + B.t)/<span class="dv">2</span>;</span>
<span id="cb2-335"><a href="#cb2-335"></a>    real lg = sqrt(x*x + y*y + z*z + t*t) / r;</span>
<span id="cb2-336"><a href="#cb2-336"></a>    M.x = x / lg; M.y = y / lg; M.z = z / lg; M.t = t / lg;</span>
<span id="cb2-337"><a href="#cb2-337"></a>    <span class="cf">return</span>(M);</span>
<span id="cb2-338"><a href="#cb2-338"></a>} </span>
<span id="cb2-339"><a href="#cb2-339"></a></span>
<span id="cb2-340"><a href="#cb2-340"></a>quadruple[][] subdiv0(quadruple A, quadruple B, quadruple C, real r){</span>
<span id="cb2-341"><a href="#cb2-341"></a>    quadruple m01 = midpoint4(A, B, r);</span>
<span id="cb2-342"><a href="#cb2-342"></a>    quadruple m02 = midpoint4(A, C, r);</span>
<span id="cb2-343"><a href="#cb2-343"></a>    quadruple m12 = midpoint4(B, C, r);</span>
<span id="cb2-344"><a href="#cb2-344"></a>    <span class="cf">return</span> <span class="kw">new</span> quadruple[][] {</span>
<span id="cb2-345"><a href="#cb2-345"></a>        {A, m01, m02}, </span>
<span id="cb2-346"><a href="#cb2-346"></a>        {B, m12, m01}, </span>
<span id="cb2-347"><a href="#cb2-347"></a>        {C, m02, m12}, </span>
<span id="cb2-348"><a href="#cb2-348"></a>        {m01, m12, m02}</span>
<span id="cb2-349"><a href="#cb2-349"></a>    };</span>
<span id="cb2-350"><a href="#cb2-350"></a>}</span>
<span id="cb2-351"><a href="#cb2-351"></a></span>
<span id="cb2-352"><a href="#cb2-352"></a>quadruple[][] subdiv(<span class="dt">int</span> n, quadruple A, quadruple B, quadruple C, real r){</span>
<span id="cb2-353"><a href="#cb2-353"></a>  <span class="cf">if</span>(n == <span class="dv">1</span>){</span>
<span id="cb2-354"><a href="#cb2-354"></a>    <span class="cf">return</span> subdiv0(A, B, C, r);</span>
<span id="cb2-355"><a href="#cb2-355"></a>  }</span>
<span id="cb2-356"><a href="#cb2-356"></a>  quadruple[][] triangles = subdiv(n-<span class="dv">1</span>, A, B, C, r);</span>
<span id="cb2-357"><a href="#cb2-357"></a>  quadruple[][] out = <span class="kw">new</span> quadruple[<span class="dv">0</span>][<span class="dv">3</span>];</span>
<span id="cb2-358"><a href="#cb2-358"></a>  <span class="cf">for</span>(<span class="dt">int</span> i = <span class="dv">0</span>; i &lt; <span class="dv">4</span>^(n-<span class="dv">1</span>); ++i){</span>
<span id="cb2-359"><a href="#cb2-359"></a>    quadruple[] trgl = triangles[i];</span>
<span id="cb2-360"><a href="#cb2-360"></a>    out.append(subdiv0(trgl[<span class="dv">0</span>], trgl[<span class="dv">1</span>], trgl[<span class="dv">2</span>], r));</span>
<span id="cb2-361"><a href="#cb2-361"></a>  }</span>
<span id="cb2-362"><a href="#cb2-362"></a>  <span class="cf">return</span> out;</span>
<span id="cb2-363"><a href="#cb2-363"></a>}</span>
<span id="cb2-364"><a href="#cb2-364"></a></span>
<span id="cb2-365"><a href="#cb2-365"></a><span class="co">// mesh maker ------------------------------------------------------------------</span></span>
<span id="cb2-366"><a href="#cb2-366"></a><span class="kw">struct</span> Mesh {</span>
<span id="cb2-367"><a href="#cb2-367"></a>    triple[] vertices;</span>
<span id="cb2-368"><a href="#cb2-368"></a>    <span class="dt">int</span>[][] indices;</span>
<span id="cb2-369"><a href="#cb2-369"></a>}</span>
<span id="cb2-370"><a href="#cb2-370"></a>Mesh stereoTriangle(<span class="dt">int</span> n, quadruple A, quadruple B, quadruple C, real r){</span>
<span id="cb2-371"><a href="#cb2-371"></a>    quadruple[][] triangles = subdiv(n, A, B, C, r);</span>
<span id="cb2-372"><a href="#cb2-372"></a>    triple[] vertices;</span>
<span id="cb2-373"><a href="#cb2-373"></a>    <span class="dt">int</span>[][] indices;</span>
<span id="cb2-374"><a href="#cb2-374"></a>    <span class="dt">int</span> faceIndex = <span class="dv">0</span>;</span>
<span id="cb2-375"><a href="#cb2-375"></a>    <span class="cf">for</span>(<span class="dt">int</span> i = <span class="dv">0</span>; i &lt; triangles.length; ++i){</span>
<span id="cb2-376"><a href="#cb2-376"></a>        quadruple[] triangle = triangles[i];</span>
<span id="cb2-377"><a href="#cb2-377"></a>        vertices.push(stereog(triangle[<span class="dv">0</span>], r));</span>
<span id="cb2-378"><a href="#cb2-378"></a>        vertices.push(stereog(triangle[<span class="dv">1</span>], r));</span>
<span id="cb2-379"><a href="#cb2-379"></a>        vertices.push(stereog(triangle[<span class="dv">2</span>], r));</span>
<span id="cb2-380"><a href="#cb2-380"></a>        <span class="dt">int</span>[] x = {faceIndex, faceIndex+<span class="dv">1</span>, faceIndex+<span class="dv">2</span>};</span>
<span id="cb2-381"><a href="#cb2-381"></a>        indices.push(x);</span>
<span id="cb2-382"><a href="#cb2-382"></a>        faceIndex += <span class="dv">3</span>;</span>
<span id="cb2-383"><a href="#cb2-383"></a>    }</span>
<span id="cb2-384"><a href="#cb2-384"></a>    Mesh out;</span>
<span id="cb2-385"><a href="#cb2-385"></a>    out.vertices = vertices;</span>
<span id="cb2-386"><a href="#cb2-386"></a>    out.indices = indices;</span>
<span id="cb2-387"><a href="#cb2-387"></a>    <span class="cf">return</span> out;</span>
<span id="cb2-388"><a href="#cb2-388"></a>}</span>
<span id="cb2-389"><a href="#cb2-389"></a></span>
<span id="cb2-390"><a href="#cb2-390"></a></span>
<span id="cb2-391"><a href="#cb2-391"></a><span class="co">// &quot;bounding box&quot; (to clip the animation) --------------------------------------</span></span>
<span id="cb2-392"><a href="#cb2-392"></a>path3 boundingbox = scale(<span class="fl">0.5</span>,<span class="dv">1</span>,<span class="dv">1</span>)*circle(c=O, r=<span class="dv">4</span>, normal=Z);</span>
<span id="cb2-393"><a href="#cb2-393"></a></span>
<span id="cb2-394"><a href="#cb2-394"></a><span class="co">// plot ------------------------------------------------------------------------</span></span>
<span id="cb2-395"><a href="#cb2-395"></a><span class="dt">int</span> n = <span class="dv">75</span>;</span>
<span id="cb2-396"><a href="#cb2-396"></a><span class="dt">int</span> depth = <span class="dv">6</span>;</span>
<span id="cb2-397"><a href="#cb2-397"></a>real alpha = <span class="dv">0</span>, beta = <span class="dv">0</span>;</span>
<span id="cb2-398"><a href="#cb2-398"></a></span>
<span id="cb2-399"><a href="#cb2-399"></a><span class="cf">for</span>(<span class="dt">int</span> f = <span class="dv">0</span>; f &lt; <span class="dv">180</span>; ++f){</span>
<span id="cb2-400"><a href="#cb2-400"></a>    <span class="co">// rotation angle</span></span>
<span id="cb2-401"><a href="#cb2-401"></a>    real xi = <span class="dv">2</span>*f*pi/<span class="dv">180</span>;</span>
<span id="cb2-402"><a href="#cb2-402"></a>    <span class="co">// rotated vertices</span></span>
<span id="cb2-403"><a href="#cb2-403"></a>    quadruple[] vs = <span class="kw">new</span> quadruple[vertices.length];</span>
<span id="cb2-404"><a href="#cb2-404"></a>    <span class="cf">for</span>(<span class="dt">int</span> i = <span class="dv">0</span>; i &lt; vertices.length; ++i){</span>
<span id="cb2-405"><a href="#cb2-405"></a>        vs[i] = rotate4d(alpha, beta, xi, vertices[i]);</span>
<span id="cb2-406"><a href="#cb2-406"></a>    }</span>
<span id="cb2-407"><a href="#cb2-407"></a>    <span class="co">// new picture</span></span>
<span id="cb2-408"><a href="#cb2-408"></a>    picture pic;</span>
<span id="cb2-409"><a href="#cb2-409"></a>    <span class="co">// draw boundingbox</span></span>
<span id="cb2-410"><a href="#cb2-410"></a>    draw(pic, boundingbox, rgb(<span class="st">&quot;363940ff&quot;</span>)+opacity(<span class="dv">0</span>));</span>
<span id="cb2-411"><a href="#cb2-411"></a>    <span class="co">// draw edges</span></span>
<span id="cb2-412"><a href="#cb2-412"></a>    <span class="cf">for</span>(<span class="dt">int</span> k = <span class="dv">0</span>; k &lt; edges.length; ++k){</span>
<span id="cb2-413"><a href="#cb2-413"></a>        quadruple A = vs[edges[k][<span class="dv">0</span>]];</span>
<span id="cb2-414"><a href="#cb2-414"></a>        quadruple B = vs[edges[k][<span class="dv">1</span>]];</span>
<span id="cb2-415"><a href="#cb2-415"></a>        path3 p3 = stereoPath(A, B, r, n);</span>
<span id="cb2-416"><a href="#cb2-416"></a>        transform S(real t){</span>
<span id="cb2-417"><a href="#cb2-417"></a>            <span class="cf">return</span> T(p3, t, n);</span>
<span id="cb2-418"><a href="#cb2-418"></a>        }</span>
<span id="cb2-419"><a href="#cb2-419"></a>        draw(pic, tube(p3, unitcircle, S), rgb(<span class="dv">139</span>, <span class="dv">0</span>, <span class="dv">139</span>), </span>
<span id="cb2-420"><a href="#cb2-420"></a>                render(compression=Low, merge=<span class="kw">true</span>));</span>
<span id="cb2-421"><a href="#cb2-421"></a>    }</span>
<span id="cb2-422"><a href="#cb2-422"></a>    <span class="co">// draw vertices</span></span>
<span id="cb2-423"><a href="#cb2-423"></a>    <span class="cf">for</span>(<span class="dt">int</span> i = <span class="dv">0</span>; i &lt; vertices.length; ++i){</span>
<span id="cb2-424"><a href="#cb2-424"></a>        triple Asg = stereog(vs[i], r);</span>
<span id="cb2-425"><a href="#cb2-425"></a>        draw(pic, shift(Asg)*scale3(length(Asg)/<span class="dv">10</span>)*unitsphere, purple);</span>
<span id="cb2-426"><a href="#cb2-426"></a>    }</span>
<span id="cb2-427"><a href="#cb2-427"></a>    <span class="co">// draw tetrahedra</span></span>
<span id="cb2-428"><a href="#cb2-428"></a>    <span class="cf">for</span>(<span class="dt">int</span> i = <span class="dv">0</span>; i &lt; tetrahedra.length; ++i){</span>
<span id="cb2-429"><a href="#cb2-429"></a>        <span class="dt">int</span>[] t = tetrahedra[i];</span>
<span id="cb2-430"><a href="#cb2-430"></a>        Mesh mesh = stereoTriangle(depth, vs[t[<span class="dv">0</span>]], vs[t[<span class="dv">1</span>]], vs[t[<span class="dv">2</span>]], r);</span>
<span id="cb2-431"><a href="#cb2-431"></a>        draw(pic, mesh.vertices, mesh.indices, m = red);</span>
<span id="cb2-432"><a href="#cb2-432"></a>        Mesh mesh = stereoTriangle(depth, vs[t[<span class="dv">0</span>]], vs[t[<span class="dv">1</span>]], vs[t[<span class="dv">3</span>]], r);</span>
<span id="cb2-433"><a href="#cb2-433"></a>        draw(pic, mesh.vertices, mesh.indices, m = red);</span>
<span id="cb2-434"><a href="#cb2-434"></a>        Mesh mesh = stereoTriangle(depth, vs[t[<span class="dv">0</span>]], vs[t[<span class="dv">2</span>]], vs[t[<span class="dv">3</span>]], r);</span>
<span id="cb2-435"><a href="#cb2-435"></a>        draw(pic, mesh.vertices, mesh.indices, m = red);</span>
<span id="cb2-436"><a href="#cb2-436"></a>        Mesh mesh = stereoTriangle(depth, vs[t[<span class="dv">1</span>]], vs[t[<span class="dv">2</span>]], vs[t[<span class="dv">3</span>]], r);</span>
<span id="cb2-437"><a href="#cb2-437"></a>        draw(pic, mesh.vertices, mesh.indices, m = red);</span>
<span id="cb2-438"><a href="#cb2-438"></a>    }</span>
<span id="cb2-439"><a href="#cb2-439"></a>    <span class="co">// add picture and save</span></span>
<span id="cb2-440"><a href="#cb2-440"></a>    add(pic);</span>
<span id="cb2-441"><a href="#cb2-441"></a>    shipout(files[f], bbox(rgb(<span class="st">&quot;363940ff&quot;</span>), FillDraw(rgb(<span class="st">&quot;363940ff&quot;</span>))));</span>
<span id="cb2-442"><a href="#cb2-442"></a>    erase();</span>
<span id="cb2-443"><a href="#cb2-443"></a>}   </span></code></pre></div>
<p><img src="figures/truncatedTesseract_stereographic_asy.gif" /></p>
<h1 id="drawing-with-pov-ray">Drawing with POV-Ray</h1>
<div class="sourceCode" id="cb3"><pre class="sourceCode numberSource povray numberLines"><code class="sourceCode povray"><span id="cb3-1"><a href="#cb3-1"></a><span class="ot">#version</span> <span class="fl">3.7</span>;</span>
<span id="cb3-2"><a href="#cb3-2"></a><span class="kw">global_settings</span> { <span class="kw">assumed_gamma</span> <span class="fl">1</span> }</span>
<span id="cb3-3"><a href="#cb3-3"></a><span class="ot">#include</span> <span class="st">&quot;colors.inc&quot;</span></span>
<span id="cb3-4"><a href="#cb3-4"></a><span class="ot">#include</span> <span class="st">&quot;textures.inc&quot;</span></span>
<span id="cb3-5"><a href="#cb3-5"></a></span>
<span id="cb3-6"><a href="#cb3-6"></a><span class="co">/* camera */</span></span>
<span id="cb3-7"><a href="#cb3-7"></a><span class="kw">camera</span> {</span>
<span id="cb3-8"><a href="#cb3-8"></a>    <span class="kw">location</span> &lt;-<span class="fl">11</span>, <span class="fl">7</span>,-<span class="fl">32</span>&gt;</span>
<span id="cb3-9"><a href="#cb3-9"></a>    <span class="kw">look_at</span> <span class="fl">0</span></span>
<span id="cb3-10"><a href="#cb3-10"></a>    <span class="kw">angle</span> <span class="fl">45</span></span>
<span id="cb3-11"><a href="#cb3-11"></a>}</span>
<span id="cb3-12"><a href="#cb3-12"></a></span>
<span id="cb3-13"><a href="#cb3-13"></a><span class="co">// sun -------------------------------------------------------------------------</span></span>
<span id="cb3-14"><a href="#cb3-14"></a><span class="kw">light_source</span> {&lt; <span class="fl">1000</span>,<span class="fl">3000</span>,-<span class="fl">6000</span>&gt; <span class="kw">color</span> <span class="kw">rgb</span>&lt;<span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span>&gt;*<span class="fl">0.9</span>}             <span class="co">// sun </span></span>
<span id="cb3-15"><a href="#cb3-15"></a><span class="kw">light_source</span> {&lt;-<span class="fl">11</span>, <span class="fl">7</span>,-<span class="fl">32</span>&gt;  <span class="kw">color</span> <span class="kw">rgb</span>&lt;<span class="fl">0.9</span>,<span class="fl">0.9</span>,<span class="fl">1</span>&gt;*<span class="fl">0.1</span> <span class="kw">shadowless</span>}   <span class="co">// flash</span></span>
<span id="cb3-16"><a href="#cb3-16"></a></span>
<span id="cb3-17"><a href="#cb3-17"></a><span class="co">// sky -------------------------------------------------------------------------</span></span>
<span id="cb3-18"><a href="#cb3-18"></a><span class="kw">plane</span>{&lt;<span class="fl">0</span>,<span class="fl">1</span>,<span class="fl">0</span>&gt;,<span class="fl">1</span> <span class="kw">hollow</span>  </span>
<span id="cb3-19"><a href="#cb3-19"></a>       <span class="kw">texture</span>{ <span class="kw">pigment</span>{ <span class="kw">bozo</span> <span class="kw">turbulence</span> <span class="fl">1.3</span></span>
<span id="cb3-20"><a href="#cb3-20"></a>                         <span class="kw">color_map</span> { [<span class="fl">0.00</span> <span class="kw">rgb</span> &lt;<span class="fl">0.24</span>, <span class="fl">0.32</span>, <span class="fl">1.0</span>&gt;*<span class="fl">0.6</span>]</span>
<span id="cb3-21"><a href="#cb3-21"></a>                                     [<span class="fl">0.75</span> <span class="kw">rgb</span> &lt;<span class="fl">0.24</span>, <span class="fl">0.32</span>, <span class="fl">1.0</span>&gt;*<span class="fl">0.6</span>]</span>
<span id="cb3-22"><a href="#cb3-22"></a>                                     [<span class="fl">0.83</span> <span class="kw">rgb</span> &lt;<span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span>&gt;]</span>
<span id="cb3-23"><a href="#cb3-23"></a>                                     [<span class="fl">0.95</span> <span class="kw">rgb</span> &lt;<span class="fl">0.25</span>,<span class="fl">0.25</span>,<span class="fl">0.25</span>&gt;]</span>
<span id="cb3-24"><a href="#cb3-24"></a>                                     [<span class="fl">1.0</span> <span class="kw">rgb</span> &lt;<span class="fl">0.5</span>,<span class="fl">0.5</span>,<span class="fl">0.5</span>&gt;]}</span>
<span id="cb3-25"><a href="#cb3-25"></a>                        <span class="kw">scale</span>&lt;<span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span>&gt;*<span class="fl">2.5</span>  <span class="kw">translate</span>&lt; <span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">3</span>&gt;</span>
<span id="cb3-26"><a href="#cb3-26"></a>                       }</span>
<span id="cb3-27"><a href="#cb3-27"></a>                <span class="kw">finish</span> {<span class="kw">ambient</span> <span class="fl">1</span> <span class="kw">diffuse</span> <span class="fl">0</span>} }      </span>
<span id="cb3-28"><a href="#cb3-28"></a>       <span class="kw">scale</span> <span class="fl">10000</span>}</span>
<span id="cb3-29"><a href="#cb3-29"></a></span>
<span id="cb3-30"><a href="#cb3-30"></a><span class="co">// fog on the ground -----------------------------------------------------------</span></span>
<span id="cb3-31"><a href="#cb3-31"></a><span class="kw">fog</span> { <span class="kw">fog_type</span>   <span class="fl">2</span></span>
<span id="cb3-32"><a href="#cb3-32"></a>      <span class="kw">distance</span>   <span class="fl">50</span></span>
<span id="cb3-33"><a href="#cb3-33"></a>      <span class="kw">color</span>      Gray10  </span>
<span id="cb3-34"><a href="#cb3-34"></a>      <span class="kw">fog_offset</span> <span class="fl">0.1</span></span>
<span id="cb3-35"><a href="#cb3-35"></a>      <span class="kw">fog_alt</span>    <span class="fl">1.5</span></span>
<span id="cb3-36"><a href="#cb3-36"></a>      <span class="kw">turbulence</span> <span class="fl">1.8</span></span>
<span id="cb3-37"><a href="#cb3-37"></a>    }</span>
<span id="cb3-38"><a href="#cb3-38"></a></span>
<span id="cb3-39"><a href="#cb3-39"></a><span class="co">// ground ----------------------------------------------------------------------</span></span>
<span id="cb3-40"><a href="#cb3-40"></a><span class="kw">plane</span> { &lt;<span class="fl">0</span>,<span class="fl">1</span>,<span class="fl">0</span>&gt;, <span class="fl">0</span> </span>
<span id="cb3-41"><a href="#cb3-41"></a>    <span class="kw">texture</span> {</span>
<span id="cb3-42"><a href="#cb3-42"></a>        <span class="kw">pigment</span> { <span class="kw">color</span> <span class="kw">rgb</span> &lt;<span class="fl">0.95</span>,<span class="fl">0.9</span>,<span class="fl">0.73</span>&gt;*<span class="fl">0.35</span> }</span>
<span id="cb3-43"><a href="#cb3-43"></a>        <span class="kw">normal</span> { <span class="kw">bumps</span> <span class="fl">2</span> <span class="kw">scale</span> &lt;<span class="fl">0.25</span>,<span class="fl">0.25</span>,<span class="fl">0.25</span>&gt;*<span class="fl">0.5</span> <span class="kw">turbulence</span> <span class="fl">0.5</span> } </span>
<span id="cb3-44"><a href="#cb3-44"></a>        <span class="kw">finish</span> { <span class="kw">phong</span> <span class="fl">0.1</span> }</span>
<span id="cb3-45"><a href="#cb3-45"></a>    } </span>
<span id="cb3-46"><a href="#cb3-46"></a>} </span>
<span id="cb3-47"><a href="#cb3-47"></a></span>
<span id="cb3-48"><a href="#cb3-48"></a></span>
<span id="cb3-49"><a href="#cb3-49"></a><span class="co">/* vertices */</span></span>
<span id="cb3-50"><a href="#cb3-50"></a><span class="kw">#declare sqr2p1 </span>= <span class="kw">sqrt</span>(<span class="fl">2</span>) + <span class="fl">1</span>;</span>
<span id="cb3-51"><a href="#cb3-51"></a><span class="kw">#declare v0 </span>= &lt; <span class="fl">-1.0</span> , -sqr2p1 , -sqr2p1 , -sqr2p1 &gt;;</span>
<span id="cb3-52"><a href="#cb3-52"></a><span class="kw">#declare v1 </span>= &lt; <span class="fl">-1.0</span> , -sqr2p1 , -sqr2p1 , sqr2p1 &gt;;</span>
<span id="cb3-53"><a href="#cb3-53"></a><span class="kw">#declare v2 </span>= &lt; <span class="fl">-1.0</span> , -sqr2p1 , sqr2p1 , -sqr2p1 &gt;;</span>
<span id="cb3-54"><a href="#cb3-54"></a><span class="kw">#declare v3 </span>= &lt; <span class="fl">-1.0</span> , -sqr2p1 , sqr2p1 , sqr2p1 &gt;;</span>
<span id="cb3-55"><a href="#cb3-55"></a><span class="kw">#declare v4 </span>= &lt; <span class="fl">-1.0</span> , sqr2p1 , -sqr2p1 , -sqr2p1 &gt;;</span>
<span id="cb3-56"><a href="#cb3-56"></a><span class="kw">#declare v5 </span>= &lt; <span class="fl">-1.0</span> , sqr2p1 , -sqr2p1 , sqr2p1 &gt;;</span>
<span id="cb3-57"><a href="#cb3-57"></a><span class="kw">#declare v6 </span>= &lt; <span class="fl">-1.0</span> , sqr2p1 , sqr2p1 , -sqr2p1 &gt;;</span>
<span id="cb3-58"><a href="#cb3-58"></a><span class="kw">#declare v7 </span>= &lt; <span class="fl">-1.0</span> , sqr2p1 , sqr2p1 , sqr2p1 &gt;;</span>
<span id="cb3-59"><a href="#cb3-59"></a><span class="kw">#declare v8 </span>= &lt; <span class="fl">1.0</span> , -sqr2p1 , -sqr2p1 , -sqr2p1 &gt;;</span>
<span id="cb3-60"><a href="#cb3-60"></a><span class="kw">#declare v9 </span>= &lt; <span class="fl">1.0</span> , -sqr2p1 , -sqr2p1 , sqr2p1 &gt;;</span>
<span id="cb3-61"><a href="#cb3-61"></a><span class="kw">#declare v10 </span>= &lt; <span class="fl">1.0</span> , -sqr2p1 , sqr2p1 , -sqr2p1 &gt;;</span>
<span id="cb3-62"><a href="#cb3-62"></a><span class="kw">#declare v11 </span>= &lt; <span class="fl">1.0</span> , -sqr2p1 , sqr2p1 , sqr2p1 &gt;;</span>
<span id="cb3-63"><a href="#cb3-63"></a><span class="kw">#declare v12 </span>= &lt; <span class="fl">1.0</span> , sqr2p1 , -sqr2p1 , -sqr2p1 &gt;;</span>
<span id="cb3-64"><a href="#cb3-64"></a><span class="kw">#declare v13 </span>= &lt; <span class="fl">1.0</span> , sqr2p1 , -sqr2p1 , sqr2p1 &gt;;</span>
<span id="cb3-65"><a href="#cb3-65"></a><span class="kw">#declare v14 </span>= &lt; <span class="fl">1.0</span> , sqr2p1 , sqr2p1 , -sqr2p1 &gt;;</span>
<span id="cb3-66"><a href="#cb3-66"></a><span class="kw">#declare v15 </span>= &lt; <span class="fl">1.0</span> , sqr2p1 , sqr2p1 , sqr2p1 &gt;;</span>
<span id="cb3-67"><a href="#cb3-67"></a><span class="kw">#declare v16 </span>= &lt; -sqr2p1 , <span class="fl">-1.0</span> , -sqr2p1 , -sqr2p1 &gt;;</span>
<span id="cb3-68"><a href="#cb3-68"></a><span class="kw">#declare v17 </span>= &lt; -sqr2p1 , <span class="fl">-1.0</span> , -sqr2p1 , sqr2p1 &gt;;</span>
<span id="cb3-69"><a href="#cb3-69"></a><span class="kw">#declare v18 </span>= &lt; -sqr2p1 , <span class="fl">-1.0</span> , sqr2p1 , -sqr2p1 &gt;;</span>
<span id="cb3-70"><a href="#cb3-70"></a><span class="kw">#declare v19 </span>= &lt; -sqr2p1 , <span class="fl">-1.0</span> , sqr2p1 , sqr2p1 &gt;;</span>
<span id="cb3-71"><a href="#cb3-71"></a><span class="kw">#declare v20 </span>= &lt; -sqr2p1 , <span class="fl">1.0</span> , -sqr2p1 , -sqr2p1 &gt;;</span>
<span id="cb3-72"><a href="#cb3-72"></a><span class="kw">#declare v21 </span>= &lt; -sqr2p1 , <span class="fl">1.0</span> , -sqr2p1 , sqr2p1 &gt;;</span>
<span id="cb3-73"><a href="#cb3-73"></a><span class="kw">#declare v22 </span>= &lt; -sqr2p1 , <span class="fl">1.0</span> , sqr2p1 , -sqr2p1 &gt;;</span>
<span id="cb3-74"><a href="#cb3-74"></a><span class="kw">#declare v23 </span>= &lt; -sqr2p1 , <span class="fl">1.0</span> , sqr2p1 , sqr2p1 &gt;;</span>
<span id="cb3-75"><a href="#cb3-75"></a><span class="kw">#declare v24 </span>= &lt; sqr2p1 , <span class="fl">-1.0</span> , -sqr2p1 , -sqr2p1 &gt;;</span>
<span id="cb3-76"><a href="#cb3-76"></a><span class="kw">#declare v25 </span>= &lt; sqr2p1 , <span class="fl">-1.0</span> , -sqr2p1 , sqr2p1 &gt;;</span>
<span id="cb3-77"><a href="#cb3-77"></a><span class="kw">#declare v26 </span>= &lt; sqr2p1 , <span class="fl">-1.0</span> , sqr2p1 , -sqr2p1 &gt;;</span>
<span id="cb3-78"><a href="#cb3-78"></a><span class="kw">#declare v27 </span>= &lt; sqr2p1 , <span class="fl">-1.0</span> , sqr2p1 , sqr2p1 &gt;;</span>
<span id="cb3-79"><a href="#cb3-79"></a><span class="kw">#declare v28 </span>= &lt; sqr2p1 , <span class="fl">1.0</span> , -sqr2p1 , -sqr2p1 &gt;;</span>
<span id="cb3-80"><a href="#cb3-80"></a><span class="kw">#declare v29 </span>= &lt; sqr2p1 , <span class="fl">1.0</span> , -sqr2p1 , sqr2p1 &gt;;</span>
<span id="cb3-81"><a href="#cb3-81"></a><span class="kw">#declare v30 </span>= &lt; sqr2p1 , <span class="fl">1.0</span> , sqr2p1 , -sqr2p1 &gt;;</span>
<span id="cb3-82"><a href="#cb3-82"></a><span class="kw">#declare v31 </span>= &lt; sqr2p1 , <span class="fl">1.0</span> , sqr2p1 , sqr2p1 &gt;;</span>
<span id="cb3-83"><a href="#cb3-83"></a><span class="kw">#declare v32 </span>= &lt; -sqr2p1 , -sqr2p1 , <span class="fl">-1.0</span> , -sqr2p1 &gt;;</span>
<span id="cb3-84"><a href="#cb3-84"></a><span class="kw">#declare v33 </span>= &lt; -sqr2p1 , -sqr2p1 , <span class="fl">-1.0</span> , sqr2p1 &gt;;</span>
<span id="cb3-85"><a href="#cb3-85"></a><span class="kw">#declare v34 </span>= &lt; -sqr2p1 , -sqr2p1 , <span class="fl">1.0</span> , -sqr2p1 &gt;;</span>
<span id="cb3-86"><a href="#cb3-86"></a><span class="kw">#declare v35 </span>= &lt; -sqr2p1 , -sqr2p1 , <span class="fl">1.0</span> , sqr2p1 &gt;;</span>
<span id="cb3-87"><a href="#cb3-87"></a><span class="kw">#declare v36 </span>= &lt; -sqr2p1 , sqr2p1 , <span class="fl">-1.0</span> , -sqr2p1 &gt;;</span>
<span id="cb3-88"><a href="#cb3-88"></a><span class="kw">#declare v37 </span>= &lt; -sqr2p1 , sqr2p1 , <span class="fl">-1.0</span> , sqr2p1 &gt;;</span>
<span id="cb3-89"><a href="#cb3-89"></a><span class="kw">#declare v38 </span>= &lt; -sqr2p1 , sqr2p1 , <span class="fl">1.0</span> , -sqr2p1 &gt;;</span>
<span id="cb3-90"><a href="#cb3-90"></a><span class="kw">#declare v39 </span>= &lt; -sqr2p1 , sqr2p1 , <span class="fl">1.0</span> , sqr2p1 &gt;;</span>
<span id="cb3-91"><a href="#cb3-91"></a><span class="kw">#declare v40 </span>= &lt; sqr2p1 , -sqr2p1 , <span class="fl">-1.0</span> , -sqr2p1 &gt;;</span>
<span id="cb3-92"><a href="#cb3-92"></a><span class="kw">#declare v41 </span>= &lt; sqr2p1 , -sqr2p1 , <span class="fl">-1.0</span> , sqr2p1 &gt;;</span>
<span id="cb3-93"><a href="#cb3-93"></a><span class="kw">#declare v42 </span>= &lt; sqr2p1 , -sqr2p1 , <span class="fl">1.0</span> , -sqr2p1 &gt;;</span>
<span id="cb3-94"><a href="#cb3-94"></a><span class="kw">#declare v43 </span>= &lt; sqr2p1 , -sqr2p1 , <span class="fl">1.0</span> , sqr2p1 &gt;;</span>
<span id="cb3-95"><a href="#cb3-95"></a><span class="kw">#declare v44 </span>= &lt; sqr2p1 , sqr2p1 , <span class="fl">-1.0</span> , -sqr2p1 &gt;;</span>
<span id="cb3-96"><a href="#cb3-96"></a><span class="kw">#declare v45 </span>= &lt; sqr2p1 , sqr2p1 , <span class="fl">-1.0</span> , sqr2p1 &gt;;</span>
<span id="cb3-97"><a href="#cb3-97"></a><span class="kw">#declare v46 </span>= &lt; sqr2p1 , sqr2p1 , <span class="fl">1.0</span> , -sqr2p1 &gt;;</span>
<span id="cb3-98"><a href="#cb3-98"></a><span class="kw">#declare v47 </span>= &lt; sqr2p1 , sqr2p1 , <span class="fl">1.0</span> , sqr2p1 &gt;;</span>
<span id="cb3-99"><a href="#cb3-99"></a><span class="kw">#declare v48 </span>= &lt; -sqr2p1 , -sqr2p1 , -sqr2p1 , <span class="fl">-1.0</span> &gt;;</span>
<span id="cb3-100"><a href="#cb3-100"></a><span class="kw">#declare v49 </span>= &lt; -sqr2p1 , -sqr2p1 , -sqr2p1 , <span class="fl">1.0</span> &gt;;</span>
<span id="cb3-101"><a href="#cb3-101"></a><span class="kw">#declare v50 </span>= &lt; -sqr2p1 , -sqr2p1 , sqr2p1 , <span class="fl">-1.0</span> &gt;;</span>
<span id="cb3-102"><a href="#cb3-102"></a><span class="kw">#declare v51 </span>= &lt; -sqr2p1 , -sqr2p1 , sqr2p1 , <span class="fl">1.0</span> &gt;;</span>
<span id="cb3-103"><a href="#cb3-103"></a><span class="kw">#declare v52 </span>= &lt; -sqr2p1 , sqr2p1 , -sqr2p1 , <span class="fl">-1.0</span> &gt;;</span>
<span id="cb3-104"><a href="#cb3-104"></a><span class="kw">#declare v53 </span>= &lt; -sqr2p1 , sqr2p1 , -sqr2p1 , <span class="fl">1.0</span> &gt;;</span>
<span id="cb3-105"><a href="#cb3-105"></a><span class="kw">#declare v54 </span>= &lt; -sqr2p1 , sqr2p1 , sqr2p1 , <span class="fl">-1.0</span> &gt;;</span>
<span id="cb3-106"><a href="#cb3-106"></a><span class="kw">#declare v55 </span>= &lt; -sqr2p1 , sqr2p1 , sqr2p1 , <span class="fl">1.0</span> &gt;;</span>
<span id="cb3-107"><a href="#cb3-107"></a><span class="kw">#declare v56 </span>= &lt; sqr2p1 , -sqr2p1 , -sqr2p1 , <span class="fl">-1.0</span> &gt;;</span>
<span id="cb3-108"><a href="#cb3-108"></a><span class="kw">#declare v57 </span>= &lt; sqr2p1 , -sqr2p1 , -sqr2p1 , <span class="fl">1.0</span> &gt;;</span>
<span id="cb3-109"><a href="#cb3-109"></a><span class="kw">#declare v58 </span>= &lt; sqr2p1 , -sqr2p1 , sqr2p1 , <span class="fl">-1.0</span> &gt;;</span>
<span id="cb3-110"><a href="#cb3-110"></a><span class="kw">#declare v59 </span>= &lt; sqr2p1 , -sqr2p1 , sqr2p1 , <span class="fl">1.0</span> &gt;;</span>
<span id="cb3-111"><a href="#cb3-111"></a><span class="kw">#declare v60 </span>= &lt; sqr2p1 , sqr2p1 , -sqr2p1 , <span class="fl">-1.0</span> &gt;;</span>
<span id="cb3-112"><a href="#cb3-112"></a><span class="kw">#declare v61 </span>= &lt; sqr2p1 , sqr2p1 , -sqr2p1 , <span class="fl">1.0</span> &gt;;</span>
<span id="cb3-113"><a href="#cb3-113"></a><span class="kw">#declare v62 </span>= &lt; sqr2p1 , sqr2p1 , sqr2p1 , <span class="fl">-1.0</span> &gt;;</span>
<span id="cb3-114"><a href="#cb3-114"></a><span class="kw">#declare v63 </span>= &lt; sqr2p1 , sqr2p1 , sqr2p1 , <span class="fl">1.0</span> &gt;;</span>
<span id="cb3-115"><a href="#cb3-115"></a><span class="kw">#declare vertices </span>= <span class="kw">array</span>[<span class="fl">64</span>] </span>
<span id="cb3-116"><a href="#cb3-116"></a>    {v0,v1,v2,v3,v4,v5,v6,v7,v8,v9,v10,v11,v12,v13,v14,v15,</span>
<span id="cb3-117"><a href="#cb3-117"></a>    v16,v17,v18,v19,v20,v21,v22,v23,v24,v25,v26,v27,v28,v29,v30,v31,</span>
<span id="cb3-118"><a href="#cb3-118"></a>    v32,v33,v34,v35,v36,v37,v38,v39,v40,v41,v42,v43,v44,v45,v46,v47,</span>
<span id="cb3-119"><a href="#cb3-119"></a>    v48,v49,v50,v51,v52,v53,v54,v55,v56,v57,v58,v59,v60,v61,v62,v63};</span>
<span id="cb3-120"><a href="#cb3-120"></a></span>
<span id="cb3-121"><a href="#cb3-121"></a><span class="co">/* edges */</span></span>
<span id="cb3-122"><a href="#cb3-122"></a><span class="kw">#declare edges </span>= <span class="kw">array</span>[<span class="fl">128</span>][<span class="fl">2</span>] </span>
<span id="cb3-123"><a href="#cb3-123"></a>{ { <span class="fl">0</span> , <span class="fl">8</span> }</span>
<span id="cb3-124"><a href="#cb3-124"></a>, { <span class="fl">0</span> , <span class="fl">16</span> }</span>
<span id="cb3-125"><a href="#cb3-125"></a>, { <span class="fl">0</span> , <span class="fl">32</span> }</span>
<span id="cb3-126"><a href="#cb3-126"></a>, { <span class="fl">0</span> , <span class="fl">48</span> }</span>
<span id="cb3-127"><a href="#cb3-127"></a>, { <span class="fl">1</span> , <span class="fl">9</span> }</span>
<span id="cb3-128"><a href="#cb3-128"></a>, { <span class="fl">1</span> , <span class="fl">17</span> }</span>
<span id="cb3-129"><a href="#cb3-129"></a>, { <span class="fl">1</span> , <span class="fl">33</span> }</span>
<span id="cb3-130"><a href="#cb3-130"></a>, { <span class="fl">1</span> , <span class="fl">49</span> }</span>
<span id="cb3-131"><a href="#cb3-131"></a>, { <span class="fl">2</span> , <span class="fl">10</span> }</span>
<span id="cb3-132"><a href="#cb3-132"></a>, { <span class="fl">2</span> , <span class="fl">18</span> }</span>
<span id="cb3-133"><a href="#cb3-133"></a>, { <span class="fl">2</span> , <span class="fl">34</span> }</span>
<span id="cb3-134"><a href="#cb3-134"></a>, { <span class="fl">2</span> , <span class="fl">50</span> }</span>
<span id="cb3-135"><a href="#cb3-135"></a>, { <span class="fl">3</span> , <span class="fl">11</span> }</span>
<span id="cb3-136"><a href="#cb3-136"></a>, { <span class="fl">3</span> , <span class="fl">19</span> }</span>
<span id="cb3-137"><a href="#cb3-137"></a>, { <span class="fl">3</span> , <span class="fl">35</span> }</span>
<span id="cb3-138"><a href="#cb3-138"></a>, { <span class="fl">3</span> , <span class="fl">51</span> }</span>
<span id="cb3-139"><a href="#cb3-139"></a>, { <span class="fl">4</span> , <span class="fl">12</span> }</span>
<span id="cb3-140"><a href="#cb3-140"></a>, { <span class="fl">4</span> , <span class="fl">20</span> }</span>
<span id="cb3-141"><a href="#cb3-141"></a>, { <span class="fl">4</span> , <span class="fl">36</span> }</span>
<span id="cb3-142"><a href="#cb3-142"></a>, { <span class="fl">4</span> , <span class="fl">52</span> }</span>
<span id="cb3-143"><a href="#cb3-143"></a>, { <span class="fl">5</span> , <span class="fl">13</span> }</span>
<span id="cb3-144"><a href="#cb3-144"></a>, { <span class="fl">5</span> , <span class="fl">21</span> }</span>
<span id="cb3-145"><a href="#cb3-145"></a>, { <span class="fl">5</span> , <span class="fl">37</span> }</span>
<span id="cb3-146"><a href="#cb3-146"></a>, { <span class="fl">5</span> , <span class="fl">53</span> }</span>
<span id="cb3-147"><a href="#cb3-147"></a>, { <span class="fl">6</span> , <span class="fl">14</span> }</span>
<span id="cb3-148"><a href="#cb3-148"></a>, { <span class="fl">6</span> , <span class="fl">22</span> }</span>
<span id="cb3-149"><a href="#cb3-149"></a>, { <span class="fl">6</span> , <span class="fl">38</span> }</span>
<span id="cb3-150"><a href="#cb3-150"></a>, { <span class="fl">6</span> , <span class="fl">54</span> }</span>
<span id="cb3-151"><a href="#cb3-151"></a>, { <span class="fl">7</span> , <span class="fl">15</span> }</span>
<span id="cb3-152"><a href="#cb3-152"></a>, { <span class="fl">7</span> , <span class="fl">23</span> }</span>
<span id="cb3-153"><a href="#cb3-153"></a>, { <span class="fl">7</span> , <span class="fl">39</span> }</span>
<span id="cb3-154"><a href="#cb3-154"></a>, { <span class="fl">7</span> , <span class="fl">55</span> }</span>
<span id="cb3-155"><a href="#cb3-155"></a>, { <span class="fl">8</span> , <span class="fl">24</span> }</span>
<span id="cb3-156"><a href="#cb3-156"></a>, { <span class="fl">8</span> , <span class="fl">40</span> }</span>
<span id="cb3-157"><a href="#cb3-157"></a>, { <span class="fl">8</span> , <span class="fl">56</span> }</span>
<span id="cb3-158"><a href="#cb3-158"></a>, { <span class="fl">9</span> , <span class="fl">25</span> }</span>
<span id="cb3-159"><a href="#cb3-159"></a>, { <span class="fl">9</span> , <span class="fl">41</span> }</span>
<span id="cb3-160"><a href="#cb3-160"></a>, { <span class="fl">9</span> , <span class="fl">57</span> }</span>
<span id="cb3-161"><a href="#cb3-161"></a>, { <span class="fl">10</span> , <span class="fl">26</span> }</span>
<span id="cb3-162"><a href="#cb3-162"></a>, { <span class="fl">10</span> , <span class="fl">42</span> }</span>
<span id="cb3-163"><a href="#cb3-163"></a>, { <span class="fl">10</span> , <span class="fl">58</span> }</span>
<span id="cb3-164"><a href="#cb3-164"></a>, { <span class="fl">11</span> , <span class="fl">27</span> }</span>
<span id="cb3-165"><a href="#cb3-165"></a>, { <span class="fl">11</span> , <span class="fl">43</span> }</span>
<span id="cb3-166"><a href="#cb3-166"></a>, { <span class="fl">11</span> , <span class="fl">59</span> }</span>
<span id="cb3-167"><a href="#cb3-167"></a>, { <span class="fl">12</span> , <span class="fl">28</span> }</span>
<span id="cb3-168"><a href="#cb3-168"></a>, { <span class="fl">12</span> , <span class="fl">44</span> }</span>
<span id="cb3-169"><a href="#cb3-169"></a>, { <span class="fl">12</span> , <span class="fl">60</span> }</span>
<span id="cb3-170"><a href="#cb3-170"></a>, { <span class="fl">13</span> , <span class="fl">29</span> }</span>
<span id="cb3-171"><a href="#cb3-171"></a>, { <span class="fl">13</span> , <span class="fl">45</span> }</span>
<span id="cb3-172"><a href="#cb3-172"></a>, { <span class="fl">13</span> , <span class="fl">61</span> }</span>
<span id="cb3-173"><a href="#cb3-173"></a>, { <span class="fl">14</span> , <span class="fl">30</span> }</span>
<span id="cb3-174"><a href="#cb3-174"></a>, { <span class="fl">14</span> , <span class="fl">46</span> }</span>
<span id="cb3-175"><a href="#cb3-175"></a>, { <span class="fl">14</span> , <span class="fl">62</span> }</span>
<span id="cb3-176"><a href="#cb3-176"></a>, { <span class="fl">15</span> , <span class="fl">31</span> }</span>
<span id="cb3-177"><a href="#cb3-177"></a>, { <span class="fl">15</span> , <span class="fl">47</span> }</span>
<span id="cb3-178"><a href="#cb3-178"></a>, { <span class="fl">15</span> , <span class="fl">63</span> }</span>
<span id="cb3-179"><a href="#cb3-179"></a>, { <span class="fl">16</span> , <span class="fl">20</span> }</span>
<span id="cb3-180"><a href="#cb3-180"></a>, { <span class="fl">16</span> , <span class="fl">32</span> }</span>
<span id="cb3-181"><a href="#cb3-181"></a>, { <span class="fl">16</span> , <span class="fl">48</span> }</span>
<span id="cb3-182"><a href="#cb3-182"></a>, { <span class="fl">17</span> , <span class="fl">21</span> }</span>
<span id="cb3-183"><a href="#cb3-183"></a>, { <span class="fl">17</span> , <span class="fl">33</span> }</span>
<span id="cb3-184"><a href="#cb3-184"></a>, { <span class="fl">17</span> , <span class="fl">49</span> }</span>
<span id="cb3-185"><a href="#cb3-185"></a>, { <span class="fl">18</span> , <span class="fl">22</span> }</span>
<span id="cb3-186"><a href="#cb3-186"></a>, { <span class="fl">18</span> , <span class="fl">34</span> }</span>
<span id="cb3-187"><a href="#cb3-187"></a>, { <span class="fl">18</span> , <span class="fl">50</span> }</span>
<span id="cb3-188"><a href="#cb3-188"></a>, { <span class="fl">19</span> , <span class="fl">23</span> }</span>
<span id="cb3-189"><a href="#cb3-189"></a>, { <span class="fl">19</span> , <span class="fl">35</span> }</span>
<span id="cb3-190"><a href="#cb3-190"></a>, { <span class="fl">19</span> , <span class="fl">51</span> }</span>
<span id="cb3-191"><a href="#cb3-191"></a>, { <span class="fl">20</span> , <span class="fl">36</span> }</span>
<span id="cb3-192"><a href="#cb3-192"></a>, { <span class="fl">20</span> , <span class="fl">52</span> }</span>
<span id="cb3-193"><a href="#cb3-193"></a>, { <span class="fl">21</span> , <span class="fl">37</span> }</span>
<span id="cb3-194"><a href="#cb3-194"></a>, { <span class="fl">21</span> , <span class="fl">53</span> }</span>
<span id="cb3-195"><a href="#cb3-195"></a>, { <span class="fl">22</span> , <span class="fl">38</span> }</span>
<span id="cb3-196"><a href="#cb3-196"></a>, { <span class="fl">22</span> , <span class="fl">54</span> }</span>
<span id="cb3-197"><a href="#cb3-197"></a>, { <span class="fl">23</span> , <span class="fl">39</span> }</span>
<span id="cb3-198"><a href="#cb3-198"></a>, { <span class="fl">23</span> , <span class="fl">55</span> }</span>
<span id="cb3-199"><a href="#cb3-199"></a>, { <span class="fl">24</span> , <span class="fl">28</span> }</span>
<span id="cb3-200"><a href="#cb3-200"></a>, { <span class="fl">24</span> , <span class="fl">40</span> }</span>
<span id="cb3-201"><a href="#cb3-201"></a>, { <span class="fl">24</span> , <span class="fl">56</span> }</span>
<span id="cb3-202"><a href="#cb3-202"></a>, { <span class="fl">25</span> , <span class="fl">29</span> }</span>
<span id="cb3-203"><a href="#cb3-203"></a>, { <span class="fl">25</span> , <span class="fl">41</span> }</span>
<span id="cb3-204"><a href="#cb3-204"></a>, { <span class="fl">25</span> , <span class="fl">57</span> }</span>
<span id="cb3-205"><a href="#cb3-205"></a>, { <span class="fl">26</span> , <span class="fl">30</span> }</span>
<span id="cb3-206"><a href="#cb3-206"></a>, { <span class="fl">26</span> , <span class="fl">42</span> }</span>
<span id="cb3-207"><a href="#cb3-207"></a>, { <span class="fl">26</span> , <span class="fl">58</span> }</span>
<span id="cb3-208"><a href="#cb3-208"></a>, { <span class="fl">27</span> , <span class="fl">31</span> }</span>
<span id="cb3-209"><a href="#cb3-209"></a>, { <span class="fl">27</span> , <span class="fl">43</span> }</span>
<span id="cb3-210"><a href="#cb3-210"></a>, { <span class="fl">27</span> , <span class="fl">59</span> }</span>
<span id="cb3-211"><a href="#cb3-211"></a>, { <span class="fl">28</span> , <span class="fl">44</span> }</span>
<span id="cb3-212"><a href="#cb3-212"></a>, { <span class="fl">28</span> , <span class="fl">60</span> }</span>
<span id="cb3-213"><a href="#cb3-213"></a>, { <span class="fl">29</span> , <span class="fl">45</span> }</span>
<span id="cb3-214"><a href="#cb3-214"></a>, { <span class="fl">29</span> , <span class="fl">61</span> }</span>
<span id="cb3-215"><a href="#cb3-215"></a>, { <span class="fl">30</span> , <span class="fl">46</span> }</span>
<span id="cb3-216"><a href="#cb3-216"></a>, { <span class="fl">30</span> , <span class="fl">62</span> }</span>
<span id="cb3-217"><a href="#cb3-217"></a>, { <span class="fl">31</span> , <span class="fl">47</span> }</span>
<span id="cb3-218"><a href="#cb3-218"></a>, { <span class="fl">31</span> , <span class="fl">63</span> }</span>
<span id="cb3-219"><a href="#cb3-219"></a>, { <span class="fl">32</span> , <span class="fl">34</span> }</span>
<span id="cb3-220"><a href="#cb3-220"></a>, { <span class="fl">32</span> , <span class="fl">48</span> }</span>
<span id="cb3-221"><a href="#cb3-221"></a>, { <span class="fl">33</span> , <span class="fl">35</span> }</span>
<span id="cb3-222"><a href="#cb3-222"></a>, { <span class="fl">33</span> , <span class="fl">49</span> }</span>
<span id="cb3-223"><a href="#cb3-223"></a>, { <span class="fl">34</span> , <span class="fl">50</span> }</span>
<span id="cb3-224"><a href="#cb3-224"></a>, { <span class="fl">35</span> , <span class="fl">51</span> }</span>
<span id="cb3-225"><a href="#cb3-225"></a>, { <span class="fl">36</span> , <span class="fl">38</span> }</span>
<span id="cb3-226"><a href="#cb3-226"></a>, { <span class="fl">36</span> , <span class="fl">52</span> }</span>
<span id="cb3-227"><a href="#cb3-227"></a>, { <span class="fl">37</span> , <span class="fl">39</span> }</span>
<span id="cb3-228"><a href="#cb3-228"></a>, { <span class="fl">37</span> , <span class="fl">53</span> }</span>
<span id="cb3-229"><a href="#cb3-229"></a>, { <span class="fl">38</span> , <span class="fl">54</span> }</span>
<span id="cb3-230"><a href="#cb3-230"></a>, { <span class="fl">39</span> , <span class="fl">55</span> }</span>
<span id="cb3-231"><a href="#cb3-231"></a>, { <span class="fl">40</span> , <span class="fl">42</span> }</span>
<span id="cb3-232"><a href="#cb3-232"></a>, { <span class="fl">40</span> , <span class="fl">56</span> }</span>
<span id="cb3-233"><a href="#cb3-233"></a>, { <span class="fl">41</span> , <span class="fl">43</span> }</span>
<span id="cb3-234"><a href="#cb3-234"></a>, { <span class="fl">41</span> , <span class="fl">57</span> }</span>
<span id="cb3-235"><a href="#cb3-235"></a>, { <span class="fl">42</span> , <span class="fl">58</span> }</span>
<span id="cb3-236"><a href="#cb3-236"></a>, { <span class="fl">43</span> , <span class="fl">59</span> }</span>
<span id="cb3-237"><a href="#cb3-237"></a>, { <span class="fl">44</span> , <span class="fl">46</span> }</span>
<span id="cb3-238"><a href="#cb3-238"></a>, { <span class="fl">44</span> , <span class="fl">60</span> }</span>
<span id="cb3-239"><a href="#cb3-239"></a>, { <span class="fl">45</span> , <span class="fl">47</span> }</span>
<span id="cb3-240"><a href="#cb3-240"></a>, { <span class="fl">45</span> , <span class="fl">61</span> }</span>
<span id="cb3-241"><a href="#cb3-241"></a>, { <span class="fl">46</span> , <span class="fl">62</span> }</span>
<span id="cb3-242"><a href="#cb3-242"></a>, { <span class="fl">47</span> , <span class="fl">63</span> }</span>
<span id="cb3-243"><a href="#cb3-243"></a>, { <span class="fl">48</span> , <span class="fl">49</span> }</span>
<span id="cb3-244"><a href="#cb3-244"></a>, { <span class="fl">50</span> , <span class="fl">51</span> }</span>
<span id="cb3-245"><a href="#cb3-245"></a>, { <span class="fl">52</span> , <span class="fl">53</span> }</span>
<span id="cb3-246"><a href="#cb3-246"></a>, { <span class="fl">54</span> , <span class="fl">55</span> }</span>
<span id="cb3-247"><a href="#cb3-247"></a>, { <span class="fl">56</span> , <span class="fl">57</span> }</span>
<span id="cb3-248"><a href="#cb3-248"></a>, { <span class="fl">58</span> , <span class="fl">59</span> }</span>
<span id="cb3-249"><a href="#cb3-249"></a>, { <span class="fl">60</span> , <span class="fl">61</span> }</span>
<span id="cb3-250"><a href="#cb3-250"></a>, { <span class="fl">62</span> , <span class="fl">63</span> } };</span>
<span id="cb3-251"><a href="#cb3-251"></a></span>
<span id="cb3-252"><a href="#cb3-252"></a><span class="co">/* tetrahedra */</span></span>
<span id="cb3-253"><a href="#cb3-253"></a><span class="kw">#declare tetrahedra </span>= <span class="kw">array</span>[<span class="fl">16</span>][<span class="fl">4</span>]</span>
<span id="cb3-254"><a href="#cb3-254"></a>{ { <span class="fl">0</span> , <span class="fl">16</span> , <span class="fl">32</span> , <span class="fl">48</span> }</span>
<span id="cb3-255"><a href="#cb3-255"></a>, { <span class="fl">11</span> , <span class="fl">27</span> , <span class="fl">43</span> , <span class="fl">59</span> }</span>
<span id="cb3-256"><a href="#cb3-256"></a>, { <span class="fl">12</span> , <span class="fl">28</span> , <span class="fl">44</span> , <span class="fl">60</span> }</span>
<span id="cb3-257"><a href="#cb3-257"></a>, { <span class="fl">8</span> , <span class="fl">24</span> , <span class="fl">40</span> , <span class="fl">56</span> }</span>
<span id="cb3-258"><a href="#cb3-258"></a>, { <span class="fl">9</span> , <span class="fl">25</span> , <span class="fl">41</span> , <span class="fl">57</span> }</span>
<span id="cb3-259"><a href="#cb3-259"></a>, { <span class="fl">15</span> , <span class="fl">31</span> , <span class="fl">47</span> , <span class="fl">63</span> }</span>
<span id="cb3-260"><a href="#cb3-260"></a>, { <span class="fl">13</span> , <span class="fl">29</span> , <span class="fl">45</span> , <span class="fl">61</span> }</span>
<span id="cb3-261"><a href="#cb3-261"></a>, { <span class="fl">14</span> , <span class="fl">30</span> , <span class="fl">46</span> , <span class="fl">62</span> }</span>
<span id="cb3-262"><a href="#cb3-262"></a>, { <span class="fl">10</span> , <span class="fl">26</span> , <span class="fl">42</span> , <span class="fl">58</span> }</span>
<span id="cb3-263"><a href="#cb3-263"></a>, { <span class="fl">3</span> , <span class="fl">19</span> , <span class="fl">35</span> , <span class="fl">51</span> }</span>
<span id="cb3-264"><a href="#cb3-264"></a>, { <span class="fl">2</span> , <span class="fl">18</span> , <span class="fl">34</span> , <span class="fl">50</span> }</span>
<span id="cb3-265"><a href="#cb3-265"></a>, { <span class="fl">1</span> , <span class="fl">17</span> , <span class="fl">33</span> , <span class="fl">49</span> }</span>
<span id="cb3-266"><a href="#cb3-266"></a>, { <span class="fl">4</span> , <span class="fl">20</span> , <span class="fl">36</span> , <span class="fl">52</span> }</span>
<span id="cb3-267"><a href="#cb3-267"></a>, { <span class="fl">5</span> , <span class="fl">21</span> , <span class="fl">37</span> , <span class="fl">53</span> }</span>
<span id="cb3-268"><a href="#cb3-268"></a>, { <span class="fl">6</span> , <span class="fl">22</span> , <span class="fl">38</span> , <span class="fl">54</span> }</span>
<span id="cb3-269"><a href="#cb3-269"></a>, { <span class="fl">7</span> , <span class="fl">23</span> , <span class="fl">39</span> , <span class="fl">55</span> } };</span>
<span id="cb3-270"><a href="#cb3-270"></a></span>
<span id="cb3-271"><a href="#cb3-271"></a><span class="kw">#declare faces </span>= <span class="kw">array</span>[<span class="fl">64</span>][<span class="fl">3</span>];</span>
<span id="cb3-272"><a href="#cb3-272"></a>#for(i, <span class="fl">0</span>, <span class="fl">15</span>)</span>
<span id="cb3-273"><a href="#cb3-273"></a>    <span class="kw">#declare faces</span>[<span class="fl">4</span>*i][<span class="fl">0</span>] = tetrahedra[i][<span class="fl">0</span>];</span>
<span id="cb3-274"><a href="#cb3-274"></a>    <span class="kw">#declare faces</span>[<span class="fl">4</span>*i][<span class="fl">1</span>] = tetrahedra[i][<span class="fl">1</span>];</span>
<span id="cb3-275"><a href="#cb3-275"></a>    <span class="kw">#declare faces</span>[<span class="fl">4</span>*i][<span class="fl">2</span>] = tetrahedra[i][<span class="fl">2</span>];</span>
<span id="cb3-276"><a href="#cb3-276"></a>    <span class="kw">#declare faces</span>[<span class="fl">4</span>*i+<span class="fl">1</span>][<span class="fl">0</span>] = tetrahedra[i][<span class="fl">0</span>];</span>
<span id="cb3-277"><a href="#cb3-277"></a>    <span class="kw">#declare faces</span>[<span class="fl">4</span>*i+<span class="fl">1</span>][<span class="fl">1</span>] = tetrahedra[i][<span class="fl">1</span>];</span>
<span id="cb3-278"><a href="#cb3-278"></a>    <span class="kw">#declare faces</span>[<span class="fl">4</span>*i+<span class="fl">1</span>][<span class="fl">2</span>] = tetrahedra[i][<span class="fl">3</span>];</span>
<span id="cb3-279"><a href="#cb3-279"></a>    <span class="kw">#declare faces</span>[<span class="fl">4</span>*i+<span class="fl">2</span>][<span class="fl">0</span>] = tetrahedra[i][<span class="fl">0</span>];</span>
<span id="cb3-280"><a href="#cb3-280"></a>    <span class="kw">#declare faces</span>[<span class="fl">4</span>*i+<span class="fl">2</span>][<span class="fl">1</span>] = tetrahedra[i][<span class="fl">2</span>];</span>
<span id="cb3-281"><a href="#cb3-281"></a>    <span class="kw">#declare faces</span>[<span class="fl">4</span>*i+<span class="fl">2</span>][<span class="fl">2</span>] = tetrahedra[i][<span class="fl">3</span>];</span>
<span id="cb3-282"><a href="#cb3-282"></a>    <span class="kw">#declare faces</span>[<span class="fl">4</span>*i+<span class="fl">3</span>][<span class="fl">0</span>] = tetrahedra[i][<span class="fl">1</span>];</span>
<span id="cb3-283"><a href="#cb3-283"></a>    <span class="kw">#declare faces</span>[<span class="fl">4</span>*i+<span class="fl">3</span>][<span class="fl">1</span>] = tetrahedra[i][<span class="fl">2</span>];</span>
<span id="cb3-284"><a href="#cb3-284"></a>    <span class="kw">#declare faces</span>[<span class="fl">4</span>*i+<span class="fl">3</span>][<span class="fl">2</span>] = tetrahedra[i][<span class="fl">3</span>];</span>
<span id="cb3-285"><a href="#cb3-285"></a><span class="ot">#end</span></span>
<span id="cb3-286"><a href="#cb3-286"></a></span>
<span id="cb3-287"><a href="#cb3-287"></a></span>
<span id="cb3-288"><a href="#cb3-288"></a><span class="co">/* rotation in 4D space */</span></span>
<span id="cb3-289"><a href="#cb3-289"></a><span class="kw">#macro rotate4d</span>(theta, phi, xi, vec)</span>
<span id="cb3-290"><a href="#cb3-290"></a>    <span class="kw">#local a </span>= <span class="kw">cos</span>(xi);</span>
<span id="cb3-291"><a href="#cb3-291"></a>    <span class="kw">#local b </span>= <span class="kw">sin</span>(theta)*<span class="kw">cos</span>(phi)*<span class="kw">sin</span>(xi);</span>
<span id="cb3-292"><a href="#cb3-292"></a>    <span class="kw">#local c </span>= <span class="kw">sin</span>(theta)*<span class="kw">sin</span>(phi)*<span class="kw">sin</span>(xi);</span>
<span id="cb3-293"><a href="#cb3-293"></a>    <span class="kw">#local d </span>= <span class="kw">cos</span>(theta)*<span class="kw">sin</span>(xi);</span>
<span id="cb3-294"><a href="#cb3-294"></a>    <span class="kw">#local p </span>= vec.<span class="kw">x</span>;</span>
<span id="cb3-295"><a href="#cb3-295"></a>    <span class="kw">#local q </span>= vec.<span class="kw">y</span>;</span>
<span id="cb3-296"><a href="#cb3-296"></a>    <span class="kw">#local r </span>= vec.<span class="kw">z</span>;</span>
<span id="cb3-297"><a href="#cb3-297"></a>    <span class="kw">#local s </span>= vec.<span class="kw">t</span>;</span>
<span id="cb3-298"><a href="#cb3-298"></a>    &lt; a*p - b*q - c*r - d*s</span>
<span id="cb3-299"><a href="#cb3-299"></a>    , a*q + b*p + c*s - d*r</span>
<span id="cb3-300"><a href="#cb3-300"></a>    , a*r - b*s + c*p + d*q</span>
<span id="cb3-301"><a href="#cb3-301"></a>    , a*s + b*r - c*q + d*p &gt;</span>
<span id="cb3-302"><a href="#cb3-302"></a><span class="ot">#end</span></span>
<span id="cb3-303"><a href="#cb3-303"></a></span>
<span id="cb3-304"><a href="#cb3-304"></a><span class="co">/* stereographic projection */</span></span>
<span id="cb3-305"><a href="#cb3-305"></a><span class="kw">#macro StereographicProjection</span>(q, r)</span>
<span id="cb3-306"><a href="#cb3-306"></a>    &lt;q.<span class="kw">x</span>,q.<span class="kw">y</span>,q.<span class="kw">z</span>&gt;/(r-q.<span class="kw">t</span>)</span>
<span id="cb3-307"><a href="#cb3-307"></a><span class="ot">#end</span></span>
<span id="cb3-308"><a href="#cb3-308"></a></span>
<span id="cb3-309"><a href="#cb3-309"></a><span class="co">/* rotated and projected vertices */</span></span>
<span id="cb3-310"><a href="#cb3-310"></a><span class="kw">#macro ProjectedVertices</span>(theta, phi, xi, r)</span>
<span id="cb3-311"><a href="#cb3-311"></a>    <span class="kw">#local out </span>= <span class="kw">array</span>[<span class="fl">64</span>];</span>
<span id="cb3-312"><a href="#cb3-312"></a>    #for(i, <span class="fl">0</span>, <span class="fl">63</span>)</span>
<span id="cb3-313"><a href="#cb3-313"></a>        <span class="kw">#local out</span>[i] = StereographicProjection(</span>
<span id="cb3-314"><a href="#cb3-314"></a>                            rotate4d(theta,phi,xi,vertices[i]), r</span>
<span id="cb3-315"><a href="#cb3-315"></a>                        );</span>
<span id="cb3-316"><a href="#cb3-316"></a>    <span class="ot">#end</span></span>
<span id="cb3-317"><a href="#cb3-317"></a>    out</span>
<span id="cb3-318"><a href="#cb3-318"></a><span class="ot">#end</span></span>
<span id="cb3-319"><a href="#cb3-319"></a></span>
<span id="cb3-320"><a href="#cb3-320"></a><span class="co">/* macro spherical segment */</span></span>
<span id="cb3-321"><a href="#cb3-321"></a><span class="kw">#macro vlength4</span>(P)</span>
<span id="cb3-322"><a href="#cb3-322"></a>    <span class="kw">sqrt</span>(P.<span class="kw">x</span>*P.<span class="kw">x</span> + P.<span class="kw">y</span>*P.<span class="kw">y</span> + P.<span class="kw">z</span>*P.<span class="kw">z</span> + P.<span class="kw">t</span>*P.<span class="kw">t</span>)</span>
<span id="cb3-323"><a href="#cb3-323"></a><span class="ot">#end</span></span>
<span id="cb3-324"><a href="#cb3-324"></a></span>
<span id="cb3-325"><a href="#cb3-325"></a><span class="kw">#macro sphericalSegment</span>(P, Q, r, n)</span>
<span id="cb3-326"><a href="#cb3-326"></a>    <span class="kw">#local out </span>= <span class="kw">array</span>[n+<span class="fl">1</span>];</span>
<span id="cb3-327"><a href="#cb3-327"></a>    #for(i, <span class="fl">0</span>, n)</span>
<span id="cb3-328"><a href="#cb3-328"></a>        <span class="kw">#local pt </span>= P + (i/n)*(Q-P);</span>
<span id="cb3-329"><a href="#cb3-329"></a>        <span class="kw">#local out</span>[i] = r/vlength4(pt) * pt;</span>
<span id="cb3-330"><a href="#cb3-330"></a>    <span class="ot">#end</span></span>
<span id="cb3-331"><a href="#cb3-331"></a>    out</span>
<span id="cb3-332"><a href="#cb3-332"></a><span class="ot">#end</span></span>
<span id="cb3-333"><a href="#cb3-333"></a></span>
<span id="cb3-334"><a href="#cb3-334"></a><span class="co">/* macro to draw an edge */</span></span>
<span id="cb3-335"><a href="#cb3-335"></a><span class="kw">#macro Edge</span>(verts, v1, v2, theta, phi, xi, r, Tex)</span>
<span id="cb3-336"><a href="#cb3-336"></a>    <span class="kw">#local P </span>= verts[v1];</span>
<span id="cb3-337"><a href="#cb3-337"></a>    <span class="kw">#local Q </span>= verts[v2];</span>
<span id="cb3-338"><a href="#cb3-338"></a>    <span class="kw">#local PQ </span>= sphericalSegment(P, Q, r, <span class="fl">100</span>);</span>
<span id="cb3-339"><a href="#cb3-339"></a>    <span class="kw">sphere_sweep</span> {</span>
<span id="cb3-340"><a href="#cb3-340"></a>        <span class="kw">b_spline</span> <span class="fl">101</span></span>
<span id="cb3-341"><a href="#cb3-341"></a>        #for(k,<span class="fl">0</span>,<span class="fl">100</span>)</span>
<span id="cb3-342"><a href="#cb3-342"></a>            <span class="kw">#local O </span>= </span>
<span id="cb3-343"><a href="#cb3-343"></a>                StereographicProjection(rotate4d(theta,phi,xi,PQ[k]), r);</span>
<span id="cb3-344"><a href="#cb3-344"></a>            O <span class="kw">log</span>(<span class="fl">1</span>+<span class="kw">vlength</span>(O)/<span class="fl">4</span>)/<span class="fl">2</span></span>
<span id="cb3-345"><a href="#cb3-345"></a>        <span class="ot">#end</span></span>
<span id="cb3-346"><a href="#cb3-346"></a>        <span class="kw">texture</span> { </span>
<span id="cb3-347"><a href="#cb3-347"></a>            Tex</span>
<span id="cb3-348"><a href="#cb3-348"></a>        }</span>
<span id="cb3-349"><a href="#cb3-349"></a>    }</span>
<span id="cb3-350"><a href="#cb3-350"></a><span class="ot">#end</span></span>
<span id="cb3-351"><a href="#cb3-351"></a></span>
<span id="cb3-352"><a href="#cb3-352"></a><span class="co">/* stereographic subdivision (to fill the triangular faces) */</span></span>
<span id="cb3-353"><a href="#cb3-353"></a><span class="kw">#macro midpoint4</span>(A, B, r)</span>
<span id="cb3-354"><a href="#cb3-354"></a>    <span class="kw">#local xmid </span>= (A.<span class="kw">x</span> + B.<span class="kw">x</span>)/<span class="fl">2</span>;</span>
<span id="cb3-355"><a href="#cb3-355"></a>    <span class="kw">#local ymid </span>= (A.<span class="kw">y</span> + B.<span class="kw">y</span>)/<span class="fl">2</span>;</span>
<span id="cb3-356"><a href="#cb3-356"></a>    <span class="kw">#local zmid </span>= (A.<span class="kw">z</span> + B.<span class="kw">z</span>)/<span class="fl">2</span>;</span>
<span id="cb3-357"><a href="#cb3-357"></a>    <span class="kw">#local tmid </span>= (A.<span class="kw">t</span> + B.<span class="kw">t</span>)/<span class="fl">2</span>;</span>
<span id="cb3-358"><a href="#cb3-358"></a>    <span class="kw">#local lg </span>= <span class="kw">sqrt</span>(xmid*xmid + ymid*ymid + zmid*zmid + tmid*tmid) / r;</span>
<span id="cb3-359"><a href="#cb3-359"></a>    &lt; xmid / lg, ymid / lg, zmid / lg, tmid / lg &gt;</span>
<span id="cb3-360"><a href="#cb3-360"></a><span class="ot">#end</span></span>
<span id="cb3-361"><a href="#cb3-361"></a></span>
<span id="cb3-362"><a href="#cb3-362"></a><span class="kw">#macro subdiv0</span>(A, B, C, r)</span>
<span id="cb3-363"><a href="#cb3-363"></a>    <span class="kw">#local mAB </span>= midpoint4(A, B, r);</span>
<span id="cb3-364"><a href="#cb3-364"></a>    <span class="kw">#local mAC </span>= midpoint4(A, C, r);</span>
<span id="cb3-365"><a href="#cb3-365"></a>    <span class="kw">#local mBC </span>= midpoint4(B, C, r);</span>
<span id="cb3-366"><a href="#cb3-366"></a>    <span class="kw">#local trgl1 </span>= <span class="kw">array</span>[<span class="fl">3</span>] {A, mAB, mAC};</span>
<span id="cb3-367"><a href="#cb3-367"></a>    <span class="kw">#local trgl2 </span>= <span class="kw">array</span>[<span class="fl">3</span>] {B, mAB, mBC};</span>
<span id="cb3-368"><a href="#cb3-368"></a>    <span class="kw">#local trgl3 </span>= <span class="kw">array</span>[<span class="fl">3</span>] {C, mBC, mAC};</span>
<span id="cb3-369"><a href="#cb3-369"></a>    <span class="kw">#local trgl4 </span>= <span class="kw">array</span>[<span class="fl">3</span>] {mAB, mAC, mBC};</span>
<span id="cb3-370"><a href="#cb3-370"></a>    <span class="kw">array</span>[<span class="fl">4</span>] {trgl1, trgl2, trgl3, trgl4}</span>
<span id="cb3-371"><a href="#cb3-371"></a><span class="ot">#end</span></span>
<span id="cb3-372"><a href="#cb3-372"></a></span>
<span id="cb3-373"><a href="#cb3-373"></a><span class="kw">#macro subdiv</span>(A, B, C, r, depth)</span>
<span id="cb3-374"><a href="#cb3-374"></a>    <span class="ot">#if</span>(depth=<span class="fl">1</span>)</span>
<span id="cb3-375"><a href="#cb3-375"></a>        <span class="kw">#local out </span>= subdiv0(A, B, C, r);</span>
<span id="cb3-376"><a href="#cb3-376"></a>    <span class="ot">#else</span></span>
<span id="cb3-377"><a href="#cb3-377"></a>        <span class="kw">#local triangles </span>= subdiv(A, B, C, r, depth<span class="fl">-1</span>);</span>
<span id="cb3-378"><a href="#cb3-378"></a>        <span class="kw">#local out </span>= <span class="kw">array</span>[<span class="kw">pow</span>(<span class="fl">4</span>,depth)];</span>
<span id="cb3-379"><a href="#cb3-379"></a>        #for(i, <span class="fl">0</span>, <span class="kw">pow</span>(<span class="fl">4</span>,depth<span class="fl">-1</span>)-<span class="fl">1</span>)</span>
<span id="cb3-380"><a href="#cb3-380"></a>            <span class="kw">#local trgl </span>= triangles[i];</span>
<span id="cb3-381"><a href="#cb3-381"></a>            <span class="kw">#local trgls </span>= subdiv0(trgl[<span class="fl">0</span>], trgl[<span class="fl">1</span>], trgl[<span class="fl">2</span>], r);</span>
<span id="cb3-382"><a href="#cb3-382"></a>            <span class="kw">#local out</span>[<span class="fl">4</span>*i] = trgls[<span class="fl">0</span>];</span>
<span id="cb3-383"><a href="#cb3-383"></a>            <span class="kw">#local out</span>[<span class="fl">4</span>*i+<span class="fl">1</span>] = trgls[<span class="fl">1</span>];</span>
<span id="cb3-384"><a href="#cb3-384"></a>            <span class="kw">#local out</span>[<span class="fl">4</span>*i+<span class="fl">2</span>] = trgls[<span class="fl">2</span>];</span>
<span id="cb3-385"><a href="#cb3-385"></a>            <span class="kw">#local out</span>[<span class="fl">4</span>*i+<span class="fl">3</span>] = trgls[<span class="fl">3</span>];</span>
<span id="cb3-386"><a href="#cb3-386"></a>        <span class="ot">#end</span></span>
<span id="cb3-387"><a href="#cb3-387"></a>    <span class="ot">#end</span></span>
<span id="cb3-388"><a href="#cb3-388"></a>    out</span>
<span id="cb3-389"><a href="#cb3-389"></a><span class="ot">#end</span></span>
<span id="cb3-390"><a href="#cb3-390"></a></span>
<span id="cb3-391"><a href="#cb3-391"></a><span class="co">/*-------------------------------------------*/</span></span>
<span id="cb3-392"><a href="#cb3-392"></a><span class="co">/*-----      draw the polychoron       ------*/</span></span>
<span id="cb3-393"><a href="#cb3-393"></a><span class="co">/*-------------------------------------------*/</span></span>
<span id="cb3-394"><a href="#cb3-394"></a><span class="kw">#declare theta </span>= <span class="fl">pi</span>/<span class="fl">2</span>;</span>
<span id="cb3-395"><a href="#cb3-395"></a><span class="kw">#declare phi </span>= <span class="fl">0</span>;</span>
<span id="cb3-396"><a href="#cb3-396"></a><span class="kw">#declare xi </span>= <span class="fl">2</span>*<span class="kw">frame_number</span>*<span class="fl">pi</span>/<span class="fl">180</span>;</span>
<span id="cb3-397"><a href="#cb3-397"></a><span class="kw">#declare r </span>= <span class="kw">sqrt</span>(<span class="fl">1</span>+<span class="fl">3</span>*sqr2p1*sqr2p1); </span>
<span id="cb3-398"><a href="#cb3-398"></a><span class="kw">#declare depth </span>= <span class="fl">5</span>;</span>
<span id="cb3-399"><a href="#cb3-399"></a></span>
<span id="cb3-400"><a href="#cb3-400"></a><span class="kw">#declare vs </span>= ProjectedVertices(theta, phi, xi, r);</span>
<span id="cb3-401"><a href="#cb3-401"></a></span>
<span id="cb3-402"><a href="#cb3-402"></a><span class="kw">#declare stereoTriangles </span>= <span class="kw">array</span>[<span class="fl">64</span>];</span>
<span id="cb3-403"><a href="#cb3-403"></a>#for(i, <span class="fl">0</span>, <span class="fl">63</span>)</span>
<span id="cb3-404"><a href="#cb3-404"></a>    <span class="kw">#local triangles4 </span>= </span>
<span id="cb3-405"><a href="#cb3-405"></a>        subdiv(</span>
<span id="cb3-406"><a href="#cb3-406"></a>            vertices[faces[i][<span class="fl">0</span>]], </span>
<span id="cb3-407"><a href="#cb3-407"></a>            vertices[faces[i][<span class="fl">1</span>]], </span>
<span id="cb3-408"><a href="#cb3-408"></a>            vertices[faces[i][<span class="fl">2</span>]], r, depth);</span>
<span id="cb3-409"><a href="#cb3-409"></a>    <span class="kw">#declare stereoTriangles</span>[i] = <span class="kw">array</span>[<span class="kw">dimension_size</span>(triangles4,<span class="fl">1</span>)][<span class="fl">3</span>];</span>
<span id="cb3-410"><a href="#cb3-410"></a>    #for(j, <span class="fl">0</span>, <span class="kw">dimension_size</span>(triangles4,<span class="fl">1</span>)-<span class="fl">1</span>)</span>
<span id="cb3-411"><a href="#cb3-411"></a>        <span class="kw">#local trgl4 </span>= triangles4[j];</span>
<span id="cb3-412"><a href="#cb3-412"></a>        <span class="kw">#declare stereoTriangles</span>[i][j][<span class="fl">0</span>] = </span>
<span id="cb3-413"><a href="#cb3-413"></a>            StereographicProjection(rotate4d(theta, phi, xi, trgl4[<span class="fl">0</span>]), r);</span>
<span id="cb3-414"><a href="#cb3-414"></a>        <span class="kw">#declare stereoTriangles</span>[i][j][<span class="fl">1</span>] = </span>
<span id="cb3-415"><a href="#cb3-415"></a>            StereographicProjection(rotate4d(theta, phi, xi, trgl4[<span class="fl">1</span>]), r);</span>
<span id="cb3-416"><a href="#cb3-416"></a>        <span class="kw">#declare stereoTriangles</span>[i][j][<span class="fl">2</span>] = </span>
<span id="cb3-417"><a href="#cb3-417"></a>            StereographicProjection(rotate4d(theta, phi, xi, trgl4[<span class="fl">2</span>]), r);</span>
<span id="cb3-418"><a href="#cb3-418"></a>    <span class="ot">#end</span></span>
<span id="cb3-419"><a href="#cb3-419"></a><span class="ot">#end</span></span>
<span id="cb3-420"><a href="#cb3-420"></a></span>
<span id="cb3-421"><a href="#cb3-421"></a><span class="kw">#declare edgeTexture </span>= <span class="kw">texture</span> {</span>
<span id="cb3-422"><a href="#cb3-422"></a>    <span class="kw">pigment</span> { <span class="kw">color</span> DarkPurple }</span>
<span id="cb3-423"><a href="#cb3-423"></a>    <span class="kw">finish</span> {</span>
<span id="cb3-424"><a href="#cb3-424"></a>      <span class="kw">ambient</span> <span class="fl">.1</span></span>
<span id="cb3-425"><a href="#cb3-425"></a>      <span class="kw">diffuse</span> <span class="fl">.9</span></span>
<span id="cb3-426"><a href="#cb3-426"></a>      <span class="kw">reflection</span> <span class="fl">0</span></span>
<span id="cb3-427"><a href="#cb3-427"></a>      <span class="kw">specular</span> <span class="fl">1</span></span>
<span id="cb3-428"><a href="#cb3-428"></a>      <span class="kw">metallic</span></span>
<span id="cb3-429"><a href="#cb3-429"></a>    }</span>
<span id="cb3-430"><a href="#cb3-430"></a>};</span>
<span id="cb3-431"><a href="#cb3-431"></a></span>
<span id="cb3-432"><a href="#cb3-432"></a><span class="kw">object</span> {</span>
<span id="cb3-433"><a href="#cb3-433"></a>    <span class="kw">union</span> {</span>
<span id="cb3-434"><a href="#cb3-434"></a>        <span class="co">/* draw edges */</span></span>
<span id="cb3-435"><a href="#cb3-435"></a>        #for(i, <span class="fl">0</span>, <span class="fl">127</span>)</span>
<span id="cb3-436"><a href="#cb3-436"></a>            Edge(vertices, edges[i][<span class="fl">0</span>], edges[i][<span class="fl">1</span>], </span>
<span id="cb3-437"><a href="#cb3-437"></a>                    theta, phi, xi, r, edgeTexture)</span>
<span id="cb3-438"><a href="#cb3-438"></a>        <span class="ot">#end</span></span>
<span id="cb3-439"><a href="#cb3-439"></a>        <span class="co">/* draw vertices */</span> </span>
<span id="cb3-440"><a href="#cb3-440"></a>        #for(i,<span class="fl">0</span>,<span class="fl">63</span>)</span>
<span id="cb3-441"><a href="#cb3-441"></a>            <span class="kw">sphere</span> {</span>
<span id="cb3-442"><a href="#cb3-442"></a>                vs[i], <span class="kw">vlength</span>(vs[i])/<span class="fl">15</span></span>
<span id="cb3-443"><a href="#cb3-443"></a>                <span class="kw">texture</span> { edgeTexture }</span>
<span id="cb3-444"><a href="#cb3-444"></a>            }</span>
<span id="cb3-445"><a href="#cb3-445"></a>        <span class="ot">#end</span>  </span>
<span id="cb3-446"><a href="#cb3-446"></a>        <span class="co">/* fill triangles */</span></span>
<span id="cb3-447"><a href="#cb3-447"></a>        <span class="kw">mesh</span> {</span>
<span id="cb3-448"><a href="#cb3-448"></a>            #for(i, <span class="fl">0</span>, <span class="fl">63</span>)</span>
<span id="cb3-449"><a href="#cb3-449"></a>                <span class="kw">#local trgl </span>= stereoTriangles[i];</span>
<span id="cb3-450"><a href="#cb3-450"></a>                #for(j, <span class="fl">0</span>, <span class="kw">dimension_size</span>(trgl,<span class="fl">1</span>)-<span class="fl">1</span>)</span>
<span id="cb3-451"><a href="#cb3-451"></a>                    <span class="kw">triangle</span> {</span>
<span id="cb3-452"><a href="#cb3-452"></a>                        trgl[j][<span class="fl">0</span>], trgl[j][<span class="fl">1</span>], trgl[j][<span class="fl">2</span>]</span>
<span id="cb3-453"><a href="#cb3-453"></a>                    }</span>
<span id="cb3-454"><a href="#cb3-454"></a>                <span class="ot">#end</span></span>
<span id="cb3-455"><a href="#cb3-455"></a>            <span class="ot">#end</span></span>
<span id="cb3-456"><a href="#cb3-456"></a>            <span class="kw">texture</span> {</span>
<span id="cb3-457"><a href="#cb3-457"></a>                <span class="kw">pigment</span> { Red }</span>
<span id="cb3-458"><a href="#cb3-458"></a>                <span class="kw">finish</span> {</span>
<span id="cb3-459"><a href="#cb3-459"></a>                    <span class="kw">ambient</span> <span class="fl">0.5</span></span>
<span id="cb3-460"><a href="#cb3-460"></a>                    <span class="kw">reflection</span> <span class="fl">0</span></span>
<span id="cb3-461"><a href="#cb3-461"></a>                    <span class="kw">brilliance</span> <span class="fl">4</span></span>
<span id="cb3-462"><a href="#cb3-462"></a>                }</span>
<span id="cb3-463"><a href="#cb3-463"></a>            }</span>
<span id="cb3-464"><a href="#cb3-464"></a>        }</span>
<span id="cb3-465"><a href="#cb3-465"></a>     }</span>
<span id="cb3-466"><a href="#cb3-466"></a>     <span class="kw">scale</span> <span class="fl">0.5</span></span>
<span id="cb3-467"><a href="#cb3-467"></a>     <span class="kw">translate</span> &lt;-<span class="fl">8</span>, <span class="fl">6</span>, <span class="fl">-25</span>&gt;</span>
<span id="cb3-468"><a href="#cb3-468"></a>}</span></code></pre></div>
<p><img src="figures/truncatedTesseract_stereographic_povray.gif" /></p>

        </div>


        <div id="footer">
          Site proudly generated by
          <a href="http://jaspervdj.be/hakyll">Hakyll</a>
        </div>

      </div>

    </div>

    <div class="row">
      <div class="col-sm-12">
        <div id="disqus_thread"></div>
        <div class="pagination">
          <ul>
            <li>
              <a href="http://laustep.github.io/stlahblog/">&#171; Back Home</a>
            </li>
          </ul>
        </div>
      </div>
    </div>
    
  </div>

</body>

<script src="/libraries/bootstrap/bootstrap.min.js"></script>
<script>
  var disqus_developer = 1;
  var disqus_shortname = 'stlapblog';
  // required: replace example with your forum shortname
  /* * * DON'T EDIT BELOW THIS LINE * * */
  (function () {
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = 'https://' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] ||
      document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>
<noscript>Please enable JavaScript to view the
  <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a>
</noscript>
<!-- MathJax: Fall back to local if CDN offline but local image fonts are not supported (saves >100MB) -->
<script type="text/x-mathjax-config" src="/libraries/mathjax/config/TeX-MML-AM_CHTML.js"></script>
<!-- <script>
  window.MathJax || document.write('<script type="text/x-mathjax-config">MathJax.Hub.Config({"HTML-CSS":{imageFont:null}});<\/script><script src="../libraries/mathjax/MathJax.js"><\/script>');
</script> -->


</html>]]></description>
    <pubDate>Mon, 16 Dec 2019 00:00:00 UT</pubDate>
    <guid>https://laustep.github.io/stlahblog/posts/StereoTruncatedTesseract.html</guid>
    <dc:creator>Stéphane Laurent</dc:creator>
    <category>R</category>
</item>


<item>
    <title>A shinytest script in testthat</title>
    <link>https://laustep.github.io/stlahblog/posts/shinytestthat.html</link>
    <description><![CDATA[<!DOCTYPE HTML>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Saturn Elephant - A shinytest script in testthat</title>
  <link href="/libraries/bootstrap/bootstrap-grid.min.css" rel="stylesheet">
  <link rel="stylesheet" href="/css/default2.css" />
  <link rel="stylesheet" href="/css/post.css" />
  <link rel="stylesheet" href="/css/misc.css" /> 
  
    <link rel="stylesheet" href="/css/pandoc-solarized.css" /> 
   
  
    <link href="/libraries/highlighters/prettify/css/minimal.css" rel="stylesheet"> 
  
  <link href="https://fonts.googleapis.com/css?family=Raleway:400,600,200,800" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/css?family=Droid+Sans" rel="stylesheet" type="text/css">
  <script src="/libraries/jquery.min.js"></script>
  <script type="text/javascript" async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML"></script>
</head>

<body>
  <div class="container-fluid">
    <div class="row">
      <!-- Sidebar. -->
      <div class="sidebar col-sm-2">
        <div class="row">
          <div class="col-sm-12" style="float:right;clear:both;margin-right:50px;margin-top:50px;">
            <a href="https://www.r-bloggers.com/">
              <img src="/images/Rbloggers.png" alt="Rbloggers" width="100%" />
            </a>
            <br/>
            <a href="http://t-redactyl.io/">
              <span style="color:black;font-weight:bold;font-family:sans-serif;font-size:25px;">Standard error</span>
            </a>
            <a href="http://timelyportfolio.blogspot.be/">
              <span style="color:grey;font-weight:bold;font-family:sans-serif;font-size:24px;">Timely portfolio</span>
            </a>
            <br/>
            <a href="https://antoineguillot.wordpress.com/blog/">
              <span style="color:white;background-color:darkblue;font-weight:bold;font-family:sans-serif;font-size:21px;border:5px solid;border-color:darkblue">ENHANCE DATA</span>
            </a>
            <br/>
            <a href="https://fronkonstin.com/">
              <span style="color:black;background-color:gold;font-weight:bold;font-size:29px;border:3px solid;border-color:gold;">Fronkonstin</span>
            </a>
          </div>
        </div>
        <div id="logos">
          <div class="row">
            <div class="col-sm-4">
              <img src="/images/AsymptoteLogo.svg" style="width: 150%; transform: rotateZ(-35deg)"/>
            </div>
            <div class="col-sm-4">
              <img src="/images/Rlogo.svg" style="width: 110%;"/>
            </div>
            <div class="col-sm-4">
              <img src="/images/shiny-hex.png" style="width: 90%;"/>
            </div>
          </div>
          <div class="row">
            <div class="col-sm-4">
              <img src="/images/Povray_logo_sphere.png" style="width: 105%;"/>
            </div>
            <div class="col-sm-4">
              <img src="/images/javascript.svg" style="width: 90%;"/>
            </div>
            <div class="col-sm-4">
              <img src="/images/haskell.svg" style="width: 110%;"/>
            </div>
          </div>
        </div>
      </div>

      <div class="main col-sm-10">
        <div id="header">
          <div id="logo">
            <a href="/">
              <img src="/images/stla.jpg" alt="stla" width="100px" />
            </a>
          </div>
          <div id="navigation" style="margin-top:50px;">
            <a href="/">Home</a>
            <a href="/about.html">About</a>
            <a href="/contact.html">Contact</a>
            <a href="/archive.html">Archive</a>
          </div>
        </div>

        <div class="content">
          <h1>A shinytest script in testthat</h1> 
          <div class="info">
    Posted on November 23, 2019
    
        by Stéphane Laurent
    
</div>
<div class="info">
    
    Tags: <a title="All pages tagged &#39;shiny&#39;." href="/tags/shiny.html">shiny</a>, <a title="All pages tagged &#39;R&#39;." href="/tags/R.html">R</a>
    
</div>

<h2 id="the-shiny-app">The shiny app</h2>
<p>Here is a simple shiny app:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true"></a><span class="kw">library</span>(shiny)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true"></a><span class="kw">library</span>(ggplot2)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true"></a><span class="co"># UI ####</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true"></a>ui &lt;-<span class="st"> </span><span class="kw">fluidPage</span>(</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true"></a>  </span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true"></a>  <span class="kw">titlePanel</span>(<span class="st">&quot;Set axis breaks&quot;</span>),</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true"></a>  </span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true"></a>  <span class="kw">sidebarLayout</span>(</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true"></a>    <span class="co"># sidebar ####</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true"></a>    <span class="kw">sidebarPanel</span>(</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true"></a>      <span class="kw">fluidRow</span>(</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true"></a>        <span class="kw">column</span>(</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true"></a>          <span class="dt">width =</span> <span class="dv">4</span>,</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true"></a>          <span class="kw">numericInput</span>(<span class="st">&quot;from&quot;</span>, <span class="st">&quot;From:&quot;</span>, <span class="dt">value =</span> <span class="ot">NULL</span>)</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true"></a>        ),</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true"></a>        <span class="kw">column</span>(</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true"></a>          <span class="dt">width =</span> <span class="dv">4</span>,</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true"></a>          <span class="kw">numericInput</span>(<span class="st">&quot;to&quot;</span>, <span class="st">&quot;To:&quot;</span>, <span class="dt">value =</span> <span class="ot">NULL</span>)</span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true"></a>        ),</span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true"></a>        <span class="kw">column</span>(</span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true"></a>          <span class="dt">width =</span> <span class="dv">4</span>,</span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true"></a>          <span class="kw">numericInput</span>(<span class="st">&quot;by&quot;</span>, <span class="st">&quot;By:&quot;</span>, <span class="dt">value =</span> <span class="ot">NULL</span>)</span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true"></a>        )</span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true"></a>      )</span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true"></a>    ),</span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true"></a>    </span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true"></a>    <span class="co"># main panel ####</span></span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true"></a>    <span class="kw">mainPanel</span>(</span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true"></a>      <span class="kw">plotOutput</span>(<span class="st">&quot;ggplot&quot;</span>)</span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true"></a>    )</span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true"></a>  )</span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true"></a>)</span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true"></a></span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true"></a><span class="co"># SERVER ####</span></span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true"></a>server &lt;-<span class="st"> </span><span class="cf">function</span>(input, output) {</span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true"></a>  </span>
<span id="cb1-38"><a href="#cb1-38" aria-hidden="true"></a>  FromToBy &lt;-<span class="st"> </span><span class="kw">reactiveVal</span>()</span>
<span id="cb1-39"><a href="#cb1-39" aria-hidden="true"></a>  </span>
<span id="cb1-40"><a href="#cb1-40" aria-hidden="true"></a>  <span class="kw">observe</span>({</span>
<span id="cb1-41"><a href="#cb1-41" aria-hidden="true"></a>    breaks &lt;-<span class="st"> </span><span class="kw">tryCatch</span>({</span>
<span id="cb1-42"><a href="#cb1-42" aria-hidden="true"></a>      <span class="kw">seq</span>(input[[<span class="st">&quot;from&quot;</span>]], input[[<span class="st">&quot;to&quot;</span>]], input[[<span class="st">&quot;by&quot;</span>]])</span>
<span id="cb1-43"><a href="#cb1-43" aria-hidden="true"></a>    }, <span class="dt">error =</span> <span class="cf">function</span>(e) <span class="ot">NULL</span>)</span>
<span id="cb1-44"><a href="#cb1-44" aria-hidden="true"></a>    <span class="kw">FromToBy</span>(breaks)</span>
<span id="cb1-45"><a href="#cb1-45" aria-hidden="true"></a>  })</span>
<span id="cb1-46"><a href="#cb1-46" aria-hidden="true"></a>  </span>
<span id="cb1-47"><a href="#cb1-47" aria-hidden="true"></a>  scatterplot &lt;-<span class="st"> </span><span class="kw">reactive</span>({</span>
<span id="cb1-48"><a href="#cb1-48" aria-hidden="true"></a>    gg &lt;-<span class="st"> </span><span class="kw">ggplot</span>(iris, <span class="kw">aes</span>(Sepal.Length, Petal.Length)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>()</span>
<span id="cb1-49"><a href="#cb1-49" aria-hidden="true"></a>    <span class="cf">if</span>(<span class="op">!</span><span class="kw">is.null</span>(<span class="kw">FromToBy</span>())){</span>
<span id="cb1-50"><a href="#cb1-50" aria-hidden="true"></a>      gg &lt;-<span class="st"> </span>gg <span class="op">+</span><span class="st"> </span><span class="kw">scale_y_continuous</span>(<span class="dt">breaks =</span> <span class="kw">FromToBy</span>())</span>
<span id="cb1-51"><a href="#cb1-51" aria-hidden="true"></a>    }</span>
<span id="cb1-52"><a href="#cb1-52" aria-hidden="true"></a>    gg <span class="op">+</span><span class="st"> </span><span class="kw">theme</span>(</span>
<span id="cb1-53"><a href="#cb1-53" aria-hidden="true"></a>      <span class="dt">axis.text =</span> <span class="kw">element_text</span>(<span class="dt">size =</span> <span class="dv">20</span>),</span>
<span id="cb1-54"><a href="#cb1-54" aria-hidden="true"></a>      <span class="dt">axis.title =</span> <span class="kw">element_text</span>(<span class="dt">size =</span> <span class="dv">18</span>)</span>
<span id="cb1-55"><a href="#cb1-55" aria-hidden="true"></a>    )</span>
<span id="cb1-56"><a href="#cb1-56" aria-hidden="true"></a>  })</span>
<span id="cb1-57"><a href="#cb1-57" aria-hidden="true"></a>  </span>
<span id="cb1-58"><a href="#cb1-58" aria-hidden="true"></a>  output[[<span class="st">&quot;ggplot&quot;</span>]] &lt;-<span class="st"> </span><span class="kw">renderPlot</span>({</span>
<span id="cb1-59"><a href="#cb1-59" aria-hidden="true"></a>    <span class="kw">scatterplot</span>()</span>
<span id="cb1-60"><a href="#cb1-60" aria-hidden="true"></a>  })</span>
<span id="cb1-61"><a href="#cb1-61" aria-hidden="true"></a>  </span>
<span id="cb1-62"><a href="#cb1-62" aria-hidden="true"></a>  <span class="kw">observe</span>({ <span class="co"># this is for shinytest - see later ####</span></span>
<span id="cb1-63"><a href="#cb1-63" aria-hidden="true"></a>    <span class="kw">req</span>(<span class="kw">scatterplot</span>())</span>
<span id="cb1-64"><a href="#cb1-64" aria-hidden="true"></a>    ggg &lt;-<span class="st"> </span><span class="kw">ggplot_build</span>(<span class="kw">scatterplot</span>())</span>
<span id="cb1-65"><a href="#cb1-65" aria-hidden="true"></a>    <span class="kw">exportTestValues</span>(<span class="dt">panelParams =</span> ggg<span class="op">$</span>layout<span class="op">$</span>panel_params[[1L]])</span>
<span id="cb1-66"><a href="#cb1-66" aria-hidden="true"></a>  })</span>
<span id="cb1-67"><a href="#cb1-67" aria-hidden="true"></a>  </span>
<span id="cb1-68"><a href="#cb1-68" aria-hidden="true"></a>}</span>
<span id="cb1-69"><a href="#cb1-69" aria-hidden="true"></a></span>
<span id="cb1-70"><a href="#cb1-70" aria-hidden="true"></a><span class="co"># Run the application ####</span></span>
<span id="cb1-71"><a href="#cb1-71" aria-hidden="true"></a><span class="kw">shinyApp</span>(<span class="dt">ui =</span> ui, <span class="dt">server =</span> server)</span></code></pre></div>
<p>It allows to set the breaks of the y-axis of the graph:</p>
<p><img src = "./figures/shinyFromToBy.gif" width = "650"></p>
<h2 id="unit-test">Unit test</h2>
<p>Say we want to test whether the app correctly sets the axis breaks.</p>
<p>When you have a <code>ggplot</code>, you can get the y-axis breaks as follows:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true"></a><span class="kw">library</span>(ggplot2)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true"></a>gg &lt;-<span class="st"> </span><span class="kw">ggplot</span>(iris, <span class="kw">aes</span>(Sepal.Length, Petal.Length)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>()</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true"></a>ggg &lt;-<span class="st"> </span><span class="kw">ggplot_build</span>(gg)</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true"></a>ggg<span class="op">$</span>layout<span class="op">$</span>panel_params[[1L]][[<span class="st">&quot;y.major_source&quot;</span>]]</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true"></a><span class="co">## [1] 2 4 6</span></span></code></pre></div>
<p>With this piece of code of the app:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true"></a><span class="kw">observe</span>({ <span class="co"># this is for shinytest - see later ####</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true"></a>  <span class="kw">req</span>(<span class="kw">scatterplot</span>())</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true"></a>  ggg &lt;-<span class="st"> </span><span class="kw">ggplot_build</span>(<span class="kw">scatterplot</span>())</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true"></a>  <span class="kw">exportTestValues</span>(<span class="dt">panelParams =</span> ggg<span class="op">$</span>layout<span class="op">$</span>panel_params[[1L]])</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true"></a>})</span></code></pre></div>
<p>we export <code>ggg$layout$panel_params[[1L]]</code>.</p>
<p>Assume our package is named <code>shinyFromToBy</code> and the shiny app is saved in file <code>app.R</code> in the <code>inst/shinyApp</code> folder. Then, here is our unit test (to put in the <code>tests/testthat</code> folder):</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true"></a><span class="kw">context</span>(<span class="st">&quot;y-axis breaks&quot;</span>)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true"></a></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true"></a><span class="kw">test_that</span>(<span class="st">&quot;y-breaks are correct&quot;</span>, {</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true"></a></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true"></a>  <span class="kw">skip_if_not_installed</span>(<span class="st">&quot;shinytest&quot;</span>)</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true"></a>  <span class="kw">library</span>(shinytest)</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true"></a></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true"></a>  app &lt;-<span class="st"> </span>ShinyDriver<span class="op">$</span><span class="kw">new</span>(</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true"></a>    <span class="kw">system.file</span>(<span class="st">&quot;shinyApp&quot;</span>, <span class="dt">package =</span> <span class="st">&quot;shinyFromToBy&quot;</span>),</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true"></a>    <span class="dt">loadTimeout =</span> <span class="fl">1e+05</span>,</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true"></a>    <span class="dt">shinyOptions =</span> <span class="kw">list</span>(<span class="dt">test.mode =</span> <span class="ot">TRUE</span>)</span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true"></a>  )</span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true"></a>  app<span class="op">$</span><span class="kw">setInputs</span>(<span class="dt">from =</span> <span class="dv">1</span>)</span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true"></a>  app<span class="op">$</span><span class="kw">setInputs</span>(<span class="dt">to =</span> <span class="dv">7</span>)</span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true"></a>  app<span class="op">$</span><span class="kw">setInputs</span>(<span class="dt">by =</span> <span class="fl">0.5</span>)</span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true"></a>  panelParams &lt;-<span class="st"> </span>app<span class="op">$</span><span class="kw">getAllValues</span>()<span class="op">$</span>export[[<span class="st">&quot;panelParams&quot;</span>]]</span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true"></a></span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true"></a>  <span class="kw">expect_identical</span>(</span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true"></a>    panelParams[[<span class="st">&quot;y.major_source&quot;</span>]],</span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true"></a>    <span class="kw">seq</span>(<span class="dv">1</span>, <span class="dv">7</span>, <span class="dt">by =</span> <span class="fl">0.5</span>)</span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true"></a>  )</span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true"></a></span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true"></a>  app<span class="op">$</span><span class="kw">stop</span>()</span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true"></a></span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true"></a>})</span></code></pre></div>

        </div>


        <div id="footer">
          Site proudly generated by
          <a href="http://jaspervdj.be/hakyll">Hakyll</a>
        </div>

      </div>

    </div>

    <div class="row">
      <div class="col-sm-12">
        <div id="disqus_thread"></div>
        <div class="pagination">
          <ul>
            <li>
              <a href="http://laustep.github.io/stlahblog/">&#171; Back Home</a>
            </li>
          </ul>
        </div>
      </div>
    </div>
    
  </div>

</body>

<script src="/libraries/bootstrap/bootstrap.min.js"></script>
<script>
  var disqus_developer = 1;
  var disqus_shortname = 'stlapblog';
  // required: replace example with your forum shortname
  /* * * DON'T EDIT BELOW THIS LINE * * */
  (function () {
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = 'https://' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] ||
      document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>
<noscript>Please enable JavaScript to view the
  <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a>
</noscript>
<!-- MathJax: Fall back to local if CDN offline but local image fonts are not supported (saves >100MB) -->
<script type="text/x-mathjax-config" src="/libraries/mathjax/config/TeX-MML-AM_CHTML.js"></script>
<!-- <script>
  window.MathJax || document.write('<script type="text/x-mathjax-config">MathJax.Hub.Config({"HTML-CSS":{imageFont:null}});<\/script><script src="../libraries/mathjax/MathJax.js"><\/script>');
</script> -->

  <!-- Google Prettify -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prettify/188.0.0/prettify.js"></script>
  <!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/prettify/r298/prettify.js"></script> -->
  <script src="/libraries/highlighters/prettify/js/lang-r.js"></script>
  <script>
    var pres = document.getElementsByTagName("pre");
    for (var i = 0; i < pres.length; ++i) {
      
        pres[i].className = pres[i].className + " prettyprint linenums";
      
    }
    prettyPrint();
  </script> 


</html>]]></description>
    <pubDate>Sat, 23 Nov 2019 00:00:00 UT</pubDate>
    <guid>https://laustep.github.io/stlahblog/posts/shinytestthat.html</guid>
    <dc:creator>Stéphane Laurent</dc:creator>
    <category>R</category>
</item>


<item>
    <title>Five-parameters logistic regression</title>
    <link>https://laustep.github.io/stlahblog/posts/5pl.html</link>
    <description><![CDATA[<!DOCTYPE HTML>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Saturn Elephant - Five-parameters logistic regression</title>
  <link href="/libraries/bootstrap/bootstrap-grid.min.css" rel="stylesheet">
  <link rel="stylesheet" href="/css/default2.css" />
  <link rel="stylesheet" href="/css/post.css" />
  <link rel="stylesheet" href="/css/misc.css" /> 
  
    <link rel="stylesheet" href="/css/pandoc-solarized.css" /> 
   
  
  <link href="https://fonts.googleapis.com/css?family=Raleway:400,600,200,800" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/css?family=Droid+Sans" rel="stylesheet" type="text/css">
  <script src="/libraries/jquery.min.js"></script>
  <script type="text/javascript" async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML"></script>
</head>

<body>
  <div class="container-fluid">
    <div class="row">
      <!-- Sidebar. -->
      <div class="sidebar col-sm-2">
        <div class="row">
          <div class="col-sm-12" style="float:right;clear:both;margin-right:50px;margin-top:50px;">
            <a href="https://www.r-bloggers.com/">
              <img src="/images/Rbloggers.png" alt="Rbloggers" width="100%" />
            </a>
            <br/>
            <a href="http://t-redactyl.io/">
              <span style="color:black;font-weight:bold;font-family:sans-serif;font-size:25px;">Standard error</span>
            </a>
            <a href="http://timelyportfolio.blogspot.be/">
              <span style="color:grey;font-weight:bold;font-family:sans-serif;font-size:24px;">Timely portfolio</span>
            </a>
            <br/>
            <a href="https://antoineguillot.wordpress.com/blog/">
              <span style="color:white;background-color:darkblue;font-weight:bold;font-family:sans-serif;font-size:21px;border:5px solid;border-color:darkblue">ENHANCE DATA</span>
            </a>
            <br/>
            <a href="https://fronkonstin.com/">
              <span style="color:black;background-color:gold;font-weight:bold;font-size:29px;border:3px solid;border-color:gold;">Fronkonstin</span>
            </a>
          </div>
        </div>
        <div id="logos">
          <div class="row">
            <div class="col-sm-4">
              <img src="/images/AsymptoteLogo.svg" style="width: 150%; transform: rotateZ(-35deg)"/>
            </div>
            <div class="col-sm-4">
              <img src="/images/Rlogo.svg" style="width: 110%;"/>
            </div>
            <div class="col-sm-4">
              <img src="/images/shiny-hex.png" style="width: 90%;"/>
            </div>
          </div>
          <div class="row">
            <div class="col-sm-4">
              <img src="/images/Povray_logo_sphere.png" style="width: 105%;"/>
            </div>
            <div class="col-sm-4">
              <img src="/images/javascript.svg" style="width: 90%;"/>
            </div>
            <div class="col-sm-4">
              <img src="/images/haskell.svg" style="width: 110%;"/>
            </div>
          </div>
        </div>
      </div>

      <div class="main col-sm-10">
        <div id="header">
          <div id="logo">
            <a href="/">
              <img src="/images/stla.jpg" alt="stla" width="100px" />
            </a>
          </div>
          <div id="navigation" style="margin-top:50px;">
            <a href="/">Home</a>
            <a href="/about.html">About</a>
            <a href="/contact.html">Contact</a>
            <a href="/archive.html">Archive</a>
          </div>
        </div>

        <div class="content">
          <h1>Five-parameters logistic regression</h1> 
          <div class="info">
    Posted on November 20, 2019
    
        by Stéphane Laurent
    
</div>
<div class="info">
    
    Tags: <a title="All pages tagged &#39;maths&#39;." href="/tags/maths.html">maths</a>, <a title="All pages tagged &#39;statistics&#39;." href="/tags/statistics.html">statistics</a>, <a title="All pages tagged &#39;R&#39;." href="/tags/R.html">R</a>
    
</div>

<p>The five-parameters logistic curve is commonly defined by <span class="math display">\[
f(x) = A + \frac{D-A}{\Bigl(1+\exp\bigl(B(C-x)\bigr)\Bigr)^S}.
\]</span> Assuming <span class="math inline">\(B&gt;0\)</span> and <span class="math inline">\(S&gt;0\)</span>,</p>
<ul>
<li><p><span class="math inline">\(A\)</span> is the value of the horizontal asymptote when <span class="math inline">\(x \to -\infty\)</span>;</p></li>
<li><p><span class="math inline">\(D\)</span> is the value of the horizontal asymptote when <span class="math inline">\(x \to +\infty\)</span>;</p></li>
<li><p><span class="math inline">\(B\)</span> describes how rapidly the curve makes its transition between the two asymptotes;</p></li>
<li><p><span class="math inline">\(C\)</span> is a location parameter, which does not have a nice interpretation (except if <span class="math inline">\(S=1\)</span>);</p></li>
<li><p><span class="math inline">\(S\)</span> describes the asymmetry of the curve (the curve is symmetric when <span class="math inline">\(S=1\)</span>).</p></li>
</ul>
<p>In the case when <span class="math inline">\(S=1\)</span>, the parameter <span class="math inline">\(C\)</span> is the value of <span class="math inline">\(x\)</span> for which the corresponding value <span class="math inline">\(f(x)\)</span> is the midpoint between the two asymptotes; moreover, the curve has an inflection point at <span class="math inline">\(x = C\)</span>.</p>
<p>In the general case, the value of <span class="math inline">\(x\)</span> for which the corresponding value <span class="math inline">\(f(x)\)</span> is the midpoint between the two asymptotes is <span class="math display">\[
x_{\text{mid}} = C - \frac{\log\Bigl(2^{\frac{1}{S}}-1\Bigr)}{B}.
\]</span> It is obtained by solving <span class="math inline">\(\Bigl(1+\exp\bigl(B(C-x)\bigr)\Bigr)^S = 2\)</span>.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a>n &lt;-<span class="st"> </span><span class="dv">100</span></span>
<span id="cb1-2"><a href="#cb1-2"></a>x &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="dv">49</span>, <span class="dv">60</span>, <span class="dt">length.out =</span> n)</span>
<span id="cb1-3"><a href="#cb1-3"></a>A &lt;-<span class="st"> </span><span class="dv">30</span>; D &lt;-<span class="st"> </span><span class="dv">100</span>; B &lt;-<span class="st"> </span><span class="dv">1</span>; C &lt;-<span class="st"> </span><span class="dv">50</span>; S &lt;-<span class="st"> </span><span class="dv">10</span></span>
<span id="cb1-4"><a href="#cb1-4"></a>f &lt;-<span class="st"> </span><span class="cf">function</span>(x) A <span class="op">+</span><span class="st"> </span>(D<span class="op">-</span>A) <span class="op">/</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">+</span><span class="st"> </span><span class="kw">exp</span>(B<span class="op">*</span>(C<span class="op">-</span>x)))<span class="op">^</span>S</span>
<span id="cb1-5"><a href="#cb1-5"></a>y0 &lt;-<span class="st"> </span><span class="kw">f</span>(x) </span>
<span id="cb1-6"><a href="#cb1-6"></a><span class="kw">par</span>(<span class="dt">mar =</span> <span class="kw">c</span>(<span class="dv">4</span>, <span class="dv">4</span>, <span class="fl">0.5</span>, <span class="dv">1</span>))</span>
<span id="cb1-7"><a href="#cb1-7"></a><span class="kw">plot</span>(x, y0, <span class="dt">type =</span> <span class="st">&quot;l&quot;</span>, <span class="dt">cex.axis =</span> <span class="fl">0.5</span>, <span class="dt">ylab =</span> <span class="st">&quot;f(x)&quot;</span>)</span>
<span id="cb1-8"><a href="#cb1-8"></a><span class="kw">abline</span>(<span class="dt">v =</span> C, <span class="dt">col =</span> <span class="st">&quot;green&quot;</span>, <span class="dt">lty =</span> <span class="st">&quot;dashed&quot;</span>)</span>
<span id="cb1-9"><a href="#cb1-9"></a>( xmid &lt;-<span class="st"> </span>C <span class="op">-</span><span class="st"> </span><span class="kw">log</span>(<span class="dv">2</span><span class="op">^</span>(<span class="dv">1</span><span class="op">/</span>S) <span class="op">-</span><span class="st"> </span><span class="dv">1</span>)<span class="op">/</span>B )</span>
<span id="cb1-10"><a href="#cb1-10"></a><span class="co">## [1] 52.63424</span></span></code></pre></div>
<div class="sourceCode" id="cb2"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1"></a><span class="kw">abline</span>(<span class="dt">v =</span> xmid, <span class="dt">col =</span> <span class="st">&quot;red&quot;</span>, <span class="dt">lwd =</span> <span class="dv">2</span>) </span>
<span id="cb2-2"><a href="#cb2-2"></a><span class="kw">abline</span>(<span class="dt">h =</span> (A<span class="op">+</span>D)<span class="op">/</span><span class="dv">2</span>, <span class="dt">col =</span> <span class="st">&quot;red&quot;</span>, <span class="dt">lwd =</span> <span class="dv">2</span>)</span></code></pre></div>
<p><img src="./figures/5pl-plot_5pl-1.png" style="display: block; margin: auto;" /></p>
<p>Note that the inflection point of the curve is <em>not</em> the point correspoding to <span class="math inline">\(x_{\text{mid}}\)</span>:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a><span class="kw">library</span>(numDeriv)</span>
<span id="cb3-2"><a href="#cb3-2"></a>df &lt;-<span class="st"> </span><span class="kw">grad</span>(f, x)</span>
<span id="cb3-3"><a href="#cb3-3"></a><span class="kw">par</span>(<span class="dt">mar =</span> <span class="kw">c</span>(<span class="dv">4</span>, <span class="dv">4</span>, <span class="fl">0.5</span>, <span class="dv">1</span>))</span>
<span id="cb3-4"><a href="#cb3-4"></a><span class="kw">plot</span>(x, df, <span class="dt">type =</span> <span class="st">&quot;l&quot;</span>, <span class="dt">cex.axis =</span> <span class="fl">0.5</span>, <span class="dt">ylab=</span><span class="st">&quot;f&#39;(x)&quot;</span>)</span>
<span id="cb3-5"><a href="#cb3-5"></a><span class="kw">abline</span>(<span class="dt">v =</span> xmid, <span class="dt">col =</span> <span class="st">&quot;red&quot;</span>, <span class="dt">lwd =</span> <span class="dv">2</span>) </span></code></pre></div>
<p><img src="./figures/5pl-inflection-1.png" style="display: block; margin: auto;" /></p>
<p>In practice, we are often interested in estimating <span class="math inline">\(x_{\text{mid}}\)</span>. So it is better to use this other parameterization of the five-parameters logistic curve: <span class="math display">\[
g(x) = 
A + \frac{D-A}{{\biggl(1+\exp\Bigl(\log\bigl(2^{\frac{1}{S}}-1\bigr) + B(x_{\text{mid}}-x)\Bigr)\biggr)}^S}
\]</span> because fitting this curve will directly give the estimate of <span class="math inline">\(x_{\text{mid}}\)</span> and its standard error.</p>
<p>Another advantage of this parameterization is that there is a way to get a good starting value of <span class="math inline">\(x_{\text{mid}}\)</span> when one wants to fit the five-parameters logistic regression model:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1"></a>getInitial1 &lt;-<span class="st"> </span><span class="cf">function</span>(x, y){</span>
<span id="cb4-2"><a href="#cb4-2"></a>  s &lt;-<span class="st"> </span><span class="kw">getInitial</span>(y <span class="op">~</span><span class="st"> </span><span class="kw">SSfpl</span>(x, A, D, xmid, inverseB),</span>
<span id="cb4-3"><a href="#cb4-3"></a>             <span class="dt">data =</span> <span class="kw">data.frame</span>(<span class="dt">x =</span> x, <span class="dt">y =</span> y))</span>
<span id="cb4-4"><a href="#cb4-4"></a>  <span class="kw">c</span>(<span class="dt">A =</span> s[[<span class="st">&quot;A&quot;</span>]], </span>
<span id="cb4-5"><a href="#cb4-5"></a>    <span class="dt">B =</span> <span class="dv">1</span><span class="op">/</span>s[[<span class="st">&quot;inverseB&quot;</span>]], </span>
<span id="cb4-6"><a href="#cb4-6"></a>    <span class="dt">xmid =</span> s[[<span class="st">&quot;xmid&quot;</span>]], </span>
<span id="cb4-7"><a href="#cb4-7"></a>    <span class="dt">D =</span> s[[<span class="st">&quot;D&quot;</span>]], </span>
<span id="cb4-8"><a href="#cb4-8"></a>    <span class="dt">S =</span> <span class="dv">1</span>)</span>
<span id="cb4-9"><a href="#cb4-9"></a>}</span></code></pre></div>
<p>I don’t know how to get a good starting value for <span class="math inline">\(S\)</span>, so I always take <span class="math inline">\(1\)</span>.</p>
<p>Sometimes, <code>SSfpl</code> can fail. Here is another function which returns some starting values:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1"></a>getInitial2 &lt;-<span class="st"> </span><span class="cf">function</span>(x, y){</span>
<span id="cb5-2"><a href="#cb5-2"></a>  NAs &lt;-<span class="st"> </span><span class="kw">union</span>(<span class="kw">which</span>(<span class="kw">is.na</span>(x)), <span class="kw">which</span>(<span class="kw">is.na</span>(y)))</span>
<span id="cb5-3"><a href="#cb5-3"></a>  <span class="cf">if</span>(<span class="kw">length</span>(NAs)){</span>
<span id="cb5-4"><a href="#cb5-4"></a>    x &lt;-<span class="st"> </span>x[<span class="op">-</span>NAs]</span>
<span id="cb5-5"><a href="#cb5-5"></a>    y &lt;-<span class="st"> </span>y[<span class="op">-</span>NAs]</span>
<span id="cb5-6"><a href="#cb5-6"></a>  }</span>
<span id="cb5-7"><a href="#cb5-7"></a>  low_init &lt;-<span class="st"> </span><span class="kw">min</span>(y)</span>
<span id="cb5-8"><a href="#cb5-8"></a>  high_init &lt;-<span class="st"> </span><span class="kw">max</span>(y)</span>
<span id="cb5-9"><a href="#cb5-9"></a>  minmax &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="kw">which</span>(y <span class="op">==</span><span class="st"> </span>low_init), <span class="kw">which</span>(y <span class="op">==</span><span class="st"> </span>high_init))</span>
<span id="cb5-10"><a href="#cb5-10"></a>  X &lt;-<span class="st"> </span><span class="kw">cbind</span>(<span class="dv">1</span>, x[<span class="op">-</span>minmax])</span>
<span id="cb5-11"><a href="#cb5-11"></a>  Y &lt;-<span class="st"> </span><span class="kw">log</span>((high_init<span class="op">-</span>y[<span class="op">-</span>minmax])<span class="op">/</span>(y[<span class="op">-</span>minmax]<span class="op">-</span>low_init))</span>
<span id="cb5-12"><a href="#cb5-12"></a>  fit &lt;-<span class="st"> </span><span class="kw">lm.fit</span>(<span class="dt">x =</span> X, <span class="dt">y =</span> Y)</span>
<span id="cb5-13"><a href="#cb5-13"></a>  b_init &lt;-<span class="st"> </span>fit<span class="op">$</span>coefficients[[<span class="dv">2</span>]]</span>
<span id="cb5-14"><a href="#cb5-14"></a>  xmid_init &lt;-<span class="st"> </span><span class="op">-</span>fit<span class="op">$</span>coefficients[[<span class="dv">1</span>]] <span class="op">/</span><span class="st"> </span>b_init</span>
<span id="cb5-15"><a href="#cb5-15"></a>  <span class="cf">if</span>(b_init <span class="op">&lt;</span><span class="st"> </span><span class="dv">0</span>){</span>
<span id="cb5-16"><a href="#cb5-16"></a>    b_init &lt;-<span class="st"> </span><span class="op">-</span>b_init</span>
<span id="cb5-17"><a href="#cb5-17"></a>    A &lt;-<span class="st"> </span>low_init</span>
<span id="cb5-18"><a href="#cb5-18"></a>    D &lt;-<span class="st"> </span>high_init</span>
<span id="cb5-19"><a href="#cb5-19"></a>  }<span class="cf">else</span>{</span>
<span id="cb5-20"><a href="#cb5-20"></a>    A &lt;-<span class="st"> </span>high_init</span>
<span id="cb5-21"><a href="#cb5-21"></a>    D &lt;-<span class="st"> </span>low_init</span>
<span id="cb5-22"><a href="#cb5-22"></a>  }</span>
<span id="cb5-23"><a href="#cb5-23"></a>  <span class="kw">c</span>(<span class="dt">A =</span> A, <span class="dt">B =</span> b_init, <span class="dt">xmid =</span> xmid_init, <span class="dt">D =</span> D, <span class="dt">S =</span> <span class="dv">1</span>)</span>
<span id="cb5-24"><a href="#cb5-24"></a>}</span></code></pre></div>
<p>Now we wrap these two functions into a single one:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1"></a>getInitial5PL &lt;-<span class="st"> </span><span class="cf">function</span>(x, y){</span>
<span id="cb6-2"><a href="#cb6-2"></a>  <span class="kw">tryCatch</span>({</span>
<span id="cb6-3"><a href="#cb6-3"></a>    <span class="kw">getInitial1</span>(x, y)</span>
<span id="cb6-4"><a href="#cb6-4"></a>  }, <span class="dt">error =</span> <span class="cf">function</span>(e){</span>
<span id="cb6-5"><a href="#cb6-5"></a>    <span class="kw">getInitial2</span>(x, y)</span>
<span id="cb6-6"><a href="#cb6-6"></a>  })</span>
<span id="cb6-7"><a href="#cb6-7"></a>}</span></code></pre></div>
<p>And finally we can write a function for the fitting:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1"></a><span class="kw">library</span>(minpack.lm)</span>
<span id="cb7-2"><a href="#cb7-2"></a>fit5pl &lt;-<span class="st"> </span><span class="cf">function</span>(x, y){</span>
<span id="cb7-3"><a href="#cb7-3"></a>  startingValues &lt;-<span class="st"> </span><span class="kw">getInitial5PL</span>(x, y)</span>
<span id="cb7-4"><a href="#cb7-4"></a>  fit &lt;-<span class="st"> </span><span class="kw">tryCatch</span>({</span>
<span id="cb7-5"><a href="#cb7-5"></a>    <span class="kw">nlsLM</span>(</span>
<span id="cb7-6"><a href="#cb7-6"></a>      y <span class="op">~</span><span class="st"> </span>A <span class="op">+</span><span class="st"> </span>(D<span class="op">-</span>A)<span class="op">/</span>(<span class="dv">1</span> <span class="op">+</span><span class="st"> </span><span class="kw">exp</span>(<span class="kw">log</span>(<span class="dv">2</span><span class="op">^</span>(<span class="dv">1</span><span class="op">/</span>S)<span class="op">-</span><span class="dv">1</span>) <span class="op">+</span><span class="st"> </span>B<span class="op">*</span>(xmid<span class="op">-</span>x)))<span class="op">^</span>S,</span>
<span id="cb7-7"><a href="#cb7-7"></a>      <span class="dt">data =</span> <span class="kw">data.frame</span>(<span class="dt">x =</span> x, <span class="dt">y =</span> y),</span>
<span id="cb7-8"><a href="#cb7-8"></a>      <span class="dt">start =</span> startingValues,</span>
<span id="cb7-9"><a href="#cb7-9"></a>      <span class="dt">lower =</span> <span class="kw">c</span>(<span class="op">-</span><span class="ot">Inf</span>, <span class="dv">0</span>, <span class="op">-</span><span class="ot">Inf</span>, <span class="op">-</span><span class="ot">Inf</span>, <span class="dv">0</span>),</span>
<span id="cb7-10"><a href="#cb7-10"></a>      <span class="dt">control =</span> <span class="kw">nls.lm.control</span>(<span class="dt">maxiter =</span> <span class="dv">1024</span>, <span class="dt">maxfev=</span><span class="dv">10000</span>))</span>
<span id="cb7-11"><a href="#cb7-11"></a>  }, <span class="dt">error =</span> <span class="cf">function</span>(e){</span>
<span id="cb7-12"><a href="#cb7-12"></a>    <span class="kw">paste0</span>(<span class="st">&quot;Failure of model fitting: &quot;</span>, e<span class="op">$</span>message)</span>
<span id="cb7-13"><a href="#cb7-13"></a>  })</span>
<span id="cb7-14"><a href="#cb7-14"></a>  <span class="cf">if</span>(<span class="kw">class</span>(fit) <span class="op">==</span><span class="st"> &quot;nls&quot;</span> <span class="op">&amp;&amp;</span><span class="st"> </span>fit[[<span class="st">&quot;convInfo&quot;</span>]][[<span class="st">&quot;isConv&quot;</span>]]){</span>
<span id="cb7-15"><a href="#cb7-15"></a>    fit</span>
<span id="cb7-16"><a href="#cb7-16"></a>  }<span class="cf">else</span> <span class="cf">if</span>(<span class="kw">class</span>(fit) <span class="op">==</span><span class="st"> &quot;nls&quot;</span> <span class="op">&amp;&amp;</span><span class="st"> </span><span class="op">!</span>fit[[<span class="st">&quot;convInfo&quot;</span>]][[<span class="st">&quot;isConv&quot;</span>]]){</span>
<span id="cb7-17"><a href="#cb7-17"></a>    <span class="st">&quot;Convergence not achieved&quot;</span></span>
<span id="cb7-18"><a href="#cb7-18"></a>  }<span class="cf">else</span>{ <span class="co"># in this case, &#39;fit&#39; is the error message</span></span>
<span id="cb7-19"><a href="#cb7-19"></a>    fit</span>
<span id="cb7-20"><a href="#cb7-20"></a>  }</span>
<span id="cb7-21"><a href="#cb7-21"></a>}</span></code></pre></div>
<p>Let’s try it on a couple of simulated samples:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1"></a><span class="kw">set.seed</span>(<span class="dv">666</span>)</span>
<span id="cb8-2"><a href="#cb8-2"></a>nsims &lt;-<span class="st"> </span><span class="dv">25</span></span>
<span id="cb8-3"><a href="#cb8-3"></a>epsilon &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">rnorm</span>(nsims<span class="op">*</span>n, <span class="dv">0</span>, <span class="dv">5</span>), <span class="dt">nrow =</span> nsims, <span class="dt">ncol =</span> n)</span>
<span id="cb8-4"><a href="#cb8-4"></a>estimates &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="ot">NA_real_</span>, <span class="dt">nrow =</span> nsims, <span class="dt">ncol =</span> <span class="dv">5</span>)</span>
<span id="cb8-5"><a href="#cb8-5"></a><span class="kw">colnames</span>(estimates) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;A&quot;</span>, <span class="st">&quot;B&quot;</span>, <span class="st">&quot;xmid&quot;</span>, <span class="st">&quot;D&quot;</span>, <span class="st">&quot;S&quot;</span>)</span>
<span id="cb8-6"><a href="#cb8-6"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>nsims){</span>
<span id="cb8-7"><a href="#cb8-7"></a>  fit &lt;-<span class="st"> </span><span class="kw">fit5pl</span>(x, y0 <span class="op">+</span><span class="st"> </span>epsilon[i,])</span>
<span id="cb8-8"><a href="#cb8-8"></a>  <span class="cf">if</span>(<span class="kw">class</span>(fit) <span class="op">==</span><span class="st"> &quot;nls&quot;</span>){</span>
<span id="cb8-9"><a href="#cb8-9"></a>    estimates[i, ] &lt;-<span class="st"> </span><span class="kw">coef</span>(fit)</span>
<span id="cb8-10"><a href="#cb8-10"></a>  }<span class="cf">else</span>{</span>
<span id="cb8-11"><a href="#cb8-11"></a>    estimates[i, ] &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="ot">NaN</span>, <span class="ot">NaN</span>, <span class="ot">NaN</span>, <span class="ot">NaN</span>, <span class="ot">NaN</span>)</span>
<span id="cb8-12"><a href="#cb8-12"></a>  }</span>
<span id="cb8-13"><a href="#cb8-13"></a>}</span>
<span id="cb8-14"><a href="#cb8-14"></a><span class="kw">summary</span>(estimates)</span></code></pre></div>
<pre><code>##        A               B               xmid             D         
##  Min.   :24.19   Min.   :0.8918   Min.   :52.52   Min.   : 98.63  
##  1st Qu.:27.99   1st Qu.:0.9566   1st Qu.:52.58   1st Qu.: 99.71  
##  Median :29.54   Median :1.0121   Median :52.64   Median :100.31  
##  Mean   :29.22   Mean   :1.0367   Mean   :52.63   Mean   :100.22  
##  3rd Qu.:30.18   3rd Qu.:1.1207   3rd Qu.:52.67   3rd Qu.:100.64  
##  Max.   :32.23   Max.   :1.2599   Max.   :52.76   Max.   :101.80  
##        S           
##  Min.   :   1.001  
##  1st Qu.:   2.262  
##  Median :  36.444  
##  Mean   :1357.639  
##  3rd Qu.:2003.601  
##  Max.   :7261.694</code></pre>
<p>The estimate of <span class="math inline">\(x_{\text{mid}}\)</span> is excellent. As you can see, the estimate of <span class="math inline">\(S\)</span> is sometimes much larger than the true value. Let’s have a look at the worst case:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1"></a>i0 &lt;-<span class="st"> </span><span class="kw">match</span>(<span class="kw">max</span>(estimates[, <span class="st">&quot;S&quot;</span>]), estimates[, <span class="st">&quot;S&quot;</span>])</span>
<span id="cb10-2"><a href="#cb10-2"></a>estimates[i0, ]</span>
<span id="cb10-3"><a href="#cb10-3"></a><span class="co">##            A            B         xmid            D            S </span></span>
<span id="cb10-4"><a href="#cb10-4"></a><span class="co">##   29.9159582    0.8917679   52.5992848  100.0519760 7261.6944532</span></span></code></pre></div>
<div class="sourceCode" id="cb11"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1"></a><span class="co"># sample</span></span>
<span id="cb11-2"><a href="#cb11-2"></a><span class="kw">par</span>(<span class="dt">mar =</span> <span class="kw">c</span>(<span class="dv">4</span>, <span class="dv">4</span>, <span class="fl">0.5</span>, <span class="dv">1</span>))</span>
<span id="cb11-3"><a href="#cb11-3"></a><span class="kw">plot</span>(x, y0 <span class="op">+</span><span class="st"> </span>epsilon[i0, ], <span class="dt">col =</span> <span class="st">&quot;yellow&quot;</span>, <span class="dt">cex.axis =</span> <span class="fl">0.6</span>)</span>
<span id="cb11-4"><a href="#cb11-4"></a><span class="co"># true curve</span></span>
<span id="cb11-5"><a href="#cb11-5"></a><span class="kw">curve</span>(A <span class="op">+</span><span class="st"> </span>(D<span class="op">-</span>A)<span class="op">/</span>(<span class="dv">1</span> <span class="op">+</span><span class="st"> </span><span class="kw">exp</span>(<span class="kw">log</span>(<span class="dv">2</span><span class="op">^</span>(<span class="dv">1</span><span class="op">/</span>S)<span class="op">-</span><span class="dv">1</span>) <span class="op">+</span><span class="st"> </span>B<span class="op">*</span>(xmid<span class="op">-</span>x)))<span class="op">^</span>S, </span>
<span id="cb11-6"><a href="#cb11-6"></a>      <span class="dt">add =</span> <span class="ot">TRUE</span>, <span class="dt">col =</span> <span class="st">&quot;red&quot;</span>, <span class="dt">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb11-7"><a href="#cb11-7"></a><span class="co"># fitted curve</span></span>
<span id="cb11-8"><a href="#cb11-8"></a><span class="kw">with</span>(<span class="kw">as.list</span>(estimates[i0, ]), </span>
<span id="cb11-9"><a href="#cb11-9"></a>     <span class="kw">curve</span>(A <span class="op">+</span><span class="st"> </span>(D<span class="op">-</span>A)<span class="op">/</span>(<span class="dv">1</span> <span class="op">+</span><span class="st"> </span><span class="kw">exp</span>(<span class="kw">log</span>(<span class="dv">2</span><span class="op">^</span>(<span class="dv">1</span><span class="op">/</span>S)<span class="op">-</span><span class="dv">1</span>) <span class="op">+</span><span class="st"> </span>B<span class="op">*</span>(xmid<span class="op">-</span>x)))<span class="op">^</span>S, </span>
<span id="cb11-10"><a href="#cb11-10"></a>           <span class="dt">add =</span> <span class="ot">TRUE</span>, <span class="dt">col =</span> <span class="st">&quot;blue&quot;</span>, <span class="dt">lwd =</span> <span class="dv">2</span>, <span class="dt">lty =</span> <span class="st">&quot;dashed&quot;</span>)</span>
<span id="cb11-11"><a href="#cb11-11"></a>)</span></code></pre></div>
<p><img src="./figures/5pl-worstcase-1.png" style="display: block; margin: auto;" /></p>
<p>Thus, while the estimate of <span class="math inline">\(S\)</span> is very far from the true value of <span class="math inline">\(S\)</span>, the fitted curve correctly estimates the true curve. And in such cases, the standard error of the estimate of <span class="math inline">\(S\)</span> is big:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1"></a>fit &lt;-<span class="st"> </span><span class="kw">fit5pl</span>(x, y0 <span class="op">+</span><span class="st"> </span>epsilon[i0,])</span>
<span id="cb12-2"><a href="#cb12-2"></a><span class="kw">summary</span>(fit)</span></code></pre></div>
<pre><code>## 
## Formula: y ~ A + (D - A)/(1 + exp(log(2^(1/S) - 1) + B * (xmid - x)))^S
## 
## Parameters:
##       Estimate Std. Error t value Pr(&gt;|t|)    
## A    2.992e+01  1.334e+00  22.424   &lt;2e-16 ***
## B    8.918e-01  7.058e-02  12.635   &lt;2e-16 ***
## xmid 5.260e+01  7.310e-02 719.542   &lt;2e-16 ***
## D    1.001e+02  9.347e-01 107.038   &lt;2e-16 ***
## S    7.262e+03  1.757e+06   0.004    0.997    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 5.224 on 95 degrees of freedom
## 
## Number of iterations to convergence: 27 
## Achieved convergence tolerance: 1.49e-08</code></pre>
<p>Note that <code>nlsLM</code> provides a test of the nullity of <span class="math inline">\(S\)</span>. This is not interesting, whereas the equality <span class="math inline">\(S = 1\)</span> is of interest. So it is better to parametrize the logistic function with <span class="math inline">\(L = \log(S)\)</span> instead of <span class="math inline">\(S\)</span>: <span class="math display">\[
h(x) = 
A + \frac{D-A}{{\biggl(1+\exp\Bigl(\log\bigl(2^{\exp(-L)}-1\bigr) + B(x_{\text{mid}}-x)\Bigr)\biggr)}^{\exp(L)}}.
\]</span> In this way we can get a test of <span class="math inline">\(L = 0\)</span>, that is <span class="math inline">\(S = 1\)</span>.</p>

        </div>


        <div id="footer">
          Site proudly generated by
          <a href="http://jaspervdj.be/hakyll">Hakyll</a>
        </div>

      </div>

    </div>

    <div class="row">
      <div class="col-sm-12">
        <div id="disqus_thread"></div>
        <div class="pagination">
          <ul>
            <li>
              <a href="http://laustep.github.io/stlahblog/">&#171; Back Home</a>
            </li>
          </ul>
        </div>
      </div>
    </div>
    
  </div>

</body>

<script src="/libraries/bootstrap/bootstrap.min.js"></script>
<script>
  var disqus_developer = 1;
  var disqus_shortname = 'stlapblog';
  // required: replace example with your forum shortname
  /* * * DON'T EDIT BELOW THIS LINE * * */
  (function () {
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = 'https://' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] ||
      document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>
<noscript>Please enable JavaScript to view the
  <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a>
</noscript>
<!-- MathJax: Fall back to local if CDN offline but local image fonts are not supported (saves >100MB) -->
<script type="text/x-mathjax-config" src="/libraries/mathjax/config/TeX-MML-AM_CHTML.js"></script>
<!-- <script>
  window.MathJax || document.write('<script type="text/x-mathjax-config">MathJax.Hub.Config({"HTML-CSS":{imageFont:null}});<\/script><script src="../libraries/mathjax/MathJax.js"><\/script>');
</script> -->


</html>]]></description>
    <pubDate>Wed, 20 Nov 2019 00:00:00 UT</pubDate>
    <guid>https://laustep.github.io/stlahblog/posts/5pl.html</guid>
    <dc:creator>Stéphane Laurent</dc:creator>
    <category>R</category>
</item>


<item>
    <title>The Beta distribution of the third kind (or generalised Beta prime)</title>
    <link>https://laustep.github.io/stlahblog/posts/Beta3.html</link>
    <description><![CDATA[<!DOCTYPE HTML>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Saturn Elephant - The Beta distribution of the third kind (or generalised Beta prime)</title>
  <link href="/libraries/bootstrap/bootstrap-grid.min.css" rel="stylesheet">
  <link rel="stylesheet" href="/css/default2.css" />
  <link rel="stylesheet" href="/css/post.css" />
  <link rel="stylesheet" href="/css/misc.css" /> 
  
    <link rel="stylesheet" href="/css/pandoc-solarized.css" /> 
   
  
  <link href="https://fonts.googleapis.com/css?family=Raleway:400,600,200,800" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/css?family=Droid+Sans" rel="stylesheet" type="text/css">
  <script src="/libraries/jquery.min.js"></script>
  <script type="text/javascript" async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML"></script>
</head>

<body>
  <div class="container-fluid">
    <div class="row">
      <!-- Sidebar. -->
      <div class="sidebar col-sm-2">
        <div class="row">
          <div class="col-sm-12" style="float:right;clear:both;margin-right:50px;margin-top:50px;">
            <a href="https://www.r-bloggers.com/">
              <img src="/images/Rbloggers.png" alt="Rbloggers" width="100%" />
            </a>
            <br/>
            <a href="http://t-redactyl.io/">
              <span style="color:black;font-weight:bold;font-family:sans-serif;font-size:25px;">Standard error</span>
            </a>
            <a href="http://timelyportfolio.blogspot.be/">
              <span style="color:grey;font-weight:bold;font-family:sans-serif;font-size:24px;">Timely portfolio</span>
            </a>
            <br/>
            <a href="https://antoineguillot.wordpress.com/blog/">
              <span style="color:white;background-color:darkblue;font-weight:bold;font-family:sans-serif;font-size:21px;border:5px solid;border-color:darkblue">ENHANCE DATA</span>
            </a>
            <br/>
            <a href="https://fronkonstin.com/">
              <span style="color:black;background-color:gold;font-weight:bold;font-size:29px;border:3px solid;border-color:gold;">Fronkonstin</span>
            </a>
          </div>
        </div>
        <div id="logos">
          <div class="row">
            <div class="col-sm-4">
              <img src="/images/AsymptoteLogo.svg" style="width: 150%; transform: rotateZ(-35deg)"/>
            </div>
            <div class="col-sm-4">
              <img src="/images/Rlogo.svg" style="width: 110%;"/>
            </div>
            <div class="col-sm-4">
              <img src="/images/shiny-hex.png" style="width: 90%;"/>
            </div>
          </div>
          <div class="row">
            <div class="col-sm-4">
              <img src="/images/Povray_logo_sphere.png" style="width: 105%;"/>
            </div>
            <div class="col-sm-4">
              <img src="/images/javascript.svg" style="width: 90%;"/>
            </div>
            <div class="col-sm-4">
              <img src="/images/haskell.svg" style="width: 110%;"/>
            </div>
          </div>
        </div>
      </div>

      <div class="main col-sm-10">
        <div id="header">
          <div id="logo">
            <a href="/">
              <img src="/images/stla.jpg" alt="stla" width="100px" />
            </a>
          </div>
          <div id="navigation" style="margin-top:50px;">
            <a href="/">Home</a>
            <a href="/about.html">About</a>
            <a href="/contact.html">Contact</a>
            <a href="/archive.html">Archive</a>
          </div>
        </div>

        <div class="content">
          <h1>The Beta distribution of the third kind (or generalised Beta prime)</h1> 
          <div class="info">
    Posted on July 22, 2019
    
        by Stéphane Laurent
    
</div>
<div class="info">
    
    Tags: <a title="All pages tagged &#39;maths&#39;." href="/tags/maths.html">maths</a>, <a title="All pages tagged &#39;statistics&#39;." href="/tags/statistics.html">statistics</a>, <a title="All pages tagged &#39;R&#39;." href="/tags/R.html">R</a>, <a title="All pages tagged &#39;special-functions&#39;." href="/tags/special-functions.html">special-functions</a>
    
</div>

<ul>
<li><a href="#preliminaries-the-scaled-beta-prime-distribution">Preliminaries: the (scaled) Beta prime distribution</a></li>
<li><a href="#beta-distribution-of-the-third-kind">Beta distribution of the third kind</a></li>
<li><a href="#update-2019-09-05-generalised-beta-distribution">Update 2019-09-05: generalised Beta distribution</a></li>
<li><a href="#cumulative-distribution-function">Cumulative distribution function</a></li>
<li><a href="#sampling-the-beta-distribution-of-the-third-kind">Sampling the Beta distribution of the third kind</a></li>
<li><a href="#application-to-the-bayesian-binomial-model">Application to the Bayesian binomial model</a></li>
<li><a href="#application-to-the-bayesian-two-poisson-samples-model">Application to the Bayesian “two Poisson samples” model</a></li>
</ul>
<p>We present the family of so-called <em>Beta distributions of the third kind</em>. In the context of Bayesian statistics, it is a conjugate family of prior distributions on the odds parameter of the binomial model. This distribution is known, but nobody provided a way to sample from it. We show how one can sample from this distribution in R.</p>
<h1 id="preliminaries-the-scaled-beta-prime-distribution">Preliminaries: the (scaled) Beta prime distribution</h1>
<p>The Beta distribution of the third kind generalizes the Beta distribution of the second kind, also known under the name <em>Beta prime distribution</em>.</p>
<p>The <em>Beta prime distribution</em> <span class="math inline">\(\mathcal{B}&#39;(c,d,\lambda)\)</span> is the distribution of the random variable <span class="math inline">\(\lambda\frac{U}{1-U}\)</span> where <span class="math inline">\(U \sim \mathcal{B}(c,d)\)</span>.</p>
<p>Its density function at <span class="math inline">\(x \geqslant 0\)</span> is <span class="math display">\[
\frac{1}{\lambda^c B(c,d)} 
\frac{x^{c-1}}{\left(1+\frac{x}{\lambda}\right)^{c+d}}.
\]</span> Usually the definition does not include the scale parameter <span class="math inline">\(\lambda\)</span> (that is, it is usually defined for <span class="math inline">\(\lambda=1\)</span> only).</p>
<p>It is easy to implement a sampler for this distribution, the density function and the cumulative density function:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a>rbetaprime &lt;-<span class="st"> </span><span class="cf">function</span>(n, c, d, <span class="dt">lambda =</span> <span class="dv">1</span>){</span>
<span id="cb1-2"><a href="#cb1-2"></a>  <span class="kw">stopifnot</span>(lambda <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>)</span>
<span id="cb1-3"><a href="#cb1-3"></a>  u &lt;-<span class="st"> </span><span class="kw">rbeta</span>(n, c, d)</span>
<span id="cb1-4"><a href="#cb1-4"></a>  lambda <span class="op">*</span><span class="st"> </span>u<span class="op">/</span>(<span class="dv">1</span><span class="op">-</span>u)</span>
<span id="cb1-5"><a href="#cb1-5"></a>}</span>
<span id="cb1-6"><a href="#cb1-6"></a>dbetaprime &lt;-<span class="st"> </span><span class="cf">function</span>(x, c, d, <span class="dt">lambda =</span> <span class="dv">1</span>){</span>
<span id="cb1-7"><a href="#cb1-7"></a>  <span class="kw">stopifnot</span>(lambda <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>)</span>
<span id="cb1-8"><a href="#cb1-8"></a>  lambda<span class="op">/</span>(lambda<span class="op">+</span>x)<span class="op">^</span><span class="dv">2</span> <span class="op">*</span><span class="st"> </span><span class="kw">dbeta</span>(x<span class="op">/</span>lambda<span class="op">/</span>(<span class="dv">1</span><span class="op">+</span>x<span class="op">/</span>lambda), c, d)</span>
<span id="cb1-9"><a href="#cb1-9"></a>}</span>
<span id="cb1-10"><a href="#cb1-10"></a>pbetaprime &lt;-<span class="st"> </span><span class="cf">function</span>(q, c, d, lambda){</span>
<span id="cb1-11"><a href="#cb1-11"></a>  <span class="kw">stopifnot</span>(lambda <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>)</span>
<span id="cb1-12"><a href="#cb1-12"></a>  <span class="kw">pbeta</span>(q<span class="op">/</span>lambda<span class="op">/</span>(<span class="dv">1</span><span class="op">+</span>q<span class="op">/</span>lambda), c, d)</span>
<span id="cb1-13"><a href="#cb1-13"></a>}</span></code></pre></div>
<h1 id="beta-distribution-of-the-third-kind">Beta distribution of the third kind</h1>
<p>The <em>Beta distribution of the third kind</em> <span class="math inline">\(\mathcal{B}_3\)</span> was firstly introduced (as far as I know) in the paper <em>Some Poisson mixtures with a hyperscale parameter</em>, written by myself.</p>
<p>For parameters <span class="math inline">\(c&gt;0\)</span>, <span class="math inline">\(d&gt;0\)</span>, <span class="math inline">\(\kappa \in \mathbb{R}\)</span>, <span class="math inline">\(\tau&gt;0\)</span>, the density function of <span class="math inline">\(\mathcal{B}_3(c,d,\kappa,\tau)\)</span> is <span class="math display">\[
f(\phi) = 
\frac{1}
{B(c,d){}_2\!F_1\left(c, c+d-\kappa, c+d; 1 - \frac{1}{\tau}\right)}
\frac{\phi^{c-1}(1+\phi)^{-\kappa}}
{\left(1+\frac{\phi}{\tau}\right)^{c+d-\kappa}}, 
\quad \phi \geqslant 0.
\]</span> Thus, for <span class="math inline">\(\kappa=0\)</span>, the <span class="math inline">\(\mathcal{B}_3(c,d,\kappa,\tau)\)</span> distribution equals <span class="math inline">\(\mathcal{B}&#39;(c,d,\tau)\)</span>, and for <span class="math inline">\(\kappa = c+d\)</span> or <span class="math inline">\(\tau=1\)</span>, it equals <span class="math inline">\(\mathcal{B}&#39;(c,d,1)\)</span>. Note that in general, <span class="math inline">\(\tau\)</span> is not a scale parameter.</p>
<p>Let’s write a R function computing this density:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1"></a><span class="kw">library</span>(gsl)</span>
<span id="cb2-2"><a href="#cb2-2"></a>Gauss2F1 &lt;-<span class="st"> </span><span class="cf">function</span>(a,b,c,x){ </span>
<span id="cb2-3"><a href="#cb2-3"></a>  <span class="cf">if</span>(x<span class="op">&gt;=</span><span class="dv">0</span> <span class="op">&amp;&amp;</span><span class="st"> </span>x<span class="op">&lt;</span><span class="dv">1</span>){ <span class="co"># hyperg_2F1 works fine in this situation</span></span>
<span id="cb2-4"><a href="#cb2-4"></a>    <span class="kw">hyperg_2F1</span>(a, b, c, x)</span>
<span id="cb2-5"><a href="#cb2-5"></a>  }<span class="cf">else</span>{ <span class="co"># transform to come down to the first situation</span></span>
<span id="cb2-6"><a href="#cb2-6"></a>    <span class="kw">hyperg_2F1</span>(c<span class="op">-</span>a, b, c, <span class="dv">1-1</span><span class="op">/</span>(<span class="dv">1</span><span class="op">-</span>x)) <span class="op">/</span><span class="st"> </span>(<span class="dv">1</span><span class="op">-</span>x)<span class="op">^</span>b</span>
<span id="cb2-7"><a href="#cb2-7"></a>  }</span>
<span id="cb2-8"><a href="#cb2-8"></a>}</span>
<span id="cb2-9"><a href="#cb2-9"></a>dB3 &lt;-<span class="st"> </span><span class="cf">function</span>(x, c, d, kappa, tau){</span>
<span id="cb2-10"><a href="#cb2-10"></a>  <span class="kw">stopifnot</span>(c <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>, d <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>, tau <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>)</span>
<span id="cb2-11"><a href="#cb2-11"></a>  <span class="cf">if</span>(kappa <span class="op">==</span><span class="st"> </span><span class="dv">0</span>){</span>
<span id="cb2-12"><a href="#cb2-12"></a>    <span class="kw">dbetaprime</span>(x, c, d, tau)</span>
<span id="cb2-13"><a href="#cb2-13"></a>  }<span class="cf">else</span> <span class="cf">if</span>(kappa <span class="op">==</span><span class="st"> </span>c<span class="op">+</span>d){</span>
<span id="cb2-14"><a href="#cb2-14"></a>    <span class="kw">dbetaprime</span>(x, c, d, <span class="dv">1</span>)</span>
<span id="cb2-15"><a href="#cb2-15"></a>  }<span class="cf">else</span>{</span>
<span id="cb2-16"><a href="#cb2-16"></a>    <span class="dv">1</span><span class="op">/</span><span class="kw">beta</span>(c,d) <span class="op">*</span><span class="st"> </span>x<span class="op">^</span>(c<span class="dv">-1</span>)<span class="op">*</span>(<span class="dv">1</span><span class="op">+</span>x)<span class="op">^</span>(<span class="op">-</span>kappa)<span class="op">/</span>(<span class="dv">1</span><span class="op">+</span>x<span class="op">/</span>tau)<span class="op">^</span>(c<span class="op">+</span>d<span class="op">-</span>kappa) <span class="op">/</span><span class="st"> </span></span>
<span id="cb2-17"><a href="#cb2-17"></a><span class="st">      </span><span class="kw">Gauss2F1</span>(c, c<span class="op">+</span>d<span class="op">-</span>kappa, c<span class="op">+</span>d, <span class="dv">1-1</span><span class="op">/</span>tau)</span>
<span id="cb2-18"><a href="#cb2-18"></a>  }</span>
<span id="cb2-19"><a href="#cb2-19"></a>}</span></code></pre></div>
<p>This distribution is related to the <em>four-parameter generalized Beta distribution</em> introduced by Chen &amp; Novick in the paper <em>Bayesian analysis for binomial models with generalized beta prior distributions</em> (1984); this distribution takes its value in <span class="math inline">\([0,1]\)</span>. They are related by an elementary transformation: <span class="math display">\[
\Theta \sim GB4(c, d, \kappa, \tau) \quad \iff\quad 
\frac{\Theta}{1-\Theta} \sim 
\mathcal{B}_3\left(c, d, c+d-\kappa, \frac{1}{\tau}\right).
\]</span></p>
<h1 id="update-2019-09-05-generalised-beta-distribution">Update 2019-09-05: generalised Beta distribution</h1>
<p>I’ve just discovered that the <span class="math inline">\(GB4\)</span> distribution appears in the paper <em>On Kummer’s distributions of type two and generalized Beta distributions</em> written by Hamza &amp; Vallois. It is named <em>generalised Beta distribution</em> in this paper, it is denoted by <span class="math inline">\(\beta_\delta(a,b,c)\)</span> and its density function at <span class="math inline">\(u \in [0,1]\)</span> is given by <span class="math display">\[
\frac{1}{\beta(a,b){}_2\!F_1(-c,a;a+b;1-\delta)}
u^{a-1}(1-u)^{b-1}\bigl(1+(\delta-1)u\bigr)^c
\]</span> for <span class="math inline">\(a,b,\delta&gt;0\)</span> and <span class="math inline">\(c \in \mathbb{R}\)</span>.</p>
<p>We have the following relation: if <span class="math inline">\(\Phi \sim \mathcal{B}_3(c, d, \kappa, \tau)\)</span>, then <span class="math display">\[
\frac{\Phi}{1+\Phi} \sim \beta_{\frac{1}{\tau}}(c, d, \kappa-c-d).
\]</span></p>
<p>So, maybe a better name for <span class="math inline">\(\mathcal{B}_3\)</span> would be <em>generalised Beta prime distribution</em>.</p>
<h1 id="cumulative-distribution-function">Cumulative distribution function</h1>
<p>The cumulative distribution function of <span class="math inline">\(\mathcal{B}_3\)</span> involves the <em>Appell hypergeometric function</em> <span class="math inline">\(F_1\)</span>. A Fortran implementation of this function is available in the R package <code>appell</code>. This package has been removed from CRAN, but you can still install it. If <span class="math inline">\(\Phi \sim \mathcal{B}_3(c,d,\kappa,\tau)\)</span>, then, for <span class="math inline">\(q \geqslant 0\)</span>, <span class="math display">\[
\Pr(\Phi \leqslant q) = 
\frac{q^c F_1\left(c; \kappa, c+d-\kappa; c+1; -q, -\frac{q}{\tau}\right)}
{cB(c,d){}_2\!F_1\left(c, c+d-\kappa, c+d; 1 - \frac{1}{\tau}\right)}.
\]</span> Here is a R implementation. I found that it works well with the option <code>userflag = 0</code> of the <code>appellf1</code> function.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a>pB3 &lt;-<span class="st"> </span><span class="cf">function</span>(q, c, d, kappa, tau, <span class="dt">userflag =</span> <span class="dv">0</span>){</span>
<span id="cb3-2"><a href="#cb3-2"></a>  <span class="kw">stopifnot</span>(c <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>, d <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>, tau <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>)</span>
<span id="cb3-3"><a href="#cb3-3"></a>  <span class="cf">if</span>(kappa <span class="op">==</span><span class="st"> </span><span class="dv">0</span>){</span>
<span id="cb3-4"><a href="#cb3-4"></a>    <span class="kw">pbetaprime</span>(q, c, d, tau)</span>
<span id="cb3-5"><a href="#cb3-5"></a>  }<span class="cf">else</span> <span class="cf">if</span>(kappa <span class="op">==</span><span class="st"> </span>c<span class="op">+</span>d){</span>
<span id="cb3-6"><a href="#cb3-6"></a>    <span class="kw">pbetaprime</span>(q, c, d, <span class="dv">1</span>)</span>
<span id="cb3-7"><a href="#cb3-7"></a>  }<span class="cf">else</span>{</span>
<span id="cb3-8"><a href="#cb3-8"></a>    C &lt;-<span class="st"> </span><span class="kw">beta</span>(c,d) <span class="op">*</span><span class="st"> </span><span class="kw">Gauss2F1</span>(c, c<span class="op">+</span>d<span class="op">-</span>kappa, c<span class="op">+</span>d, <span class="dv">1-1</span><span class="op">/</span>tau)</span>
<span id="cb3-9"><a href="#cb3-9"></a>    Appell &lt;-<span class="st"> </span></span>
<span id="cb3-10"><a href="#cb3-10"></a><span class="st">      </span>appell<span class="op">::</span><span class="kw">appellf1</span>(c, kappa, c<span class="op">+</span>d<span class="op">-</span>kappa, c<span class="op">+</span><span class="dv">1</span>, <span class="op">-</span>q, <span class="op">-</span>q<span class="op">/</span>tau, </span>
<span id="cb3-11"><a href="#cb3-11"></a>                       <span class="dt">userflag =</span> userflag)</span>
<span id="cb3-12"><a href="#cb3-12"></a>    q<span class="op">^</span>c<span class="op">/</span>c <span class="op">*</span><span class="st"> </span><span class="kw">Re</span>(Appell<span class="op">$</span>val) <span class="op">/</span><span class="st"> </span>C</span>
<span id="cb3-13"><a href="#cb3-13"></a>  }</span>
<span id="cb3-14"><a href="#cb3-14"></a>}</span></code></pre></div>
<h1 id="sampling-the-beta-distribution-of-the-third-kind">Sampling the Beta distribution of the third kind</h1>
<p>It is not very easy to sample the <span class="math inline">\(\mathcal{B}_3\)</span> distribution. In her <a href="https://savoirs.usherbrooke.ca/bitstream/handle/11143/9640/Chabot_Myriam_MSc_2016.pdf">master thesis</a>, Myriam Chabot proved that it can be represented as a discrete mixture of <span class="math inline">\(\mathcal{B}_2\)</span> distributions, and we will use this result.</p>
<p>This result is the following one.</p>
<ul>
<li><p>For <span class="math inline">\(\tau &lt; 1\)</span>, let <span class="math inline">\(K\)</span> be a random variable on <span class="math inline">\(\mathbb{N}\)</span> whose probability mass at <span class="math inline">\(k\in\mathbb{N}\)</span> is given by <span class="math display">\[
\frac{1}{{}_2\!F_1(d, c+d-\kappa, c+d, 1-\tau)}
\frac{(1-\tau)^k}{k!}
\frac{{(c+d-\kappa)}_k{(d)}_k}{{(c+d)}_k}
\]</span> and let <span class="math inline">\(\Phi\)</span> be a random variable such that <span class="math display">\[
(\Phi \mid K=k) \sim \mathcal{B}&#39;(c, d+k, 1).
\]</span> Then <span class="math inline">\(\Phi \sim \mathcal{B}_3(c,d,\kappa,\tau)\)</span>.</p></li>
<li><p>For <span class="math inline">\(\tau &gt; 1\)</span>, let <span class="math inline">\(K\)</span> be a random variable on <span class="math inline">\(\mathbb{N}\)</span> whose probability mass at <span class="math inline">\(k\in\mathbb{N}\)</span> is given by <span class="math display">\[
\frac{1}{{}_2\!F_1\left(c, c+d-\kappa, c+d, 1-\frac{1}{\tau}\right)}
\frac{\left(1-\frac{1}{\tau}\right)^k}{k!}
\frac{{(c+d-\kappa)}_k{(c)}_k}{{(c+d)}_k}
\]</span> and let <span class="math inline">\(\Phi\)</span> be a random variable such that <span class="math display">\[
(\Phi \mid K=k) \sim \mathcal{B}&#39;(c+k, d, 1).
\]</span> Then <span class="math inline">\(\Phi \sim \mathcal{B}_3(c,d,\kappa,\tau)\)</span>.</p></li>
</ul>
<p>So we can sample <span class="math inline">\(\mathcal{B}_3(c,d,\kappa,\tau)\)</span> if we are able to sample these discrete distributions. To do so, we use the <code>Runuran</code> package.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1"></a><span class="kw">library</span>(Runuran)</span>
<span id="cb4-2"><a href="#cb4-2"></a>pmf_unnormalized &lt;-<span class="st"> </span><span class="cf">function</span>(k, c, d, kappa, tau){</span>
<span id="cb4-3"><a href="#cb4-3"></a>  out &lt;-<span class="st"> </span><span class="kw">numeric</span>(<span class="kw">length</span>(k))</span>
<span id="cb4-4"><a href="#cb4-4"></a>  positive &lt;-<span class="st"> </span>k <span class="op">&gt;=</span><span class="st"> </span><span class="dv">0</span></span>
<span id="cb4-5"><a href="#cb4-5"></a>  k &lt;-<span class="st"> </span>k[positive]</span>
<span id="cb4-6"><a href="#cb4-6"></a>  out[positive] &lt;-<span class="st"> </span></span>
<span id="cb4-7"><a href="#cb4-7"></a><span class="st">    </span><span class="cf">if</span>(tau <span class="op">&lt;</span><span class="st"> </span><span class="dv">1</span>){</span>
<span id="cb4-8"><a href="#cb4-8"></a>      <span class="kw">exp</span>(k<span class="op">*</span><span class="kw">log</span>(<span class="dv">1</span><span class="op">-</span>tau) <span class="op">-</span><span class="st"> </span><span class="kw">lfactorial</span>(k) <span class="op">+</span><span class="st"> </span></span>
<span id="cb4-9"><a href="#cb4-9"></a><span class="st">            </span><span class="kw">lnpoch</span>(c<span class="op">+</span>d<span class="op">-</span>kappa,k) <span class="op">+</span><span class="st"> </span><span class="kw">lnpoch</span>(d,k) <span class="op">-</span><span class="st"> </span><span class="kw">lnpoch</span>(c<span class="op">+</span>d,k)) </span>
<span id="cb4-10"><a href="#cb4-10"></a>    }<span class="cf">else</span>{</span>
<span id="cb4-11"><a href="#cb4-11"></a>      <span class="kw">exp</span>(k<span class="op">*</span><span class="kw">log</span>(<span class="dv">1-1</span><span class="op">/</span>tau) <span class="op">-</span><span class="st"> </span><span class="kw">lfactorial</span>(k) <span class="op">+</span><span class="st"> </span></span>
<span id="cb4-12"><a href="#cb4-12"></a><span class="st">            </span><span class="kw">lnpoch</span>(c<span class="op">+</span>d<span class="op">-</span>kappa,k) <span class="op">+</span><span class="st"> </span><span class="kw">lnpoch</span>(c,k) <span class="op">-</span><span class="st"> </span><span class="kw">lnpoch</span>(c<span class="op">+</span>d,k))</span>
<span id="cb4-13"><a href="#cb4-13"></a>    }</span>
<span id="cb4-14"><a href="#cb4-14"></a>  out</span>
<span id="cb4-15"><a href="#cb4-15"></a>}</span>
<span id="cb4-16"><a href="#cb4-16"></a>NormalizingConstant &lt;-<span class="st"> </span><span class="cf">function</span>(c, d, kappa, tau){</span>
<span id="cb4-17"><a href="#cb4-17"></a>  <span class="cf">if</span>(tau <span class="op">&lt;</span><span class="st"> </span><span class="dv">1</span>){</span>
<span id="cb4-18"><a href="#cb4-18"></a>    <span class="kw">hyperg_2F1</span>(d, c<span class="op">+</span>d<span class="op">-</span>kappa, c<span class="op">+</span>d, <span class="dv">1</span><span class="op">-</span>tau) </span>
<span id="cb4-19"><a href="#cb4-19"></a>  }<span class="cf">else</span>{</span>
<span id="cb4-20"><a href="#cb4-20"></a>    <span class="kw">hyperg_2F1</span>(c, c<span class="op">+</span>d<span class="op">-</span>kappa, c<span class="op">+</span>d, <span class="dv">1-1</span><span class="op">/</span>tau) </span>
<span id="cb4-21"><a href="#cb4-21"></a>  }</span>
<span id="cb4-22"><a href="#cb4-22"></a>}</span>
<span id="cb4-23"><a href="#cb4-23"></a>Ksampler &lt;-<span class="st"> </span><span class="cf">function</span>(n, c, d, kappa, tau){</span>
<span id="cb4-24"><a href="#cb4-24"></a>  dist &lt;-<span class="st"> </span><span class="kw">unuran.discr.new</span>(</span>
<span id="cb4-25"><a href="#cb4-25"></a>    <span class="dt">pmf =</span> <span class="cf">function</span>(k) <span class="kw">pmf_unnormalized</span>(k, c, d, kappa, tau),</span>
<span id="cb4-26"><a href="#cb4-26"></a>    <span class="dt">lb =</span> <span class="dv">0</span>, <span class="dt">ub=</span> <span class="ot">Inf</span>, <span class="dt">sum =</span> <span class="kw">NormalizingConstant</span>(c, d, kappa, tau)</span>
<span id="cb4-27"><a href="#cb4-27"></a>  )</span>
<span id="cb4-28"><a href="#cb4-28"></a>  unuran &lt;-<span class="st"> </span><span class="kw">unuran.new</span>(dist, <span class="dt">method=</span><span class="st">&quot;dgt&quot;</span>) </span>
<span id="cb4-29"><a href="#cb4-29"></a>  <span class="kw">ur</span>(unuran, n)</span>
<span id="cb4-30"><a href="#cb4-30"></a>}</span>
<span id="cb4-31"><a href="#cb4-31"></a>rB3 &lt;-<span class="st"> </span><span class="cf">function</span>(n, c, d, kappa, tau){</span>
<span id="cb4-32"><a href="#cb4-32"></a>  <span class="kw">stopifnot</span>(c <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>, d <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>, tau <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>)</span>
<span id="cb4-33"><a href="#cb4-33"></a>  <span class="cf">if</span>(tau <span class="op">==</span><span class="st"> </span><span class="dv">1</span> <span class="op">||</span><span class="st"> </span>kappa <span class="op">==</span><span class="st"> </span>c<span class="op">+</span>d){</span>
<span id="cb4-34"><a href="#cb4-34"></a>    <span class="kw">rbetaprime</span>(n, c, d, <span class="dv">1</span>)</span>
<span id="cb4-35"><a href="#cb4-35"></a>  }<span class="cf">else</span> <span class="cf">if</span>(kappa <span class="op">==</span><span class="st"> </span><span class="dv">0</span>){</span>
<span id="cb4-36"><a href="#cb4-36"></a>    <span class="kw">rbetaprime</span>(n, c, d, tau)</span>
<span id="cb4-37"><a href="#cb4-37"></a>  }<span class="cf">else</span>{</span>
<span id="cb4-38"><a href="#cb4-38"></a>    K &lt;-<span class="st"> </span><span class="kw">Ksampler</span>(n, c, d, kappa, tau)</span>
<span id="cb4-39"><a href="#cb4-39"></a>    <span class="cf">if</span>(tau <span class="op">&lt;</span><span class="st"> </span><span class="dv">1</span>){</span>
<span id="cb4-40"><a href="#cb4-40"></a>      <span class="kw">rbetaprime</span>(n, c, d <span class="op">+</span><span class="st"> </span>K, <span class="dv">1</span>)</span>
<span id="cb4-41"><a href="#cb4-41"></a>    }<span class="cf">else</span>{</span>
<span id="cb4-42"><a href="#cb4-42"></a>      <span class="kw">rbetaprime</span>(n, c <span class="op">+</span><span class="st"> </span>K, d, <span class="dv">1</span>)</span>
<span id="cb4-43"><a href="#cb4-43"></a>    }</span>
<span id="cb4-44"><a href="#cb4-44"></a>  }</span>
<span id="cb4-45"><a href="#cb4-45"></a>}</span></code></pre></div>
<p>Let’s check. The density:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1"></a>c &lt;-<span class="st"> </span><span class="dv">2</span>; d &lt;-<span class="st"> </span><span class="dv">3</span>; kappa &lt;-<span class="st"> </span><span class="dv">4</span>; tau &lt;-<span class="st"> </span><span class="dv">5</span></span>
<span id="cb5-2"><a href="#cb5-2"></a>nsims &lt;-<span class="st"> </span><span class="dv">1000000</span></span>
<span id="cb5-3"><a href="#cb5-3"></a>sims &lt;-<span class="st"> </span><span class="kw">rB3</span>(nsims, c, d, kappa, tau)</span>
<span id="cb5-4"><a href="#cb5-4"></a><span class="kw">plot</span>(<span class="kw">density</span>(sims, <span class="dt">from =</span> <span class="dv">0</span>, <span class="dt">to =</span> <span class="kw">quantile</span>(sims, <span class="fl">0.95</span>)))</span>
<span id="cb5-5"><a href="#cb5-5"></a><span class="kw">curve</span>(<span class="kw">dB3</span>(x, c, d, kappa, tau), <span class="dt">add =</span> <span class="ot">TRUE</span>, <span class="dt">col =</span> <span class="st">&quot;red&quot;</span>, </span>
<span id="cb5-6"><a href="#cb5-6"></a>      <span class="dt">lty =</span> <span class="st">&quot;dashed&quot;</span>, <span class="dt">lwd =</span> <span class="dv">2</span>)</span></code></pre></div>
<p><img src="figures/Beta3-density-1.png" /></p>
<p>The cumulative distribution function:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1"></a>q &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="fl">0.1</span>, <span class="dv">4</span>, <span class="dt">length.out =</span> <span class="dv">10</span>)[<span class="op">-</span><span class="dv">6</span>]</span>
<span id="cb6-2"><a href="#cb6-2"></a>cdfValues &lt;-<span class="st"> </span><span class="kw">sapply</span>(q, <span class="cf">function</span>(x) <span class="kw">pB3</span>(x, c, d, kappa, tau))</span>
<span id="cb6-3"><a href="#cb6-3"></a>empirical_cdf &lt;-<span class="st"> </span><span class="kw">ecdf</span>(sims)</span>
<span id="cb6-4"><a href="#cb6-4"></a><span class="kw">plot</span>(empirical_cdf, <span class="dt">xlim =</span> <span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">4</span>))</span>
<span id="cb6-5"><a href="#cb6-5"></a><span class="kw">points</span>(q, cdfValues, <span class="dt">pch=</span><span class="dv">19</span>)</span></code></pre></div>
<p><img src="figures/Beta3-cdf-1.png" /></p>
<p>I’ve removed the sixth value of the vector <code>q</code> because there is a crash of <code>appellf1</code> for this value:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1"></a>q &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="fl">0.1</span>, <span class="dv">4</span>, <span class="dt">length.out =</span> <span class="dv">10</span>)</span>
<span id="cb7-2"><a href="#cb7-2"></a><span class="kw">pB3</span>(q[<span class="dv">6</span>], c, d, kappa, tau)</span>
<span id="cb7-3"><a href="#cb7-3"></a><span class="co">## Error in appell::appellf1(c, kappa, c + d - kappa, c + 1, -q, -q/tau, : f1conv: Computation not possible</span></span></code></pre></div>
<p>It works with the option <code>userflag = 1</code>:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1"></a><span class="kw">pB3</span>(q[<span class="dv">6</span>], c, d, kappa, tau, <span class="dt">userflag =</span> <span class="dv">1</span>)</span>
<span id="cb8-2"><a href="#cb8-2"></a><span class="co">## [1] 0.849321</span></span></code></pre></div>
<p>Finally perhaps the option <code>userflag = 1</code> is a better default value:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1"></a>cdfValues &lt;-<span class="st"> </span><span class="kw">sapply</span>(q, <span class="cf">function</span>(x){</span>
<span id="cb9-2"><a href="#cb9-2"></a>  <span class="kw">pB3</span>(x, c, d, kappa, tau, <span class="dt">userflag =</span> <span class="dv">1</span>)</span>
<span id="cb9-3"><a href="#cb9-3"></a>})</span>
<span id="cb9-4"><a href="#cb9-4"></a><span class="kw">plot</span>(empirical_cdf, <span class="dt">xlim =</span> <span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">4</span>))</span>
<span id="cb9-5"><a href="#cb9-5"></a><span class="kw">points</span>(q, cdfValues, <span class="dt">pch=</span><span class="dv">19</span>)</span></code></pre></div>
<p><img src="figures/Beta3-cdfbis-1.png" /></p>
<h1 id="application-to-the-bayesian-binomial-model">Application to the Bayesian binomial model</h1>
<p>Consider the binomial statistical model parameterized by the odds ratio <span class="math inline">\(\phi\)</span>: <span class="math display">\[
L(\phi \mid x) \propto \frac{\phi^x}{(1+\phi)^n}.
\]</span> Take a <span class="math inline">\(\mathcal{B}_3(c,d,\kappa,\tau)\)</span> prior distribution on <span class="math inline">\(\phi\)</span>: <span class="math display">\[
\pi(\phi) \propto 
\frac{\phi^{c-1}(1+\phi)^{-\kappa}}
{\left(1+\frac{\phi}{\tau}\right)^{c+d-\kappa}}
\]</span> Then the posterior distribution on <span class="math inline">\(\phi\)</span> is <span class="math inline">\(\mathcal{B}_3(c+x,d+n-x,\kappa+n,\tau)\)</span>.</p>
<h1 id="application-to-the-bayesian-two-poisson-samples-model">Application to the Bayesian “two Poisson samples” model</h1>
<p>Consider the statistical model given by two independent observations <span class="math display">\[
x \sim \mathcal{P}(\lambda S), \quad y\sim\mathcal{P}(\mu T)
\]</span> where <span class="math inline">\(S\)</span> and <span class="math inline">\(T\)</span> are known “sample sizes”. We parametrize the model by <span class="math inline">\(\mu\)</span> and <span class="math inline">\(\phi := \frac{\lambda}{\mu}\)</span>.</p>
<p>Assigning a Gamma prior distribution <span class="math inline">\(\mathcal{G}{B}(a,b)\)</span> on <span class="math inline">\(\mu\)</span>, it is not difficult to get <span class="math display">\[
(\mu \mid \phi,x,y) \sim\mathcal{G}(a+x+y, b + \phi S + T).
\]</span> In their paper <em>A Bayesian framework for the ratio of two Poisson rates in the context of vaccine efficacy trials</em> (2011), Laurent &amp; Legrand derived the marginal likelihood on <span class="math inline">\(\phi\)</span> in the case of the semi-conjuguate family of prior distributions. Their result holds as long as <span class="math inline">\(\mu\)</span> and <span class="math inline">\(\phi\)</span> are independent under the prior distribution, and this result is <span class="math display">\[
\widetilde{L}(\phi \mid x,y) \propto  
\frac{\phi^x}{{(1+\rho\phi)}^{a+x+y}}
\]</span> where <span class="math inline">\(\rho = \frac{S}{T+b}\)</span>.</p>
<p>Now, let’s assign a <span class="math inline">\(\mathcal{B}&#39;(c,d,\tau)\)</span> prior distribution on <span class="math inline">\(\phi\)</span>. Then the posterior distribution on <span class="math inline">\(\phi\)</span> is given by <span class="math display">\[
\pi(\phi \mid x,y) \propto 
\pi(\phi) \widetilde{L}(\phi \mid x,y) \propto 
\frac{\phi^{c+x-1}(1+\rho\phi)^{-(a+x+y)}}
{\left(1+\frac{\phi}{\tau}\right)^{c+d}},
\]</span> and by noting that <span class="math inline">\(\frac{\phi}{\tau} = \frac{\rho\phi}{\rho\tau}\)</span>, we recognize the scaled <span class="math inline">\(\mathcal{B}_3\)</span> distribution <span class="math display">\[
(\phi \mid x,y) \sim \frac{1}{\rho} \times
\mathcal{B}_3(c+x, a+d+y, a+x+y, \rho\tau).
\]</span> In particular, if <span class="math inline">\(\tau = \frac{1}{\rho} = \frac{T+b}{S}\)</span>, then we find <span class="math display">\[
(\phi \mid x,y) \sim \mathcal{B}_2(c+x, a+d+y, \tau),
\]</span> and this is the situation of the semi-conjugate family studied by Laurent &amp; Legrand.</p>

        </div>


        <div id="footer">
          Site proudly generated by
          <a href="http://jaspervdj.be/hakyll">Hakyll</a>
        </div>

      </div>

    </div>

    <div class="row">
      <div class="col-sm-12">
        <div id="disqus_thread"></div>
        <div class="pagination">
          <ul>
            <li>
              <a href="http://laustep.github.io/stlahblog/">&#171; Back Home</a>
            </li>
          </ul>
        </div>
      </div>
    </div>
    
  </div>

</body>

<script src="/libraries/bootstrap/bootstrap.min.js"></script>
<script>
  var disqus_developer = 1;
  var disqus_shortname = 'stlapblog';
  // required: replace example with your forum shortname
  /* * * DON'T EDIT BELOW THIS LINE * * */
  (function () {
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = 'https://' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] ||
      document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>
<noscript>Please enable JavaScript to view the
  <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a>
</noscript>
<!-- MathJax: Fall back to local if CDN offline but local image fonts are not supported (saves >100MB) -->
<script type="text/x-mathjax-config" src="/libraries/mathjax/config/TeX-MML-AM_CHTML.js"></script>
<!-- <script>
  window.MathJax || document.write('<script type="text/x-mathjax-config">MathJax.Hub.Config({"HTML-CSS":{imageFont:null}});<\/script><script src="../libraries/mathjax/MathJax.js"><\/script>');
</script> -->


</html>]]></description>
    <pubDate>Mon, 22 Jul 2019 00:00:00 UT</pubDate>
    <guid>https://laustep.github.io/stlahblog/posts/Beta3.html</guid>
    <dc:creator>Stéphane Laurent</dc:creator>
    <category>R</category>
</item>




<item>
    <title>Drawing nested Steiner chains</title>
    <link>https://laustep.github.io/stlahblog/posts/SteinerChains.html</link>
    <description><![CDATA[<!DOCTYPE HTML>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Saturn Elephant - Drawing nested Steiner chains</title>
  <link href="/libraries/bootstrap/bootstrap-grid.min.css" rel="stylesheet">
  <link rel="stylesheet" href="/css/default2.css" />
  <link rel="stylesheet" href="/css/post.css" />
  <link rel="stylesheet" href="/css/misc.css" /> 
  
    <link rel="stylesheet" href="/css/pandoc-solarized.css" /> 
   
  
  <link href="https://fonts.googleapis.com/css?family=Raleway:400,600,200,800" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/css?family=Droid+Sans" rel="stylesheet" type="text/css">
  <script src="/libraries/jquery.min.js"></script>
  <script type="text/javascript" async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML"></script>
</head>

<body>
  <div class="container-fluid">
    <div class="row">
      <!-- Sidebar. -->
      <div class="sidebar col-sm-2">
        <div class="row">
          <div class="col-sm-12" style="float:right;clear:both;margin-right:50px;margin-top:50px;">
            <a href="https://www.r-bloggers.com/">
              <img src="/images/Rbloggers.png" alt="Rbloggers" width="100%" />
            </a>
            <br/>
            <a href="http://t-redactyl.io/">
              <span style="color:black;font-weight:bold;font-family:sans-serif;font-size:25px;">Standard error</span>
            </a>
            <a href="http://timelyportfolio.blogspot.be/">
              <span style="color:grey;font-weight:bold;font-family:sans-serif;font-size:24px;">Timely portfolio</span>
            </a>
            <br/>
            <a href="https://antoineguillot.wordpress.com/blog/">
              <span style="color:white;background-color:darkblue;font-weight:bold;font-family:sans-serif;font-size:21px;border:5px solid;border-color:darkblue">ENHANCE DATA</span>
            </a>
            <br/>
            <a href="https://fronkonstin.com/">
              <span style="color:black;background-color:gold;font-weight:bold;font-size:29px;border:3px solid;border-color:gold;">Fronkonstin</span>
            </a>
          </div>
        </div>
        <div id="logos">
          <div class="row">
            <div class="col-sm-4">
              <img src="/images/AsymptoteLogo.svg" style="width: 150%; transform: rotateZ(-35deg)"/>
            </div>
            <div class="col-sm-4">
              <img src="/images/Rlogo.svg" style="width: 110%;"/>
            </div>
            <div class="col-sm-4">
              <img src="/images/shiny-hex.png" style="width: 90%;"/>
            </div>
          </div>
          <div class="row">
            <div class="col-sm-4">
              <img src="/images/Povray_logo_sphere.png" style="width: 105%;"/>
            </div>
            <div class="col-sm-4">
              <img src="/images/javascript.svg" style="width: 90%;"/>
            </div>
            <div class="col-sm-4">
              <img src="/images/haskell.svg" style="width: 110%;"/>
            </div>
          </div>
        </div>
      </div>

      <div class="main col-sm-10">
        <div id="header">
          <div id="logo">
            <a href="/">
              <img src="/images/stla.jpg" alt="stla" width="100px" />
            </a>
          </div>
          <div id="navigation" style="margin-top:50px;">
            <a href="/">Home</a>
            <a href="/about.html">About</a>
            <a href="/contact.html">Contact</a>
            <a href="/archive.html">Archive</a>
          </div>
        </div>

        <div class="content">
          <h1>Drawing nested Steiner chains</h1> 
          <div class="info">
    Posted on July 13, 2019
    
        by Stéphane Laurent
    
</div>
<div class="info">
    
    Tags: <a title="All pages tagged &#39;asymptote&#39;." href="/tags/asymptote.html">asymptote</a>, <a title="All pages tagged &#39;geometry&#39;." href="/tags/geometry.html">geometry</a>, <a title="All pages tagged &#39;javascript&#39;." href="/tags/javascript.html">javascript</a>, <a title="All pages tagged &#39;povray&#39;." href="/tags/povray.html">povray</a>, <a title="All pages tagged &#39;R&#39;." href="/tags/R.html">R</a>, <a title="All pages tagged &#39;rgl&#39;." href="/tags/rgl.html">rgl</a>
    
</div>

<p>This is a Steiner chain with its enveloping cyclide:</p>
<p><img src="figures/SteinerChain0.png" /></p>
<p>And these are nested Steiner chains:</p>
<p><img src="figures/SteinerChain.png" /></p>
<h1 id="with-r">With R</h1>
<p>We will include the cyclides in the plot. We firstly write a function returning a mesh of a cyclide. It is obtained by applying an inversion to the mesh of a torus.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a><span class="kw">library</span>(rgl)</span>
<span id="cb1-2"><a href="#cb1-2"></a></span>
<span id="cb1-3"><a href="#cb1-3"></a>torusMesh &lt;-<span class="st"> </span><span class="cf">function</span>(R, r, S, s, arc, ...){</span>
<span id="cb1-4"><a href="#cb1-4"></a>  vertices &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="ot">NA_real_</span>, <span class="dt">nrow =</span> 3L, <span class="dt">ncol =</span> S<span class="op">*</span>s)</span>
<span id="cb1-5"><a href="#cb1-5"></a>  Normals &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="ot">NA_real_</span>, <span class="dt">nrow =</span> 3L, <span class="dt">ncol =</span> S<span class="op">*</span>s)</span>
<span id="cb1-6"><a href="#cb1-6"></a>  full &lt;-<span class="st"> </span>arc <span class="op">==</span><span class="st"> </span><span class="dv">2</span><span class="op">*</span>pi</span>
<span id="cb1-7"><a href="#cb1-7"></a>  SS &lt;-<span class="st"> </span><span class="kw">ifelse</span>(full, S, S<span class="dv">-1</span>)</span>
<span id="cb1-8"><a href="#cb1-8"></a>  indices &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="ot">NA_integer_</span>, <span class="dt">nrow =</span> 4L, <span class="dt">ncol =</span> SS<span class="op">*</span>s)</span>
<span id="cb1-9"><a href="#cb1-9"></a>  u_ &lt;-<span class="st"> </span><span class="cf">if</span>(full){</span>
<span id="cb1-10"><a href="#cb1-10"></a>    <span class="kw">seq</span>(<span class="dv">0</span>, <span class="dv">2</span><span class="op">*</span>pi, <span class="dt">length.out =</span> S<span class="op">+</span><span class="dv">1</span>)[<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb1-11"><a href="#cb1-11"></a>  }<span class="cf">else</span>{</span>
<span id="cb1-12"><a href="#cb1-12"></a>    <span class="kw">seq</span>(<span class="dv">0</span>, arc, <span class="dt">length.out =</span> S)</span>
<span id="cb1-13"><a href="#cb1-13"></a>  }</span>
<span id="cb1-14"><a href="#cb1-14"></a>  v_ &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="dv">0</span>, <span class="dv">2</span><span class="op">*</span>pi, <span class="dt">length.out =</span> s<span class="op">+</span><span class="dv">1</span>)[<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb1-15"><a href="#cb1-15"></a>  <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>S){</span>
<span id="cb1-16"><a href="#cb1-16"></a>    cos_ui &lt;-<span class="st"> </span><span class="kw">cos</span>(u_[i])</span>
<span id="cb1-17"><a href="#cb1-17"></a>    sin_ui &lt;-<span class="st"> </span><span class="kw">sin</span>(u_[i])</span>
<span id="cb1-18"><a href="#cb1-18"></a>    cx &lt;-<span class="st"> </span>R <span class="op">*</span><span class="st"> </span>cos_ui</span>
<span id="cb1-19"><a href="#cb1-19"></a>    cy &lt;-<span class="st"> </span>R <span class="op">*</span><span class="st"> </span>sin_ui</span>
<span id="cb1-20"><a href="#cb1-20"></a>    <span class="cf">for</span>(j <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>s){</span>
<span id="cb1-21"><a href="#cb1-21"></a>      rcos_vj &lt;-<span class="st"> </span>r<span class="op">*</span><span class="kw">cos</span>(v_[j])</span>
<span id="cb1-22"><a href="#cb1-22"></a>      n &lt;-<span class="st"> </span><span class="kw">c</span>(rcos_vj<span class="op">*</span>cos_ui, rcos_vj<span class="op">*</span>sin_ui, r<span class="op">*</span><span class="kw">sin</span>(v_[j]))</span>
<span id="cb1-23"><a href="#cb1-23"></a>      Normals[, (i<span class="dv">-1</span>)<span class="op">*</span>s<span class="op">+</span>j] &lt;-<span class="st"> </span><span class="op">-</span>n</span>
<span id="cb1-24"><a href="#cb1-24"></a>      vertices[, (i<span class="dv">-1</span>)<span class="op">*</span>s<span class="op">+</span>j] &lt;-<span class="st"> </span><span class="kw">c</span>(cx,cy,<span class="dv">0</span>) <span class="op">+</span><span class="st"> </span>n </span>
<span id="cb1-25"><a href="#cb1-25"></a>    }</span>
<span id="cb1-26"><a href="#cb1-26"></a>  }</span>
<span id="cb1-27"><a href="#cb1-27"></a>  <span class="co"># quads</span></span>
<span id="cb1-28"><a href="#cb1-28"></a>  s &lt;-<span class="st"> </span><span class="kw">as.integer</span>(s)</span>
<span id="cb1-29"><a href="#cb1-29"></a>  <span class="cf">for</span>(i <span class="cf">in</span> 1L<span class="op">:</span>SS){</span>
<span id="cb1-30"><a href="#cb1-30"></a>    ip1 &lt;-<span class="st"> </span><span class="kw">ifelse</span>(i<span class="op">==</span>S, 1L, i<span class="op">+</span>1L)</span>
<span id="cb1-31"><a href="#cb1-31"></a>    <span class="cf">for</span>(j <span class="cf">in</span> 1L<span class="op">:</span>s){</span>
<span id="cb1-32"><a href="#cb1-32"></a>      jp1 &lt;-<span class="st"> </span><span class="kw">ifelse</span>(j<span class="op">==</span>s, 1L, j<span class="op">+</span>1L)</span>
<span id="cb1-33"><a href="#cb1-33"></a>      indices[,(i<span class="dv">-1</span>)<span class="op">*</span>s<span class="op">+</span>j] &lt;-<span class="st"> </span></span>
<span id="cb1-34"><a href="#cb1-34"></a><span class="st">        </span><span class="kw">c</span>((i<span class="op">-</span>1L)<span class="op">*</span>s<span class="op">+</span>j, (i<span class="op">-</span>1L)<span class="op">*</span>s<span class="op">+</span>jp1, (ip1<span class="op">-</span>1L)<span class="op">*</span>s<span class="op">+</span>jp1, (ip1<span class="op">-</span>1L)<span class="op">*</span>s<span class="op">+</span>j)   </span>
<span id="cb1-35"><a href="#cb1-35"></a>    }</span>
<span id="cb1-36"><a href="#cb1-36"></a>  }</span>
<span id="cb1-37"><a href="#cb1-37"></a>  <span class="kw">qmesh3d</span>(</span>
<span id="cb1-38"><a href="#cb1-38"></a>    <span class="dt">vertices =</span> vertices,</span>
<span id="cb1-39"><a href="#cb1-39"></a>    <span class="dt">indices =</span> indices,</span>
<span id="cb1-40"><a href="#cb1-40"></a>    <span class="dt">homogeneous =</span> <span class="ot">FALSE</span>,</span>
<span id="cb1-41"><a href="#cb1-41"></a>    <span class="dt">material =</span> <span class="kw">list</span>(...),</span>
<span id="cb1-42"><a href="#cb1-42"></a>    <span class="dt">normals =</span> <span class="kw">t</span>(Normals)</span>
<span id="cb1-43"><a href="#cb1-43"></a>  )</span>
<span id="cb1-44"><a href="#cb1-44"></a>}</span>
<span id="cb1-45"><a href="#cb1-45"></a></span>
<span id="cb1-46"><a href="#cb1-46"></a><span class="co"># only for mu&gt;c (ring cyclide)</span></span>
<span id="cb1-47"><a href="#cb1-47"></a>cyclideMesh &lt;-<span class="st"> </span><span class="cf">function</span>(mu, a, c, <span class="dt">S=</span><span class="dv">128</span>, <span class="dt">s=</span><span class="dv">64</span>, <span class="dt">arc=</span><span class="dv">2</span><span class="op">*</span>pi, ...){</span>
<span id="cb1-48"><a href="#cb1-48"></a>  b &lt;-<span class="st"> </span><span class="kw">sqrt</span>(a<span class="op">^</span><span class="dv">2</span><span class="op">-</span>c<span class="op">^</span><span class="dv">2</span>)</span>
<span id="cb1-49"><a href="#cb1-49"></a>  bb &lt;-<span class="st"> </span>b<span class="op">*</span><span class="kw">sqrt</span>(mu<span class="op">^</span><span class="dv">2</span><span class="op">-</span>c<span class="op">^</span><span class="dv">2</span>)</span>
<span id="cb1-50"><a href="#cb1-50"></a>  omega &lt;-<span class="st"> </span>(a<span class="op">*</span>mu <span class="op">+</span><span class="st"> </span>bb)<span class="op">/</span>c</span>
<span id="cb1-51"><a href="#cb1-51"></a>  Omega &lt;-<span class="st"> </span><span class="kw">c</span>(omega,<span class="dv">0</span>,<span class="dv">0</span>)</span>
<span id="cb1-52"><a href="#cb1-52"></a>  inversion &lt;-<span class="st"> </span><span class="cf">function</span>(M){</span>
<span id="cb1-53"><a href="#cb1-53"></a>    Omega <span class="op">+</span><span class="st"> </span><span class="dv">1</span><span class="op">/</span><span class="kw">c</span>(<span class="kw">crossprod</span>(M<span class="op">-</span>Omega)) <span class="op">*</span><span class="st"> </span>(M<span class="op">-</span>Omega)</span>
<span id="cb1-54"><a href="#cb1-54"></a>  }</span>
<span id="cb1-55"><a href="#cb1-55"></a>  d &lt;-<span class="st"> </span>(a<span class="op">-</span>c)<span class="op">*</span>(mu<span class="op">-</span>c)<span class="op">+</span>bb</span>
<span id="cb1-56"><a href="#cb1-56"></a>  r &lt;-<span class="st"> </span>c<span class="op">*</span>c<span class="op">*</span>(mu<span class="op">-</span>c) <span class="op">/</span><span class="st"> </span>((a<span class="op">+</span>c)<span class="op">*</span>(mu<span class="op">-</span>c)<span class="op">+</span>bb) <span class="op">/</span><span class="st"> </span>d</span>
<span id="cb1-57"><a href="#cb1-57"></a>  R &lt;-<span class="st"> </span>c<span class="op">*</span>c<span class="op">*</span>(a<span class="op">-</span>c) <span class="op">/</span><span class="st"> </span>((a<span class="op">-</span>c)<span class="op">*</span>(mu<span class="op">+</span>c)<span class="op">+</span>bb) <span class="op">/</span><span class="st"> </span>d</span>
<span id="cb1-58"><a href="#cb1-58"></a>  bb2 &lt;-<span class="st"> </span>b<span class="op">*</span>b<span class="op">*</span>(mu<span class="op">*</span>mu<span class="op">-</span>c<span class="op">*</span>c)</span>
<span id="cb1-59"><a href="#cb1-59"></a>  denb1 &lt;-<span class="st"> </span>c<span class="op">*</span>(a<span class="op">*</span>c<span class="op">-</span>mu<span class="op">*</span>c<span class="op">+</span>c<span class="op">*</span>c<span class="op">-</span>a<span class="op">*</span>mu<span class="op">-</span>bb)</span>
<span id="cb1-60"><a href="#cb1-60"></a>  b1 &lt;-<span class="st"> </span>(a<span class="op">*</span>mu<span class="op">*</span>(c<span class="op">-</span>mu)<span class="op">*</span>(a<span class="op">+</span>c)<span class="op">-</span>bb2<span class="op">+</span>c<span class="op">*</span>c<span class="op">+</span>bb<span class="op">*</span>(c<span class="op">*</span>(a<span class="op">-</span>mu<span class="op">+</span>c)<span class="op">-</span><span class="dv">2</span><span class="op">*</span>a<span class="op">*</span>mu))<span class="op">/</span>denb1</span>
<span id="cb1-61"><a href="#cb1-61"></a>  denb2 &lt;-<span class="st"> </span>c<span class="op">*</span>(a<span class="op">*</span>c<span class="op">-</span>mu<span class="op">*</span>c<span class="op">-</span>c<span class="op">*</span>c<span class="op">+</span>a<span class="op">*</span>mu<span class="op">+</span>bb)</span>
<span id="cb1-62"><a href="#cb1-62"></a>  b2 &lt;-<span class="st"> </span>(a<span class="op">*</span>mu<span class="op">*</span>(c<span class="op">+</span>mu)<span class="op">*</span>(a<span class="op">-</span>c)<span class="op">+</span>bb2<span class="op">-</span>c<span class="op">*</span>c<span class="op">+</span>bb<span class="op">*</span>(c<span class="op">*</span>(a<span class="op">-</span>mu<span class="op">-</span>c)<span class="op">+</span><span class="dv">2</span><span class="op">*</span>a<span class="op">*</span>mu))<span class="op">/</span>denb2</span>
<span id="cb1-63"><a href="#cb1-63"></a>  omegaT &lt;-<span class="st"> </span>(b1<span class="op">+</span>b2)<span class="op">/</span><span class="dv">2</span></span>
<span id="cb1-64"><a href="#cb1-64"></a>  tmesh &lt;-<span class="st"> </span><span class="kw">torusMesh</span>(R, r, S, s, arc, ...)</span>
<span id="cb1-65"><a href="#cb1-65"></a>  tmesh<span class="op">$</span>normals &lt;-<span class="st"> </span></span>
<span id="cb1-66"><a href="#cb1-66"></a><span class="st">    </span><span class="kw">apply</span>(tmesh<span class="op">$</span>normals <span class="op">+</span><span class="st"> </span>tmesh<span class="op">$</span>vb[<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>,] <span class="op">+</span><span class="st"> </span><span class="kw">c</span>(omegaT,<span class="dv">0</span>,<span class="dv">0</span>), <span class="dv">2</span>, inversion)</span>
<span id="cb1-67"><a href="#cb1-67"></a>  tmesh<span class="op">$</span>vb[<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>,] &lt;-<span class="st"> </span><span class="kw">apply</span>(tmesh<span class="op">$</span>vb[<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>,] <span class="op">+</span><span class="st"> </span><span class="kw">c</span>(omegaT,<span class="dv">0</span>,<span class="dv">0</span>), <span class="dv">2</span>, inversion)</span>
<span id="cb1-68"><a href="#cb1-68"></a>  tmesh<span class="op">$</span>normals &lt;-<span class="st"> </span>tmesh<span class="op">$</span>vb[<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>,] <span class="op">-</span><span class="st"> </span>tmesh<span class="op">$</span>normals  </span>
<span id="cb1-69"><a href="#cb1-69"></a>  tmesh</span>
<span id="cb1-70"><a href="#cb1-70"></a>}</span></code></pre></div>
<p>Now here is the code which plots the nested Steiner chains:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1"></a><span class="co"># make a smooth unit sphere</span></span>
<span id="cb2-2"><a href="#cb2-2"></a>unitSphere &lt;-<span class="st"> </span><span class="kw">subdivision3d</span>(<span class="kw">icosahedron3d</span>(), <span class="dt">depth=</span><span class="dv">4</span>)</span>
<span id="cb2-3"><a href="#cb2-3"></a>unitSphere<span class="op">$</span>vb[<span class="dv">4</span>,] &lt;-<span class="st"> </span></span>
<span id="cb2-4"><a href="#cb2-4"></a><span class="st">  </span><span class="kw">apply</span>(unitSphere<span class="op">$</span>vb[<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>,], <span class="dv">2</span>, <span class="cf">function</span>(x) <span class="kw">sqrt</span>(<span class="kw">sum</span>(x<span class="op">^</span><span class="dv">2</span>)))</span>
<span id="cb2-5"><a href="#cb2-5"></a>unitSphere<span class="op">$</span>normals &lt;-<span class="st"> </span>unitSphere<span class="op">$</span>vb</span>
<span id="cb2-6"><a href="#cb2-6"></a><span class="co"># draw a sphere in the x-y plane</span></span>
<span id="cb2-7"><a href="#cb2-7"></a>drawSphere &lt;-<span class="st"> </span><span class="cf">function</span>(x, y, radius, ...){</span>
<span id="cb2-8"><a href="#cb2-8"></a>  <span class="kw">shade3d</span>(</span>
<span id="cb2-9"><a href="#cb2-9"></a>    <span class="kw">translate3d</span>(</span>
<span id="cb2-10"><a href="#cb2-10"></a>      <span class="kw">scale3d</span>(unitSphere, radius, radius, radius), </span>
<span id="cb2-11"><a href="#cb2-11"></a>      x, y, <span class="dv">0</span>), </span>
<span id="cb2-12"><a href="#cb2-12"></a>    ...)</span>
<span id="cb2-13"><a href="#cb2-13"></a>}</span>
<span id="cb2-14"><a href="#cb2-14"></a></span>
<span id="cb2-15"><a href="#cb2-15"></a><span class="co"># draw a cyclide translated by (x,y,0)</span></span>
<span id="cb2-16"><a href="#cb2-16"></a>drawCyclide &lt;-<span class="st"> </span><span class="cf">function</span>(mu, a, c, x, y, ...){</span>
<span id="cb2-17"><a href="#cb2-17"></a>  mesh &lt;-<span class="st"> </span><span class="kw">cyclideMesh</span>(mu, a, c)</span>
<span id="cb2-18"><a href="#cb2-18"></a>  <span class="kw">shade3d</span>(<span class="kw">translate3d</span>(mesh, x, y, <span class="dv">0</span>), ...)</span>
<span id="cb2-19"><a href="#cb2-19"></a>}</span>
<span id="cb2-20"><a href="#cb2-20"></a></span>
<span id="cb2-21"><a href="#cb2-21"></a><span class="co"># image of circle (center, radius) by the inversion </span></span>
<span id="cb2-22"><a href="#cb2-22"></a><span class="co">#   with center c and power k</span></span>
<span id="cb2-23"><a href="#cb2-23"></a>iotaCircle &lt;-<span class="st"> </span><span class="cf">function</span>(c, k, center, radius){</span>
<span id="cb2-24"><a href="#cb2-24"></a>  r &lt;-<span class="st"> </span><span class="kw">sqrt</span>(<span class="kw">abs</span>(k)) </span>
<span id="cb2-25"><a href="#cb2-25"></a>  z1 &lt;-<span class="st"> </span><span class="kw">sign</span>(k) <span class="op">*</span><span class="st"> </span>(center<span class="op">-</span>c)<span class="op">/</span>r </span>
<span id="cb2-26"><a href="#cb2-26"></a>  D1 &lt;-<span class="st"> </span>(radius<span class="op">/</span>r)<span class="op">^</span><span class="dv">2</span> <span class="op">-</span><span class="st"> </span><span class="kw">c</span>(<span class="kw">crossprod</span>(z1))</span>
<span id="cb2-27"><a href="#cb2-27"></a>  z2 &lt;-<span class="st"> </span><span class="op">-</span>z1<span class="op">/</span>D1</span>
<span id="cb2-28"><a href="#cb2-28"></a>  R2 &lt;-<span class="st"> </span><span class="kw">sqrt</span>(<span class="kw">c</span>(<span class="kw">crossprod</span>(z2)) <span class="op">+</span><span class="st"> </span><span class="dv">1</span><span class="op">/</span>D1)</span>
<span id="cb2-29"><a href="#cb2-29"></a>  <span class="kw">list</span>(<span class="dt">center =</span> r<span class="op">*</span>z2<span class="op">+</span>c, <span class="dt">radius =</span> r<span class="op">*</span>R2)</span>
<span id="cb2-30"><a href="#cb2-30"></a>}</span>
<span id="cb2-31"><a href="#cb2-31"></a></span>
<span id="cb2-32"><a href="#cb2-32"></a><span class="co"># n: vector, the numbers of spheres at each step</span></span>
<span id="cb2-33"><a href="#cb2-33"></a><span class="co"># -1 &lt; phi &lt; 1, phi != 0</span></span>
<span id="cb2-34"><a href="#cb2-34"></a>steiner &lt;-<span class="st"> </span><span class="cf">function</span>(n, phi, <span class="dt">color=</span><span class="st">&quot;red&quot;</span>, <span class="dt">shift=</span><span class="dv">0</span>, </span>
<span id="cb2-35"><a href="#cb2-35"></a>                    <span class="dt">Center=</span><span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">0</span>), <span class="dt">radius=</span><span class="dv">2</span>, <span class="dt">epsilon =</span> <span class="fl">0.005</span>){</span>
<span id="cb2-36"><a href="#cb2-36"></a>  depth &lt;-<span class="st"> </span><span class="kw">length</span>(n)</span>
<span id="cb2-37"><a href="#cb2-37"></a>  invphi &lt;-<span class="st"> </span><span class="dv">1</span><span class="op">/</span>phi </span>
<span id="cb2-38"><a href="#cb2-38"></a>  I &lt;-<span class="st"> </span><span class="kw">c</span>(radius<span class="op">*</span>invphi, <span class="dv">0</span>) <span class="op">+</span><span class="st"> </span>Center</span>
<span id="cb2-39"><a href="#cb2-39"></a>  k &lt;-<span class="st"> </span>radius<span class="op">*</span>radius<span class="op">*</span>(<span class="dv">1</span><span class="op">-</span>invphi<span class="op">*</span>invphi)</span>
<span id="cb2-40"><a href="#cb2-40"></a>  m &lt;-<span class="st"> </span>n[<span class="dv">1</span>]</span>
<span id="cb2-41"><a href="#cb2-41"></a>  sine &lt;-<span class="st"> </span><span class="kw">sin</span>(pi<span class="op">/</span>m)</span>
<span id="cb2-42"><a href="#cb2-42"></a>  Coef &lt;-<span class="st"> </span><span class="dv">1</span><span class="op">/</span>(<span class="dv">1</span><span class="op">+</span>sine)</span>
<span id="cb2-43"><a href="#cb2-43"></a>  O1x &lt;-<span class="st"> </span><span class="dv">2</span><span class="op">*</span>radius<span class="op">*</span>invphi</span>
<span id="cb2-44"><a href="#cb2-44"></a>  CRadius &lt;-<span class="st"> </span>Coef<span class="op">*</span>radius</span>
<span id="cb2-45"><a href="#cb2-45"></a>  CSide &lt;-<span class="st"> </span>CRadius<span class="op">*</span>sine</span>
<span id="cb2-46"><a href="#cb2-46"></a>  <span class="cf">if</span>(depth <span class="op">==</span><span class="st"> </span><span class="dv">1</span>){</span>
<span id="cb2-47"><a href="#cb2-47"></a>    circle &lt;-<span class="st"> </span><span class="kw">iotaCircle</span>(I<span class="op">-</span>Center, k, <span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">0</span>), CRadius <span class="op">-</span><span class="st"> </span>CSide)</span>
<span id="cb2-48"><a href="#cb2-48"></a>    mu &lt;-<span class="st"> </span>(radius <span class="op">-</span><span class="st"> </span>circle<span class="op">$</span>radius)<span class="op">/</span><span class="dv">2</span>;</span>
<span id="cb2-49"><a href="#cb2-49"></a>    a &lt;-<span class="st"> </span>(radius <span class="op">+</span><span class="st"> </span>circle<span class="op">$</span>radius)<span class="op">/</span><span class="dv">2</span>;</span>
<span id="cb2-50"><a href="#cb2-50"></a>    c &lt;-<span class="st"> </span>(circle<span class="op">$</span>center[<span class="dv">1</span>] <span class="op">-</span><span class="st"> </span>O1x)<span class="op">/</span><span class="dv">2</span>;</span>
<span id="cb2-51"><a href="#cb2-51"></a>    pt &lt;-<span class="st"> </span>Center <span class="op">+</span><span class="st"> </span>circle<span class="op">$</span>center<span class="op">/</span><span class="dv">2</span>;</span>
<span id="cb2-52"><a href="#cb2-52"></a>    <span class="kw">drawCyclide</span>(mu, a, c, pt[<span class="dv">1</span>]<span class="op">-</span>O1x<span class="op">/</span><span class="dv">2</span>, pt[<span class="dv">2</span>], </span>
<span id="cb2-53"><a href="#cb2-53"></a>                <span class="dt">color =</span> <span class="st">&quot;yellow&quot;</span>, <span class="dt">alpha =</span> <span class="fl">0.2</span>)</span>
<span id="cb2-54"><a href="#cb2-54"></a>  }</span>
<span id="cb2-55"><a href="#cb2-55"></a>  <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>m){</span>
<span id="cb2-56"><a href="#cb2-56"></a>    beta &lt;-<span class="st"> </span>(i<span class="op">+</span>shift)<span class="op">*</span><span class="dv">2</span><span class="op">*</span>pi<span class="op">/</span>m </span>
<span id="cb2-57"><a href="#cb2-57"></a>    pti &lt;-<span class="st"> </span><span class="kw">c</span>(CRadius<span class="op">*</span><span class="kw">cos</span>(beta), CRadius<span class="op">*</span><span class="kw">sin</span>(beta)) <span class="op">+</span><span class="st"> </span>Center</span>
<span id="cb2-58"><a href="#cb2-58"></a>    cc &lt;-<span class="st"> </span><span class="kw">iotaCircle</span>(I, k, pti, CSide)</span>
<span id="cb2-59"><a href="#cb2-59"></a>    center &lt;-<span class="st"> </span>cc<span class="op">$</span>center <span class="op">-</span><span class="st"> </span><span class="kw">c</span>(O1x,<span class="dv">0</span>)</span>
<span id="cb2-60"><a href="#cb2-60"></a>    r &lt;-<span class="st"> </span>cc<span class="op">$</span>radius</span>
<span id="cb2-61"><a href="#cb2-61"></a>    <span class="cf">if</span>(depth <span class="op">==</span><span class="st"> </span><span class="dv">1</span>){</span>
<span id="cb2-62"><a href="#cb2-62"></a>      <span class="kw">drawSphere</span>(center[<span class="dv">1</span>], center[<span class="dv">2</span>], r<span class="op">-</span>epsilon, <span class="dt">color =</span> color)</span>
<span id="cb2-63"><a href="#cb2-63"></a>    }</span>
<span id="cb2-64"><a href="#cb2-64"></a>    <span class="cf">if</span>(depth<span class="op">&gt;</span><span class="dv">1</span>){</span>
<span id="cb2-65"><a href="#cb2-65"></a>      <span class="kw">steiner</span>(n[<span class="op">-</span><span class="dv">1</span>], phi, <span class="dt">color=</span>color, </span>
<span id="cb2-66"><a href="#cb2-66"></a>              <span class="dt">Center=</span>center, <span class="dt">radius=</span>r, <span class="dt">shift =</span> <span class="op">-</span>shift)</span>
<span id="cb2-67"><a href="#cb2-67"></a>    }</span>
<span id="cb2-68"><a href="#cb2-68"></a>  }</span>
<span id="cb2-69"><a href="#cb2-69"></a>  <span class="kw">return</span>(<span class="kw">invisible</span>())</span>
<span id="cb2-70"><a href="#cb2-70"></a>}</span>
<span id="cb2-71"><a href="#cb2-71"></a></span>
<span id="cb2-72"><a href="#cb2-72"></a><span class="co"># background color</span></span>
<span id="cb2-73"><a href="#cb2-73"></a>bgColor &lt;-<span class="st"> </span><span class="kw">rgb</span>(<span class="dv">54</span>, <span class="dv">57</span>, <span class="dv">64</span>, <span class="dt">maxColorValue =</span> <span class="dv">255</span>)</span>
<span id="cb2-74"><a href="#cb2-74"></a></span>
<span id="cb2-75"><a href="#cb2-75"></a><span class="co"># plot</span></span>
<span id="cb2-76"><a href="#cb2-76"></a><span class="kw">open3d</span>(<span class="dt">windowRect =</span> <span class="kw">c</span>(<span class="dv">50</span>,<span class="dv">50</span>,<span class="dv">550</span>,<span class="dv">550</span>))</span>
<span id="cb2-77"><a href="#cb2-77"></a><span class="kw">bg3d</span>(bgColor)</span>
<span id="cb2-78"><a href="#cb2-78"></a><span class="kw">view3d</span>(<span class="dv">0</span>, <span class="dv">-40</span>, <span class="dt">zoom =</span> <span class="fl">0.75</span>)</span>
<span id="cb2-79"><a href="#cb2-79"></a><span class="kw">steiner</span>(<span class="dt">n =</span> <span class="kw">c</span>(<span class="dv">3</span>,<span class="dv">3</span>,<span class="dv">4</span>), <span class="dt">phi =</span> <span class="fl">0.3</span>, <span class="dt">color =</span> <span class="st">&quot;#B12A90FF&quot;</span>, <span class="dt">shift =</span> <span class="fl">0.25</span>)</span></code></pre></div>
<p>Here is how to make a gif animation the nested Steiner chains:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a><span class="co"># &quot;bounding box&quot;</span></span>
<span id="cb3-2"><a href="#cb3-2"></a>bBox &lt;-<span class="st"> </span><span class="cf">function</span>(){</span>
<span id="cb3-3"><a href="#cb3-3"></a>  r &lt;-<span class="st"> </span><span class="dv">2</span></span>
<span id="cb3-4"><a href="#cb3-4"></a>  <span class="kw">lines3d</span>(</span>
<span id="cb3-5"><a href="#cb3-5"></a>    <span class="kw">rbind</span>(</span>
<span id="cb3-6"><a href="#cb3-6"></a>      <span class="kw">c</span>(r, r, <span class="dv">0</span>), <span class="kw">c</span>(<span class="op">-</span>r, r, <span class="dv">0</span>), <span class="kw">c</span>(<span class="op">-</span>r, <span class="op">-</span>r, <span class="dv">0</span>), <span class="kw">c</span>(r, <span class="op">-</span>r, <span class="dv">0</span>)</span>
<span id="cb3-7"><a href="#cb3-7"></a>    ),</span>
<span id="cb3-8"><a href="#cb3-8"></a>    <span class="dt">color =</span> bgColor, <span class="dt">alpha =</span> <span class="dv">0</span></span>
<span id="cb3-9"><a href="#cb3-9"></a>  )</span>
<span id="cb3-10"><a href="#cb3-10"></a>}</span>
<span id="cb3-11"><a href="#cb3-11"></a></span>
<span id="cb3-12"><a href="#cb3-12"></a>shifts &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dt">length.out =</span> <span class="dv">46</span>)[<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb3-13"><a href="#cb3-13"></a><span class="kw">open3d</span>(<span class="dt">windowRect =</span> <span class="kw">c</span>(<span class="dv">50</span>,<span class="dv">50</span>,<span class="dv">550</span>,<span class="dv">550</span>))</span>
<span id="cb3-14"><a href="#cb3-14"></a><span class="kw">bg3d</span>(bgColor)</span>
<span id="cb3-15"><a href="#cb3-15"></a><span class="kw">view3d</span>(<span class="dv">0</span>, <span class="dv">-40</span>, <span class="dt">zoom =</span> <span class="fl">0.75</span>)</span>
<span id="cb3-16"><a href="#cb3-16"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="kw">seq_along</span>(shifts)){</span>
<span id="cb3-17"><a href="#cb3-17"></a>  <span class="kw">steiner</span>(<span class="dt">n =</span> <span class="kw">c</span>(<span class="dv">3</span>,<span class="dv">3</span>,<span class="dv">5</span>), <span class="dt">phi =</span> <span class="fl">0.3</span>, <span class="dt">color =</span> <span class="st">&quot;#B12A90FF&quot;</span>, </span>
<span id="cb3-18"><a href="#cb3-18"></a>          <span class="dt">shift =</span> shifts[i])</span>
<span id="cb3-19"><a href="#cb3-19"></a>  <span class="kw">bBox</span>()</span>
<span id="cb3-20"><a href="#cb3-20"></a>  <span class="kw">snapshot3d</span>(<span class="kw">sprintf</span>(<span class="st">&quot;img-%03d.png&quot;</span>, i))</span>
<span id="cb3-21"><a href="#cb3-21"></a>  <span class="kw">clear3d</span>()</span>
<span id="cb3-22"><a href="#cb3-22"></a>}</span>
<span id="cb3-23"><a href="#cb3-23"></a></span>
<span id="cb3-24"><a href="#cb3-24"></a>pngs &lt;-<span class="st"> </span><span class="kw">list.files</span>(<span class="dt">pattern =</span> <span class="st">&quot;^img-.*png$&quot;</span>)</span>
<span id="cb3-25"><a href="#cb3-25"></a>gifski<span class="op">::</span><span class="kw">gifski</span>(pngs, <span class="st">&quot;SteinerChain_R.gif&quot;</span>, </span>
<span id="cb3-26"><a href="#cb3-26"></a>               <span class="dt">width =</span> <span class="dv">500</span>, <span class="dt">height =</span> <span class="dv">500</span>, <span class="dt">delay =</span> <span class="fl">0.04</span>)</span>
<span id="cb3-27"><a href="#cb3-27"></a><span class="kw">file.remove</span>(pngs)</span></code></pre></div>
<p><img src="figures/SteinerChain_R.gif" /></p>
<h1 id="with-pov-ray">With POV-Ray</h1>
<div class="sourceCode" id="cb4"><pre class="sourceCode numberSource povray numberLines"><code class="sourceCode povray"><span id="cb4-1"><a href="#cb4-1"></a><span class="ot">#version</span> <span class="fl">3.7</span>;</span>
<span id="cb4-2"><a href="#cb4-2"></a><span class="kw">global_settings</span> { <span class="kw">assumed_gamma</span> <span class="fl">1</span> }</span>
<span id="cb4-3"><a href="#cb4-3"></a><span class="ot">#include</span> <span class="st">&quot;colors.inc&quot;</span></span>
<span id="cb4-4"><a href="#cb4-4"></a><span class="ot">#include</span> <span class="st">&quot;textures.inc&quot;</span></span>
<span id="cb4-5"><a href="#cb4-5"></a><span class="ot">#include</span> <span class="st">&quot;glass.inc&quot;</span></span>
<span id="cb4-6"><a href="#cb4-6"></a></span>
<span id="cb4-7"><a href="#cb4-7"></a><span class="co">// image of the circle (Center,Radius) by inversion pole c power k ---</span></span>
<span id="cb4-8"><a href="#cb4-8"></a><span class="kw">#macro invertedCircle</span>(c, k, Center, Radius)</span>
<span id="cb4-9"><a href="#cb4-9"></a>  <span class="kw">#local r </span>= <span class="kw">sqrt</span>(<span class="kw">abs</span>(k));</span>
<span id="cb4-10"><a href="#cb4-10"></a>  <span class="kw">#local sign </span>= (k&gt;<span class="fl">0</span> ? <span class="fl">1</span> : <span class="fl">-1</span>);</span>
<span id="cb4-11"><a href="#cb4-11"></a>  <span class="kw">#local z1 </span>= sign * (Center-c)/r;</span>
<span id="cb4-12"><a href="#cb4-12"></a>  <span class="kw">#local D1 </span>= Radius*Radius/r/r - <span class="kw">vdot</span>(z1,z1);</span>
<span id="cb4-13"><a href="#cb4-13"></a>  <span class="kw">#local z2 </span>= -z1/D1;</span>
<span id="cb4-14"><a href="#cb4-14"></a>  <span class="kw">#local R2 </span>= <span class="kw">sqrt</span>(<span class="kw">vdot</span>(z2,z2) + <span class="fl">1</span>/D1);</span>
<span id="cb4-15"><a href="#cb4-15"></a>  <span class="kw">#local z3 </span>= r*z2+c;</span>
<span id="cb4-16"><a href="#cb4-16"></a>  &lt;z3.<span class="kw">x</span>, z3.<span class="kw">y</span>, r*R2&gt;</span>
<span id="cb4-17"><a href="#cb4-17"></a><span class="ot">#end</span></span>
<span id="cb4-18"><a href="#cb4-18"></a></span>
<span id="cb4-19"><a href="#cb4-19"></a><span class="co">// delete first element of an array ----------------------------------</span></span>
<span id="cb4-20"><a href="#cb4-20"></a><span class="kw">#macro tail</span>(Array)</span>
<span id="cb4-21"><a href="#cb4-21"></a>  <span class="kw">#local l </span>= <span class="kw">dimension_size</span>(Array, <span class="fl">1</span>);</span>
<span id="cb4-22"><a href="#cb4-22"></a>  <span class="kw">#local out </span>= <span class="kw">array</span>[l<span class="fl">-1</span>];</span>
<span id="cb4-23"><a href="#cb4-23"></a>  #for(i, <span class="fl">0</span>, l<span class="fl">-2</span>)</span>
<span id="cb4-24"><a href="#cb4-24"></a>    <span class="kw">#local out</span>[i] = Array[i+<span class="fl">1</span>];</span>
<span id="cb4-25"><a href="#cb4-25"></a>  <span class="ot">#end</span></span>
<span id="cb4-26"><a href="#cb4-26"></a>  out</span>
<span id="cb4-27"><a href="#cb4-27"></a><span class="ot">#end</span></span>
<span id="cb4-28"><a href="#cb4-28"></a></span>
<span id="cb4-29"><a href="#cb4-29"></a><span class="co">// main macro --------------------------------------------------------</span></span>
<span id="cb4-30"><a href="#cb4-30"></a><span class="co">// n: array of integers &gt;1, the numbers of spheres at each step</span></span>
<span id="cb4-31"><a href="#cb4-31"></a><span class="co">// phi: number -1 &lt; phi &lt; 1, phi /= 0 </span></span>
<span id="cb4-32"><a href="#cb4-32"></a><span class="co">// shift: number 0 &lt;= shift &lt; 1</span></span>
<span id="cb4-33"><a href="#cb4-33"></a><span class="kw">#macro Steiner3D</span>(n, phi, shift, Center, Radius, epsilon)</span>
<span id="cb4-34"><a href="#cb4-34"></a>  <span class="kw">#local Depth </span>= <span class="kw">dimension_size</span>(n, <span class="fl">1</span>);</span>
<span id="cb4-35"><a href="#cb4-35"></a>  <span class="kw">#local m </span>= n[<span class="fl">0</span>];</span>
<span id="cb4-36"><a href="#cb4-36"></a>  <span class="kw">#local sine </span>= <span class="kw">sin</span>(<span class="fl">pi</span>/m);</span>
<span id="cb4-37"><a href="#cb4-37"></a>  <span class="kw">#local Side </span>= Radius*sine; <span class="co">// side length of the m-gon </span></span>
<span id="cb4-38"><a href="#cb4-38"></a>  <span class="kw">#local Coef </span>= <span class="fl">1</span>/(<span class="fl">1</span>+sine); <span class="co">// Radius/(Radius+Side)</span></span>
<span id="cb4-39"><a href="#cb4-39"></a>  <span class="kw">#local CSide </span>= Coef*Side;</span>
<span id="cb4-40"><a href="#cb4-40"></a>  <span class="kw">#local CRadius </span>= Coef*Radius;</span>
<span id="cb4-41"><a href="#cb4-41"></a>  <span class="kw">#local invphi </span>= <span class="fl">1</span>/phi;</span>
<span id="cb4-42"><a href="#cb4-42"></a>  <span class="kw">#local I </span>= &lt;Radius*invphi,<span class="fl">0</span>&gt; + Center; <span class="co">// inversion pole</span></span>
<span id="cb4-43"><a href="#cb4-43"></a>  <span class="kw">#local k </span>= Radius*Radius*(<span class="fl">1</span>-invphi*invphi); <span class="co">// inversion power</span></span>
<span id="cb4-44"><a href="#cb4-44"></a>  <span class="kw">#local O1 </span>= &lt;<span class="fl">2</span>*invphi*Radius,<span class="fl">0</span>,<span class="fl">0</span>&gt;; <span class="co">// center of exterior sphere          </span></span>
<span id="cb4-45"><a href="#cb4-45"></a>  <span class="co">// -----------------------------------------------------------------</span></span>
<span id="cb4-46"><a href="#cb4-46"></a>  <span class="kw">union</span> { </span>
<span id="cb4-47"><a href="#cb4-47"></a>    <span class="co">// cyclides ------------------------------------------------------</span></span>
<span id="cb4-48"><a href="#cb4-48"></a>    <span class="ot">#if</span>(Depth=<span class="fl">1</span>)</span>
<span id="cb4-49"><a href="#cb4-49"></a>      <span class="kw">#local circle </span>= invertedCircle(I-Center, k, &lt;<span class="fl">0</span>,<span class="fl">0</span>&gt;, CRadius-CSide);</span>
<span id="cb4-50"><a href="#cb4-50"></a>      <span class="kw">#local r </span>= circle.<span class="kw">z</span>;</span>
<span id="cb4-51"><a href="#cb4-51"></a>      <span class="kw">#local center </span>= &lt;circle.<span class="kw">x</span>, circle.<span class="kw">y</span>&gt;;</span>
<span id="cb4-52"><a href="#cb4-52"></a>      <span class="kw">#local mu </span>= (Radius - r)/<span class="fl">2</span>;</span>
<span id="cb4-53"><a href="#cb4-53"></a>      <span class="kw">#local a </span>= (Radius + r)/<span class="fl">2</span>;</span>
<span id="cb4-54"><a href="#cb4-54"></a>      <span class="kw">#local c </span>= (circle.<span class="kw">x</span> - O1.<span class="kw">x</span>)/<span class="fl">2</span>;</span>
<span id="cb4-55"><a href="#cb4-55"></a>      <span class="kw">#local b </span>= <span class="kw">sqrt</span>(a*a-c*c);</span>
<span id="cb4-56"><a href="#cb4-56"></a>      <span class="kw">#local pt </span>= Center + center/<span class="fl">2</span>;</span>
<span id="cb4-57"><a href="#cb4-57"></a>      <span class="kw">#local O </span>= &lt;pt.<span class="kw">x</span> - O1.<span class="kw">x</span>/<span class="fl">2</span>, pt.<span class="kw">y</span>, <span class="fl">0</span>&gt;;</span>
<span id="cb4-58"><a href="#cb4-58"></a>      polynomial {<span class="fl">4</span> </span>
<span id="cb4-59"><a href="#cb4-59"></a>        xyz(<span class="fl">2</span>,<span class="fl">0</span>,<span class="fl">0</span>): <span class="fl">-2</span>*mu*mu+<span class="fl">2</span>*b*b<span class="fl">-4</span>*a*a,</span>
<span id="cb4-60"><a href="#cb4-60"></a>        xyz(<span class="fl">1</span>,<span class="fl">0</span>,<span class="fl">0</span>): <span class="fl">8</span>*a*c*mu,</span>
<span id="cb4-61"><a href="#cb4-61"></a>        xyz(<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span>): <span class="fl">-4</span>*c*c*mu*mu+mu*mu*mu*mu+b*b*b*b<span class="fl">-2</span>*mu*mu*b*b,</span>
<span id="cb4-62"><a href="#cb4-62"></a>        xyz(<span class="fl">0</span>,<span class="fl">2</span>,<span class="fl">0</span>): <span class="fl">-2</span>*mu*mu<span class="fl">-2</span>*b*b,</span>
<span id="cb4-63"><a href="#cb4-63"></a>        xyz(<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">2</span>): <span class="fl">-2</span>*mu*mu+<span class="fl">2</span>*b*b,</span>
<span id="cb4-64"><a href="#cb4-64"></a>        xyz(<span class="fl">2</span>,<span class="fl">2</span>,<span class="fl">0</span>): <span class="fl">2</span>,</span>
<span id="cb4-65"><a href="#cb4-65"></a>        xyz(<span class="fl">2</span>,<span class="fl">0</span>,<span class="fl">2</span>): <span class="fl">2</span>,</span>
<span id="cb4-66"><a href="#cb4-66"></a>        xyz(<span class="fl">0</span>,<span class="fl">2</span>,<span class="fl">2</span>): <span class="fl">2</span>,</span>
<span id="cb4-67"><a href="#cb4-67"></a>        xyz(<span class="fl">4</span>,<span class="fl">0</span>,<span class="fl">0</span>): <span class="fl">1</span>,</span>
<span id="cb4-68"><a href="#cb4-68"></a>        xyz(<span class="fl">0</span>,<span class="fl">4</span>,<span class="fl">0</span>): <span class="fl">1</span>,</span>
<span id="cb4-69"><a href="#cb4-69"></a>        xyz(<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">4</span>): <span class="fl">1</span></span>
<span id="cb4-70"><a href="#cb4-70"></a>        <span class="kw">texture</span> { </span>
<span id="cb4-71"><a href="#cb4-71"></a>          Dark_Green_Glass </span>
<span id="cb4-72"><a href="#cb4-72"></a>          <span class="kw">finish</span> {</span>
<span id="cb4-73"><a href="#cb4-73"></a>            <span class="kw">reflection</span> <span class="fl">0</span></span>
<span id="cb4-74"><a href="#cb4-74"></a>          }</span>
<span id="cb4-75"><a href="#cb4-75"></a>        }</span>
<span id="cb4-76"><a href="#cb4-76"></a>        <span class="kw">translate</span> O</span>
<span id="cb4-77"><a href="#cb4-77"></a>      }</span>
<span id="cb4-78"><a href="#cb4-78"></a>    <span class="ot">#end</span></span>
<span id="cb4-79"><a href="#cb4-79"></a>    <span class="co">// spheres -------------------------------------------------------</span></span>
<span id="cb4-80"><a href="#cb4-80"></a>    <span class="kw">#local i</span>=<span class="fl">1</span>;</span>
<span id="cb4-81"><a href="#cb4-81"></a>    <span class="ot">#while</span>(i&lt;=m)</span>
<span id="cb4-82"><a href="#cb4-82"></a>      <span class="kw">#local beta </span>= <span class="fl">2</span>*(i+shift)*<span class="fl">pi</span>/m; </span>
<span id="cb4-83"><a href="#cb4-83"></a>      <span class="kw">#local pti </span>= &lt;CRadius*<span class="kw">cos</span>(beta), CRadius*<span class="kw">sin</span>(beta)&gt; + Center;</span>
<span id="cb4-84"><a href="#cb4-84"></a>      <span class="kw">#local circle </span>= invertedCircle(I, k, pti, CSide);</span>
<span id="cb4-85"><a href="#cb4-85"></a>      <span class="kw">#local center </span>= &lt;circle.<span class="kw">x</span>, circle.<span class="kw">y</span>, <span class="fl">0</span>&gt; - O1;</span>
<span id="cb4-86"><a href="#cb4-86"></a>      <span class="kw">#local r </span>= circle.<span class="kw">z</span>;</span>
<span id="cb4-87"><a href="#cb4-87"></a>      <span class="ot">#if</span>(Depth=<span class="fl">1</span>)</span>
<span id="cb4-88"><a href="#cb4-88"></a>        <span class="kw">sphere</span> {</span>
<span id="cb4-89"><a href="#cb4-89"></a>          center, r-epsilon</span>
<span id="cb4-90"><a href="#cb4-90"></a>          <span class="kw">texture</span> {</span>
<span id="cb4-91"><a href="#cb4-91"></a>            Chrome_Metal</span>
<span id="cb4-92"><a href="#cb4-92"></a>            <span class="kw">finish</span> {</span>
<span id="cb4-93"><a href="#cb4-93"></a>              <span class="kw">ambient</span> <span class="fl">0.05</span></span>
<span id="cb4-94"><a href="#cb4-94"></a>              <span class="kw">diffuse</span> <span class="fl">2</span></span>
<span id="cb4-95"><a href="#cb4-95"></a>              <span class="kw">reflection</span> <span class="fl">0</span></span>
<span id="cb4-96"><a href="#cb4-96"></a>              <span class="kw">brilliance</span> <span class="fl">1</span></span>
<span id="cb4-97"><a href="#cb4-97"></a>              <span class="kw">specular</span> <span class="fl">1.08</span></span>
<span id="cb4-98"><a href="#cb4-98"></a>              <span class="kw">roughness</span> <span class="fl">0.01</span></span>
<span id="cb4-99"><a href="#cb4-99"></a>            }</span>
<span id="cb4-100"><a href="#cb4-100"></a>          }</span>
<span id="cb4-101"><a href="#cb4-101"></a>        }</span>
<span id="cb4-102"><a href="#cb4-102"></a>      <span class="ot">#else</span></span>
<span id="cb4-103"><a href="#cb4-103"></a>        Steiner3D(tail(n), phi, -shift, center, r, epsilon)</span>
<span id="cb4-104"><a href="#cb4-104"></a>      <span class="ot">#end</span></span>
<span id="cb4-105"><a href="#cb4-105"></a>      <span class="kw">#local i </span>= i+<span class="fl">1</span>;</span>
<span id="cb4-106"><a href="#cb4-106"></a>    <span class="ot">#end</span></span>
<span id="cb4-107"><a href="#cb4-107"></a>  } <span class="co">// end of union</span></span>
<span id="cb4-108"><a href="#cb4-108"></a><span class="ot">#end</span></span>
<span id="cb4-109"><a href="#cb4-109"></a></span>
<span id="cb4-110"><a href="#cb4-110"></a><span class="co">// ----------------------------- SCENE ---------------------------- //</span></span>
<span id="cb4-111"><a href="#cb4-111"></a><span class="co">// sky ---------------------------------------------------------------</span></span>
<span id="cb4-112"><a href="#cb4-112"></a><span class="kw">#declare D </span>= <span class="fl">.5</span>;</span>
<span id="cb4-113"><a href="#cb4-113"></a><span class="kw">sky_sphere</span> {</span>
<span id="cb4-114"><a href="#cb4-114"></a>  <span class="kw">pigment</span> {</span>
<span id="cb4-115"><a href="#cb4-115"></a>    <span class="kw">crackle</span></span>
<span id="cb4-116"><a href="#cb4-116"></a>    <span class="kw">color_map</span> {</span>
<span id="cb4-117"><a href="#cb4-117"></a>      [<span class="kw">pow</span>(<span class="fl">0.5</span>, D) <span class="kw">color</span> Black]</span>
<span id="cb4-118"><a href="#cb4-118"></a>      [<span class="kw">pow</span>(<span class="fl">0.6</span>, D) <span class="kw">color</span> White*<span class="fl">10</span>]</span>
<span id="cb4-119"><a href="#cb4-119"></a>    }</span>
<span id="cb4-120"><a href="#cb4-120"></a>    <span class="kw">scale</span> <span class="fl">.005</span>/D</span>
<span id="cb4-121"><a href="#cb4-121"></a>  }</span>
<span id="cb4-122"><a href="#cb4-122"></a>}</span>
<span id="cb4-123"><a href="#cb4-123"></a></span>
<span id="cb4-124"><a href="#cb4-124"></a><span class="co">// ----------------------------- plot ----------------------------- //</span></span>
<span id="cb4-125"><a href="#cb4-125"></a><span class="kw">#declare Center </span>= &lt;<span class="fl">0</span>,<span class="fl">0</span>&gt;; <span class="co">// arbitrary </span></span>
<span id="cb4-126"><a href="#cb4-126"></a><span class="kw">#declare Radius </span>= <span class="fl">3</span>; <span class="co">// arbitrary &gt;0</span></span>
<span id="cb4-127"><a href="#cb4-127"></a></span>
<span id="cb4-128"><a href="#cb4-128"></a><span class="co">// camera and light source -------------------------------------------</span></span>
<span id="cb4-129"><a href="#cb4-129"></a><span class="kw">camera</span> {</span>
<span id="cb4-130"><a href="#cb4-130"></a>  <span class="kw">location</span> &lt;<span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">-12</span>&gt;</span>
<span id="cb4-131"><a href="#cb4-131"></a>  <span class="kw">look_at</span> &lt;Center.<span class="kw">x</span>, Center.<span class="kw">y</span>, <span class="fl">0</span>&gt;</span>
<span id="cb4-132"><a href="#cb4-132"></a>  <span class="kw">angle</span> <span class="fl">40</span></span>
<span id="cb4-133"><a href="#cb4-133"></a>  <span class="kw">rotate</span> &lt;<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span>&gt;</span>
<span id="cb4-134"><a href="#cb4-134"></a>}</span>
<span id="cb4-135"><a href="#cb4-135"></a><span class="kw">light_source</span> { &lt;<span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">-60</span>&gt; White }</span>
<span id="cb4-136"><a href="#cb4-136"></a></span>
<span id="cb4-137"><a href="#cb4-137"></a><span class="co">//</span></span>
<span id="cb4-138"><a href="#cb4-138"></a><span class="kw">#declare n </span>= <span class="kw">array</span>[<span class="fl">3</span>] {<span class="fl">3</span>,<span class="fl">4</span>,<span class="fl">6</span>};</span>
<span id="cb4-139"><a href="#cb4-139"></a><span class="kw">#declare phi </span>= <span class="fl">0.3</span>;</span>
<span id="cb4-140"><a href="#cb4-140"></a><span class="kw">#declare nframes </span>= <span class="fl">45</span>;</span>
<span id="cb4-141"><a href="#cb4-141"></a><span class="kw">#declare shift </span>= <span class="kw">frame_number</span>/nframes; </span>
<span id="cb4-142"><a href="#cb4-142"></a><span class="kw">object</span> {</span>
<span id="cb4-143"><a href="#cb4-143"></a>  Steiner3D(n, phi, shift, Center, Radius, <span class="fl">0.005</span>)</span>
<span id="cb4-144"><a href="#cb4-144"></a>  <span class="kw">rotate</span> &lt;<span class="fl">50</span>, <span class="fl">0</span>, <span class="fl">0</span>&gt;</span>
<span id="cb4-145"><a href="#cb4-145"></a>  <span class="kw">translate</span> &lt;<span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">5</span>&gt;</span>
<span id="cb4-146"><a href="#cb4-146"></a>  <span class="kw">scale</span> <span class="fl">1.85</span></span>
<span id="cb4-147"><a href="#cb4-147"></a>}</span>
<span id="cb4-148"><a href="#cb4-148"></a></span>
<span id="cb4-149"><a href="#cb4-149"></a><span class="co">/* ini file ----------------------------------------------------------</span></span>
<span id="cb4-150"><a href="#cb4-150"></a><span class="co">Antialias = On</span></span>
<span id="cb4-151"><a href="#cb4-151"></a><span class="co">Antialias_Threshold = 0.3</span></span>
<span id="cb4-152"><a href="#cb4-152"></a><span class="co">Antialias_Depth = 3</span></span>
<span id="cb4-153"><a href="#cb4-153"></a><span class="co">Input_File_Name = SteinerChain.pov</span></span>
<span id="cb4-154"><a href="#cb4-154"></a><span class="co">Initial_Frame = 1</span></span>
<span id="cb4-155"><a href="#cb4-155"></a><span class="co">Final_Frame = 45</span></span>
<span id="cb4-156"><a href="#cb4-156"></a><span class="co">Cyclic_Animation = on</span></span>
<span id="cb4-157"><a href="#cb4-157"></a><span class="co">Pause_when_Done = off</span></span>
<span id="cb4-158"><a href="#cb4-158"></a><span class="co">------------------------------------------------------------------- */</span></span></code></pre></div>
<p><img src="figures/SteinerChain_POVRAY.gif" /></p>
<p><br/></p>
<p>We get a nice result when we map a picture to the spheres:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode numberSource povray numberLines"><code class="sourceCode povray"><span id="cb5-1"><a href="#cb5-1"></a><span class="ot">#if</span>(Depth=<span class="fl">1</span>)</span>
<span id="cb5-2"><a href="#cb5-2"></a>  <span class="kw">sphere</span> {</span>
<span id="cb5-3"><a href="#cb5-3"></a>    center, r-epsilon</span>
<span id="cb5-4"><a href="#cb5-4"></a>    <span class="kw">pigment</span>{</span>
<span id="cb5-5"><a href="#cb5-5"></a>      <span class="kw">image_map</span> {</span>
<span id="cb5-6"><a href="#cb5-6"></a>        <span class="dt">png</span> <span class="st">&quot;R-Ladies.png&quot;</span></span>
<span id="cb5-7"><a href="#cb5-7"></a>        <span class="kw">interpolate</span> <span class="fl">2</span></span>
<span id="cb5-8"><a href="#cb5-8"></a>      }</span>
<span id="cb5-9"><a href="#cb5-9"></a>      <span class="kw">scale</span> <span class="fl">1.1</span>*<span class="kw">sqrt</span>(r)</span>
<span id="cb5-10"><a href="#cb5-10"></a>    }</span>
<span id="cb5-11"><a href="#cb5-11"></a>  }</span>
<span id="cb5-12"><a href="#cb5-12"></a><span class="ot">#else</span></span></code></pre></div>
<p><img src="figures/SteinerChain_POVRAY2.gif" /></p>
<h1 id="with-asymptote">With Asymptote</h1>
<p>This Asymptote program produces the frames of the animation:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode numberSource cpp numberLines"><code class="sourceCode cpp"><span id="cb6-1"><a href="#cb6-1"></a>settings.render = <span class="dv">4</span>;</span>
<span id="cb6-2"><a href="#cb6-2"></a>settings.outformat = <span class="st">&quot;eps&quot;</span>;</span>
<span id="cb6-3"><a href="#cb6-3"></a></span>
<span id="cb6-4"><a href="#cb6-4"></a><span class="co">// -------------------------------------------------------------------</span></span>
<span id="cb6-5"><a href="#cb6-5"></a><span class="kw">import</span> solids;</span>
<span id="cb6-6"><a href="#cb6-6"></a></span>
<span id="cb6-7"><a href="#cb6-7"></a><span class="co">// files to create</span></span>
<span id="cb6-8"><a href="#cb6-8"></a>string[] files = {</span>
<span id="cb6-9"><a href="#cb6-9"></a>    <span class="st">&quot;SC-000&quot;</span>, <span class="st">&quot;SC-001&quot;</span>, <span class="st">&quot;SC-002&quot;</span>, <span class="st">&quot;SC-003&quot;</span>, <span class="st">&quot;SC-004&quot;</span>, <span class="st">&quot;SC-005&quot;</span>,</span>
<span id="cb6-10"><a href="#cb6-10"></a>    <span class="st">&quot;SC-006&quot;</span>, <span class="st">&quot;SC-007&quot;</span>, <span class="st">&quot;SC-008&quot;</span>, <span class="st">&quot;SC-009&quot;</span>, <span class="st">&quot;SC-010&quot;</span>, <span class="st">&quot;SC-011&quot;</span>,</span>
<span id="cb6-11"><a href="#cb6-11"></a>    <span class="st">&quot;SC-012&quot;</span>, <span class="st">&quot;SC-013&quot;</span>, <span class="st">&quot;SC-014&quot;</span>, <span class="st">&quot;SC-015&quot;</span>, <span class="st">&quot;SC-016&quot;</span>, <span class="st">&quot;SC-017&quot;</span>,</span>
<span id="cb6-12"><a href="#cb6-12"></a>    <span class="st">&quot;SC-018&quot;</span>, <span class="st">&quot;SC-019&quot;</span>, <span class="st">&quot;SC-020&quot;</span>, <span class="st">&quot;SC-021&quot;</span>, <span class="st">&quot;SC-022&quot;</span>, <span class="st">&quot;SC-023&quot;</span>,</span>
<span id="cb6-13"><a href="#cb6-13"></a>    <span class="st">&quot;SC-024&quot;</span>, <span class="st">&quot;SC-025&quot;</span>, <span class="st">&quot;SC-026&quot;</span>, <span class="st">&quot;SC-027&quot;</span>, <span class="st">&quot;SC-028&quot;</span>, <span class="st">&quot;SC-029&quot;</span>,</span>
<span id="cb6-14"><a href="#cb6-14"></a>    <span class="st">&quot;SC-030&quot;</span>, <span class="st">&quot;SC-031&quot;</span>, <span class="st">&quot;SC-032&quot;</span>, <span class="st">&quot;SC-033&quot;</span>, <span class="st">&quot;SC-034&quot;</span>, <span class="st">&quot;SC-035&quot;</span>,</span>
<span id="cb6-15"><a href="#cb6-15"></a>    <span class="st">&quot;SC-036&quot;</span>, <span class="st">&quot;SC-037&quot;</span>, <span class="st">&quot;SC-038&quot;</span>, <span class="st">&quot;SC-039&quot;</span>, <span class="st">&quot;SC-040&quot;</span>, <span class="st">&quot;SC-041&quot;</span>,</span>
<span id="cb6-16"><a href="#cb6-16"></a>    <span class="st">&quot;SC-042&quot;</span>, <span class="st">&quot;SC-043&quot;</span>, <span class="st">&quot;SC-044&quot;</span>};</span>
<span id="cb6-17"><a href="#cb6-17"></a></span>
<span id="cb6-18"><a href="#cb6-18"></a><span class="co">// camera and light --------------------------------------------------</span></span>
<span id="cb6-19"><a href="#cb6-19"></a>size(<span class="dv">10</span><span class="er">cm</span>);</span>
<span id="cb6-20"><a href="#cb6-20"></a>currentprojection = orthographic(<span class="dv">2</span>,<span class="dv">2</span>,<span class="dv">6</span>);</span>
<span id="cb6-21"><a href="#cb6-21"></a>currentlight = (<span class="dv">20</span>,<span class="dv">20</span>,<span class="dv">60</span>);</span>
<span id="cb6-22"><a href="#cb6-22"></a>currentlight.background = black;</span>
<span id="cb6-23"><a href="#cb6-23"></a>viewportmargin = (<span class="dv">10</span>,<span class="dv">10</span>);</span>
<span id="cb6-24"><a href="#cb6-24"></a></span>
<span id="cb6-25"><a href="#cb6-25"></a><span class="co">// image of the circle (Center,Radius) by inversion pole c power k ---</span></span>
<span id="cb6-26"><a href="#cb6-26"></a><span class="kw">struct</span> Circle {</span>
<span id="cb6-27"><a href="#cb6-27"></a>  pair center;</span>
<span id="cb6-28"><a href="#cb6-28"></a>  real radius;</span>
<span id="cb6-29"><a href="#cb6-29"></a>}</span>
<span id="cb6-30"><a href="#cb6-30"></a>Circle invertedCircle(pair c, real k, pair Center, real Radius){</span>
<span id="cb6-31"><a href="#cb6-31"></a>    real r = sqrt(abs(k));</span>
<span id="cb6-32"><a href="#cb6-32"></a>    pair z1 = sgn(k) * (Center-c)/r;</span>
<span id="cb6-33"><a href="#cb6-33"></a>    real D1 = Radius*Radius/r/r - dot(z1,z1);</span>
<span id="cb6-34"><a href="#cb6-34"></a>    pair z2 = -z1/D1;</span>
<span id="cb6-35"><a href="#cb6-35"></a>    real R2 = sqrt(dot(z2,z2) + <span class="dv">1</span>/D1);</span>
<span id="cb6-36"><a href="#cb6-36"></a>    Circle out;</span>
<span id="cb6-37"><a href="#cb6-37"></a>    out.center = r*z2 + c;</span>
<span id="cb6-38"><a href="#cb6-38"></a>    out.radius = r*R2;</span>
<span id="cb6-39"><a href="#cb6-39"></a>    <span class="cf">return</span> out;</span>
<span id="cb6-40"><a href="#cb6-40"></a>}</span>
<span id="cb6-41"><a href="#cb6-41"></a></span>
<span id="cb6-42"><a href="#cb6-42"></a><span class="co">// -------------------------------------------------------------------</span></span>
<span id="cb6-43"><a href="#cb6-43"></a><span class="kw">struct</span> Sphere {</span>
<span id="cb6-44"><a href="#cb6-44"></a>    triple center;</span>
<span id="cb6-45"><a href="#cb6-45"></a>    real radius;</span>
<span id="cb6-46"><a href="#cb6-46"></a>}</span>
<span id="cb6-47"><a href="#cb6-47"></a></span>
<span id="cb6-48"><a href="#cb6-48"></a><span class="co">// -------------------------------------------------------------------</span></span>
<span id="cb6-49"><a href="#cb6-49"></a><span class="kw">struct</span> Cyclide {</span>
<span id="cb6-50"><a href="#cb6-50"></a>  real mu;</span>
<span id="cb6-51"><a href="#cb6-51"></a>  real a;</span>
<span id="cb6-52"><a href="#cb6-52"></a>  real c;</span>
<span id="cb6-53"><a href="#cb6-53"></a>  triple shift;</span>
<span id="cb6-54"><a href="#cb6-54"></a>}</span>
<span id="cb6-55"><a href="#cb6-55"></a></span>
<span id="cb6-56"><a href="#cb6-56"></a><span class="co">// -------------------------------------------------------------------</span></span>
<span id="cb6-57"><a href="#cb6-57"></a><span class="co">// n: array of length depth, the numbers of spheres for each step</span></span>
<span id="cb6-58"><a href="#cb6-58"></a><span class="co">// phi: number -1 &lt; phi &lt; 1, phi /= 0 </span></span>
<span id="cb6-59"><a href="#cb6-59"></a><span class="co">// shift: number 0 &lt;= shift &lt; 1</span></span>
<span id="cb6-60"><a href="#cb6-60"></a><span class="dt">void</span> Steiner3D(Sphere[] spheres, Cyclide[] cyclides, <span class="dt">int</span>[] n, real phi, </span>
<span id="cb6-61"><a href="#cb6-61"></a>                <span class="dt">int</span> depth, real shift, pair Center = (<span class="dv">0</span>,<span class="dv">0</span>), real Radius = <span class="dv">2</span>){</span>
<span id="cb6-62"><a href="#cb6-62"></a>    real m = n[<span class="dv">0</span>];</span>
<span id="cb6-63"><a href="#cb6-63"></a>    real sine = sin(pi/m);</span>
<span id="cb6-64"><a href="#cb6-64"></a>    real Side = Radius*sine; <span class="co">// side length of the m-gon </span></span>
<span id="cb6-65"><a href="#cb6-65"></a>    real Coef = <span class="dv">1</span>/(<span class="dv">1</span>+sine); <span class="co">// Radius/(Radius+Side)</span></span>
<span id="cb6-66"><a href="#cb6-66"></a>    real CSide = Coef*Side;</span>
<span id="cb6-67"><a href="#cb6-67"></a>    real CRadius = Coef*Radius;</span>
<span id="cb6-68"><a href="#cb6-68"></a>    real invphi = <span class="dv">1</span>/phi;</span>
<span id="cb6-69"><a href="#cb6-69"></a>    pair I = (Radius*invphi,<span class="dv">0</span>) + Center; <span class="co">// inversion pole</span></span>
<span id="cb6-70"><a href="#cb6-70"></a>    real k = Radius*Radius*(<span class="dv">1</span>-invphi*invphi); <span class="co">// inversion power</span></span>
<span id="cb6-71"><a href="#cb6-71"></a>    real O1x = <span class="dv">2</span>*invphi*Radius; <span class="co">// (O1x,0,0) center of exterior sphere </span></span>
<span id="cb6-72"><a href="#cb6-72"></a>    <span class="co">// -----------------------------------------------------------------</span></span>
<span id="cb6-73"><a href="#cb6-73"></a>    <span class="cf">if</span>(depth == <span class="dv">1</span>){</span>
<span id="cb6-74"><a href="#cb6-74"></a>        Cyclide newcyclide;</span>
<span id="cb6-75"><a href="#cb6-75"></a>        Circle circle = invertedCircle(I-Center, k, (<span class="dv">0</span>,<span class="dv">0</span>), CRadius-CSide);</span>
<span id="cb6-76"><a href="#cb6-76"></a>        newcyclide.mu = (Radius - circle.radius)/<span class="dv">2</span>;</span>
<span id="cb6-77"><a href="#cb6-77"></a>        newcyclide.a = (Radius + circle.radius)/<span class="dv">2</span>;</span>
<span id="cb6-78"><a href="#cb6-78"></a>        newcyclide.c = (circle.center.x - O1x)/<span class="dv">2</span>;</span>
<span id="cb6-79"><a href="#cb6-79"></a>        pair pt = Center + circle.center/<span class="dv">2</span>;</span>
<span id="cb6-80"><a href="#cb6-80"></a>        newcyclide.shift = (pt.x - O1x/<span class="dv">2</span>, pt.y, <span class="dv">0</span>);</span>
<span id="cb6-81"><a href="#cb6-81"></a>        cyclides.push(newcyclide);</span>
<span id="cb6-82"><a href="#cb6-82"></a>    } </span>
<span id="cb6-83"><a href="#cb6-83"></a>    <span class="co">// -----------------------------------------------------------------</span></span>
<span id="cb6-84"><a href="#cb6-84"></a>    <span class="cf">for</span>(<span class="dt">int</span> i = <span class="dv">0</span>; i &lt; m; ++i){</span>
<span id="cb6-85"><a href="#cb6-85"></a>        real beta = <span class="dv">2</span>*(i+shift)*pi/m;</span>
<span id="cb6-86"><a href="#cb6-86"></a>        pair pti = (CRadius*cos(beta), CRadius*sin(beta)) + Center;</span>
<span id="cb6-87"><a href="#cb6-87"></a>        Circle circle = invertedCircle(I, k, pti, CSide);</span>
<span id="cb6-88"><a href="#cb6-88"></a>        pair center = (circle.center.x - O1x, circle.center.y);</span>
<span id="cb6-89"><a href="#cb6-89"></a>        real r = circle.radius;</span>
<span id="cb6-90"><a href="#cb6-90"></a>        <span class="cf">if</span>(depth == <span class="dv">1</span>){</span>
<span id="cb6-91"><a href="#cb6-91"></a>            Sphere newsphere;</span>
<span id="cb6-92"><a href="#cb6-92"></a>            newsphere.center = (center.x, center.y, <span class="dv">0</span>);</span>
<span id="cb6-93"><a href="#cb6-93"></a>            newsphere.radius = r;</span>
<span id="cb6-94"><a href="#cb6-94"></a>            spheres.push(newsphere);</span>
<span id="cb6-95"><a href="#cb6-95"></a>        }<span class="cf">else</span>{</span>
<span id="cb6-96"><a href="#cb6-96"></a>            Steiner3D(spheres, cyclides, n[<span class="dv">1</span>:], phi, depth-<span class="dv">1</span>, -shift, </span>
<span id="cb6-97"><a href="#cb6-97"></a>                center, r);</span>
<span id="cb6-98"><a href="#cb6-98"></a>        }</span>
<span id="cb6-99"><a href="#cb6-99"></a>    }</span>
<span id="cb6-100"><a href="#cb6-100"></a>}</span>
<span id="cb6-101"><a href="#cb6-101"></a></span>
<span id="cb6-102"><a href="#cb6-102"></a><span class="co">// -------------------------------------------------------------------</span></span>
<span id="cb6-103"><a href="#cb6-103"></a><span class="dt">int</span>[] n = {<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>};</span>
<span id="cb6-104"><a href="#cb6-104"></a>real phi = <span class="fl">0.4</span>;</span>
<span id="cb6-105"><a href="#cb6-105"></a><span class="dt">int</span> depth = n.length;</span>
<span id="cb6-106"><a href="#cb6-106"></a></span>
<span id="cb6-107"><a href="#cb6-107"></a>path3 boundingbox = circle(c=O, r=<span class="fl">2.1</span>, normal=Z);</span>
<span id="cb6-108"><a href="#cb6-108"></a></span>
<span id="cb6-109"><a href="#cb6-109"></a>real epsilon = <span class="fl">0.005</span>;</span>
<span id="cb6-110"><a href="#cb6-110"></a></span>
<span id="cb6-111"><a href="#cb6-111"></a><span class="cf">for</span>(<span class="dt">int</span> k = <span class="dv">0</span>; k &lt; files.length; ++k){</span>
<span id="cb6-112"><a href="#cb6-112"></a>    <span class="co">// compute spheres and cyclides ------------------------------------</span></span>
<span id="cb6-113"><a href="#cb6-113"></a>    Sphere[] spheres = <span class="kw">new</span> Sphere[<span class="dv">0</span>];</span>
<span id="cb6-114"><a href="#cb6-114"></a>    Cyclide[] cyclides = <span class="kw">new</span> Cyclide[<span class="dv">0</span>];</span>
<span id="cb6-115"><a href="#cb6-115"></a>    real shift = k/files.length;</span>
<span id="cb6-116"><a href="#cb6-116"></a>    Steiner3D(spheres, cyclides, n, phi, depth, shift);</span>
<span id="cb6-117"><a href="#cb6-117"></a>    <span class="co">//</span></span>
<span id="cb6-118"><a href="#cb6-118"></a>    picture pic;</span>
<span id="cb6-119"><a href="#cb6-119"></a>    draw(pic, boundingbox, black+opacity(<span class="dv">0</span>));</span>
<span id="cb6-120"><a href="#cb6-120"></a>    <span class="co">// draw the spheres ------------------------------------------------</span></span>
<span id="cb6-121"><a href="#cb6-121"></a>    <span class="cf">for</span>(<span class="dt">int</span> i = <span class="dv">0</span>; i &lt; spheres.length; ++i){</span>
<span id="cb6-122"><a href="#cb6-122"></a>        Sphere s = spheres[i];</span>
<span id="cb6-123"><a href="#cb6-123"></a>        draw(pic, surface(sphere(s.center, s.radius-epsilon)), </span>
<span id="cb6-124"><a href="#cb6-124"></a>          rgb(<span class="st">&quot;8c2981ff&quot;</span>));</span>
<span id="cb6-125"><a href="#cb6-125"></a>    }</span>
<span id="cb6-126"><a href="#cb6-126"></a>    <span class="co">// draw the cyclides -----------------------------------------------</span></span>
<span id="cb6-127"><a href="#cb6-127"></a>    <span class="cf">for</span>(<span class="dt">int</span> i = <span class="dv">0</span>; i &lt; cyclides.length; ++i){</span>
<span id="cb6-128"><a href="#cb6-128"></a>        Cyclide c = cyclides[i];</span>
<span id="cb6-129"><a href="#cb6-129"></a>        real b = sqrt(c.a*c.a-c.c*c.c);</span>
<span id="cb6-130"><a href="#cb6-130"></a>        triple F(pair uv){</span>
<span id="cb6-131"><a href="#cb6-131"></a>            real h = c.a-c.c*cos(uv.x)*cos(uv.y);</span>
<span id="cb6-132"><a href="#cb6-132"></a>            real x = (c.mu*(c.c-c.a*cos(uv.x)*cos(uv.y))+b*b*cos(uv.x))/h;</span>
<span id="cb6-133"><a href="#cb6-133"></a>            real y = (b*sin(uv.x)*(c.a-c.mu*cos(uv.y)))/h;</span>
<span id="cb6-134"><a href="#cb6-134"></a>            real z = b*sin(uv.y)*(c.c*cos(uv.x)-c.mu)/h;</span>
<span id="cb6-135"><a href="#cb6-135"></a>            <span class="cf">return</span> (x,y,z);</span>
<span id="cb6-136"><a href="#cb6-136"></a>        }</span>
<span id="cb6-137"><a href="#cb6-137"></a>        surface s = surface(F, (<span class="dv">0</span>,<span class="dv">0</span>), (<span class="dv">2</span><span class="er">pi</span>,<span class="dv">2</span><span class="er">pi</span>), <span class="dv">40</span>, <span class="dv">40</span>, Spline);</span>
<span id="cb6-138"><a href="#cb6-138"></a>        draw(pic, shift(c.shift)*s, yellow+opacity(<span class="fl">0.2</span>));</span>
<span id="cb6-139"><a href="#cb6-139"></a>    }</span>
<span id="cb6-140"><a href="#cb6-140"></a>    <span class="co">// -----------------------------------------------------------------</span></span>
<span id="cb6-141"><a href="#cb6-141"></a>    add(pic);</span>
<span id="cb6-142"><a href="#cb6-142"></a>    shipout(files[k], bbox(black, FillDraw(black)));</span>
<span id="cb6-143"><a href="#cb6-143"></a>    erase();</span>
<span id="cb6-144"><a href="#cb6-144"></a>}</span></code></pre></div>
<p><img src="figures/SteinerChain_Asymptote.gif" /></p>
<h1 id="with-three.js">With three.js</h1>
<p>Here is a variant with <code>three.js</code>. I replaced the spheres with “Barth polyedra”.</p>
<iframe src="../frames/threejs_BarthPolyhedronSteiner.html" width="100%" height="500px" scrolling="no" frameborder="0">
</iframe>

        </div>


        <div id="footer">
          Site proudly generated by
          <a href="http://jaspervdj.be/hakyll">Hakyll</a>
        </div>

      </div>

    </div>

    <div class="row">
      <div class="col-sm-12">
        <div id="disqus_thread"></div>
        <div class="pagination">
          <ul>
            <li>
              <a href="http://laustep.github.io/stlahblog/">&#171; Back Home</a>
            </li>
          </ul>
        </div>
      </div>
    </div>
    
  </div>

</body>

<script src="/libraries/bootstrap/bootstrap.min.js"></script>
<script>
  var disqus_developer = 1;
  var disqus_shortname = 'stlapblog';
  // required: replace example with your forum shortname
  /* * * DON'T EDIT BELOW THIS LINE * * */
  (function () {
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = 'https://' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] ||
      document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>
<noscript>Please enable JavaScript to view the
  <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a>
</noscript>
<!-- MathJax: Fall back to local if CDN offline but local image fonts are not supported (saves >100MB) -->
<script type="text/x-mathjax-config" src="/libraries/mathjax/config/TeX-MML-AM_CHTML.js"></script>
<!-- <script>
  window.MathJax || document.write('<script type="text/x-mathjax-config">MathJax.Hub.Config({"HTML-CSS":{imageFont:null}});<\/script><script src="../libraries/mathjax/MathJax.js"><\/script>');
</script> -->


</html>]]></description>
    <pubDate>Sat, 13 Jul 2019 00:00:00 UT</pubDate>
    <guid>https://laustep.github.io/stlahblog/posts/SteinerChains.html</guid>
    <dc:creator>Stéphane Laurent</dc:creator>
    <category>R</category>
</item>



<item>
    <title>Plotting the columns of a Datatable</title>
    <link>https://laustep.github.io/stlahblog/posts/PlotDatatableColumns.html</link>
    <description><![CDATA[<!DOCTYPE HTML>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Saturn Elephant - Plotting the columns of a Datatable</title>
  <link href="/libraries/bootstrap/bootstrap-grid.min.css" rel="stylesheet">
  <link rel="stylesheet" href="/css/default2.css" />
  <link rel="stylesheet" href="/css/post.css" />
  <link rel="stylesheet" href="/css/misc.css" /> 
  
    <link rel="stylesheet" href="/css/pandoc-solarized.css" /> 
   
  
  <link href="https://fonts.googleapis.com/css?family=Raleway:400,600,200,800" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/css?family=Droid+Sans" rel="stylesheet" type="text/css">
  <script src="/libraries/jquery.min.js"></script>
  <script type="text/javascript" async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML"></script>
</head>

<body>
  <div class="container-fluid">
    <div class="row">
      <!-- Sidebar. -->
      <div class="sidebar col-sm-2">
        <div class="row">
          <div class="col-sm-12" style="float:right;clear:both;margin-right:50px;margin-top:50px;">
            <a href="https://www.r-bloggers.com/">
              <img src="/images/Rbloggers.png" alt="Rbloggers" width="100%" />
            </a>
            <br/>
            <a href="http://t-redactyl.io/">
              <span style="color:black;font-weight:bold;font-family:sans-serif;font-size:25px;">Standard error</span>
            </a>
            <a href="http://timelyportfolio.blogspot.be/">
              <span style="color:grey;font-weight:bold;font-family:sans-serif;font-size:24px;">Timely portfolio</span>
            </a>
            <br/>
            <a href="https://antoineguillot.wordpress.com/blog/">
              <span style="color:white;background-color:darkblue;font-weight:bold;font-family:sans-serif;font-size:21px;border:5px solid;border-color:darkblue">ENHANCE DATA</span>
            </a>
            <br/>
            <a href="https://fronkonstin.com/">
              <span style="color:black;background-color:gold;font-weight:bold;font-size:29px;border:3px solid;border-color:gold;">Fronkonstin</span>
            </a>
          </div>
        </div>
        <div id="logos">
          <div class="row">
            <div class="col-sm-4">
              <img src="/images/AsymptoteLogo.svg" style="width: 150%; transform: rotateZ(-35deg)"/>
            </div>
            <div class="col-sm-4">
              <img src="/images/Rlogo.svg" style="width: 110%;"/>
            </div>
            <div class="col-sm-4">
              <img src="/images/shiny-hex.png" style="width: 90%;"/>
            </div>
          </div>
          <div class="row">
            <div class="col-sm-4">
              <img src="/images/Povray_logo_sphere.png" style="width: 105%;"/>
            </div>
            <div class="col-sm-4">
              <img src="/images/javascript.svg" style="width: 90%;"/>
            </div>
            <div class="col-sm-4">
              <img src="/images/haskell.svg" style="width: 110%;"/>
            </div>
          </div>
        </div>
      </div>

      <div class="main col-sm-10">
        <div id="header">
          <div id="logo">
            <a href="/">
              <img src="/images/stla.jpg" alt="stla" width="100px" />
            </a>
          </div>
          <div id="navigation" style="margin-top:50px;">
            <a href="/">Home</a>
            <a href="/about.html">About</a>
            <a href="/contact.html">Contact</a>
            <a href="/archive.html">Archive</a>
          </div>
        </div>

        <div class="content">
          <h1>Plotting the columns of a Datatable</h1> 
          <div class="info">
    Posted on July 10, 2019
    
        by Stéphane Laurent
    
</div>
<div class="info">
    
    Tags: <a title="All pages tagged &#39;R&#39;." href="/tags/R.html">R</a>, <a title="All pages tagged &#39;shiny&#39;." href="/tags/shiny.html">shiny</a>, <a title="All pages tagged &#39;datatables&#39;." href="/tags/datatables.html">datatables</a>
    
</div>

<p><img src="figures/PlotDatatableColumns.gif" /></p>
<p><br/></p>
<p>Here is the code of this app:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a><span class="kw">library</span>(shiny)</span>
<span id="cb1-2"><a href="#cb1-2"></a><span class="kw">library</span>(shinyBS)</span>
<span id="cb1-3"><a href="#cb1-3"></a><span class="kw">library</span>(DT)</span>
<span id="cb1-4"><a href="#cb1-4"></a><span class="kw">library</span>(ggplot2)</span>
<span id="cb1-5"><a href="#cb1-5"></a></span>
<span id="cb1-6"><a href="#cb1-6"></a>ui &lt;-<span class="st"> </span><span class="kw">fluidPage</span>(</span>
<span id="cb1-7"><a href="#cb1-7"></a>  <span class="kw">uiOutput</span>(<span class="st">&quot;modals&quot;</span>),</span>
<span id="cb1-8"><a href="#cb1-8"></a>  <span class="kw">DTOutput</span>(<span class="st">&quot;table&quot;</span>)</span>
<span id="cb1-9"><a href="#cb1-9"></a>)</span>
<span id="cb1-10"><a href="#cb1-10"></a></span>
<span id="cb1-11"><a href="#cb1-11"></a>server &lt;-<span class="st"> </span><span class="cf">function</span>(input, output, session){</span>
<span id="cb1-12"><a href="#cb1-12"></a></span>
<span id="cb1-13"><a href="#cb1-13"></a>  dat &lt;-<span class="st"> </span>iris</span>
<span id="cb1-14"><a href="#cb1-14"></a></span>
<span id="cb1-15"><a href="#cb1-15"></a>  buttons &lt;-<span class="st"> </span><span class="kw">lapply</span>(<span class="dv">1</span><span class="op">:</span><span class="kw">ncol</span>(dat), <span class="cf">function</span>(i){</span>
<span id="cb1-16"><a href="#cb1-16"></a>    <span class="kw">actionButton</span>(</span>
<span id="cb1-17"><a href="#cb1-17"></a>      <span class="kw">paste0</span>(<span class="st">&quot;this_id_is_not_used&quot;</span>,i),</span>
<span id="cb1-18"><a href="#cb1-18"></a>      <span class="st">&quot;plot&quot;</span>,</span>
<span id="cb1-19"><a href="#cb1-19"></a>      <span class="dt">class =</span> <span class="st">&quot;btn-primary btn-sm&quot;</span>,</span>
<span id="cb1-20"><a href="#cb1-20"></a>      <span class="dt">style =</span> <span class="st">&quot;border-radius: 50%;&quot;</span>, </span>
<span id="cb1-21"><a href="#cb1-21"></a>      <span class="dt">onclick =</span> <span class="kw">sprintf</span>(</span>
<span id="cb1-22"><a href="#cb1-22"></a>        <span class="st">&quot;Shiny.setInputValue(&#39;button&#39;, %d, {priority:&#39;event&#39;});</span></span>
<span id="cb1-23"><a href="#cb1-23"></a><span class="st">        $(&#39;#modal%d&#39;).modal(&#39;show&#39;);&quot;</span>, i, i)</span>
<span id="cb1-24"><a href="#cb1-24"></a>    )</span>
<span id="cb1-25"><a href="#cb1-25"></a>  })</span>
<span id="cb1-26"><a href="#cb1-26"></a>  </span>
<span id="cb1-27"><a href="#cb1-27"></a>  output[[<span class="st">&quot;table&quot;</span>]] &lt;-<span class="st"> </span><span class="kw">renderDT</span>({</span>
<span id="cb1-28"><a href="#cb1-28"></a>    sketch &lt;-<span class="st"> </span>tags<span class="op">$</span><span class="kw">table</span>(</span>
<span id="cb1-29"><a href="#cb1-29"></a>      <span class="dt">class =</span> <span class="st">&quot;row-border stripe hover compact&quot;</span>,</span>
<span id="cb1-30"><a href="#cb1-30"></a>      <span class="kw">tableHeader</span>(<span class="kw">c</span>(<span class="st">&quot;&quot;</span>, <span class="kw">names</span>(dat))),</span>
<span id="cb1-31"><a href="#cb1-31"></a>      <span class="kw">tableFooter</span>(<span class="kw">c</span>(<span class="st">&quot;&quot;</span>, buttons))</span>
<span id="cb1-32"><a href="#cb1-32"></a>    )</span>
<span id="cb1-33"><a href="#cb1-33"></a>    <span class="kw">datatable</span>(</span>
<span id="cb1-34"><a href="#cb1-34"></a>      dat, <span class="dt">container =</span> sketch, </span>
<span id="cb1-35"><a href="#cb1-35"></a>      <span class="dt">options =</span> </span>
<span id="cb1-36"><a href="#cb1-36"></a>        <span class="kw">list</span>(</span>
<span id="cb1-37"><a href="#cb1-37"></a>          <span class="dt">columnDefs =</span> <span class="kw">list</span>(</span>
<span id="cb1-38"><a href="#cb1-38"></a>            <span class="kw">list</span>(</span>
<span id="cb1-39"><a href="#cb1-39"></a>              <span class="dt">className =</span> <span class="st">&quot;dt-center&quot;</span>,</span>
<span id="cb1-40"><a href="#cb1-40"></a>              <span class="dt">targets =</span> <span class="st">&quot;_all&quot;</span></span>
<span id="cb1-41"><a href="#cb1-41"></a>            )</span>
<span id="cb1-42"><a href="#cb1-42"></a>          )</span>
<span id="cb1-43"><a href="#cb1-43"></a>        )</span>
<span id="cb1-44"><a href="#cb1-44"></a>    )</span>
<span id="cb1-45"><a href="#cb1-45"></a>  })</span>
<span id="cb1-46"><a href="#cb1-46"></a></span>
<span id="cb1-47"><a href="#cb1-47"></a>  <span class="co"># modals ####</span></span>
<span id="cb1-48"><a href="#cb1-48"></a>  output[[<span class="st">&quot;modals&quot;</span>]] &lt;-<span class="st"> </span><span class="kw">renderUI</span>({</span>
<span id="cb1-49"><a href="#cb1-49"></a>    <span class="kw">lapply</span>(<span class="dv">1</span><span class="op">:</span><span class="kw">ncol</span>(dat), <span class="cf">function</span>(i){</span>
<span id="cb1-50"><a href="#cb1-50"></a>      <span class="kw">bsModal</span>(</span>
<span id="cb1-51"><a href="#cb1-51"></a>        <span class="dt">id =</span> <span class="kw">paste0</span>(<span class="st">&quot;modal&quot;</span>,i),</span>
<span id="cb1-52"><a href="#cb1-52"></a>        <span class="dt">title =</span> <span class="kw">names</span>(dat)[i],</span>
<span id="cb1-53"><a href="#cb1-53"></a>        <span class="dt">trigger =</span> <span class="kw">paste0</span>(<span class="st">&quot;this_is_not_used&quot;</span>,i),</span>
<span id="cb1-54"><a href="#cb1-54"></a>        <span class="cf">if</span>(<span class="kw">is.numeric</span>(dat[[i]]) <span class="op">&amp;&amp;</span><span class="st"> </span><span class="kw">length</span>(<span class="kw">unique</span>(dat[[i]]))<span class="op">&gt;</span><span class="dv">19</span>){</span>
<span id="cb1-55"><a href="#cb1-55"></a>          <span class="kw">fluidRow</span>(</span>
<span id="cb1-56"><a href="#cb1-56"></a>            <span class="kw">column</span>(<span class="dv">5</span>, <span class="kw">radioButtons</span>(<span class="kw">paste0</span>(<span class="st">&quot;radio&quot;</span>,i), <span class="st">&quot;&quot;</span>,</span>
<span id="cb1-57"><a href="#cb1-57"></a>                       <span class="kw">c</span>(<span class="st">&quot;density&quot;</span>, <span class="st">&quot;histogram&quot;</span>), <span class="dt">inline =</span> <span class="ot">TRUE</span>)),</span>
<span id="cb1-58"><a href="#cb1-58"></a>            <span class="kw">column</span>(<span class="dv">7</span>,</span>
<span id="cb1-59"><a href="#cb1-59"></a>                   <span class="kw">conditionalPanel</span>(</span>
<span id="cb1-60"><a href="#cb1-60"></a>                     <span class="dt">condition =</span> <span class="kw">sprintf</span>(<span class="st">&quot;input.radio%d==&#39;histogram&#39;&quot;</span>,i),</span>
<span id="cb1-61"><a href="#cb1-61"></a>                     <span class="kw">sliderInput</span>(<span class="kw">paste0</span>(<span class="st">&quot;slider&quot;</span>,i), <span class="st">&quot;Number of bins&quot;</span>,</span>
<span id="cb1-62"><a href="#cb1-62"></a>                                 <span class="dt">min =</span> <span class="dv">5</span>, <span class="dt">max =</span> <span class="dv">100</span>, <span class="dt">value =</span> <span class="dv">30</span>)</span>
<span id="cb1-63"><a href="#cb1-63"></a>                   ))</span>
<span id="cb1-64"><a href="#cb1-64"></a>          )</span>
<span id="cb1-65"><a href="#cb1-65"></a>        },</span>
<span id="cb1-66"><a href="#cb1-66"></a>        <span class="kw">plotOutput</span>(<span class="kw">paste0</span>(<span class="st">&quot;plot&quot;</span>,i))</span>
<span id="cb1-67"><a href="#cb1-67"></a>      )</span>
<span id="cb1-68"><a href="#cb1-68"></a>    })</span>
<span id="cb1-69"><a href="#cb1-69"></a>  })</span>
<span id="cb1-70"><a href="#cb1-70"></a>  </span>
<span id="cb1-71"><a href="#cb1-71"></a>  <span class="co"># plots in modals ####</span></span>
<span id="cb1-72"><a href="#cb1-72"></a>  <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="kw">ncol</span>(dat)){</span>
<span id="cb1-73"><a href="#cb1-73"></a>    <span class="kw">local</span>({</span>
<span id="cb1-74"><a href="#cb1-74"></a>      ii &lt;-<span class="st"> </span>i</span>
<span id="cb1-75"><a href="#cb1-75"></a>      output[[<span class="kw">paste0</span>(<span class="st">&quot;plot&quot;</span>,ii)]] &lt;-<span class="st"> </span><span class="kw">renderPlot</span>({</span>
<span id="cb1-76"><a href="#cb1-76"></a>        <span class="cf">if</span>(<span class="kw">is.numeric</span>(dat[[ii]]) <span class="op">&amp;&amp;</span><span class="st"> </span><span class="kw">length</span>(<span class="kw">unique</span>(dat[[ii]]))<span class="op">&gt;</span><span class="dv">19</span>){</span>
<span id="cb1-77"><a href="#cb1-77"></a>          <span class="cf">if</span>(input[[<span class="kw">paste0</span>(<span class="st">&quot;radio&quot;</span>,ii)]] <span class="op">==</span><span class="st"> &quot;density&quot;</span>){</span>
<span id="cb1-78"><a href="#cb1-78"></a>            <span class="kw">ggplot</span>(dat, <span class="kw">aes_string</span>(<span class="kw">names</span>(dat)[ii])) <span class="op">+</span><span class="st"> </span></span>
<span id="cb1-79"><a href="#cb1-79"></a><span class="st">              </span><span class="kw">geom_density</span>(<span class="dt">fill =</span> <span class="st">&quot;seashell&quot;</span>, <span class="dt">color =</span> <span class="st">&quot;seashell&quot;</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb1-80"><a href="#cb1-80"></a><span class="st">              </span><span class="kw">stat_density</span>(<span class="dt">geom =</span> <span class="st">&quot;line&quot;</span>, <span class="dt">size =</span> <span class="dv">1</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb1-81"><a href="#cb1-81"></a><span class="st">              </span><span class="kw">theme_bw</span>() <span class="op">+</span><span class="st"> </span><span class="kw">theme</span>(<span class="dt">axis.title =</span> <span class="kw">element_text</span>(<span class="dt">size =</span> <span class="dv">16</span>))</span>
<span id="cb1-82"><a href="#cb1-82"></a>          }<span class="cf">else</span>{</span>
<span id="cb1-83"><a href="#cb1-83"></a>            <span class="kw">ggplot</span>(dat, <span class="kw">aes_string</span>(<span class="kw">names</span>(dat)[ii])) <span class="op">+</span><span class="st"> </span></span>
<span id="cb1-84"><a href="#cb1-84"></a><span class="st">              </span><span class="kw">geom_histogram</span>(<span class="dt">bins =</span> input[[<span class="kw">paste0</span>(<span class="st">&quot;slider&quot;</span>,ii)]]) <span class="op">+</span><span class="st"> </span></span>
<span id="cb1-85"><a href="#cb1-85"></a><span class="st">              </span><span class="kw">theme_bw</span>() <span class="op">+</span><span class="st"> </span><span class="kw">theme</span>(<span class="dt">axis.title =</span> <span class="kw">element_text</span>(<span class="dt">size =</span> <span class="dv">16</span>))</span>
<span id="cb1-86"><a href="#cb1-86"></a>          }</span>
<span id="cb1-87"><a href="#cb1-87"></a>        }<span class="cf">else</span>{</span>
<span id="cb1-88"><a href="#cb1-88"></a>          dat[[<span class="st">&quot;.x&quot;</span>]] &lt;-<span class="st"> </span></span>
<span id="cb1-89"><a href="#cb1-89"></a><span class="st">            </span><span class="kw">factor</span>(dat[[ii]], <span class="dt">levels =</span> <span class="kw">names</span>(<span class="kw">sort</span>(<span class="kw">table</span>(dat[[ii]]), </span>
<span id="cb1-90"><a href="#cb1-90"></a>                                                 <span class="dt">decreasing=</span><span class="ot">TRUE</span>)))</span>
<span id="cb1-91"><a href="#cb1-91"></a>          gg &lt;-<span class="st"> </span><span class="kw">ggplot</span>(dat, <span class="kw">aes</span>(.x)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_bar</span>() <span class="op">+</span><span class="st"> </span></span>
<span id="cb1-92"><a href="#cb1-92"></a><span class="st">            </span><span class="kw">geom_text</span>(<span class="dt">stat=</span><span class="st">&quot;count&quot;</span>, <span class="kw">aes</span>(<span class="dt">label=</span>..count..), <span class="dt">vjust=</span><span class="op">-</span><span class="fl">0.5</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb1-93"><a href="#cb1-93"></a><span class="st">            </span><span class="kw">xlab</span>(<span class="kw">names</span>(dat)[ii]) <span class="op">+</span><span class="st"> </span><span class="kw">theme_bw</span>()</span>
<span id="cb1-94"><a href="#cb1-94"></a>          <span class="cf">if</span>(<span class="kw">max</span>(<span class="kw">nchar</span>(<span class="kw">levels</span>(dat<span class="op">$</span>.x)))<span class="op">*</span><span class="kw">nlevels</span>(dat<span class="op">$</span>.x)<span class="op">&gt;</span><span class="dv">40</span>){</span>
<span id="cb1-95"><a href="#cb1-95"></a>            gg &lt;-<span class="st"> </span>gg <span class="op">+</span><span class="st"> </span><span class="kw">theme</span>(<span class="dt">axis.text.x =</span> </span>
<span id="cb1-96"><a href="#cb1-96"></a>                               <span class="kw">element_text</span>(<span class="dt">size =</span> <span class="dv">12</span>, <span class="dt">angle =</span> <span class="dv">45</span>, </span>
<span id="cb1-97"><a href="#cb1-97"></a>                                            <span class="dt">vjust =</span> <span class="fl">0.5</span>, <span class="dt">hjust =</span> <span class="fl">0.5</span>))</span>
<span id="cb1-98"><a href="#cb1-98"></a>          }<span class="cf">else</span>{</span>
<span id="cb1-99"><a href="#cb1-99"></a>            gg &lt;-<span class="st"> </span>gg <span class="op">+</span><span class="st"> </span><span class="kw">theme</span>(<span class="dt">axis.text.x =</span> <span class="kw">element_text</span>(<span class="dt">size =</span> <span class="dv">12</span>))</span>
<span id="cb1-100"><a href="#cb1-100"></a>          }</span>
<span id="cb1-101"><a href="#cb1-101"></a>          gg <span class="op">+</span><span class="st"> </span><span class="kw">theme</span>(<span class="dt">axis.title =</span> <span class="kw">element_text</span>(<span class="dt">size =</span> <span class="dv">16</span>))</span>
<span id="cb1-102"><a href="#cb1-102"></a>        }</span>
<span id="cb1-103"><a href="#cb1-103"></a>      })</span>
<span id="cb1-104"><a href="#cb1-104"></a>    })</span>
<span id="cb1-105"><a href="#cb1-105"></a>  }</span>
<span id="cb1-106"><a href="#cb1-106"></a>  </span>
<span id="cb1-107"><a href="#cb1-107"></a>}</span>
<span id="cb1-108"><a href="#cb1-108"></a></span>
<span id="cb1-109"><a href="#cb1-109"></a><span class="kw">shinyApp</span>(ui, server)</span></code></pre></div>

        </div>


        <div id="footer">
          Site proudly generated by
          <a href="http://jaspervdj.be/hakyll">Hakyll</a>
        </div>

      </div>

    </div>

    <div class="row">
      <div class="col-sm-12">
        <div id="disqus_thread"></div>
        <div class="pagination">
          <ul>
            <li>
              <a href="http://laustep.github.io/stlahblog/">&#171; Back Home</a>
            </li>
          </ul>
        </div>
      </div>
    </div>
    
  </div>

</body>

<script src="/libraries/bootstrap/bootstrap.min.js"></script>
<script>
  var disqus_developer = 1;
  var disqus_shortname = 'stlapblog';
  // required: replace example with your forum shortname
  /* * * DON'T EDIT BELOW THIS LINE * * */
  (function () {
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = 'https://' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] ||
      document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>
<noscript>Please enable JavaScript to view the
  <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a>
</noscript>
<!-- MathJax: Fall back to local if CDN offline but local image fonts are not supported (saves >100MB) -->
<script type="text/x-mathjax-config" src="/libraries/mathjax/config/TeX-MML-AM_CHTML.js"></script>
<!-- <script>
  window.MathJax || document.write('<script type="text/x-mathjax-config">MathJax.Hub.Config({"HTML-CSS":{imageFont:null}});<\/script><script src="../libraries/mathjax/MathJax.js"><\/script>');
</script> -->


</html>]]></description>
    <pubDate>Wed, 10 Jul 2019 00:00:00 UT</pubDate>
    <guid>https://laustep.github.io/stlahblog/posts/PlotDatatableColumns.html</guid>
    <dc:creator>Stéphane Laurent</dc:creator>
    <category>R</category>
</item>




    </channel>
</rss>