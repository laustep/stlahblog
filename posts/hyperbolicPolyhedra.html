<!DOCTYPE HTML>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Saturn Elephant - Drawing hyperbolic polyhedra</title>
  <link href="../libraries/bootstrap/bootstrap-grid.min.css" rel="stylesheet">
  <link rel="stylesheet" href="../css/default2.css" />
  <link rel="stylesheet" href="../css/post.css" />
  <link rel="stylesheet" href="../css/misc.css" /> 
  
    <link rel="stylesheet" href="../css/pandoc-solarized.css" /> 
   
  
    <link href="../libraries/highlighters/prettify/css/minimal.css" rel="stylesheet"> 
  
  <link href="https://fonts.googleapis.com/css?family=Raleway:400,600,200,800" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/css?family=Droid+Sans" rel="stylesheet" type="text/css">
  <script src="../libraries/jquery.min.js"></script>
  <script type="text/javascript" async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML"></script>
</head>

<body>
  <div class="container-fluid">
    <div class="row">
      <!-- Sidebar. -->
      <div class="sidebar col-sm-3">
        <div class="row">
          <div class="col-sm-12" style="float:right;clear:both;margin-right:50px;margin-top:50px;">
            <a href="https://www.r-bloggers.com/">
              <img src="https://www.r-bloggers.com/wp-content/uploads/2016/04/R_02_2016-05-01.png" alt="stla" width="100%" />
            </a>
            <br />
            <a href="http://t-redactyl.io/">
              <span style="color:black;font-weight:bold;font-family:sans-serif;font-size:29px;">Standard error</span>
            </a>
            <a href="http://timelyportfolio.blogspot.be/">
              <span style="color:grey;font-weight:bold;font-family:sans-serif;font-size:27px;">Timely portfolio</span>
            </a>
            <br />
            <a href="https://antoineguillot.wordpress.com/blog/">
              <span style="color:white;background-color:darkblue;font-weight:bold;font-family:sans-serif;font-size:25px;border:5px solid;border-color:darkblue">ENHANCE DATA</span>
            </a>
            <br />
            <a href="https://fronkonstin.com/">
              <span style="color:black;background-color:gold;font-weight:bold;font-size:32px;border:3px solid;border-color:gold;">Fronkonstin</span>
            </a>
          </div>
        </div>
        <div id="logos">
          <div class="row">
            <div class="col-sm-4">
              <img src="../images/AsymptoteLogo.svg" style="width: 150%; transform: rotateZ(-35deg)" class="center" />
            </div>
            <div class="col-sm-4">
              <img src="../images/Rlogo.svg" style="width: 110%;" class="center" />
            </div>
            <div class="col-sm-4">
              <img src="../images/shiny-hex.png" style="width: 90%;" class="center" />
            </div>
          </div>
          <div class="row">
            <div class="col-sm-4">
              <img src="../images/Povray_logo_sphere.png" style="width: 105%;" class="center" />
            </div>
            <div class="col-sm-4">
              <img src="../images/javascript.svg" style="width: 90%;" class="center" />
            </div>
            <div class="col-sm-4">
              <img src="../images/haskell.svg" style="width: 110%;" class="center" />
            </div>
          </div>
        </div>
      </div>

      <div class="main col-sm-9">
        <div id="header">
          <div id="logo" style="position:absolute;">
            <a href="../">
              <img src="../images/stla.jpg" alt="stla" width="100px" />
            </a>
          </div>
          <div id="navigation" style="margin-top:50px;">
            <a href="../">Home</a>
            <a href="../about.html">About</a>
            <a href="../contact.html">Contact</a>
            <a href="../archive.html">Archive</a>
          </div>
        </div>

        <div class="content">
          <h1>Drawing hyperbolic polyhedra</h1> 
          <div class="info">
    Posted on April  5, 2019
    
        by Stéphane Laurent
    
</div>
<div class="info">
    
    Tags: <a href="../tags/R.html">R</a>, <a href="../tags/maths.html">maths</a>, <a href="../tags/geometry.html">geometry</a>, <a href="../tags/graphics.html">graphics</a>, <a href="../tags/rgl.html">rgl</a>, <a href="../tags/asymptote.html">asymptote</a>, <a href="../tags/javascript.html">javascript</a>, <a href="../tags/povray.html">povray</a>
    
</div>

<p>A. A. Ungar has developed the concept of <em>gyrovector space</em>. His theory provides a (gyro)vector approach to hyperbolic geometry.</p>
<p>Ungar deeply studied three examples of gyrovector spaces; they correspond to three models of hyperbolic geometry: the Beltrami model, the Poincaré ball model, and the hyperboloid model.</p>
<p>In this blog post, I will consider the gyrovector approach to the hyperboloid model. We will see how it makes easy to draw some hyperbolic polyhedra.</p>
<h2 id="gyrovector-space">Gyrovector space</h2>
<p>A <em>point</em> is an element of <span class="math inline">\(\mathbb{R}^n\)</span>. Throughout, <span class="math inline">\(s\)</span> is a fixed positive number.</p>
<p>Shortly speaking, <span class="math inline">\(\mathbb{R}^n\)</span> is a <em>gyrovector space</em> when it is equipped with a <em>gyroaddition</em> and a <em>scalar gyromultiplication</em>.</p>
<h3 id="gyroaddition">Gyroaddition</h3>
<p>In order to define the gyroaddition of two points, we introduce the <em>beta factor</em> of a point <span class="math inline">\(A\)</span>, defined by <span class="math display">\[
\beta_A = \dfrac{1}{\sqrt{1 + \dfrac{{\Vert A \Vert}^2}{s^2}}}.
\]</span></p>
<p>The <em>gyroaddition</em> of two points <span class="math inline">\(A\)</span> and <span class="math inline">\(B\)</span> is then defined by <span class="math display">\[
A \oplus B = 
\left(1 + \frac{\beta_A}{1+\beta_A}\frac{A\cdot B}{s^2} 
+ \frac{1-\beta_B}{\beta_B} \right) A + B.
\]</span> Later, we will resort to the (non-obvious) property <span class="math display">\[
(\star)\qquad -A \oplus (A \oplus B) = B.
\]</span></p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" title="1"><span class="co"># gyroaddition ####</span></a>
<a class="sourceLine" id="cb1-2" title="2">dotprod &lt;-<span class="st"> </span><span class="cf">function</span>(x, <span class="dt">y=</span><span class="ot">NULL</span>){</a>
<a class="sourceLine" id="cb1-3" title="3">  <span class="kw">c</span>(<span class="kw">crossprod</span>(x, y))</a>
<a class="sourceLine" id="cb1-4" title="4">}</a>
<a class="sourceLine" id="cb1-5" title="5">betaF &lt;-<span class="st"> </span><span class="cf">function</span>(A, <span class="dt">s=</span><span class="dv">1</span>) <span class="dv">1</span><span class="op">/</span><span class="kw">sqrt</span>(<span class="dv">1</span><span class="op">+</span><span class="kw">dotprod</span>(A)<span class="op">/</span>s<span class="op">^</span><span class="dv">2</span>)</a>
<a class="sourceLine" id="cb1-6" title="6">gyroadd &lt;-<span class="st"> </span><span class="cf">function</span>(A, B, <span class="dt">s=</span><span class="dv">1</span>){</a>
<a class="sourceLine" id="cb1-7" title="7">  betaA &lt;-<span class="st"> </span><span class="kw">betaF</span>(A, s); betaB &lt;-<span class="st"> </span><span class="kw">betaF</span>(B, s)</a>
<a class="sourceLine" id="cb1-8" title="8">  (<span class="dv">1</span> <span class="op">+</span><span class="st"> </span>betaA<span class="op">/</span>(<span class="dv">1</span><span class="op">+</span>betaA)<span class="op">*</span><span class="kw">dotprod</span>(A,B)<span class="op">/</span>s<span class="op">^</span><span class="dv">2</span> <span class="op">+</span><span class="st"> </span>(<span class="dv">1</span><span class="op">-</span>betaB)<span class="op">/</span>betaB) <span class="op">*</span><span class="st"> </span>A <span class="op">+</span><span class="st"> </span>B</a>
<a class="sourceLine" id="cb1-9" title="9">}</a></code></pre></div>
<h3 id="scalar-gyromultiplication">Scalar gyromultiplication</h3>
<p>For <span class="math inline">\(r \in \mathbb{R}\)</span>, the <em>scalar gyromultiplication</em> of a point <span class="math inline">\(A\)</span> by <span class="math inline">\(r\)</span> is defined by<br />
<span class="math display">\[
r \otimes A = 
\frac{s}{\Vert A \Vert} 
\sinh\left(r \sinh^{-1}\left(\frac{\Vert A \Vert}{s}\right)\right) A. 
\]</span></p>
<p>It is easy to see that <span class="math inline">\(0 \otimes A = \mathbf{0}\)</span> and <span class="math inline">\(1 \otimes A = A\)</span>.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" title="1"><span class="co"># scalar gyromultiplication ####</span></a>
<a class="sourceLine" id="cb2-2" title="2">gyroscalar &lt;-<span class="st"> </span><span class="cf">function</span>(r, A, <span class="dt">s=</span><span class="dv">1</span>){</a>
<a class="sourceLine" id="cb2-3" title="3">  Anorm &lt;-<span class="st"> </span><span class="kw">sqrt</span>(<span class="kw">dotprod</span>(A))</a>
<a class="sourceLine" id="cb2-4" title="4">  s<span class="op">/</span>Anorm <span class="op">*</span><span class="st"> </span><span class="kw">sinh</span>(r<span class="op">*</span><span class="kw">asinh</span>(Anorm<span class="op">/</span>s)) <span class="op">*</span><span class="st"> </span>A</a>
<a class="sourceLine" id="cb2-5" title="5">}</a></code></pre></div>
<h3 id="gyroline-gyrosegment-and-gyromidpoint">Gyroline, gyrosegment and gyromidpoint</h3>
<p>In order to define a gyroline and the gyrosegment joining two points, we introduce the notation <span class="math display">\[
\overset{\oplus\longrightarrow}{AB} = (-A) \oplus B.
\]</span></p>
<p>The <em>gyroline</em> passing through <span class="math inline">\(A\)</span> and <span class="math inline">\(B\)</span> is the set of all points having form <span class="math display">\[
A \oplus \Bigl(t \otimes \overset{\oplus\longrightarrow}{AB}\Bigr)
\]</span> for some <span class="math inline">\(t \in \mathbb{R}\)</span>.</p>
<p>Observe that the point <span class="math inline">\(A \oplus \Bigl(t \otimes \overset{\oplus\longrightarrow}{AB}\Bigr)\)</span> equals <span class="math inline">\(A\)</span> when <span class="math inline">\(t=0\)</span> (easy) and equals <span class="math inline">\(B\)</span> when <span class="math inline">\(t=1\)</span> (that stems from property <span class="math inline">\((\star)\)</span>).</p>
<p>The <em>gyrosegment</em> that joins <span class="math inline">\(A\)</span> and <span class="math inline">\(B\)</span> is the set of such points for <span class="math inline">\(t \in [0,1]\)</span>: <span class="math display">\[
\left\{ A \oplus \Bigl(t \otimes \overset{\oplus\longrightarrow}{AB}\Bigr) 
\Bigm| 0 \leq t \leq 1\right\}.
\]</span></p>
<p>The <em>gyromidpoint</em> of <span class="math inline">\(A\)</span> and <span class="math inline">\(B\)</span> is the point of the gyrosegment joining <span class="math inline">\(A\)</span> and <span class="math inline">\(B\)</span> corresponding to <span class="math inline">\(t = \frac12\)</span>: <span class="math display">\[
A \oplus \left(\frac{1}{2} \otimes \overset{\oplus\longrightarrow}{AB}\right).
\]</span></p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" title="1"><span class="co"># gyrosegment ####</span></a>
<a class="sourceLine" id="cb3-2" title="2">gyroABt &lt;-<span class="st"> </span><span class="cf">function</span>(A, B, t, <span class="dt">s=</span><span class="dv">1</span>){</a>
<a class="sourceLine" id="cb3-3" title="3">  <span class="kw">gyroadd</span>(A, <span class="kw">gyroscalar</span>(t, <span class="kw">gyroadd</span>(<span class="op">-</span>A, B, s), s), s)</a>
<a class="sourceLine" id="cb3-4" title="4">}</a>
<a class="sourceLine" id="cb3-5" title="5">gyromidpoint &lt;-<span class="st"> </span><span class="cf">function</span>(A, B, <span class="dt">s=</span><span class="dv">1</span>){</a>
<a class="sourceLine" id="cb3-6" title="6">  <span class="kw">gyroABt</span>(A, B, <span class="fl">0.5</span>, s)</a>
<a class="sourceLine" id="cb3-7" title="7">}</a>
<a class="sourceLine" id="cb3-8" title="8">gyrosegment &lt;-<span class="st"> </span><span class="cf">function</span>(A, B, <span class="dt">s=</span><span class="dv">1</span>, <span class="dt">n=</span><span class="dv">50</span>){</a>
<a class="sourceLine" id="cb3-9" title="9">  <span class="kw">t</span>(<span class="kw">sapply</span>(<span class="kw">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dt">length.out =</span> n), <span class="cf">function</span>(t){</a>
<a class="sourceLine" id="cb3-10" title="10">    <span class="kw">gyroABt</span>(A, B, t, s)</a>
<a class="sourceLine" id="cb3-11" title="11">  }))</a>
<a class="sourceLine" id="cb3-12" title="12">}</a></code></pre></div>
<p>Let’s plot a two-dimensional gyrosegment.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" title="1">A &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">2</span>); B &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">1</span>)</a>
<a class="sourceLine" id="cb4-2" title="2"><span class="kw">plot</span>(<span class="kw">rbind</span>(A,B), <span class="dt">type =</span> <span class="st">&quot;p&quot;</span>, <span class="dt">pch =</span> <span class="dv">19</span>, <span class="dt">xlab =</span> <span class="ot">NA</span>, <span class="dt">ylab =</span> <span class="ot">NA</span>, </a>
<a class="sourceLine" id="cb4-3" title="3">     <span class="dt">xlim =</span> <span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">2</span>), <span class="dt">ylim =</span> <span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">2</span>))</a>
<a class="sourceLine" id="cb4-4" title="4">s &lt;-<span class="st"> </span><span class="fl">0.2</span></a>
<a class="sourceLine" id="cb4-5" title="5">AB &lt;-<span class="st"> </span><span class="kw">gyrosegment</span>(A, B, s)</a>
<a class="sourceLine" id="cb4-6" title="6"><span class="kw">lines</span>(AB)</a>
<a class="sourceLine" id="cb4-7" title="7"><span class="kw">text</span>(<span class="kw">t</span>(A), <span class="kw">expression</span>(<span class="kw">italic</span>(A)), <span class="dt">pos=</span><span class="dv">1</span>)</a>
<a class="sourceLine" id="cb4-8" title="8"><span class="kw">text</span>(<span class="kw">t</span>(B), <span class="kw">expression</span>(<span class="kw">italic</span>(B)), <span class="dt">pos=</span><span class="dv">3</span>)</a>
<a class="sourceLine" id="cb4-9" title="9"><span class="co"># gyromidpoint</span></a>
<a class="sourceLine" id="cb4-10" title="10"><span class="kw">points</span>(<span class="kw">t</span>(<span class="kw">gyromidpoint</span>(A, B, s)), <span class="dt">pch =</span> <span class="dv">19</span>, <span class="dt">col =</span> <span class="st">&quot;red&quot;</span>)</a>
<a class="sourceLine" id="cb4-11" title="11"><span class="co"># asymptotes</span></a>
<a class="sourceLine" id="cb4-12" title="12"><span class="kw">lines</span>(<span class="kw">rbind</span>(<span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">0</span>), <span class="kw">gyroABt</span>(A, B, <span class="dt">t=</span><span class="op">-</span><span class="dv">20</span>, s)), <span class="dt">lty=</span><span class="st">&quot;dashed&quot;</span>)</a>
<a class="sourceLine" id="cb4-13" title="13"><span class="kw">lines</span>(<span class="kw">rbind</span>(<span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">0</span>), <span class="kw">gyroABt</span>(A, B, <span class="dt">t=</span><span class="dv">20</span>, s)), <span class="dt">lty=</span><span class="st">&quot;dashed&quot;</span>)</a></code></pre></div>
<p><img src="./figures/hyperbolicPolyhedra-gyrosegment2d-1.png" /></p>
<p>This is a part of a hyperbola whose asymptotes meet at the origin.</p>
<h2 id="hyperbolic-triangle">Hyperbolic triangle</h2>
<p>Thanks to the gyrosegments, we can easily plot the edges of a hyperbolic triangle.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" title="1"><span class="kw">library</span>(rgl)</a>
<a class="sourceLine" id="cb5-2" title="2">A &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>); B &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>); C &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>)</a>
<a class="sourceLine" id="cb5-3" title="3">s &lt;-<span class="st"> </span><span class="fl">0.3</span></a>
<a class="sourceLine" id="cb5-4" title="4">AB &lt;-<span class="st"> </span><span class="kw">gyrosegment</span>(A, B, s)</a>
<a class="sourceLine" id="cb5-5" title="5">AC &lt;-<span class="st"> </span><span class="kw">gyrosegment</span>(A, C, s)</a>
<a class="sourceLine" id="cb5-6" title="6">BC &lt;-<span class="st"> </span><span class="kw">gyrosegment</span>(B, C, s)</a>
<a class="sourceLine" id="cb5-7" title="7"><span class="kw">view3d</span>(<span class="dv">30</span>, <span class="dv">30</span>, <span class="dt">zoom =</span> <span class="fl">0.75</span>)</a>
<a class="sourceLine" id="cb5-8" title="8"><span class="kw">lines3d</span>(AB, <span class="dt">lwd=</span><span class="dv">3</span>); <span class="kw">lines3d</span>(AC, <span class="dt">lwd=</span><span class="dv">3</span>); <span class="kw">lines3d</span>(BC, <span class="dt">lwd=</span><span class="dv">3</span>)</a></code></pre></div>
<p><img src="./figures/hyperbolicPolyhedra-htriangle1-1.png" /></p>
<p>We can draw a prettier picture with the help of the <code>cylinder3d</code> function of <code>rgl</code>:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" title="1"><span class="kw">view3d</span>(<span class="dv">30</span>, <span class="dv">30</span>, <span class="dt">zoom =</span> <span class="fl">0.75</span>)</a>
<a class="sourceLine" id="cb6-2" title="2"><span class="co"># plot vertices</span></a>
<a class="sourceLine" id="cb6-3" title="3"><span class="kw">spheres3d</span>(<span class="kw">rbind</span>(A,B,C), <span class="dt">radius =</span> <span class="fl">0.03</span>, <span class="dt">color =</span> <span class="st">&quot;yellow&quot;</span>)</a>
<a class="sourceLine" id="cb6-4" title="4"><span class="co"># plot edges</span></a>
<a class="sourceLine" id="cb6-5" title="5"><span class="kw">shade3d</span>(</a>
<a class="sourceLine" id="cb6-6" title="6">  <span class="kw">cylinder3d</span>(AB, <span class="dt">radius =</span> <span class="fl">0.015</span>, <span class="dt">sides =</span> <span class="dv">20</span>), <span class="dt">color =</span> <span class="st">&quot;yellow&quot;</span>)</a>
<a class="sourceLine" id="cb6-7" title="7"><span class="kw">shade3d</span>(</a>
<a class="sourceLine" id="cb6-8" title="8">  <span class="kw">cylinder3d</span>(AC, <span class="dt">radius =</span> <span class="fl">0.015</span>, <span class="dt">sides =</span> <span class="dv">20</span>), <span class="dt">color =</span> <span class="st">&quot;yellow&quot;</span>)</a>
<a class="sourceLine" id="cb6-9" title="9"><span class="kw">shade3d</span>(</a>
<a class="sourceLine" id="cb6-10" title="10">  <span class="kw">cylinder3d</span>(BC, <span class="dt">radius =</span> <span class="fl">0.015</span>, <span class="dt">sides =</span> <span class="dv">20</span>), <span class="dt">color =</span> <span class="st">&quot;yellow&quot;</span>)</a></code></pre></div>
<p><img src="./figures/hyperbolicPolyhedra-htriangle2-1.png" /></p>
<p>Now, how to fill the hyperbolic triangle with a color? We will do so by constructing a triangular mesh of the hyperbolic triangle.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" title="1"><span class="co"># a subdivision step</span></a>
<a class="sourceLine" id="cb7-2" title="2">gyrosubdiv0 &lt;-<span class="st"> </span><span class="cf">function</span>(A1, A2, A3, <span class="dt">s=</span><span class="dv">1</span>){</a>
<a class="sourceLine" id="cb7-3" title="3">  M12 &lt;-<span class="st"> </span><span class="kw">gyromidpoint</span>(A1, A2, s)</a>
<a class="sourceLine" id="cb7-4" title="4">  M13 &lt;-<span class="st"> </span><span class="kw">gyromidpoint</span>(A1, A3, s)</a>
<a class="sourceLine" id="cb7-5" title="5">  M23 &lt;-<span class="st"> </span><span class="kw">gyromidpoint</span>(A2, A3, s)</a>
<a class="sourceLine" id="cb7-6" title="6">  <span class="kw">list</span>(</a>
<a class="sourceLine" id="cb7-7" title="7">    <span class="kw">list</span>(A1, M12, M13),</a>
<a class="sourceLine" id="cb7-8" title="8">    <span class="kw">list</span>(A2, M23, M12),</a>
<a class="sourceLine" id="cb7-9" title="9">    <span class="kw">list</span>(A3, M13, M23),</a>
<a class="sourceLine" id="cb7-10" title="10">    <span class="kw">list</span>(M12, M13, M23)</a>
<a class="sourceLine" id="cb7-11" title="11">  )</a>
<a class="sourceLine" id="cb7-12" title="12">}</a>
<a class="sourceLine" id="cb7-13" title="13"><span class="co"># iterate the subdivision, and return a &quot;mesh3d&quot; object</span></a>
<a class="sourceLine" id="cb7-14" title="14">gyrosubdiv &lt;-<span class="st"> </span><span class="cf">function</span>(A1, A2, A3, <span class="dt">s=</span><span class="dv">1</span>, <span class="dt">depth=</span><span class="dv">5</span>){</a>
<a class="sourceLine" id="cb7-15" title="15">  subd &lt;-<span class="st"> </span><span class="kw">gyrosubdiv0</span>(A1, A2, A3, s)</a>
<a class="sourceLine" id="cb7-16" title="16">  <span class="cf">for</span>(i <span class="cf">in</span> <span class="kw">seq_len</span>(depth<span class="dv">-1</span>)){</a>
<a class="sourceLine" id="cb7-17" title="17">    subd &lt;-<span class="st"> </span>purrr<span class="op">::</span><span class="kw">flatten</span>(<span class="kw">lapply</span>(subd, <span class="cf">function</span>(triplet){</a>
<a class="sourceLine" id="cb7-18" title="18">      <span class="kw">gyrosubdiv0</span>(triplet[[<span class="dv">1</span>]], triplet[[<span class="dv">2</span>]], triplet[[<span class="dv">3</span>]], s)</a>
<a class="sourceLine" id="cb7-19" title="19">    }))</a>
<a class="sourceLine" id="cb7-20" title="20">  }</a>
<a class="sourceLine" id="cb7-21" title="21">  vertices &lt;-<span class="st"> </span></a>
<a class="sourceLine" id="cb7-22" title="22"><span class="st">    </span><span class="kw">do.call</span>(cbind, </a>
<a class="sourceLine" id="cb7-23" title="23">            <span class="kw">lapply</span>(subd, <span class="cf">function</span>(triplet) <span class="kw">do.call</span>(cbind, triplet)))</a>
<a class="sourceLine" id="cb7-24" title="24">  indices &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="dv">1</span><span class="op">:</span><span class="kw">ncol</span>(vertices), <span class="dt">nrow =</span> <span class="dv">3</span>)</a>
<a class="sourceLine" id="cb7-25" title="25">  <span class="kw">tmesh3d</span>(</a>
<a class="sourceLine" id="cb7-26" title="26">    <span class="dt">vertices =</span> vertices,</a>
<a class="sourceLine" id="cb7-27" title="27">    <span class="dt">indices =</span> indices,</a>
<a class="sourceLine" id="cb7-28" title="28">    <span class="dt">homogeneous =</span> <span class="ot">FALSE</span></a>
<a class="sourceLine" id="cb7-29" title="29">  )</a>
<a class="sourceLine" id="cb7-30" title="30">}</a></code></pre></div>
<p>Here is the mesh at the first iteration:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" title="1">mesh &lt;-<span class="st"> </span><span class="kw">gyrosubdiv</span>(A, B, C, s, <span class="dt">depth =</span> <span class="dv">1</span>)</a>
<a class="sourceLine" id="cb8-2" title="2"><span class="kw">view3d</span>(<span class="dv">30</span>, <span class="dv">30</span>, <span class="dt">zoom =</span> <span class="fl">0.75</span>)</a>
<a class="sourceLine" id="cb8-3" title="3"><span class="kw">wire3d</span>(mesh, <span class="dt">lwd =</span> <span class="dv">3</span>, <span class="dt">specular =</span> <span class="st">&quot;black&quot;</span>)</a></code></pre></div>
<p><img src="./figures/hyperbolicPolyhedra-wire1-1.png" /></p>
<p>At the second iteration:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" title="1">mesh &lt;-<span class="st"> </span><span class="kw">gyrosubdiv</span>(A, B, C, s, <span class="dt">depth =</span> <span class="dv">2</span>)</a>
<a class="sourceLine" id="cb9-2" title="2"><span class="kw">view3d</span>(<span class="dv">30</span>, <span class="dv">30</span>, <span class="dt">zoom =</span> <span class="fl">0.75</span>)</a>
<a class="sourceLine" id="cb9-3" title="3"><span class="kw">wire3d</span>(mesh, <span class="dt">lwd =</span> <span class="dv">3</span>, <span class="dt">specular =</span> <span class="st">&quot;black&quot;</span>)</a></code></pre></div>
<p><img src="./figures/hyperbolicPolyhedra-wire2-1.png" /></p>
<p>Now let’s plot the shaded triangle:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" title="1">mesh &lt;-<span class="st"> </span><span class="kw">gyrosubdiv</span>(A, B, C, s, <span class="dt">depth =</span> <span class="dv">6</span>)</a>
<a class="sourceLine" id="cb10-2" title="2"><span class="kw">view3d</span>(<span class="dv">30</span>, <span class="dv">30</span>, <span class="dt">zoom =</span> <span class="fl">0.75</span>)</a>
<a class="sourceLine" id="cb10-3" title="3"><span class="kw">shade3d</span>(mesh, <span class="dt">color =</span> <span class="st">&quot;navy&quot;</span>, <span class="dt">specular =</span> <span class="st">&quot;cyan&quot;</span>)</a></code></pre></div>
<p><img src="./figures/hyperbolicPolyhedra-shadedTriangle-1.png" /></p>
<h2 id="icosahedron">Icosahedron</h2>
<p>An icosahedron is made of twenty triangular faces. So we have everything needed to plot an icosahedron.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" title="1">icosahedron &lt;-<span class="st"> </span><span class="kw">icosahedron3d</span>()</a>
<a class="sourceLine" id="cb11-2" title="2">vertices &lt;-<span class="st"> </span><span class="kw">t</span>(icosahedron<span class="op">$</span>vb[<span class="op">-</span><span class="dv">4</span>,])</a>
<a class="sourceLine" id="cb11-3" title="3">edges &lt;-<span class="st"> </span>Rvcg<span class="op">::</span><span class="kw">vcgGetEdge</span>(icosahedron)</a>
<a class="sourceLine" id="cb11-4" title="4">faces &lt;-<span class="st"> </span><span class="kw">t</span>(icosahedron<span class="op">$</span>it)</a>
<a class="sourceLine" id="cb11-5" title="5">s &lt;-<span class="st"> </span><span class="fl">0.5</span></a>
<a class="sourceLine" id="cb11-6" title="6"><span class="co"># plot icosahedron ####</span></a>
<a class="sourceLine" id="cb11-7" title="7"><span class="kw">view3d</span>(<span class="dv">30</span>, <span class="dv">30</span>, <span class="dt">zoom =</span> <span class="fl">0.7</span>)</a>
<a class="sourceLine" id="cb11-8" title="8"><span class="co"># plot vertices</span></a>
<a class="sourceLine" id="cb11-9" title="9"><span class="kw">spheres3d</span>(vertices, <span class="dt">radius =</span> <span class="fl">0.05</span>, <span class="dt">color =</span> <span class="st">&quot;yellow&quot;</span>)</a>
<a class="sourceLine" id="cb11-10" title="10"><span class="co"># plot edges</span></a>
<a class="sourceLine" id="cb11-11" title="11"><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="kw">nrow</span>(edges)){</a>
<a class="sourceLine" id="cb11-12" title="12">  A &lt;-<span class="st"> </span>vertices[edges[i,<span class="st">&quot;vert1&quot;</span>],]</a>
<a class="sourceLine" id="cb11-13" title="13">  B &lt;-<span class="st"> </span>vertices[edges[i,<span class="st">&quot;vert2&quot;</span>],]</a>
<a class="sourceLine" id="cb11-14" title="14">  AB &lt;-<span class="st"> </span><span class="kw">gyrosegment</span>(A, B, s)</a>
<a class="sourceLine" id="cb11-15" title="15">  <span class="kw">shade3d</span>(</a>
<a class="sourceLine" id="cb11-16" title="16">    <span class="kw">cylinder3d</span>(AB, <span class="dt">radius =</span> <span class="fl">0.03</span>, <span class="dt">sides =</span> <span class="dv">20</span>), <span class="dt">color =</span> <span class="st">&quot;yellow&quot;</span>)</a>
<a class="sourceLine" id="cb11-17" title="17">}</a>
<a class="sourceLine" id="cb11-18" title="18"><span class="co"># plot faces</span></a>
<a class="sourceLine" id="cb11-19" title="19"><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="kw">nrow</span>(faces)){</a>
<a class="sourceLine" id="cb11-20" title="20">  idx &lt;-<span class="st"> </span>faces[i,]</a>
<a class="sourceLine" id="cb11-21" title="21">  A &lt;-<span class="st"> </span>vertices[idx[<span class="dv">1</span>],]</a>
<a class="sourceLine" id="cb11-22" title="22">  B &lt;-<span class="st"> </span>vertices[idx[<span class="dv">2</span>],]</a>
<a class="sourceLine" id="cb11-23" title="23">  C &lt;-<span class="st"> </span>vertices[idx[<span class="dv">3</span>],]</a>
<a class="sourceLine" id="cb11-24" title="24">  mesh &lt;-<span class="st"> </span><span class="kw">gyrosubdiv</span>(A, B, C, <span class="dt">s =</span> s, <span class="dt">depth =</span> <span class="dv">6</span>)</a>
<a class="sourceLine" id="cb11-25" title="25">  <span class="kw">shade3d</span>(<span class="kw">addNormals</span>(mesh), <span class="dt">color =</span> <span class="st">&quot;navy&quot;</span>)</a>
<a class="sourceLine" id="cb11-26" title="26">}</a></code></pre></div>
<p><img src="./figures/hyperbolicPolyhedra-icosahedron-1.png" /></p>
<h2 id="triangular-orthobicopula">Triangular orthobicopula</h2>
<p>To plot the icosahedron, we had at our disposal its vertices, its edges, and its faces, which are triangular.</p>
<p>Now consider the <a href="http://eusebeia.dyndns.org/4d/J27">triangular orthobicopula</a>. We only have the coordinates of its vertices, and not all its faces are triangular. So, how to plot it?</p>
<p>Since this is a convex polyhedron, we can use the <code>cxhull</code> package to get its edges and its faces. We use the option <code>triangulate = TRUE</code> to get a triangulation of the faces.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" title="1">vertices &lt;-<span class="st"> </span><span class="kw">rbind</span>(</a>
<a class="sourceLine" id="cb12-2" title="2">  <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">-1</span><span class="op">/</span><span class="kw">sqrt</span>(<span class="dv">3</span>), <span class="kw">sqrt</span>(<span class="dv">8</span><span class="op">/</span><span class="dv">3</span>)),</a>
<a class="sourceLine" id="cb12-3" title="3">  <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">-1</span><span class="op">/</span><span class="kw">sqrt</span>(<span class="dv">3</span>), <span class="op">-</span><span class="kw">sqrt</span>(<span class="dv">8</span><span class="op">/</span><span class="dv">3</span>)),</a>
<a class="sourceLine" id="cb12-4" title="4">  <span class="kw">c</span>(<span class="op">-</span><span class="dv">1</span>, <span class="dv">-1</span><span class="op">/</span><span class="kw">sqrt</span>(<span class="dv">3</span>), <span class="kw">sqrt</span>(<span class="dv">8</span><span class="op">/</span><span class="dv">3</span>)),</a>
<a class="sourceLine" id="cb12-5" title="5">  <span class="kw">c</span>(<span class="op">-</span><span class="dv">1</span>, <span class="dv">-1</span><span class="op">/</span><span class="kw">sqrt</span>(<span class="dv">3</span>), <span class="op">-</span><span class="kw">sqrt</span>(<span class="dv">8</span><span class="op">/</span><span class="dv">3</span>)),</a>
<a class="sourceLine" id="cb12-6" title="6">  <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">2</span><span class="op">/</span><span class="kw">sqrt</span>(<span class="dv">3</span>), <span class="kw">sqrt</span>(<span class="dv">8</span><span class="op">/</span><span class="dv">3</span>)),</a>
<a class="sourceLine" id="cb12-7" title="7">  <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">2</span><span class="op">/</span><span class="kw">sqrt</span>(<span class="dv">3</span>), <span class="op">-</span><span class="kw">sqrt</span>(<span class="dv">8</span><span class="op">/</span><span class="dv">3</span>)),</a>
<a class="sourceLine" id="cb12-8" title="8">  <span class="kw">c</span>(<span class="dv">1</span>, <span class="kw">sqrt</span>(<span class="dv">3</span>), <span class="dv">0</span>),</a>
<a class="sourceLine" id="cb12-9" title="9">  <span class="kw">c</span>(<span class="dv">1</span>, <span class="op">-</span><span class="kw">sqrt</span>(<span class="dv">3</span>), <span class="dv">0</span>),</a>
<a class="sourceLine" id="cb12-10" title="10">  <span class="kw">c</span>(<span class="op">-</span><span class="dv">1</span>, <span class="kw">sqrt</span>(<span class="dv">3</span>), <span class="dv">0</span>),</a>
<a class="sourceLine" id="cb12-11" title="11">  <span class="kw">c</span>(<span class="op">-</span><span class="dv">1</span>, <span class="op">-</span><span class="kw">sqrt</span>(<span class="dv">3</span>), <span class="dv">0</span>),</a>
<a class="sourceLine" id="cb12-12" title="12">  <span class="kw">c</span>(<span class="dv">2</span>, <span class="dv">0</span>, <span class="dv">0</span>),</a>
<a class="sourceLine" id="cb12-13" title="13">  <span class="kw">c</span>(<span class="op">-</span><span class="dv">2</span>, <span class="dv">0</span>, <span class="dv">0</span>)</a>
<a class="sourceLine" id="cb12-14" title="14">)</a>
<a class="sourceLine" id="cb12-15" title="15"><span class="co"># faces </span></a>
<a class="sourceLine" id="cb12-16" title="16"><span class="kw">library</span>(cxhull)</a>
<a class="sourceLine" id="cb12-17" title="17">hull &lt;-<span class="st"> </span><span class="kw">cxhull</span>(vertices, <span class="dt">triangulate =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb12-18" title="18">faces &lt;-<span class="st"> </span><span class="kw">t</span>(<span class="kw">sapply</span>(hull<span class="op">$</span>facets, <span class="st">`</span><span class="dt">[[</span><span class="st">`</span>, <span class="st">&quot;vertices&quot;</span>))</a>
<a class="sourceLine" id="cb12-19" title="19"><span class="co"># edges</span></a>
<a class="sourceLine" id="cb12-20" title="20">hull &lt;-<span class="st"> </span><span class="kw">cxhull</span>(vertices, <span class="dt">triangulate =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb12-21" title="21">edges &lt;-<span class="st"> </span>hull<span class="op">$</span>edges</a></code></pre></div>
<p>And now we can proceed as before:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb13-1" title="1">s &lt;-<span class="st"> </span><span class="fl">0.5</span></a>
<a class="sourceLine" id="cb13-2" title="2"><span class="kw">view3d</span>(<span class="dv">30</span>, <span class="dv">30</span>, <span class="dt">zoom =</span> <span class="fl">0.7</span>)</a>
<a class="sourceLine" id="cb13-3" title="3"><span class="co"># plot vertices</span></a>
<a class="sourceLine" id="cb13-4" title="4"><span class="kw">spheres3d</span>(vertices, <span class="dt">radius =</span> <span class="fl">0.05</span>, <span class="dt">color =</span> <span class="st">&quot;yellow&quot;</span>)</a>
<a class="sourceLine" id="cb13-5" title="5"><span class="co"># plot edges</span></a>
<a class="sourceLine" id="cb13-6" title="6"><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="kw">nrow</span>(edges)){</a>
<a class="sourceLine" id="cb13-7" title="7">  A &lt;-<span class="st"> </span>vertices[edges[i,<span class="dv">1</span>],]</a>
<a class="sourceLine" id="cb13-8" title="8">  B &lt;-<span class="st"> </span>vertices[edges[i,<span class="dv">2</span>],]</a>
<a class="sourceLine" id="cb13-9" title="9">  AB &lt;-<span class="st"> </span><span class="kw">gyrosegment</span>(A, B, s)</a>
<a class="sourceLine" id="cb13-10" title="10">  <span class="kw">shade3d</span>(</a>
<a class="sourceLine" id="cb13-11" title="11">    <span class="kw">cylinder3d</span>(AB, <span class="dt">radius =</span> <span class="fl">0.03</span>, <span class="dt">sides =</span> <span class="dv">20</span>), <span class="dt">color =</span> <span class="st">&quot;yellow&quot;</span>)</a>
<a class="sourceLine" id="cb13-12" title="12">}</a>
<a class="sourceLine" id="cb13-13" title="13"><span class="co"># plot faces</span></a>
<a class="sourceLine" id="cb13-14" title="14"><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="kw">nrow</span>(faces)){</a>
<a class="sourceLine" id="cb13-15" title="15">  idx &lt;-<span class="st"> </span>faces[i,]</a>
<a class="sourceLine" id="cb13-16" title="16">  A &lt;-<span class="st"> </span>vertices[idx[<span class="dv">1</span>],]</a>
<a class="sourceLine" id="cb13-17" title="17">  B &lt;-<span class="st"> </span>vertices[idx[<span class="dv">2</span>],]</a>
<a class="sourceLine" id="cb13-18" title="18">  C &lt;-<span class="st"> </span>vertices[idx[<span class="dv">3</span>],]</a>
<a class="sourceLine" id="cb13-19" title="19">  mesh &lt;-<span class="st"> </span><span class="kw">gyrosubdiv</span>(A, B, C, <span class="dt">s =</span> s, <span class="dt">depth =</span> <span class="dv">6</span>)</a>
<a class="sourceLine" id="cb13-20" title="20">  <span class="kw">shade3d</span>(<span class="kw">addNormals</span>(mesh), <span class="dt">color =</span> <span class="st">&quot;navy&quot;</span>)</a>
<a class="sourceLine" id="cb13-21" title="21">}</a></code></pre></div>
<p><img src="./figures/hyperbolicPolyhedra-triangularbicopula-1.png" /></p>
<h2 id="asymptote-hyperbolic-dodecahedron">Asymptote hyperbolic dodecahedron</h2>
<p>Below is an Asymptote code which draws a hyperbolic dodecahedron. The gyromidpoint is calculated differently, in a way that does not resort to the scalar gyromultiplication.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode c"><code class="sourceCode c"><a class="sourceLine" id="cb14-1" title="1">settings.render = <span class="dv">4</span>;</a>
<a class="sourceLine" id="cb14-2" title="2">settings.outformat = <span class="st">&quot;pdf&quot;</span>;</a>
<a class="sourceLine" id="cb14-3" title="3"></a>
<a class="sourceLine" id="cb14-4" title="4"><span class="co">// modules -----------------------------------------------------------</span></a>
<a class="sourceLine" id="cb14-5" title="5">import three;</a>
<a class="sourceLine" id="cb14-6" title="6">import tube;</a>
<a class="sourceLine" id="cb14-7" title="7"></a>
<a class="sourceLine" id="cb14-8" title="8"><span class="co">// scene -------------------------------------------------------------</span></a>
<a class="sourceLine" id="cb14-9" title="9">size(<span class="dv">10</span><span class="er">cm</span>);</a>
<a class="sourceLine" id="cb14-10" title="10">currentprojection = orthographic(<span class="dv">20</span>, <span class="dv">10</span>, -<span class="dv">2</span>);</a>
<a class="sourceLine" id="cb14-11" title="11">viewportmargin = (<span class="dv">10</span>,<span class="dv">10</span>);</a>
<a class="sourceLine" id="cb14-12" title="12">currentlight = (<span class="dv">1000</span>,<span class="dv">500</span>,<span class="dv">100</span>);</a>
<a class="sourceLine" id="cb14-13" title="13"></a>
<a class="sourceLine" id="cb14-14" title="14"><span class="co">// gyromidpoint ------------------------------------------------------</span></a>
<a class="sourceLine" id="cb14-15" title="15">real gamma(triple M, real s){</a>
<a class="sourceLine" id="cb14-16" title="16">    <span class="cf">return</span> <span class="dv">1</span> / sqrt(<span class="dv">1</span> - dot(M,M)/s/s);</a>
<a class="sourceLine" id="cb14-17" title="17">}</a>
<a class="sourceLine" id="cb14-18" title="18"></a>
<a class="sourceLine" id="cb14-19" title="19">real beta(triple M, real s){</a>
<a class="sourceLine" id="cb14-20" title="20">    <span class="cf">return</span> <span class="dv">1</span> / sqrt(<span class="dv">1</span> + dot(M,M)/s/s);</a>
<a class="sourceLine" id="cb14-21" title="21">}</a>
<a class="sourceLine" id="cb14-22" title="22"></a>
<a class="sourceLine" id="cb14-23" title="23">triple phiEU(triple M, real s){</a>
<a class="sourceLine" id="cb14-24" title="24">    <span class="cf">return</span> gamma(M,s)*M;</a>
<a class="sourceLine" id="cb14-25" title="25">}</a>
<a class="sourceLine" id="cb14-26" title="26"></a>
<a class="sourceLine" id="cb14-27" title="27">triple phiUE(triple M, real s){</a>
<a class="sourceLine" id="cb14-28" title="28">    <span class="cf">return</span> beta(M,s)*M;</a>
<a class="sourceLine" id="cb14-29" title="29">}</a>
<a class="sourceLine" id="cb14-30" title="30"></a>
<a class="sourceLine" id="cb14-31" title="31">triple gyromidpointE(triple A, triple B, real s){</a>
<a class="sourceLine" id="cb14-32" title="32">    real gammaA = gamma(A,s);</a>
<a class="sourceLine" id="cb14-33" title="33">    real gammaB = gamma(B,s);</a>
<a class="sourceLine" id="cb14-34" title="34">    <span class="cf">return</span> (gammaA*A + gammaB*B)/(gammaA + gammaB); </a>
<a class="sourceLine" id="cb14-35" title="35">}</a>
<a class="sourceLine" id="cb14-36" title="36"></a>
<a class="sourceLine" id="cb14-37" title="37">triple gyromidpointU(triple A, triple B, real s){</a>
<a class="sourceLine" id="cb14-38" title="38">    <span class="cf">return</span> phiEU(gyromidpointE(phiUE(A,s), phiUE(B,s), s), s);</a>
<a class="sourceLine" id="cb14-39" title="39">}</a>
<a class="sourceLine" id="cb14-40" title="40"></a>
<a class="sourceLine" id="cb14-41" title="41"><span class="co">// mesh maker --------------------------------------------------------</span></a>
<a class="sourceLine" id="cb14-42" title="42">triple[][] subdiv0(triple[] triangle, real s){</a>
<a class="sourceLine" id="cb14-43" title="43">    triple m01 = gyromidpointU(triangle[<span class="dv">0</span>], triangle[<span class="dv">1</span>], s);</a>
<a class="sourceLine" id="cb14-44" title="44">    triple m02 = gyromidpointU(triangle[<span class="dv">0</span>], triangle[<span class="dv">2</span>], s);</a>
<a class="sourceLine" id="cb14-45" title="45">    triple m12 = gyromidpointU(triangle[<span class="dv">1</span>], triangle[<span class="dv">2</span>], s);</a>
<a class="sourceLine" id="cb14-46" title="46">    <span class="cf">return</span> new triple[][] {</a>
<a class="sourceLine" id="cb14-47" title="47">        {triangle[<span class="dv">0</span>], m01, m02}, </a>
<a class="sourceLine" id="cb14-48" title="48">        {triangle[<span class="dv">1</span>], m12, m01}, </a>
<a class="sourceLine" id="cb14-49" title="49">        {triangle[<span class="dv">2</span>], m02, m12}, </a>
<a class="sourceLine" id="cb14-50" title="50">        {m01, m12, m02}</a>
<a class="sourceLine" id="cb14-51" title="51">    };</a>
<a class="sourceLine" id="cb14-52" title="52">}</a>
<a class="sourceLine" id="cb14-53" title="53"></a>
<a class="sourceLine" id="cb14-54" title="54">triple[][] subdiv(<span class="dt">int</span> n, triple[] triangle, real s){</a>
<a class="sourceLine" id="cb14-55" title="55">  <span class="cf">if</span>(n==<span class="dv">1</span>){</a>
<a class="sourceLine" id="cb14-56" title="56">    <span class="cf">return</span> subdiv0(triangle, s);</a>
<a class="sourceLine" id="cb14-57" title="57">  }</a>
<a class="sourceLine" id="cb14-58" title="58">  triple[][] triangles = subdiv(n-<span class="dv">1</span>, triangle, s);</a>
<a class="sourceLine" id="cb14-59" title="59">  triple[][] out = new triple[<span class="dv">0</span>][<span class="dv">3</span>];</a>
<a class="sourceLine" id="cb14-60" title="60">  <span class="cf">for</span>(<span class="dt">int</span> i=<span class="dv">0</span>; i&lt;<span class="dv">4</span>^(n-<span class="dv">1</span>); ++i){</a>
<a class="sourceLine" id="cb14-61" title="61">    triple[] trgl = triangles[i];</a>
<a class="sourceLine" id="cb14-62" title="62">    out.append(subdiv0(trgl, s));</a>
<a class="sourceLine" id="cb14-63" title="63">  }</a>
<a class="sourceLine" id="cb14-64" title="64">  <span class="cf">return</span> out;</a>
<a class="sourceLine" id="cb14-65" title="65">}</a>
<a class="sourceLine" id="cb14-66" title="66"></a>
<a class="sourceLine" id="cb14-67" title="67"><span class="kw">struct</span> Mesh {</a>
<a class="sourceLine" id="cb14-68" title="68">    triple[] vertices;</a>
<a class="sourceLine" id="cb14-69" title="69">    <span class="dt">int</span>[][] indices;</a>
<a class="sourceLine" id="cb14-70" title="70">}</a>
<a class="sourceLine" id="cb14-71" title="71"></a>
<a class="sourceLine" id="cb14-72" title="72">Mesh htriangle(<span class="dt">int</span> n, triple[] triangle, real s){</a>
<a class="sourceLine" id="cb14-73" title="73">    triple[][] triangles = subdiv(n, triangle, s);</a>
<a class="sourceLine" id="cb14-74" title="74">    triple[] vertices;</a>
<a class="sourceLine" id="cb14-75" title="75">    <span class="dt">int</span>[][] indices;</a>
<a class="sourceLine" id="cb14-76" title="76">    <span class="dt">int</span> faceIndex = <span class="dv">0</span>;</a>
<a class="sourceLine" id="cb14-77" title="77">    <span class="cf">for</span>(<span class="dt">int</span> i=<span class="dv">0</span>; i&lt;triangles.length; ++i){</a>
<a class="sourceLine" id="cb14-78" title="78">        var triangle = triangles[i];</a>
<a class="sourceLine" id="cb14-79" title="79">        vertices.push(triangle[<span class="dv">0</span>]);</a>
<a class="sourceLine" id="cb14-80" title="80">        vertices.push(triangle[<span class="dv">1</span>]);</a>
<a class="sourceLine" id="cb14-81" title="81">        vertices.push(triangle[<span class="dv">2</span>]);</a>
<a class="sourceLine" id="cb14-82" title="82">        <span class="dt">int</span>[] x = {faceIndex, faceIndex+<span class="dv">1</span>, faceIndex+<span class="dv">2</span>};</a>
<a class="sourceLine" id="cb14-83" title="83">        indices.push(x);</a>
<a class="sourceLine" id="cb14-84" title="84">        faceIndex += <span class="dv">3</span>;</a>
<a class="sourceLine" id="cb14-85" title="85">    }</a>
<a class="sourceLine" id="cb14-86" title="86">    Mesh out;</a>
<a class="sourceLine" id="cb14-87" title="87">    out.vertices = vertices;</a>
<a class="sourceLine" id="cb14-88" title="88">    out.indices = indices;</a>
<a class="sourceLine" id="cb14-89" title="89">    <span class="cf">return</span> out;</a>
<a class="sourceLine" id="cb14-90" title="90">}</a>
<a class="sourceLine" id="cb14-91" title="91"></a>
<a class="sourceLine" id="cb14-92" title="92"><span class="co">// gyrosegment -------------------------------------------------------</span></a>
<a class="sourceLine" id="cb14-93" title="93">triple gyroadd(triple A, triple B, real s){</a>
<a class="sourceLine" id="cb14-94" title="94">    real betaA = beta(A,s);</a>
<a class="sourceLine" id="cb14-95" title="95">    real betaB = beta(B,s);</a>
<a class="sourceLine" id="cb14-96" title="96">    <span class="cf">return</span> A + B + (betaA/(<span class="dv">1</span>+betaA)*dot(A,B)/s/s + (<span class="dv">1</span>-betaB)/betaB)*A; </a>
<a class="sourceLine" id="cb14-97" title="97">}</a>
<a class="sourceLine" id="cb14-98" title="98"></a>
<a class="sourceLine" id="cb14-99" title="99">triple gyroscalar(real r, triple X, real s){</a>
<a class="sourceLine" id="cb14-100" title="100">    real Xnorm = length(X);</a>
<a class="sourceLine" id="cb14-101" title="101">    <span class="cf">return</span> s*sinh(r*asinh(Xnorm/s)) * X/Xnorm;</a>
<a class="sourceLine" id="cb14-102" title="102">}</a>
<a class="sourceLine" id="cb14-103" title="103"></a>
<a class="sourceLine" id="cb14-104" title="104">triple gyroABt(triple A, triple B, real t, real s){</a>
<a class="sourceLine" id="cb14-105" title="105">    <span class="cf">return</span> gyroadd(A, gyroscalar(t, gyroadd(-A, B, s=s), s=s), s=s);</a>
<a class="sourceLine" id="cb14-106" title="106">}</a>
<a class="sourceLine" id="cb14-107" title="107"></a>
<a class="sourceLine" id="cb14-108" title="108">path3 gyrosegment(triple A, triple B, real s, <span class="dt">int</span> n){</a>
<a class="sourceLine" id="cb14-109" title="109">    path3 out;</a>
<a class="sourceLine" id="cb14-110" title="110">    <span class="cf">for</span>(<span class="dt">int</span> i = <span class="dv">0</span>; i &lt;= n; ++i){</a>
<a class="sourceLine" id="cb14-111" title="111">        out = out -- gyroABt(A, B, i/n, s);</a>
<a class="sourceLine" id="cb14-112" title="112">    }</a>
<a class="sourceLine" id="cb14-113" title="113">    <span class="cf">return</span> out;</a>
<a class="sourceLine" id="cb14-114" title="114">}</a>
<a class="sourceLine" id="cb14-115" title="115"></a>
<a class="sourceLine" id="cb14-116" title="116"><span class="co">// dodecahedron vertices ---------------------------------------------</span></a>
<a class="sourceLine" id="cb14-117" title="117">real phi = (<span class="dv">1</span> + sqrt(<span class="dv">5</span>)) / <span class="dv">2</span>;</a>
<a class="sourceLine" id="cb14-118" title="118">real a = <span class="dv">1</span> / sqrt(<span class="dv">3</span>);</a>
<a class="sourceLine" id="cb14-119" title="119">real b = a / phi;</a>
<a class="sourceLine" id="cb14-120" title="120">real c = a * phi;</a>
<a class="sourceLine" id="cb14-121" title="121">triple[] vertices = </a>
<a class="sourceLine" id="cb14-122" title="122">    {(a, a, a),</a>
<a class="sourceLine" id="cb14-123" title="123">    (a, a, -a),</a>
<a class="sourceLine" id="cb14-124" title="124">    (a, -a, a),</a>
<a class="sourceLine" id="cb14-125" title="125">    (-a, -a, a),</a>
<a class="sourceLine" id="cb14-126" title="126">    (-a, a, -a),</a>
<a class="sourceLine" id="cb14-127" title="127">    (-a, a, a),</a>
<a class="sourceLine" id="cb14-128" title="128">    (<span class="dv">0</span>, b, -c),</a>
<a class="sourceLine" id="cb14-129" title="129">    (<span class="dv">0</span>, -b, -c),</a>
<a class="sourceLine" id="cb14-130" title="130">    (<span class="dv">0</span>, -b, c),</a>
<a class="sourceLine" id="cb14-131" title="131">    (c, <span class="dv">0</span>, -b),</a>
<a class="sourceLine" id="cb14-132" title="132">    (-c, <span class="dv">0</span>, -b),</a>
<a class="sourceLine" id="cb14-133" title="133">    (-c, <span class="dv">0</span>, b),</a>
<a class="sourceLine" id="cb14-134" title="134">    (b, c, <span class="dv">0</span>),</a>
<a class="sourceLine" id="cb14-135" title="135">    (b, -c, <span class="dv">0</span>),</a>
<a class="sourceLine" id="cb14-136" title="136">    (-b, -c, <span class="dv">0</span>),</a>
<a class="sourceLine" id="cb14-137" title="137">    (-b, c, <span class="dv">0</span>),</a>
<a class="sourceLine" id="cb14-138" title="138">    (<span class="dv">0</span>, b, c),</a>
<a class="sourceLine" id="cb14-139" title="139">    (a, -a, -a),</a>
<a class="sourceLine" id="cb14-140" title="140">    (c, <span class="dv">0</span>, b),</a>
<a class="sourceLine" id="cb14-141" title="141">    (-a, -a, -a)};</a>
<a class="sourceLine" id="cb14-142" title="142">    </a>
<a class="sourceLine" id="cb14-143" title="143"><span class="co">// dodecahedron faces ------------------------------------------------</span></a>
<a class="sourceLine" id="cb14-144" title="144"><span class="dt">int</span>[][] faces = </a>
<a class="sourceLine" id="cb14-145" title="145">    {</a>
<a class="sourceLine" id="cb14-146" title="146">        {<span class="dv">13</span>, <span class="dv">2</span>, <span class="dv">3</span>},</a>
<a class="sourceLine" id="cb14-147" title="147">        {<span class="dv">3</span>, <span class="dv">14</span>, <span class="dv">13</span>},</a>
<a class="sourceLine" id="cb14-148" title="148">        {<span class="dv">3</span>, <span class="dv">2</span>, <span class="dv">8</span>},</a>
<a class="sourceLine" id="cb14-149" title="149">        {<span class="dv">17</span>, <span class="dv">1</span>, <span class="dv">9</span>},</a>
<a class="sourceLine" id="cb14-150" title="150">        {<span class="dv">6</span>, <span class="dv">1</span>, <span class="dv">17</span>},</a>
<a class="sourceLine" id="cb14-151" title="151">        {<span class="dv">17</span>, <span class="dv">7</span>, <span class="dv">6</span>},</a>
<a class="sourceLine" id="cb14-152" title="152">        {<span class="dv">6</span>, <span class="dv">7</span>, <span class="dv">19</span>},</a>
<a class="sourceLine" id="cb14-153" title="153">        {<span class="dv">19</span>, <span class="dv">4</span>, <span class="dv">6</span>},</a>
<a class="sourceLine" id="cb14-154" title="154">        {<span class="dv">10</span>, <span class="dv">4</span>, <span class="dv">19</span>},</a>
<a class="sourceLine" id="cb14-155" title="155">        {<span class="dv">13</span>, <span class="dv">14</span>, <span class="dv">19</span>},</a>
<a class="sourceLine" id="cb14-156" title="156">        {<span class="dv">19</span>, <span class="dv">17</span>, <span class="dv">13</span>},</a>
<a class="sourceLine" id="cb14-157" title="157">        {<span class="dv">7</span>, <span class="dv">17</span>, <span class="dv">19</span>},</a>
<a class="sourceLine" id="cb14-158" title="158">        {<span class="dv">15</span>, <span class="dv">1</span>, <span class="dv">6</span>},</a>
<a class="sourceLine" id="cb14-159" title="159">        {<span class="dv">12</span>, <span class="dv">1</span>, <span class="dv">15</span>},</a>
<a class="sourceLine" id="cb14-160" title="160">        {<span class="dv">6</span>, <span class="dv">4</span>, <span class="dv">15</span>},</a>
<a class="sourceLine" id="cb14-161" title="161">        {<span class="dv">15</span>, <span class="dv">0</span>, <span class="dv">12</span>},</a>
<a class="sourceLine" id="cb14-162" title="162">        {<span class="dv">15</span>, <span class="dv">16</span>, <span class="dv">0</span>},</a>
<a class="sourceLine" id="cb14-163" title="163">        {<span class="dv">5</span>, <span class="dv">16</span>, <span class="dv">15</span>},</a>
<a class="sourceLine" id="cb14-164" title="164">        {<span class="dv">18</span>, <span class="dv">1</span>, <span class="dv">12</span>},</a>
<a class="sourceLine" id="cb14-165" title="165">        {<span class="dv">12</span>, <span class="dv">0</span>, <span class="dv">18</span>},</a>
<a class="sourceLine" id="cb14-166" title="166">        {<span class="dv">9</span>, <span class="dv">1</span>, <span class="dv">18</span>},</a>
<a class="sourceLine" id="cb14-167" title="167">        {<span class="dv">0</span>, <span class="dv">16</span>, <span class="dv">18</span>},</a>
<a class="sourceLine" id="cb14-168" title="168">        {<span class="dv">8</span>, <span class="dv">2</span>, <span class="dv">18</span>},</a>
<a class="sourceLine" id="cb14-169" title="169">        {<span class="dv">18</span>, <span class="dv">16</span>, <span class="dv">8</span>},</a>
<a class="sourceLine" id="cb14-170" title="170">        {<span class="dv">18</span>, <span class="dv">2</span>, <span class="dv">13</span>},</a>
<a class="sourceLine" id="cb14-171" title="171">        {<span class="dv">18</span>, <span class="dv">17</span>, <span class="dv">9</span>},</a>
<a class="sourceLine" id="cb14-172" title="172">        {<span class="dv">13</span>, <span class="dv">17</span>, <span class="dv">18</span>},</a>
<a class="sourceLine" id="cb14-173" title="173">        {<span class="dv">8</span>, <span class="dv">16</span>, <span class="dv">11</span>},</a>
<a class="sourceLine" id="cb14-174" title="174">        {<span class="dv">11</span>, <span class="dv">16</span>, <span class="dv">5</span>},</a>
<a class="sourceLine" id="cb14-175" title="175">        {<span class="dv">11</span>, <span class="dv">3</span>, <span class="dv">8</span>},</a>
<a class="sourceLine" id="cb14-176" title="176">        {<span class="dv">14</span>, <span class="dv">3</span>, <span class="dv">11</span>},</a>
<a class="sourceLine" id="cb14-177" title="177">        {<span class="dv">11</span>, <span class="dv">19</span>, <span class="dv">14</span>},</a>
<a class="sourceLine" id="cb14-178" title="178">        {<span class="dv">10</span>, <span class="dv">19</span>, <span class="dv">11</span>},</a>
<a class="sourceLine" id="cb14-179" title="179">        {<span class="dv">11</span>, <span class="dv">4</span>, <span class="dv">10</span>},</a>
<a class="sourceLine" id="cb14-180" title="180">        {<span class="dv">5</span>, <span class="dv">15</span>, <span class="dv">11</span>},</a>
<a class="sourceLine" id="cb14-181" title="181">        {<span class="dv">11</span>, <span class="dv">15</span>, <span class="dv">4</span>}</a>
<a class="sourceLine" id="cb14-182" title="182">    };</a>
<a class="sourceLine" id="cb14-183" title="183"></a>
<a class="sourceLine" id="cb14-184" title="184"><span class="co">// dodecahedron edges ------------------------------------------------</span></a>
<a class="sourceLine" id="cb14-185" title="185"><span class="dt">int</span>[][] edges = </a>
<a class="sourceLine" id="cb14-186" title="186">    {</a>
<a class="sourceLine" id="cb14-187" title="187">     {<span class="dv">13</span>, <span class="dv">2</span>},</a>
<a class="sourceLine" id="cb14-188" title="188">     {<span class="dv">3</span>, <span class="dv">14</span>},</a>
<a class="sourceLine" id="cb14-189" title="189">     {<span class="dv">14</span>, <span class="dv">13</span>},</a>
<a class="sourceLine" id="cb14-190" title="190">     {<span class="dv">3</span>, <span class="dv">8</span>},</a>
<a class="sourceLine" id="cb14-191" title="191">     {<span class="dv">2</span>, <span class="dv">8</span>},</a>
<a class="sourceLine" id="cb14-192" title="192">     {<span class="dv">17</span>, <span class="dv">9</span>},</a>
<a class="sourceLine" id="cb14-193" title="193">     {<span class="dv">1</span>, <span class="dv">9</span>},</a>
<a class="sourceLine" id="cb14-194" title="194">     {<span class="dv">6</span>, <span class="dv">1</span>},</a>
<a class="sourceLine" id="cb14-195" title="195">     {<span class="dv">17</span>, <span class="dv">7</span>},</a>
<a class="sourceLine" id="cb14-196" title="196">     {<span class="dv">7</span>, <span class="dv">6</span>},</a>
<a class="sourceLine" id="cb14-197" title="197">     {<span class="dv">7</span>, <span class="dv">19</span>},</a>
<a class="sourceLine" id="cb14-198" title="198">     {<span class="dv">4</span>, <span class="dv">6</span>},</a>
<a class="sourceLine" id="cb14-199" title="199">     {<span class="dv">10</span>, <span class="dv">4</span>},</a>
<a class="sourceLine" id="cb14-200" title="200">     {<span class="dv">10</span>, <span class="dv">19</span>},</a>
<a class="sourceLine" id="cb14-201" title="201">     {<span class="dv">14</span>, <span class="dv">19</span>},</a>
<a class="sourceLine" id="cb14-202" title="202">     {<span class="dv">17</span>, <span class="dv">13</span>},</a>
<a class="sourceLine" id="cb14-203" title="203">     {<span class="dv">12</span>, <span class="dv">1</span>},</a>
<a class="sourceLine" id="cb14-204" title="204">     {<span class="dv">12</span>, <span class="dv">15</span>},</a>
<a class="sourceLine" id="cb14-205" title="205">     {<span class="dv">4</span>, <span class="dv">15</span>},</a>
<a class="sourceLine" id="cb14-206" title="206">     {<span class="dv">0</span>, <span class="dv">12</span>},</a>
<a class="sourceLine" id="cb14-207" title="207">     {<span class="dv">16</span>, <span class="dv">0</span>},</a>
<a class="sourceLine" id="cb14-208" title="208">     {<span class="dv">5</span>, <span class="dv">16</span>},</a>
<a class="sourceLine" id="cb14-209" title="209">     {<span class="dv">5</span>, <span class="dv">15</span>},</a>
<a class="sourceLine" id="cb14-210" title="210">     {<span class="dv">0</span>, <span class="dv">18</span>},</a>
<a class="sourceLine" id="cb14-211" title="211">     {<span class="dv">9</span>, <span class="dv">18</span>},</a>
<a class="sourceLine" id="cb14-212" title="212">     {<span class="dv">2</span>, <span class="dv">18</span>},</a>
<a class="sourceLine" id="cb14-213" title="213">     {<span class="dv">16</span>, <span class="dv">8</span>},</a>
<a class="sourceLine" id="cb14-214" title="214">     {<span class="dv">11</span>, <span class="dv">5</span>},</a>
<a class="sourceLine" id="cb14-215" title="215">     {<span class="dv">11</span>, <span class="dv">3</span>},</a>
<a class="sourceLine" id="cb14-216" title="216">     {<span class="dv">10</span>, <span class="dv">11</span>}</a>
<a class="sourceLine" id="cb14-217" title="217">    };</a>
<a class="sourceLine" id="cb14-218" title="218"></a>
<a class="sourceLine" id="cb14-219" title="219"><span class="co">// plot --------------------------------------------------------------</span></a>
<a class="sourceLine" id="cb14-220" title="220">real s = <span class="fl">0.3</span>;</a>
<a class="sourceLine" id="cb14-221" title="221"><span class="cf">for</span>(<span class="dt">int</span> i=<span class="dv">0</span>; i&lt;faces.length; ++i){</a>
<a class="sourceLine" id="cb14-222" title="222">    <span class="dt">int</span>[] idx = faces[i];</a>
<a class="sourceLine" id="cb14-223" title="223">    triple[] triangle = {vertices[idx[<span class="dv">0</span>]],vertices[idx[<span class="dv">1</span>]],vertices[idx[<span class="dv">2</span>]]};</a>
<a class="sourceLine" id="cb14-224" title="224">    Mesh mesh = htriangle(<span class="dv">6</span>, triangle, s);</a>
<a class="sourceLine" id="cb14-225" title="225">    draw(mesh.vertices, mesh.indices, m=rgb(<span class="st">&quot;000080ff&quot;</span>));</a>
<a class="sourceLine" id="cb14-226" title="226">}</a>
<a class="sourceLine" id="cb14-227" title="227"></a>
<a class="sourceLine" id="cb14-228" title="228"><span class="cf">for</span>(<span class="dt">int</span> i=<span class="dv">0</span>; i&lt;edges.length; ++i){</a>
<a class="sourceLine" id="cb14-229" title="229">    triple A = vertices[edges[i][<span class="dv">0</span>]];</a>
<a class="sourceLine" id="cb14-230" title="230">    triple B = vertices[edges[i][<span class="dv">1</span>]];</a>
<a class="sourceLine" id="cb14-231" title="231">    path3 AB = gyrosegment(A, B, s, <span class="dv">50</span>);</a>
<a class="sourceLine" id="cb14-232" title="232">    draw(tube(AB, scale(<span class="fl">0.02</span>)*unitcircle), yellow);</a>
<a class="sourceLine" id="cb14-233" title="233">}</a>
<a class="sourceLine" id="cb14-234" title="234"></a>
<a class="sourceLine" id="cb14-235" title="235"><span class="cf">for</span>(<span class="dt">int</span> i=<span class="dv">0</span>; i&lt;vertices.length; ++i){</a>
<a class="sourceLine" id="cb14-236" title="236">    draw(shift(vertices[i])*scale3(<span class="fl">0.03</span>)*unitsphere, yellow);</a>
<a class="sourceLine" id="cb14-237" title="237">}</a></code></pre></div>
<p><img src="figures/hyperbolicPolyhedra-asy.png" /></p>
<h2 id="three.js-hyperbolic-dodecahedron">three.js hyperbolic dodecahedron</h2>
<p>Here is a hyperbolic dodecahedron plotted with <code>three.js</code>:</p>
<iframe src="../frames/threejs_hyperbolicDodecahedron2.html" width="100%" height="500px" scrolling="no" frameborder="0">
</iframe>
<h2 id="pov-ray-hyperbolic-dodecahedron">POV-Ray hyperbolic dodecahedron</h2>
<p>And here is a hyperbolic dodecahedron plotted with <code>POV-Ray</code>:</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode povray"><code class="sourceCode povray"><a class="sourceLine" id="cb15-1" title="1"><span class="co">// hyperbolic dodecahedron //</span></a>
<a class="sourceLine" id="cb15-2" title="2"><span class="ot">#version</span> <span class="fl">3.7</span>;</a>
<a class="sourceLine" id="cb15-3" title="3"><span class="kw">global_settings</span> { <span class="kw">assumed_gamma</span> <span class="fl">1</span> } </a>
<a class="sourceLine" id="cb15-4" title="4"></a>
<a class="sourceLine" id="cb15-5" title="5"><span class="ot">#include</span> <span class="st">&quot;colors.inc&quot;</span></a>
<a class="sourceLine" id="cb15-6" title="6"><span class="ot">#include</span> <span class="st">&quot;textures.inc&quot;</span></a>
<a class="sourceLine" id="cb15-7" title="7"></a>
<a class="sourceLine" id="cb15-8" title="8"><span class="co">// Camera and light source -----------------------------------------------------</span></a>
<a class="sourceLine" id="cb15-9" title="9"><span class="kw">camera</span> {</a>
<a class="sourceLine" id="cb15-10" title="10">    <span class="kw">location</span> &lt;<span class="fl">0</span>,<span class="fl">0</span>,-<span class="fl">4</span>&gt; </a>
<a class="sourceLine" id="cb15-11" title="11">    <span class="kw">look_at</span> <span class="fl">0</span></a>
<a class="sourceLine" id="cb15-12" title="12">    <span class="kw">angle</span> <span class="fl">45</span></a>
<a class="sourceLine" id="cb15-13" title="13">}</a>
<a class="sourceLine" id="cb15-14" title="14"><span class="kw">light_source</span> { &lt;<span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">-1000</span>&gt; White }</a>
<a class="sourceLine" id="cb15-15" title="15"></a>
<a class="sourceLine" id="cb15-16" title="16"><span class="co">// gyrostuff -------------------------------------------------------------------</span></a>
<a class="sourceLine" id="cb15-17" title="17"><span class="kw">#macro dotprod</span>(A,B)</a>
<a class="sourceLine" id="cb15-18" title="18">    (A.<span class="kw">x</span>*B.<span class="kw">x</span> + A.<span class="kw">y</span>*B.<span class="kw">y</span> + A.<span class="kw">z</span>*B.<span class="kw">z</span>)</a>
<a class="sourceLine" id="cb15-19" title="19"><span class="ot">#end</span></a>
<a class="sourceLine" id="cb15-20" title="20"></a>
<a class="sourceLine" id="cb15-21" title="21"><span class="kw">#macro beta</span>(A,s)</a>
<a class="sourceLine" id="cb15-22" title="22">    (<span class="fl">1</span> / <span class="kw">sqrt</span>(<span class="fl">1</span> + dotprod(A,A)/s/s))</a>
<a class="sourceLine" id="cb15-23" title="23"><span class="ot">#end</span></a>
<a class="sourceLine" id="cb15-24" title="24"></a>
<a class="sourceLine" id="cb15-25" title="25"><span class="kw">#macro gyroadd</span>(A,B,s)</a>
<a class="sourceLine" id="cb15-26" title="26">    <span class="kw">#local betaA </span>= beta(A,s);</a>
<a class="sourceLine" id="cb15-27" title="27">    <span class="kw">#local betaB </span>= beta(B,s);</a>
<a class="sourceLine" id="cb15-28" title="28">    (<span class="fl">1</span> + betaA/(<span class="fl">1</span>+betaA)*dotprod(A,B)/s/s + (<span class="fl">1</span>-betaB)/betaB) * A + B</a>
<a class="sourceLine" id="cb15-29" title="29"><span class="ot">#end</span></a>
<a class="sourceLine" id="cb15-30" title="30"></a>
<a class="sourceLine" id="cb15-31" title="31"><span class="kw">#macro gyroscalar</span>(r,A,s)</a>
<a class="sourceLine" id="cb15-32" title="32">    <span class="kw">#local Anorm </span>= dotprod(A,A);</a>
<a class="sourceLine" id="cb15-33" title="33">    s/Anorm * <span class="kw">sinh</span>(r*<span class="kw">asinh</span>(Anorm/s)) * A</a>
<a class="sourceLine" id="cb15-34" title="34"><span class="ot">#end</span></a>
<a class="sourceLine" id="cb15-35" title="35"></a>
<a class="sourceLine" id="cb15-36" title="36"><span class="kw">#macro gyroABr</span>(A,B,s,r)</a>
<a class="sourceLine" id="cb15-37" title="37">    gyroadd(A, gyroscalar(r, gyroadd(-A, B, s), s), s)</a>
<a class="sourceLine" id="cb15-38" title="38"><span class="ot">#end</span> </a>
<a class="sourceLine" id="cb15-39" title="39"></a>
<a class="sourceLine" id="cb15-40" title="40"><span class="kw">#macro gyromidpoint</span>(A,B,s)</a>
<a class="sourceLine" id="cb15-41" title="41">    gyroABr(A,B,s,<span class="fl">0.5</span>)</a>
<a class="sourceLine" id="cb15-42" title="42"><span class="ot">#end</span> </a>
<a class="sourceLine" id="cb15-43" title="43"></a>
<a class="sourceLine" id="cb15-44" title="44"><span class="kw">#macro gyrosegment</span>(A,B,s,n)</a>
<a class="sourceLine" id="cb15-45" title="45">    <span class="kw">#local out </span>= <span class="kw">array</span>[n+<span class="fl">1</span>];</a>
<a class="sourceLine" id="cb15-46" title="46">    #for(i, <span class="fl">0</span>, n)</a>
<a class="sourceLine" id="cb15-47" title="47">        <span class="kw">#local out</span>[i] = gyroABr(A,B,s,i/n);</a>
<a class="sourceLine" id="cb15-48" title="48">    <span class="ot">#end</span></a>
<a class="sourceLine" id="cb15-49" title="49">    out</a>
<a class="sourceLine" id="cb15-50" title="50"><span class="ot">#end</span></a>
<a class="sourceLine" id="cb15-51" title="51"></a>
<a class="sourceLine" id="cb15-52" title="52"><span class="co">// subdivision step ------------------------------------------------------------</span></a>
<a class="sourceLine" id="cb15-53" title="53"><span class="kw">#macro subdiv0</span>(A,B,C,s)</a>
<a class="sourceLine" id="cb15-54" title="54">    <span class="kw">#local mAB </span>= gyromidpoint(A,B,s);</a>
<a class="sourceLine" id="cb15-55" title="55">    <span class="kw">#local mAC </span>= gyromidpoint(A,C,s);</a>
<a class="sourceLine" id="cb15-56" title="56">    <span class="kw">#local mBC </span>= gyromidpoint(B,C,s);</a>
<a class="sourceLine" id="cb15-57" title="57">    <span class="kw">#local trgl1 </span>= <span class="kw">array</span>[<span class="fl">3</span>] {A, mAB, mAC};</a>
<a class="sourceLine" id="cb15-58" title="58">    <span class="kw">#local trgl2 </span>= <span class="kw">array</span>[<span class="fl">3</span>] {B, mAB, mBC};</a>
<a class="sourceLine" id="cb15-59" title="59">    <span class="kw">#local trgl3 </span>= <span class="kw">array</span>[<span class="fl">3</span>] {C, mBC, mAC};</a>
<a class="sourceLine" id="cb15-60" title="60">    <span class="kw">#local trgl4 </span>= <span class="kw">array</span>[<span class="fl">3</span>] {mAB, mAC, mBC};</a>
<a class="sourceLine" id="cb15-61" title="61">    <span class="kw">array</span>[<span class="fl">4</span>] {trgl1, trgl2, trgl3, trgl4}</a>
<a class="sourceLine" id="cb15-62" title="62"><span class="ot">#end</span></a>
<a class="sourceLine" id="cb15-63" title="63"></a>
<a class="sourceLine" id="cb15-64" title="64"><span class="co">// iterated subdivision --------------------------------------------------------</span></a>
<a class="sourceLine" id="cb15-65" title="65"><span class="kw">#macro subdiv</span>(A,B,C,s,depth)</a>
<a class="sourceLine" id="cb15-66" title="66">    <span class="ot">#if</span>(depth=<span class="fl">1</span>)</a>
<a class="sourceLine" id="cb15-67" title="67">        <span class="kw">#local out </span>= subdiv0(A,B,C,s);</a>
<a class="sourceLine" id="cb15-68" title="68">    <span class="ot">#else</span></a>
<a class="sourceLine" id="cb15-69" title="69">        <span class="kw">#local triangles </span>= subdiv(A,B,C,s,depth<span class="fl">-1</span>);</a>
<a class="sourceLine" id="cb15-70" title="70">        <span class="kw">#local out </span>= <span class="kw">array</span>[<span class="kw">pow</span>(<span class="fl">4</span>,depth)];</a>
<a class="sourceLine" id="cb15-71" title="71">        #for(i,<span class="fl">0</span>,<span class="kw">pow</span>(<span class="fl">4</span>,depth<span class="fl">-1</span>)-<span class="fl">1</span>)</a>
<a class="sourceLine" id="cb15-72" title="72">            <span class="kw">#local trgl </span>= triangles[i];</a>
<a class="sourceLine" id="cb15-73" title="73">            <span class="kw">#local trgls </span>= subdiv0(trgl[<span class="fl">0</span>], trgl[<span class="fl">1</span>], trgl[<span class="fl">2</span>], s);</a>
<a class="sourceLine" id="cb15-74" title="74">            <span class="kw">#local out</span>[<span class="fl">4</span>*i] = trgls[<span class="fl">0</span>];</a>
<a class="sourceLine" id="cb15-75" title="75">            <span class="kw">#local out</span>[<span class="fl">4</span>*i+<span class="fl">1</span>] = trgls[<span class="fl">1</span>];</a>
<a class="sourceLine" id="cb15-76" title="76">            <span class="kw">#local out</span>[<span class="fl">4</span>*i+<span class="fl">2</span>] = trgls[<span class="fl">2</span>];</a>
<a class="sourceLine" id="cb15-77" title="77">            <span class="kw">#local out</span>[<span class="fl">4</span>*i+<span class="fl">3</span>] = trgls[<span class="fl">3</span>];</a>
<a class="sourceLine" id="cb15-78" title="78">        <span class="ot">#end</span></a>
<a class="sourceLine" id="cb15-79" title="79">    <span class="ot">#end</span></a>
<a class="sourceLine" id="cb15-80" title="80">    out</a>
<a class="sourceLine" id="cb15-81" title="81"><span class="ot">#end</span></a>
<a class="sourceLine" id="cb15-82" title="82"></a>
<a class="sourceLine" id="cb15-83" title="83"><span class="co">// dodecahedron ----------------------------------------------------------------</span></a>
<a class="sourceLine" id="cb15-84" title="84"><span class="kw">#declare phi </span>= (<span class="fl">1</span>+<span class="kw">sqrt</span>(<span class="fl">5</span>))/<span class="fl">2</span>;</a>
<a class="sourceLine" id="cb15-85" title="85"><span class="kw">#declare a </span>= <span class="fl">1</span>/<span class="kw">sqrt</span>(<span class="fl">3</span>);</a>
<a class="sourceLine" id="cb15-86" title="86"><span class="kw">#declare b </span>= a/phi;</a>
<a class="sourceLine" id="cb15-87" title="87"><span class="kw">#declare c </span>= a*phi;</a>
<a class="sourceLine" id="cb15-88" title="88"><span class="kw">#declare vs </span>= <span class="kw">array</span>[<span class="fl">20</span>]</a>
<a class="sourceLine" id="cb15-89" title="89">  { &lt;a,  a,  a&gt;,</a>
<a class="sourceLine" id="cb15-90" title="90">    &lt;a,  a, -a&gt;,</a>
<a class="sourceLine" id="cb15-91" title="91">    &lt;a, -a,  a&gt;,</a>
<a class="sourceLine" id="cb15-92" title="92">    &lt;-a, -a,  a&gt;,</a>
<a class="sourceLine" id="cb15-93" title="93">    &lt;-a,  a, -a&gt;,</a>
<a class="sourceLine" id="cb15-94" title="94">    &lt;-a,  a,  a&gt;,</a>
<a class="sourceLine" id="cb15-95" title="95">    &lt;<span class="fl">0</span>,  b, -c&gt;,</a>
<a class="sourceLine" id="cb15-96" title="96">    &lt;<span class="fl">0</span>, -b, -c&gt;,</a>
<a class="sourceLine" id="cb15-97" title="97">    &lt;<span class="fl">0</span>, -b,  c&gt;,</a>
<a class="sourceLine" id="cb15-98" title="98">    &lt;c,  <span class="fl">0</span>, -b&gt;,</a>
<a class="sourceLine" id="cb15-99" title="99">    &lt;-c,  <span class="fl">0</span>, -b&gt;,</a>
<a class="sourceLine" id="cb15-100" title="100">    &lt;-c,  <span class="fl">0</span>,  b&gt;,</a>
<a class="sourceLine" id="cb15-101" title="101">    &lt;b,  c,  <span class="fl">0</span>&gt;,</a>
<a class="sourceLine" id="cb15-102" title="102">    &lt;b, -c,  <span class="fl">0</span>&gt;,</a>
<a class="sourceLine" id="cb15-103" title="103">    &lt;-b, -c,  <span class="fl">0</span>&gt;,</a>
<a class="sourceLine" id="cb15-104" title="104">    &lt;-b,  c,  <span class="fl">0</span>&gt;,</a>
<a class="sourceLine" id="cb15-105" title="105">    &lt;<span class="fl">0</span>,  b,  c&gt;,</a>
<a class="sourceLine" id="cb15-106" title="106">    &lt;a, -a, -a&gt;,</a>
<a class="sourceLine" id="cb15-107" title="107">    &lt;c,  <span class="fl">0</span>,  b&gt;,</a>
<a class="sourceLine" id="cb15-108" title="108">    &lt;-a, -a, -a&gt; };</a>
<a class="sourceLine" id="cb15-109" title="109"><span class="kw">#declare faces </span>= <span class="kw">array</span>[<span class="fl">36</span>][<span class="fl">3</span>]</a>
<a class="sourceLine" id="cb15-110" title="110">    {</a>
<a class="sourceLine" id="cb15-111" title="111">        {<span class="fl">13</span>, <span class="fl">2</span>, <span class="fl">3</span>},</a>
<a class="sourceLine" id="cb15-112" title="112">        {<span class="fl">3</span>, <span class="fl">14</span>, <span class="fl">13</span>},</a>
<a class="sourceLine" id="cb15-113" title="113">        {<span class="fl">3</span>, <span class="fl">2</span>, <span class="fl">8</span>},</a>
<a class="sourceLine" id="cb15-114" title="114">        {<span class="fl">17</span>, <span class="fl">1</span>, <span class="fl">9</span>},</a>
<a class="sourceLine" id="cb15-115" title="115">        {<span class="fl">6</span>, <span class="fl">1</span>, <span class="fl">17</span>},</a>
<a class="sourceLine" id="cb15-116" title="116">        {<span class="fl">17</span>, <span class="fl">7</span>, <span class="fl">6</span>},</a>
<a class="sourceLine" id="cb15-117" title="117">        {<span class="fl">6</span>, <span class="fl">7</span>, <span class="fl">19</span>},</a>
<a class="sourceLine" id="cb15-118" title="118">        {<span class="fl">19</span>, <span class="fl">4</span>, <span class="fl">6</span>},</a>
<a class="sourceLine" id="cb15-119" title="119">        {<span class="fl">10</span>, <span class="fl">4</span>, <span class="fl">19</span>},</a>
<a class="sourceLine" id="cb15-120" title="120">        {<span class="fl">13</span>, <span class="fl">14</span>, <span class="fl">19</span>},</a>
<a class="sourceLine" id="cb15-121" title="121">        {<span class="fl">19</span>, <span class="fl">17</span>, <span class="fl">13</span>},</a>
<a class="sourceLine" id="cb15-122" title="122">        {<span class="fl">7</span>, <span class="fl">17</span>, <span class="fl">19</span>},</a>
<a class="sourceLine" id="cb15-123" title="123">        {<span class="fl">15</span>, <span class="fl">1</span>, <span class="fl">6</span>},</a>
<a class="sourceLine" id="cb15-124" title="124">        {<span class="fl">12</span>, <span class="fl">1</span>, <span class="fl">15</span>},</a>
<a class="sourceLine" id="cb15-125" title="125">        {<span class="fl">6</span>, <span class="fl">4</span>, <span class="fl">15</span>},</a>
<a class="sourceLine" id="cb15-126" title="126">        {<span class="fl">15</span>, <span class="fl">0</span>, <span class="fl">12</span>},</a>
<a class="sourceLine" id="cb15-127" title="127">        {<span class="fl">15</span>, <span class="fl">16</span>, <span class="fl">0</span>},</a>
<a class="sourceLine" id="cb15-128" title="128">        {<span class="fl">5</span>, <span class="fl">16</span>, <span class="fl">15</span>},</a>
<a class="sourceLine" id="cb15-129" title="129">        {<span class="fl">18</span>, <span class="fl">1</span>, <span class="fl">12</span>},</a>
<a class="sourceLine" id="cb15-130" title="130">        {<span class="fl">12</span>, <span class="fl">0</span>, <span class="fl">18</span>},</a>
<a class="sourceLine" id="cb15-131" title="131">        {<span class="fl">9</span>, <span class="fl">1</span>, <span class="fl">18</span>},</a>
<a class="sourceLine" id="cb15-132" title="132">        {<span class="fl">0</span>, <span class="fl">16</span>, <span class="fl">18</span>},</a>
<a class="sourceLine" id="cb15-133" title="133">        {<span class="fl">8</span>, <span class="fl">2</span>, <span class="fl">18</span>},</a>
<a class="sourceLine" id="cb15-134" title="134">        {<span class="fl">18</span>, <span class="fl">16</span>, <span class="fl">8</span>},</a>
<a class="sourceLine" id="cb15-135" title="135">        {<span class="fl">18</span>, <span class="fl">2</span>, <span class="fl">13</span>},</a>
<a class="sourceLine" id="cb15-136" title="136">        {<span class="fl">18</span>, <span class="fl">17</span>, <span class="fl">9</span>},</a>
<a class="sourceLine" id="cb15-137" title="137">        {<span class="fl">13</span>, <span class="fl">17</span>, <span class="fl">18</span>},</a>
<a class="sourceLine" id="cb15-138" title="138">        {<span class="fl">8</span>, <span class="fl">16</span>, <span class="fl">11</span>},</a>
<a class="sourceLine" id="cb15-139" title="139">        {<span class="fl">11</span>, <span class="fl">16</span>, <span class="fl">5</span>},</a>
<a class="sourceLine" id="cb15-140" title="140">        {<span class="fl">11</span>, <span class="fl">3</span>, <span class="fl">8</span>},</a>
<a class="sourceLine" id="cb15-141" title="141">        {<span class="fl">14</span>, <span class="fl">3</span>, <span class="fl">11</span>},</a>
<a class="sourceLine" id="cb15-142" title="142">        {<span class="fl">11</span>, <span class="fl">19</span>, <span class="fl">14</span>},</a>
<a class="sourceLine" id="cb15-143" title="143">        {<span class="fl">10</span>, <span class="fl">19</span>, <span class="fl">11</span>},</a>
<a class="sourceLine" id="cb15-144" title="144">        {<span class="fl">11</span>, <span class="fl">4</span>, <span class="fl">10</span>},</a>
<a class="sourceLine" id="cb15-145" title="145">        {<span class="fl">5</span>, <span class="fl">15</span>, <span class="fl">11</span>},</a>
<a class="sourceLine" id="cb15-146" title="146">        {<span class="fl">11</span>, <span class="fl">15</span>, <span class="fl">4</span>}</a>
<a class="sourceLine" id="cb15-147" title="147">    };</a>
<a class="sourceLine" id="cb15-148" title="148"><span class="kw">#declare edges </span>= <span class="kw">array</span>[<span class="fl">30</span>][<span class="fl">2</span>]</a>
<a class="sourceLine" id="cb15-149" title="149">    {</a>
<a class="sourceLine" id="cb15-150" title="150">     {<span class="fl">13</span>, <span class="fl">2</span>},</a>
<a class="sourceLine" id="cb15-151" title="151">     {<span class="fl">3</span>, <span class="fl">14</span>},</a>
<a class="sourceLine" id="cb15-152" title="152">     {<span class="fl">14</span>, <span class="fl">13</span>},</a>
<a class="sourceLine" id="cb15-153" title="153">     {<span class="fl">3</span>, <span class="fl">8</span>},</a>
<a class="sourceLine" id="cb15-154" title="154">     {<span class="fl">2</span>, <span class="fl">8</span>},</a>
<a class="sourceLine" id="cb15-155" title="155">     {<span class="fl">17</span>, <span class="fl">9</span>},</a>
<a class="sourceLine" id="cb15-156" title="156">     {<span class="fl">1</span>, <span class="fl">9</span>},</a>
<a class="sourceLine" id="cb15-157" title="157">     {<span class="fl">6</span>, <span class="fl">1</span>},</a>
<a class="sourceLine" id="cb15-158" title="158">     {<span class="fl">17</span>, <span class="fl">7</span>},</a>
<a class="sourceLine" id="cb15-159" title="159">     {<span class="fl">7</span>, <span class="fl">6</span>},</a>
<a class="sourceLine" id="cb15-160" title="160">     {<span class="fl">7</span>, <span class="fl">19</span>},</a>
<a class="sourceLine" id="cb15-161" title="161">     {<span class="fl">4</span>, <span class="fl">6</span>},</a>
<a class="sourceLine" id="cb15-162" title="162">     {<span class="fl">10</span>, <span class="fl">4</span>},</a>
<a class="sourceLine" id="cb15-163" title="163">     {<span class="fl">10</span>, <span class="fl">19</span>},</a>
<a class="sourceLine" id="cb15-164" title="164">     {<span class="fl">14</span>, <span class="fl">19</span>},</a>
<a class="sourceLine" id="cb15-165" title="165">     {<span class="fl">17</span>, <span class="fl">13</span>},</a>
<a class="sourceLine" id="cb15-166" title="166">     {<span class="fl">12</span>, <span class="fl">1</span>},</a>
<a class="sourceLine" id="cb15-167" title="167">     {<span class="fl">12</span>, <span class="fl">15</span>},</a>
<a class="sourceLine" id="cb15-168" title="168">     {<span class="fl">4</span>, <span class="fl">15</span>},</a>
<a class="sourceLine" id="cb15-169" title="169">     {<span class="fl">0</span>, <span class="fl">12</span>},</a>
<a class="sourceLine" id="cb15-170" title="170">     {<span class="fl">16</span>, <span class="fl">0</span>},</a>
<a class="sourceLine" id="cb15-171" title="171">     {<span class="fl">5</span>, <span class="fl">16</span>},</a>
<a class="sourceLine" id="cb15-172" title="172">     {<span class="fl">5</span>, <span class="fl">15</span>},</a>
<a class="sourceLine" id="cb15-173" title="173">     {<span class="fl">0</span>, <span class="fl">18</span>},</a>
<a class="sourceLine" id="cb15-174" title="174">     {<span class="fl">9</span>, <span class="fl">18</span>},</a>
<a class="sourceLine" id="cb15-175" title="175">     {<span class="fl">2</span>, <span class="fl">18</span>},</a>
<a class="sourceLine" id="cb15-176" title="176">     {<span class="fl">16</span>, <span class="fl">8</span>},</a>
<a class="sourceLine" id="cb15-177" title="177">     {<span class="fl">11</span>, <span class="fl">5</span>},</a>
<a class="sourceLine" id="cb15-178" title="178">     {<span class="fl">11</span>, <span class="fl">3</span>},</a>
<a class="sourceLine" id="cb15-179" title="179">     {<span class="fl">10</span>, <span class="fl">11</span>}</a>
<a class="sourceLine" id="cb15-180" title="180">    };</a>
<a class="sourceLine" id="cb15-181" title="181">        </a>
<a class="sourceLine" id="cb15-182" title="182"><span class="kw">#declare s </span>= <span class="fl">0.3</span>;</a>
<a class="sourceLine" id="cb15-183" title="183"><span class="kw">#declare depth </span>= <span class="fl">6</span>;</a>
<a class="sourceLine" id="cb15-184" title="184"></a>
<a class="sourceLine" id="cb15-185" title="185"><span class="kw">#declare htriangles </span>= <span class="kw">array</span>[<span class="kw">dimension_size</span>(faces,<span class="fl">1</span>)];</a>
<a class="sourceLine" id="cb15-186" title="186">#for(i, <span class="fl">0</span>, <span class="kw">dimension_size</span>(faces,<span class="fl">1</span>)-<span class="fl">1</span>)</a>
<a class="sourceLine" id="cb15-187" title="187">    <span class="kw">#declare htriangles</span>[i] = </a>
<a class="sourceLine" id="cb15-188" title="188">        subdiv(vs[faces[i][<span class="fl">0</span>]],vs[faces[i][<span class="fl">1</span>]],vs[faces[i][<span class="fl">2</span>]], s, depth);</a>
<a class="sourceLine" id="cb15-189" title="189"><span class="ot">#end</span></a>
<a class="sourceLine" id="cb15-190" title="190"></a>
<a class="sourceLine" id="cb15-191" title="191"><span class="kw">#declare segments </span>= <span class="kw">array</span>[<span class="kw">dimension_size</span>(edges,<span class="fl">1</span>)];</a>
<a class="sourceLine" id="cb15-192" title="192">#for(i, <span class="fl">0</span>, <span class="kw">dimension_size</span>(edges,<span class="fl">1</span>)-<span class="fl">1</span>)</a>
<a class="sourceLine" id="cb15-193" title="193">    <span class="kw">#declare segments</span>[i] = </a>
<a class="sourceLine" id="cb15-194" title="194">        gyrosegment(vs[edges[i][<span class="fl">0</span>]],vs[edges[i][<span class="fl">1</span>]],s,<span class="fl">100</span>);</a>
<a class="sourceLine" id="cb15-195" title="195"><span class="ot">#end</span></a>
<a class="sourceLine" id="cb15-196" title="196"></a>
<a class="sourceLine" id="cb15-197" title="197"><span class="kw">object</span>{</a>
<a class="sourceLine" id="cb15-198" title="198">    <span class="kw">union</span>{</a>
<a class="sourceLine" id="cb15-199" title="199">        <span class="kw">mesh</span>{</a>
<a class="sourceLine" id="cb15-200" title="200">            #for(j, <span class="fl">0</span>, <span class="kw">dimension_size</span>(faces,<span class="fl">1</span>)-<span class="fl">1</span>)</a>
<a class="sourceLine" id="cb15-201" title="201">                <span class="kw">#local htriangle </span>= htriangles[j];</a>
<a class="sourceLine" id="cb15-202" title="202">                #for(i, <span class="fl">0</span>, <span class="kw">dimension_size</span>(htriangle,<span class="fl">1</span>)-<span class="fl">1</span>)</a>
<a class="sourceLine" id="cb15-203" title="203">                    <span class="kw">triangle</span> {</a>
<a class="sourceLine" id="cb15-204" title="204">                        htriangle[i][<span class="fl">0</span>], htriangle[i][<span class="fl">1</span>], htriangle[i][<span class="fl">2</span>]</a>
<a class="sourceLine" id="cb15-205" title="205">                    }</a>
<a class="sourceLine" id="cb15-206" title="206">                <span class="ot">#end</span></a>
<a class="sourceLine" id="cb15-207" title="207">            <span class="ot">#end</span></a>
<a class="sourceLine" id="cb15-208" title="208">            <span class="kw">texture</span> {</a>
<a class="sourceLine" id="cb15-209" title="209">                Chrome_Metal</a>
<a class="sourceLine" id="cb15-210" title="210">                <span class="kw">finish</span> {</a>
<a class="sourceLine" id="cb15-211" title="211">                    <span class="kw">ambient</span> <span class="fl">0.01</span></a>
<a class="sourceLine" id="cb15-212" title="212">                    <span class="kw">diffuse</span> <span class="fl">2</span></a>
<a class="sourceLine" id="cb15-213" title="213">                    <span class="kw">reflection</span> <span class="fl">0</span></a>
<a class="sourceLine" id="cb15-214" title="214">                    <span class="kw">brilliance</span> <span class="fl">8</span></a>
<a class="sourceLine" id="cb15-215" title="215">                    <span class="kw">specular</span> <span class="fl">0.8</span></a>
<a class="sourceLine" id="cb15-216" title="216">                    <span class="kw">roughness</span> <span class="fl">0.1</span></a>
<a class="sourceLine" id="cb15-217" title="217">                }</a>
<a class="sourceLine" id="cb15-218" title="218">            }</a>
<a class="sourceLine" id="cb15-219" title="219">        }</a>
<a class="sourceLine" id="cb15-220" title="220">        #for(j, <span class="fl">0</span>, <span class="kw">dimension_size</span>(edges,<span class="fl">1</span>)-<span class="fl">1</span>)</a>
<a class="sourceLine" id="cb15-221" title="221">            <span class="kw">#local segment </span>= segments[j];</a>
<a class="sourceLine" id="cb15-222" title="222">            <span class="kw">sphere_sweep</span>{</a>
<a class="sourceLine" id="cb15-223" title="223">                <span class="kw">linear_spline</span> <span class="fl">101</span></a>
<a class="sourceLine" id="cb15-224" title="224">                #for(k,<span class="fl">0</span>,<span class="fl">100</span>)</a>
<a class="sourceLine" id="cb15-225" title="225">                    segment[k] <span class="fl">0.01</span></a>
<a class="sourceLine" id="cb15-226" title="226">                <span class="ot">#end</span></a>
<a class="sourceLine" id="cb15-227" title="227">                <span class="kw">texture</span>{ </a>
<a class="sourceLine" id="cb15-228" title="228">                    Gold_Metal</a>
<a class="sourceLine" id="cb15-229" title="229">                    <span class="kw">finish</span> {</a>
<a class="sourceLine" id="cb15-230" title="230">                        <span class="kw">ambient</span> <span class="fl">0.01</span></a>
<a class="sourceLine" id="cb15-231" title="231">                        <span class="kw">diffuse</span> <span class="fl">2</span></a>
<a class="sourceLine" id="cb15-232" title="232">                        <span class="kw">reflection</span> <span class="fl">0</span></a>
<a class="sourceLine" id="cb15-233" title="233">                        <span class="kw">brilliance</span> <span class="fl">8</span></a>
<a class="sourceLine" id="cb15-234" title="234">                        <span class="kw">specular</span> <span class="fl">0.8</span></a>
<a class="sourceLine" id="cb15-235" title="235">                        <span class="kw">roughness</span> <span class="fl">0.1</span></a>
<a class="sourceLine" id="cb15-236" title="236">                    }</a>
<a class="sourceLine" id="cb15-237" title="237">                }</a>
<a class="sourceLine" id="cb15-238" title="238">            }</a>
<a class="sourceLine" id="cb15-239" title="239">        <span class="ot">#end</span></a>
<a class="sourceLine" id="cb15-240" title="240">    }</a>
<a class="sourceLine" id="cb15-241" title="241">    <span class="kw">rotate</span> &lt;<span class="fl">0</span>,-<span class="fl">20</span>,<span class="fl">0</span>&gt;</a>
<a class="sourceLine" id="cb15-242" title="242">    <span class="kw">rotate</span> &lt;-<span class="fl">60</span>,<span class="fl">0</span>,<span class="fl">0</span>&gt;</a>
<a class="sourceLine" id="cb15-243" title="243">}</a></code></pre></div>
<p><img src="figures/hyperbolicPolyhedra-povray.png" /></p>
<h2 id="update-2019-04-09">Update 2019-04-09</h2>
<p>I’ve realized that the <code>addNormals</code> function of the <code>rgl</code> package is not appropriate when there are duplicated vertices in the mesh (it adds different normals to the duplicated vertices). And there are (a lot of) duplicated vertices in the mesh created by the <code>gyrosubdiv</code> function.</p>
<p>To remove the duplicated vertices, one can use the <code>vcgClean</code> function of the <code>Rvcg</code> package (which also adds the normals). Observe the difference:</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb16-1" title="1">idx &lt;-<span class="st"> </span>faces[<span class="dv">1</span>,]</a>
<a class="sourceLine" id="cb16-2" title="2">A &lt;-<span class="st"> </span>vertices[idx[<span class="dv">1</span>],]</a>
<a class="sourceLine" id="cb16-3" title="3">B &lt;-<span class="st"> </span>vertices[idx[<span class="dv">2</span>],]</a>
<a class="sourceLine" id="cb16-4" title="4">C &lt;-<span class="st"> </span>vertices[idx[<span class="dv">3</span>],]</a>
<a class="sourceLine" id="cb16-5" title="5">mesh &lt;-<span class="st"> </span><span class="kw">gyrosubdiv</span>(A, B, C, <span class="dt">s =</span> s, <span class="dt">depth =</span> <span class="dv">4</span>)</a>
<a class="sourceLine" id="cb16-6" title="6"><span class="kw">view3d</span>(<span class="dv">30</span>, <span class="dv">30</span>, <span class="dt">zoom =</span> <span class="fl">0.9</span>)</a>
<a class="sourceLine" id="cb16-7" title="7"><span class="kw">shade3d</span>(mesh, <span class="dt">color =</span> <span class="st">&quot;navy&quot;</span>)</a></code></pre></div>
<p><img src="./figures/hyperbolicPolyhedra-triangle-dupVertices-1.png" /></p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb17-1" title="1">mesh &lt;-<span class="st"> </span>Rvcg<span class="op">::</span><span class="kw">vcgClean</span>(mesh, <span class="dt">sel =</span> <span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">7</span>), <span class="dt">silent =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb17-2" title="2"><span class="kw">view3d</span>(<span class="dv">30</span>, <span class="dv">30</span>, <span class="dt">zoom =</span> <span class="fl">0.9</span>)</a>
<a class="sourceLine" id="cb17-3" title="3"><span class="kw">shade3d</span>(mesh, <span class="dt">color =</span> <span class="st">&quot;navy&quot;</span>)</a></code></pre></div>
<p><img src="./figures/hyperbolicPolyhedra-triangle-undupVertices-1.png" /></p>
<p>So a better <code>gyrosubdiv</code> function is:</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb18-1" title="1">gyrosubdiv &lt;-<span class="st"> </span><span class="cf">function</span>(A1, A2, A3, <span class="dt">s=</span><span class="dv">1</span>, <span class="dt">depth=</span><span class="dv">5</span>){</a>
<a class="sourceLine" id="cb18-2" title="2">  subd &lt;-<span class="st"> </span><span class="kw">gyrosubdiv0</span>(A1, A2, A3, s)</a>
<a class="sourceLine" id="cb18-3" title="3">  <span class="cf">for</span>(i <span class="cf">in</span> <span class="kw">seq_len</span>(depth<span class="dv">-1</span>)){</a>
<a class="sourceLine" id="cb18-4" title="4">    subd &lt;-<span class="st"> </span>purrr<span class="op">::</span><span class="kw">flatten</span>(<span class="kw">lapply</span>(subd, <span class="cf">function</span>(triplet){</a>
<a class="sourceLine" id="cb18-5" title="5">      <span class="kw">gyrosubdiv0</span>(triplet[[<span class="dv">1</span>]], triplet[[<span class="dv">2</span>]], triplet[[<span class="dv">3</span>]], s)</a>
<a class="sourceLine" id="cb18-6" title="6">    }))</a>
<a class="sourceLine" id="cb18-7" title="7">  }</a>
<a class="sourceLine" id="cb18-8" title="8">  vertices &lt;-<span class="st"> </span></a>
<a class="sourceLine" id="cb18-9" title="9"><span class="st">    </span><span class="kw">do.call</span>(cbind, </a>
<a class="sourceLine" id="cb18-10" title="10">            <span class="kw">lapply</span>(subd, <span class="cf">function</span>(triplet) <span class="kw">do.call</span>(cbind, triplet)))</a>
<a class="sourceLine" id="cb18-11" title="11">  indices &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="dv">1</span><span class="op">:</span><span class="kw">ncol</span>(vertices), <span class="dt">nrow =</span> <span class="dv">3</span>)</a>
<a class="sourceLine" id="cb18-12" title="12">  mesh &lt;-<span class="st"> </span><span class="kw">tmesh3d</span>(</a>
<a class="sourceLine" id="cb18-13" title="13">    <span class="dt">vertices =</span> vertices,</a>
<a class="sourceLine" id="cb18-14" title="14">    <span class="dt">indices =</span> indices,</a>
<a class="sourceLine" id="cb18-15" title="15">    <span class="dt">homogeneous =</span> <span class="ot">FALSE</span></a>
<a class="sourceLine" id="cb18-16" title="16">  )</a>
<a class="sourceLine" id="cb18-17" title="17">  Rvcg<span class="op">::</span><span class="kw">vcgClean</span>(mesh, <span class="dt">sel =</span> <span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">7</span>), <span class="dt">silent =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb18-18" title="18">}</a></code></pre></div>
<h2 id="reference">Reference</h2>
<ul>
<li>A. A. Ungar. <em>Analytic Hyperbolic Geometry: Mathematical Foundations And Applications</em>. World Scientific Pub Co Inc, 2005.</li>
</ul>

        </div>


        <div id="footer">
          Site proudly generated by
          <a href="http://jaspervdj.be/hakyll">Hakyll</a>
        </div>

      </div>

    </div>

    <div class="row">
      <div class="col-sm-12">
        <div id="disqus_thread"></div>
        <div class="pagination">
          <ul>
            <li>
              <a href="http://laustep.github.io/stlahblog/">« Back Home</a>
            </li>
          </ul>
        </div>
      </div>
    </div>
    
  </div>

</body>

<script src="../libraries/bootstrap/bootstrap.min.js"></script>
<script>
  var disqus_developer = 1;
  var disqus_shortname = 'stlapblog';
  // required: replace example with your forum shortname
  /* * * DON'T EDIT BELOW THIS LINE * * */
  (function () {
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = 'https://' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] ||
      document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>
<noscript>Please enable JavaScript to view the
  <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a>
</noscript>
<!-- MathJax: Fall back to local if CDN offline but local image fonts are not supported (saves >100MB) -->
<script type="text/x-mathjax-config" src="../libraries/mathjax/config/TeX-MML-AM_CHTML.js"></script>
<!-- <script>
  window.MathJax || document.write('<script type="text/x-mathjax-config">MathJax.Hub.Config({"HTML-CSS":{imageFont:null}});<\/script><script src="../libraries/mathjax/MathJax.js"><\/script>');
</script> -->

  <!-- Google Prettify -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prettify/188.0.0/prettify.js"></script>
  <!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/prettify/r298/prettify.js"></script> -->
  <script src="../libraries/highlighters/prettify/js/lang-r.js"></script>
  <script>
    var pres = document.getElementsByTagName("pre");
    for (var i = 0; i < pres.length; ++i) {
      
        pres[i].className = pres[i].className + " prettyprint linenums";
      
    }
    prettyPrint();
  </script> 


</html>