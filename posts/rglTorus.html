<!DOCTYPE HTML>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Saturn Elephant - Drawing a torus with rgl</title>
  <link rel="stylesheet" href="../css/post.css" />
  <link rel="stylesheet" href="../css/misc.css" /> 
  <link rel="stylesheet" href="../css/pandoc-solarized.css" />  
  <link href="../libraries/highlighters/prettify/css/minimal.css" rel="stylesheet"> 
  <link href="https://fonts.googleapis.com/css?family=Raleway:400,600,200,800" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/css?family=Droid+Sans" rel="stylesheet" type="text/css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script type="text/javascript" async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML">
</script>
</head>

<body>
  <!-- Sidebar. -->
  <div class="sidebar">
    <div style="float:right;clear:both;margin-right:50px;margin-top:150px;">
      <a href="https://www.r-bloggers.com/">
        <img src="https://www.r-bloggers.com/wp-content/uploads/2016/04/R_02_2016-05-01.png" alt="stla" width="100%" />
      </a>
      <br />
      <a href="http://t-redactyl.io/">
        <span style="color:black;font-weight:bold;font-family:sans-serif;font-size:30px;">Standard error</span>
      </a>
      <a href="http://timelyportfolio.blogspot.be/">
        <span style="color:grey;font-weight:bold;font-family:sans-serif;font-size:30px;">Timely portfolio</span>
      </a>
      <br />
      <a href="https://antoineguillot.wordpress.com/blog/">
        <span style="color:white;background-color:darkblue;font-weight:bold;font-family:sans-serif;font-size:28px;border:5px solid;border-color:darkblue">ENHANCE DATA</span>
      </a>
    </div>
  </div>

  <div class="main">
    <div id="header">
      <div id="logo" style="position:absolute;">
        <a href="../"><img src="../images/stla.jpg" alt="stla" width="100px" /></a>
      </div>
      <div id="navigation" style="margin-top:50px;">
        <a href="../">Home</a>
        <a href="../about.html">About</a>
        <a href="../contact.html">Contact</a>
        <a href="../archive.html">Archive</a>
      </div>
    </div>

    <div class="content">
      <h1>Drawing a torus with rgl</h1> <div class="info">
    Posted on May 29, 2018
    
        by Stéphane Laurent
    
</div>
<div class="info">
    
    Tags: <a href="../tags/R.html">R</a>, <a href="../tags/graphics.html">graphics</a>, <a href="../tags/rgl.html">rgl</a>, <a href="../tags/geometry.html">geometry</a>
    
</div>

<p>The following function creates a torus as a <code>mesh3d</code> object, which can be drawn with the <code>rgl</code> package.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># R: major radius</span>
<span class="co"># r: minor radius</span>
<span class="co"># S: number of segments for the major ring</span>
<span class="co"># s: number of segments for the minor ring</span>
<span class="co"># arc: the arc to draw</span>
<span class="kw">library</span>(rgl)
createTorusMesh &lt;-<span class="st"> </span><span class="cf">function</span>(<span class="dt">R=</span><span class="dv">1</span>, <span class="dt">r=</span><span class="fl">0.25</span>, <span class="dt">S=</span><span class="dv">64</span>, <span class="dt">s=</span><span class="dv">32</span>, <span class="dt">arc=</span><span class="dv">2</span><span class="op">*</span>pi){
  vertices &lt;-<span class="st"> </span>indices &lt;-<span class="st"> </span><span class="ot">NULL</span>
  <span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">0</span><span class="op">:</span>s) {
    <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">0</span><span class="op">:</span>S) {
      u &lt;-<span class="st"> </span>i <span class="op">/</span><span class="st"> </span>S <span class="op">*</span><span class="st"> </span>arc
      v &lt;-<span class="st"> </span>j <span class="op">/</span><span class="st"> </span>s <span class="op">*</span><span class="st"> </span><span class="dv">2</span><span class="op">*</span>pi
      vertex &lt;-<span class="st"> </span><span class="kw">c</span>(
        (R <span class="op">+</span><span class="st"> </span>r<span class="op">*</span><span class="kw">cos</span>(v)) <span class="op">*</span><span class="st"> </span><span class="kw">cos</span>(u),
        (R <span class="op">+</span><span class="st"> </span>r<span class="op">*</span><span class="kw">cos</span>(v)) <span class="op">*</span><span class="st"> </span><span class="kw">sin</span>(u),
        r <span class="op">*</span><span class="st"> </span><span class="kw">sin</span>(v)
      )
      vertices &lt;-<span class="st"> </span><span class="kw">cbind</span>(vertices, vertex)
    }
  }
  <span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>s) {
    <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>S) {
      a &lt;-<span class="st"> </span>(S <span class="op">+</span><span class="st"> </span><span class="dv">1</span>) <span class="op">*</span><span class="st"> </span>j <span class="op">+</span><span class="st"> </span>i 
      b &lt;-<span class="st"> </span>(S <span class="op">+</span><span class="st"> </span><span class="dv">1</span>) <span class="op">*</span><span class="st"> </span>(j <span class="op">-</span><span class="st"> </span><span class="dv">1</span>) <span class="op">+</span><span class="st"> </span>i 
      c &lt;-<span class="st"> </span>(S <span class="op">+</span><span class="st"> </span><span class="dv">1</span>) <span class="op">*</span><span class="st"> </span>(j <span class="op">-</span><span class="st"> </span><span class="dv">1</span>) <span class="op">+</span><span class="st"> </span>i <span class="op">+</span><span class="st"> </span><span class="dv">1</span>
      d &lt;-<span class="st"> </span>(S <span class="op">+</span><span class="st"> </span><span class="dv">1</span>) <span class="op">*</span><span class="st"> </span>j <span class="op">+</span><span class="st"> </span>i <span class="op">+</span><span class="st"> </span><span class="dv">1</span>
      indices &lt;-<span class="st"> </span><span class="kw">cbind</span>(indices, <span class="kw">c</span>(a,b,d), <span class="kw">c</span>(b,c,d))
    }
  }
  <span class="kw">tmesh3d</span>(<span class="kw">rbind</span>(vertices,<span class="dv">1</span>), indices)
}</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">torus &lt;-<span class="st"> </span><span class="kw">createTorusMesh</span>(<span class="dt">R=</span><span class="dv">2</span>, <span class="dt">r=</span><span class="dv">1</span>)
<span class="kw">shade3d</span>(torus, <span class="dt">color=</span><span class="st">&quot;blue&quot;</span>)</code></pre></div>
<div class="figure">
<img src="figures/torus00.png" />

</div>
<p>Denote by <span class="math inline">\(O\)</span> the center of the torus and by <span class="math inline">\(R\)</span> its major radius. The equator of this torus (circle of center <span class="math inline">\(O\)</span> and radius <span class="math inline">\(R\)</span>) lies in the <span class="math inline">\(xy\)</span>-plane (the plane <span class="math inline">\(z=0\)</span>).</p>
<p>Now we are going to give a method to <em>draw a torus such that its equator passes by three given points</em>. This will be done with the help of the <code>transform3d</code> function of the <code>rgl</code> package. Thus, the key element to construct is the <em>transformation matrix</em>.</p>
<p>Firstly, we write a function which returns the center and the radius of a circle passing by three given points in the 3D space. This is the function <code>circleCenterAndRadius</code> below. The <code>plane3pts</code> function is an helper function which returns the equation of the plane passing by three points.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># plane passing by points p1, p2, p3 #</span>
plane3pts &lt;-<span class="st"> </span><span class="cf">function</span>(p1,p2,p3){ 
    xcoef =<span class="st"> </span>(p1[<span class="dv">2</span>]<span class="op">-</span>p2[<span class="dv">2</span>])<span class="op">*</span>(p2[<span class="dv">3</span>]<span class="op">-</span>p3[<span class="dv">3</span>])<span class="op">-</span>(p1[<span class="dv">3</span>]<span class="op">-</span>p2[<span class="dv">3</span>])<span class="op">*</span>(p2[<span class="dv">2</span>]<span class="op">-</span>p3[<span class="dv">2</span>]);
    ycoef =<span class="st"> </span>(p1[<span class="dv">3</span>]<span class="op">-</span>p2[<span class="dv">3</span>])<span class="op">*</span>(p2[<span class="dv">1</span>]<span class="op">-</span>p3[<span class="dv">1</span>])<span class="op">-</span>(p1[<span class="dv">1</span>]<span class="op">-</span>p2[<span class="dv">1</span>])<span class="op">*</span>(p2[<span class="dv">3</span>]<span class="op">-</span>p3[<span class="dv">3</span>]);
    zcoef =<span class="st"> </span>(p1[<span class="dv">1</span>]<span class="op">-</span>p2[<span class="dv">1</span>])<span class="op">*</span>(p2[<span class="dv">2</span>]<span class="op">-</span>p3[<span class="dv">2</span>])<span class="op">-</span>(p1[<span class="dv">2</span>]<span class="op">-</span>p2[<span class="dv">2</span>])<span class="op">*</span>(p2[<span class="dv">1</span>]<span class="op">-</span>p3[<span class="dv">1</span>]);
    offset =<span class="st"> </span>p1[<span class="dv">1</span>]<span class="op">*</span>xcoef <span class="op">+</span><span class="st"> </span>p1[<span class="dv">2</span>]<span class="op">*</span>ycoef <span class="op">+</span><span class="st"> </span>p1[<span class="dv">3</span>]<span class="op">*</span>zcoef; 
    <span class="kw">c</span>(xcoef, ycoef, zcoef, offset)
}

<span class="co"># center, radius and normal of the circle passing by three points #</span>
circleCenterAndRadius &lt;-<span class="st"> </span><span class="cf">function</span>(p1,p2,p3){
    p12 &lt;-<span class="st"> </span>(p1<span class="op">+</span>p2)<span class="op">/</span><span class="dv">2</span>
    p23 &lt;-<span class="st"> </span>(p2<span class="op">+</span>p3)<span class="op">/</span><span class="dv">2</span>
    v12 &lt;-<span class="st"> </span>p2<span class="op">-</span>p1
    v23 &lt;-<span class="st"> </span>p3<span class="op">-</span>p2
    plane &lt;-<span class="st"> </span><span class="kw">plane3pts</span>(p1,p2,p3)
    A &lt;-<span class="st"> </span><span class="kw">rbind</span>(plane[<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>],v12,v23)
    b &lt;-<span class="st"> </span><span class="kw">c</span>(plane[<span class="dv">4</span>], <span class="kw">sum</span>(p12<span class="op">*</span>v12), <span class="kw">sum</span>(p23<span class="op">*</span>v23))
    center &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="kw">solve</span>(A) <span class="op">%*%</span><span class="st"> </span>b)
    r &lt;-<span class="st"> </span><span class="kw">sqrt</span>(<span class="kw">c</span>(<span class="kw">crossprod</span>(p1<span class="op">-</span>center)))
    <span class="kw">list</span>(<span class="dt">center=</span>center, <span class="dt">radius=</span>r, <span class="dt">normal=</span>plane[<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>])
}</code></pre></div>
<p>Note that <code>circleCenterAndRadius</code> actually returns not only the center and the radius, but also a vector perpendicular to the plane of the circle.</p>
<p>Now, we are ready to write the function which returns the desired transformation matrix.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">transfoMatrix &lt;-<span class="st"> </span><span class="cf">function</span>(p1,p2,p3){
  crn &lt;-<span class="st"> </span><span class="kw">circleCenterAndRadius</span>(p1,p2,p3)
  center &lt;-<span class="st"> </span>crn<span class="op">$</span>center
  radius &lt;-<span class="st"> </span>crn<span class="op">$</span>radius
  normal &lt;-<span class="st"> </span>crn<span class="op">$</span>normal
  measure &lt;-<span class="st"> </span><span class="kw">sqrt</span>(normal[<span class="dv">1</span>]<span class="op">^</span><span class="dv">2</span><span class="op">+</span>normal[<span class="dv">2</span>]<span class="op">^</span><span class="dv">2</span><span class="op">+</span>normal[<span class="dv">3</span>]<span class="op">^</span><span class="dv">2</span>)
  normal &lt;-<span class="st"> </span>normal<span class="op">/</span>measure
  s &lt;-<span class="st"> </span><span class="kw">sqrt</span>(normal[<span class="dv">1</span>]<span class="op">^</span><span class="dv">2</span><span class="op">+</span>normal[<span class="dv">2</span>]<span class="op">^</span><span class="dv">2</span>) <span class="co"># </span><span class="al">TODO</span><span class="co">: case s=0</span>
  u &lt;-<span class="st"> </span><span class="kw">c</span>(normal[<span class="dv">2</span>]<span class="op">/</span>s, <span class="op">-</span>normal[<span class="dv">1</span>]<span class="op">/</span>s, <span class="dv">0</span>)
  v &lt;-<span class="st"> </span>geometry<span class="op">::</span><span class="kw">extprod3d</span>(normal, u)
  m &lt;-<span class="st"> </span><span class="kw">rbind</span>(<span class="kw">cbind</span>(u, v, normal, center), <span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">1</span>)) 
  <span class="kw">list</span>(<span class="dt">matrix=</span><span class="kw">t</span>(m), <span class="dt">radius=</span>radius)
}</code></pre></div>
<p>Our function <code>transfoMatrix</code> also returns a radius, the major radius of the desired torus.</p>
<p>Let us test it now.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(rgl)
<span class="co"># our three points</span>
p1 =<span class="st"> </span><span class="kw">c</span>(<span class="dv">1</span>,<span class="op">-</span><span class="dv">1</span>,<span class="dv">1</span>)
p2 =<span class="st"> </span><span class="kw">c</span>(<span class="dv">2</span>,<span class="dv">1</span>,<span class="dv">2</span>)
p3 =<span class="st"> </span><span class="kw">c</span>(<span class="dv">2</span>,<span class="op">-</span><span class="dv">2</span>,<span class="op">-</span><span class="dv">3</span>)
<span class="co"># get the transformation matrix and the radius</span>
mr &lt;-<span class="st"> </span><span class="kw">transfoMatrix</span>(p1,p2,p3)
tmesh0 &lt;-<span class="st"> </span><span class="kw">createTorusMesh</span>(<span class="dt">R=</span>mr<span class="op">$</span>radius, <span class="dt">r=</span><span class="fl">0.1</span>)
tmesh &lt;-<span class="st"> </span><span class="kw">transform3d</span>(tmesh0, mr<span class="op">$</span>matrix)
<span class="co"># draw the torus</span>
<span class="kw">shade3d</span>(tmesh, <span class="dt">color=</span><span class="st">&quot;blue&quot;</span>)
<span class="co"># and draw a triangle to check</span>
<span class="kw">triangles3d</span>(<span class="kw">rbind</span>(p1,p2,p3), <span class="dt">color=</span><span class="st">&quot;red&quot;</span>)</code></pre></div>
<div class="figure">
<img src="figures/torus01.png" />

</div>
<p>It works. So let’s play with it now.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">tetrahedron &lt;-<span class="st"> </span><span class="kw">tetrahedron3d</span>()[<span class="kw">c</span>(<span class="st">&quot;vb&quot;</span>,<span class="st">&quot;it&quot;</span>)]
vertices &lt;-<span class="st"> </span>tetrahedron<span class="op">$</span>vb[<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>,]
triangles &lt;-<span class="st"> </span>tetrahedron<span class="op">$</span>it
<span class="co">#</span>
p1 &lt;-<span class="st"> </span>vertices[,triangles[<span class="dv">1</span>,<span class="dv">1</span>]]
p2 &lt;-<span class="st"> </span>vertices[,triangles[<span class="dv">2</span>,<span class="dv">1</span>]]
p3 &lt;-<span class="st"> </span>vertices[,triangles[<span class="dv">3</span>,<span class="dv">1</span>]]
mr &lt;-<span class="st"> </span><span class="kw">transfoMatrix</span>(p1,p2,p3)
tmesh &lt;-<span class="st"> </span><span class="kw">transform3d</span>(<span class="kw">createTorusMesh</span>(<span class="dt">R=</span>mr<span class="op">$</span>radius, <span class="dt">r=</span><span class="fl">0.1</span>), mr<span class="op">$</span>matrix)
<span class="kw">shade3d</span>(tmesh, <span class="dt">color=</span><span class="st">&quot;blue&quot;</span>)
<span class="co">#</span>
p1 &lt;-<span class="st"> </span>vertices[,triangles[<span class="dv">1</span>,<span class="dv">2</span>]]
p2 &lt;-<span class="st"> </span>vertices[,triangles[<span class="dv">2</span>,<span class="dv">2</span>]]
p3 &lt;-<span class="st"> </span>vertices[,triangles[<span class="dv">3</span>,<span class="dv">2</span>]]
mr &lt;-<span class="st"> </span><span class="kw">transfoMatrix</span>(p1,p2,p3)
tmesh &lt;-<span class="st"> </span><span class="kw">transform3d</span>(<span class="kw">createTorusMesh</span>(<span class="dt">R=</span>mr<span class="op">$</span>radius, <span class="dt">r=</span><span class="fl">0.1</span>), mr<span class="op">$</span>matrix)
<span class="kw">shade3d</span>(tmesh, <span class="dt">color=</span><span class="st">&quot;blue&quot;</span>)
<span class="co">#</span>
p1 &lt;-<span class="st"> </span>vertices[,triangles[<span class="dv">1</span>,<span class="dv">3</span>]]
p2 &lt;-<span class="st"> </span>vertices[,triangles[<span class="dv">2</span>,<span class="dv">3</span>]]
p3 &lt;-<span class="st"> </span>vertices[,triangles[<span class="dv">3</span>,<span class="dv">3</span>]]
mr &lt;-<span class="st"> </span><span class="kw">transfoMatrix</span>(p1,p2,p3)
tmesh &lt;-<span class="st"> </span><span class="kw">transform3d</span>(<span class="kw">createTorusMesh</span>(<span class="dt">R=</span>mr<span class="op">$</span>radius, <span class="dt">r=</span><span class="fl">0.1</span>), mr<span class="op">$</span>matrix)
<span class="kw">shade3d</span>(tmesh, <span class="dt">color=</span><span class="st">&quot;blue&quot;</span>)
<span class="co">#</span>
p1 &lt;-<span class="st"> </span>vertices[,triangles[<span class="dv">1</span>,<span class="dv">4</span>]]
p2 &lt;-<span class="st"> </span>vertices[,triangles[<span class="dv">2</span>,<span class="dv">4</span>]]
p3 &lt;-<span class="st"> </span>vertices[,triangles[<span class="dv">3</span>,<span class="dv">4</span>]]
mr &lt;-<span class="st"> </span><span class="kw">transfoMatrix</span>(p1,p2,p3)
tmesh &lt;-<span class="st"> </span><span class="kw">transform3d</span>(<span class="kw">createTorusMesh</span>(<span class="dt">R=</span>mr<span class="op">$</span>radius, <span class="dt">r=</span><span class="fl">0.1</span>), mr<span class="op">$</span>matrix)
<span class="kw">shade3d</span>(tmesh, <span class="dt">color=</span><span class="st">&quot;blue&quot;</span>)</code></pre></div>
<div class="figure">
<img src="figures/tetratori.png" />

</div>

    </div>


    <div id="footer">
      Site proudly generated by
      <a href="http://jaspervdj.be/hakyll">Hakyll</a>
    </div>

  </div>

  <div id="disqus_thread"></div>
  <div class="pagination">
    <ul>
      <li><a href="http://laustep.github.io/stlahblog/">« Back Home</a></li>
    </ul>
  </div>
</body>
<script src="../libraries/bootstrap/bootstrap.min.js"></script>
<script>
  var disqus_developer = 1;
  var disqus_shortname = 'stlapblog';
  // required: replace example with your forum shortname
  /* * * DON'T EDIT BELOW THIS LINE * * */
  (function() {
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = 'https://' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] ||
      document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<!-- MathJax: Fall back to local if CDN offline but local image fonts are not supported (saves >100MB) -->
<script type="text/x-mathjax-config" src="../libraries/mathjax/config/TeX-MML-AM_CHTML.js"></script>
<!-- <script>
  window.MathJax || document.write('<script type="text/x-mathjax-config">MathJax.Hub.Config({"HTML-CSS":{imageFont:null}});<\/script><script src="../libraries/mathjax/MathJax.js"><\/script>');
</script> -->

<!-- Google Prettify -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/prettify/188.0.0/prettify.js"></script>
<!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/prettify/r298/prettify.js"></script> -->
<script src="../libraries/highlighters/prettify/js/lang-r.js"></script>
<script>
  var pres = document.getElementsByTagName("pre");
  for (var i = 0; i < pres.length; ++i) {
    
    pres[i].className = pres[i].className + " prettyprint linenums";
    
  }
  prettyPrint();
</script>


</html>
