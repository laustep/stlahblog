<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="x-ua-compatible" content="ie=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Saturn Elephant - HTML widgets in Power BI</title>
    <link
      href="../libraries/bootstrap/bootstrap-grid.min.css"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="../css/default2.css" />
    <link rel="stylesheet" href="../css/post.css" />
    <link rel="stylesheet" href="../css/misc.css" />

    <link rel="stylesheet" href="../css/pandoc-solarized.css" />

    <link
      href="https://fonts.googleapis.com/css?family=Raleway:400,600,200,800"
      rel="stylesheet"
      type="text/css"
    />
    <link
      href="https://fonts.googleapis.com/css?family=Open+Sans"
      rel="stylesheet"
      type="text/css"
    />
    <link
      href="https://fonts.googleapis.com/css?family=Droid+Sans"
      rel="stylesheet"
      type="text/css"
    />
    <script src="../libraries/jquery.min.js"></script>
    <script
      type="text/javascript"
      async
      src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML"
    ></script>
  </head>

  <body>
    <div class="container-fluid">
      <div class="row">
        <!-- Sidebar. -->
        <div class="sidebar col-sm-2">
          <div class="row">
            <div
              class="col-sm-12"
              style="
                float: right;
                clear: both;
                margin-right: 50px;
                margin-top: 50px;
              "
            >
              <a href="https://www.r-bloggers.com/">
                <img
                  src="../images/Rbloggers.png"
                  alt="Rbloggers"
                  width="100%"
                />
              </a>
              <br />
              <a href="http://t-redactyl.io/">
                <span
                  style="
                    color: black;
                    font-weight: bold;
                    font-family: sans-serif;
                    font-size: 25px;
                  "
                  >Standard error</span
                >
              </a>
              <a href="http://timelyportfolio.blogspot.be/">
                <span
                  style="
                    color: grey;
                    font-weight: bold;
                    font-family: sans-serif;
                    font-size: 24px;
                  "
                  >Timely portfolio</span
                >
              </a>
              <br />
              <a href="https://antoineguillot.wordpress.com/blog/">
                <span
                  style="
                    color: white;
                    background-color: darkblue;
                    font-weight: bold;
                    font-family: sans-serif;
                    font-size: 21px;
                    border: 5px solid;
                    border-color: darkblue;
                  "
                  >ENHANCE DATA</span
                >
              </a>
              <br />
              <a href="https://fronkonstin.com/">
                <span
                  style="
                    color: black;
                    background-color: gold;
                    font-weight: bold;
                    font-size: 29px;
                    border: 3px solid;
                    border-color: gold;
                  "
                  >Fronkonstin</span
                >
              </a>
            </div>
          </div>
          <div id="logos">
            <div class="row">
              <div class="col-sm-4">
                <img
                  src="../images/AsymptoteLogo.svg"
                  style="width: 150%; transform: rotateZ(-35deg)"
                />
              </div>
              <div class="col-sm-4">
                <img src="../images/Rlogo.svg" style="width: 110%" />
              </div>
              <div class="col-sm-4">
                <img src="../images/shiny-hex.png" style="width: 90%" />
              </div>
            </div>
            <div class="row">
              <div class="col-sm-4">
                <img
                  src="../images/Povray_logo_sphere.png"
                  style="width: 105%"
                />
              </div>
              <div class="col-sm-4">
                <img src="../images/javascript.svg" style="width: 90%" />
              </div>
              <div class="col-sm-4">
                <img src="../images/haskell.svg" style="width: 110%" />
              </div>
            </div>
          </div>
        </div>

        <div class="main col-sm-10">
          <div id="header">
            <div id="logo">
              <a href="../">
                <img src="../images/stla.jpg" alt="stla" width="100px" />
              </a>
            </div>
            <div id="navigation" style="margin-top: 50px">
              <a href="../">Home</a>
              <a href="../about.html">About</a>
              <a href="../contact.html">Contact</a>
              <a href="../archive.html">Archive</a>
            </div>
          </div>

          <div class="content">
            <h1>HTML widgets in Power BI</h1>
            <div class="info">
              Posted on November 24, 2022 by Stéphane Laurent
            </div>
            <div class="info">
              Tags:
              <a title="All pages tagged 'R'." href="../tags/R.html">R</a>,
              <a title="All pages tagged 'misc'." href="../tags/misc.html"
                >misc</a
              >
            </div>

            <ul>
              <li>
                <p>
                  <a href="#setting-up-an-environment"
                    >Setting up an environment</a
                  >
                </p>
              </li>
              <li>
                <p><a href="#example">Example</a></p>
              </li>
              <li>
                <p><a href="#notes">Notes</a></p>
              </li>
              <li>
                <p><a href="#advanced-example">Advanced example</a></p>
              </li>
              <li>
                <p><a href="#arbitrary-html">Arbitrary HTML</a></p>
              </li>
              <li>
                <p>
                  <a href="#using-multiple-datasets">Using multiple datasets</a>
                </p>
              </li>
              <li>
                <p>
                  <a href="#limiting-the-number-of-selected-columns"
                    >Limiting the number of selected columns</a
                  >
                </p>
              </li>
              <li>
                <p><a href="#combining-widgets">Combining widgets</a></p>
              </li>
              <li>
                <p>
                  <a href="#prevent-removal-of-duplicated-rows"
                    >Prevent removal of duplicated rows</a
                  >
                </p>
              </li>
              <li>
                <p>
                  <a href="#adding-formatting-objects"
                    >Adding formatting objects</a
                  >
                </p>
              </li>
              <li>
                <p>
                  <a href="#restricting-a-number-input-to-a-range"
                    >Restricting a number input to a range</a
                  >
                </p>
              </li>
            </ul>
            <hr />
            <p>
              It is possible to include a <code>htmlwidget</code> in a
              <strong>Power BI</strong> report, such as a
              <code>plotly</code> graphic.
            </p>
            <h1 id="setting-up-an-environment">Setting up an environment</h1>
            <p>
              You first have to follow the first three steps of
              <a
                href="https://docs.microsoft.com/en-us/power-bi/developer/visuals/environment-setup?tabs=windows"
                >this tutorial</a
              >:
            </p>
            <ol type="1">
              <li>
                <p>install <strong>Node.js</strong>;</p>
              </li>
              <li>
                <p>install <strong>pbiviz</strong>;</p>
              </li>
              <li><p>create and install a certificate;</p></li>
              <li>
                <p>install the npm package <code>powerbi-visuals-api</code>.</p>
              </li>
            </ol>
            <p>
              <strong>Node.js</strong> is available in the GSK software center.
              You can alternatively download a portable version on the
              <a href="https://nodejs.org/en/download/">nodejs.org</a> website:
              choose the 64-bit zip, unzip it in a folder and set this folder in
              your Windows path.
            </p>
            <p>
              Follow the tutorial for steps 2 and 3. Note that you have to
              perform step 3 only once, there’s no need to generate a new
              certificate for each visual you will create.
            </p>
            <p>
              For step 4, run <code>npm install -g powerbi-visuals-api</code> in
              a terminal.
            </p>
            <h1 id="example">Example</h1>
            <p>
              Let’s assume you want to render the interactive graphic produced
              by this code:
            </p>
            <div class="sourceCode" id="cb1">
              <pre
                class="sourceCode r"
              ><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true"></a><span class="kw">library</span>(plotly)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true"></a>gg &lt;-<span class="st"> </span><span class="kw">ggplot</span>(iris, <span class="kw">aes</span>(<span class="dt">x =</span> Petal.Length, <span class="dt">y =</span> Sepal.Length, <span class="dt">color =</span> Species)) <span class="op">+</span><span class="st"> </span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true"></a><span class="st">  </span><span class="kw">geom_point</span>()</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true"></a><span class="kw">ggplotly</span>(gg)  </span></code></pre>
            </div>
            <ul>
              <li>
                <p>
                  create a working directory: <code>mkdir pbiwidgets</code> and
                  go into it: <code>cd pbiwidgets</code>;
                </p>
              </li>
              <li>
                <p>
                  initialize a new visual by running:
                  <code>pbiviz new iris -t rhtml</code>;
                </p>
              </li>
              <li>
                <p>
                  this creates the folder
                  <strong><em>pbiwidgets/iris</em></strong> with a lot of stuff;
                </p>
              </li>
              <li>
                <p>
                  in this folder, edit the file
                  <strong><em>pbiviz.json</em></strong
                  >; you have to write something for
                  <code>description</code> (what you want),
                  <code>supportUrl</code>(write anything you want, e.g.
                  <code>https://www.example.com</code>), and you have to write
                  something for the fields <code>name</code> and
                  <code>email</code>;
                </p>
              </li>
              <li>
                <p>
                  now you have to edit the file
                  <strong><em>script.r</em></strong
                  >:
                </p>
              </li>
            </ul>
            <div class="sourceCode" id="cb2">
              <pre
                class="sourceCode r"
              ><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true"></a><span class="kw">source</span>(<span class="st">'./r_files/flatten_HTML.r'</span>)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true"></a></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true"></a><span class="co">############### Library Declarations ###############</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true"></a><span class="kw">libraryRequireInstall</span>(<span class="st">&quot;plotly&quot;</span>)</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true"></a><span class="co">####################################################</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true"></a></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true"></a><span class="co">################### Actual code ####################</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true"></a>gg &lt;-<span class="st"> </span><span class="kw">ggplot</span>(iris, <span class="kw">aes</span>(<span class="dt">x=</span>Petal.Length, <span class="dt">y=</span>Sepal.Length, <span class="dt">color =</span> Species)) <span class="op">+</span><span class="st"> </span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true"></a><span class="st">  </span><span class="kw">geom_point</span>()</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true"></a>p &lt;-<span class="st"> </span><span class="kw">ggplotly</span>(gg)</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true"></a><span class="co">####################################################</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true"></a></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true"></a><span class="co">################## Save widget #####################</span></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true"></a><span class="kw">internalSaveWidget</span>(p, <span class="st">&quot;out.html&quot;</span>)</span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true"></a><span class="co">####################################################</span></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true"></a></span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true"></a><span class="co">################ Reduce paddings ###################</span></span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true"></a><span class="kw">ReadFullFileReplaceString</span>(</span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true"></a>  <span class="st">&quot;out.html&quot;</span>, <span class="st">&quot;out.html&quot;</span>, <span class="st">',&quot;padding&quot;:[0-9]*,'</span>, <span class="st">',&quot;padding&quot;:0,'</span></span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true"></a>)</span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true"></a><span class="co">####################################################</span></span></code></pre>
            </div>
            <ul>
              <li>
                <p>
                  the dataframe <code>Values</code> is the dataset which will be
                  sent to this R script by <strong>Power BI</strong>;
                </p>
              </li>
              <li>
                <p>
                  since we want to use <code>iris</code> as data, we save it to
                  an Excel file that we will import in
                  <strong>Power BI</strong>; I recommend to use
                  <strong>writexl</strong> (the Excel files written with
                  <strong>openxlsx</strong> cause an issue when one tries to
                  load them in <strong>Power BI</strong>):
                </p>
              </li>
            </ul>
            <!-- -->
            <pre><code>writexl::write_xlsx(iris, &quot;iris.xlsx&quot;) 
# or writexl::write_xlsx(list(&quot;sheetName&quot; = iris), &quot;iris.xlsx&quot;) </code></pre>
            <ul>
              <li>
                <p>
                  go to the folder <strong><em>pbiwidgets/iris</em></strong> in
                  your terminal and run the command <code>pbiviz package</code>;
                </p>
              </li>
              <li>
                <p>
                  now open Power BI, import <strong><em>iris.xlsx</em></strong
                  >, select and load the sheet;
                </p>
              </li>
              <li>
                <p>
                  in the <em>‘Visualizations’</em> panel, click the three dots,
                  then <em>‘import a visual from a file’</em>, and select the
                  <strong><em>pbiviz</em></strong> file which is located in
                  <strong><em>pbiwidgets/iris/dist</em></strong>
                </p>
              </li>
              <li>
                <p>
                  a new
                  <a href="./figures/pbiviz_icon.png"
                    >icon showing some tools</a
                  >
                  appears at the bottom in the <em>‘Visualizations’</em> panel,
                  click it;
                </p>
              </li>
              <li>
                <p>
                  in the <em>‘Fields’</em> panel, select the columns used for
                  the plot, here <code>Petal.Length</code>,
                  <code>Sepal.Length</code> and <code>Species</code>;
                </p>
              </li>
              <li>
                <p>that’s it, you get the interactive graphic in Power BI.</p>
              </li>
            </ul>
            <h2 id="helper-function">Helper function</h2>
            <p>
              If you have to deal with multiple widgets, you will be bothered
              about the filling of the
              <strong><em>pbiviz.json</em></strong> file. Here is a R function
              which fills it for you:
            </p>
            <div class="sourceCode" id="cb4">
              <pre
                class="sourceCode r"
              ><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true"></a><span class="kw">library</span>(jsonlite)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true"></a>fill_pbiviz &lt;-<span class="st"> </span><span class="cf">function</span>(path){</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true"></a>  wd &lt;-<span class="st"> </span><span class="kw">setwd</span>(path)</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true"></a>  <span class="kw">on.exit</span>(<span class="kw">setwd</span>(wd))</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true"></a>  pbiviz &lt;-<span class="st"> </span><span class="kw">fromJSON</span>(<span class="st">&quot;pbiviz.json&quot;</span>)</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true"></a>  pbiviz[[<span class="st">&quot;visual&quot;</span>]][[<span class="st">&quot;description&quot;</span>]] &lt;-<span class="st"> &quot;Description&quot;</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true"></a>  pbiviz[[<span class="st">&quot;visual&quot;</span>]][[<span class="st">&quot;supportUrl&quot;</span>]] &lt;-<span class="st"> &quot;https://wwww.example.com&quot;</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true"></a>  pbiviz[[<span class="st">&quot;author&quot;</span>]][[<span class="st">&quot;name&quot;</span>]] &lt;-<span class="st"> &quot;John Doe&quot;</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true"></a>  pbiviz[[<span class="st">&quot;author&quot;</span>]][[<span class="st">&quot;email&quot;</span>]] &lt;-<span class="st"> &quot;john.doe@gmail.com&quot;</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true"></a>  pbiviz &lt;-<span class="st"> </span><span class="kw">toJSON</span>(pbiviz, <span class="dt">auto_unbox =</span> <span class="ot">TRUE</span>, <span class="dt">null =</span> <span class="st">&quot;null&quot;</span>, <span class="dt">pretty =</span> <span class="dv">2</span>)</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true"></a>  <span class="kw">writeLines</span>(pbiviz, <span class="st">&quot;pbiviz.json&quot;</span>)</span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true"></a>}</span></code></pre>
            </div>
            <p>Just run <code>fill_pbiviz("path/to/pbiwidgets/iris")</code>.</p>
            <h1 id="notes">Notes</h1>
            <p>
              This works very well with <code>plotly</code> and
              <code>ggplotly</code> widgets. I also tested a graphic with the
              <code>scatterD3</code> package and the result was fine as well.
              But this can be less fine for other <code>htmlwidgets</code>.
            </p>
            <p>
              For example, with the <code>ggiraph</code> package, I managed to
              achieve a good result after settings the options
              <code>width_svg = 3, height_svg = 2.5</code> in the
              <code>girafe</code> function. I also set the option
              <code>opts_zoom(min = .7, max = 2)</code> in the
              <code>girafe_options</code> function:
            </p>
            <div class="sourceCode" id="cb5">
              <pre
                class="sourceCode r"
              ><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true"></a>gg_point &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data =</span> data) <span class="op">+</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true"></a><span class="st">  </span><span class="kw">geom_point_interactive</span>(......</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true"></a>p &lt;-<span class="st"> </span><span class="kw">girafe</span>(<span class="dt">ggobj =</span> gg_point, <span class="dt">width_svg =</span> <span class="dv">3</span>, <span class="dt">height_svg =</span> <span class="fl">2.5</span>)</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true"></a>p &lt;-<span class="st"> </span><span class="kw">girafe_options</span>(p, <span class="kw">opts_zoom</span>(<span class="dt">min =</span> <span class="fl">.7</span>, <span class="dt">max =</span> <span class="dv">2</span>))</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true"></a><span class="kw">internalSaveWidget</span>(p, <span class="st">&quot;out.html&quot;</span>)</span></code></pre>
            </div>
            <p>
              I tried a pie chart with the <code>rAmCharts4</code> package and
              got an empty plot. I finally managed to get the pie chart by
              removing the last lines of the file
              <strong><em>script.r</em></strong
              >:
            </p>
            <div class="sourceCode" id="cb6">
              <pre
                class="sourceCode r"
              ><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true"></a><span class="co">################ Reduce paddings ###################</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true"></a><span class="kw">ReadFullFileReplaceString</span>(</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true"></a>  <span class="st">&quot;out.html&quot;</span>, <span class="st">&quot;out.html&quot;</span>, <span class="st">',&quot;padding&quot;:[0-9]*,'</span>, <span class="st">',&quot;padding&quot;:0,'</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true"></a>)</span></code></pre>
            </div>
            <p>
              And I set the <code>height</code> option of the
              <code>amPieChart</code> function to <code>300px</code>, otherwise
              the legend was truncated.
            </p>
            <h1 id="advanced-example">Advanced example</h1>
            <p>
              When you select the columns <code>Petal.Length</code>,
              <code>Sepal.Length</code> and <code>Species</code>, they appear in
              the <em>‘Visualizations’</em> panel, under the dataset name
              <strong>Values</strong>:
            </p>
            <p><img src="./figures/pbiviz01.png" /></p>
            <p>
              Then, <strong>Power BI</strong> sends the data to the R script
              with the help of a CSV file, and
              <em
                >the columns of this CSV file are in the same order as your
                selected columns</em
              >.
            </p>
            <p>
              Therefore, instead of using the column names in the R script, one
              can use the column indices.
            </p>
            <p>
              Let’s illustrate. We will create a scatter plot as in the previous
              example, but the user will have the choice of the variables on the
              x-axis and the y-axis, and he’ll can also choose or not a color
              factor.
            </p>
            <p>
              Firstly, we change the display name of the
              <strong>Values</strong> dataset. Open the file
              <code>pbiwidgets/iris/capabiities.json</code> (with any text
              editor), and change the display name in the
              <code>dataRoles</code> field:
            </p>
            <div class="sourceCode" id="cb7">
              <pre
                class="sourceCode json"
              ><code class="sourceCode json"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true"></a><span class="fu">{</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true"></a>    <span class="dt">&quot;dataRoles&quot;</span> <span class="fu">:</span> <span class="ot">[</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true"></a>        <span class="fu">{</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true"></a>            <span class="dt">&quot;displayName&quot;</span> <span class="fu">:</span> <span class="st">&quot;Data (x, y, by)&quot;</span><span class="fu">,</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true"></a>            <span class="dt">&quot;kind&quot;</span> <span class="fu">:</span> <span class="st">&quot;GroupingOrMeasure&quot;</span><span class="fu">,</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true"></a>            <span class="dt">&quot;name&quot;</span> <span class="fu">:</span> <span class="st">&quot;Values&quot;</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true"></a>        <span class="fu">}</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true"></a>    <span class="ot">]</span><span class="fu">,</span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true"></a>        <span class="er">......</span></span></code></pre>
            </div>
            <p>
              Now we will see <strong>Data (x, y, by)</strong> in the
              <em>‘Visualizations’</em> panel, instead of
              <strong>Values</strong>:
            </p>
            <p><img src="./figures/pbiviz02.png" /></p>
            <p>
              Then we use the following R code in
              <strong><em>script.r</em></strong
              >:
            </p>
            <div class="sourceCode" id="cb8">
              <pre
                class="sourceCode r"
              ><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true"></a><span class="co">################### Actual code ####################</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true"></a>nms &lt;-<span class="st"> </span><span class="kw">colnames</span>(Values)</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true"></a>ncols &lt;-<span class="st"> </span><span class="kw">length</span>(nms)</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true"></a><span class="cf">if</span>(ncols <span class="op">==</span><span class="st"> </span>2L){</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true"></a>  gg &lt;-<span class="st"> </span><span class="kw">ggplot</span>(</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true"></a>    Values, <span class="kw">aes</span>(<span class="dt">x=</span>.data[[nms[<span class="dv">1</span>]]], <span class="dt">y=</span>.data[[nms[<span class="dv">2</span>]]])</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true"></a>  ) <span class="op">+</span><span class="st"> </span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true"></a><span class="st">    </span><span class="kw">geom_point</span>()</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true"></a>}<span class="cf">else</span> <span class="cf">if</span>(ncols <span class="op">&gt;=</span><span class="st"> </span>3L){</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true"></a>  gg &lt;-<span class="st"> </span><span class="kw">ggplot</span>(</span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true"></a>    Values, <span class="kw">aes</span>(<span class="dt">x=</span>.data[[nms[<span class="dv">1</span>]]], <span class="dt">y=</span>.data[[nms[<span class="dv">2</span>]]], <span class="dt">color =</span> .data[[nms[<span class="dv">3</span>]]])</span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true"></a>  ) <span class="op">+</span><span class="st"> </span></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true"></a><span class="st">    </span><span class="kw">geom_point</span>()</span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true"></a>}<span class="cf">else</span>{</span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true"></a>  gg &lt;-<span class="st"> </span><span class="kw">ggplot</span>() <span class="op">+</span><span class="st"> </span><span class="kw">geom_blank</span>()</span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true"></a>}</span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true"></a>p &lt;-<span class="st"> </span><span class="kw">ggplotly</span>(gg)</span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true"></a><span class="co">####################################################</span></span></code></pre>
            </div>
            <p>
              Now we can choose the columns we want for the x-axis and for the
              y-axis, and we can optionally choose the
              <code>Species</code> color factor:
            </p>
            <p><img src="./figures/pbiviz03.png" /></p>
            <p><img src="./figures/pbiviz04.png" /></p>
            <h1 id="arbitrary-html">Arbitrary HTML</h1>
            <p>
              In fact, <strong>pbiviz</strong> is not restricted to render a
              <code>htmlwidget</code>. One can render any HTML file, it suffices
              to save it under the name <strong><em>out.html</em></strong> in
              the R script. For instance, in the above example, we render a
              blank plot if the user does not select at least two columns. We
              can throw a message instead, with a R script like this:
            </p>
            <div class="sourceCode" id="cb9">
              <pre
                class="sourceCode r"
              ><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true"></a><span class="kw">source</span>(<span class="st">&quot;./r_files/flatten_HTML.r&quot;</span>)</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true"></a></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true"></a><span class="co">############### Library Declarations ###############</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true"></a><span class="kw">libraryRequireInstall</span>(<span class="st">&quot;plotly&quot;</span>)</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true"></a><span class="co">####################################################</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true"></a></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true"></a>htmlMessage &lt;-<span class="st"> </span><span class="cf">function</span>(message){</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true"></a>  html &lt;-<span class="st"> </span><span class="kw">c</span>(</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true"></a>    <span class="st">&quot;&lt;!doctype html&gt;&quot;</span>,</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true"></a>    <span class="st">&quot;&lt;html lang=en&gt;&quot;</span>,</span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true"></a>    <span class="st">&quot;  &lt;head&gt;&quot;</span>,</span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true"></a>    <span class="st">&quot;    &lt;meta charset=utf-8&gt;&quot;</span>,</span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true"></a>    <span class="st">&quot;  &lt;/head&gt;&quot;</span>,</span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true"></a>    <span class="st">&quot;  &lt;body&gt;&quot;</span>,</span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true"></a>    <span class="kw">sprintf</span>(<span class="st">&quot;    &lt;p&gt;%s&lt;/p&gt;&quot;</span>, message),</span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true"></a>    <span class="st">&quot;  &lt;/body&gt;&quot;</span>,</span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true"></a>    <span class="st">&quot;&lt;/html&gt;&quot;</span></span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true"></a>  )</span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true"></a>  <span class="kw">writeLines</span>(html, <span class="st">&quot;out.html&quot;</span>)</span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true"></a>}</span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true"></a></span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true"></a><span class="co">################### Actual code ####################</span></span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true"></a>nms &lt;-<span class="st"> </span><span class="kw">colnames</span>(Values)</span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true"></a>ncols &lt;-<span class="st"> </span><span class="kw">length</span>(nms)</span>
<span id="cb9-25"><a href="#cb9-25" aria-hidden="true"></a><span class="cf">if</span>(ncols <span class="op">==</span><span class="st"> </span>2L){</span>
<span id="cb9-26"><a href="#cb9-26" aria-hidden="true"></a>  gg &lt;-<span class="st"> </span><span class="kw">ggplot</span>(</span>
<span id="cb9-27"><a href="#cb9-27" aria-hidden="true"></a>    Values, <span class="kw">aes</span>(<span class="dt">x=</span>.data[[nms[<span class="dv">1</span>]]], <span class="dt">y=</span>.data[[nms[<span class="dv">2</span>]]])</span>
<span id="cb9-28"><a href="#cb9-28" aria-hidden="true"></a>  ) <span class="op">+</span><span class="st"> </span></span>
<span id="cb9-29"><a href="#cb9-29" aria-hidden="true"></a><span class="st">    </span><span class="kw">geom_point</span>()</span>
<span id="cb9-30"><a href="#cb9-30" aria-hidden="true"></a>  p &lt;-<span class="st"> </span><span class="kw">ggplotly</span>(gg) </span>
<span id="cb9-31"><a href="#cb9-31" aria-hidden="true"></a>  <span class="kw">internalSaveWidget</span>(p, <span class="st">&quot;out.html&quot;</span>)</span>
<span id="cb9-32"><a href="#cb9-32" aria-hidden="true"></a>}<span class="cf">else</span> <span class="cf">if</span>(ncols <span class="op">&gt;=</span><span class="st"> </span>3L){</span>
<span id="cb9-33"><a href="#cb9-33" aria-hidden="true"></a>  gg &lt;-<span class="st"> </span><span class="kw">ggplot</span>(</span>
<span id="cb9-34"><a href="#cb9-34" aria-hidden="true"></a>    Values, <span class="kw">aes</span>(<span class="dt">x=</span>.data[[nms[<span class="dv">1</span>]]], <span class="dt">y=</span>.data[[nms[<span class="dv">2</span>]]], <span class="dt">color =</span> .data[[nms[<span class="dv">3</span>]]])</span>
<span id="cb9-35"><a href="#cb9-35" aria-hidden="true"></a>  ) <span class="op">+</span><span class="st"> </span></span>
<span id="cb9-36"><a href="#cb9-36" aria-hidden="true"></a><span class="st">    </span><span class="kw">geom_point</span>()</span>
<span id="cb9-37"><a href="#cb9-37" aria-hidden="true"></a>  p &lt;-<span class="st"> </span><span class="kw">ggplotly</span>(gg) </span>
<span id="cb9-38"><a href="#cb9-38" aria-hidden="true"></a>  <span class="kw">internalSaveWidget</span>(p, <span class="st">&quot;out.html&quot;</span>)</span>
<span id="cb9-39"><a href="#cb9-39" aria-hidden="true"></a>}<span class="cf">else</span>{</span>
<span id="cb9-40"><a href="#cb9-40" aria-hidden="true"></a>  <span class="kw">htmlMessage</span>(</span>
<span id="cb9-41"><a href="#cb9-41" aria-hidden="true"></a>    <span class="st">&quot;You have to select at least two columns.&quot;</span></span>
<span id="cb9-42"><a href="#cb9-42" aria-hidden="true"></a>  )</span>
<span id="cb9-43"><a href="#cb9-43" aria-hidden="true"></a>}</span>
<span id="cb9-44"><a href="#cb9-44" aria-hidden="true"></a><span class="co">################## End of script ###################</span></span></code></pre>
            </div>
            <h1 id="using-multiple-datasets">Using multiple datasets</h1>
            <p>
              Some graphics require more than one dataset. We give an example
              here.
            </p>
            <p>First, we prepare two datasets:</p>
            <div class="sourceCode" id="cb10">
              <pre
                class="sourceCode r"
              ><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true"></a><span class="kw">library</span>(dplyr)</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true"></a><span class="kw">data</span>(<span class="st">&quot;diamonds&quot;</span>, <span class="dt">package =</span> <span class="st">&quot;ggplot2&quot;</span>)</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true"></a></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true"></a><span class="co">## creating dataset #1</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true"></a>data1 &lt;-<span class="st"> </span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true"></a><span class="st">  </span>diamonds <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true"></a><span class="st">  </span><span class="kw">group_by</span>(clarity) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true"></a><span class="st">  </span><span class="kw">summarize</span>(<span class="dt">m =</span> <span class="kw">mean</span>(price))  </span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true"></a></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true"></a><span class="co">## creating dataset #2</span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true"></a>data2 &lt;-<span class="st"> </span></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true"></a><span class="st">  </span>diamonds <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true"></a><span class="st">  </span><span class="kw">group_by</span>(clarity, cut) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true"></a><span class="st">  </span><span class="kw">summarize</span>(<span class="dt">m =</span> <span class="kw">mean</span>(price))</span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true"></a></span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true"></a><span class="co">## save to Excel files</span></span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true"></a>writexl<span class="op">::</span><span class="kw">write_xlsx</span>(<span class="kw">list</span>(<span class="st">&quot;data1&quot;</span> =<span class="st"> </span>data1), <span class="st">&quot;diamonds_summarized1.xlsx&quot;</span>)</span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true"></a>writexl<span class="op">::</span><span class="kw">write_xlsx</span>(<span class="kw">list</span>(<span class="st">&quot;data2&quot;</span> =<span class="st"> </span>data2), <span class="st">&quot;diamonds_summarized2.xlsx&quot;</span>)</span></code></pre>
            </div>
            <p>
              Create the visual project:
              <code>pbiviz new diamonds -t rhtml</code>. Complete the file
              <strong><em>pbiwidgets/diamonds/pbiviz.json</em></strong> as
              previously explained, and modify the file
              <strong><em>pbiwidgets/diamonds/capabilities.json</em></strong> as
              follows:
            </p>
            <div class="sourceCode" id="cb11">
              <pre
                class="sourceCode json"
              ><code class="sourceCode json"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true"></a><span class="fu">{</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true"></a>  <span class="dt">&quot;dataRoles&quot;</span><span class="fu">:</span> <span class="ot">[</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true"></a>    <span class="fu">{</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true"></a>      <span class="dt">&quot;displayName&quot;</span><span class="fu">:</span> <span class="st">&quot;Data1&quot;</span><span class="fu">,</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true"></a>      <span class="dt">&quot;kind&quot;</span><span class="fu">:</span> <span class="st">&quot;GroupingOrMeasure&quot;</span><span class="fu">,</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true"></a>      <span class="dt">&quot;name&quot;</span><span class="fu">:</span> <span class="st">&quot;data1&quot;</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true"></a>    <span class="fu">}</span><span class="ot">,</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true"></a>    <span class="fu">{</span></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true"></a>      <span class="dt">&quot;displayName&quot;</span><span class="fu">:</span> <span class="st">&quot;Data2&quot;</span><span class="fu">,</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true"></a>      <span class="dt">&quot;kind&quot;</span><span class="fu">:</span> <span class="st">&quot;GroupingOrMeasure&quot;</span><span class="fu">,</span></span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true"></a>      <span class="dt">&quot;name&quot;</span><span class="fu">:</span> <span class="st">&quot;data2&quot;</span></span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true"></a>    <span class="fu">}</span></span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true"></a>  <span class="ot">]</span><span class="fu">,</span></span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true"></a>  <span class="dt">&quot;dataViewMappings&quot;</span><span class="fu">:</span> <span class="ot">[</span></span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true"></a>    <span class="fu">{</span></span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true"></a>      <span class="dt">&quot;scriptResult&quot;</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true"></a>        <span class="dt">&quot;dataInput&quot;</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true"></a>          <span class="dt">&quot;table&quot;</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true"></a>            <span class="dt">&quot;rows&quot;</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true"></a>              <span class="dt">&quot;select&quot;</span><span class="fu">:</span> <span class="ot">[</span></span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true"></a>                <span class="fu">{</span></span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true"></a>                  <span class="dt">&quot;for&quot;</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true"></a>                    <span class="dt">&quot;in&quot;</span><span class="fu">:</span> <span class="st">&quot;data1&quot;</span></span>
<span id="cb11-24"><a href="#cb11-24" aria-hidden="true"></a>                  <span class="fu">}</span></span>
<span id="cb11-25"><a href="#cb11-25" aria-hidden="true"></a>                <span class="fu">}</span><span class="ot">,</span></span>
<span id="cb11-26"><a href="#cb11-26" aria-hidden="true"></a>                <span class="fu">{</span></span>
<span id="cb11-27"><a href="#cb11-27" aria-hidden="true"></a>                  <span class="dt">&quot;for&quot;</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb11-28"><a href="#cb11-28" aria-hidden="true"></a>                    <span class="dt">&quot;in&quot;</span><span class="fu">:</span> <span class="st">&quot;data2&quot;</span></span>
<span id="cb11-29"><a href="#cb11-29" aria-hidden="true"></a>                  <span class="fu">}</span></span>
<span id="cb11-30"><a href="#cb11-30" aria-hidden="true"></a>                <span class="fu">}</span></span>
<span id="cb11-31"><a href="#cb11-31" aria-hidden="true"></a>              <span class="ot">]</span><span class="fu">,</span></span>
<span id="cb11-32"><a href="#cb11-32" aria-hidden="true"></a>              <span class="er">......</span></span></code></pre>
            </div>
            <p>
              Now the R script, in
              <strong><em>pbiwidgets/diamonds/script.r</em></strong
              >:
            </p>
            <div class="sourceCode" id="cb12">
              <pre
                class="sourceCode r"
              ><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true"></a><span class="kw">source</span>(<span class="st">'./r_files/flatten_HTML.r'</span>)</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true"></a></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true"></a><span class="co">############### Library Declarations ###############</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true"></a><span class="kw">libraryRequireInstall</span>(<span class="st">&quot;plotly&quot;</span>)</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true"></a><span class="co">####################################################</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true"></a></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true"></a><span class="co">################### Actual code ####################</span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true"></a>gg &lt;-<span class="st"> </span><span class="kw">ggplot</span>() <span class="op">+</span></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">data =</span> data1, <span class="kw">aes</span>(<span class="dt">x =</span> clarity, <span class="dt">y =</span> m), <span class="dt">color =</span> <span class="st">&quot;blue&quot;</span>, <span class="dt">size =</span> <span class="dv">3</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">data =</span> data2, <span class="kw">aes</span>(<span class="dt">x =</span> clarity, <span class="dt">y =</span> m), <span class="dt">color =</span> <span class="st">&quot;red&quot;</span>)</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true"></a><span class="co">####################################################</span></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true"></a></span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true"></a><span class="co">############# Create and save widget ###############</span></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true"></a>p &lt;-<span class="st"> </span><span class="kw">ggplotly</span>(gg)</span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true"></a><span class="kw">internalSaveWidget</span>(p, <span class="st">'out.html'</span>)</span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true"></a><span class="co">####################################################</span></span></code></pre>
            </div>
            <p>
              Now you can compile the project: run
              <code>pbiviz package</code> from the folder
              <strong><em>pbiwidgets/diamonds</em></strong
              >.
            </p>
            <p>
              Open <strong>Power BI</strong> and load the two Excel files.
              Select <em>‘Get more visuals’</em> as before (the icon with the
              three dots), <em>‘Import a visual from a file’</em> and select the
              <strong>pbiviz</strong> file located in the
              <strong><em>pbiwidgets/diamonds/dist</em></strong> folder.
            </p>
            <p>
              Drag and drop the column names of the two datasets to put them in
              <strong>Data1</strong> and <strong>Data2</strong>. Here is the
              result:
            </p>
            <p><img src="./figures/pbiviz05.png" /></p>
            <h2 id="helper-function-1">Helper function</h2>
            <p>
              Here is a R function which generates the
              <strong><em>capabilities.json</em></strong> file:
            </p>
            <div class="sourceCode" id="cb13">
              <pre
                class="sourceCode r"
              ><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true"></a><span class="kw">library</span>(jsonlite)</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true"></a>fill_capabilities &lt;-<span class="st"> </span><span class="cf">function</span>(path, dataNames, dataDisplayNames){</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true"></a>  wd &lt;-<span class="st"> </span><span class="kw">setwd</span>(path)</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true"></a>  <span class="kw">on.exit</span>(<span class="kw">setwd</span>(wd))</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true"></a>  caps &lt;-<span class="st"> </span><span class="kw">fromJSON</span>(<span class="st">&quot;capabilities.json&quot;</span>, <span class="dt">simplifyVector =</span> <span class="ot">FALSE</span>)</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true"></a>  caps[[<span class="st">&quot;dataRoles&quot;</span>]] &lt;-<span class="st"> </span><span class="kw">mapply</span>(<span class="cf">function</span>(name, displayName){</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true"></a>    <span class="kw">list</span>(</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true"></a>      <span class="st">&quot;displayName&quot;</span> =<span class="st"> </span>displayName, </span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true"></a>      <span class="st">&quot;kind&quot;</span>        =<span class="st"> &quot;GroupingOrMeasure&quot;</span>, </span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true"></a>      <span class="st">&quot;name&quot;</span>        =<span class="st"> </span>name</span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true"></a>    )</span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true"></a>  }, dataNames, dataDisplayNames, <span class="dt">SIMPLIFY =</span> <span class="ot">FALSE</span>, <span class="dt">USE.NAMES =</span> <span class="ot">FALSE</span>)</span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true"></a>  caps[[<span class="st">&quot;dataViewMappings&quot;</span>]][[</span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true"></a>    1L</span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true"></a>  ]][[<span class="st">&quot;scriptResult&quot;</span>]][[<span class="st">&quot;dataInput&quot;</span>]][[<span class="st">&quot;table&quot;</span>]][[<span class="st">&quot;rows&quot;</span>]][[<span class="st">&quot;select&quot;</span>]] &lt;-</span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true"></a><span class="st">    </span><span class="kw">lapply</span>(dataNames, <span class="cf">function</span>(dataName){</span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true"></a>      <span class="kw">list</span>(<span class="st">&quot;for&quot;</span> =<span class="st"> </span><span class="kw">list</span>(<span class="st">&quot;in&quot;</span> =<span class="st"> </span>dataName))</span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true"></a>    })</span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true"></a>  caps &lt;-<span class="st"> </span><span class="kw">toJSON</span>(caps, <span class="dt">auto_unbox =</span> <span class="ot">TRUE</span>, <span class="dt">null =</span> <span class="st">&quot;null&quot;</span>, <span class="dt">pretty =</span> <span class="dv">2</span>)</span>
<span id="cb13-20"><a href="#cb13-20" aria-hidden="true"></a>  <span class="kw">writeLines</span>(caps, <span class="st">&quot;capabilities.json&quot;</span>)</span>
<span id="cb13-21"><a href="#cb13-21" aria-hidden="true"></a>}</span></code></pre>
            </div>
            <p>Usage example:</p>
            <div class="sourceCode" id="cb14">
              <pre
                class="sourceCode r"
              ><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true"></a><span class="kw">fill_capabilities</span>(</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true"></a>  <span class="st">&quot;path/to/pbiwidgets/diamonds&quot;</span>, <span class="kw">c</span>(<span class="st">&quot;data1&quot;</span>, <span class="st">&quot;data2&quot;</span>), <span class="kw">c</span>(<span class="st">&quot;Data1&quot;</span>, <span class="st">&quot;Data2&quot;</span>)</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true"></a>)</span></code></pre>
            </div>
            <h1 id="limiting-the-number-of-selected-columns">
              Limiting the number of selected columns
            </h1>
            <p>
              We can limit the number of columns that the user can select in a
              table. For instance, let’s take the previous example. The maximum
              number of columns is set in the file
              <strong><em>capabilities.json</em></strong
              >, in the <code>dataViewMappings</code> field:
            </p>
            <div class="sourceCode" id="cb15">
              <pre
                class="sourceCode json"
              ><code class="sourceCode json"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true"></a><span class="fu">{</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true"></a>  <span class="dt">&quot;dataRoles&quot;</span><span class="fu">:</span> <span class="ot">[</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true"></a>    <span class="fu">{</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true"></a>      <span class="dt">&quot;displayName&quot;</span><span class="fu">:</span> <span class="st">&quot;Data1&quot;</span><span class="fu">,</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true"></a>      <span class="dt">&quot;kind&quot;</span><span class="fu">:</span> <span class="st">&quot;GroupingOrMeasure&quot;</span><span class="fu">,</span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true"></a>      <span class="dt">&quot;name&quot;</span><span class="fu">:</span> <span class="st">&quot;data1&quot;</span></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true"></a>    <span class="fu">}</span><span class="ot">,</span></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true"></a>    <span class="fu">{</span></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true"></a>      <span class="dt">&quot;displayName&quot;</span><span class="fu">:</span> <span class="st">&quot;Data2&quot;</span><span class="fu">,</span></span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true"></a>      <span class="dt">&quot;kind&quot;</span><span class="fu">:</span> <span class="st">&quot;GroupingOrMeasure&quot;</span><span class="fu">,</span></span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true"></a>      <span class="dt">&quot;name&quot;</span><span class="fu">:</span> <span class="st">&quot;data2&quot;</span></span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true"></a>    <span class="fu">}</span></span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true"></a>  <span class="ot">]</span><span class="fu">,</span></span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true"></a>  <span class="dt">&quot;dataViewMappings&quot;</span><span class="fu">:</span> <span class="ot">[</span></span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true"></a>    <span class="fu">{</span></span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true"></a>      <span class="dt">&quot;conditions&quot;</span><span class="fu">:</span> <span class="ot">[</span></span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true"></a>        <span class="fu">{</span></span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true"></a>          <span class="dt">&quot;data1&quot;</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb15-19"><a href="#cb15-19" aria-hidden="true"></a>            <span class="dt">&quot;max&quot;</span><span class="fu">:</span> <span class="dv">2</span></span>
<span id="cb15-20"><a href="#cb15-20" aria-hidden="true"></a>          <span class="fu">},</span></span>
<span id="cb15-21"><a href="#cb15-21" aria-hidden="true"></a>          <span class="dt">&quot;data2&quot;</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb15-22"><a href="#cb15-22" aria-hidden="true"></a>            <span class="dt">&quot;max&quot;</span><span class="fu">:</span> <span class="dv">2</span></span>
<span id="cb15-23"><a href="#cb15-23" aria-hidden="true"></a>          <span class="fu">}</span></span>
<span id="cb15-24"><a href="#cb15-24" aria-hidden="true"></a>        <span class="fu">}</span></span>
<span id="cb15-25"><a href="#cb15-25" aria-hidden="true"></a>      <span class="ot">]</span><span class="fu">,</span></span>
<span id="cb15-26"><a href="#cb15-26" aria-hidden="true"></a>      <span class="dt">&quot;scriptResult&quot;</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb15-27"><a href="#cb15-27" aria-hidden="true"></a>        <span class="er">......</span></span></code></pre>
            </div>
            <h1 id="combining-widgets">Combining widgets</h1>
            <p>
              The
              <a
                href="https://cran.r-project.org/web/packages/manipulateWidget/vignettes/manipulateWidgets.html"
                >manipulateWidget package</a
              >
              provides a useful function <code>combineWidgets</code> which, as
              its name indicates, allows to combine several widgets.
            </p>
            <p>
              Here is an example using the widgets of the
              <strong>dygraphs</strong> package.
            </p>
            <div class="sourceCode" id="cb16">
              <pre
                class="sourceCode r"
              ><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true"></a><span class="kw">source</span>(<span class="st">'./r_files/flatten_HTML.r'</span>)</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true"></a></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true"></a><span class="co">############### Library Declarations ###############</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true"></a><span class="kw">libraryRequireInstall</span>(<span class="st">&quot;dygraphs&quot;</span>)</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true"></a><span class="kw">libraryRequireInstall</span>(<span class="st">&quot;manipulateWidget&quot;</span>)</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true"></a><span class="co">####################################################</span></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true"></a></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true"></a><span class="co">################### Actual code ####################</span></span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true"></a>y1 &lt;-<span class="st"> </span>Values[[<span class="dv">1</span>]]</span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true"></a>y2 &lt;-<span class="st"> </span>Values[[<span class="dv">2</span>]]</span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true"></a>x &lt;-<span class="st"> </span>1L<span class="op">:</span><span class="kw">nrow</span>(Values)</span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true"></a>columnNames &lt;-<span class="st"> </span><span class="kw">colnames</span>(Values)</span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true"></a>df1 &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">x =</span> x, <span class="dt">y =</span> y1)</span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true"></a>df2 &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">x =</span> x, <span class="dt">y =</span> y2)</span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true"></a>widget1 &lt;-<span class="st"> </span><span class="kw">dygraph</span>(df1, <span class="dt">main =</span> columnNames[1L])</span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true"></a>widget2 &lt;-<span class="st"> </span><span class="kw">dygraph</span>(df2, <span class="dt">main =</span> columnNames[2L])</span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true"></a><span class="co">####################################################</span></span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true"></a></span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true"></a><span class="co">############# Create and save widget ###############</span></span>
<span id="cb16-20"><a href="#cb16-20" aria-hidden="true"></a>widget &lt;-<span class="st"> </span><span class="kw">combineWidgets</span>(widget1, widget2)</span>
<span id="cb16-21"><a href="#cb16-21" aria-hidden="true"></a><span class="kw">internalSaveWidget</span>(widget, <span class="st">'out.html'</span>)</span>
<span id="cb16-22"><a href="#cb16-22" aria-hidden="true"></a><span class="co">####################################################</span></span></code></pre>
            </div>
            <p><img src="./figures/pbiviz06.png" /></p>
            <h1 id="prevent-removal-of-duplicated-rows">
              Prevent removal of duplicated rows
            </h1>
            <p>
              Power BI has an undesirable behavior: when sending the data to R,
              it removes the duplicated rows. To alleviate this problem, you
              have to add a column without duplicated values. An easy way to get
              such a column consists in going to the Power Query Editor (<em
                >“Transform data”</em
              >
              button), then going to the tab <em>“Add column”</em> and select
              <em>“Index Column”</em>. Then include this column in the data
              exported to R.
            </p>
            <h1 id="adding-formatting-objects">Adding formatting objects</h1>
            <p>
              Here we explain how to achieve the result shown on the image
              below. With this visual, the user is able to add a title to the
              chart and to select a theme for the chart.
            </p>
            <p><img src="./figures/pbiviz07.gif" /></p>
            <p>
              This is achieved by modifying two files: the file
              <strong><em>capabilities.json</em></strong> and the file
              <strong><em>src/settings.ts</em></strong> in the folder created by
              <strong>pbiviz</strong>.
            </p>
            <p>
              Here is the file <strong><em>capabilities.json</em></strong
              >. We modified the <code>objects</code> node:
            </p>
            <div class="sourceCode" id="cb17">
              <pre
                class="sourceCode json"
              ><code class="sourceCode json"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true"></a><span class="fu">{</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true"></a>  <span class="dt">&quot;dataRoles&quot;</span><span class="fu">:</span> <span class="ot">[</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true"></a>    <span class="fu">{</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true"></a>      <span class="dt">&quot;displayName&quot;</span><span class="fu">:</span> <span class="st">&quot;Data (x, y, color, index)&quot;</span><span class="fu">,</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true"></a>      <span class="dt">&quot;kind&quot;</span><span class="fu">:</span> <span class="st">&quot;GroupingOrMeasure&quot;</span><span class="fu">,</span></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true"></a>      <span class="dt">&quot;name&quot;</span><span class="fu">:</span> <span class="st">&quot;dat&quot;</span></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true"></a>    <span class="fu">}</span></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true"></a>  <span class="ot">]</span><span class="fu">,</span></span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true"></a>  <span class="dt">&quot;objects&quot;</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true"></a>    <span class="dt">&quot;ggsettings&quot;</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true"></a>      <span class="dt">&quot;displayName&quot;</span><span class="fu">:</span> <span class="st">&quot;Chart Settings&quot;</span><span class="fu">,</span></span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true"></a>      <span class="dt">&quot;description&quot;</span><span class="fu">:</span> <span class="st">&quot;Chart theme and title&quot;</span><span class="fu">,</span></span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true"></a>      <span class="dt">&quot;properties&quot;</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true"></a>        <span class="dt">&quot;ChartTitle&quot;</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true"></a>          <span class="dt">&quot;displayName&quot;</span><span class="fu">:</span> <span class="st">&quot;Chart Title&quot;</span><span class="fu">,</span></span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true"></a>          <span class="dt">&quot;description&quot;</span><span class="fu">:</span> <span class="st">&quot;Set chart title&quot;</span><span class="fu">,</span></span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true"></a>          <span class="dt">&quot;type&quot;</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb17-18"><a href="#cb17-18" aria-hidden="true"></a>            <span class="dt">&quot;text&quot;</span><span class="fu">:</span> <span class="kw">true</span></span>
<span id="cb17-19"><a href="#cb17-19" aria-hidden="true"></a>          <span class="fu">}</span></span>
<span id="cb17-20"><a href="#cb17-20" aria-hidden="true"></a>        <span class="fu">},</span></span>
<span id="cb17-21"><a href="#cb17-21" aria-hidden="true"></a>        <span class="dt">&quot;ChartTheme&quot;</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb17-22"><a href="#cb17-22" aria-hidden="true"></a>          <span class="dt">&quot;displayName&quot;</span><span class="fu">:</span> <span class="st">&quot;Chart Theme&quot;</span><span class="fu">,</span></span>
<span id="cb17-23"><a href="#cb17-23" aria-hidden="true"></a>          <span class="dt">&quot;description&quot;</span><span class="fu">:</span> <span class="st">&quot;Select the Chart Theme&quot;</span><span class="fu">,</span></span>
<span id="cb17-24"><a href="#cb17-24" aria-hidden="true"></a>          <span class="dt">&quot;type&quot;</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb17-25"><a href="#cb17-25" aria-hidden="true"></a>            <span class="dt">&quot;enumeration&quot;</span><span class="fu">:</span> <span class="ot">[</span></span>
<span id="cb17-26"><a href="#cb17-26" aria-hidden="true"></a>              <span class="fu">{</span></span>
<span id="cb17-27"><a href="#cb17-27" aria-hidden="true"></a>                <span class="dt">&quot;displayName&quot;</span><span class="fu">:</span> <span class="st">&quot;Classic&quot;</span><span class="fu">,</span></span>
<span id="cb17-28"><a href="#cb17-28" aria-hidden="true"></a>                <span class="dt">&quot;value&quot;</span><span class="fu">:</span> <span class="st">&quot;classic&quot;</span></span>
<span id="cb17-29"><a href="#cb17-29" aria-hidden="true"></a>              <span class="fu">}</span><span class="ot">,</span></span>
<span id="cb17-30"><a href="#cb17-30" aria-hidden="true"></a>              <span class="fu">{</span></span>
<span id="cb17-31"><a href="#cb17-31" aria-hidden="true"></a>                <span class="dt">&quot;displayName&quot;</span><span class="fu">:</span> <span class="st">&quot;Economist&quot;</span><span class="fu">,</span></span>
<span id="cb17-32"><a href="#cb17-32" aria-hidden="true"></a>                <span class="dt">&quot;value&quot;</span><span class="fu">:</span> <span class="st">&quot;economist&quot;</span></span>
<span id="cb17-33"><a href="#cb17-33" aria-hidden="true"></a>              <span class="fu">}</span><span class="ot">,</span></span>
<span id="cb17-34"><a href="#cb17-34" aria-hidden="true"></a>              <span class="fu">{</span></span>
<span id="cb17-35"><a href="#cb17-35" aria-hidden="true"></a>                <span class="dt">&quot;displayName&quot;</span><span class="fu">:</span> <span class="st">&quot;Excel&quot;</span><span class="fu">,</span></span>
<span id="cb17-36"><a href="#cb17-36" aria-hidden="true"></a>                <span class="dt">&quot;value&quot;</span><span class="fu">:</span> <span class="st">&quot;excel&quot;</span></span>
<span id="cb17-37"><a href="#cb17-37" aria-hidden="true"></a>              <span class="fu">}</span></span>
<span id="cb17-38"><a href="#cb17-38" aria-hidden="true"></a>            <span class="ot">]</span></span>
<span id="cb17-39"><a href="#cb17-39" aria-hidden="true"></a>          <span class="fu">}</span></span>
<span id="cb17-40"><a href="#cb17-40" aria-hidden="true"></a>        <span class="fu">}</span></span>
<span id="cb17-41"><a href="#cb17-41" aria-hidden="true"></a>      <span class="fu">}</span></span>
<span id="cb17-42"><a href="#cb17-42" aria-hidden="true"></a>    <span class="fu">}</span></span>
<span id="cb17-43"><a href="#cb17-43" aria-hidden="true"></a>  <span class="fu">},</span></span>
<span id="cb17-44"><a href="#cb17-44" aria-hidden="true"></a>  <span class="dt">&quot;dataViewMappings&quot;</span><span class="fu">:</span> <span class="ot">[</span></span>
<span id="cb17-45"><a href="#cb17-45" aria-hidden="true"></a>    <span class="fu">{</span></span>
<span id="cb17-46"><a href="#cb17-46" aria-hidden="true"></a>     <span class="er">......</span></span></code></pre>
            </div>
            <p>
              And here is the TypeScript file
              <strong><em>src/settings.ts</em></strong
              >:
            </p>
            <div class="sourceCode" id="cb18">
              <pre
                class="sourceCode ts"
              ><code class="sourceCode typescript"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true"></a><span class="st">&quot;use strict&quot;</span><span class="op">;</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true"></a></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true"></a><span class="im">import</span> { dataViewObjectsParser } from <span class="st">&quot;powerbi-visuals-utils-dataviewutils&quot;</span><span class="op">;</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true"></a><span class="im">import</span> DataViewObjectsParser <span class="op">=</span> dataViewObjectsParser<span class="op">.</span><span class="at">DataViewObjectsParser</span><span class="op">;</span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true"></a></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true"></a>export class VisualSettings extends DataViewObjectsParser {</span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true"></a>  public ggsettings<span class="op">:</span> ChartSettings <span class="op">=</span> <span class="kw">new</span> <span class="fu">ChartSettings</span>()<span class="op">;</span></span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true"></a>}</span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true"></a></span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true"></a>export class ChartSettings {</span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true"></a>  public ChartTitle<span class="op">:</span> <span class="dt">string</span> <span class="op">=</span> <span class="st">&quot;&quot;</span><span class="op">;</span></span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true"></a>  public ChartTheme<span class="op">:</span> <span class="dt">string</span> <span class="op">=</span> <span class="st">&quot;classic&quot;</span><span class="op">;</span></span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true"></a>}</span></code></pre>
            </div>
            <p>
              Then, in the file <strong><em>script.r</em></strong> the title set
              by the user and the theme he chooses are named
              <code>ggsettings_ChartTitle</code> and
              <code>ggsettings_ChartTheme</code> respectively. But they won’t be
              available at the first creation of the chart, so we have to check
              for their existence in the R script:
            </p>
            <div class="sourceCode" id="cb19">
              <pre
                class="sourceCode r"
              ><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true"></a><span class="cf">if</span>(<span class="kw">exists</span>(<span class="st">&quot;ggsettings_ChartTheme&quot;</span>) <span class="op">&amp;&amp;</span><span class="st"> </span><span class="kw">exists</span>(<span class="st">&quot;ggsettings_ChartTitle&quot;</span>)){</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true"></a>  ......</span></code></pre>
            </div>
            <p>Here is the full script I used:</p>
            <div class="sourceCode" id="cb20">
              <pre
                class="sourceCode r"
              ><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true"></a><span class="kw">source</span>(<span class="st">'./r_files/flatten_HTML.r'</span>)</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true"></a></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true"></a><span class="co">############### Library Declarations ###############</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true"></a><span class="kw">libraryRequireInstall</span>(<span class="st">&quot;plotly&quot;</span>)</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true"></a><span class="kw">library</span>(ggthemes)</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true"></a><span class="co">####################################################</span></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true"></a></span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true"></a><span class="co">################### Actual code ####################</span></span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true"></a>nms &lt;-<span class="st"> </span><span class="kw">colnames</span>(dat)</span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true"></a>ncols &lt;-<span class="st"> </span><span class="kw">length</span>(nms)</span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true"></a><span class="cf">if</span>(ncols <span class="op">==</span><span class="st"> </span><span class="dv">4</span>){</span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true"></a>  gg &lt;-<span class="st"> </span><span class="kw">ggplot</span>(</span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true"></a>    dat, <span class="kw">aes_string</span>(<span class="dt">x =</span> nms[<span class="dv">1</span>], <span class="dt">y =</span> nms[<span class="dv">2</span>], <span class="dt">color =</span> nms[<span class="dv">3</span>])</span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true"></a>  ) <span class="op">+</span><span class="st"> </span></span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true"></a><span class="st">    </span><span class="kw">geom_point</span>()</span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true"></a>}<span class="cf">else</span>{</span>
<span id="cb20-17"><a href="#cb20-17" aria-hidden="true"></a>  <span class="kw">stop</span>(<span class="st">&quot;You have to select four columns!&quot;</span>)</span>
<span id="cb20-18"><a href="#cb20-18" aria-hidden="true"></a>}</span>
<span id="cb20-19"><a href="#cb20-19" aria-hidden="true"></a></span>
<span id="cb20-20"><a href="#cb20-20" aria-hidden="true"></a><span class="cf">if</span>(<span class="kw">exists</span>(<span class="st">&quot;ggsettings_ChartTheme&quot;</span>) <span class="op">&amp;&amp;</span><span class="st"> </span><span class="kw">exists</span>(<span class="st">&quot;ggsettings_ChartTitle&quot;</span>)){</span>
<span id="cb20-21"><a href="#cb20-21" aria-hidden="true"></a>  gg &lt;-<span class="st"> </span>gg <span class="op">+</span><span class="st"> </span><span class="kw">ggtitle</span>(ggsettings_ChartTitle)</span>
<span id="cb20-22"><a href="#cb20-22" aria-hidden="true"></a>  <span class="cf">if</span>(ggsettings_ChartTheme <span class="op">==</span><span class="st"> &quot;economist&quot;</span>){</span>
<span id="cb20-23"><a href="#cb20-23" aria-hidden="true"></a>    gg &lt;-<span class="st"> </span>gg <span class="op">+</span><span class="st"> </span><span class="kw">scale_color_economist</span>() <span class="op">+</span><span class="st"> </span><span class="kw">theme_economist</span>()</span>
<span id="cb20-24"><a href="#cb20-24" aria-hidden="true"></a>  }<span class="cf">else</span> <span class="cf">if</span>(ggsettings_ChartTheme <span class="op">==</span><span class="st"> &quot;excel&quot;</span>){</span>
<span id="cb20-25"><a href="#cb20-25" aria-hidden="true"></a>    gg &lt;-<span class="st"> </span>gg <span class="op">+</span><span class="st"> </span><span class="kw">scale_color_excel_new</span>() <span class="op">+</span><span class="st"> </span><span class="kw">theme_excel_new</span>()</span>
<span id="cb20-26"><a href="#cb20-26" aria-hidden="true"></a>  }</span>
<span id="cb20-27"><a href="#cb20-27" aria-hidden="true"></a>}</span>
<span id="cb20-28"><a href="#cb20-28" aria-hidden="true"></a><span class="co">####################################################</span></span>
<span id="cb20-29"><a href="#cb20-29" aria-hidden="true"></a></span>
<span id="cb20-30"><a href="#cb20-30" aria-hidden="true"></a><span class="co">############# Create and save widget ###############</span></span>
<span id="cb20-31"><a href="#cb20-31" aria-hidden="true"></a>p &lt;-<span class="st"> </span><span class="kw">ggplotly</span>(gg)</span>
<span id="cb20-32"><a href="#cb20-32" aria-hidden="true"></a><span class="kw">internalSaveWidget</span>(p, <span class="st">'out.html'</span>)</span>
<span id="cb20-33"><a href="#cb20-33" aria-hidden="true"></a><span class="co">####################################################</span></span></code></pre>
            </div>
            <h2 id="list-of-available-object-types">
              List of available object types
            </h2>
            <ul>
              <li>color picker:</li>
            </ul>
            <div class="sourceCode" id="cb21">
              <pre
                class="sourceCode json"
              ><code class="sourceCode json"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true"></a><span class="er">&quot;type&quot;:</span> <span class="fu">{</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true"></a>  <span class="dt">&quot;fill&quot;</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true"></a>    <span class="dt">&quot;solid&quot;</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true"></a>      <span class="dt">&quot;color&quot;</span><span class="fu">:</span> <span class="kw">true</span></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true"></a>    <span class="fu">}</span></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true"></a>  <span class="fu">}</span></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true"></a><span class="fu">}</span></span></code></pre>
            </div>
            <ul>
              <li>text input:</li>
            </ul>
            <div class="sourceCode" id="cb22">
              <pre
                class="sourceCode json"
              ><code class="sourceCode json"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true"></a><span class="er">&quot;type&quot;:</span> <span class="fu">{</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true"></a>  <span class="dt">&quot;text&quot;</span><span class="fu">:</span> <span class="kw">true</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true"></a><span class="fu">}</span></span></code></pre>
            </div>
            <ul>
              <li>number input:</li>
            </ul>
            <div class="sourceCode" id="cb23">
              <pre
                class="sourceCode json"
              ><code class="sourceCode json"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true"></a><span class="er">&quot;type&quot;:</span> <span class="fu">{</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true"></a>  <span class="dt">&quot;numeric&quot;</span><span class="fu">:</span> <span class="kw">true</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true"></a><span class="fu">}</span></span></code></pre>
            </div>
            <ul>
              <li>integer input:</li>
            </ul>
            <div class="sourceCode" id="cb24">
              <pre
                class="sourceCode json"
              ><code class="sourceCode json"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true"></a><span class="er">&quot;type&quot;:</span> <span class="fu">{</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true"></a>  <span class="dt">&quot;integer&quot;</span><span class="fu">:</span> <span class="kw">true</span></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true"></a><span class="fu">}</span></span></code></pre>
            </div>
            <ul>
              <li>switch input (true/false):</li>
            </ul>
            <div class="sourceCode" id="cb25">
              <pre
                class="sourceCode json"
              ><code class="sourceCode json"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true"></a><span class="er">&quot;type&quot;:</span> <span class="fu">{</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true"></a>  <span class="dt">&quot;bool&quot;</span><span class="fu">:</span> <span class="kw">true</span></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true"></a><span class="fu">}</span></span></code></pre>
            </div>
            <ul>
              <li>percentage input:</li>
            </ul>
            <div class="sourceCode" id="cb26">
              <pre
                class="sourceCode json"
              ><code class="sourceCode json"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true"></a><span class="er">&quot;type&quot;:</span> <span class="fu">{</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true"></a>  <span class="dt">&quot;formatting&quot;</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true"></a>    <span class="dt">&quot;fontSize&quot;</span><span class="fu">:</span> <span class="kw">true</span></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true"></a>  <span class="fu">}</span></span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true"></a><span class="fu">}</span></span></code></pre>
            </div>
            <ul>
              <li>dropdown list:</li>
            </ul>
            <div class="sourceCode" id="cb27">
              <pre
                class="sourceCode json"
              ><code class="sourceCode json"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true"></a><span class="er">&quot;type&quot;:</span> <span class="fu">{</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true"></a>  <span class="dt">&quot;enumeration&quot;</span><span class="fu">:</span> <span class="ot">[</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true"></a>    <span class="fu">{</span></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true"></a>      <span class="dt">&quot;displayName&quot;</span><span class="fu">:</span> <span class="st">&quot;Item 1&quot;</span><span class="fu">,</span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true"></a>      <span class="dt">&quot;value&quot;</span><span class="fu">:</span> <span class="st">&quot;item1&quot;</span></span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true"></a>    <span class="fu">}</span><span class="ot">,</span></span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true"></a>    <span class="fu">{</span></span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true"></a>      <span class="dt">&quot;displayName&quot;</span><span class="fu">:</span> <span class="st">&quot;Item 2&quot;</span><span class="fu">,</span></span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true"></a>      <span class="dt">&quot;value&quot;</span><span class="fu">:</span> <span class="st">&quot;item2&quot;</span></span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true"></a>    <span class="fu">}</span></span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true"></a>  <span class="ot">]</span></span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true"></a><span class="fu">}</span></span></code></pre>
            </div>
            <h1 id="restricting-a-number-input-to-a-range">
              Restricting a number input to a range
            </h1>
            <p>
              It might be desirable to have a minimum value and a maximum value
              for a number input. Assume you have such an
              <code>objects</code> field in
              <strong><em>capabilities.json</em></strong
              >:
            </p>
            <div class="sourceCode" id="cb28">
              <pre
                class="sourceCode json"
              ><code class="sourceCode json"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true"></a>  <span class="er">&quot;objects&quot;:</span> <span class="fu">{</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true"></a>    <span class="dt">&quot;regressionline&quot;</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true"></a>      <span class="dt">&quot;displayName&quot;</span><span class="fu">:</span> <span class="st">&quot;Regression Line&quot;</span><span class="fu">,</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true"></a>      <span class="dt">&quot;description&quot;</span><span class="fu">:</span> <span class="st">&quot;Add regression line&quot;</span><span class="fu">,</span></span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true"></a>      <span class="dt">&quot;properties&quot;</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true"></a>        <span class="dt">&quot;AddLine&quot;</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true"></a>          <span class="dt">&quot;displayName&quot;</span><span class="fu">:</span> <span class="st">&quot;Add&quot;</span><span class="fu">,</span></span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true"></a>          <span class="dt">&quot;description&quot;</span><span class="fu">:</span> <span class="st">&quot;Add regression line&quot;</span><span class="fu">,</span></span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true"></a>          <span class="dt">&quot;type&quot;</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true"></a>            <span class="dt">&quot;bool&quot;</span><span class="fu">:</span> <span class="kw">true</span></span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true"></a>          <span class="fu">}</span></span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true"></a>        <span class="fu">},</span></span>
<span id="cb28-13"><a href="#cb28-13" aria-hidden="true"></a>        <span class="dt">&quot;LineWidth&quot;</span><span class="er">;</span> <span class="er">{</span></span>
<span id="cb28-14"><a href="#cb28-14" aria-hidden="true"></a>          <span class="dt">&quot;displayName&quot;</span><span class="fu">:</span> <span class="st">&quot;Line Width&quot;</span><span class="fu">,</span></span>
<span id="cb28-15"><a href="#cb28-15" aria-hidden="true"></a>          <span class="dt">&quot;description&quot;</span><span class="fu">:</span> <span class="st">&quot;Width of regression line&quot;</span><span class="fu">,</span></span>
<span id="cb28-16"><a href="#cb28-16" aria-hidden="true"></a>          <span class="dt">&quot;type&quot;</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb28-17"><a href="#cb28-17" aria-hidden="true"></a>            <span class="dt">&quot;numeric&quot;</span><span class="fu">:</span> <span class="kw">true</span></span>
<span id="cb28-18"><a href="#cb28-18" aria-hidden="true"></a>          <span class="fu">}</span></span>
<span id="cb28-19"><a href="#cb28-19" aria-hidden="true"></a>        <span class="fu">}</span></span>
<span id="cb28-20"><a href="#cb28-20" aria-hidden="true"></a>      <span class="fu">}</span></span>
<span id="cb28-21"><a href="#cb28-21" aria-hidden="true"></a>    <span class="fu">}</span><span class="er">,</span></span>
<span id="cb28-22"><a href="#cb28-22" aria-hidden="true"></a>    <span class="er">......</span></span>
<span id="cb28-23"><a href="#cb28-23" aria-hidden="true"></a>  <span class="er">}</span></span></code></pre>
            </div>
            <p>
              You want to restrict the choice of the line width, say for example
              it must lie between 2 and 8. Then you have to modify the file
              <strong><em>src/visual.ts</em></strong
              >. Firstly, you have to add this import:
            </p>
            <div class="sourceCode" id="cb29">
              <pre
                class="sourceCode ts"
              ><code class="sourceCode typescript"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true"></a><span class="im">import</span> VisualObjectInstanceEnumeration <span class="op">=</span> powerbi<span class="op">.</span><span class="at">VisualObjectInstanceEnumeration</span><span class="op">;</span></span></code></pre>
            </div>
            <p>
              (add it in the block of imports at the beginning of the file).
              Secondly, you have to replace the function
              <code>enumerateObjectInstances</code> defined at the end with:
            </p>
            <div class="sourceCode" id="cb30">
              <pre
                class="sourceCode ts"
              ><code class="sourceCode typescript"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true"></a>public <span class="fu">enumerateObjectInstances</span>(</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true"></a>  options<span class="op">:</span> EnumerateVisualObjectInstancesOptions</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true"></a>)<span class="op">:</span> VisualObjectInstanceEnumeration {</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true"></a>  var enumeratedObjects<span class="op">:</span> VisualObjectInstanceEnumerationObject <span class="op">=</span> <span class="op">&lt;</span></span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true"></a>    VisualObjectInstanceEnumerationObject</span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true"></a>  <span class="op">&gt;</span>VisualSettings<span class="op">.</span><span class="fu">enumerateObjectInstances</span>(</span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true"></a>    this<span class="op">.</span><span class="at">settings</span> <span class="op">||</span> VisualSettings<span class="op">.</span><span class="fu">getDefault</span>()<span class="op">,</span> options</span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true"></a>  )<span class="op">;</span></span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true"></a></span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true"></a>  <span class="fu">if</span> (options<span class="op">.</span><span class="at">objectName</span> <span class="op">===</span> <span class="st">&quot;regressionline&quot;</span>) {</span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true"></a>    enumeratedObjects<span class="op">.</span><span class="at">instances</span>[<span class="dv">0</span>]<span class="op">.</span><span class="at">validValues</span> <span class="op">=</span> {</span>
<span id="cb30-12"><a href="#cb30-12" aria-hidden="true"></a>      LineWidth<span class="op">:</span> { numberRange<span class="op">:</span> { min<span class="op">:</span> <span class="dv">2</span><span class="op">,</span> max<span class="op">:</span> <span class="dv">8</span> } }</span>
<span id="cb30-13"><a href="#cb30-13" aria-hidden="true"></a>    }<span class="op">;</span></span>
<span id="cb30-14"><a href="#cb30-14" aria-hidden="true"></a>  }</span>
<span id="cb30-15"><a href="#cb30-15" aria-hidden="true"></a></span>
<span id="cb30-16"><a href="#cb30-16" aria-hidden="true"></a>  return enumeratedObjects<span class="op">;</span></span>
<span id="cb30-17"><a href="#cb30-17" aria-hidden="true"></a>}</span></code></pre>
            </div>
          </div>

          <div id="footer">
            Site proudly generated by
            <a href="http://jaspervdj.be/hakyll">Hakyll</a>
          </div>
        </div>
      </div>

      <div class="row">
        <div class="col-sm-12">
          <div id="disqus_thread"></div>
          <div class="pagination">
            <ul>
              <li>
                <a href="http://laustep.github.io/stlahblog/">« Back Home</a>
              </li>
            </ul>
          </div>
        </div>
      </div>
    </div>
  </body>

  <script src="../libraries/bootstrap/bootstrap.min.js"></script>
  <script>
    var disqus_developer = 1;
    var disqus_shortname = "stlapblog";
    // required: replace example with your forum shortname
    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function () {
      var dsq = document.createElement("script");
      dsq.type = "text/javascript";
      dsq.async = true;
      dsq.src = "https://" + disqus_shortname + ".disqus.com/embed.js";
      (
        document.getElementsByTagName("head")[0] ||
        document.getElementsByTagName("body")[0]
      ).appendChild(dsq);
    })();
  </script>
  <noscript
    >Please enable JavaScript to view the
    <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a>
  </noscript>
  <!-- MathJax: Fall back to local if CDN offline but local image fonts are not supported (saves >100MB) -->
  <script
    type="text/x-mathjax-config"
    src="../libraries/mathjax/config/TeX-MML-AM_CHTML.js"
  ></script>
  <!-- <script>
  window.MathJax || document.write('<script type="text/x-mathjax-config">MathJax.Hub.Config({"HTML-CSS":{imageFont:null}});<\/script><script src="../libraries/mathjax/MathJax.js"><\/script>');
</script> -->
</html>
