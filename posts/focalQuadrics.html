<!DOCTYPE HTML>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Saturn Elephant - Focal quadrics and their lines of curvature</title>
  <link href="../libraries/bootstrap/bootstrap-grid.min.css" rel="stylesheet">
  <link rel="stylesheet" href="../css/default2.css" />
  <link rel="stylesheet" href="../css/post.css" />
  <link rel="stylesheet" href="../css/misc.css" /> 
  
    <link rel="stylesheet" href="../css/pandoc-solarized.css" /> 
   
  
  <link href="https://fonts.googleapis.com/css?family=Raleway:400,600,200,800" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/css?family=Droid+Sans" rel="stylesheet" type="text/css">
  <script src="../libraries/jquery.min.js"></script>
  <script type="text/javascript" async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML"></script>
</head>

<body>
  <div class="container-fluid">
    <div class="row">
      <!-- Sidebar. -->
      <div class="sidebar col-sm-2">
        <div class="row">
          <div class="col-sm-12" style="float:right;clear:both;margin-right:50px;margin-top:50px;">
            <a href="https://www.r-bloggers.com/">
              <img src="../images/Rbloggers.png" alt="Rbloggers" width="100%" />
            </a>
            <br />
            <a href="http://t-redactyl.io/">
              <span style="color:black;font-weight:bold;font-family:sans-serif;font-size:26px;">Standard error</span>
            </a>
            <a href="http://timelyportfolio.blogspot.be/">
              <span style="color:grey;font-weight:bold;font-family:sans-serif;font-size:24px;">Timely portfolio</span>
            </a>
            <br />
            <a href="https://antoineguillot.wordpress.com/blog/">
              <span style="color:white;background-color:darkblue;font-weight:bold;font-family:sans-serif;font-size:22px;border:5px solid;border-color:darkblue">ENHANCE DATA</span>
            </a>
            <br />
            <a href="https://fronkonstin.com/">
              <span style="color:black;background-color:gold;font-weight:bold;font-size:29px;border:3px solid;border-color:gold;">Fronkonstin</span>
            </a>
          </div>
        </div>
        <div id="logos">
          <div class="row">
            <div class="col-sm-4">
              <img src="../images/AsymptoteLogo.svg" style="width: 150%; transform: rotateZ(-35deg)" />
            </div>
            <div class="col-sm-4">
              <img src="../images/Rlogo.svg" style="width: 110%;" />
            </div>
            <div class="col-sm-4">
              <img src="../images/shiny-hex.png" style="width: 90%;" />
            </div>
          </div>
          <div class="row">
            <div class="col-sm-4">
              <img src="../images/Povray_logo_sphere.png" style="width: 105%;" />
            </div>
            <div class="col-sm-4">
              <img src="../images/javascript.svg" style="width: 90%;" />
            </div>
            <div class="col-sm-4">
              <img src="../images/haskell.svg" style="width: 110%;" />
            </div>
          </div>
        </div>
      </div>

      <div class="main col-sm-10">
        <div id="header">
          <div id="logo">
            <a href="../">
              <img src="../images/stla.jpg" alt="stla" width="100px" />
            </a>
          </div>
          <div id="navigation" style="margin-top:50px;">
            <a href="../">Home</a>
            <a href="../about.html">About</a>
            <a href="../contact.html">Contact</a>
            <a href="../archive.html">Archive</a>
          </div>
        </div>

        <div class="content">
          <h1>Focal quadrics and their lines of curvature</h1> 
          <div class="info">
    Posted on May  3, 2020
    
        by St√©phane Laurent
    
</div>
<div class="info">
    
    Tags: <a title="All pages tagged 'R'." href="../tags/R.html">R</a>, <a title="All pages tagged 'graphics'." href="../tags/graphics.html">graphics</a>, <a title="All pages tagged 'rgl'." href="../tags/rgl.html">rgl</a>, <a title="All pages tagged 'geometry'." href="../tags/geometry.html">geometry</a>, <a title="All pages tagged 'maths'." href="../tags/maths.html">maths</a>
    
</div>

<p>This blog post provides some R code for drawing focal quadrics and their curvatures lines with the <code>rgl</code> package.</p>
<h1 id="ellipsoid">Ellipsoid</h1>
<p>The <code>ellipsoidMesh</code> function below generates a mesh of the ellipsoid of equation <span class="math display">\[
\frac{x^2}{a^2} + \frac{y^2}{b^2} + \frac{z^2}{c^2} = 1.
\]</span></p>
<div class="sourceCode" id="cb1"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a><span class="kw">library</span>(rgl)</span>
<span id="cb1-2"><a href="#cb1-2"></a>ellipsoidMesh &lt;-<span class="st"> </span><span class="cf">function</span>(a, b, c, <span class="dt">smoothness =</span> <span class="dv">5</span>){</span>
<span id="cb1-3"><a href="#cb1-3"></a>  <span class="kw">stopifnot</span>(a <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>, b <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>, c <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>)</span>
<span id="cb1-4"><a href="#cb1-4"></a>  sphere &lt;-<span class="st"> </span><span class="kw">subdivision3d</span>(<span class="kw">icosahedron3d</span>(), <span class="dt">depth =</span> smoothness)</span>
<span id="cb1-5"><a href="#cb1-5"></a>  sphere<span class="op">$</span>vb[4L,] &lt;-<span class="st"> </span></span>
<span id="cb1-6"><a href="#cb1-6"></a><span class="st">    </span><span class="kw">apply</span>(sphere<span class="op">$</span>vb[1L<span class="op">:</span>3L,], 2L, <span class="cf">function</span>(x) <span class="kw">sqrt</span>(<span class="kw">sum</span>(x<span class="op">*</span>x)))</span>
<span id="cb1-7"><a href="#cb1-7"></a>  sphere<span class="op">$</span>normals &lt;-<span class="st"> </span>sphere<span class="op">$</span>vb</span>
<span id="cb1-8"><a href="#cb1-8"></a>  <span class="kw">scale3d</span>(sphere, a, b, c)</span>
<span id="cb1-9"><a href="#cb1-9"></a>}</span></code></pre></div>
<p>The curvature lines of this ellipsoid are generated by the function <code>curvatureLinesE</code> given below. There are two families of curvature lines. The arguments <code>nu</code> and <code>nv</code> control the numbers of curvature lines in these two families. When the ellipsoid is tri-axial, <em>i.e.</em> when <span class="math inline">\(a\)</span>, <span class="math inline">\(b\)</span>, <span class="math inline">\(c\)</span> are distinct, the arguments <code>du</code> and <code>dv</code> must be positive and they control the size of the smallest curvature lines (if they were <span class="math inline">\(0\)</span>, the smallest curvature lines would degenerate to segments). When the ellipsoid is an ellipsoid of revolution, <em>i.e.</em> when two values of <span class="math inline">\(a\)</span>, <span class="math inline">\(b\)</span>, <span class="math inline">\(c\)</span> are equal, the curvature lines are the meridians and the parallels; in this case, <code>du</code> is ignored, and <code>dv</code>, which must be positive and strictly smaller than <span class="math inline">\(\frac{\pi}{2}\)</span>, control the size of the smallest parallel.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1"></a>curvatureLinesE &lt;-<span class="st"> </span><span class="cf">function</span>(a, b, c, nu, nv, du, dv, <span class="dt">npoints =</span> <span class="dv">100</span>){</span>
<span id="cb2-2"><a href="#cb2-2"></a>  <span class="kw">stopifnot</span>(a <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>, b <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>, c <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>)</span>
<span id="cb2-3"><a href="#cb2-3"></a>  <span class="cf">if</span>((a <span class="op">!=</span><span class="st"> </span>b <span class="op">&amp;&amp;</span><span class="st"> </span>b <span class="op">!=</span><span class="st"> </span>c) <span class="op">&amp;&amp;</span><span class="st"> </span>(a <span class="op">&lt;</span><span class="st"> </span>b <span class="op">||</span><span class="st"> </span>b <span class="op">&lt;</span><span class="st"> </span>c)){</span>
<span id="cb2-4"><a href="#cb2-4"></a>    perm &lt;-<span class="st"> </span><span class="kw">order</span>(<span class="kw">c</span>(a,b,c), <span class="dt">decreasing =</span> <span class="ot">TRUE</span>)</span>
<span id="cb2-5"><a href="#cb2-5"></a>    abc &lt;-<span class="st"> </span><span class="kw">c</span>(a,b,c)[perm]</span>
<span id="cb2-6"><a href="#cb2-6"></a>    clines &lt;-<span class="st"> </span></span>
<span id="cb2-7"><a href="#cb2-7"></a><span class="st">      </span><span class="kw">curvatureLinesE</span>(abc[1L], abc[2L], abc[3L], nu, nv, du, dv, npoints)</span>
<span id="cb2-8"><a href="#cb2-8"></a>    <span class="kw">return</span>(<span class="kw">lapply</span>(clines, <span class="cf">function</span>(l) l[, perm]))</span>
<span id="cb2-9"><a href="#cb2-9"></a>  }</span>
<span id="cb2-10"><a href="#cb2-10"></a>  <span class="cf">if</span>(a <span class="op">!=</span><span class="st"> </span>b <span class="op">&amp;&amp;</span><span class="st"> </span>b <span class="op">!=</span><span class="st"> </span>c){</span>
<span id="cb2-11"><a href="#cb2-11"></a>    <span class="kw">stopifnot</span>(du <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>, dv <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>)</span>
<span id="cb2-12"><a href="#cb2-12"></a>    a2 &lt;-<span class="st"> </span>a<span class="op">^</span><span class="dv">2</span>; b2 &lt;-<span class="st"> </span>b<span class="op">^</span><span class="dv">2</span>; c2 &lt;-<span class="st"> </span>c<span class="op">^</span><span class="dv">2</span></span>
<span id="cb2-13"><a href="#cb2-13"></a>    h2ab &lt;-<span class="st"> </span>a2 <span class="op">-</span><span class="st"> </span>b2; h2ac &lt;-<span class="st"> </span>a2 <span class="op">-</span><span class="st"> </span>c2; h2bc &lt;-<span class="st"> </span>b2 <span class="op">-</span><span class="st"> </span>c2</span>
<span id="cb2-14"><a href="#cb2-14"></a>    <span class="cf">if</span>(du <span class="op">&gt;=</span><span class="st"> </span>h2ab) <span class="kw">stop</span>(<span class="st">&quot;`du` is too large.&quot;</span>)</span>
<span id="cb2-15"><a href="#cb2-15"></a>    <span class="cf">if</span>(dv <span class="op">&gt;=</span><span class="st"> </span>h2bc) <span class="kw">stop</span>(<span class="st">&quot;`dv` is too large.&quot;</span>)</span>
<span id="cb2-16"><a href="#cb2-16"></a>    out &lt;-<span class="st"> </span><span class="kw">vector</span>(<span class="st">&quot;list&quot;</span>, <span class="dv">2</span><span class="op">*</span>nv<span class="dv">-1</span> <span class="op">+</span><span class="st"> </span><span class="dv">2</span><span class="op">*</span>nu<span class="dv">-1</span>)</span>
<span id="cb2-17"><a href="#cb2-17"></a>    u_ &lt;-<span class="st"> </span><span class="kw">seq</span>(b2<span class="op">+</span>du, a2, <span class="dt">length.out =</span> nu)</span>
<span id="cb2-18"><a href="#cb2-18"></a>    s_ &lt;-<span class="st"> </span><span class="kw">seq</span>(b2, a2, <span class="dt">length.out =</span> npoints)</span>
<span id="cb2-19"><a href="#cb2-19"></a>    v_ &lt;-<span class="st"> </span><span class="kw">seq</span>(c2, b2<span class="op">-</span>dv, <span class="dt">length.out =</span> nv) </span>
<span id="cb2-20"><a href="#cb2-20"></a>    t_ &lt;-<span class="st"> </span><span class="kw">seq</span>(c2, b2, <span class="dt">length.out =</span> npoints)</span>
<span id="cb2-21"><a href="#cb2-21"></a>    mx &lt;-<span class="st"> </span>a <span class="op">/</span><span class="st"> </span><span class="kw">sqrt</span>(h2ac<span class="op">*</span>h2ab)</span>
<span id="cb2-22"><a href="#cb2-22"></a>    my &lt;-<span class="st"> </span>b <span class="op">/</span><span class="st"> </span><span class="kw">sqrt</span>(h2bc<span class="op">*</span>h2ab)</span>
<span id="cb2-23"><a href="#cb2-23"></a>    mz &lt;-<span class="st"> </span>c <span class="op">/</span><span class="st"> </span><span class="kw">sqrt</span>(h2bc<span class="op">*</span>h2ac)</span>
<span id="cb2-24"><a href="#cb2-24"></a>    <span class="cf">for</span>(j <span class="cf">in</span> 1L<span class="op">:</span>nv){</span>
<span id="cb2-25"><a href="#cb2-25"></a>      x &lt;-<span class="st"> </span>mx <span class="op">*</span><span class="st"> </span><span class="kw">sqrt</span>((a2<span class="op">-</span>s_)<span class="op">*</span>(a2<span class="op">-</span>v_[j]))</span>
<span id="cb2-26"><a href="#cb2-26"></a>      y &lt;-<span class="st"> </span>my <span class="op">*</span><span class="st"> </span><span class="kw">sqrt</span>((s_<span class="op">-</span>b2)<span class="op">*</span>(b2<span class="op">-</span>v_[j]))</span>
<span id="cb2-27"><a href="#cb2-27"></a>      z &lt;-<span class="st"> </span>mz <span class="op">*</span><span class="st"> </span><span class="kw">sqrt</span>((s_<span class="op">-</span>c2)<span class="op">*</span>(v_[j]<span class="op">-</span>c2))</span>
<span id="cb2-28"><a href="#cb2-28"></a>      M &lt;-<span class="st"> </span><span class="kw">rbind</span>(<span class="kw">cbind</span>(x, y, z), <span class="kw">cbind</span>(<span class="op">-</span>x, y, z)[(npoints<span class="dv">-1</span>)<span class="op">:</span>1L,])</span>
<span id="cb2-29"><a href="#cb2-29"></a>      M &lt;-<span class="st"> </span><span class="kw">rbind</span>(M, <span class="kw">cbind</span>(M[,1L], <span class="op">-</span>M[,2L], M[,3L])[(<span class="dv">2</span><span class="op">*</span>npoints<span class="dv">-2</span>)<span class="op">:</span>1L,])</span>
<span id="cb2-30"><a href="#cb2-30"></a>      out[[j]] &lt;-<span class="st"> </span>M</span>
<span id="cb2-31"><a href="#cb2-31"></a>      <span class="cf">if</span>(j <span class="op">&gt;</span><span class="st"> </span>1L){</span>
<span id="cb2-32"><a href="#cb2-32"></a>        out[[nv<span class="op">+</span>j<span class="dv">-1</span>]] &lt;-<span class="st"> </span><span class="kw">cbind</span>(M[,<span class="kw">c</span>(1L,2L)], <span class="op">-</span>M[,3L])</span>
<span id="cb2-33"><a href="#cb2-33"></a>      }</span>
<span id="cb2-34"><a href="#cb2-34"></a>    }</span>
<span id="cb2-35"><a href="#cb2-35"></a>    <span class="cf">for</span>(i <span class="cf">in</span> 1L<span class="op">:</span>nu){</span>
<span id="cb2-36"><a href="#cb2-36"></a>      x &lt;-<span class="st"> </span>mx <span class="op">*</span><span class="st"> </span><span class="kw">sqrt</span>((a2<span class="op">-</span>u_[i])<span class="op">*</span>(a2<span class="op">-</span>t_))</span>
<span id="cb2-37"><a href="#cb2-37"></a>      y &lt;-<span class="st"> </span>my <span class="op">*</span><span class="st"> </span><span class="kw">sqrt</span>((u_[i]<span class="op">-</span>b2)<span class="op">*</span>(b2<span class="op">-</span>t_))</span>
<span id="cb2-38"><a href="#cb2-38"></a>      z &lt;-<span class="st"> </span>mz <span class="op">*</span><span class="st"> </span><span class="kw">sqrt</span>((u_[i]<span class="op">-</span>c2)<span class="op">*</span>(t_<span class="op">-</span>c2))</span>
<span id="cb2-39"><a href="#cb2-39"></a>      M &lt;-<span class="st"> </span><span class="kw">rbind</span>(<span class="kw">cbind</span>(x, y, z), <span class="kw">cbind</span>(x, <span class="op">-</span>y, z)[(npoints<span class="dv">-1</span>)<span class="op">:</span>1L,])</span>
<span id="cb2-40"><a href="#cb2-40"></a>      M &lt;-<span class="st"> </span><span class="kw">rbind</span>(M, <span class="kw">cbind</span>(M[,<span class="kw">c</span>(1L,2L)], <span class="op">-</span>M[,3L])[(<span class="dv">2</span><span class="op">*</span>npoints<span class="dv">-2</span>)<span class="op">:</span>1L,])</span>
<span id="cb2-41"><a href="#cb2-41"></a>      out[[<span class="dv">2</span><span class="op">*</span>nv<span class="dv">-1</span><span class="op">+</span>i]] &lt;-<span class="st"> </span>M</span>
<span id="cb2-42"><a href="#cb2-42"></a>      <span class="cf">if</span>(i <span class="op">&lt;</span><span class="st"> </span>nu){</span>
<span id="cb2-43"><a href="#cb2-43"></a>        out[[<span class="dv">2</span><span class="op">*</span>nv<span class="dv">-1</span><span class="op">+</span>nu<span class="op">+</span>i]] &lt;-<span class="st"> </span><span class="kw">cbind</span>(<span class="op">-</span>M[,1L], M[,<span class="kw">c</span>(2L,3L)])</span>
<span id="cb2-44"><a href="#cb2-44"></a>      }</span>
<span id="cb2-45"><a href="#cb2-45"></a>    }</span>
<span id="cb2-46"><a href="#cb2-46"></a>  }<span class="cf">else</span>{ <span class="co"># a == b || b == c </span></span>
<span id="cb2-47"><a href="#cb2-47"></a>    <span class="co"># surface of revolution =&gt; curvature lines are meridians and parallels</span></span>
<span id="cb2-48"><a href="#cb2-48"></a>    <span class="kw">stopifnot</span>(dv <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>, dv <span class="op">&lt;</span><span class="st"> </span>pi<span class="op">/</span><span class="dv">2</span>)</span>
<span id="cb2-49"><a href="#cb2-49"></a>    out &lt;-<span class="st"> </span><span class="kw">vector</span>(<span class="st">&quot;list&quot;</span>, nu <span class="op">+</span><span class="st"> </span>nv)</span>
<span id="cb2-50"><a href="#cb2-50"></a>    u_ &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="dv">0</span>, <span class="dv">2</span><span class="op">*</span>pi, <span class="dt">length.out =</span> nu<span class="op">+</span><span class="dv">1</span>)[<span class="op">-</span>1L]</span>
<span id="cb2-51"><a href="#cb2-51"></a>    s_ &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="dv">0</span>, <span class="dv">2</span><span class="op">*</span>pi, <span class="dt">length.out =</span> npoints)</span>
<span id="cb2-52"><a href="#cb2-52"></a>    v_ &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="op">-</span>pi<span class="op">/</span><span class="dv">2</span><span class="op">+</span>dv, pi<span class="op">/</span><span class="dv">2</span><span class="op">-</span>dv, <span class="dt">length.out =</span> nv) </span>
<span id="cb2-53"><a href="#cb2-53"></a>    t_ &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="op">-</span>pi, pi, <span class="dt">length.out =</span> npoints)</span>
<span id="cb2-54"><a href="#cb2-54"></a>    coss_ &lt;-<span class="st"> </span><span class="kw">cos</span>(s_); sins_ &lt;-<span class="st"> </span><span class="kw">sin</span>(s_)</span>
<span id="cb2-55"><a href="#cb2-55"></a>    cost_ &lt;-<span class="st"> </span><span class="kw">cos</span>(t_); sint_ &lt;-<span class="st"> </span><span class="kw">sin</span>(t_)</span>
<span id="cb2-56"><a href="#cb2-56"></a>    <span class="cf">for</span>(j <span class="cf">in</span> 1L<span class="op">:</span>nv){</span>
<span id="cb2-57"><a href="#cb2-57"></a>      x &lt;-<span class="st"> </span>a <span class="op">*</span><span class="st"> </span>coss_ <span class="op">*</span><span class="st"> </span><span class="kw">cos</span>(v_[j])</span>
<span id="cb2-58"><a href="#cb2-58"></a>      y &lt;-<span class="st"> </span>b <span class="op">*</span><span class="st"> </span>sins_ <span class="op">*</span><span class="st"> </span><span class="kw">cos</span>(v_[j])</span>
<span id="cb2-59"><a href="#cb2-59"></a>      z &lt;-<span class="st"> </span>c <span class="op">*</span><span class="st"> </span><span class="kw">sin</span>(v_[j])</span>
<span id="cb2-60"><a href="#cb2-60"></a>      out[[j]] &lt;-<span class="st"> </span><span class="kw">cbind</span>(x, y, z)</span>
<span id="cb2-61"><a href="#cb2-61"></a>    }</span>
<span id="cb2-62"><a href="#cb2-62"></a>    <span class="cf">for</span>(i <span class="cf">in</span> 1L<span class="op">:</span>nu){</span>
<span id="cb2-63"><a href="#cb2-63"></a>      x &lt;-<span class="st"> </span>a <span class="op">*</span><span class="st"> </span><span class="kw">cos</span>(u_[i]) <span class="op">*</span><span class="st"> </span>cost_</span>
<span id="cb2-64"><a href="#cb2-64"></a>      y &lt;-<span class="st"> </span>b <span class="op">*</span><span class="st"> </span><span class="kw">sin</span>(u_[i]) <span class="op">*</span><span class="st"> </span>cost_</span>
<span id="cb2-65"><a href="#cb2-65"></a>      z &lt;-<span class="st"> </span>c <span class="op">*</span><span class="st"> </span>sint_</span>
<span id="cb2-66"><a href="#cb2-66"></a>      out[[nv<span class="op">+</span>i]] &lt;-<span class="st"> </span><span class="kw">cbind</span>(x, y, z)</span>
<span id="cb2-67"><a href="#cb2-67"></a>    }</span>
<span id="cb2-68"><a href="#cb2-68"></a>  }</span>
<span id="cb2-69"><a href="#cb2-69"></a>  out</span>
<span id="cb2-70"><a href="#cb2-70"></a>}</span></code></pre></div>
<p>Here is an example:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a>a =<span class="st"> </span><span class="dv">7</span>; b =<span class="st"> </span><span class="dv">5</span>; c =<span class="st"> </span><span class="dv">3</span></span>
<span id="cb3-2"><a href="#cb3-2"></a>mesh &lt;-<span class="st"> </span><span class="kw">ellipsoidMesh</span>(a, b, c)</span>
<span id="cb3-3"><a href="#cb3-3"></a>clines &lt;-<span class="st"> </span><span class="kw">curvatureLinesE</span>(a, b, c, <span class="dt">nu =</span> <span class="dv">5</span>, <span class="dt">nv =</span> <span class="dv">5</span>, <span class="dt">du =</span> <span class="fl">0.4</span>, <span class="dt">dv =</span> <span class="dv">1</span>, </span>
<span id="cb3-4"><a href="#cb3-4"></a>                          <span class="dt">npoints =</span> <span class="dv">300</span>)</span>
<span id="cb3-5"><a href="#cb3-5"></a><span class="kw">shade3d</span>(mesh, <span class="dt">col =</span> <span class="st">&quot;springgreen&quot;</span>)</span>
<span id="cb3-6"><a href="#cb3-6"></a><span class="kw">invisible</span>(<span class="kw">lapply</span>(clines, <span class="cf">function</span>(l){</span>
<span id="cb3-7"><a href="#cb3-7"></a>  <span class="kw">shade3d</span>(<span class="kw">cylinder3d</span>(l, <span class="dt">radius =</span> <span class="fl">0.08</span>, <span class="dt">sides =</span> <span class="dv">30</span>))</span>
<span id="cb3-8"><a href="#cb3-8"></a>}))</span></code></pre></div>
<p><img src="figures/quadrics_E.png" /></p>
<h1 id="one-sheeted-hyperboloid">One-sheeted hyperboloid</h1>
<p>There are three types of one-sheeted hyperboloids, corresponding to these equations: <span class="math display">\[
\frac{x^2}{a^2} + \frac{y^2}{b^2} - \frac{z^2}{c^2} = 1 \\
\frac{x^2}{a^2} - \frac{y^2}{b^2} + \frac{z^2}{c^2} = 1 \\
-\frac{x^2}{a^2} + \frac{y^2}{b^2} + \frac{z^2}{c^2} = 1.
\]</span> The <code>hyperboloidMesh</code> function below generates a mesh of the one-sheeted hyperboloid; the <code>signature</code> argument corresponds to one of the above equations, it must be <code>"++-"</code>, <code>"+-+"</code> or <code>"-++"</code>. The mesh is made of quadrilaterals and their number is controlled by the arguments <code>nu</code> and <code>nv</code>. The hyperboloid is infinite along the direction corresponding to the minus sign, and the argument <code>vmin</code> controls the truncation of the hyperboloid in this direction.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1"></a>hyperboloidMesh &lt;-<span class="st"> </span><span class="cf">function</span>(a, b, c, signature, nu, nv, vmin){</span>
<span id="cb4-2"><a href="#cb4-2"></a>  <span class="kw">stopifnot</span>(signature <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;++-&quot;</span>, <span class="st">&quot;+-+&quot;</span>, <span class="st">&quot;-++&quot;</span>))</span>
<span id="cb4-3"><a href="#cb4-3"></a>  <span class="kw">stopifnot</span>(vmin <span class="op">&lt;</span><span class="st"> </span><span class="dv">1</span>, a <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>, b <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>, c <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>)</span>
<span id="cb4-4"><a href="#cb4-4"></a>  <span class="cf">if</span>(signature <span class="op">==</span><span class="st"> &quot;+-+&quot;</span>){</span>
<span id="cb4-5"><a href="#cb4-5"></a>    mesh &lt;-<span class="st"> </span><span class="kw">hyperboloidMesh</span>(a, c, b, <span class="st">&quot;++-&quot;</span>, nu, nv, vmin)</span>
<span id="cb4-6"><a href="#cb4-6"></a>    mesh<span class="op">$</span>vb &lt;-<span class="st"> </span>mesh<span class="op">$</span>vb[<span class="kw">c</span>(1L,3L,2L,4L),]</span>
<span id="cb4-7"><a href="#cb4-7"></a>    mesh<span class="op">$</span>normals &lt;-<span class="st"> </span>mesh<span class="op">$</span>normals[<span class="kw">c</span>(1L,3L,2L),]</span>
<span id="cb4-8"><a href="#cb4-8"></a>    mesh<span class="op">$</span>ib &lt;-<span class="st"> </span>mesh<span class="op">$</span>ib[4L<span class="op">:</span>1L,]</span>
<span id="cb4-9"><a href="#cb4-9"></a>    <span class="kw">return</span>(mesh)</span>
<span id="cb4-10"><a href="#cb4-10"></a>  }<span class="cf">else</span> <span class="cf">if</span>(signature <span class="op">==</span><span class="st"> &quot;-++&quot;</span>){</span>
<span id="cb4-11"><a href="#cb4-11"></a>    mesh &lt;-<span class="st"> </span><span class="kw">hyperboloidMesh</span>(c, b, a, <span class="st">&quot;++-&quot;</span>, nu, nv, vmin)</span>
<span id="cb4-12"><a href="#cb4-12"></a>    mesh<span class="op">$</span>vb &lt;-<span class="st"> </span>mesh<span class="op">$</span>vb[<span class="kw">c</span>(3L,2L,1L,4L),]</span>
<span id="cb4-13"><a href="#cb4-13"></a>    mesh<span class="op">$</span>normals &lt;-<span class="st"> </span>mesh<span class="op">$</span>normals[<span class="kw">c</span>(3L,2L,1L),]</span>
<span id="cb4-14"><a href="#cb4-14"></a>    mesh<span class="op">$</span>ib &lt;-<span class="st"> </span>mesh<span class="op">$</span>ib[4L<span class="op">:</span>1L,]</span>
<span id="cb4-15"><a href="#cb4-15"></a>    <span class="kw">return</span>(mesh)</span>
<span id="cb4-16"><a href="#cb4-16"></a>  }</span>
<span id="cb4-17"><a href="#cb4-17"></a>  c0 &lt;-<span class="st"> </span>c</span>
<span id="cb4-18"><a href="#cb4-18"></a>  <span class="cf">if</span>(b <span class="op">&gt;</span><span class="st"> </span>a){</span>
<span id="cb4-19"><a href="#cb4-19"></a>    exchange &lt;-<span class="st"> </span><span class="ot">TRUE</span></span>
<span id="cb4-20"><a href="#cb4-20"></a>    a0 &lt;-<span class="st"> </span>b; b0 &lt;-<span class="st"> </span>a</span>
<span id="cb4-21"><a href="#cb4-21"></a>  }<span class="cf">else</span>{</span>
<span id="cb4-22"><a href="#cb4-22"></a>    exchange &lt;-<span class="st"> </span><span class="ot">FALSE</span></span>
<span id="cb4-23"><a href="#cb4-23"></a>    a0 &lt;-<span class="st"> </span>a; b0 &lt;-<span class="st"> </span>b</span>
<span id="cb4-24"><a href="#cb4-24"></a>  }</span>
<span id="cb4-25"><a href="#cb4-25"></a>  Mu2 &lt;-<span class="st"> </span>a0<span class="op">^</span><span class="dv">2</span></span>
<span id="cb4-26"><a href="#cb4-26"></a>  h2ab &lt;-<span class="st"> </span>Mu2 <span class="op">-</span><span class="st"> </span>b0<span class="op">^</span><span class="dv">2</span>; h2ac &lt;-<span class="st"> </span>c0<span class="op">^</span><span class="dv">2</span> <span class="op">+</span><span class="st"> </span>Mu2</span>
<span id="cb4-27"><a href="#cb4-27"></a>  c2 &lt;-<span class="st"> </span><span class="dv">1</span>; a2 &lt;-<span class="st"> </span>c2 <span class="op">+</span><span class="st"> </span>h2ac; b2 &lt;-<span class="st"> </span>a2 <span class="op">-</span><span class="st"> </span>h2ab</span>
<span id="cb4-28"><a href="#cb4-28"></a>  h2bc &lt;-<span class="st"> </span>b2 <span class="op">-</span><span class="st"> </span>c2</span>
<span id="cb4-29"><a href="#cb4-29"></a>  <span class="co">#</span></span>
<span id="cb4-30"><a href="#cb4-30"></a>  vertices &lt;-<span class="st"> </span>Normals &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="ot">NA_real_</span>, <span class="dt">nrow =</span> 3L, <span class="dt">ncol =</span> nu<span class="op">*</span>nv)</span>
<span id="cb4-31"><a href="#cb4-31"></a>  indices &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="ot">NA_integer_</span>, <span class="dt">nrow =</span> 4L, <span class="dt">ncol =</span> (nu<span class="dv">-1</span>)<span class="op">*</span>(nv<span class="dv">-1</span>))</span>
<span id="cb4-32"><a href="#cb4-32"></a>  v_ &lt;-<span class="st"> </span><span class="kw">seq</span>(vmin, c2, <span class="dt">length.out =</span> nv)</span>
<span id="cb4-33"><a href="#cb4-33"></a>  <span class="co">#</span></span>
<span id="cb4-34"><a href="#cb4-34"></a>  <span class="cf">if</span>(a0 <span class="op">!=</span><span class="st"> </span>b0){</span>
<span id="cb4-35"><a href="#cb4-35"></a>    u_ &lt;-<span class="st"> </span><span class="kw">seq</span>(b2, a2, <span class="dt">length.out =</span> nu)</span>
<span id="cb4-36"><a href="#cb4-36"></a>    x &lt;-<span class="st"> </span>a0 <span class="op">/</span><span class="st"> </span><span class="kw">sqrt</span>(h2ac<span class="op">*</span>h2ab) <span class="op">*</span><span class="st"> </span><span class="kw">sqrt</span>(a2<span class="op">-</span>u_)</span>
<span id="cb4-37"><a href="#cb4-37"></a>    y &lt;-<span class="st"> </span>b0 <span class="op">/</span><span class="st"> </span><span class="kw">sqrt</span>(h2bc<span class="op">*</span>h2ab) <span class="op">*</span><span class="st"> </span><span class="kw">sqrt</span>(u_<span class="op">-</span>b2)</span>
<span id="cb4-38"><a href="#cb4-38"></a>    z &lt;-<span class="st"> </span>c0 <span class="op">/</span><span class="st"> </span><span class="kw">sqrt</span>(h2bc<span class="op">*</span>h2ac) <span class="op">*</span><span class="st"> </span><span class="kw">sqrt</span>(u_<span class="op">-</span>c2)</span>
<span id="cb4-39"><a href="#cb4-39"></a>  }<span class="cf">else</span>{</span>
<span id="cb4-40"><a href="#cb4-40"></a>    u_ &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="dv">0</span>, <span class="dv">2</span><span class="op">*</span>pi, <span class="dt">length.out =</span> nu<span class="op">+</span><span class="dv">1</span>)[<span class="op">-</span>1L]</span>
<span id="cb4-41"><a href="#cb4-41"></a>    z &lt;-<span class="st"> </span><span class="kw">rep</span>(c0<span class="op">/</span><span class="kw">sqrt</span>(h2ac), nu)</span>
<span id="cb4-42"><a href="#cb4-42"></a>    mxy &lt;-<span class="st"> </span>a0 <span class="op">/</span><span class="st"> </span><span class="kw">sqrt</span>(h2ac)</span>
<span id="cb4-43"><a href="#cb4-43"></a>    x &lt;-<span class="st"> </span>mxy <span class="op">*</span><span class="st"> </span><span class="kw">cos</span>(u_)</span>
<span id="cb4-44"><a href="#cb4-44"></a>    y &lt;-<span class="st"> </span>mxy <span class="op">*</span><span class="st"> </span><span class="kw">sin</span>(u_)</span>
<span id="cb4-45"><a href="#cb4-45"></a>  }</span>
<span id="cb4-46"><a href="#cb4-46"></a>  <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>nu){</span>
<span id="cb4-47"><a href="#cb4-47"></a>    <span class="cf">for</span>(j <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>nv){</span>
<span id="cb4-48"><a href="#cb4-48"></a>      P &lt;-<span class="st"> </span>vertices[, (i<span class="dv">-1</span>)<span class="op">*</span>nv<span class="op">+</span>j] &lt;-<span class="st"> </span><span class="kw">c</span>(</span>
<span id="cb4-49"><a href="#cb4-49"></a>        x[i] <span class="op">*</span><span class="st"> </span><span class="kw">sqrt</span>(a2<span class="op">-</span>v_[j]),</span>
<span id="cb4-50"><a href="#cb4-50"></a>        y[i] <span class="op">*</span><span class="st"> </span><span class="kw">sqrt</span>(b2<span class="op">-</span>v_[j]),</span>
<span id="cb4-51"><a href="#cb4-51"></a>        z[i] <span class="op">*</span><span class="st"> </span><span class="kw">sqrt</span>(c2<span class="op">-</span>v_[j])</span>
<span id="cb4-52"><a href="#cb4-52"></a>      )</span>
<span id="cb4-53"><a href="#cb4-53"></a>      Normals[, (i<span class="dv">-1</span>)<span class="op">*</span>nv<span class="op">+</span>j] &lt;-<span class="st"> </span><span class="kw">c</span>(P[1L]<span class="op">/</span>a0<span class="op">^</span><span class="dv">2</span>, P[2L]<span class="op">/</span>b0<span class="op">^</span><span class="dv">2</span>, <span class="op">-</span>P[3L]<span class="op">/</span>c0<span class="op">^</span><span class="dv">2</span>)</span>
<span id="cb4-54"><a href="#cb4-54"></a>    }</span>
<span id="cb4-55"><a href="#cb4-55"></a>  }</span>
<span id="cb4-56"><a href="#cb4-56"></a>  <span class="co"># quads</span></span>
<span id="cb4-57"><a href="#cb4-57"></a>  <span class="cf">for</span>(i <span class="cf">in</span> 1L<span class="op">:</span>(nu<span class="dv">-1</span>)){</span>
<span id="cb4-58"><a href="#cb4-58"></a>    im1 &lt;-<span class="st"> </span>i<span class="op">-</span>1L</span>
<span id="cb4-59"><a href="#cb4-59"></a>    <span class="cf">for</span>(j <span class="cf">in</span> 1L<span class="op">:</span>(nv<span class="dv">-1</span>)){</span>
<span id="cb4-60"><a href="#cb4-60"></a>      jp1 &lt;-<span class="st"> </span>j<span class="op">+</span>1L</span>
<span id="cb4-61"><a href="#cb4-61"></a>      quad &lt;-<span class="st"> </span><span class="kw">c</span>(im1<span class="op">*</span>nv<span class="op">+</span>j, im1<span class="op">*</span>nv<span class="op">+</span>jp1, i<span class="op">*</span>nv<span class="op">+</span>jp1, i<span class="op">*</span>nv<span class="op">+</span>j)</span>
<span id="cb4-62"><a href="#cb4-62"></a>      indices[, im1<span class="op">*</span>(nv<span class="dv">-1</span>)<span class="op">+</span>j] &lt;-<span class="st"> </span><span class="cf">if</span>(exchange) <span class="kw">rev</span>(quad) <span class="cf">else</span> quad</span>
<span id="cb4-63"><a href="#cb4-63"></a>    }</span>
<span id="cb4-64"><a href="#cb4-64"></a>  }</span>
<span id="cb4-65"><a href="#cb4-65"></a>  vertices &lt;-<span class="st"> </span><span class="kw">cbind</span>(vertices, <span class="kw">c</span>(<span class="op">-</span><span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>) <span class="op">*</span><span class="st"> </span>vertices)</span>
<span id="cb4-66"><a href="#cb4-66"></a>  indices &lt;-<span class="st"> </span><span class="kw">cbind</span>(indices, indices[4L<span class="op">:</span>1L,] <span class="op">+</span><span class="st"> </span>nu<span class="op">*</span>nv)</span>
<span id="cb4-67"><a href="#cb4-67"></a>  Normals &lt;-<span class="st"> </span><span class="kw">cbind</span>(Normals, <span class="kw">c</span>(<span class="op">-</span><span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>) <span class="op">*</span><span class="st"> </span>Normals)</span>
<span id="cb4-68"><a href="#cb4-68"></a>  vertices &lt;-<span class="st"> </span><span class="kw">cbind</span>(vertices, <span class="kw">c</span>(<span class="dv">1</span>,<span class="op">-</span><span class="dv">1</span>,<span class="dv">1</span>) <span class="op">*</span><span class="st"> </span>vertices)</span>
<span id="cb4-69"><a href="#cb4-69"></a>  indices &lt;-<span class="st"> </span><span class="kw">cbind</span>(indices, indices[4L<span class="op">:</span>1L,] <span class="op">+</span><span class="st"> </span><span class="dv">2</span><span class="op">*</span>nu<span class="op">*</span>nv)</span>
<span id="cb4-70"><a href="#cb4-70"></a>  Normals &lt;-<span class="st"> </span><span class="kw">cbind</span>(Normals, <span class="kw">c</span>(<span class="dv">1</span>,<span class="op">-</span><span class="dv">1</span>,<span class="dv">1</span>) <span class="op">*</span><span class="st"> </span>Normals)</span>
<span id="cb4-71"><a href="#cb4-71"></a>  vertices &lt;-<span class="st"> </span><span class="kw">cbind</span>(vertices, <span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">1</span>,<span class="op">-</span><span class="dv">1</span>) <span class="op">*</span><span class="st"> </span>vertices)</span>
<span id="cb4-72"><a href="#cb4-72"></a>  indices &lt;-<span class="st"> </span><span class="kw">cbind</span>(indices, indices[4L<span class="op">:</span>1L,] <span class="op">+</span><span class="st"> </span><span class="dv">4</span><span class="op">*</span>nu<span class="op">*</span>nv)</span>
<span id="cb4-73"><a href="#cb4-73"></a>  Normals &lt;-<span class="st"> </span><span class="kw">cbind</span>(Normals, <span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">1</span>,<span class="op">-</span><span class="dv">1</span>) <span class="op">*</span><span class="st"> </span>Normals)</span>
<span id="cb4-74"><a href="#cb4-74"></a>  mesh &lt;-<span class="st"> </span><span class="kw">qmesh3d</span>(</span>
<span id="cb4-75"><a href="#cb4-75"></a>    <span class="dt">vertices =</span> <span class="cf">if</span>(exchange) vertices[<span class="kw">c</span>(2L,1L,3L),] <span class="cf">else</span> vertices,</span>
<span id="cb4-76"><a href="#cb4-76"></a>    <span class="dt">indices =</span> indices,</span>
<span id="cb4-77"><a href="#cb4-77"></a>    <span class="dt">homogeneous =</span> <span class="ot">FALSE</span>,</span>
<span id="cb4-78"><a href="#cb4-78"></a>    <span class="dt">normals =</span> <span class="kw">t</span>(<span class="cf">if</span>(exchange) Normals[<span class="kw">c</span>(2L,1L,3L),] <span class="cf">else</span> Normals)</span>
<span id="cb4-79"><a href="#cb4-79"></a>  )</span>
<span id="cb4-80"><a href="#cb4-80"></a>  mesh</span>
<span id="cb4-81"><a href="#cb4-81"></a>}</span></code></pre></div>
<p>The <code>curvatureLinesH1</code> function below generates some curvature lines of the one-sheeted hyperboloid. There are two families of curvature lines and the desired numbers of lines in them are controlled by the arguments <code>nu</code> and <code>nv</code>.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1"></a>curvatureLinesH1 &lt;-<span class="st"> </span><span class="cf">function</span>(a, b, c, <span class="dt">signature =</span> <span class="st">&quot;++-&quot;</span>, nu, nv, vmin,  </span>
<span id="cb5-2"><a href="#cb5-2"></a>                             <span class="dt">npoints =</span> <span class="dv">100</span>){</span>
<span id="cb5-3"><a href="#cb5-3"></a>  <span class="kw">stopifnot</span>(signature <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;++-&quot;</span>, <span class="st">&quot;+-+&quot;</span>, <span class="st">&quot;-++&quot;</span>))</span>
<span id="cb5-4"><a href="#cb5-4"></a>  <span class="kw">stopifnot</span>(vmin <span class="op">&lt;</span><span class="st"> </span><span class="dv">1</span>, a <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>, b <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>, c <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>)</span>
<span id="cb5-5"><a href="#cb5-5"></a>  <span class="cf">if</span>(signature <span class="op">==</span><span class="st"> &quot;+-+&quot;</span>){</span>
<span id="cb5-6"><a href="#cb5-6"></a>    clines &lt;-<span class="st"> </span><span class="kw">curvatureLinesH1</span>(a, c, b, <span class="st">&quot;++-&quot;</span>, nu, nv, vmin, npoints)</span>
<span id="cb5-7"><a href="#cb5-7"></a>    <span class="kw">return</span>(<span class="kw">lapply</span>(clines, <span class="cf">function</span>(l) l[,<span class="kw">c</span>(1L,3L,2L)]))</span>
<span id="cb5-8"><a href="#cb5-8"></a>  }<span class="cf">else</span> <span class="cf">if</span>(signature <span class="op">==</span><span class="st"> &quot;-++&quot;</span>){</span>
<span id="cb5-9"><a href="#cb5-9"></a>    clines &lt;-<span class="st"> </span><span class="kw">curvatureLinesH1</span>(c, b, a, <span class="st">&quot;++-&quot;</span>, nu, nv, vmin, npoints)</span>
<span id="cb5-10"><a href="#cb5-10"></a>    <span class="kw">return</span>(<span class="kw">lapply</span>(clines, <span class="cf">function</span>(l) l[,<span class="kw">c</span>(3L,2L,1L)]))</span>
<span id="cb5-11"><a href="#cb5-11"></a>  }</span>
<span id="cb5-12"><a href="#cb5-12"></a>  c0 &lt;-<span class="st"> </span>c</span>
<span id="cb5-13"><a href="#cb5-13"></a>  <span class="cf">if</span>(b <span class="op">&gt;</span><span class="st"> </span>a){</span>
<span id="cb5-14"><a href="#cb5-14"></a>    exchange &lt;-<span class="st"> </span><span class="ot">TRUE</span></span>
<span id="cb5-15"><a href="#cb5-15"></a>    a0 &lt;-<span class="st"> </span>b; b0 &lt;-<span class="st"> </span>a</span>
<span id="cb5-16"><a href="#cb5-16"></a>  }<span class="cf">else</span>{</span>
<span id="cb5-17"><a href="#cb5-17"></a>    exchange &lt;-<span class="st"> </span><span class="ot">FALSE</span></span>
<span id="cb5-18"><a href="#cb5-18"></a>    a0 &lt;-<span class="st"> </span>a; b0 &lt;-<span class="st"> </span>b</span>
<span id="cb5-19"><a href="#cb5-19"></a>  }</span>
<span id="cb5-20"><a href="#cb5-20"></a>  Mu2 &lt;-<span class="st"> </span>a0<span class="op">^</span><span class="dv">2</span></span>
<span id="cb5-21"><a href="#cb5-21"></a>  h2ab &lt;-<span class="st"> </span>Mu2 <span class="op">-</span><span class="st"> </span>b0<span class="op">^</span><span class="dv">2</span>; h2ac &lt;-<span class="st"> </span>c0<span class="op">^</span><span class="dv">2</span> <span class="op">+</span><span class="st"> </span>Mu2</span>
<span id="cb5-22"><a href="#cb5-22"></a>  c2 &lt;-<span class="st"> </span><span class="dv">1</span>; a2 &lt;-<span class="st"> </span>c2 <span class="op">+</span><span class="st"> </span>h2ac; b2 &lt;-<span class="st"> </span>a2 <span class="op">-</span><span class="st"> </span>h2ab</span>
<span id="cb5-23"><a href="#cb5-23"></a>  h2bc &lt;-<span class="st"> </span>b2 <span class="op">-</span><span class="st"> </span>c2</span>
<span id="cb5-24"><a href="#cb5-24"></a>  <span class="co">#  </span></span>
<span id="cb5-25"><a href="#cb5-25"></a>  v_ &lt;-<span class="st"> </span><span class="kw">seq</span>(vmin, c2, <span class="dt">length.out =</span> nv)</span>
<span id="cb5-26"><a href="#cb5-26"></a>  t_ &lt;-<span class="st"> </span><span class="kw">seq</span>(vmin, c2, <span class="dt">length.out =</span> npoints)</span>
<span id="cb5-27"><a href="#cb5-27"></a>  <span class="co">#</span></span>
<span id="cb5-28"><a href="#cb5-28"></a>  <span class="cf">if</span>(a0 <span class="op">!=</span><span class="st"> </span>b0){</span>
<span id="cb5-29"><a href="#cb5-29"></a>    u_ &lt;-<span class="st"> </span><span class="kw">seq</span>(b2, a2, <span class="dt">length.out =</span> nu)</span>
<span id="cb5-30"><a href="#cb5-30"></a>    s_ &lt;-<span class="st"> </span><span class="kw">seq</span>(b2, a2, <span class="dt">length.out =</span> npoints)</span>
<span id="cb5-31"><a href="#cb5-31"></a>    mx &lt;-<span class="st"> </span>a0 <span class="op">/</span><span class="st"> </span><span class="kw">sqrt</span>(h2ac<span class="op">*</span>h2ab)</span>
<span id="cb5-32"><a href="#cb5-32"></a>    my &lt;-<span class="st"> </span>b0 <span class="op">/</span><span class="st"> </span><span class="kw">sqrt</span>(h2bc<span class="op">*</span>h2ab)</span>
<span id="cb5-33"><a href="#cb5-33"></a>    mz &lt;-<span class="st"> </span>c0 <span class="op">/</span><span class="st"> </span><span class="kw">sqrt</span>(h2bc<span class="op">*</span>h2ac)</span>
<span id="cb5-34"><a href="#cb5-34"></a>    out &lt;-<span class="st"> </span><span class="kw">vector</span>(<span class="st">&quot;list&quot;</span>, <span class="dv">2</span><span class="op">*</span>nv <span class="op">+</span><span class="st"> </span><span class="dv">4</span><span class="op">*</span>nu <span class="op">-</span><span class="st"> </span><span class="dv">5</span>)</span>
<span id="cb5-35"><a href="#cb5-35"></a>    <span class="cf">for</span>(j <span class="cf">in</span> 1L<span class="op">:</span>nv){</span>
<span id="cb5-36"><a href="#cb5-36"></a>      x &lt;-<span class="st"> </span>mx <span class="op">*</span><span class="st"> </span><span class="kw">sqrt</span>((a2<span class="op">-</span>s_)<span class="op">*</span>(a2<span class="op">-</span>v_[j]))</span>
<span id="cb5-37"><a href="#cb5-37"></a>      y &lt;-<span class="st"> </span>my <span class="op">*</span><span class="st"> </span><span class="kw">sqrt</span>((s_<span class="op">-</span>b2)<span class="op">*</span>(b2<span class="op">-</span>v_[j]))</span>
<span id="cb5-38"><a href="#cb5-38"></a>      z &lt;-<span class="st"> </span>mz <span class="op">*</span><span class="st"> </span><span class="kw">sqrt</span>((s_<span class="op">-</span>c2)<span class="op">*</span>(c2<span class="op">-</span>v_[j]))</span>
<span id="cb5-39"><a href="#cb5-39"></a>      M &lt;-<span class="st"> </span><span class="kw">rbind</span>(<span class="kw">cbind</span>(x, y, z), <span class="kw">cbind</span>(<span class="op">-</span>x, y, z)[(npoints<span class="dv">-1</span>)<span class="op">:</span>1L,])</span>
<span id="cb5-40"><a href="#cb5-40"></a>      M &lt;-<span class="st"> </span><span class="kw">rbind</span>(M, <span class="kw">cbind</span>(M[,1L], <span class="op">-</span>M[,2L], M[,3L])[(<span class="dv">2</span><span class="op">*</span>npoints<span class="dv">-2</span>)<span class="op">:</span>1L,])</span>
<span id="cb5-41"><a href="#cb5-41"></a>      out[[j]] &lt;-<span class="st"> </span>M</span>
<span id="cb5-42"><a href="#cb5-42"></a>      <span class="cf">if</span>(j <span class="op">&lt;</span><span class="st"> </span>nv){</span>
<span id="cb5-43"><a href="#cb5-43"></a>        out[[nv<span class="op">+</span>j]] &lt;-<span class="st"> </span><span class="kw">cbind</span>(M[,<span class="kw">c</span>(1L,2L)], <span class="op">-</span>M[,3L])</span>
<span id="cb5-44"><a href="#cb5-44"></a>      }</span>
<span id="cb5-45"><a href="#cb5-45"></a>    }</span>
<span id="cb5-46"><a href="#cb5-46"></a>    <span class="cf">for</span>(i <span class="cf">in</span> 1L<span class="op">:</span>nu){</span>
<span id="cb5-47"><a href="#cb5-47"></a>      x &lt;-<span class="st"> </span>mx <span class="op">*</span><span class="st"> </span><span class="kw">sqrt</span>((a2<span class="op">-</span>u_[i])<span class="op">*</span>(a2<span class="op">-</span>t_))</span>
<span id="cb5-48"><a href="#cb5-48"></a>      y &lt;-<span class="st"> </span>my <span class="op">*</span><span class="st"> </span><span class="kw">sqrt</span>((u_[i]<span class="op">-</span>b2)<span class="op">*</span>(b2<span class="op">-</span>t_))</span>
<span id="cb5-49"><a href="#cb5-49"></a>      z &lt;-<span class="st"> </span>mz <span class="op">*</span><span class="st"> </span><span class="kw">sqrt</span>((u_[i]<span class="op">-</span>c2)<span class="op">*</span>(c2<span class="op">-</span>t_))</span>
<span id="cb5-50"><a href="#cb5-50"></a>      M &lt;-<span class="st"> </span><span class="kw">rbind</span>(<span class="kw">cbind</span>(x, y, z), <span class="kw">cbind</span>(x, y, <span class="op">-</span>z)[(npoints<span class="dv">-1</span>)<span class="op">:</span>1L,])</span>
<span id="cb5-51"><a href="#cb5-51"></a>      out[[<span class="dv">2</span><span class="op">*</span>nv<span class="dv">-1</span><span class="op">+</span>i]] &lt;-<span class="st"> </span>M</span>
<span id="cb5-52"><a href="#cb5-52"></a>      <span class="cf">if</span>(i <span class="op">&lt;</span><span class="st"> </span>nu){</span>
<span id="cb5-53"><a href="#cb5-53"></a>        out[[<span class="dv">2</span><span class="op">*</span>nv<span class="dv">-1</span><span class="op">+</span>nu<span class="op">+</span>i]] &lt;-<span class="st"> </span><span class="kw">cbind</span>(<span class="op">-</span>M[,1L], M[,<span class="kw">c</span>(2L,3L)])</span>
<span id="cb5-54"><a href="#cb5-54"></a>        <span class="cf">if</span>(i<span class="op">&gt;</span>1L) out[[<span class="dv">2</span><span class="op">*</span>nv<span class="op">+</span><span class="dv">3</span><span class="op">*</span>nu<span class="op">+</span>i<span class="dv">-4</span>]] &lt;-<span class="st"> </span><span class="kw">cbind</span>(<span class="op">-</span>M[,<span class="kw">c</span>(1L,2L)], M[,3L])</span>
<span id="cb5-55"><a href="#cb5-55"></a>      }</span>
<span id="cb5-56"><a href="#cb5-56"></a>      <span class="cf">if</span>(i <span class="op">&gt;</span><span class="st"> </span>1L){</span>
<span id="cb5-57"><a href="#cb5-57"></a>        out[[<span class="dv">2</span><span class="op">*</span>nv<span class="op">+</span><span class="dv">2</span><span class="op">*</span>nu<span class="op">+</span>i<span class="dv">-3</span>]] &lt;-<span class="st"> </span><span class="kw">cbind</span>(M[,1L], <span class="op">-</span>M[,2L], M[,3L])</span>
<span id="cb5-58"><a href="#cb5-58"></a>      }</span>
<span id="cb5-59"><a href="#cb5-59"></a>    }</span>
<span id="cb5-60"><a href="#cb5-60"></a>  }<span class="cf">else</span>{ <span class="co"># a0 = b0</span></span>
<span id="cb5-61"><a href="#cb5-61"></a>    u_ &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="dv">0</span>, <span class="dv">2</span><span class="op">*</span>pi, <span class="dt">length.out =</span> nu<span class="op">+</span><span class="dv">1</span>)[<span class="op">-</span>1L]</span>
<span id="cb5-62"><a href="#cb5-62"></a>    s_ &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="dv">0</span>, <span class="dv">2</span><span class="op">*</span>pi, <span class="dt">length.out =</span> npoints)</span>
<span id="cb5-63"><a href="#cb5-63"></a>    coss_ &lt;-<span class="st"> </span><span class="kw">cos</span>(s_); sins_ &lt;-<span class="st"> </span><span class="kw">sin</span>(s_)</span>
<span id="cb5-64"><a href="#cb5-64"></a>    mxy &lt;-<span class="st"> </span>a0 <span class="op">/</span><span class="st"> </span><span class="kw">sqrt</span>(h2ac)</span>
<span id="cb5-65"><a href="#cb5-65"></a>    mz &lt;-<span class="st"> </span>c0 <span class="op">/</span><span class="st"> </span><span class="kw">sqrt</span>(h2bc)</span>
<span id="cb5-66"><a href="#cb5-66"></a>    out &lt;-<span class="st"> </span><span class="kw">vector</span>(<span class="st">&quot;list&quot;</span>, <span class="dv">2</span><span class="op">*</span>nv <span class="op">+</span><span class="st"> </span><span class="dv">4</span><span class="op">*</span>nu <span class="op">-</span><span class="st"> </span><span class="dv">5</span>)</span>
<span id="cb5-67"><a href="#cb5-67"></a>    <span class="cf">for</span>(j <span class="cf">in</span> 1L<span class="op">:</span>nv){</span>
<span id="cb5-68"><a href="#cb5-68"></a>      x &lt;-<span class="st"> </span>mxy <span class="op">*</span><span class="st"> </span><span class="kw">sqrt</span>(a2<span class="op">-</span>v_[j]) <span class="op">*</span><span class="st"> </span>coss_</span>
<span id="cb5-69"><a href="#cb5-69"></a>      y &lt;-<span class="st"> </span>mxy <span class="op">*</span><span class="st"> </span><span class="kw">sqrt</span>(b2<span class="op">-</span>v_[j]) <span class="op">*</span><span class="st"> </span>sins_</span>
<span id="cb5-70"><a href="#cb5-70"></a>      z &lt;-<span class="st"> </span>mz <span class="op">*</span><span class="st"> </span><span class="kw">sqrt</span>(c2<span class="op">-</span>v_[j]) </span>
<span id="cb5-71"><a href="#cb5-71"></a>      M &lt;-<span class="st"> </span><span class="kw">cbind</span>(x, y, z)</span>
<span id="cb5-72"><a href="#cb5-72"></a>      out[[j]] &lt;-<span class="st"> </span>M</span>
<span id="cb5-73"><a href="#cb5-73"></a>      <span class="cf">if</span>(j <span class="op">&lt;</span><span class="st"> </span>nv){</span>
<span id="cb5-74"><a href="#cb5-74"></a>        out[[nv<span class="op">+</span>j]] &lt;-<span class="st"> </span><span class="kw">cbind</span>(M[,<span class="kw">c</span>(1L,2L)], <span class="op">-</span>M[,3L])</span>
<span id="cb5-75"><a href="#cb5-75"></a>      }</span>
<span id="cb5-76"><a href="#cb5-76"></a>    }</span>
<span id="cb5-77"><a href="#cb5-77"></a>    r &lt;-<span class="st"> </span>mxy <span class="op">*</span><span class="st"> </span><span class="kw">sqrt</span>(a2<span class="op">-</span>t_)</span>
<span id="cb5-78"><a href="#cb5-78"></a>    z &lt;-<span class="st"> </span>mz <span class="op">*</span><span class="st"> </span><span class="kw">sqrt</span>(c2<span class="op">-</span>t_)</span>
<span id="cb5-79"><a href="#cb5-79"></a>    <span class="cf">for</span>(i <span class="cf">in</span> 1L<span class="op">:</span>nu){</span>
<span id="cb5-80"><a href="#cb5-80"></a>      x &lt;-<span class="st"> </span>r <span class="op">*</span><span class="st"> </span><span class="kw">cos</span>(u_[i])</span>
<span id="cb5-81"><a href="#cb5-81"></a>      y &lt;-<span class="st"> </span>r <span class="op">*</span><span class="st"> </span><span class="kw">sin</span>(u_[i])</span>
<span id="cb5-82"><a href="#cb5-82"></a>      M &lt;-<span class="st"> </span><span class="kw">rbind</span>(<span class="kw">cbind</span>(x, y, z), <span class="kw">cbind</span>(x, y, <span class="op">-</span>z)[(npoints<span class="dv">-1</span>)<span class="op">:</span>1L,])</span>
<span id="cb5-83"><a href="#cb5-83"></a>      out[[<span class="dv">2</span><span class="op">*</span>nv<span class="dv">-1</span><span class="op">+</span>i]] &lt;-<span class="st"> </span>M</span>
<span id="cb5-84"><a href="#cb5-84"></a>      <span class="cf">if</span>(i <span class="op">&lt;</span><span class="st"> </span>nu){</span>
<span id="cb5-85"><a href="#cb5-85"></a>        out[[<span class="dv">2</span><span class="op">*</span>nv<span class="dv">-1</span><span class="op">+</span>nu<span class="op">+</span>i]] &lt;-<span class="st"> </span><span class="kw">cbind</span>(<span class="op">-</span>M[,1L], M[,<span class="kw">c</span>(2L,3L)])</span>
<span id="cb5-86"><a href="#cb5-86"></a>        <span class="cf">if</span>(i<span class="op">&gt;</span>1L) out[[<span class="dv">2</span><span class="op">*</span>nv<span class="op">+</span><span class="dv">3</span><span class="op">*</span>nu<span class="op">+</span>i<span class="dv">-4</span>]] &lt;-<span class="st"> </span><span class="kw">cbind</span>(<span class="op">-</span>M[,<span class="kw">c</span>(1L,2L)], M[,3L])</span>
<span id="cb5-87"><a href="#cb5-87"></a>      }</span>
<span id="cb5-88"><a href="#cb5-88"></a>      <span class="cf">if</span>(i <span class="op">&gt;</span><span class="st"> </span>1L){</span>
<span id="cb5-89"><a href="#cb5-89"></a>        out[[<span class="dv">2</span><span class="op">*</span>nv<span class="op">+</span><span class="dv">2</span><span class="op">*</span>nu<span class="op">+</span>i<span class="dv">-3</span>]] &lt;-<span class="st"> </span><span class="kw">cbind</span>(M[,1L], <span class="op">-</span>M[,2L], M[,3L])</span>
<span id="cb5-90"><a href="#cb5-90"></a>      }</span>
<span id="cb5-91"><a href="#cb5-91"></a>    }</span>
<span id="cb5-92"><a href="#cb5-92"></a>  }</span>
<span id="cb5-93"><a href="#cb5-93"></a>  <span class="cf">if</span>(exchange){</span>
<span id="cb5-94"><a href="#cb5-94"></a>    out &lt;-<span class="st"> </span><span class="kw">lapply</span>(out, <span class="cf">function</span>(M){</span>
<span id="cb5-95"><a href="#cb5-95"></a>      M[, <span class="kw">c</span>(2L,1L,3L)]</span>
<span id="cb5-96"><a href="#cb5-96"></a>    })</span>
<span id="cb5-97"><a href="#cb5-97"></a>  }</span>
<span id="cb5-98"><a href="#cb5-98"></a>  out</span>
<span id="cb5-99"><a href="#cb5-99"></a>}</span></code></pre></div>
<p>Here is an example:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1"></a>sgntr =<span class="st"> &quot;++-&quot;</span></span>
<span id="cb6-2"><a href="#cb6-2"></a>a =<span class="st"> </span><span class="dv">4</span>; b =<span class="st"> </span><span class="dv">6</span>; c =<span class="st"> </span><span class="dv">5</span></span>
<span id="cb6-3"><a href="#cb6-3"></a>mesh &lt;-<span class="st"> </span><span class="kw">hyperboloidMesh</span>(a, b, c, sgntr, <span class="dt">nu =</span> <span class="dv">100</span>, <span class="dt">nv =</span> <span class="dv">100</span>, <span class="dt">vmin =</span> <span class="dv">-150</span>)</span>
<span id="cb6-4"><a href="#cb6-4"></a>clines &lt;-<span class="st"> </span><span class="kw">curvatureLinesH1</span>(a, b, c, sgntr, <span class="dt">nu =</span> <span class="dv">5</span>, <span class="dt">nv =</span> <span class="dv">5</span>, <span class="dt">vmin =</span> <span class="dv">-150</span>)</span>
<span id="cb6-5"><a href="#cb6-5"></a><span class="kw">shade3d</span>(mesh, <span class="dt">color =</span> <span class="st">&quot;chartreuse4&quot;</span>, <span class="dt">back =</span> <span class="st">&quot;culled&quot;</span>) </span>
<span id="cb6-6"><a href="#cb6-6"></a><span class="kw">shade3d</span>(mesh, <span class="dt">color =</span> <span class="st">&quot;yellow&quot;</span>, <span class="dt">front =</span> <span class="st">&quot;culled&quot;</span>) </span>
<span id="cb6-7"><a href="#cb6-7"></a><span class="kw">invisible</span>(<span class="kw">lapply</span>(clines, <span class="cf">function</span>(l){</span>
<span id="cb6-8"><a href="#cb6-8"></a>  <span class="kw">shade3d</span>(<span class="kw">cylinder3d</span>(l, <span class="dt">radius =</span> <span class="fl">0.1</span>, <span class="dt">sides =</span> <span class="dv">30</span>))</span>
<span id="cb6-9"><a href="#cb6-9"></a>}))</span></code></pre></div>
<p><img src="figures/quadrics_H1.png" /></p>
<h1 id="two-sheeted-hyperboloid">Two-sheeted hyperboloid</h1>
<p>There are three types of two-sheeted hyperboloids, corresponding to these equations: <span class="math display">\[
\frac{x^2}{a^2} - \frac{y^2}{b^2} - \frac{z^2}{c^2} = 1 \\
-\frac{x^2}{a^2} - \frac{y^2}{b^2} + \frac{z^2}{c^2} = 1 \\
-\frac{x^2}{a^2} + \frac{y^2}{b^2} - \frac{z^2}{c^2} = 1.
\]</span> The <code>twoSheetsHyperboloidMesh</code> function below generates a mesh of the two-sheeted hyperboloid; the <code>signature</code> argument corresponds to one of the above equations, it must be <code>"+--"</code>, <code>"--+"</code> or <code>"-+-"</code>. The mesh is made of quadrilaterals and their number is controlled by the arguments <code>nu</code> and <code>nv</code>. The two-sheeted hyperboloid is infinite and the argument <code>vmin</code> is here to control its truncation.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1"></a>twoSheetsHyperboloidMesh &lt;-<span class="st"> </span><span class="cf">function</span>(a, b, c, signature, nu, nv, vmin){</span>
<span id="cb7-2"><a href="#cb7-2"></a>  <span class="kw">stopifnot</span>(signature <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;+--&quot;</span>, <span class="st">&quot;--+&quot;</span>, <span class="st">&quot;-+-&quot;</span>))</span>
<span id="cb7-3"><a href="#cb7-3"></a>  <span class="kw">stopifnot</span>(vmin <span class="op">&lt;</span><span class="st"> </span><span class="dv">1</span>)</span>
<span id="cb7-4"><a href="#cb7-4"></a>  <span class="cf">if</span>(signature <span class="op">==</span><span class="st"> &quot;--+&quot;</span>){</span>
<span id="cb7-5"><a href="#cb7-5"></a>    mesh &lt;-<span class="st"> </span><span class="kw">twoSheetsHyperboloidMesh</span>(c, b, a, <span class="st">&quot;+--&quot;</span>, nu, nv, vmin)</span>
<span id="cb7-6"><a href="#cb7-6"></a>    mesh<span class="op">$</span>vb &lt;-<span class="st"> </span>mesh<span class="op">$</span>vb[<span class="kw">c</span>(3L,2L,1L,4L),]</span>
<span id="cb7-7"><a href="#cb7-7"></a>    mesh<span class="op">$</span>normals &lt;-<span class="st"> </span>mesh<span class="op">$</span>normals[<span class="kw">c</span>(3L,2L,1L),]</span>
<span id="cb7-8"><a href="#cb7-8"></a>    mesh<span class="op">$</span>ib &lt;-<span class="st"> </span>mesh<span class="op">$</span>ib[4L<span class="op">:</span>1L,]</span>
<span id="cb7-9"><a href="#cb7-9"></a>    <span class="kw">return</span>(mesh)</span>
<span id="cb7-10"><a href="#cb7-10"></a>  }<span class="cf">else</span> <span class="cf">if</span>(signature <span class="op">==</span><span class="st"> &quot;-+-&quot;</span>){</span>
<span id="cb7-11"><a href="#cb7-11"></a>    mesh &lt;-<span class="st"> </span><span class="kw">twoSheetsHyperboloidMesh</span>(b, a, c, <span class="st">&quot;+--&quot;</span>, nu, nv, vmin)</span>
<span id="cb7-12"><a href="#cb7-12"></a>    mesh<span class="op">$</span>vb &lt;-<span class="st"> </span>mesh<span class="op">$</span>vb[<span class="kw">c</span>(2L,1L,3L,4L),]</span>
<span id="cb7-13"><a href="#cb7-13"></a>    mesh<span class="op">$</span>normals &lt;-<span class="st"> </span>mesh<span class="op">$</span>normals[<span class="kw">c</span>(2L,1L,3L),]</span>
<span id="cb7-14"><a href="#cb7-14"></a>    mesh<span class="op">$</span>ib &lt;-<span class="st"> </span>mesh<span class="op">$</span>ib[4L<span class="op">:</span>1L,]</span>
<span id="cb7-15"><a href="#cb7-15"></a>    <span class="kw">return</span>(mesh)</span>
<span id="cb7-16"><a href="#cb7-16"></a>  }</span>
<span id="cb7-17"><a href="#cb7-17"></a>  a0 &lt;-<span class="st"> </span>a</span>
<span id="cb7-18"><a href="#cb7-18"></a>  <span class="cf">if</span>(b <span class="op">&gt;</span><span class="st"> </span>c){</span>
<span id="cb7-19"><a href="#cb7-19"></a>    exchange &lt;-<span class="st"> </span><span class="ot">TRUE</span></span>
<span id="cb7-20"><a href="#cb7-20"></a>    b0 &lt;-<span class="st"> </span>c; c0 &lt;-<span class="st"> </span>b</span>
<span id="cb7-21"><a href="#cb7-21"></a>  }<span class="cf">else</span>{</span>
<span id="cb7-22"><a href="#cb7-22"></a>    exchange &lt;-<span class="st"> </span><span class="ot">FALSE</span></span>
<span id="cb7-23"><a href="#cb7-23"></a>    b0 &lt;-<span class="st"> </span>b; c0 &lt;-<span class="st"> </span>c</span>
<span id="cb7-24"><a href="#cb7-24"></a>  }</span>
<span id="cb7-25"><a href="#cb7-25"></a>  Nu2 &lt;-<span class="st"> </span>a0<span class="op">^</span><span class="dv">2</span></span>
<span id="cb7-26"><a href="#cb7-26"></a>  h2ab &lt;-<span class="st"> </span>b0<span class="op">^</span><span class="dv">2</span> <span class="op">+</span><span class="st"> </span>Nu2; h2ac &lt;-<span class="st"> </span>c0<span class="op">^</span><span class="dv">2</span> <span class="op">+</span><span class="st"> </span>Nu2</span>
<span id="cb7-27"><a href="#cb7-27"></a>  c2 &lt;-<span class="st"> </span><span class="dv">1</span>; a2 &lt;-<span class="st"> </span>c2 <span class="op">+</span><span class="st"> </span>h2ac; b2 &lt;-<span class="st"> </span>a2 <span class="op">-</span><span class="st"> </span>h2ab</span>
<span id="cb7-28"><a href="#cb7-28"></a>  h2bc &lt;-<span class="st"> </span>b2 <span class="op">-</span><span class="st"> </span>c2</span>
<span id="cb7-29"><a href="#cb7-29"></a>  <span class="co">#</span></span>
<span id="cb7-30"><a href="#cb7-30"></a>  vertices &lt;-<span class="st"> </span>Normals &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="ot">NA_real_</span>, <span class="dt">nrow =</span> 3L, <span class="dt">ncol =</span> nu<span class="op">*</span>nv)</span>
<span id="cb7-31"><a href="#cb7-31"></a>  indices &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="ot">NA_integer_</span>, <span class="dt">nrow =</span> 4L, <span class="dt">ncol =</span> (nu<span class="dv">-1</span>)<span class="op">*</span>(nv<span class="dv">-1</span>))</span>
<span id="cb7-32"><a href="#cb7-32"></a>  v_ &lt;-<span class="st"> </span><span class="kw">seq</span>(vmin, c2, <span class="dt">length.out =</span> nv)</span>
<span id="cb7-33"><a href="#cb7-33"></a>  <span class="co">#</span></span>
<span id="cb7-34"><a href="#cb7-34"></a>  <span class="cf">if</span>(b0 <span class="op">!=</span><span class="st"> </span>c0){</span>
<span id="cb7-35"><a href="#cb7-35"></a>    u_ &lt;-<span class="st"> </span><span class="kw">seq</span>(c2, b2, <span class="dt">length.out =</span> nu)</span>
<span id="cb7-36"><a href="#cb7-36"></a>    x &lt;-<span class="st"> </span>a0 <span class="op">/</span><span class="st"> </span><span class="kw">sqrt</span>(h2ac<span class="op">*</span>h2ab) <span class="op">*</span><span class="st"> </span><span class="kw">sqrt</span>(a2<span class="op">-</span>u_)</span>
<span id="cb7-37"><a href="#cb7-37"></a>    y &lt;-<span class="st"> </span>b0 <span class="op">/</span><span class="st"> </span><span class="kw">sqrt</span>(h2bc<span class="op">*</span>h2ab) <span class="op">*</span><span class="st"> </span><span class="kw">sqrt</span>(b2<span class="op">-</span>u_)</span>
<span id="cb7-38"><a href="#cb7-38"></a>    z &lt;-<span class="st"> </span>c0 <span class="op">/</span><span class="st"> </span><span class="kw">sqrt</span>(h2bc<span class="op">*</span>h2ac) <span class="op">*</span><span class="st"> </span><span class="kw">sqrt</span>(u_<span class="op">-</span>c2)</span>
<span id="cb7-39"><a href="#cb7-39"></a>  }<span class="cf">else</span>{</span>
<span id="cb7-40"><a href="#cb7-40"></a>    u_ &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="dv">0</span>, <span class="dv">2</span><span class="op">*</span>pi, <span class="dt">length.out =</span> nu<span class="op">+</span><span class="dv">1</span>)[<span class="op">-</span>1L]</span>
<span id="cb7-41"><a href="#cb7-41"></a>    x &lt;-<span class="st"> </span><span class="kw">rep</span>(a0<span class="op">/</span><span class="kw">sqrt</span>(h2ac), nu)</span>
<span id="cb7-42"><a href="#cb7-42"></a>    myz &lt;-<span class="st"> </span>b0 <span class="op">/</span><span class="st"> </span><span class="kw">sqrt</span>(h2ab)</span>
<span id="cb7-43"><a href="#cb7-43"></a>    y &lt;-<span class="st"> </span>myz <span class="op">*</span><span class="st"> </span><span class="kw">cos</span>(u_)</span>
<span id="cb7-44"><a href="#cb7-44"></a>    z &lt;-<span class="st"> </span>myz <span class="op">*</span><span class="st"> </span><span class="kw">sin</span>(u_)</span>
<span id="cb7-45"><a href="#cb7-45"></a>  }</span>
<span id="cb7-46"><a href="#cb7-46"></a>  <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>nu){</span>
<span id="cb7-47"><a href="#cb7-47"></a>    <span class="cf">for</span>(j <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>nv){</span>
<span id="cb7-48"><a href="#cb7-48"></a>      P &lt;-<span class="st"> </span>vertices[, (i<span class="dv">-1</span>)<span class="op">*</span>nv<span class="op">+</span>j] &lt;-<span class="st"> </span><span class="kw">c</span>(</span>
<span id="cb7-49"><a href="#cb7-49"></a>        x[i] <span class="op">*</span><span class="st"> </span><span class="kw">sqrt</span>(a2<span class="op">-</span>v_[j]),</span>
<span id="cb7-50"><a href="#cb7-50"></a>        y[i] <span class="op">*</span><span class="st"> </span><span class="kw">sqrt</span>(b2<span class="op">-</span>v_[j]),</span>
<span id="cb7-51"><a href="#cb7-51"></a>        z[i] <span class="op">*</span><span class="st"> </span><span class="kw">sqrt</span>(c2<span class="op">-</span>v_[j])</span>
<span id="cb7-52"><a href="#cb7-52"></a>      )</span>
<span id="cb7-53"><a href="#cb7-53"></a>      Normals[, (i<span class="dv">-1</span>)<span class="op">*</span>nv<span class="op">+</span>j] &lt;-<span class="st"> </span><span class="kw">c</span>(P[1L]<span class="op">/</span>a0<span class="op">^</span><span class="dv">2</span>, <span class="op">-</span>P[2L]<span class="op">/</span>b0<span class="op">^</span><span class="dv">2</span>, <span class="op">-</span>P[3L]<span class="op">/</span>c0<span class="op">^</span><span class="dv">2</span>)</span>
<span id="cb7-54"><a href="#cb7-54"></a>    }</span>
<span id="cb7-55"><a href="#cb7-55"></a>  }</span>
<span id="cb7-56"><a href="#cb7-56"></a>  <span class="co"># quads</span></span>
<span id="cb7-57"><a href="#cb7-57"></a>  <span class="cf">for</span>(i <span class="cf">in</span> 1L<span class="op">:</span>(nu<span class="dv">-1</span>)){</span>
<span id="cb7-58"><a href="#cb7-58"></a>    im1 &lt;-<span class="st"> </span>i<span class="op">-</span>1L</span>
<span id="cb7-59"><a href="#cb7-59"></a>    <span class="cf">for</span>(j <span class="cf">in</span> 1L<span class="op">:</span>(nv<span class="dv">-1</span>)){</span>
<span id="cb7-60"><a href="#cb7-60"></a>      jp1 &lt;-<span class="st"> </span>j<span class="op">+</span>1L</span>
<span id="cb7-61"><a href="#cb7-61"></a>      quad &lt;-<span class="st"> </span><span class="kw">c</span>(im1<span class="op">*</span>nv<span class="op">+</span>j, im1<span class="op">*</span>nv<span class="op">+</span>jp1, i<span class="op">*</span>nv<span class="op">+</span>jp1, i<span class="op">*</span>nv<span class="op">+</span>j)</span>
<span id="cb7-62"><a href="#cb7-62"></a>      indices[, im1<span class="op">*</span>(nv<span class="dv">-1</span>)<span class="op">+</span>j] &lt;-<span class="st"> </span><span class="cf">if</span>(exchange) <span class="kw">rev</span>(quad) <span class="cf">else</span> quad</span>
<span id="cb7-63"><a href="#cb7-63"></a>    }</span>
<span id="cb7-64"><a href="#cb7-64"></a>  }</span>
<span id="cb7-65"><a href="#cb7-65"></a>  vertices &lt;-<span class="st"> </span><span class="kw">cbind</span>(vertices, <span class="kw">c</span>(<span class="op">-</span><span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>) <span class="op">*</span><span class="st"> </span>vertices)</span>
<span id="cb7-66"><a href="#cb7-66"></a>  indices &lt;-<span class="st"> </span><span class="kw">cbind</span>(indices, indices[4L<span class="op">:</span>1L,] <span class="op">+</span><span class="st"> </span>nu<span class="op">*</span>nv)</span>
<span id="cb7-67"><a href="#cb7-67"></a>  Normals &lt;-<span class="st"> </span><span class="kw">cbind</span>(Normals, <span class="kw">c</span>(<span class="op">-</span><span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>) <span class="op">*</span><span class="st"> </span>Normals)</span>
<span id="cb7-68"><a href="#cb7-68"></a>  vertices &lt;-<span class="st"> </span><span class="kw">cbind</span>(vertices, <span class="kw">c</span>(<span class="dv">1</span>,<span class="op">-</span><span class="dv">1</span>,<span class="dv">1</span>) <span class="op">*</span><span class="st"> </span>vertices)</span>
<span id="cb7-69"><a href="#cb7-69"></a>  indices &lt;-<span class="st"> </span><span class="kw">cbind</span>(indices, indices[4L<span class="op">:</span>1L,] <span class="op">+</span><span class="st"> </span><span class="dv">2</span><span class="op">*</span>nu<span class="op">*</span>nv)</span>
<span id="cb7-70"><a href="#cb7-70"></a>  Normals &lt;-<span class="st"> </span><span class="kw">cbind</span>(Normals, <span class="kw">c</span>(<span class="dv">1</span>,<span class="op">-</span><span class="dv">1</span>,<span class="dv">1</span>) <span class="op">*</span><span class="st"> </span>Normals)</span>
<span id="cb7-71"><a href="#cb7-71"></a>  vertices &lt;-<span class="st"> </span><span class="kw">cbind</span>(vertices, <span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">1</span>,<span class="op">-</span><span class="dv">1</span>) <span class="op">*</span><span class="st"> </span>vertices)</span>
<span id="cb7-72"><a href="#cb7-72"></a>  indices &lt;-<span class="st"> </span><span class="kw">cbind</span>(indices, indices[4L<span class="op">:</span>1L,] <span class="op">+</span><span class="st"> </span><span class="dv">4</span><span class="op">*</span>nu<span class="op">*</span>nv)</span>
<span id="cb7-73"><a href="#cb7-73"></a>  Normals &lt;-<span class="st"> </span><span class="kw">cbind</span>(Normals, <span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">1</span>,<span class="op">-</span><span class="dv">1</span>) <span class="op">*</span><span class="st"> </span>Normals)</span>
<span id="cb7-74"><a href="#cb7-74"></a>  mesh &lt;-<span class="st"> </span><span class="kw">qmesh3d</span>(</span>
<span id="cb7-75"><a href="#cb7-75"></a>    <span class="dt">vertices =</span> <span class="cf">if</span>(exchange) vertices[<span class="kw">c</span>(1L,3L,2L),] <span class="cf">else</span> vertices,</span>
<span id="cb7-76"><a href="#cb7-76"></a>    <span class="dt">indices =</span> indices,</span>
<span id="cb7-77"><a href="#cb7-77"></a>    <span class="dt">homogeneous =</span> <span class="ot">FALSE</span>,</span>
<span id="cb7-78"><a href="#cb7-78"></a>    <span class="dt">normals =</span> <span class="op">-</span><span class="kw">t</span>(<span class="cf">if</span>(exchange) Normals[<span class="kw">c</span>(1L,3L,2L),] <span class="cf">else</span> Normals)</span>
<span id="cb7-79"><a href="#cb7-79"></a>  )</span>
<span id="cb7-80"><a href="#cb7-80"></a>  mesh</span>
<span id="cb7-81"><a href="#cb7-81"></a>}</span></code></pre></div>
<p>The <code>curvatureLinesH2</code> function below generates some curvature lines of the two-sheeted hyperboloid. The role of the arguments <code>du</code> and <code>dv</code> is similar to the role of the arguments <code>du</code> and <code>dv</code> in <code>curvatureLinesE</code>.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1"></a>curvatureLinesH2 &lt;-<span class="st"> </span><span class="cf">function</span>(a, b, c, signature, nu, nv, vmin, du, dv, </span>
<span id="cb8-2"><a href="#cb8-2"></a>                             <span class="dt">npoints =</span> <span class="dv">100</span>){</span>
<span id="cb8-3"><a href="#cb8-3"></a>  <span class="kw">stopifnot</span>(signature <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;+--&quot;</span>, <span class="st">&quot;--+&quot;</span>, <span class="st">&quot;-+-&quot;</span>))</span>
<span id="cb8-4"><a href="#cb8-4"></a>  <span class="kw">stopifnot</span>(du <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>, dv <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>, vmin <span class="op">&lt;</span><span class="st"> </span><span class="dv">1</span>)</span>
<span id="cb8-5"><a href="#cb8-5"></a>  <span class="cf">if</span>(signature <span class="op">==</span><span class="st"> &quot;--+&quot;</span>){</span>
<span id="cb8-6"><a href="#cb8-6"></a>    clines &lt;-<span class="st"> </span></span>
<span id="cb8-7"><a href="#cb8-7"></a><span class="st">      </span><span class="kw">curvatureLinesH2</span>(c, b, a, <span class="st">&quot;+--&quot;</span>, nu, nv, vmin, du, dv, npoints)</span>
<span id="cb8-8"><a href="#cb8-8"></a>    <span class="kw">return</span>(<span class="kw">lapply</span>(clines, <span class="cf">function</span>(l) l[, <span class="kw">c</span>(3L,2L,1L)]))</span>
<span id="cb8-9"><a href="#cb8-9"></a>  }<span class="cf">else</span> <span class="cf">if</span>(signature <span class="op">==</span><span class="st"> &quot;-+-&quot;</span>){</span>
<span id="cb8-10"><a href="#cb8-10"></a>    clines &lt;-<span class="st"> </span></span>
<span id="cb8-11"><a href="#cb8-11"></a><span class="st">      </span><span class="kw">curvatureLinesH2</span>(b, a, c, <span class="st">&quot;+--&quot;</span>, nu, nv, vmin, du, dv, npoints)</span>
<span id="cb8-12"><a href="#cb8-12"></a>    <span class="kw">return</span>(<span class="kw">lapply</span>(clines, <span class="cf">function</span>(l) l[, <span class="kw">c</span>(2L,1L,3L)]))</span>
<span id="cb8-13"><a href="#cb8-13"></a>  }</span>
<span id="cb8-14"><a href="#cb8-14"></a>  a0 &lt;-<span class="st"> </span>a</span>
<span id="cb8-15"><a href="#cb8-15"></a>  <span class="cf">if</span>(b <span class="op">&gt;</span><span class="st"> </span>c){</span>
<span id="cb8-16"><a href="#cb8-16"></a>    exchange &lt;-<span class="st"> </span><span class="ot">TRUE</span></span>
<span id="cb8-17"><a href="#cb8-17"></a>    b0 &lt;-<span class="st"> </span>c; c0 &lt;-<span class="st"> </span>b</span>
<span id="cb8-18"><a href="#cb8-18"></a>  }<span class="cf">else</span>{</span>
<span id="cb8-19"><a href="#cb8-19"></a>    exchange &lt;-<span class="st"> </span><span class="ot">FALSE</span></span>
<span id="cb8-20"><a href="#cb8-20"></a>    b0 &lt;-<span class="st"> </span>b; c0 &lt;-<span class="st"> </span>c</span>
<span id="cb8-21"><a href="#cb8-21"></a>  }</span>
<span id="cb8-22"><a href="#cb8-22"></a>  Nu2 &lt;-<span class="st"> </span>a0<span class="op">^</span><span class="dv">2</span></span>
<span id="cb8-23"><a href="#cb8-23"></a>  h2ab &lt;-<span class="st"> </span>b0<span class="op">^</span><span class="dv">2</span> <span class="op">+</span><span class="st"> </span>Nu2; h2ac &lt;-<span class="st"> </span>c0<span class="op">^</span><span class="dv">2</span> <span class="op">+</span><span class="st"> </span>Nu2</span>
<span id="cb8-24"><a href="#cb8-24"></a>  c2 &lt;-<span class="st"> </span><span class="dv">1</span>; a2 &lt;-<span class="st"> </span>c2 <span class="op">+</span><span class="st"> </span>h2ac; b2 &lt;-<span class="st"> </span>a2 <span class="op">-</span><span class="st"> </span>h2ab</span>
<span id="cb8-25"><a href="#cb8-25"></a>  h2bc &lt;-<span class="st"> </span>b2 <span class="op">-</span><span class="st"> </span>c2</span>
<span id="cb8-26"><a href="#cb8-26"></a>  <span class="co">#</span></span>
<span id="cb8-27"><a href="#cb8-27"></a>  <span class="cf">if</span>(b0 <span class="op">!=</span><span class="st"> </span>c0 <span class="op">&amp;&amp;</span><span class="st"> </span>c2<span class="op">+</span>du <span class="op">&gt;=</span><span class="st"> </span>b2){</span>
<span id="cb8-28"><a href="#cb8-28"></a>    <span class="kw">stop</span>(<span class="st">&quot;`du` is too large.&quot;</span>)</span>
<span id="cb8-29"><a href="#cb8-29"></a>  }</span>
<span id="cb8-30"><a href="#cb8-30"></a>  <span class="cf">if</span>(vmin <span class="op">&gt;=</span><span class="st"> </span>c2<span class="op">-</span>dv){</span>
<span id="cb8-31"><a href="#cb8-31"></a>    <span class="kw">stop</span>(<span class="st">&quot;`dv` is too large&quot;</span>)</span>
<span id="cb8-32"><a href="#cb8-32"></a>  }</span>
<span id="cb8-33"><a href="#cb8-33"></a>  v_ &lt;-<span class="st"> </span><span class="kw">seq</span>(vmin, c2<span class="op">-</span>dv, <span class="dt">length.out =</span> nv)</span>
<span id="cb8-34"><a href="#cb8-34"></a>  t_ &lt;-<span class="st"> </span><span class="kw">seq</span>(vmin, c2, <span class="dt">length.out =</span> npoints)</span>
<span id="cb8-35"><a href="#cb8-35"></a>  out &lt;-<span class="st"> </span><span class="kw">vector</span>(<span class="st">&quot;list&quot;</span>, <span class="dv">2</span><span class="op">*</span>nv <span class="op">+</span><span class="st"> </span><span class="dv">4</span><span class="op">*</span>nu <span class="op">-</span><span class="st"> </span><span class="dv">2</span>)</span>
<span id="cb8-36"><a href="#cb8-36"></a>  <span class="co">#</span></span>
<span id="cb8-37"><a href="#cb8-37"></a>  <span class="cf">if</span>(b0 <span class="op">!=</span><span class="st"> </span>c0){</span>
<span id="cb8-38"><a href="#cb8-38"></a>    u_ &lt;-<span class="st"> </span><span class="kw">seq</span>(c2<span class="op">+</span>du, b2, <span class="dt">length.out =</span> nu)</span>
<span id="cb8-39"><a href="#cb8-39"></a>    s_ &lt;-<span class="st"> </span><span class="kw">seq</span>(c2, b2, <span class="dt">length.out =</span> npoints)</span>
<span id="cb8-40"><a href="#cb8-40"></a>    mx &lt;-<span class="st"> </span>a0 <span class="op">/</span><span class="st"> </span><span class="kw">sqrt</span>(h2ac<span class="op">*</span>h2ab)</span>
<span id="cb8-41"><a href="#cb8-41"></a>    my &lt;-<span class="st"> </span>b0 <span class="op">/</span><span class="st"> </span><span class="kw">sqrt</span>(h2bc<span class="op">*</span>h2ab)</span>
<span id="cb8-42"><a href="#cb8-42"></a>    mz &lt;-<span class="st"> </span>c0 <span class="op">/</span><span class="st"> </span><span class="kw">sqrt</span>(h2bc<span class="op">*</span>h2ac)</span>
<span id="cb8-43"><a href="#cb8-43"></a>    <span class="cf">for</span>(j <span class="cf">in</span> 1L<span class="op">:</span>nv){</span>
<span id="cb8-44"><a href="#cb8-44"></a>      x &lt;-<span class="st"> </span>mx <span class="op">*</span><span class="st"> </span><span class="kw">sqrt</span>((a2<span class="op">-</span>s_)<span class="op">*</span>(a2<span class="op">-</span>v_[j]))</span>
<span id="cb8-45"><a href="#cb8-45"></a>      y &lt;-<span class="st"> </span>my <span class="op">*</span><span class="st"> </span><span class="kw">sqrt</span>((b2<span class="op">-</span>s_)<span class="op">*</span>(b2<span class="op">-</span>v_[j]))</span>
<span id="cb8-46"><a href="#cb8-46"></a>      z &lt;-<span class="st"> </span>mz <span class="op">*</span><span class="st"> </span><span class="kw">sqrt</span>((s_<span class="op">-</span>c2)<span class="op">*</span>(c2<span class="op">-</span>v_[j]))</span>
<span id="cb8-47"><a href="#cb8-47"></a>      M1 &lt;-<span class="st"> </span><span class="kw">rbind</span>(<span class="kw">cbind</span>(x, y, z), <span class="kw">cbind</span>(x, <span class="op">-</span>y, z)[(npoints<span class="dv">-1</span>)<span class="op">:</span>1L,])</span>
<span id="cb8-48"><a href="#cb8-48"></a>      M2 &lt;-<span class="st"> </span><span class="kw">cbind</span>(M1[,<span class="kw">c</span>(1L,2L)], <span class="op">-</span>M1[,3L])</span>
<span id="cb8-49"><a href="#cb8-49"></a>      M &lt;-<span class="st"> </span><span class="kw">rbind</span>(M1, M2[(<span class="dv">2</span><span class="op">*</span>npoints<span class="dv">-2</span>)<span class="op">:</span>1L,])</span>
<span id="cb8-50"><a href="#cb8-50"></a>      out[[j]] &lt;-<span class="st"> </span><span class="cf">if</span>(exchange) M[,<span class="kw">c</span>(1L,3L,2L)] <span class="cf">else</span> M</span>
<span id="cb8-51"><a href="#cb8-51"></a>      out[[nv<span class="op">+</span>j]] &lt;-<span class="st"> </span></span>
<span id="cb8-52"><a href="#cb8-52"></a><span class="st">        </span><span class="kw">cbind</span>(<span class="op">-</span>M[,1L], <span class="cf">if</span>(exchange) M[,<span class="kw">c</span>(3L,2L)] <span class="cf">else</span> M[,<span class="kw">c</span>(2L,3L)])</span>
<span id="cb8-53"><a href="#cb8-53"></a>    }</span>
<span id="cb8-54"><a href="#cb8-54"></a>    <span class="cf">for</span>(i <span class="cf">in</span> 1L<span class="op">:</span>nu){</span>
<span id="cb8-55"><a href="#cb8-55"></a>      x &lt;-<span class="st"> </span>mx <span class="op">*</span><span class="st"> </span><span class="kw">sqrt</span>((a2<span class="op">-</span>u_[i])<span class="op">*</span>(a2<span class="op">-</span>t_))</span>
<span id="cb8-56"><a href="#cb8-56"></a>      y &lt;-<span class="st"> </span>my <span class="op">*</span><span class="st"> </span><span class="kw">sqrt</span>((b2<span class="op">-</span>u_[i])<span class="op">*</span>(b2<span class="op">-</span>t_))</span>
<span id="cb8-57"><a href="#cb8-57"></a>      z &lt;-<span class="st"> </span>mz <span class="op">*</span><span class="st"> </span><span class="kw">sqrt</span>((u_[i]<span class="op">-</span>c2)<span class="op">*</span>(c2<span class="op">-</span>t_))</span>
<span id="cb8-58"><a href="#cb8-58"></a>      M &lt;-<span class="st"> </span><span class="kw">rbind</span>(<span class="kw">cbind</span>(x, y, z), <span class="kw">cbind</span>(x, y, <span class="op">-</span>z)[(npoints<span class="dv">-1</span>)<span class="op">:</span>1L,])</span>
<span id="cb8-59"><a href="#cb8-59"></a>      out[[<span class="dv">2</span><span class="op">*</span>nv<span class="op">+</span>i]] &lt;-<span class="st"> </span><span class="cf">if</span>(exchange) M[,<span class="kw">c</span>(1L,3L,2L)] <span class="cf">else</span> M</span>
<span id="cb8-60"><a href="#cb8-60"></a>      <span class="cf">if</span>(i <span class="op">&lt;</span><span class="st"> </span>nu){</span>
<span id="cb8-61"><a href="#cb8-61"></a>        out[[<span class="dv">2</span><span class="op">*</span>nv<span class="op">+</span>nu<span class="op">+</span>i]] &lt;-<span class="st"> </span><span class="cf">if</span>(exchange) </span>
<span id="cb8-62"><a href="#cb8-62"></a>          <span class="kw">cbind</span>(M[,<span class="kw">c</span>(1L,3L)], <span class="op">-</span>M[,2L]) </span>
<span id="cb8-63"><a href="#cb8-63"></a>        <span class="cf">else</span> </span>
<span id="cb8-64"><a href="#cb8-64"></a>          <span class="kw">cbind</span>(M[,1L], <span class="op">-</span>M[,2L], M[,3L])</span>
<span id="cb8-65"><a href="#cb8-65"></a>      }</span>
<span id="cb8-66"><a href="#cb8-66"></a>    }</span>
<span id="cb8-67"><a href="#cb8-67"></a>  }<span class="cf">else</span>{ <span class="co"># b0 = c0</span></span>
<span id="cb8-68"><a href="#cb8-68"></a>    u_ &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="dv">0</span>, <span class="dv">2</span><span class="op">*</span>pi, <span class="dt">length.out =</span> nu<span class="op">+</span><span class="dv">1</span>)[<span class="op">-</span>1L] </span>
<span id="cb8-69"><a href="#cb8-69"></a>    s_ &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="dv">0</span>, <span class="dv">2</span><span class="op">*</span>pi, <span class="dt">length.out =</span> npoints)</span>
<span id="cb8-70"><a href="#cb8-70"></a>    mx &lt;-<span class="st"> </span>a0 <span class="op">/</span><span class="st"> </span><span class="kw">sqrt</span>(h2ac)</span>
<span id="cb8-71"><a href="#cb8-71"></a>    myz &lt;-<span class="st"> </span>b0 <span class="op">/</span><span class="st"> </span><span class="kw">sqrt</span>(h2ab)</span>
<span id="cb8-72"><a href="#cb8-72"></a>    <span class="cf">for</span>(j <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>nv){</span>
<span id="cb8-73"><a href="#cb8-73"></a>      x &lt;-<span class="st"> </span>mx <span class="op">*</span><span class="st"> </span><span class="kw">sqrt</span>(a2<span class="op">-</span>v_[j])</span>
<span id="cb8-74"><a href="#cb8-74"></a>      y &lt;-<span class="st"> </span>myz <span class="op">*</span><span class="st"> </span><span class="kw">sqrt</span>(b2<span class="op">-</span>v_[j]) <span class="op">*</span><span class="st"> </span><span class="kw">cos</span>(s_)</span>
<span id="cb8-75"><a href="#cb8-75"></a>      z &lt;-<span class="st"> </span>myz <span class="op">*</span><span class="st"> </span><span class="kw">sqrt</span>(c2<span class="op">-</span>v_[j]) <span class="op">*</span><span class="st"> </span><span class="kw">sin</span>(s_)</span>
<span id="cb8-76"><a href="#cb8-76"></a>      M &lt;-<span class="st"> </span><span class="kw">cbind</span>(x, y, z)</span>
<span id="cb8-77"><a href="#cb8-77"></a>      out[[j]] &lt;-<span class="st"> </span><span class="cf">if</span>(exchange) M[,<span class="kw">c</span>(1L,3L,2L)] <span class="cf">else</span> M</span>
<span id="cb8-78"><a href="#cb8-78"></a>      out[[nv<span class="op">+</span>j]] &lt;-<span class="st"> </span></span>
<span id="cb8-79"><a href="#cb8-79"></a><span class="st">        </span><span class="kw">cbind</span>(<span class="op">-</span>M[,1L], <span class="cf">if</span>(exchange) M[,<span class="kw">c</span>(3L,2L)] <span class="cf">else</span> M[,<span class="kw">c</span>(2L,3L)])</span>
<span id="cb8-80"><a href="#cb8-80"></a>    }</span>
<span id="cb8-81"><a href="#cb8-81"></a>    <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>nu){</span>
<span id="cb8-82"><a href="#cb8-82"></a>      x &lt;-<span class="st"> </span>mx <span class="op">*</span><span class="st"> </span><span class="kw">sqrt</span>(a2<span class="op">-</span>t_)</span>
<span id="cb8-83"><a href="#cb8-83"></a>      y &lt;-<span class="st"> </span>myz <span class="op">*</span><span class="st"> </span><span class="kw">sqrt</span>(b2<span class="op">-</span>t_) <span class="op">*</span><span class="st"> </span><span class="kw">cos</span>(u_[i])</span>
<span id="cb8-84"><a href="#cb8-84"></a>      z &lt;-<span class="st"> </span>myz <span class="op">*</span><span class="st"> </span><span class="kw">sqrt</span>(c2<span class="op">-</span>t_) <span class="op">*</span><span class="st"> </span><span class="kw">sin</span>(u_[i])</span>
<span id="cb8-85"><a href="#cb8-85"></a>      M &lt;-<span class="st"> </span><span class="kw">rbind</span>(<span class="kw">cbind</span>(x, y, z), <span class="kw">cbind</span>(x, <span class="op">-</span>y, <span class="op">-</span>z)[(npoints<span class="dv">-1</span>)<span class="op">:</span>1L,])</span>
<span id="cb8-86"><a href="#cb8-86"></a>      out[[<span class="dv">2</span><span class="op">*</span>nv<span class="op">+</span>i]] &lt;-<span class="st"> </span><span class="cf">if</span>(exchange) M[,<span class="kw">c</span>(1L,3L,2L)] <span class="cf">else</span> M</span>
<span id="cb8-87"><a href="#cb8-87"></a>      <span class="cf">if</span>(i <span class="op">&lt;</span><span class="st"> </span>nu){</span>
<span id="cb8-88"><a href="#cb8-88"></a>        out[[<span class="dv">2</span><span class="op">*</span>nv<span class="op">+</span>nu<span class="op">+</span>i]] &lt;-<span class="st"> </span><span class="cf">if</span>(exchange) </span>
<span id="cb8-89"><a href="#cb8-89"></a>          <span class="kw">cbind</span>(M[,<span class="kw">c</span>(1L,3L)], <span class="op">-</span>M[,2L]) </span>
<span id="cb8-90"><a href="#cb8-90"></a>        <span class="cf">else</span> </span>
<span id="cb8-91"><a href="#cb8-91"></a>          <span class="kw">cbind</span>(M[,1L], <span class="op">-</span>M[,2L], M[,3L])</span>
<span id="cb8-92"><a href="#cb8-92"></a>      }</span>
<span id="cb8-93"><a href="#cb8-93"></a>    }</span>
<span id="cb8-94"><a href="#cb8-94"></a>  }</span>
<span id="cb8-95"><a href="#cb8-95"></a>  <span class="co">#</span></span>
<span id="cb8-96"><a href="#cb8-96"></a>  out[(<span class="dv">2</span><span class="op">*</span>nv<span class="op">+</span><span class="dv">2</span><span class="op">*</span>nu)<span class="op">:</span>(<span class="dv">2</span><span class="op">*</span>nv<span class="op">+</span><span class="dv">4</span><span class="op">*</span>nu<span class="dv">-2</span>)] &lt;-<span class="st"> </span></span>
<span id="cb8-97"><a href="#cb8-97"></a><span class="st">    </span><span class="kw">lapply</span>(out[(<span class="dv">2</span><span class="op">*</span>nv<span class="op">+</span><span class="dv">1</span>)<span class="op">:</span>(<span class="dv">2</span><span class="op">*</span>nv<span class="op">+</span><span class="dv">2</span><span class="op">*</span>nu<span class="dv">-1</span>)], <span class="cf">function</span>(M){</span>
<span id="cb8-98"><a href="#cb8-98"></a>      <span class="kw">cbind</span>(<span class="op">-</span>M[,1L], M[,<span class="kw">c</span>(2L,3L)])</span>
<span id="cb8-99"><a href="#cb8-99"></a>    })</span>
<span id="cb8-100"><a href="#cb8-100"></a>  out</span>
<span id="cb8-101"><a href="#cb8-101"></a>}</span></code></pre></div>
<p>An example:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1"></a>a =<span class="st"> </span><span class="dv">6</span>; b =<span class="st"> </span><span class="dv">5</span>; c =<span class="st"> </span><span class="dv">3</span></span>
<span id="cb9-2"><a href="#cb9-2"></a>sgntr =<span class="st"> &quot;-+-&quot;</span></span>
<span id="cb9-3"><a href="#cb9-3"></a>mesh &lt;-<span class="st"> </span><span class="kw">twoSheetsHyperboloidMesh</span>(a, b, c, sgntr, <span class="dv">100</span>, <span class="dv">100</span>, <span class="dt">vmin =</span> <span class="dv">-500</span>)</span>
<span id="cb9-4"><a href="#cb9-4"></a>clines &lt;-<span class="st"> </span><span class="kw">curvatureLinesH2</span>(a, b, c, sgntr, <span class="dt">nu =</span> <span class="dv">5</span>, <span class="dt">nv =</span> <span class="dv">5</span>, <span class="dt">vmin =</span> <span class="dv">-500</span>, </span>
<span id="cb9-5"><a href="#cb9-5"></a>                           <span class="dt">du =</span> <span class="dv">1</span>, <span class="dt">dv =</span> <span class="dv">20</span>, <span class="dt">npoints =</span> <span class="dv">300</span>)</span>
<span id="cb9-6"><a href="#cb9-6"></a><span class="kw">shade3d</span>(mesh, <span class="dt">color =</span> <span class="st">&quot;navyblue&quot;</span>, <span class="dt">back =</span> <span class="st">&quot;culled&quot;</span>) </span>
<span id="cb9-7"><a href="#cb9-7"></a><span class="kw">shade3d</span>(mesh, <span class="dt">color =</span> <span class="st">&quot;goldenrod&quot;</span>, <span class="dt">front =</span> <span class="st">&quot;culled&quot;</span>)</span>
<span id="cb9-8"><a href="#cb9-8"></a><span class="kw">invisible</span>(<span class="kw">lapply</span>(clines, <span class="cf">function</span>(l){</span>
<span id="cb9-9"><a href="#cb9-9"></a>  <span class="kw">shade3d</span>(<span class="kw">cylinder3d</span>(l, <span class="dt">radius =</span> <span class="fl">0.2</span>, <span class="dt">sides =</span> <span class="dv">30</span>))</span>
<span id="cb9-10"><a href="#cb9-10"></a>}))</span></code></pre></div>
<p><img src="figures/quadrics_H2.png" /></p>
<h1 id="general-quadric">General quadric</h1>
<p>A general quadric in <span class="math inline">\(\mathbb{R}^3\)</span> has equation <span class="math display">\[
(x \quad y \quad z)\, A 
\begin{pmatrix} x \\ y \\ z \end{pmatrix} 
+ J' \begin{pmatrix} x \\ y \\ z \end{pmatrix}
+ K = 0,
\]</span> where <span class="math inline">\(A\)</span> is a symmetric <span class="math inline">\((3\times 3)\)</span>-matrix, <span class="math inline">\(J \in \mathbb{R}^3\)</span>, and <span class="math inline">\(K \in \mathbb{R}\)</span>. Let‚Äôs treat an example. We follow the strategy given at page 45 of Brannan &amp; al‚Äôs book <em>Geometry</em> (<a href="http://math.haifa.ac.il/ROVENSKI/B2.pdf">pdf</a>).</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1"></a>A =<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">c</span>(</span>
<span id="cb10-2"><a href="#cb10-2"></a>   <span class="dv">5</span>, <span class="dv">-1</span>, <span class="dv">-1</span>, </span>
<span id="cb10-3"><a href="#cb10-3"></a>  <span class="dv">-1</span>,  <span class="dv">3</span>,  <span class="dv">1</span>,</span>
<span id="cb10-4"><a href="#cb10-4"></a>  <span class="dv">-1</span>,  <span class="dv">1</span>, <span class="dv">-3</span></span>
<span id="cb10-5"><a href="#cb10-5"></a>  ), <span class="dt">nrow =</span> 3L, <span class="dt">ncol =</span> 3L)</span>
<span id="cb10-6"><a href="#cb10-6"></a>J =<span class="st"> </span><span class="kw">c</span>(<span class="dv">4</span>, <span class="dv">6</span>, <span class="dv">8</span>)</span>
<span id="cb10-7"><a href="#cb10-7"></a>K =<span class="st"> </span><span class="dv">-10</span></span>
<span id="cb10-8"><a href="#cb10-8"></a><span class="co"># computes spectral decomposition of A</span></span>
<span id="cb10-9"><a href="#cb10-9"></a>eig &lt;-<span class="st"> </span><span class="kw">eigen</span>(A)</span>
<span id="cb10-10"><a href="#cb10-10"></a>P &lt;-<span class="st"> </span>eig<span class="op">$</span>vectors</span>
<span id="cb10-11"><a href="#cb10-11"></a>( evalues &lt;-<span class="st"> </span>eig<span class="op">$</span>values )</span>
<span id="cb10-12"><a href="#cb10-12"></a><span class="co">## [1]  5.614627  2.632676 -3.247303</span></span></code></pre></div>
<p>There is no eigenvalue equal to <span class="math inline">\(0\)</span>; this is the first necessary condition in order for the solution of the equation to be a focal quadric.</p>
<p>Now we write the equation in the form <span class="math display">\[
\lambda_1 {(x'')}^2 + \lambda_2 {(y'')}^2 + \lambda_3 {(z'')}^2 = 
\mathrm{rhs}
\]</span> where <span class="math inline">\(\lambda_1\)</span>, <span class="math inline">\(\lambda_2\)</span>, <span class="math inline">\(\lambda_3\)</span> are the eigenvalues of <span class="math inline">\(A\)</span>, and <span class="math inline">\((x'',y'',z'')\)</span> is a new coordinate system.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1"></a>center &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="kw">t</span>(J) <span class="op">%*%</span><span class="st"> </span>P) <span class="op">/</span><span class="st"> </span>evalues <span class="op">/</span><span class="st"> </span><span class="dv">2</span></span>
<span id="cb11-2"><a href="#cb11-2"></a>( rhs &lt;-<span class="st"> </span><span class="kw">sum</span>(evalues <span class="op">*</span><span class="st"> </span>center<span class="op">^</span><span class="dv">2</span>) <span class="op">-</span><span class="st"> </span>K )</span>
<span id="cb11-3"><a href="#cb11-3"></a><span class="co">## [1] 11.5</span></span></code></pre></div>
<div class="sourceCode" id="cb12"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1"></a>( sgntr &lt;-<span class="st"> </span><span class="kw">paste0</span>(<span class="kw">ifelse</span>(rhs<span class="op">*</span>evalues <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>, <span class="st">&quot;+&quot;</span>, <span class="st">&quot;-&quot;</span>), <span class="dt">collapse =</span> <span class="st">&quot;&quot;</span>) )</span>
<span id="cb12-2"><a href="#cb12-2"></a><span class="co">## [1] &quot;++-&quot;</span></span></code></pre></div>
<p>We find <span class="math inline">\(\mathrm{rhs} \neq 0\)</span>, so the solution of the equation is a focal quadric. If <span class="math inline">\(\mathrm{rhs} = 0\)</span>, the solution is a cone.</p>
<p>The signature is <span class="math inline">\(++-\)</span>, so the solution of the equation is a one-sheeted hyperboloid. By dividing both members of the previous equality by <span class="math inline">\(\mathrm{rhs}\)</span>, we get its equation in standard form.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1"></a>abc &lt;-<span class="st"> </span><span class="kw">sqrt</span>(<span class="kw">abs</span>(rhs<span class="op">/</span>evalues))</span>
<span id="cb13-2"><a href="#cb13-2"></a>a &lt;-<span class="st"> </span>abc[<span class="dv">1</span>]; b &lt;-<span class="st"> </span>abc[<span class="dv">2</span>]; c &lt;-<span class="st"> </span>abc[<span class="dv">3</span>]</span>
<span id="cb13-3"><a href="#cb13-3"></a>mesh0 &lt;-<span class="st"> </span><span class="kw">hyperboloidMesh</span>(a, b, c, sgntr, <span class="dv">100</span>, <span class="dv">100</span>, <span class="dv">-5</span>)</span>
<span id="cb13-4"><a href="#cb13-4"></a><span class="co"># final quadric mesh:</span></span>
<span id="cb13-5"><a href="#cb13-5"></a>mesh &lt;-<span class="st"> </span><span class="kw">rotate3d</span>(</span>
<span id="cb13-6"><a href="#cb13-6"></a>  <span class="kw">translate3d</span>(mesh0, <span class="op">-</span>center[<span class="dv">1</span>], <span class="op">-</span>center[<span class="dv">2</span>], <span class="op">-</span>center[<span class="dv">3</span>]), </span>
<span id="cb13-7"><a href="#cb13-7"></a>  <span class="dt">matrix =</span> <span class="kw">t</span>(P)</span>
<span id="cb13-8"><a href="#cb13-8"></a>)</span></code></pre></div>
<p>We can check that the equation is fulfilled for some vertices of the final mesh:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1"></a><span class="kw">apply</span>(mesh<span class="op">$</span>vb[<span class="op">-</span><span class="dv">4</span>, <span class="dv">1</span><span class="op">:</span><span class="dv">5</span>], 2L, <span class="cf">function</span>(x){</span>
<span id="cb14-2"><a href="#cb14-2"></a>  <span class="kw">c</span>(<span class="kw">t</span>(x) <span class="op">%*%</span><span class="st"> </span>A <span class="op">%*%</span><span class="st"> </span>x <span class="op">+</span><span class="st"> </span><span class="kw">t</span>(J) <span class="op">%*%</span><span class="st"> </span>x) <span class="op">+</span><span class="st"> </span>K</span>
<span id="cb14-3"><a href="#cb14-3"></a>})</span>
<span id="cb14-4"><a href="#cb14-4"></a><span class="co">## [1] 5.684342e-14 7.105427e-14 4.973799e-14 4.973799e-14 4.263256e-14</span></span></code></pre></div>
<p>Up to small numerical errors, we indeed get <span class="math inline">\(0\)</span> for each of the five vertices.</p>

        </div>


        <div id="footer">
          Site proudly generated by
          <a href="http://jaspervdj.be/hakyll">Hakyll</a>
        </div>

      </div>

    </div>

    <div class="row">
      <div class="col-sm-12">
        <div id="disqus_thread"></div>
        <div class="pagination">
          <ul>
            <li>
              <a href="http://laustep.github.io/stlahblog/">¬´ Back Home</a>
            </li>
          </ul>
        </div>
      </div>
    </div>
    
  </div>

</body>

<script src="../libraries/bootstrap/bootstrap.min.js"></script>
<script>
  var disqus_developer = 1;
  var disqus_shortname = 'stlapblog';
  // required: replace example with your forum shortname
  /* * * DON'T EDIT BELOW THIS LINE * * */
  (function () {
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = 'https://' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] ||
      document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>
<noscript>Please enable JavaScript to view the
  <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a>
</noscript>
<!-- MathJax: Fall back to local if CDN offline but local image fonts are not supported (saves >100MB) -->
<script type="text/x-mathjax-config" src="../libraries/mathjax/config/TeX-MML-AM_CHTML.js"></script>
<!-- <script>
  window.MathJax || document.write('<script type="text/x-mathjax-config">MathJax.Hub.Config({"HTML-CSS":{imageFont:null}});<\/script><script src="../libraries/mathjax/MathJax.js"><\/script>');
</script> -->


</html>