<!DOCTYPE HTML>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Saturn Elephant - Child tables with DT, editing, exporting</title>
  <link href="../libraries/bootstrap/bootstrap-grid.min.css" rel="stylesheet">
  <link rel="stylesheet" href="../css/post.css" />
  <link rel="stylesheet" href="../css/misc.css" /> 
  
    <link rel="stylesheet" href="../css/pandoc-solarized.css" /> 
   
  
    <link href="../libraries/highlighters/prettify/css/minimal.css" rel="stylesheet"> 
  
  <link href="https://fonts.googleapis.com/css?family=Raleway:400,600,200,800" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/css?family=Droid+Sans" rel="stylesheet" type="text/css">
  <script src="../libraries/jquery.min.js"></script>
  <script type="text/javascript" async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML"></script>
</head>

<body>
  <div class="container-fluid">
    <div class="row">
      <!-- Sidebar. -->
      <div class="sidebar col-sm-3">
        <div style="float:right;clear:both;margin-right:50px;margin-top:150px;">
          <a href="https://www.r-bloggers.com/">
            <img src="https://www.r-bloggers.com/wp-content/uploads/2016/04/R_02_2016-05-01.png" alt="stla" width="100%" />
          </a>
          <br />
          <a href="http://t-redactyl.io/">
            <span style="color:black;font-weight:bold;font-family:sans-serif;font-size:29px;">Standard error</span>
          </a>
          <a href="http://timelyportfolio.blogspot.be/">
            <span style="color:grey;font-weight:bold;font-family:sans-serif;font-size:27px;">Timely portfolio</span>
          </a>
          <br />
          <a href="https://antoineguillot.wordpress.com/blog/">
            <span style="color:white;background-color:darkblue;font-weight:bold;font-family:sans-serif;font-size:25px;border:5px solid;border-color:darkblue">ENHANCE DATA</span>
          </a>
          <br />
          <a href="https://fronkonstin.com/">
            <span style="color:black;background-color:gold;font-weight:bold;font-size:32px;border:3px solid;border-color:gold;">Fronkonstin</span>
          </a>
        </div>
      </div>

      <div class="main col-sm-9">
        <div id="header">
          <div id="logo" style="position:absolute;">
            <a href="../">
              <img src="../images/stla.jpg" alt="stla" width="100px" />
            </a>
          </div>
          <div id="navigation" style="margin-top:50px;">
            <a href="../">Home</a>
            <a href="../about.html">About</a>
            <a href="../contact.html">Contact</a>
            <a href="../archive.html">Archive</a>
          </div>
        </div>

        <div class="content">
          <h1>Child tables with DT, editing, exporting</h1> 
          <div class="info">
    Posted on May  8, 2020
    
        by Stéphane Laurent
    
</div>
<div class="info">
    
    Tags: <a href="../tags/R.html">R</a>, <a href="../tags/datatables.html">datatables</a>, <a href="../tags/shiny.html">shiny</a>, <a href="../tags/javascript.html">javascript</a>
    
</div>

<p>I’m going to show how to use the <code>DT</code> package to do a table with child tables, and how to edit and export such a table.</p>
<p>In order to do a table with child tables, one adds a list column to the dataframe of the main table; each cell of this column contains the child table of the corresponding row, given as a list. This is done by the <code>NestedData</code> function below.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" title="1">NestedData &lt;-<span class="st"> </span><span class="cf">function</span>(dat, children){</a>
<a class="sourceLine" id="cb1-2" title="2">  <span class="kw">stopifnot</span>(<span class="kw">length</span>(children) <span class="op">==</span><span class="st"> </span><span class="kw">nrow</span>(dat))</a>
<a class="sourceLine" id="cb1-3" title="3">  g &lt;-<span class="st"> </span><span class="cf">function</span>(d){</a>
<a class="sourceLine" id="cb1-4" title="4">    <span class="cf">if</span>(<span class="kw">is.data.frame</span>(d)){</a>
<a class="sourceLine" id="cb1-5" title="5">      purrr<span class="op">::</span><span class="kw">transpose</span>(d)</a>
<a class="sourceLine" id="cb1-6" title="6">    }<span class="cf">else</span>{</a>
<a class="sourceLine" id="cb1-7" title="7">      purrr<span class="op">::</span><span class="kw">transpose</span>(<span class="kw">NestedData</span>(d[[<span class="dv">1</span>]], <span class="dt">children =</span> d<span class="op">$</span>children))</a>
<a class="sourceLine" id="cb1-8" title="8">    }</a>
<a class="sourceLine" id="cb1-9" title="9">  }</a>
<a class="sourceLine" id="cb1-10" title="10">  subdats &lt;-<span class="st"> </span><span class="kw">lapply</span>(children, g)</a>
<a class="sourceLine" id="cb1-11" title="11">  oplus &lt;-<span class="st"> </span><span class="kw">ifelse</span>(<span class="kw">lengths</span>(subdats), <span class="st">&quot;&amp;oplus;&quot;</span>, <span class="st">&quot;&quot;</span>) </a>
<a class="sourceLine" id="cb1-12" title="12">  <span class="kw">cbind</span>(<span class="st">&quot; &quot;</span> =<span class="st"> </span>oplus, dat, <span class="st">&quot;_details&quot;</span> =<span class="st"> </span><span class="kw">I</span>(subdats), </a>
<a class="sourceLine" id="cb1-13" title="13">        <span class="dt">stringsAsFactors =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb1-14" title="14">}</a></code></pre></div>
<p>The usage of <code>NestedData</code> is easy to understand with an example:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" title="1">dat0   =<span class="st"> </span>iris[<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>,]        <span class="co"># main table, with three rows</span></a>
<a class="sourceLine" id="cb2-2" title="2">dat01  =<span class="st"> </span>airquality[<span class="dv">1</span><span class="op">:</span><span class="dv">4</span>,]  <span class="co"># |- child of first row</span></a>
<a class="sourceLine" id="cb2-3" title="3">dat02  =<span class="st"> </span>cars[<span class="dv">1</span><span class="op">:</span><span class="dv">2</span>,]        <span class="co"># |- child of second row, with two rows</span></a>
<a class="sourceLine" id="cb2-4" title="4">dat021 =<span class="st"> </span>mtcars[<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>,]      <span class="co"># |  |- child of first row of dat02</span></a>
<a class="sourceLine" id="cb2-5" title="5">dat022 =<span class="st"> </span>PlantGrowth[<span class="dv">1</span><span class="op">:</span><span class="dv">4</span>,] <span class="co"># |  |- child of second row of dat02</span></a>
<a class="sourceLine" id="cb2-6" title="6">dat03  =<span class="st"> </span><span class="kw">data.frame</span>(<span class="ot">NULL</span>)  <span class="co"># |- third row has no child</span></a>
<a class="sourceLine" id="cb2-7" title="7"></a>
<a class="sourceLine" id="cb2-8" title="8">Dat &lt;-<span class="st"> </span><span class="kw">NestedData</span>(</a>
<a class="sourceLine" id="cb2-9" title="9">  <span class="dt">dat =</span> dat0, </a>
<a class="sourceLine" id="cb2-10" title="10">  <span class="dt">children =</span> <span class="kw">list</span>(</a>
<a class="sourceLine" id="cb2-11" title="11">    dat01, </a>
<a class="sourceLine" id="cb2-12" title="12">    <span class="kw">list</span>(  </a>
<a class="sourceLine" id="cb2-13" title="13">      dat02, </a>
<a class="sourceLine" id="cb2-14" title="14">      <span class="dt">children =</span> <span class="kw">list</span>(</a>
<a class="sourceLine" id="cb2-15" title="15">        dat021, </a>
<a class="sourceLine" id="cb2-16" title="16">        dat022</a>
<a class="sourceLine" id="cb2-17" title="17">      )</a>
<a class="sourceLine" id="cb2-18" title="18">    ), </a>
<a class="sourceLine" id="cb2-19" title="19">    dat03 </a>
<a class="sourceLine" id="cb2-20" title="20">  )</a>
<a class="sourceLine" id="cb2-21" title="21">)</a></code></pre></div>
<p>Now we define the JavaScript callback which will be used. The code depends on whether one wants to display the row names of the main table, so the user has to enter this information before.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" title="1"><span class="kw">library</span>(DT)</a>
<a class="sourceLine" id="cb3-2" title="2"></a>
<a class="sourceLine" id="cb3-3" title="3"><span class="co">## whether to show row names</span></a>
<a class="sourceLine" id="cb3-4" title="4">rowNames =<span class="st"> </span><span class="ot">FALSE</span></a>
<a class="sourceLine" id="cb3-5" title="5">colIdx &lt;-<span class="st"> </span><span class="kw">as.integer</span>(rowNames)</a>
<a class="sourceLine" id="cb3-6" title="6"></a>
<a class="sourceLine" id="cb3-7" title="7"><span class="co">## the callback</span></a>
<a class="sourceLine" id="cb3-8" title="8">parentRows &lt;-<span class="st"> </span><span class="kw">which</span>(Dat[,<span class="dv">1</span>] <span class="op">!=</span><span class="st"> &quot;&quot;</span>)</a>
<a class="sourceLine" id="cb3-9" title="9">callback &lt;-<span class="st"> </span><span class="kw">JS</span>(</a>
<a class="sourceLine" id="cb3-10" title="10">  <span class="kw">sprintf</span>(<span class="st">&quot;var parentRows = [%s];&quot;</span>, <span class="kw">toString</span>(parentRows<span class="dv">-1</span>)),</a>
<a class="sourceLine" id="cb3-11" title="11">  <span class="kw">sprintf</span>(<span class="st">&quot;var j0 = %d;&quot;</span>, colIdx),</a>
<a class="sourceLine" id="cb3-12" title="12">  <span class="st">&quot;var nrows = table.rows().count();&quot;</span>,</a>
<a class="sourceLine" id="cb3-13" title="13">  <span class="st">&quot;for(let i = 0; i &lt; nrows; ++i){&quot;</span>,</a>
<a class="sourceLine" id="cb3-14" title="14">  <span class="st">&quot;  var $cell = table.cell(i,j0).nodes().to$();&quot;</span>,</a>
<a class="sourceLine" id="cb3-15" title="15">  <span class="st">&quot;  if(parentRows.indexOf(i) &gt; -1){&quot;</span>,</a>
<a class="sourceLine" id="cb3-16" title="16">  <span class="st">&quot;    cell.css({cursor: 'pointer'});&quot;</span>,</a>
<a class="sourceLine" id="cb3-17" title="17">  <span class="st">&quot;  }else{&quot;</span>,</a>
<a class="sourceLine" id="cb3-18" title="18">  <span class="st">&quot;    cell.removeClass('details-control');&quot;</span>,</a>
<a class="sourceLine" id="cb3-19" title="19">  <span class="st">&quot;  }&quot;</span>,</a>
<a class="sourceLine" id="cb3-20" title="20">  <span class="st">&quot;}&quot;</span>,</a>
<a class="sourceLine" id="cb3-21" title="21">  <span class="st">&quot;&quot;</span>,</a>
<a class="sourceLine" id="cb3-22" title="22">  <span class="st">&quot;// --- make the table header of the nested table --- //&quot;</span>,</a>
<a class="sourceLine" id="cb3-23" title="23">  <span class="st">&quot;var formatHeader = function(d, childId){&quot;</span>,</a>
<a class="sourceLine" id="cb3-24" title="24">  <span class="st">&quot;  if(d !== null){&quot;</span>,</a>
<a class="sourceLine" id="cb3-25" title="25">  <span class="st">&quot;    var html = &quot;</span>, </a>
<a class="sourceLine" id="cb3-26" title="26">  <span class="st">&quot;      '&lt;table class=</span><span class="ch">\&quot;</span><span class="st">display compact hover</span><span class="ch">\&quot;</span><span class="st"> ' + &quot;</span>,</a>
<a class="sourceLine" id="cb3-27" title="27">  <span class="st">&quot;      'style=</span><span class="ch">\&quot;</span><span class="st">padding-left: 30px;</span><span class="ch">\&quot;</span><span class="st"> id=</span><span class="ch">\&quot;</span><span class="st">' + childId + &quot;</span>, </a>
<a class="sourceLine" id="cb3-28" title="28">  <span class="st">&quot;      '</span><span class="ch">\&quot;</span><span class="st">&gt;&lt;thead&gt;&lt;tr&gt;';&quot;</span>,</a>
<a class="sourceLine" id="cb3-29" title="29">  <span class="st">&quot;    var data = d[d.length-1] || d._details;&quot;</span>,</a>
<a class="sourceLine" id="cb3-30" title="30">  <span class="st">&quot;    for(let key in data[0]){&quot;</span>,</a>
<a class="sourceLine" id="cb3-31" title="31">  <span class="st">&quot;      html += '&lt;th&gt;' + key + '&lt;/th&gt;';&quot;</span>,</a>
<a class="sourceLine" id="cb3-32" title="32">  <span class="st">&quot;    }&quot;</span>,</a>
<a class="sourceLine" id="cb3-33" title="33">  <span class="st">&quot;    html += '&lt;/tr&gt;&lt;/thead&gt;&lt;/table&gt;'&quot;</span>,</a>
<a class="sourceLine" id="cb3-34" title="34">  <span class="st">&quot;    return html;&quot;</span>,</a>
<a class="sourceLine" id="cb3-35" title="35">  <span class="st">&quot;  } else {&quot;</span>,</a>
<a class="sourceLine" id="cb3-36" title="36">  <span class="st">&quot;    return '';&quot;</span>,</a>
<a class="sourceLine" id="cb3-37" title="37">  <span class="st">&quot;  }&quot;</span>,</a>
<a class="sourceLine" id="cb3-38" title="38">  <span class="st">&quot;};&quot;</span>,</a>
<a class="sourceLine" id="cb3-39" title="39">  <span class="st">&quot;&quot;</span>,</a>
<a class="sourceLine" id="cb3-40" title="40">  <span class="st">&quot;// --- row callback to style rows of child tables --- //&quot;</span>,</a>
<a class="sourceLine" id="cb3-41" title="41">  <span class="st">&quot;var rowCallback = function(row, dat, displayNum, index){&quot;</span>,</a>
<a class="sourceLine" id="cb3-42" title="42">  <span class="st">&quot;  if($(row).hasClass('odd')){&quot;</span>,</a>
<a class="sourceLine" id="cb3-43" title="43">  <span class="st">&quot;    $(row).css('background-color', 'papayawhip');&quot;</span>,</a>
<a class="sourceLine" id="cb3-44" title="44">  <span class="st">&quot;    $(row).hover(function(){&quot;</span>,</a>
<a class="sourceLine" id="cb3-45" title="45">  <span class="st">&quot;      $(this).css('background-color', '#E6FF99');&quot;</span>,</a>
<a class="sourceLine" id="cb3-46" title="46">  <span class="st">&quot;    }, function(){&quot;</span>,</a>
<a class="sourceLine" id="cb3-47" title="47">  <span class="st">&quot;      $(this).css('background-color', 'papayawhip');&quot;</span>,</a>
<a class="sourceLine" id="cb3-48" title="48">  <span class="st">&quot;    });&quot;</span>,</a>
<a class="sourceLine" id="cb3-49" title="49">  <span class="st">&quot;  } else {&quot;</span>,</a>
<a class="sourceLine" id="cb3-50" title="50">  <span class="st">&quot;    $(row).css('background-color', 'lemonchiffon');&quot;</span>,</a>
<a class="sourceLine" id="cb3-51" title="51">  <span class="st">&quot;    $(row).hover(function(){&quot;</span>,</a>
<a class="sourceLine" id="cb3-52" title="52">  <span class="st">&quot;      $(this).css('background-color', '#DDFF75');&quot;</span>,</a>
<a class="sourceLine" id="cb3-53" title="53">  <span class="st">&quot;    }, function(){&quot;</span>,</a>
<a class="sourceLine" id="cb3-54" title="54">  <span class="st">&quot;      $(this).css('background-color', 'lemonchiffon');&quot;</span>,</a>
<a class="sourceLine" id="cb3-55" title="55">  <span class="st">&quot;    });&quot;</span>,</a>
<a class="sourceLine" id="cb3-56" title="56">  <span class="st">&quot;  }&quot;</span>,</a>
<a class="sourceLine" id="cb3-57" title="57">  <span class="st">&quot;};&quot;</span>,</a>
<a class="sourceLine" id="cb3-58" title="58">  <span class="st">&quot;&quot;</span>,</a>
<a class="sourceLine" id="cb3-59" title="59">  <span class="st">&quot;// --- header callback to style header of child tables --- //&quot;</span>,</a>
<a class="sourceLine" id="cb3-60" title="60">  <span class="st">&quot;var headerCallback = function(thead, data, start, end, display){&quot;</span>,</a>
<a class="sourceLine" id="cb3-61" title="61">  <span class="st">&quot;  $('th', thead).css({&quot;</span>,</a>
<a class="sourceLine" id="cb3-62" title="62">  <span class="st">&quot;    'border-top': '3px solid indigo',&quot;</span>, </a>
<a class="sourceLine" id="cb3-63" title="63">  <span class="st">&quot;    'color': 'indigo',&quot;</span>,</a>
<a class="sourceLine" id="cb3-64" title="64">  <span class="st">&quot;    'background-color': '#fadadd'&quot;</span>,</a>
<a class="sourceLine" id="cb3-65" title="65">  <span class="st">&quot;  });&quot;</span>,</a>
<a class="sourceLine" id="cb3-66" title="66">  <span class="st">&quot;};&quot;</span>,</a>
<a class="sourceLine" id="cb3-67" title="67">  <span class="st">&quot;&quot;</span>,</a>
<a class="sourceLine" id="cb3-68" title="68">  <span class="st">&quot;// --- make the datatable --- //&quot;</span>,</a>
<a class="sourceLine" id="cb3-69" title="69">  <span class="st">&quot;var formatDatatable = function(d, childId){&quot;</span>,</a>
<a class="sourceLine" id="cb3-70" title="70">  <span class="st">&quot;  var data = d[d.length-1] || d._details;&quot;</span>,</a>
<a class="sourceLine" id="cb3-71" title="71">  <span class="st">&quot;  var colNames = Object.keys(data[0]);&quot;</span>,</a>
<a class="sourceLine" id="cb3-72" title="72">  <span class="st">&quot;  var columns = colNames.map(function(x){&quot;</span>,</a>
<a class="sourceLine" id="cb3-73" title="73">  <span class="st">&quot;    return {data: x.replace(/</span><span class="ch">\\</span><span class="st">./g, '</span><span class="ch">\\\\\\</span><span class="st">.'), title: x};&quot;</span>,</a>
<a class="sourceLine" id="cb3-74" title="74">  <span class="st">&quot;  });&quot;</span>,</a>
<a class="sourceLine" id="cb3-75" title="75">  <span class="st">&quot;  var id = 'table#' + childId;&quot;</span>,</a>
<a class="sourceLine" id="cb3-76" title="76">  <span class="st">&quot;  if(colNames.indexOf('_details') === -1){&quot;</span>,</a>
<a class="sourceLine" id="cb3-77" title="77">  <span class="st">&quot;    var subtable = $(id).DataTable({&quot;</span>,</a>
<a class="sourceLine" id="cb3-78" title="78">  <span class="st">&quot;      'data': data,&quot;</span>,</a>
<a class="sourceLine" id="cb3-79" title="79">  <span class="st">&quot;      'columns': columns,&quot;</span>,</a>
<a class="sourceLine" id="cb3-80" title="80">  <span class="st">&quot;      'autoWidth': true,&quot;</span>,</a>
<a class="sourceLine" id="cb3-81" title="81">  <span class="st">&quot;      'deferRender': true,&quot;</span>,</a>
<a class="sourceLine" id="cb3-82" title="82">  <span class="st">&quot;      'info': false,&quot;</span>,</a>
<a class="sourceLine" id="cb3-83" title="83">  <span class="st">&quot;      'lengthChange': false,&quot;</span>,</a>
<a class="sourceLine" id="cb3-84" title="84">  <span class="st">&quot;      'ordering': data.length &gt; 1,&quot;</span>,</a>
<a class="sourceLine" id="cb3-85" title="85">  <span class="st">&quot;      'order': [],&quot;</span>,</a>
<a class="sourceLine" id="cb3-86" title="86">  <span class="st">&quot;      'paging': false,&quot;</span>,</a>
<a class="sourceLine" id="cb3-87" title="87">  <span class="st">&quot;      'scrollX': false,&quot;</span>,</a>
<a class="sourceLine" id="cb3-88" title="88">  <span class="st">&quot;      'scrollY': false,&quot;</span>,</a>
<a class="sourceLine" id="cb3-89" title="89">  <span class="st">&quot;      'searching': false,&quot;</span>,</a>
<a class="sourceLine" id="cb3-90" title="90">  <span class="st">&quot;      'sortClasses': false,&quot;</span>,</a>
<a class="sourceLine" id="cb3-91" title="91">  <span class="st">&quot;      'rowCallback': rowCallback,&quot;</span>,</a>
<a class="sourceLine" id="cb3-92" title="92">  <span class="st">&quot;      'headerCallback': headerCallback,&quot;</span>,</a>
<a class="sourceLine" id="cb3-93" title="93">  <span class="st">&quot;      'columnDefs': [{targets: '_all', className: 'dt-center'}]&quot;</span>,</a>
<a class="sourceLine" id="cb3-94" title="94">  <span class="st">&quot;    });&quot;</span>,</a>
<a class="sourceLine" id="cb3-95" title="95">  <span class="st">&quot;  } else {&quot;</span>,</a>
<a class="sourceLine" id="cb3-96" title="96">  <span class="st">&quot;    var subtable = $(id).DataTable({&quot;</span>,</a>
<a class="sourceLine" id="cb3-97" title="97">  <span class="st">&quot;      'data': data,&quot;</span>,</a>
<a class="sourceLine" id="cb3-98" title="98">  <span class="st">&quot;      'columns': columns,&quot;</span>,</a>
<a class="sourceLine" id="cb3-99" title="99">  <span class="st">&quot;      'autoWidth': true,&quot;</span>,</a>
<a class="sourceLine" id="cb3-100" title="100">  <span class="st">&quot;      'deferRender': true,&quot;</span>,</a>
<a class="sourceLine" id="cb3-101" title="101">  <span class="st">&quot;      'info': false,&quot;</span>,</a>
<a class="sourceLine" id="cb3-102" title="102">  <span class="st">&quot;      'lengthChange': false,&quot;</span>,</a>
<a class="sourceLine" id="cb3-103" title="103">  <span class="st">&quot;      'ordering': data.length &gt; 1,&quot;</span>,</a>
<a class="sourceLine" id="cb3-104" title="104">  <span class="st">&quot;      'order': [],&quot;</span>,</a>
<a class="sourceLine" id="cb3-105" title="105">  <span class="st">&quot;      'paging': false,&quot;</span>,</a>
<a class="sourceLine" id="cb3-106" title="106">  <span class="st">&quot;      'scrollX': false,&quot;</span>,</a>
<a class="sourceLine" id="cb3-107" title="107">  <span class="st">&quot;      'scrollY': false,&quot;</span>,</a>
<a class="sourceLine" id="cb3-108" title="108">  <span class="st">&quot;      'searching': false,&quot;</span>,</a>
<a class="sourceLine" id="cb3-109" title="109">  <span class="st">&quot;      'sortClasses': false,&quot;</span>,</a>
<a class="sourceLine" id="cb3-110" title="110">  <span class="st">&quot;      'rowCallback': rowCallback,&quot;</span>,</a>
<a class="sourceLine" id="cb3-111" title="111">  <span class="st">&quot;      'headerCallback': headerCallback,&quot;</span>,</a>
<a class="sourceLine" id="cb3-112" title="112">  <span class="st">&quot;      'columnDefs': [&quot;</span>, </a>
<a class="sourceLine" id="cb3-113" title="113">  <span class="st">&quot;        {targets: -1, visible: false},&quot;</span>, </a>
<a class="sourceLine" id="cb3-114" title="114">  <span class="st">&quot;        {targets: 0, orderable: false, className: 'details-control'},&quot;</span>, </a>
<a class="sourceLine" id="cb3-115" title="115">  <span class="st">&quot;        {targets: '_all', className: 'dt-center'}&quot;</span>,</a>
<a class="sourceLine" id="cb3-116" title="116">  <span class="st">&quot;      ]&quot;</span>,</a>
<a class="sourceLine" id="cb3-117" title="117">  <span class="st">&quot;    }).column(0).nodes().to$().css({cursor: 'pointer'});&quot;</span>,</a>
<a class="sourceLine" id="cb3-118" title="118">  <span class="st">&quot;  }&quot;</span>,</a>
<a class="sourceLine" id="cb3-119" title="119">  <span class="st">&quot;};&quot;</span>,</a>
<a class="sourceLine" id="cb3-120" title="120">  <span class="st">&quot;&quot;</span>,</a>
<a class="sourceLine" id="cb3-121" title="121">  <span class="st">&quot;// --- display the child table on click --- //&quot;</span>,</a>
<a class="sourceLine" id="cb3-122" title="122">  <span class="st">&quot;// array to store id's of already created child tables&quot;</span>,</a>
<a class="sourceLine" id="cb3-123" title="123">  <span class="st">&quot;var children = [];&quot;</span>, </a>
<a class="sourceLine" id="cb3-124" title="124">  <span class="st">&quot;table.on('click', 'td.details-control', function(){&quot;</span>,</a>
<a class="sourceLine" id="cb3-125" title="125">  <span class="st">&quot;  var tbl = $(this).closest('table'),&quot;</span>,</a>
<a class="sourceLine" id="cb3-126" title="126">  <span class="st">&quot;      tblId = tbl.attr('id'),&quot;</span>,</a>
<a class="sourceLine" id="cb3-127" title="127">  <span class="st">&quot;      td = $(this),&quot;</span>,</a>
<a class="sourceLine" id="cb3-128" title="128">  <span class="st">&quot;      row = $(tbl).DataTable().row(td.closest('tr')),&quot;</span>,</a>
<a class="sourceLine" id="cb3-129" title="129">  <span class="st">&quot;      rowIdx = row.index();&quot;</span>,</a>
<a class="sourceLine" id="cb3-130" title="130">  <span class="st">&quot;  if(row.child.isShown()){&quot;</span>,</a>
<a class="sourceLine" id="cb3-131" title="131">  <span class="st">&quot;    row.child.hide();&quot;</span>,</a>
<a class="sourceLine" id="cb3-132" title="132">  <span class="st">&quot;    td.html('&amp;oplus;');&quot;</span>,</a>
<a class="sourceLine" id="cb3-133" title="133">  <span class="st">&quot;  } else {&quot;</span>,</a>
<a class="sourceLine" id="cb3-134" title="134">  <span class="st">&quot;    var childId = tblId + '-child-' + rowIdx;&quot;</span>,</a>
<a class="sourceLine" id="cb3-135" title="135">  <span class="st">&quot;    if(children.indexOf(childId) === -1){&quot;</span>, </a>
<a class="sourceLine" id="cb3-136" title="136">  <span class="st">&quot;      // this child has not been created yet&quot;</span>,</a>
<a class="sourceLine" id="cb3-137" title="137">  <span class="st">&quot;      children.push(childId);&quot;</span>,</a>
<a class="sourceLine" id="cb3-138" title="138">  <span class="st">&quot;      row.child(formatHeader(row.data(), childId)).show();&quot;</span>,</a>
<a class="sourceLine" id="cb3-139" title="139">  <span class="st">&quot;      td.html('&amp;CircleMinus;');&quot;</span>,</a>
<a class="sourceLine" id="cb3-140" title="140">  <span class="st">&quot;      formatDatatable(row.data(), childId, rowIdx);&quot;</span>,</a>
<a class="sourceLine" id="cb3-141" title="141">  <span class="st">&quot;    }else{&quot;</span>,</a>
<a class="sourceLine" id="cb3-142" title="142">  <span class="st">&quot;      // this child has already been created&quot;</span>,</a>
<a class="sourceLine" id="cb3-143" title="143">  <span class="st">&quot;      row.child(true);&quot;</span>,</a>
<a class="sourceLine" id="cb3-144" title="144">  <span class="st">&quot;      td.html('&amp;CircleMinus;');&quot;</span>,</a>
<a class="sourceLine" id="cb3-145" title="145">  <span class="st">&quot;    }&quot;</span>,</a>
<a class="sourceLine" id="cb3-146" title="146">  <span class="st">&quot;  }&quot;</span>,</a>
<a class="sourceLine" id="cb3-147" title="147">  <span class="st">&quot;});&quot;</span>)</a></code></pre></div>
<p>Now, here is the code which generates the table. The first column contains some HTML (⊕) so we have to not escape it. The last column contains the child data, it has to be hidden. Finally we assign the class <code>details-control</code> to the first column, this is used by the callback.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" title="1"><span class="kw">datatable</span>(</a>
<a class="sourceLine" id="cb4-2" title="2">  Dat, </a>
<a class="sourceLine" id="cb4-3" title="3">  <span class="dt">callback =</span> callback, <span class="dt">rownames =</span> rowNames, <span class="dt">escape =</span> <span class="op">-</span>colIdx<span class="dv">-1</span>,</a>
<a class="sourceLine" id="cb4-4" title="4">  <span class="dt">options =</span> <span class="kw">list</span>(</a>
<a class="sourceLine" id="cb4-5" title="5">    <span class="dt">paging =</span> <span class="ot">FALSE</span>,</a>
<a class="sourceLine" id="cb4-6" title="6">    <span class="dt">searching =</span> <span class="ot">FALSE</span>,</a>
<a class="sourceLine" id="cb4-7" title="7">    <span class="dt">columnDefs =</span> <span class="kw">list</span>(</a>
<a class="sourceLine" id="cb4-8" title="8">      <span class="kw">list</span>(</a>
<a class="sourceLine" id="cb4-9" title="9">        <span class="dt">visible =</span> <span class="ot">FALSE</span>, </a>
<a class="sourceLine" id="cb4-10" title="10">        <span class="dt">targets =</span> <span class="kw">ncol</span>(Dat)<span class="op">-</span><span class="dv">1</span><span class="op">+</span>colIdx</a>
<a class="sourceLine" id="cb4-11" title="11">      ),</a>
<a class="sourceLine" id="cb4-12" title="12">      <span class="kw">list</span>(</a>
<a class="sourceLine" id="cb4-13" title="13">        <span class="dt">orderable =</span> <span class="ot">FALSE</span>, </a>
<a class="sourceLine" id="cb4-14" title="14">        <span class="dt">className =</span> <span class="st">&quot;details-control&quot;</span>, </a>
<a class="sourceLine" id="cb4-15" title="15">        <span class="dt">targets =</span> colIdx</a>
<a class="sourceLine" id="cb4-16" title="16">      ),</a>
<a class="sourceLine" id="cb4-17" title="17">      <span class="kw">list</span>(</a>
<a class="sourceLine" id="cb4-18" title="18">        <span class="dt">className =</span> <span class="st">&quot;dt-center&quot;</span>, </a>
<a class="sourceLine" id="cb4-19" title="19">        <span class="dt">targets =</span> <span class="st">&quot;_all&quot;</span></a>
<a class="sourceLine" id="cb4-20" title="20">      )</a>
<a class="sourceLine" id="cb4-21" title="21">    )</a>
<a class="sourceLine" id="cb4-22" title="22">  )</a>
<a class="sourceLine" id="cb4-23" title="23">)</a></code></pre></div>
<p><img src="figures/DTchildRows1.gif" /></p>
<h1 id="editing">Editing</h1>
<p>We use the JavaScript library <a href="https://github.com/ejbeaty/CellEdit">CellEdit</a> to allow cells, including the cells of the child tables, to be editable. Download the file <strong>dataTables.cellEdit.js</strong>.</p>
<p>Some CSS is required in order to make things pretty. Save the following CSS code in a file <strong>dataTables.cellEdit.css</strong>.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode css"><code class="sourceCode css"><a class="sourceLine" id="cb5-1" title="1"><span class="fu">.my-input-class</span> {</a>
<a class="sourceLine" id="cb5-2" title="2">  <span class="kw">padding</span>: <span class="dv">3</span><span class="dt">px</span> <span class="dv">6</span><span class="dt">px</span><span class="op">;</span></a>
<a class="sourceLine" id="cb5-3" title="3">  <span class="kw">border</span>: <span class="dv">1</span><span class="dt">px</span> <span class="dv">solid</span> <span class="cn">#ccc</span><span class="op">;</span></a>
<a class="sourceLine" id="cb5-4" title="4">  <span class="kw">border-radius</span>: <span class="dv">4</span><span class="dt">px</span><span class="op">;</span></a>
<a class="sourceLine" id="cb5-5" title="5">  <span class="kw">width</span>: <span class="dv">60</span><span class="dt">px</span><span class="op">;</span></a>
<a class="sourceLine" id="cb5-6" title="6">}</a>
<a class="sourceLine" id="cb5-7" title="7"></a>
<a class="sourceLine" id="cb5-8" title="8"><span class="fu">.my-confirm-class</span> {</a>
<a class="sourceLine" id="cb5-9" title="9">  <span class="kw">padding</span>: <span class="dv">3</span><span class="dt">px</span> <span class="dv">6</span><span class="dt">px</span><span class="op">;</span></a>
<a class="sourceLine" id="cb5-10" title="10">  <span class="kw">font-size</span>: <span class="dv">12</span><span class="dt">px</span><span class="op">;</span></a>
<a class="sourceLine" id="cb5-11" title="11">  <span class="kw">color</span>: <span class="cn">white</span><span class="op">;</span></a>
<a class="sourceLine" id="cb5-12" title="12">  <span class="kw">text-align</span>: <span class="dv">center</span><span class="op">;</span></a>
<a class="sourceLine" id="cb5-13" title="13">  <span class="kw">vertical-align</span>: <span class="dv">middle</span><span class="op">;</span></a>
<a class="sourceLine" id="cb5-14" title="14">  <span class="kw">border-radius</span>: <span class="dv">4</span><span class="dt">px</span><span class="op">;</span></a>
<a class="sourceLine" id="cb5-15" title="15">  <span class="kw">background-color</span>: <span class="cn">#337ab7</span><span class="op">;</span></a>
<a class="sourceLine" id="cb5-16" title="16">  <span class="kw">text-decoration</span>: <span class="dv">none</span><span class="op">;</span></a>
<a class="sourceLine" id="cb5-17" title="17">}</a>
<a class="sourceLine" id="cb5-18" title="18"></a>
<a class="sourceLine" id="cb5-19" title="19"><span class="fu">.my-cancel-class</span> {</a>
<a class="sourceLine" id="cb5-20" title="20">  <span class="kw">padding</span>: <span class="dv">3</span><span class="dt">px</span> <span class="dv">6</span><span class="dt">px</span><span class="op">;</span></a>
<a class="sourceLine" id="cb5-21" title="21">  <span class="kw">font-size</span>: <span class="dv">12</span><span class="dt">px</span><span class="op">;</span></a>
<a class="sourceLine" id="cb5-22" title="22">  <span class="kw">color</span>: <span class="cn">white</span><span class="op">;</span></a>
<a class="sourceLine" id="cb5-23" title="23">  <span class="kw">text-align</span>: <span class="dv">center</span><span class="op">;</span></a>
<a class="sourceLine" id="cb5-24" title="24">  <span class="kw">vertical-align</span>: <span class="dv">middle</span><span class="op">;</span></a>
<a class="sourceLine" id="cb5-25" title="25">  <span class="kw">border-radius</span>: <span class="dv">4</span><span class="dt">px</span><span class="op">;</span></a>
<a class="sourceLine" id="cb5-26" title="26">  <span class="kw">background-color</span>: <span class="cn">#a94442</span><span class="op">;</span></a>
<a class="sourceLine" id="cb5-27" title="27">  <span class="kw">text-decoration</span>: <span class="dv">none</span><span class="op">;</span></a>
<a class="sourceLine" id="cb5-28" title="28">}</a></code></pre></div>
<p>Now modify the callback as follows:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" title="1">callback &lt;-<span class="st"> </span><span class="kw">JS</span>(</a>
<a class="sourceLine" id="cb6-2" title="2">  <span class="st">&quot;function onUpdate(updatedCell, updatedRow, oldValue) {};&quot;</span>,</a>
<a class="sourceLine" id="cb6-3" title="3">  <span class="st">&quot;table.MakeCellsEditable({&quot;</span>,</a>
<a class="sourceLine" id="cb6-4" title="4">  <span class="st">&quot;  onUpdate: onUpdate,&quot;</span>,</a>
<a class="sourceLine" id="cb6-5" title="5">  <span class="st">&quot;  inputCss: 'my-input-class',&quot;</span>,</a>
<a class="sourceLine" id="cb6-6" title="6">  <span class="st">&quot;  confirmationButton: {&quot;</span>,</a>
<a class="sourceLine" id="cb6-7" title="7">  <span class="st">&quot;    confirmCss: 'my-confirm-class',&quot;</span>,</a>
<a class="sourceLine" id="cb6-8" title="8">  <span class="st">&quot;    cancelCss: 'my-cancel-class'&quot;</span>,</a>
<a class="sourceLine" id="cb6-9" title="9">  <span class="st">&quot;  }&quot;</span>,</a>
<a class="sourceLine" id="cb6-10" title="10">  <span class="st">&quot;});&quot;</span>,</a>
<a class="sourceLine" id="cb6-11" title="11">  <span class="kw">sprintf</span>(<span class="st">&quot;var parentRows = [%s];&quot;</span>, <span class="kw">toString</span>(parentRows<span class="dv">-1</span>)),</a>
<a class="sourceLine" id="cb6-12" title="12">  </a>
<a class="sourceLine" id="cb6-13" title="13">  ......</a>
<a class="sourceLine" id="cb6-14" title="14">  </a>
<a class="sourceLine" id="cb6-15" title="15">  <span class="st">&quot;// --- make the datatable --- //&quot;</span>,</a>
<a class="sourceLine" id="cb6-16" title="16">  <span class="st">&quot;var formatDatatable = function(d, childId){&quot;</span>,</a>
<a class="sourceLine" id="cb6-17" title="17">  </a>
<a class="sourceLine" id="cb6-18" title="18">  ......</a>
<a class="sourceLine" id="cb6-19" title="19"></a>
<a class="sourceLine" id="cb6-20" title="20">  <span class="st">&quot;    }).column(0).nodes().to$().css({cursor: 'pointer'});&quot;</span>,</a>
<a class="sourceLine" id="cb6-21" title="21">  <span class="st">&quot;  }&quot;</span>,</a>
<a class="sourceLine" id="cb6-22" title="22">  <span class="st">&quot;  subtable.MakeCellsEditable({&quot;</span>,</a>
<a class="sourceLine" id="cb6-23" title="23">  <span class="st">&quot;    onUpdate: onUpdate,&quot;</span>,</a>
<a class="sourceLine" id="cb6-24" title="24">  <span class="st">&quot;    inputCss: 'my-input-class',&quot;</span>,</a>
<a class="sourceLine" id="cb6-25" title="25">  <span class="st">&quot;    confirmationButton: {&quot;</span>,</a>
<a class="sourceLine" id="cb6-26" title="26">  <span class="st">&quot;      confirmCss: 'my-confirm-class',&quot;</span>,</a>
<a class="sourceLine" id="cb6-27" title="27">  <span class="st">&quot;      cancelCss: 'my-cancel-class'&quot;</span>,</a>
<a class="sourceLine" id="cb6-28" title="28">  <span class="st">&quot;    }&quot;</span>,</a>
<a class="sourceLine" id="cb6-29" title="29">  <span class="st">&quot;  });&quot;</span>,</a>
<a class="sourceLine" id="cb6-30" title="30">  <span class="st">&quot;};&quot;</span>,</a>
<a class="sourceLine" id="cb6-31" title="31">  <span class="st">&quot;&quot;</span>,</a>
<a class="sourceLine" id="cb6-32" title="32">  <span class="st">&quot;// --- display the child table on click --- //&quot;</span>,</a>
<a class="sourceLine" id="cb6-33" title="33"></a>
<a class="sourceLine" id="cb6-34" title="34">  ......</a>
<a class="sourceLine" id="cb6-35" title="35">  </a>
<a class="sourceLine" id="cb6-36" title="36">  <span class="st">&quot;});&quot;</span>)</a></code></pre></div>
<p>Use the same code as before to generate the table but store the output:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" title="1">dtable &lt;-<span class="st"> </span><span class="kw">datatable</span>(</a>
<a class="sourceLine" id="cb7-2" title="2">  Dat, </a>
<a class="sourceLine" id="cb7-3" title="3">  <span class="dt">callback =</span> callback, <span class="dt">rownames =</span> rowNames, <span class="dt">escape =</span> <span class="op">-</span>colIdx<span class="dv">-1</span>,</a>
<a class="sourceLine" id="cb7-4" title="4">  <span class="dt">options =</span> <span class="kw">list</span>(</a>
<a class="sourceLine" id="cb7-5" title="5">    <span class="dt">paging =</span> <span class="ot">FALSE</span>,</a>
<a class="sourceLine" id="cb7-6" title="6">    <span class="dt">searching =</span> <span class="ot">FALSE</span>,</a>
<a class="sourceLine" id="cb7-7" title="7">    <span class="dt">columnDefs =</span> <span class="kw">list</span>(</a>
<a class="sourceLine" id="cb7-8" title="8">      <span class="kw">list</span>(</a>
<a class="sourceLine" id="cb7-9" title="9">        <span class="dt">visible =</span> <span class="ot">FALSE</span>, </a>
<a class="sourceLine" id="cb7-10" title="10">        <span class="dt">targets =</span> <span class="kw">ncol</span>(Dat)<span class="op">-</span><span class="dv">1</span><span class="op">+</span>colIdx</a>
<a class="sourceLine" id="cb7-11" title="11">      ),</a>
<a class="sourceLine" id="cb7-12" title="12">      <span class="kw">list</span>(</a>
<a class="sourceLine" id="cb7-13" title="13">        <span class="dt">orderable =</span> <span class="ot">FALSE</span>, </a>
<a class="sourceLine" id="cb7-14" title="14">        <span class="dt">className =</span> <span class="st">&quot;details-control&quot;</span>, </a>
<a class="sourceLine" id="cb7-15" title="15">        <span class="dt">targets =</span> colIdx</a>
<a class="sourceLine" id="cb7-16" title="16">      ),</a>
<a class="sourceLine" id="cb7-17" title="17">      <span class="kw">list</span>(</a>
<a class="sourceLine" id="cb7-18" title="18">        <span class="dt">className =</span> <span class="st">&quot;dt-center&quot;</span>, </a>
<a class="sourceLine" id="cb7-19" title="19">        <span class="dt">targets =</span> <span class="st">&quot;_all&quot;</span></a>
<a class="sourceLine" id="cb7-20" title="20">      )</a>
<a class="sourceLine" id="cb7-21" title="21">    )</a>
<a class="sourceLine" id="cb7-22" title="22">  )</a>
<a class="sourceLine" id="cb7-23" title="23">)</a></code></pre></div>
<p>Now we add the dependencies to the <code>datatable</code>:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" title="1">path &lt;-<span class="st"> &quot;path/to/cellEdit&quot;</span> <span class="co"># folder containing the files </span></a>
<a class="sourceLine" id="cb8-2" title="2">                           <span class="co"># dataTables.cellEdit.js and </span></a>
<a class="sourceLine" id="cb8-3" title="3">                           <span class="co"># dataTables.cellEdit.css</span></a>
<a class="sourceLine" id="cb8-4" title="4">dep &lt;-<span class="st"> </span>htmltools<span class="op">::</span><span class="kw">htmlDependency</span>(</a>
<a class="sourceLine" id="cb8-5" title="5">  <span class="st">&quot;CellEdit&quot;</span>, <span class="st">&quot;1.0.19&quot;</span>, path, </a>
<a class="sourceLine" id="cb8-6" title="6">  <span class="dt">script =</span> <span class="st">&quot;dataTables.cellEdit.js&quot;</span>, </a>
<a class="sourceLine" id="cb8-7" title="7">  <span class="dt">stylesheet =</span> <span class="st">&quot;dataTables.cellEdit.css&quot;</span>)</a>
<a class="sourceLine" id="cb8-8" title="8">dtable<span class="op">$</span>dependencies &lt;-<span class="st"> </span><span class="kw">c</span>(dtable<span class="op">$</span>dependencies, <span class="kw">list</span>(dep))</a>
<a class="sourceLine" id="cb8-9" title="9"></a>
<a class="sourceLine" id="cb8-10" title="10">dtable</a></code></pre></div>
<p><img src="figures/DTchildRows2.gif" /></p>
<h1 id="exporting">Exporting</h1>
<p>Now we show how to export a table with its child tables to an Excel file, when there is only one level of child tables (<em>i.e.</em> when the child tables of the main table do not have child tables themselves). To do so, we use the <code>customize</code> callback of the Excel button provided by the <code>Buttons</code> extension. I found this code on the DataTables forum. In the first row of the callback, <code>mytable</code> is the id of the datatable:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb9-1" title="1"><span class="kw">var</span> table <span class="op">=</span> <span class="at">$</span>(<span class="st">'#mytable'</span>).<span class="at">find</span>(<span class="st">'table'</span>).<span class="at">DataTable</span>()<span class="op">;</span></a></code></pre></div>
<p>If you don’t use Shiny, you have to set this id in the <code>elementId</code> argument of the <code>datatable</code> function. If you use Shiny, this id is the key of the element of the <code>output</code> object in which you assign a <code>renderDT</code>:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" title="1">output[[<span class="st">&quot;mytable&quot;</span>]] &lt;-<span class="st"> </span><span class="kw">renderDT</span>({</a>
<a class="sourceLine" id="cb10-2" title="2">  ......</a>
<a class="sourceLine" id="cb10-3" title="3">})</a></code></pre></div>
<p>The JavaScript code depends on whether the user desires a title in the Excel file, so this information has to be provided first.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" title="1">excelTitle =<span class="st"> </span><span class="ot">NULL</span> <span class="co"># enter title or set to NULL if you don't want a title</span></a>
<a class="sourceLine" id="cb11-2" title="2">js_customXLSX &lt;-<span class="st"> </span><span class="kw">JS</span>(</a>
<a class="sourceLine" id="cb11-3" title="3">  <span class="st">&quot;function(xlsx){&quot;</span>,</a>
<a class="sourceLine" id="cb11-4" title="4">  <span class="st">&quot;  var table = $('#mytable').find('table').DataTable();&quot;</span>,</a>
<a class="sourceLine" id="cb11-5" title="5">  <span class="st">&quot;  // Number of columns.&quot;</span>,</a>
<a class="sourceLine" id="cb11-6" title="6">  <span class="kw">sprintf</span>(<span class="st">&quot;  var ncols = %d;&quot;</span>, <span class="kw">ncol</span>(Dat)),</a>
<a class="sourceLine" id="cb11-7" title="7">  <span class="st">&quot;  // Is there a title?&quot;</span>,</a>
<a class="sourceLine" id="cb11-8" title="8">  <span class="kw">sprintf</span>(<span class="st">&quot;  var title = %s;&quot;</span>, </a>
<a class="sourceLine" id="cb11-9" title="9">          <span class="kw">ifelse</span>(<span class="kw">is.null</span>(excelTitle), <span class="st">&quot;false&quot;</span>, <span class="st">&quot;true&quot;</span>)),</a>
<a class="sourceLine" id="cb11-10" title="10">  <span class="st">&quot;  // Integer to Excel column: 0 -&gt; A, 1 -&gt; B, ..., 25 -&gt; Z, 26 -&gt; AA, ...&quot;</span>,</a>
<a class="sourceLine" id="cb11-11" title="11">  <span class="st">&quot;  var XLcolumn = function(j){&quot;</span>, </a>
<a class="sourceLine" id="cb11-12" title="12">  <span class="st">&quot;    return j &lt; 0 ? &quot;</span>,</a>
<a class="sourceLine" id="cb11-13" title="13">  <span class="st">&quot;      '' : XLcolumn(j/26-1) + String.fromCharCode(j % 26 + 65);&quot;</span>,</a>
<a class="sourceLine" id="cb11-14" title="14">  <span class="st">&quot;  };&quot;</span>,</a>
<a class="sourceLine" id="cb11-15" title="15">  <span class="st">&quot;  // Get sheet.&quot;</span>,</a>
<a class="sourceLine" id="cb11-16" title="16">  <span class="st">&quot;  var sheet = xlsx.xl.worksheets['sheet1.xml'];&quot;</span>,</a>
<a class="sourceLine" id="cb11-17" title="17">  <span class="st">&quot;  // Get a clone of the sheet data.        &quot;</span>,</a>
<a class="sourceLine" id="cb11-18" title="18">  <span class="st">&quot;  var sheetData = $('sheetData', sheet).clone();&quot;</span>,</a>
<a class="sourceLine" id="cb11-19" title="19">  <span class="st">&quot;  // Clear the current sheet data for appending rows.&quot;</span>,</a>
<a class="sourceLine" id="cb11-20" title="20">  <span class="st">&quot;  $('sheetData', sheet).empty();&quot;</span>,</a>
<a class="sourceLine" id="cb11-21" title="21">  <span class="st">&quot;  // Row count in Excel sheet.&quot;</span>,</a>
<a class="sourceLine" id="cb11-22" title="22">  <span class="st">&quot;  var rowCount = 1;&quot;</span>,</a>
<a class="sourceLine" id="cb11-23" title="23">  <span class="st">&quot;  // Iterate each row in the sheet data.&quot;</span>,</a>
<a class="sourceLine" id="cb11-24" title="24">  <span class="st">&quot;  $(sheetData).children().each(function (index) {&quot;</span>,</a>
<a class="sourceLine" id="cb11-25" title="25">  <span class="st">&quot;    // Used for DT row() API to get child data.&quot;</span>,</a>
<a class="sourceLine" id="cb11-26" title="26">  <span class="st">&quot;    var rowIndex = title ? index - 2 : index - 1;&quot;</span>, </a>
<a class="sourceLine" id="cb11-27" title="27">  <span class="st">&quot;    // Don't process row if it's the title row or the header row.&quot;</span>,</a>
<a class="sourceLine" id="cb11-28" title="28">  <span class="st">&quot;    var i0 = title ? 1 : 0;&quot;</span>,</a>
<a class="sourceLine" id="cb11-29" title="29">  <span class="st">&quot;    if (index &gt; i0) {&quot;</span>, </a>
<a class="sourceLine" id="cb11-30" title="30">  <span class="st">&quot;      // Get row&quot;</span>,</a>
<a class="sourceLine" id="cb11-31" title="31">  <span class="st">&quot;      var row = $(this.outerHTML);&quot;</span>,</a>
<a class="sourceLine" id="cb11-32" title="32">  <span class="st">&quot;      // Set the Excel row attr to the current Excel row count.&quot;</span>,</a>
<a class="sourceLine" id="cb11-33" title="33">  <span class="st">&quot;      row.attr('r', rowCount);&quot;</span>,</a>
<a class="sourceLine" id="cb11-34" title="34">  <span class="st">&quot;      // Iterate each cell in the row to change the row number.&quot;</span>,</a>
<a class="sourceLine" id="cb11-35" title="35">  <span class="st">&quot;      row.children().each(function (index) {&quot;</span>,</a>
<a class="sourceLine" id="cb11-36" title="36">  <span class="st">&quot;        var cell = $(this);&quot;</span>,</a>
<a class="sourceLine" id="cb11-37" title="37">  <span class="st">&quot;        // Set each cell's row value.&quot;</span>,</a>
<a class="sourceLine" id="cb11-38" title="38">  <span class="st">&quot;        var rc = cell.attr('r');&quot;</span>,</a>
<a class="sourceLine" id="cb11-39" title="39">  <span class="st">&quot;        rc = rc.replace(/</span><span class="ch">\\</span><span class="st">d+$/, </span><span class="ch">\&quot;\&quot;</span><span class="st">) + rowCount;&quot;</span>,</a>
<a class="sourceLine" id="cb11-40" title="40">  <span class="st">&quot;        cell.attr('r', rc);&quot;</span>,</a>
<a class="sourceLine" id="cb11-41" title="41">  <span class="st">&quot;      });&quot;</span>,</a>
<a class="sourceLine" id="cb11-42" title="42">  <span class="st">&quot;      // Get the row HTML and append to sheetData.&quot;</span>,</a>
<a class="sourceLine" id="cb11-43" title="43">  <span class="st">&quot;      row = row[0].outerHTML;&quot;</span>,</a>
<a class="sourceLine" id="cb11-44" title="44">  <span class="st">&quot;      $('sheetData', sheet).append(row);&quot;</span>,</a>
<a class="sourceLine" id="cb11-45" title="45">  <span class="st">&quot;      rowCount++;&quot;</span>,</a>
<a class="sourceLine" id="cb11-46" title="46">  <span class="st">&quot;      // Get the child data - could be any data attached to the row.&quot;</span>,</a>
<a class="sourceLine" id="cb11-47" title="47">  <span class="st">&quot;      var data = table.row(':eq(' + rowIndex + ')').data();&quot;</span>,</a>
<a class="sourceLine" id="cb11-48" title="48">  <span class="st">&quot;      var childData = data[ncols-1];&quot;</span>, </a>
<a class="sourceLine" id="cb11-49" title="49">  <span class="st">&quot;      if(childData.length &gt; 0){&quot;</span>,</a>
<a class="sourceLine" id="cb11-50" title="50">  <span class="st">&quot;        var colNames = Object.keys(childData[0]);&quot;</span>,</a>
<a class="sourceLine" id="cb11-51" title="51">  <span class="st">&quot;        // Prepare Excel formatted row&quot;</span>,</a>
<a class="sourceLine" id="cb11-52" title="52">  <span class="st">&quot;        var headerRow = '&lt;row r=</span><span class="ch">\&quot;</span><span class="st">' + rowCount +&quot;</span>,</a>
<a class="sourceLine" id="cb11-53" title="53">  <span class="st">&quot;          '</span><span class="ch">\&quot;</span><span class="st">&gt;&lt;c t=</span><span class="ch">\&quot;</span><span class="st">inlineStr</span><span class="ch">\&quot;</span><span class="st"> r=</span><span class="ch">\&quot;</span><span class="st">A' + rowCount +&quot;</span>,</a>
<a class="sourceLine" id="cb11-54" title="54">  <span class="st">&quot;          '</span><span class="ch">\&quot;</span><span class="st">&gt;&lt;is&gt;&lt;t&gt;&lt;/t&gt;&lt;/is&gt;&lt;/c&gt;';&quot;</span>,</a>
<a class="sourceLine" id="cb11-55" title="55">  <span class="st">&quot;        for(let i = 0; i &lt; colNames.length; i++){&quot;</span>,</a>
<a class="sourceLine" id="cb11-56" title="56">  <span class="st">&quot;          headerRow = headerRow +&quot;</span>,</a>
<a class="sourceLine" id="cb11-57" title="57">  <span class="st">&quot;            '&lt;c t=</span><span class="ch">\&quot;</span><span class="st">inlineStr</span><span class="ch">\&quot;</span><span class="st"> r=</span><span class="ch">\&quot;</span><span class="st">' + XLcolumn(i+1) + rowCount +&quot;</span>,</a>
<a class="sourceLine" id="cb11-58" title="58">  <span class="st">&quot;            '</span><span class="ch">\&quot;</span><span class="st"> s=</span><span class="ch">\&quot;</span><span class="st">7</span><span class="ch">\&quot;</span><span class="st">&gt;&lt;is&gt;&lt;t&gt;' + colNames[i] +&quot;</span>, </a>
<a class="sourceLine" id="cb11-59" title="59">  <span class="st">&quot;            '&lt;/t&gt;&lt;/is&gt;&lt;/c&gt;';&quot;</span>,</a>
<a class="sourceLine" id="cb11-60" title="60">  <span class="st">&quot;        }&quot;</span>,</a>
<a class="sourceLine" id="cb11-61" title="61">  <span class="st">&quot;        headerRow = headerRow + '&lt;/row&gt;';&quot;</span>,</a>
<a class="sourceLine" id="cb11-62" title="62">  <span class="st">&quot;        // Append header row to sheetData.&quot;</span>,</a>
<a class="sourceLine" id="cb11-63" title="63">  <span class="st">&quot;        $('sheetData', sheet).append(headerRow);&quot;</span>,</a>
<a class="sourceLine" id="cb11-64" title="64">  <span class="st">&quot;        rowCount++; // Increment excel row counter.&quot;</span>,</a>
<a class="sourceLine" id="cb11-65" title="65">  <span class="st">&quot;      }&quot;</span>,</a>
<a class="sourceLine" id="cb11-66" title="66">  <span class="st">&quot;      // The child data is an array of rows&quot;</span>,</a>
<a class="sourceLine" id="cb11-67" title="67">  <span class="st">&quot;      for(let c = 0; c &lt; childData.length; c++){&quot;</span>,</a>
<a class="sourceLine" id="cb11-68" title="68">  <span class="st">&quot;        // Get row data.&quot;</span>,</a>
<a class="sourceLine" id="cb11-69" title="69">  <span class="st">&quot;        var child = childData[c];&quot;</span>,</a>
<a class="sourceLine" id="cb11-70" title="70">  <span class="st">&quot;        // Prepare Excel formatted row&quot;</span>,</a>
<a class="sourceLine" id="cb11-71" title="71">  <span class="st">&quot;        var childRow = '&lt;row r=</span><span class="ch">\&quot;</span><span class="st">' + rowCount +&quot;</span>,</a>
<a class="sourceLine" id="cb11-72" title="72">  <span class="st">&quot;          '</span><span class="ch">\&quot;</span><span class="st">&gt;&lt;c t=</span><span class="ch">\&quot;</span><span class="st">inlineStr</span><span class="ch">\&quot;</span><span class="st"> r=</span><span class="ch">\&quot;</span><span class="st">A' + rowCount +&quot;</span>,</a>
<a class="sourceLine" id="cb11-73" title="73">  <span class="st">&quot;          '</span><span class="ch">\&quot;</span><span class="st">&gt;&lt;is&gt;&lt;t&gt;&lt;/t&gt;&lt;/is&gt;&lt;/c&gt;';&quot;</span>,</a>
<a class="sourceLine" id="cb11-74" title="74">  <span class="st">&quot;        for(let i = 0; i &lt; colNames.length; i++){&quot;</span>,</a>
<a class="sourceLine" id="cb11-75" title="75">  <span class="st">&quot;          childRow = childRow +&quot;</span>,</a>
<a class="sourceLine" id="cb11-76" title="76">  <span class="st">&quot;            '&lt;c t=</span><span class="ch">\&quot;</span><span class="st">inlineStr</span><span class="ch">\&quot;</span><span class="st"> r=</span><span class="ch">\&quot;</span><span class="st">' + XLcolumn(i+1) + rowCount +&quot;</span>,</a>
<a class="sourceLine" id="cb11-77" title="77">  <span class="st">&quot;            '</span><span class="ch">\&quot;</span><span class="st"> s=</span><span class="ch">\&quot;</span><span class="st">5</span><span class="ch">\&quot;</span><span class="st">&gt;&lt;is&gt;&lt;t&gt;' + child[colNames[i]] +&quot;</span>, </a>
<a class="sourceLine" id="cb11-78" title="78">  <span class="st">&quot;            '&lt;/t&gt;&lt;/is&gt;&lt;/c&gt;';&quot;</span>,</a>
<a class="sourceLine" id="cb11-79" title="79">  <span class="st">&quot;        }&quot;</span>,</a>
<a class="sourceLine" id="cb11-80" title="80">  <span class="st">&quot;        childRow = childRow + '&lt;/row&gt;';&quot;</span>,</a>
<a class="sourceLine" id="cb11-81" title="81">  <span class="st">&quot;        // Append row to sheetData.&quot;</span>,</a>
<a class="sourceLine" id="cb11-82" title="82">  <span class="st">&quot;        $('sheetData', sheet).append(childRow);&quot;</span>,</a>
<a class="sourceLine" id="cb11-83" title="83">  <span class="st">&quot;        rowCount++; // Increment excel row counter.&quot;</span>,</a>
<a class="sourceLine" id="cb11-84" title="84">  <span class="st">&quot;      }&quot;</span>,</a>
<a class="sourceLine" id="cb11-85" title="85">  <span class="st">&quot;      // Just append the header row and increment excel row counter.&quot;</span>,</a>
<a class="sourceLine" id="cb11-86" title="86">  <span class="st">&quot;    } else {&quot;</span>,</a>
<a class="sourceLine" id="cb11-87" title="87">  <span class="st">&quot;      $('sheetData', sheet).append(this.outerHTML);&quot;</span>,</a>
<a class="sourceLine" id="cb11-88" title="88">  <span class="st">&quot;      rowCount++;&quot;</span>,</a>
<a class="sourceLine" id="cb11-89" title="89">  <span class="st">&quot;    }&quot;</span>,</a>
<a class="sourceLine" id="cb11-90" title="90">  <span class="st">&quot;  });&quot;</span>,</a>
<a class="sourceLine" id="cb11-91" title="91">  <span class="st">&quot;}&quot;</span></a>
<a class="sourceLine" id="cb11-92" title="92">)</a></code></pre></div>
<p>Let’s see an example.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" title="1">dat0  =<span class="st"> </span>iris[<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>,]         <span class="co"># main table, with three rows</span></a>
<a class="sourceLine" id="cb12-2" title="2">dat01 =<span class="st"> </span>airquality[<span class="dv">1</span><span class="op">:</span><span class="dv">4</span>,]   <span class="co"># |- child of first row</span></a>
<a class="sourceLine" id="cb12-3" title="3">dat02 =<span class="st"> </span>cars[<span class="dv">1</span><span class="op">:</span><span class="dv">2</span>,]         <span class="co"># |- child of second row</span></a>
<a class="sourceLine" id="cb12-4" title="4">dat03 =<span class="st"> </span>PlantGrowth[<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>,]  <span class="co"># |- child of third row</span></a>
<a class="sourceLine" id="cb12-5" title="5">Dat &lt;-<span class="st"> </span><span class="kw">NestedData</span>(</a>
<a class="sourceLine" id="cb12-6" title="6">  <span class="dt">dat =</span> dat0, </a>
<a class="sourceLine" id="cb12-7" title="7">  <span class="dt">children =</span> <span class="kw">list</span>(dat01, dat02, dat03)</a>
<a class="sourceLine" id="cb12-8" title="8">)</a></code></pre></div>
<p>Below is the code generating the table with a button for the exporting. Remember, if you use Shiny, do not set <code>elementId</code>.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb13-1" title="1">dtable &lt;-<span class="st"> </span><span class="kw">datatable</span>(</a>
<a class="sourceLine" id="cb13-2" title="2">  Dat, </a>
<a class="sourceLine" id="cb13-3" title="3">  <span class="dt">callback =</span> callback, <span class="dt">rownames =</span> rowNames, <span class="dt">escape =</span> <span class="op">-</span>colIdx<span class="dv">-1</span>,</a>
<a class="sourceLine" id="cb13-4" title="4">  <span class="dt">extensions =</span> <span class="st">&quot;Buttons&quot;</span>, <span class="dt">elementId =</span> <span class="st">&quot;mytable&quot;</span>,</a>
<a class="sourceLine" id="cb13-5" title="5">  <span class="dt">options =</span> <span class="kw">list</span>(</a>
<a class="sourceLine" id="cb13-6" title="6">    <span class="dt">paging =</span> <span class="ot">FALSE</span>,</a>
<a class="sourceLine" id="cb13-7" title="7">    <span class="dt">searching =</span> <span class="ot">FALSE</span>,</a>
<a class="sourceLine" id="cb13-8" title="8">    <span class="dt">dom =</span> <span class="st">&quot;Bfrtip&quot;</span>,</a>
<a class="sourceLine" id="cb13-9" title="9">    <span class="dt">columnDefs =</span> <span class="kw">list</span>(</a>
<a class="sourceLine" id="cb13-10" title="10">      <span class="kw">list</span>(</a>
<a class="sourceLine" id="cb13-11" title="11">        <span class="dt">visible =</span> <span class="ot">FALSE</span>, </a>
<a class="sourceLine" id="cb13-12" title="12">        <span class="dt">targets =</span> <span class="kw">ncol</span>(Dat)<span class="op">-</span><span class="dv">1</span><span class="op">+</span>colIdx</a>
<a class="sourceLine" id="cb13-13" title="13">      ),</a>
<a class="sourceLine" id="cb13-14" title="14">      <span class="kw">list</span>(</a>
<a class="sourceLine" id="cb13-15" title="15">        <span class="dt">orderable =</span> <span class="ot">FALSE</span>, </a>
<a class="sourceLine" id="cb13-16" title="16">        <span class="dt">className =</span> <span class="st">&quot;details-control&quot;</span>, </a>
<a class="sourceLine" id="cb13-17" title="17">        <span class="dt">targets =</span> colIdx</a>
<a class="sourceLine" id="cb13-18" title="18">      ),</a>
<a class="sourceLine" id="cb13-19" title="19">      <span class="kw">list</span>(</a>
<a class="sourceLine" id="cb13-20" title="20">        <span class="dt">className =</span> <span class="st">&quot;dt-center&quot;</span>, </a>
<a class="sourceLine" id="cb13-21" title="21">        <span class="dt">targets =</span> <span class="st">&quot;_all&quot;</span></a>
<a class="sourceLine" id="cb13-22" title="22">      )</a>
<a class="sourceLine" id="cb13-23" title="23">    ),</a>
<a class="sourceLine" id="cb13-24" title="24">    <span class="dt">buttons =</span> <span class="kw">list</span>(</a>
<a class="sourceLine" id="cb13-25" title="25">      <span class="kw">list</span>(</a>
<a class="sourceLine" id="cb13-26" title="26">        <span class="dt">extend =</span> <span class="st">&quot;excel&quot;</span>,</a>
<a class="sourceLine" id="cb13-27" title="27">        <span class="dt">exportOptions =</span> <span class="kw">list</span>(</a>
<a class="sourceLine" id="cb13-28" title="28">          <span class="dt">orthogonal =</span> <span class="st">&quot;export&quot;</span>, </a>
<a class="sourceLine" id="cb13-29" title="29">          <span class="dt">columns =</span> <span class="dv">0</span><span class="op">:</span>(<span class="kw">ncol</span>(Dat)<span class="op">-</span><span class="dv">2</span>)</a>
<a class="sourceLine" id="cb13-30" title="30">        ),</a>
<a class="sourceLine" id="cb13-31" title="31">        <span class="dt">title =</span> excelTitle,</a>
<a class="sourceLine" id="cb13-32" title="32">        <span class="dt">orientation =</span> <span class="st">&quot;landscape&quot;</span>,</a>
<a class="sourceLine" id="cb13-33" title="33">        <span class="dt">customize =</span> js_customXLSX</a>
<a class="sourceLine" id="cb13-34" title="34">      )</a>
<a class="sourceLine" id="cb13-35" title="35">    )</a>
<a class="sourceLine" id="cb13-36" title="36">  )</a>
<a class="sourceLine" id="cb13-37" title="37">)</a></code></pre></div>
<p>Here is the Excel file one gets:</p>
<p><img src="figures/DTchildRows3.png" /></p>

        </div>


        <div id="footer">
          Site proudly generated by
          <a href="http://jaspervdj.be/hakyll">Hakyll</a>
        </div>

      </div>

    </div>

  </div>

  <div id="disqus_thread"></div>
  <div class="pagination">
    <ul>
      <li>
        <a href="http://laustep.github.io/stlahblog/">« Back Home</a>
      </li>
    </ul>
  </div>
</body>
<script src="../libraries/bootstrap/bootstrap.min.js"></script>
<script>
  var disqus_developer = 1;
  var disqus_shortname = 'stlapblog';
  // required: replace example with your forum shortname
  /* * * DON'T EDIT BELOW THIS LINE * * */
  (function () {
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = 'https://' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] ||
      document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>
<noscript>Please enable JavaScript to view the
  <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a>
</noscript>
<!-- MathJax: Fall back to local if CDN offline but local image fonts are not supported (saves >100MB) -->
<script type="text/x-mathjax-config" src="../libraries/mathjax/config/TeX-MML-AM_CHTML.js"></script>
<!-- <script>
  window.MathJax || document.write('<script type="text/x-mathjax-config">MathJax.Hub.Config({"HTML-CSS":{imageFont:null}});<\/script><script src="../libraries/mathjax/MathJax.js"><\/script>');
</script> -->

  <!-- Google Prettify -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prettify/188.0.0/prettify.js"></script>
  <!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/prettify/r298/prettify.js"></script> -->
  <script src="../libraries/highlighters/prettify/js/lang-r.js"></script>
  <script>
    var pres = document.getElementsByTagName("pre");
    for (var i = 0; i < pres.length; ++i) {
      
        pres[i].className = pres[i].className + " prettyprint linenums";
      
    }
    prettyPrint();
  </script> 


</html>