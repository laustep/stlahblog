<!DOCTYPE HTML>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Saturn Elephant - Fisheye effect with R</title>
  <link href="../libraries/bootstrap/bootstrap-grid.min.css" rel="stylesheet">
  <link rel="stylesheet" href="../css/default2.css" />
  <link rel="stylesheet" href="../css/post.css" />
  <link rel="stylesheet" href="../css/misc.css" /> 
  
    <link rel="stylesheet" href="../css/pandoc-solarized.css" /> 
   
  
  <link href="https://fonts.googleapis.com/css?family=Raleway:400,600,200,800" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/css?family=Droid+Sans" rel="stylesheet" type="text/css">
  <script src="../libraries/jquery.min.js"></script>
  <script type="text/javascript" async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML"></script>
</head>

<body>
  <div class="container-fluid">
    <div class="row">
      <!-- Sidebar. -->
      <div class="sidebar col-sm-2">
        <div class="row">
          <div class="col-sm-12" style="float:right;clear:both;margin-right:50px;margin-top:50px;">
            <a href="https://www.r-bloggers.com/">
              <img src="../images/Rbloggers.png" alt="Rbloggers" width="100%" />
            </a>
            <br />
            <a href="http://t-redactyl.io/">
              <span style="color:black;font-weight:bold;font-family:sans-serif;font-size:25px;">Standard error</span>
            </a>
            <a href="http://timelyportfolio.blogspot.be/">
              <span style="color:grey;font-weight:bold;font-family:sans-serif;font-size:24px;">Timely portfolio</span>
            </a>
            <br />
            <a href="https://antoineguillot.wordpress.com/blog/">
              <span style="color:white;background-color:darkblue;font-weight:bold;font-family:sans-serif;font-size:21px;border:5px solid;border-color:darkblue">ENHANCE DATA</span>
            </a>
            <br />
            <a href="https://fronkonstin.com/">
              <span style="color:black;background-color:gold;font-weight:bold;font-size:29px;border:3px solid;border-color:gold;">Fronkonstin</span>
            </a>
          </div>
        </div>
        <div id="logos">
          <div class="row">
            <div class="col-sm-4">
              <img src="../images/AsymptoteLogo.svg" style="width: 150%; transform: rotateZ(-35deg)" />
            </div>
            <div class="col-sm-4">
              <img src="../images/Rlogo.svg" style="width: 110%;" />
            </div>
            <div class="col-sm-4">
              <img src="../images/shiny-hex.png" style="width: 90%;" />
            </div>
          </div>
          <div class="row">
            <div class="col-sm-4">
              <img src="../images/Povray_logo_sphere.png" style="width: 105%;" />
            </div>
            <div class="col-sm-4">
              <img src="../images/javascript.svg" style="width: 90%;" />
            </div>
            <div class="col-sm-4">
              <img src="../images/haskell.svg" style="width: 110%;" />
            </div>
          </div>
        </div>
      </div>

      <div class="main col-sm-10">
        <div id="header">
          <div id="logo">
            <a href="../">
              <img src="../images/stla.jpg" alt="stla" width="100px" />
            </a>
          </div>
          <div id="navigation" style="margin-top:50px;">
            <a href="../">Home</a>
            <a href="../about.html">About</a>
            <a href="../contact.html">Contact</a>
            <a href="../archive.html">Archive</a>
          </div>
        </div>

        <div class="content">
          <h1>Fisheye effect with R</h1> 
          <div class="info">
    Posted on April 29, 2023
    
        by Stéphane Laurent
    
</div>
<div class="info">
    
    Tags: <a title="All pages tagged 'R'." href="../tags/R.html">R</a>
    
</div>

<p>The <code>fisheye</code> function below distorts a bitmap image with a <a href="https://en.wikipedia.org/wiki/Fisheye_lens">fisheye effect</a> or an anti-fisheye effect (<code>rho &gt; 0.5</code> or <code>rho &lt; 0.5</code>).</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true"></a>fisheye_xy &lt;-<span class="st"> </span><span class="cf">function</span>(x, y, rho, stick) {</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true"></a>  p &lt;-<span class="st"> </span><span class="kw">c</span>(x, y)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true"></a>  <span class="cf">if</span>(rho <span class="op">==</span><span class="st"> </span><span class="fl">0.5</span>) {</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true"></a>    <span class="kw">return</span>(p)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true"></a>  }</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true"></a>  m &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="fl">0.5</span>, <span class="fl">0.5</span>)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true"></a>  d &lt;-<span class="st"> </span>p <span class="op">-</span><span class="st"> </span>m</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true"></a>  r &lt;-<span class="st"> </span><span class="kw">sqrt</span>(<span class="kw">c</span>(<span class="kw">crossprod</span>(d)))</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true"></a>  dnormalized &lt;-<span class="st"> </span>d <span class="op">/</span><span class="st"> </span>r</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true"></a>  mnorm &lt;-<span class="st"> </span><span class="kw">sqrt</span>(<span class="kw">c</span>(<span class="kw">crossprod</span>(m)))</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true"></a>  power &lt;-<span class="st"> </span>pi <span class="op">/</span><span class="st"> </span>mnorm <span class="op">*</span><span class="st"> </span>(rho <span class="op">-</span><span class="st"> </span><span class="fl">0.5</span>)</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true"></a>  <span class="cf">if</span>(power <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>) {</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true"></a>    bind &lt;-<span class="st"> </span><span class="cf">if</span>(stick <span class="op">==</span><span class="st"> &quot;corners&quot;</span>) mnorm <span class="cf">else</span> m[2L]</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true"></a>    uv &lt;-<span class="st"> </span>m <span class="op">+</span><span class="st"> </span>dnormalized <span class="op">*</span><span class="st"> </span><span class="kw">tan</span>(r<span class="op">*</span>power) <span class="op">*</span><span class="st"> </span>bind <span class="op">/</span><span class="st"> </span><span class="kw">tan</span>(bind<span class="op">*</span>power)</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true"></a>  } <span class="cf">else</span> {</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true"></a>    bind &lt;-<span class="st"> </span>m[2L]</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true"></a>    uv &lt;-<span class="st"> </span>m <span class="op">+</span><span class="st"> </span>dnormalized <span class="op">*</span><span class="st"> </span><span class="kw">atan</span>(<span class="op">-</span><span class="dv">10</span><span class="op">*</span>r<span class="op">*</span>power) <span class="op">*</span><span class="st"> </span>bind <span class="op">/</span><span class="st"> </span><span class="kw">atan</span>(<span class="op">-</span><span class="dv">10</span><span class="op">*</span>bind<span class="op">*</span>power)</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true"></a>  }</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true"></a>  uv</span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true"></a>}</span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true"></a></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true"></a><span class="kw">library</span>(imager)</span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true"></a><span class="kw">library</span>(cooltools)</span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true"></a><span class="co">#' @importFrom imager load.image add.color squeeze R G B</span></span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true"></a><span class="co">#' @importFrom cooltools approxfun2</span></span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true"></a><span class="co">#' @importFrom grDevices col2rgb rgb</span></span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true"></a><span class="co">#' @param bitmapFile path to a bitmap file (jpg, png, ...)</span></span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true"></a><span class="co">#' @param rho amount of effect; no effect if 0.5, fisheye if &gt;0.5, </span></span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true"></a><span class="co">#'   antifisheye if &lt;0.5</span></span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true"></a><span class="co">#' @param stick where to stick the image when rho&gt;0.5, to the </span></span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true"></a><span class="co">#'   corners or to the borders; if you stick to the corners, a </span></span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true"></a><span class="co">#'   part of the image is lost</span></span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true"></a><span class="co">#' @param bkg background color; it appears only if rho&gt;0.5 and </span></span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true"></a><span class="co">#'   stick=&quot;borders&quot; </span></span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true"></a>fisheye &lt;-<span class="st"> </span><span class="cf">function</span>(bitmapFile, rho, <span class="dt">stick =</span> <span class="st">&quot;corners&quot;</span>, <span class="dt">bkg =</span> <span class="st">&quot;black&quot;</span>) {</span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true"></a>  <span class="kw">stopifnot</span>(rho <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>, rho <span class="op">&lt;</span><span class="st"> </span><span class="dv">1</span>)</span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true"></a>  stick &lt;-<span class="st"> </span><span class="kw">match.arg</span>(stick, <span class="kw">c</span>(<span class="st">&quot;borders&quot;</span>, <span class="st">&quot;corners&quot;</span>))</span>
<span id="cb1-38"><a href="#cb1-38" aria-hidden="true"></a>  <span class="co"># load the image</span></span>
<span id="cb1-39"><a href="#cb1-39" aria-hidden="true"></a>  img &lt;-<span class="st"> </span><span class="kw">load.image</span>(bitmapFile)</span>
<span id="cb1-40"><a href="#cb1-40" aria-hidden="true"></a>  dims &lt;-<span class="st"> </span><span class="kw">dim</span>(img)</span>
<span id="cb1-41"><a href="#cb1-41" aria-hidden="true"></a>  nx &lt;-<span class="st"> </span>dims[1L]</span>
<span id="cb1-42"><a href="#cb1-42" aria-hidden="true"></a>  ny &lt;-<span class="st"> </span>dims[2L]</span>
<span id="cb1-43"><a href="#cb1-43" aria-hidden="true"></a>  nchannels &lt;-<span class="st"> </span>dims[4L]</span>
<span id="cb1-44"><a href="#cb1-44" aria-hidden="true"></a>  <span class="co"># if the image is gray, add colors</span></span>
<span id="cb1-45"><a href="#cb1-45" aria-hidden="true"></a>  <span class="cf">if</span>(nchannels <span class="op">==</span><span class="st"> </span>1L) {</span>
<span id="cb1-46"><a href="#cb1-46" aria-hidden="true"></a>    img &lt;-<span class="st"> </span><span class="kw">add.color</span>(img)</span>
<span id="cb1-47"><a href="#cb1-47" aria-hidden="true"></a>  } <span class="cf">else</span> <span class="cf">if</span>(nchannels <span class="op">!=</span><span class="st"> </span>3L) {</span>
<span id="cb1-48"><a href="#cb1-48" aria-hidden="true"></a>    <span class="kw">stop</span>(<span class="st">&quot;Cannot process this image.&quot;</span>)</span>
<span id="cb1-49"><a href="#cb1-49" aria-hidden="true"></a>  }</span>
<span id="cb1-50"><a href="#cb1-50" aria-hidden="true"></a>  <span class="co"># fisheye matrix</span></span>
<span id="cb1-51"><a href="#cb1-51" aria-hidden="true"></a>  PSI &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="ot">NA_complex_</span>, <span class="dt">nrow =</span> nx, <span class="dt">ncol =</span> ny)</span>
<span id="cb1-52"><a href="#cb1-52" aria-hidden="true"></a>  <span class="cf">for</span>(i <span class="cf">in</span> 1L<span class="op">:</span>nx) {</span>
<span id="cb1-53"><a href="#cb1-53" aria-hidden="true"></a>    x &lt;-<span class="st"> </span>(i<span class="op">-</span>1L) <span class="op">/</span><span class="st"> </span>(nx<span class="op">-</span>1L)</span>
<span id="cb1-54"><a href="#cb1-54" aria-hidden="true"></a>    <span class="cf">for</span>(j <span class="cf">in</span> 1L<span class="op">:</span>ny) {</span>
<span id="cb1-55"><a href="#cb1-55" aria-hidden="true"></a>      y &lt;-<span class="st"> </span>(j<span class="op">-</span>1L) <span class="op">/</span><span class="st"> </span>(ny<span class="op">-</span>1L)</span>
<span id="cb1-56"><a href="#cb1-56" aria-hidden="true"></a>      uv &lt;-<span class="st"> </span><span class="kw">fisheye_xy</span>(x, y, rho, stick)</span>
<span id="cb1-57"><a href="#cb1-57" aria-hidden="true"></a>      PSI[i, j] &lt;-<span class="st"> </span><span class="kw">complex</span>(<span class="dt">real =</span> uv[1L], <span class="dt">imaginary =</span> uv[2L])</span>
<span id="cb1-58"><a href="#cb1-58" aria-hidden="true"></a>    }</span>
<span id="cb1-59"><a href="#cb1-59" aria-hidden="true"></a>  }</span>
<span id="cb1-60"><a href="#cb1-60" aria-hidden="true"></a>  <span class="co"># take the r, g, b channels</span></span>
<span id="cb1-61"><a href="#cb1-61" aria-hidden="true"></a>  r &lt;-<span class="st"> </span><span class="kw">squeeze</span>(<span class="kw">R</span>(img))</span>
<span id="cb1-62"><a href="#cb1-62" aria-hidden="true"></a>  g &lt;-<span class="st"> </span><span class="kw">squeeze</span>(<span class="kw">G</span>(img))</span>
<span id="cb1-63"><a href="#cb1-63" aria-hidden="true"></a>  b &lt;-<span class="st"> </span><span class="kw">squeeze</span>(<span class="kw">B</span>(img))</span>
<span id="cb1-64"><a href="#cb1-64" aria-hidden="true"></a>  <span class="co"># interpolation</span></span>
<span id="cb1-65"><a href="#cb1-65" aria-hidden="true"></a>  x_ &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dt">length.out =</span> nx)</span>
<span id="cb1-66"><a href="#cb1-66" aria-hidden="true"></a>  y_ &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dt">length.out =</span> ny)</span>
<span id="cb1-67"><a href="#cb1-67" aria-hidden="true"></a>  f_r &lt;-<span class="st"> </span><span class="kw">approxfun2</span>(x_, y_, r)</span>
<span id="cb1-68"><a href="#cb1-68" aria-hidden="true"></a>  f_g &lt;-<span class="st"> </span><span class="kw">approxfun2</span>(x_, y_, g)</span>
<span id="cb1-69"><a href="#cb1-69" aria-hidden="true"></a>  f_b &lt;-<span class="st"> </span><span class="kw">approxfun2</span>(x_, y_, b)</span>
<span id="cb1-70"><a href="#cb1-70" aria-hidden="true"></a>  M_r &lt;-<span class="st"> </span><span class="kw">f_r</span>(<span class="kw">Re</span>(PSI), <span class="kw">Im</span>(PSI))</span>
<span id="cb1-71"><a href="#cb1-71" aria-hidden="true"></a>  M_g &lt;-<span class="st"> </span><span class="kw">f_g</span>(<span class="kw">Re</span>(PSI), <span class="kw">Im</span>(PSI))</span>
<span id="cb1-72"><a href="#cb1-72" aria-hidden="true"></a>  M_b &lt;-<span class="st"> </span><span class="kw">f_b</span>(<span class="kw">Re</span>(PSI), <span class="kw">Im</span>(PSI))</span>
<span id="cb1-73"><a href="#cb1-73" aria-hidden="true"></a>  <span class="co"># set outside color</span></span>
<span id="cb1-74"><a href="#cb1-74" aria-hidden="true"></a>  RGB &lt;-<span class="st"> </span><span class="kw">col2rgb</span>(bkg)[, 1L] <span class="op">/</span><span class="st"> </span><span class="dv">255</span></span>
<span id="cb1-75"><a href="#cb1-75" aria-hidden="true"></a>  M_r[<span class="kw">is.na</span>(M_r)] &lt;-<span class="st"> </span>RGB[1L]</span>
<span id="cb1-76"><a href="#cb1-76" aria-hidden="true"></a>  M_g[<span class="kw">is.na</span>(M_g)] &lt;-<span class="st"> </span>RGB[2L]</span>
<span id="cb1-77"><a href="#cb1-77" aria-hidden="true"></a>  M_b[<span class="kw">is.na</span>(M_b)] &lt;-<span class="st"> </span>RGB[3L]</span>
<span id="cb1-78"><a href="#cb1-78" aria-hidden="true"></a>  <span class="co"># convert to hex codes</span></span>
<span id="cb1-79"><a href="#cb1-79" aria-hidden="true"></a>  rstr &lt;-<span class="st"> </span><span class="kw">rgb</span>(M_r, M_g, M_b)</span>
<span id="cb1-80"><a href="#cb1-80" aria-hidden="true"></a>  <span class="kw">dim</span>(rstr) &lt;-<span class="st"> </span><span class="kw">c</span>(nx, ny)</span>
<span id="cb1-81"><a href="#cb1-81" aria-hidden="true"></a>  <span class="co"># rotate</span></span>
<span id="cb1-82"><a href="#cb1-82" aria-hidden="true"></a>  <span class="kw">t</span>(rstr)</span>
<span id="cb1-83"><a href="#cb1-83" aria-hidden="true"></a>}</span></code></pre></div>
<p>Let’s take for example this picture of Dilbert, named <strong>dilbert512x512.png</strong>:</p>
<p><img src="./figures/dilbert512x512.png" /></p>
<p>It has a transparent background. We firstly transform this background it to a gray color (<code>#aaaaaa</code>) with the help of ImageMagick. The command to do that is:</p>
<pre><code>convert in.png -background '#aaaaaa' -alpha remove -alpha off out.png</code></pre>
<p>(<code>magick convert</code> if you use Windows).</p>
<p>We can run this command from R:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true"></a>dilbert_transparent &lt;-<span class="st"> &quot;dilbert512x512.png&quot;</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true"></a>dilbert_gray        &lt;-<span class="st"> &quot;dilbert_gray.png&quot;</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true"></a>gray_color &lt;-<span class="st"> &quot;#aaaaaa&quot;</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true"></a>cmd &lt;-<span class="st"> </span><span class="kw">sprintf</span>(</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true"></a>  <span class="st">&quot;convert %s -background '%s' -alpha remove -alpha off %s&quot;</span>, </span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true"></a>  dilbert_transparent, gray_color, dilbert_gray</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true"></a>)</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true"></a><span class="kw">system</span>(cmd)</span></code></pre></div>
<p>Here is <strong>dilbert_gray.png</strong>:</p>
<p><img src="./figures/dilbert_gray.png" /></p>
<p>Now let’s perform a fisheye distortion of this image with <code>rho=0.95</code>:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true"></a>img &lt;-<span class="st"> </span><span class="kw">fisheye</span>(dilbert_gray, <span class="dt">rho =</span> <span class="fl">0.95</span>, <span class="dt">stick =</span> <span class="st">&quot;borders&quot;</span>, <span class="dt">bkg =</span> gray_color)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true"></a><span class="co"># plot</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true"></a>opar &lt;-<span class="st"> </span><span class="kw">par</span>(<span class="dt">mar =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>))</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true"></a><span class="kw">plot</span>(<span class="kw">c</span>(<span class="op">-</span><span class="dv">100</span>, <span class="dv">100</span>), <span class="kw">c</span>(<span class="op">-</span><span class="dv">100</span>, <span class="dv">100</span>), <span class="dt">type =</span> <span class="st">&quot;n&quot;</span>, <span class="dt">asp =</span> <span class="dv">1</span>, </span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true"></a>     <span class="dt">xlab =</span> <span class="ot">NA</span>, <span class="dt">ylab =</span> <span class="ot">NA</span>, <span class="dt">axes =</span> <span class="ot">FALSE</span>, <span class="dt">xaxs =</span> <span class="st">&quot;i&quot;</span>, <span class="dt">yaxs =</span> <span class="st">&quot;i&quot;</span>)</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true"></a><span class="kw">rasterImage</span>(img, <span class="dv">-100</span>, <span class="dv">-100</span>, <span class="dv">100</span>, <span class="dv">100</span>)</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true"></a><span class="kw">par</span>(opar)</span></code></pre></div>
<p><img src="./figures/dilbert_fisheye.png" /></p>
<p>The anti-fisheye effect is obtained by setting <code>rho&lt;0.5</code>. We will do it, with something more: we will get a transparent background at the end.</p>
<p>To do so, first transform the transparent background to a color, for example green (<code>#00ff00</code>):</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true"></a>dilbert_transparent  &lt;-<span class="st"> &quot;dilbert512x512.png&quot;</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true"></a>dilbert_green        &lt;-<span class="st"> &quot;dilbert_green.png&quot;</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true"></a>green_color &lt;-<span class="st"> &quot;#00ff00&quot;</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true"></a>cmd &lt;-<span class="st"> </span><span class="kw">sprintf</span>(</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true"></a>  <span class="st">&quot;convert %s -background '%s' -alpha remove -alpha off %s&quot;</span>, </span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true"></a>  dilbert_transparent, green_color, dilbert_green</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true"></a>)</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true"></a><span class="kw">system</span>(cmd)</span></code></pre></div>
<p>Here is <strong>dilbert_green.png</strong>:</p>
<p><img src="./figures/dilbert_green.png" /></p>
<p>Now perform the anti-fisheye effect, and use the same green color as background:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true"></a>img &lt;-<span class="st"> </span><span class="kw">fisheye</span>(dilbert_green, <span class="dt">rho =</span> <span class="fl">0.45</span>, <span class="dt">bkg =</span> green_color)</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true"></a><span class="co"># save image</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true"></a><span class="kw">png</span>(<span class="st">&quot;dilbert_antifisheye_green.png&quot;</span>, <span class="dt">width =</span> <span class="dv">512</span>, <span class="dt">height =</span> <span class="dv">512</span>)</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true"></a>opar &lt;-<span class="st"> </span><span class="kw">par</span>(<span class="dt">mar =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>))</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true"></a><span class="kw">plot</span>(<span class="kw">c</span>(<span class="op">-</span><span class="dv">100</span>, <span class="dv">100</span>), <span class="kw">c</span>(<span class="op">-</span><span class="dv">100</span>, <span class="dv">100</span>), <span class="dt">type =</span> <span class="st">&quot;n&quot;</span>, <span class="dt">asp =</span> <span class="dv">1</span>, </span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true"></a>     <span class="dt">xlab =</span> <span class="ot">NA</span>, <span class="dt">ylab =</span> <span class="ot">NA</span>, <span class="dt">axes =</span> <span class="ot">FALSE</span>, <span class="dt">xaxs =</span> <span class="st">&quot;i&quot;</span>, <span class="dt">yaxs =</span> <span class="st">&quot;i&quot;</span>)</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true"></a><span class="kw">rasterImage</span>(img, <span class="dv">-100</span>, <span class="dv">-100</span>, <span class="dv">100</span>, <span class="dv">100</span>)</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true"></a><span class="kw">par</span>(opar)</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true"></a><span class="kw">dev.off</span>()</span></code></pre></div>
<p>Here is <strong>dilbert_antifisheye_green.png</strong>:</p>
<p><img src="./figures/dilbert_antifisheye_green.png" /></p>
<p>Finally, using ImageMagick, transform the green color to transparent:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true"></a>cmd &lt;-<span class="st"> </span><span class="kw">sprintf</span>(</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true"></a>  <span class="st">&quot;convert -fuzz 30% -transparent '%s' %s %s&quot;</span>,</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true"></a>  green_color, <span class="st">&quot;dilbert_antifisheye_green.png&quot;</span>, <span class="st">&quot;dilbert_antifisheye.png&quot;</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true"></a>)</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true"></a><span class="kw">system</span>(cmd)</span></code></pre></div>
<p><img src="./figures/dilbert_antifisheye.png" /></p>

        </div>


        <div id="footer">
          Site proudly generated by
          <a href="http://jaspervdj.be/hakyll">Hakyll</a>
        </div>

      </div>

    </div>

    <div class="row">
      <div class="col-sm-12">
        <div id="disqus_thread"></div>
        <div class="pagination">
          <ul>
            <li>
              <a href="http://laustep.github.io/stlahblog/">« Back Home</a>
            </li>
          </ul>
        </div>
      </div>
    </div>
    
  </div>

</body>

<script src="../libraries/bootstrap/bootstrap.min.js"></script>
<script>
  var disqus_developer = 1;
  var disqus_shortname = 'stlapblog';
  // required: replace example with your forum shortname
  /* * * DON'T EDIT BELOW THIS LINE * * */
  (function () {
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = 'https://' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] ||
      document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>
<noscript>Please enable JavaScript to view the
  <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a>
</noscript>
<!-- MathJax: Fall back to local if CDN offline but local image fonts are not supported (saves >100MB) -->
<script type="text/x-mathjax-config" src="../libraries/mathjax/config/TeX-MML-AM_CHTML.js"></script>
<!-- <script>
  window.MathJax || document.write('<script type="text/x-mathjax-config">MathJax.Hub.Config({"HTML-CSS":{imageFont:null}});<\/script><script src="../libraries/mathjax/MathJax.js"><\/script>');
</script> -->


</html>